var YI=Object.defineProperty;var JI=(i,e,t)=>e in i?YI(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var QI=(i,e)=>()=>(e||i((e={exports:{}}).exports,e),e.exports);var pe=(i,e,t)=>JI(i,typeof e!="symbol"?e+"":e,t);var RX=QI((FX,rw)=>{(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const p of o)if(p.type==="childList")for(const _ of p.addedNodes)_.tagName==="LINK"&&_.rel==="modulepreload"&&r(_)}).observe(document,{childList:!0,subtree:!0});function t(o){const p={};return o.integrity&&(p.integrity=o.integrity),o.referrerPolicy&&(p.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?p.credentials="include":o.crossOrigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function r(o){if(o.ep)return;o.ep=!0;const p=t(o);fetch(o.href,p)}})();function KI(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var hb={exports:{}},k2={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var H3;function e6(){if(H3)return k2;H3=1;var i=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(r,o,p){var _=null;if(p!==void 0&&(_=""+p),o.key!==void 0&&(_=""+o.key),"key"in o){p={};for(var l in o)l!=="key"&&(p[l]=o[l])}else p=o;return o=p.ref,{$$typeof:i,type:r,key:_,ref:o!==void 0?o:null,props:p}}return k2.Fragment=e,k2.jsx=t,k2.jsxs=t,k2}var $3;function t6(){return $3||($3=1,hb.exports=e6()),hb.exports}var rt=t6(),fb={exports:{}},wn={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var q3;function i6(){if(q3)return wn;q3=1;var i=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),p=Symbol.for("react.consumer"),_=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),M=Symbol.for("react.suspense"),D=Symbol.for("react.memo"),B=Symbol.for("react.lazy"),j=Symbol.for("react.activity"),$=Symbol.iterator;function se(Ye){return Ye===null||typeof Ye!="object"?null:(Ye=$&&Ye[$]||Ye["@@iterator"],typeof Ye=="function"?Ye:null)}var de={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Ae=Object.assign,he={};function Le(Ye,Gt,vi){this.props=Ye,this.context=Gt,this.refs=he,this.updater=vi||de}Le.prototype.isReactComponent={},Le.prototype.setState=function(Ye,Gt){if(typeof Ye!="object"&&typeof Ye!="function"&&Ye!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Ye,Gt,"setState")},Le.prototype.forceUpdate=function(Ye){this.updater.enqueueForceUpdate(this,Ye,"forceUpdate")};function $e(){}$e.prototype=Le.prototype;function Be(Ye,Gt,vi){this.props=Ye,this.context=Gt,this.refs=he,this.updater=vi||de}var Je=Be.prototype=new $e;Je.constructor=Be,Ae(Je,Le.prototype),Je.isPureReactComponent=!0;var Rt=Array.isArray;function Et(){}var kt={H:null,A:null,T:null,S:null},Ht=Object.prototype.hasOwnProperty;function Xt(Ye,Gt,vi){var Si=vi.ref;return{$$typeof:i,type:Ye,key:Gt,ref:Si!==void 0?Si:null,props:vi}}function hi(Ye,Gt){return Xt(Ye.type,Gt,Ye.props)}function di(Ye){return typeof Ye=="object"&&Ye!==null&&Ye.$$typeof===i}function Ei(Ye){var Gt={"=":"=0",":":"=2"};return"$"+Ye.replace(/[=:]/g,function(vi){return Gt[vi]})}var Ii=/\/+/g;function fi(Ye,Gt){return typeof Ye=="object"&&Ye!==null&&Ye.key!=null?Ei(""+Ye.key):Gt.toString(36)}function Ui(Ye){switch(Ye.status){case"fulfilled":return Ye.value;case"rejected":throw Ye.reason;default:switch(typeof Ye.status=="string"?Ye.then(Et,Et):(Ye.status="pending",Ye.then(function(Gt){Ye.status==="pending"&&(Ye.status="fulfilled",Ye.value=Gt)},function(Gt){Ye.status==="pending"&&(Ye.status="rejected",Ye.reason=Gt)})),Ye.status){case"fulfilled":return Ye.value;case"rejected":throw Ye.reason}}throw Ye}function nt(Ye,Gt,vi,Si,Li){var Vi=typeof Ye;(Vi==="undefined"||Vi==="boolean")&&(Ye=null);var yn=!1;if(Ye===null)yn=!0;else switch(Vi){case"bigint":case"string":case"number":yn=!0;break;case"object":switch(Ye.$$typeof){case i:case e:yn=!0;break;case B:return yn=Ye._init,nt(yn(Ye._payload),Gt,vi,Si,Li)}}if(yn)return Li=Li(Ye),yn=Si===""?"."+fi(Ye,0):Si,Rt(Li)?(vi="",yn!=null&&(vi=yn.replace(Ii,"$&/")+"/"),nt(Li,Gt,vi,"",function(Co){return Co})):Li!=null&&(di(Li)&&(Li=hi(Li,vi+(Li.key==null||Ye&&Ye.key===Li.key?"":(""+Li.key).replace(Ii,"$&/")+"/")+yn)),Gt.push(Li)),1;yn=0;var Kn=Si===""?".":Si+":";if(Rt(Ye))for(var mr=0;mr<Ye.length;mr++)Si=Ye[mr],Vi=Kn+fi(Si,mr),yn+=nt(Si,Gt,vi,Vi,Li);else if(mr=se(Ye),typeof mr=="function")for(Ye=mr.call(Ye),mr=0;!(Si=Ye.next()).done;)Si=Si.value,Vi=Kn+fi(Si,mr++),yn+=nt(Si,Gt,vi,Vi,Li);else if(Vi==="object"){if(typeof Ye.then=="function")return nt(Ui(Ye),Gt,vi,Si,Li);throw Gt=String(Ye),Error("Objects are not valid as a React child (found: "+(Gt==="[object Object]"?"object with keys {"+Object.keys(Ye).join(", ")+"}":Gt)+"). If you meant to render a collection of children, use an array instead.")}return yn}function Ut(Ye,Gt,vi){if(Ye==null)return Ye;var Si=[],Li=0;return nt(Ye,Si,"","",function(Vi){return Gt.call(vi,Vi,Li++)}),Si}function mi(Ye){if(Ye._status===-1){var Gt=Ye._result;Gt=Gt(),Gt.then(function(vi){(Ye._status===0||Ye._status===-1)&&(Ye._status=1,Ye._result=vi)},function(vi){(Ye._status===0||Ye._status===-1)&&(Ye._status=2,Ye._result=vi)}),Ye._status===-1&&(Ye._status=0,Ye._result=Gt)}if(Ye._status===1)return Ye._result.default;throw Ye._result}var li=typeof reportError=="function"?reportError:function(Ye){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Gt=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof Ye=="object"&&Ye!==null&&typeof Ye.message=="string"?String(Ye.message):String(Ye),error:Ye});if(!window.dispatchEvent(Gt))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",Ye);return}console.error(Ye)},Wi={map:Ut,forEach:function(Ye,Gt,vi){Ut(Ye,function(){Gt.apply(this,arguments)},vi)},count:function(Ye){var Gt=0;return Ut(Ye,function(){Gt++}),Gt},toArray:function(Ye){return Ut(Ye,function(Gt){return Gt})||[]},only:function(Ye){if(!di(Ye))throw Error("React.Children.only expected to receive a single React element child.");return Ye}};return wn.Activity=j,wn.Children=Wi,wn.Component=Le,wn.Fragment=t,wn.Profiler=o,wn.PureComponent=Be,wn.StrictMode=r,wn.Suspense=M,wn.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=kt,wn.__COMPILER_RUNTIME={__proto__:null,c:function(Ye){return kt.H.useMemoCache(Ye)}},wn.cache=function(Ye){return function(){return Ye.apply(null,arguments)}},wn.cacheSignal=function(){return null},wn.cloneElement=function(Ye,Gt,vi){if(Ye==null)throw Error("The argument must be a React element, but you passed "+Ye+".");var Si=Ae({},Ye.props),Li=Ye.key;if(Gt!=null)for(Vi in Gt.key!==void 0&&(Li=""+Gt.key),Gt)!Ht.call(Gt,Vi)||Vi==="key"||Vi==="__self"||Vi==="__source"||Vi==="ref"&&Gt.ref===void 0||(Si[Vi]=Gt[Vi]);var Vi=arguments.length-2;if(Vi===1)Si.children=vi;else if(1<Vi){for(var yn=Array(Vi),Kn=0;Kn<Vi;Kn++)yn[Kn]=arguments[Kn+2];Si.children=yn}return Xt(Ye.type,Li,Si)},wn.createContext=function(Ye){return Ye={$$typeof:_,_currentValue:Ye,_currentValue2:Ye,_threadCount:0,Provider:null,Consumer:null},Ye.Provider=Ye,Ye.Consumer={$$typeof:p,_context:Ye},Ye},wn.createElement=function(Ye,Gt,vi){var Si,Li={},Vi=null;if(Gt!=null)for(Si in Gt.key!==void 0&&(Vi=""+Gt.key),Gt)Ht.call(Gt,Si)&&Si!=="key"&&Si!=="__self"&&Si!=="__source"&&(Li[Si]=Gt[Si]);var yn=arguments.length-2;if(yn===1)Li.children=vi;else if(1<yn){for(var Kn=Array(yn),mr=0;mr<yn;mr++)Kn[mr]=arguments[mr+2];Li.children=Kn}if(Ye&&Ye.defaultProps)for(Si in yn=Ye.defaultProps,yn)Li[Si]===void 0&&(Li[Si]=yn[Si]);return Xt(Ye,Vi,Li)},wn.createRef=function(){return{current:null}},wn.forwardRef=function(Ye){return{$$typeof:l,render:Ye}},wn.isValidElement=di,wn.lazy=function(Ye){return{$$typeof:B,_payload:{_status:-1,_result:Ye},_init:mi}},wn.memo=function(Ye,Gt){return{$$typeof:D,type:Ye,compare:Gt===void 0?null:Gt}},wn.startTransition=function(Ye){var Gt=kt.T,vi={};kt.T=vi;try{var Si=Ye(),Li=kt.S;Li!==null&&Li(vi,Si),typeof Si=="object"&&Si!==null&&typeof Si.then=="function"&&Si.then(Et,li)}catch(Vi){li(Vi)}finally{Gt!==null&&vi.types!==null&&(Gt.types=vi.types),kt.T=Gt}},wn.unstable_useCacheRefresh=function(){return kt.H.useCacheRefresh()},wn.use=function(Ye){return kt.H.use(Ye)},wn.useActionState=function(Ye,Gt,vi){return kt.H.useActionState(Ye,Gt,vi)},wn.useCallback=function(Ye,Gt){return kt.H.useCallback(Ye,Gt)},wn.useContext=function(Ye){return kt.H.useContext(Ye)},wn.useDebugValue=function(){},wn.useDeferredValue=function(Ye,Gt){return kt.H.useDeferredValue(Ye,Gt)},wn.useEffect=function(Ye,Gt){return kt.H.useEffect(Ye,Gt)},wn.useEffectEvent=function(Ye){return kt.H.useEffectEvent(Ye)},wn.useId=function(){return kt.H.useId()},wn.useImperativeHandle=function(Ye,Gt,vi){return kt.H.useImperativeHandle(Ye,Gt,vi)},wn.useInsertionEffect=function(Ye,Gt){return kt.H.useInsertionEffect(Ye,Gt)},wn.useLayoutEffect=function(Ye,Gt){return kt.H.useLayoutEffect(Ye,Gt)},wn.useMemo=function(Ye,Gt){return kt.H.useMemo(Ye,Gt)},wn.useOptimistic=function(Ye,Gt){return kt.H.useOptimistic(Ye,Gt)},wn.useReducer=function(Ye,Gt,vi){return kt.H.useReducer(Ye,Gt,vi)},wn.useRef=function(Ye){return kt.H.useRef(Ye)},wn.useState=function(Ye){return kt.H.useState(Ye)},wn.useSyncExternalStore=function(Ye,Gt,vi){return kt.H.useSyncExternalStore(Ye,Gt,vi)},wn.useTransition=function(){return kt.H.useTransition()},wn.version="19.2.4",wn}var Y3;function sw(){return Y3||(Y3=1,fb.exports=i6()),fb.exports}var gn=sw(),db={exports:{}},D2={},pb={exports:{}},gb={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var J3;function n6(){return J3||(J3=1,(function(i){function e(nt,Ut){var mi=nt.length;nt.push(Ut);e:for(;0<mi;){var li=mi-1>>>1,Wi=nt[li];if(0<o(Wi,Ut))nt[li]=Ut,nt[mi]=Wi,mi=li;else break e}}function t(nt){return nt.length===0?null:nt[0]}function r(nt){if(nt.length===0)return null;var Ut=nt[0],mi=nt.pop();if(mi!==Ut){nt[0]=mi;e:for(var li=0,Wi=nt.length,Ye=Wi>>>1;li<Ye;){var Gt=2*(li+1)-1,vi=nt[Gt],Si=Gt+1,Li=nt[Si];if(0>o(vi,mi))Si<Wi&&0>o(Li,vi)?(nt[li]=Li,nt[Si]=mi,li=Si):(nt[li]=vi,nt[Gt]=mi,li=Gt);else if(Si<Wi&&0>o(Li,mi))nt[li]=Li,nt[Si]=mi,li=Si;else break e}}return Ut}function o(nt,Ut){var mi=nt.sortIndex-Ut.sortIndex;return mi!==0?mi:nt.id-Ut.id}if(i.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var p=performance;i.unstable_now=function(){return p.now()}}else{var _=Date,l=_.now();i.unstable_now=function(){return _.now()-l}}var M=[],D=[],B=1,j=null,$=3,se=!1,de=!1,Ae=!1,he=!1,Le=typeof setTimeout=="function"?setTimeout:null,$e=typeof clearTimeout=="function"?clearTimeout:null,Be=typeof setImmediate<"u"?setImmediate:null;function Je(nt){for(var Ut=t(D);Ut!==null;){if(Ut.callback===null)r(D);else if(Ut.startTime<=nt)r(D),Ut.sortIndex=Ut.expirationTime,e(M,Ut);else break;Ut=t(D)}}function Rt(nt){if(Ae=!1,Je(nt),!de)if(t(M)!==null)de=!0,Et||(Et=!0,Ei());else{var Ut=t(D);Ut!==null&&Ui(Rt,Ut.startTime-nt)}}var Et=!1,kt=-1,Ht=5,Xt=-1;function hi(){return he?!0:!(i.unstable_now()-Xt<Ht)}function di(){if(he=!1,Et){var nt=i.unstable_now();Xt=nt;var Ut=!0;try{e:{de=!1,Ae&&(Ae=!1,$e(kt),kt=-1),se=!0;var mi=$;try{t:{for(Je(nt),j=t(M);j!==null&&!(j.expirationTime>nt&&hi());){var li=j.callback;if(typeof li=="function"){j.callback=null,$=j.priorityLevel;var Wi=li(j.expirationTime<=nt);if(nt=i.unstable_now(),typeof Wi=="function"){j.callback=Wi,Je(nt),Ut=!0;break t}j===t(M)&&r(M),Je(nt)}else r(M);j=t(M)}if(j!==null)Ut=!0;else{var Ye=t(D);Ye!==null&&Ui(Rt,Ye.startTime-nt),Ut=!1}}break e}finally{j=null,$=mi,se=!1}Ut=void 0}}finally{Ut?Ei():Et=!1}}}var Ei;if(typeof Be=="function")Ei=function(){Be(di)};else if(typeof MessageChannel<"u"){var Ii=new MessageChannel,fi=Ii.port2;Ii.port1.onmessage=di,Ei=function(){fi.postMessage(null)}}else Ei=function(){Le(di,0)};function Ui(nt,Ut){kt=Le(function(){nt(i.unstable_now())},Ut)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(nt){nt.callback=null},i.unstable_forceFrameRate=function(nt){0>nt||125<nt?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Ht=0<nt?Math.floor(1e3/nt):5},i.unstable_getCurrentPriorityLevel=function(){return $},i.unstable_next=function(nt){switch($){case 1:case 2:case 3:var Ut=3;break;default:Ut=$}var mi=$;$=Ut;try{return nt()}finally{$=mi}},i.unstable_requestPaint=function(){he=!0},i.unstable_runWithPriority=function(nt,Ut){switch(nt){case 1:case 2:case 3:case 4:case 5:break;default:nt=3}var mi=$;$=nt;try{return Ut()}finally{$=mi}},i.unstable_scheduleCallback=function(nt,Ut,mi){var li=i.unstable_now();switch(typeof mi=="object"&&mi!==null?(mi=mi.delay,mi=typeof mi=="number"&&0<mi?li+mi:li):mi=li,nt){case 1:var Wi=-1;break;case 2:Wi=250;break;case 5:Wi=1073741823;break;case 4:Wi=1e4;break;default:Wi=5e3}return Wi=mi+Wi,nt={id:B++,callback:Ut,priorityLevel:nt,startTime:mi,expirationTime:Wi,sortIndex:-1},mi>li?(nt.sortIndex=mi,e(D,nt),t(M)===null&&nt===t(D)&&(Ae?($e(kt),kt=-1):Ae=!0,Ui(Rt,mi-li))):(nt.sortIndex=Wi,e(M,nt),de||se||(de=!0,Et||(Et=!0,Ei()))),nt},i.unstable_shouldYield=hi,i.unstable_wrapCallback=function(nt){var Ut=$;return function(){var mi=$;$=Ut;try{return nt.apply(this,arguments)}finally{$=mi}}}})(gb)),gb}var Q3;function r6(){return Q3||(Q3=1,pb.exports=n6()),pb.exports}var mb={exports:{}},Jl={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var K3;function s6(){if(K3)return Jl;K3=1;var i=sw();function e(M){var D="https://react.dev/errors/"+M;if(1<arguments.length){D+="?args[]="+encodeURIComponent(arguments[1]);for(var B=2;B<arguments.length;B++)D+="&args[]="+encodeURIComponent(arguments[B])}return"Minified React error #"+M+"; visit "+D+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var r={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},o=Symbol.for("react.portal");function p(M,D,B){var j=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:o,key:j==null?null:""+j,children:M,containerInfo:D,implementation:B}}var _=i.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function l(M,D){if(M==="font")return"";if(typeof D=="string")return D==="use-credentials"?D:""}return Jl.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,Jl.createPortal=function(M,D){var B=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!D||D.nodeType!==1&&D.nodeType!==9&&D.nodeType!==11)throw Error(e(299));return p(M,D,null,B)},Jl.flushSync=function(M){var D=_.T,B=r.p;try{if(_.T=null,r.p=2,M)return M()}finally{_.T=D,r.p=B,r.d.f()}},Jl.preconnect=function(M,D){typeof M=="string"&&(D?(D=D.crossOrigin,D=typeof D=="string"?D==="use-credentials"?D:"":void 0):D=null,r.d.C(M,D))},Jl.prefetchDNS=function(M){typeof M=="string"&&r.d.D(M)},Jl.preinit=function(M,D){if(typeof M=="string"&&D&&typeof D.as=="string"){var B=D.as,j=l(B,D.crossOrigin),$=typeof D.integrity=="string"?D.integrity:void 0,se=typeof D.fetchPriority=="string"?D.fetchPriority:void 0;B==="style"?r.d.S(M,typeof D.precedence=="string"?D.precedence:void 0,{crossOrigin:j,integrity:$,fetchPriority:se}):B==="script"&&r.d.X(M,{crossOrigin:j,integrity:$,fetchPriority:se,nonce:typeof D.nonce=="string"?D.nonce:void 0})}},Jl.preinitModule=function(M,D){if(typeof M=="string")if(typeof D=="object"&&D!==null){if(D.as==null||D.as==="script"){var B=l(D.as,D.crossOrigin);r.d.M(M,{crossOrigin:B,integrity:typeof D.integrity=="string"?D.integrity:void 0,nonce:typeof D.nonce=="string"?D.nonce:void 0})}}else D==null&&r.d.M(M)},Jl.preload=function(M,D){if(typeof M=="string"&&typeof D=="object"&&D!==null&&typeof D.as=="string"){var B=D.as,j=l(B,D.crossOrigin);r.d.L(M,B,{crossOrigin:j,integrity:typeof D.integrity=="string"?D.integrity:void 0,nonce:typeof D.nonce=="string"?D.nonce:void 0,type:typeof D.type=="string"?D.type:void 0,fetchPriority:typeof D.fetchPriority=="string"?D.fetchPriority:void 0,referrerPolicy:typeof D.referrerPolicy=="string"?D.referrerPolicy:void 0,imageSrcSet:typeof D.imageSrcSet=="string"?D.imageSrcSet:void 0,imageSizes:typeof D.imageSizes=="string"?D.imageSizes:void 0,media:typeof D.media=="string"?D.media:void 0})}},Jl.preloadModule=function(M,D){if(typeof M=="string")if(D){var B=l(D.as,D.crossOrigin);r.d.m(M,{as:typeof D.as=="string"&&D.as!=="script"?D.as:void 0,crossOrigin:B,integrity:typeof D.integrity=="string"?D.integrity:void 0})}else r.d.m(M)},Jl.requestFormReset=function(M){r.d.r(M)},Jl.unstable_batchedUpdates=function(M,D){return M(D)},Jl.useFormState=function(M,D,B){return _.H.useFormState(M,D,B)},Jl.useFormStatus=function(){return _.H.useHostTransitionStatus()},Jl.version="19.2.4",Jl}var eT;function a6(){if(eT)return mb.exports;eT=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(e){console.error(e)}}return i(),mb.exports=s6(),mb.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var tT;function o6(){if(tT)return D2;tT=1;var i=r6(),e=sw(),t=a6();function r(d){var m="https://react.dev/errors/"+d;if(1<arguments.length){m+="?args[]="+encodeURIComponent(arguments[1]);for(var A=2;A<arguments.length;A++)m+="&args[]="+encodeURIComponent(arguments[A])}return"Minified React error #"+d+"; visit "+m+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function o(d){return!(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11)}function p(d){var m=d,A=d;if(d.alternate)for(;m.return;)m=m.return;else{d=m;do m=d,(m.flags&4098)!==0&&(A=m.return),d=m.return;while(d)}return m.tag===3?A:null}function _(d){if(d.tag===13){var m=d.memoizedState;if(m===null&&(d=d.alternate,d!==null&&(m=d.memoizedState)),m!==null)return m.dehydrated}return null}function l(d){if(d.tag===31){var m=d.memoizedState;if(m===null&&(d=d.alternate,d!==null&&(m=d.memoizedState)),m!==null)return m.dehydrated}return null}function M(d){if(p(d)!==d)throw Error(r(188))}function D(d){var m=d.alternate;if(!m){if(m=p(d),m===null)throw Error(r(188));return m!==d?null:d}for(var A=d,P=m;;){var L=A.return;if(L===null)break;var X=L.alternate;if(X===null){if(P=L.return,P!==null){A=P;continue}break}if(L.child===X.child){for(X=L.child;X;){if(X===A)return M(L),d;if(X===P)return M(L),m;X=X.sibling}throw Error(r(188))}if(A.return!==P.return)A=L,P=X;else{for(var ae=!1,Te=L.child;Te;){if(Te===A){ae=!0,A=L,P=X;break}if(Te===P){ae=!0,P=L,A=X;break}Te=Te.sibling}if(!ae){for(Te=X.child;Te;){if(Te===A){ae=!0,A=X,P=L;break}if(Te===P){ae=!0,P=X,A=L;break}Te=Te.sibling}if(!ae)throw Error(r(189))}}if(A.alternate!==P)throw Error(r(190))}if(A.tag!==3)throw Error(r(188));return A.stateNode.current===A?d:m}function B(d){var m=d.tag;if(m===5||m===26||m===27||m===6)return d;for(d=d.child;d!==null;){if(m=B(d),m!==null)return m;d=d.sibling}return null}var j=Object.assign,$=Symbol.for("react.element"),se=Symbol.for("react.transitional.element"),de=Symbol.for("react.portal"),Ae=Symbol.for("react.fragment"),he=Symbol.for("react.strict_mode"),Le=Symbol.for("react.profiler"),$e=Symbol.for("react.consumer"),Be=Symbol.for("react.context"),Je=Symbol.for("react.forward_ref"),Rt=Symbol.for("react.suspense"),Et=Symbol.for("react.suspense_list"),kt=Symbol.for("react.memo"),Ht=Symbol.for("react.lazy"),Xt=Symbol.for("react.activity"),hi=Symbol.for("react.memo_cache_sentinel"),di=Symbol.iterator;function Ei(d){return d===null||typeof d!="object"?null:(d=di&&d[di]||d["@@iterator"],typeof d=="function"?d:null)}var Ii=Symbol.for("react.client.reference");function fi(d){if(d==null)return null;if(typeof d=="function")return d.$$typeof===Ii?null:d.displayName||d.name||null;if(typeof d=="string")return d;switch(d){case Ae:return"Fragment";case Le:return"Profiler";case he:return"StrictMode";case Rt:return"Suspense";case Et:return"SuspenseList";case Xt:return"Activity"}if(typeof d=="object")switch(d.$$typeof){case de:return"Portal";case Be:return d.displayName||"Context";case $e:return(d._context.displayName||"Context")+".Consumer";case Je:var m=d.render;return d=d.displayName,d||(d=m.displayName||m.name||"",d=d!==""?"ForwardRef("+d+")":"ForwardRef"),d;case kt:return m=d.displayName||null,m!==null?m:fi(d.type)||"Memo";case Ht:m=d._payload,d=d._init;try{return fi(d(m))}catch{}}return null}var Ui=Array.isArray,nt=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Ut=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,mi={pending:!1,data:null,method:null,action:null},li=[],Wi=-1;function Ye(d){return{current:d}}function Gt(d){0>Wi||(d.current=li[Wi],li[Wi]=null,Wi--)}function vi(d,m){Wi++,li[Wi]=d.current,d.current=m}var Si=Ye(null),Li=Ye(null),Vi=Ye(null),yn=Ye(null);function Kn(d,m){switch(vi(Vi,m),vi(Li,d),vi(Si,null),m.nodeType){case 9:case 11:d=(d=m.documentElement)&&(d=d.namespaceURI)?Hh(d):0;break;default:if(d=m.tagName,m=m.namespaceURI)m=Hh(m),d=Om(m,d);else switch(d){case"svg":d=1;break;case"math":d=2;break;default:d=0}}Gt(Si),vi(Si,d)}function mr(){Gt(Si),Gt(Li),Gt(Vi)}function Co(d){d.memoizedState!==null&&vi(yn,d);var m=Si.current,A=Om(m,d.type);m!==A&&(vi(Li,d),vi(Si,A))}function Oa(d){Li.current===d&&(Gt(Si),Gt(Li)),yn.current===d&&(Gt(yn),qd._currentValue=mi)}var ra,uh;function br(d){if(ra===void 0)try{throw Error()}catch(A){var m=A.stack.trim().match(/\n( *(at )?)/);ra=m&&m[1]||"",uh=-1<A.stack.indexOf(`
    at`)?" (<anonymous>)":-1<A.stack.indexOf("@")?"@unknown:0:0":""}return`
`+ra+d+uh}var Fa=!1;function Na(d,m){if(!d||Fa)return"";Fa=!0;var A=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var P={DetermineComponentFrameRoot:function(){try{if(m){var $t=function(){throw Error()};if(Object.defineProperty($t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct($t,[])}catch(Nt){var It=Nt}Reflect.construct(d,[],$t)}else{try{$t.call()}catch(Nt){It=Nt}d.call($t.prototype)}}else{try{throw Error()}catch(Nt){It=Nt}($t=d())&&typeof $t.catch=="function"&&$t.catch(function(){})}}catch(Nt){if(Nt&&It&&typeof Nt.stack=="string")return[Nt.stack,It.stack]}return[null,null]}};P.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var L=Object.getOwnPropertyDescriptor(P.DetermineComponentFrameRoot,"name");L&&L.configurable&&Object.defineProperty(P.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var X=P.DetermineComponentFrameRoot(),ae=X[0],Te=X[1];if(ae&&Te){var qe=ae.split(`
`),wt=Te.split(`
`);for(L=P=0;P<qe.length&&!qe[P].includes("DetermineComponentFrameRoot");)P++;for(;L<wt.length&&!wt[L].includes("DetermineComponentFrameRoot");)L++;if(P===qe.length||L===wt.length)for(P=qe.length-1,L=wt.length-1;1<=P&&0<=L&&qe[P]!==wt[L];)L--;for(;1<=P&&0<=L;P--,L--)if(qe[P]!==wt[L]){if(P!==1||L!==1)do if(P--,L--,0>L||qe[P]!==wt[L]){var Lt=`
`+qe[P].replace(" at new "," at ");return d.displayName&&Lt.includes("<anonymous>")&&(Lt=Lt.replace("<anonymous>",d.displayName)),Lt}while(1<=P&&0<=L);break}}}finally{Fa=!1,Error.prepareStackTrace=A}return(A=d?d.displayName||d.name:"")?br(A):""}function Ir(d,m){switch(d.tag){case 26:case 27:case 5:return br(d.type);case 16:return br("Lazy");case 13:return d.child!==m&&m!==null?br("Suspense Fallback"):br("Suspense");case 19:return br("SuspenseList");case 0:case 15:return Na(d.type,!1);case 11:return Na(d.type.render,!1);case 1:return Na(d.type,!0);case 31:return br("Activity");default:return""}}function xl(d){try{var m="",A=null;do m+=Ir(d,A),A=d,d=d.return;while(d);return m}catch(P){return`
Error generating stack: `+P.message+`
`+P.stack}}var Fc=Object.prototype.hasOwnProperty,Nc=i.unstable_scheduleCallback,Po=i.unstable_cancelCallback,ic=i.unstable_shouldYield,so=i.unstable_requestPaint,Qr=i.unstable_now,ao=i.unstable_getCurrentPriorityLevel,nc=i.unstable_ImmediatePriority,Qo=i.unstable_UserBlockingPriority,Ls=i.unstable_NormalPriority,hh=i.unstable_LowPriority,it=i.unstable_IdlePriority,fe=i.log,ge=i.unstable_setDisableYieldValue,ve=null,Fe=null;function He(d){if(typeof fe=="function"&&ge(d),Fe&&typeof Fe.setStrictMode=="function")try{Fe.setStrictMode(ve,d)}catch{}}var st=Math.clz32?Math.clz32:ht,xt=Math.log,Qe=Math.LN2;function ht(d){return d>>>=0,d===0?32:31-(xt(d)/Qe|0)|0}var zt=256,Pt=262144,qt=4194304;function Ke(d){var m=d&42;if(m!==0)return m;switch(d&-d){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return d&261888;case 262144:case 524288:case 1048576:case 2097152:return d&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return d&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return d}}function Oi(d,m,A){var P=d.pendingLanes;if(P===0)return 0;var L=0,X=d.suspendedLanes,ae=d.pingedLanes;d=d.warmLanes;var Te=P&134217727;return Te!==0?(P=Te&~X,P!==0?L=Ke(P):(ae&=Te,ae!==0?L=Ke(ae):A||(A=Te&~d,A!==0&&(L=Ke(A))))):(Te=P&~X,Te!==0?L=Ke(Te):ae!==0?L=Ke(ae):A||(A=P&~d,A!==0&&(L=Ke(A)))),L===0?0:m!==0&&m!==L&&(m&X)===0&&(X=L&-L,A=m&-m,X>=A||X===32&&(A&4194048)!==0)?m:L}function Tn(d,m){return(d.pendingLanes&~(d.suspendedLanes&~d.pingedLanes)&m)===0}function bi(d,m){switch(d){case 1:case 2:case 4:case 8:case 64:return m+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return m+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ki(){var d=qt;return qt<<=1,(qt&62914560)===0&&(qt=4194304),d}function qi(d){for(var m=[],A=0;31>A;A++)m.push(d);return m}function Bn(d,m){d.pendingLanes|=m,m!==268435456&&(d.suspendedLanes=0,d.pingedLanes=0,d.warmLanes=0)}function er(d,m,A,P,L,X){var ae=d.pendingLanes;d.pendingLanes=A,d.suspendedLanes=0,d.pingedLanes=0,d.warmLanes=0,d.expiredLanes&=A,d.entangledLanes&=A,d.errorRecoveryDisabledLanes&=A,d.shellSuspendCounter=0;var Te=d.entanglements,qe=d.expirationTimes,wt=d.hiddenUpdates;for(A=ae&~A;0<A;){var Lt=31-st(A),$t=1<<Lt;Te[Lt]=0,qe[Lt]=-1;var It=wt[Lt];if(It!==null)for(wt[Lt]=null,Lt=0;Lt<It.length;Lt++){var Nt=It[Lt];Nt!==null&&(Nt.lane&=-536870913)}A&=~$t}P!==0&&Kr(d,P,0),X!==0&&L===0&&d.tag!==0&&(d.suspendedLanes|=X&~(ae&~m))}function Kr(d,m,A){d.pendingLanes|=m,d.suspendedLanes&=~m;var P=31-st(m);d.entangledLanes|=m,d.entanglements[P]=d.entanglements[P]|1073741824|A&261930}function es(d,m){var A=d.entangledLanes|=m;for(d=d.entanglements;A;){var P=31-st(A),L=1<<P;L&m|d[P]&m&&(d[P]|=m),A&=~L}}function tr(d,m){var A=m&-m;return A=(A&42)!==0?1:$i(A),(A&(d.suspendedLanes|m))!==0?0:A}function $i(d){switch(d){case 2:d=1;break;case 8:d=4;break;case 32:d=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:d=128;break;case 268435456:d=134217728;break;default:d=0}return d}function Vt(d){return d&=-d,2<d?8<d?(d&134217727)!==0?32:268435456:8:2}function Ar(){var d=Ut.p;return d!==0?d:(d=window.event,d===void 0?32:Gf(d.type))}function Cs(d,m){var A=Ut.p;try{return Ut.p=d,m()}finally{Ut.p=A}}var ts=Math.random().toString(36).slice(2),vn="__reactFiber$"+ts,ei="__reactProps$"+ts,Xi="__reactContainer$"+ts,en="__reactEvents$"+ts,ba="__reactListeners$"+ts,df="__reactHandles$"+ts,bl="__reactResources$"+ts,Yi="__reactMarker$"+ts;function Ko(d){delete d[vn],delete d[ei],delete d[en],delete d[ba],delete d[df]}function Al(d){var m=d[vn];if(m)return m;for(var A=d.parentNode;A;){if(m=A[Xi]||A[vn]){if(A=m.alternate,m.child!==null||A!==null&&A.child!==null)for(d=rp(d);d!==null;){if(A=d[vn])return A;d=rp(d)}return m}d=A,A=d.parentNode}return null}function rc(d){if(d=d[vn]||d[Xi]){var m=d.tag;if(m===5||m===6||m===13||m===31||m===26||m===27||m===3)return d}return null}function wl(d){var m=d.tag;if(m===5||m===26||m===27||m===6)return d.stateNode;throw Error(r(33))}function Ba(d){var m=d[bl];return m||(m=d[bl]={hoistableStyles:new Map,hoistableScripts:new Map}),m}function cr(d){d[Yi]=!0}var Bc=new Set,sa={};function En(d,m){aa(d,m),aa(d+"Capture",m)}function aa(d,m){for(sa[d]=m,d=0;d<m.length;d++)Bc.add(m[d])}var hu=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),fu={},zc={};function el(d){return Fc.call(zc,d)?!0:Fc.call(fu,d)?!1:hu.test(d)?zc[d]=!0:(fu[d]=!0,!1)}function du(d,m,A){if(el(m))if(A===null)d.removeAttribute(m);else{switch(typeof A){case"undefined":case"function":case"symbol":d.removeAttribute(m);return;case"boolean":var P=m.toLowerCase().slice(0,5);if(P!=="data-"&&P!=="aria-"){d.removeAttribute(m);return}}d.setAttribute(m,""+A)}}function Tl(d,m,A){if(A===null)d.removeAttribute(m);else{switch(typeof A){case"undefined":case"function":case"symbol":case"boolean":d.removeAttribute(m);return}d.setAttribute(m,""+A)}}function Io(d,m,A,P){if(P===null)d.removeAttribute(A);else{switch(typeof P){case"undefined":case"function":case"symbol":case"boolean":d.removeAttribute(A);return}d.setAttributeNS(m,A,""+P)}}function kn(d){switch(typeof d){case"bigint":case"boolean":case"number":case"string":case"undefined":return d;case"object":return d;default:return""}}function fh(d){var m=d.type;return(d=d.nodeName)&&d.toLowerCase()==="input"&&(m==="checkbox"||m==="radio")}function kp(d,m,A){var P=Object.getOwnPropertyDescriptor(d.constructor.prototype,m);if(!d.hasOwnProperty(m)&&typeof P<"u"&&typeof P.get=="function"&&typeof P.set=="function"){var L=P.get,X=P.set;return Object.defineProperty(d,m,{configurable:!0,get:function(){return L.call(this)},set:function(ae){A=""+ae,X.call(this,ae)}}),Object.defineProperty(d,m,{enumerable:P.enumerable}),{getValue:function(){return A},setValue:function(ae){A=""+ae},stopTracking:function(){d._valueTracker=null,delete d[m]}}}}function pu(d){if(!d._valueTracker){var m=fh(d)?"checked":"value";d._valueTracker=kp(d,m,""+d[m])}}function u0(d){if(!d)return!1;var m=d._valueTracker;if(!m)return!0;var A=m.getValue(),P="";return d&&(P=fh(d)?d.checked?"true":"false":d.value),d=P,d!==A?(m.setValue(d),!0):!1}function dh(d){if(d=d||(typeof document<"u"?document:void 0),typeof d>"u")return null;try{return d.activeElement||d.body}catch{return d.body}}var Dp=/[\n"\\]/g;function Aa(d){return d.replace(Dp,function(m){return"\\"+m.charCodeAt(0).toString(16)+" "})}function pf(d,m,A,P,L,X,ae,Te){d.name="",ae!=null&&typeof ae!="function"&&typeof ae!="symbol"&&typeof ae!="boolean"?d.type=ae:d.removeAttribute("type"),m!=null?ae==="number"?(m===0&&d.value===""||d.value!=m)&&(d.value=""+kn(m)):d.value!==""+kn(m)&&(d.value=""+kn(m)):ae!=="submit"&&ae!=="reset"||d.removeAttribute("value"),m!=null?sc(d,ae,kn(m)):A!=null?sc(d,ae,kn(A)):P!=null&&d.removeAttribute("value"),L==null&&X!=null&&(d.defaultChecked=!!X),L!=null&&(d.checked=L&&typeof L!="function"&&typeof L!="symbol"),Te!=null&&typeof Te!="function"&&typeof Te!="symbol"&&typeof Te!="boolean"?d.name=""+kn(Te):d.removeAttribute("name")}function id(d,m,A,P,L,X,ae,Te){if(X!=null&&typeof X!="function"&&typeof X!="symbol"&&typeof X!="boolean"&&(d.type=X),m!=null||A!=null){if(!(X!=="submit"&&X!=="reset"||m!=null)){pu(d);return}A=A!=null?""+kn(A):"",m=m!=null?""+kn(m):A,Te||m===d.value||(d.value=m),d.defaultValue=m}P=P??L,P=typeof P!="function"&&typeof P!="symbol"&&!!P,d.checked=Te?d.checked:!!P,d.defaultChecked=!!P,ae!=null&&typeof ae!="function"&&typeof ae!="symbol"&&typeof ae!="boolean"&&(d.name=ae),pu(d)}function sc(d,m,A){m==="number"&&dh(d.ownerDocument)===d||d.defaultValue===""+A||(d.defaultValue=""+A)}function Lc(d,m,A,P){if(d=d.options,m){m={};for(var L=0;L<A.length;L++)m["$"+A[L]]=!0;for(A=0;A<d.length;A++)L=m.hasOwnProperty("$"+d[A].value),d[A].selected!==L&&(d[A].selected=L),L&&P&&(d[A].defaultSelected=!0)}else{for(A=""+kn(A),m=null,L=0;L<d.length;L++){if(d[L].value===A){d[L].selected=!0,P&&(d[L].defaultSelected=!0);return}m!==null||d[L].disabled||(m=d[L])}m!==null&&(m.selected=!0)}}function Op(d,m,A){if(m!=null&&(m=""+kn(m),m!==d.value&&(d.value=m),A==null)){d.defaultValue!==m&&(d.defaultValue=m);return}d.defaultValue=A!=null?""+kn(A):""}function ac(d,m,A,P){if(m==null){if(P!=null){if(A!=null)throw Error(r(92));if(Ui(P)){if(1<P.length)throw Error(r(93));P=P[0]}A=P}A==null&&(A=""),m=A}A=kn(m),d.defaultValue=A,P=d.textContent,P===A&&P!==""&&P!==null&&(d.value=P),pu(d)}function oc(d,m){if(m){var A=d.firstChild;if(A&&A===d.lastChild&&A.nodeType===3){A.nodeValue=m;return}}d.textContent=m}var Fp=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function wa(d,m,A){var P=m.indexOf("--")===0;A==null||typeof A=="boolean"||A===""?P?d.setProperty(m,""):m==="float"?d.cssFloat="":d[m]="":P?d.setProperty(m,A):typeof A!="number"||A===0||Fp.has(m)?m==="float"?d.cssFloat=A:d[m]=(""+A).trim():d[m]=A+"px"}function nd(d,m,A){if(m!=null&&typeof m!="object")throw Error(r(62));if(d=d.style,A!=null){for(var P in A)!A.hasOwnProperty(P)||m!=null&&m.hasOwnProperty(P)||(P.indexOf("--")===0?d.setProperty(P,""):P==="float"?d.cssFloat="":d[P]="");for(var L in m)P=m[L],m.hasOwnProperty(L)&&A[L]!==P&&wa(d,L,P)}else for(var X in m)m.hasOwnProperty(X)&&wa(d,X,m[X])}function ko(d){if(d.indexOf("-")===-1)return!1;switch(d){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var lc=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),ph=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Qi(d){return ph.test(""+d)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":d}function tl(){}var rd=null;function gh(d){return d=d.target||d.srcElement||window,d.correspondingUseElement&&(d=d.correspondingUseElement),d.nodeType===3?d.parentNode:d}var Ps=null,hs=null;function wr(d){var m=rc(d);if(m&&(d=m.stateNode)){var A=d[ei]||null;e:switch(d=m.stateNode,m.type){case"input":if(pf(d,A.value,A.defaultValue,A.defaultValue,A.checked,A.defaultChecked,A.type,A.name),m=A.name,A.type==="radio"&&m!=null){for(A=d;A.parentNode;)A=A.parentNode;for(A=A.querySelectorAll('input[name="'+Aa(""+m)+'"][type="radio"]'),m=0;m<A.length;m++){var P=A[m];if(P!==d&&P.form===d.form){var L=P[ei]||null;if(!L)throw Error(r(90));pf(P,L.value,L.defaultValue,L.defaultValue,L.checked,L.defaultChecked,L.type,L.name)}}for(m=0;m<A.length;m++)P=A[m],P.form===d.form&&u0(P)}break e;case"textarea":Op(d,A.value,A.defaultValue);break e;case"select":m=A.value,m!=null&&Lc(d,!!A.multiple,m,!1)}}}var Gi=!1;function Wn(d,m,A){if(Gi)return d(m,A);Gi=!0;try{var P=d(m);return P}finally{if(Gi=!1,(Ps!==null||hs!==null)&&($0(),Ps&&(m=Ps,d=hs,hs=Ps=null,wr(m),d)))for(m=0;m<d.length;m++)wr(d[m])}}function fs(d,m){var A=d.stateNode;if(A===null)return null;var P=A[ei]||null;if(P===null)return null;A=P[m];e:switch(m){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(P=!P.disabled)||(d=d.type,P=!(d==="button"||d==="input"||d==="select"||d==="textarea")),d=!P;break e;default:d=!1}if(d)return null;if(A&&typeof A!="function")throw Error(r(231,m,typeof A));return A}var kr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Ta=!1;if(kr)try{var Is={};Object.defineProperty(Is,"passive",{get:function(){Ta=!0}}),window.addEventListener("test",Is,Is),window.removeEventListener("test",Is,Is)}catch{Ta=!1}var oo=null,Do=null,Tr=null;function za(){if(Tr)return Tr;var d,m=Do,A=m.length,P,L="value"in oo?oo.value:oo.textContent,X=L.length;for(d=0;d<A&&m[d]===L[d];d++);var ae=A-d;for(P=1;P<=ae&&m[A-P]===L[X-P];P++);return Tr=L.slice(d,1<P?1-P:void 0)}function lo(d){var m=d.keyCode;return"charCode"in d?(d=d.charCode,d===0&&m===13&&(d=13)):d=m,d===10&&(d=13),32<=d||d===13?d:0}function gu(){return!0}function Sa(){return!1}function bs(d){function m(A,P,L,X,ae){this._reactName=A,this._targetInst=L,this.type=P,this.nativeEvent=X,this.target=ae,this.currentTarget=null;for(var Te in d)d.hasOwnProperty(Te)&&(A=d[Te],this[Te]=A?A(X):X[Te]);return this.isDefaultPrevented=(X.defaultPrevented!=null?X.defaultPrevented:X.returnValue===!1)?gu:Sa,this.isPropagationStopped=Sa,this}return j(m.prototype,{preventDefault:function(){this.defaultPrevented=!0;var A=this.nativeEvent;A&&(A.preventDefault?A.preventDefault():typeof A.returnValue!="unknown"&&(A.returnValue=!1),this.isDefaultPrevented=gu)},stopPropagation:function(){var A=this.nativeEvent;A&&(A.stopPropagation?A.stopPropagation():typeof A.cancelBubble!="unknown"&&(A.cancelBubble=!0),this.isPropagationStopped=gu)},persist:function(){},isPersistent:gu}),m}var Ea={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(d){return d.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},gf=bs(Ea),mu=j({},Ea,{view:0,detail:0}),_u=bs(mu),$n,Uc,fn,Ki=j({},mu,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:xu,button:0,buttons:0,relatedTarget:function(d){return d.relatedTarget===void 0?d.fromElement===d.srcElement?d.toElement:d.fromElement:d.relatedTarget},movementX:function(d){return"movementX"in d?d.movementX:(d!==fn&&(fn&&d.type==="mousemove"?($n=d.screenX-fn.screenX,Uc=d.screenY-fn.screenY):Uc=$n=0,fn=d),$n)},movementY:function(d){return"movementY"in d?d.movementY:Uc}}),yu=bs(Ki),Mn=j({},Ki,{dataTransfer:0}),mh=bs(Mn),Oo=j({},mu,{relatedTarget:0}),Vc=bs(Oo),Ma=j({},Ea,{animationName:0,elapsedTime:0,pseudoElement:0}),Np=bs(Ma),mf=j({},Ea,{clipboardData:function(d){return"clipboardData"in d?d.clipboardData:window.clipboardData}}),xn=bs(mf),_f=j({},Ea,{data:0}),h0=bs(_f),is={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Fo={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Sr={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function vu(d){var m=this.nativeEvent;return m.getModifierState?m.getModifierState(d):(d=Sr[d])?!!m[d]:!1}function xu(){return vu}var _h=j({},mu,{key:function(d){if(d.key){var m=is[d.key]||d.key;if(m!=="Unidentified")return m}return d.type==="keypress"?(d=lo(d),d===13?"Enter":String.fromCharCode(d)):d.type==="keydown"||d.type==="keyup"?Fo[d.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:xu,charCode:function(d){return d.type==="keypress"?lo(d):0},keyCode:function(d){return d.type==="keydown"||d.type==="keyup"?d.keyCode:0},which:function(d){return d.type==="keypress"?lo(d):d.type==="keydown"||d.type==="keyup"?d.keyCode:0}}),Dr=bs(_h),f0=j({},Ki,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),bu=bs(f0),Bp=j({},mu,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:xu}),d0=bs(Bp),ye=j({},Ea,{propertyName:0,elapsedTime:0,pseudoElement:0}),me=bs(ye),Ve=j({},Ki,{deltaX:function(d){return"deltaX"in d?d.deltaX:"wheelDeltaX"in d?-d.wheelDeltaX:0},deltaY:function(d){return"deltaY"in d?d.deltaY:"wheelDeltaY"in d?-d.wheelDeltaY:"wheelDelta"in d?-d.wheelDelta:0},deltaZ:0,deltaMode:0}),Z=bs(Ve),mt=j({},Ea,{newState:0,oldState:0}),c=bs(mt),Re=[9,13,27,32],Ft=kr&&"CompositionEvent"in window,ci=null;kr&&"documentMode"in document&&(ci=document.documentMode);var si=kr&&"TextEvent"in window&&!ci,dt=kr&&(!Ft||ci&&8<ci&&11>=ci),mn=" ",or=!1;function ur(d,m){switch(d){case"keyup":return Re.indexOf(m.keyCode)!==-1;case"keydown":return m.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Us(d){return d=d.detail,typeof d=="object"&&"data"in d?d.data:null}var Or=!1;function La(d,m){switch(d){case"compositionend":return Us(m);case"keypress":return m.which!==32?null:(or=!0,mn);case"textInput":return d=m.data,d===mn&&or?null:d;default:return null}}function jc(d,m){if(Or)return d==="compositionend"||!Ft&&ur(d,m)?(d=za(),Tr=Do=oo=null,Or=!1,d):null;switch(d){case"paste":return null;case"keypress":if(!(m.ctrlKey||m.altKey||m.metaKey)||m.ctrlKey&&m.altKey){if(m.char&&1<m.char.length)return m.char;if(m.which)return String.fromCharCode(m.which)}return null;case"compositionend":return dt&&m.locale!=="ko"?null:m.data;default:return null}}var yf={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function pn(d){var m=d&&d.nodeName&&d.nodeName.toLowerCase();return m==="input"?!!yf[d.type]:m==="textarea"}function No(d,m,A,P){Ps?hs?hs.push(P):hs=[P]:Ps=P,m=ep(m,"onChange"),0<m.length&&(A=new gf("onChange","change",null,A,P),d.push({event:A,listeners:m}))}var ds=null,Ln=null;function Dn(d){q_(d,0)}function Zn(d){var m=wl(d);if(u0(m))return d}function Gc(d,m){if(d==="change")return m}var ir=!1;if(kr){var vf;if(kr){var Au="oninput"in document;if(!Au){var zp=document.createElement("div");zp.setAttribute("oninput","return;"),Au=typeof zp.oninput=="function"}vf=Au}else vf=!1;ir=vf&&(!document.documentMode||9<document.documentMode)}function sd(){ds&&(ds.detachEvent("onpropertychange",Lp),Ln=ds=null)}function Lp(d){if(d.propertyName==="value"&&Zn(Ln)){var m=[];No(m,Ln,d,gh(d)),Wn(Dn,m)}}function Up(d,m,A){d==="focusin"?(sd(),ds=m,Ln=A,ds.attachEvent("onpropertychange",Lp)):d==="focusout"&&sd()}function p0(d){if(d==="selectionchange"||d==="keyup"||d==="keydown")return Zn(Ln)}function Sl(d,m){if(d==="click")return Zn(m)}function Vp(d,m){if(d==="input"||d==="change")return Zn(m)}function ad(d,m){return d===m&&(d!==0||1/d===1/m)||d!==d&&m!==m}var ns=typeof Object.is=="function"?Object.is:ad;function ks(d,m){if(ns(d,m))return!0;if(typeof d!="object"||d===null||typeof m!="object"||m===null)return!1;var A=Object.keys(d),P=Object.keys(m);if(A.length!==P.length)return!1;for(P=0;P<A.length;P++){var L=A[P];if(!Fc.call(m,L)||!ns(d[L],m[L]))return!1}return!0}function co(d){for(;d&&d.firstChild;)d=d.firstChild;return d}function wu(d,m){var A=co(d);d=0;for(var P;A;){if(A.nodeType===3){if(P=d+A.textContent.length,d<=m&&P>=m)return{node:A,offset:m-d};d=P}e:{for(;A;){if(A.nextSibling){A=A.nextSibling;break e}A=A.parentNode}A=void 0}A=co(A)}}function od(d,m){return d&&m?d===m?!0:d&&d.nodeType===3?!1:m&&m.nodeType===3?od(d,m.parentNode):"contains"in d?d.contains(m):d.compareDocumentPosition?!!(d.compareDocumentPosition(m)&16):!1:!1}function g0(d){d=d!=null&&d.ownerDocument!=null&&d.ownerDocument.defaultView!=null?d.ownerDocument.defaultView:window;for(var m=dh(d.document);m instanceof d.HTMLIFrameElement;){try{var A=typeof m.contentWindow.location.href=="string"}catch{A=!1}if(A)d=m.contentWindow;else break;m=dh(d.document)}return m}function ld(d){var m=d&&d.nodeName&&d.nodeName.toLowerCase();return m&&(m==="input"&&(d.type==="text"||d.type==="search"||d.type==="tel"||d.type==="url"||d.type==="password")||m==="textarea"||d.contentEditable==="true")}var cd=kr&&"documentMode"in document&&11>=document.documentMode,il=null,xf=null,bf=null,ud=!1;function m0(d,m,A){var P=A.window===A?A.document:A.nodeType===9?A:A.ownerDocument;ud||il==null||il!==dh(P)||(P=il,"selectionStart"in P&&ld(P)?P={start:P.selectionStart,end:P.selectionEnd}:(P=(P.ownerDocument&&P.ownerDocument.defaultView||window).getSelection(),P={anchorNode:P.anchorNode,anchorOffset:P.anchorOffset,focusNode:P.focusNode,focusOffset:P.focusOffset}),bf&&ks(bf,P)||(bf=P,P=ep(xf,"onSelect"),0<P.length&&(m=new gf("onSelect","select",null,m,A),d.push({event:m,listeners:P}),m.target=il)))}function ee(d,m){var A={};return A[d.toLowerCase()]=m.toLowerCase(),A["Webkit"+d]="webkit"+m,A["Moz"+d]="moz"+m,A}var yh={animationend:ee("Animation","AnimationEnd"),animationiteration:ee("Animation","AnimationIteration"),animationstart:ee("Animation","AnimationStart"),transitionrun:ee("Transition","TransitionRun"),transitionstart:ee("Transition","TransitionStart"),transitioncancel:ee("Transition","TransitionCancel"),transitionend:ee("Transition","TransitionEnd")},jp={},On={};kr&&(On=document.createElement("div").style,"AnimationEvent"in window||(delete yh.animationend.animation,delete yh.animationiteration.animation,delete yh.animationstart.animation),"TransitionEvent"in window||delete yh.transitionend.transition);function El(d){if(jp[d])return jp[d];if(!yh[d])return d;var m=yh[d],A;for(A in m)if(m.hasOwnProperty(A)&&A in On)return jp[d]=m[A];return d}var Af=El("animationend"),wf=El("animationiteration"),hd=El("animationstart"),Tu=El("transitionrun"),Tf=El("transitionstart"),vh=El("transitioncancel"),uo=El("transitionend"),_0=new Map,fd="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");fd.push("scrollEnd");function ho(d,m){_0.set(d,m),En(m,[d])}var Ml=typeof reportError=="function"?reportError:function(d){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var m=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof d=="object"&&d!==null&&typeof d.message=="string"?String(d.message):String(d),error:d});if(!window.dispatchEvent(m))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",d);return}console.error(d)},Ra=[],nl=0,Su=0;function xh(){for(var d=nl,m=Su=nl=0;m<d;){var A=Ra[m];Ra[m++]=null;var P=Ra[m];Ra[m++]=null;var L=Ra[m];Ra[m++]=null;var X=Ra[m];if(Ra[m++]=null,P!==null&&L!==null){var ae=P.pending;ae===null?L.next=L:(L.next=ae.next,ae.next=L),P.pending=L}X!==0&&y0(A,L,X)}}function Sf(d,m,A,P){Ra[nl++]=d,Ra[nl++]=m,Ra[nl++]=A,Ra[nl++]=P,Su|=P,d.lanes|=P,d=d.alternate,d!==null&&(d.lanes|=P)}function Wc(d,m,A,P){return Sf(d,m,A,P),an(d)}function Bo(d,m){return Sf(d,null,null,m),an(d)}function y0(d,m,A){d.lanes|=A;var P=d.alternate;P!==null&&(P.lanes|=A);for(var L=!1,X=d.return;X!==null;)X.childLanes|=A,P=X.alternate,P!==null&&(P.childLanes|=A),X.tag===22&&(d=X.stateNode,d===null||d._visibility&1||(L=!0)),d=X,X=X.return;return d.tag===3?(X=d.stateNode,L&&m!==null&&(L=31-st(A),d=X.hiddenUpdates,P=d[L],P===null?d[L]=[m]:P.push(m),m.lane=A|536870912),X):null}function an(d){if(50<H0)throw H0=0,Bd=null,Error(r(185));for(var m=d.return;m!==null;)d=m,m=d.return;return d.tag===3?d.stateNode:null}var tn={};function dd(d,m,A,P){this.tag=d,this.key=A,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=m,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=P,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ca(d,m,A,P){return new dd(d,m,A,P)}function pd(d){return d=d.prototype,!(!d||!d.isReactComponent)}function fo(d,m){var A=d.alternate;return A===null?(A=Ca(d.tag,m,d.key,d.mode),A.elementType=d.elementType,A.type=d.type,A.stateNode=d.stateNode,A.alternate=d,d.alternate=A):(A.pendingProps=m,A.type=d.type,A.flags=0,A.subtreeFlags=0,A.deletions=null),A.flags=d.flags&65011712,A.childLanes=d.childLanes,A.lanes=d.lanes,A.child=d.child,A.memoizedProps=d.memoizedProps,A.memoizedState=d.memoizedState,A.updateQueue=d.updateQueue,m=d.dependencies,A.dependencies=m===null?null:{lanes:m.lanes,firstContext:m.firstContext},A.sibling=d.sibling,A.index=d.index,A.ref=d.ref,A.refCleanup=d.refCleanup,A}function Gp(d,m){d.flags&=65011714;var A=d.alternate;return A===null?(d.childLanes=0,d.lanes=m,d.child=null,d.subtreeFlags=0,d.memoizedProps=null,d.memoizedState=null,d.updateQueue=null,d.dependencies=null,d.stateNode=null):(d.childLanes=A.childLanes,d.lanes=A.lanes,d.child=A.child,d.subtreeFlags=0,d.deletions=null,d.memoizedProps=A.memoizedProps,d.memoizedState=A.memoizedState,d.updateQueue=A.updateQueue,d.type=A.type,m=A.dependencies,d.dependencies=m===null?null:{lanes:m.lanes,firstContext:m.firstContext}),d}function gd(d,m,A,P,L,X){var ae=0;if(P=d,typeof d=="function")pd(d)&&(ae=1);else if(typeof d=="string")ae=op(d,A,Si.current)?26:d==="html"||d==="head"||d==="body"?27:5;else e:switch(d){case Xt:return d=Ca(31,A,m,L),d.elementType=Xt,d.lanes=X,d;case Ae:return Zc(A.children,L,X,m);case he:ae=8,L|=24;break;case Le:return d=Ca(12,A,m,L|2),d.elementType=Le,d.lanes=X,d;case Rt:return d=Ca(13,A,m,L),d.elementType=Rt,d.lanes=X,d;case Et:return d=Ca(19,A,m,L),d.elementType=Et,d.lanes=X,d;default:if(typeof d=="object"&&d!==null)switch(d.$$typeof){case Be:ae=10;break e;case $e:ae=9;break e;case Je:ae=11;break e;case kt:ae=14;break e;case Ht:ae=16,P=null;break e}ae=29,A=Error(r(130,d===null?"null":typeof d,"")),P=null}return m=Ca(ae,A,m,L),m.elementType=d,m.type=P,m.lanes=X,m}function Zc(d,m,A,P){return d=Ca(7,d,P,m),d.lanes=A,d}function v0(d,m,A){return d=Ca(6,d,null,m),d.lanes=A,d}function Eu(d){var m=Ca(18,null,null,0);return m.stateNode=d,m}function Rl(d,m,A){return m=Ca(4,d.children!==null?d.children:[],d.key,m),m.lanes=A,m.stateNode={containerInfo:d.containerInfo,pendingChildren:null,implementation:d.implementation},m}var Mu=new WeakMap;function Pa(d,m){if(typeof d=="object"&&d!==null){var A=Mu.get(d);return A!==void 0?A:(m={value:d,source:m,stack:xl(m)},Mu.set(d,m),m)}return{value:d,source:m,stack:xl(m)}}var cc=[],Xc=0,Ru=null,rl=0,As=[],Vs=0,sl=null,Cl=1,Ua="";function Ia(d,m){cc[Xc++]=rl,cc[Xc++]=Ru,Ru=d,rl=m}function uc(d,m,A){As[Vs++]=Cl,As[Vs++]=Ua,As[Vs++]=sl,sl=d;var P=Cl;d=Ua;var L=32-st(P)-1;P&=~(1<<L),A+=1;var X=32-st(m)+L;if(30<X){var ae=L-L%5;X=(P&(1<<ae)-1).toString(32),P>>=ae,L-=ae,Cl=1<<32-st(m)+L|A<<L|P,Ua=X+d}else Cl=1<<X|A<<L|P,Ua=d}function Cu(d){d.return!==null&&(Ia(d,1),uc(d,1,0))}function Pl(d){for(;d===Ru;)Ru=cc[--Xc],cc[Xc]=null,rl=cc[--Xc],cc[Xc]=null;for(;d===sl;)sl=As[--Vs],As[Vs]=null,Ua=As[--Vs],As[Vs]=null,Cl=As[--Vs],As[Vs]=null}function x0(d,m){As[Vs++]=Cl,As[Vs++]=Ua,As[Vs++]=sl,Cl=m.id,Ua=m.overflow,sl=d}var js=null,nr=null,bn=!1,al=null,po=!1,Fr=Error(r(519));function Va(d){var m=Error(r(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw hc(Pa(m,d)),Fr}function ja(d){var m=d.stateNode,A=d.type,P=d.memoizedProps;switch(m[vn]=d,m[ei]=P,A){case"dialog":In("cancel",m),In("close",m);break;case"iframe":case"object":case"embed":In("load",m);break;case"video":case"audio":for(A=0;A<Zh.length;A++)In(Zh[A],m);break;case"source":In("error",m);break;case"img":case"image":case"link":In("error",m),In("load",m);break;case"details":In("toggle",m);break;case"input":In("invalid",m),id(m,P.value,P.defaultValue,P.checked,P.defaultChecked,P.type,P.name,!0);break;case"select":In("invalid",m);break;case"textarea":In("invalid",m),ac(m,P.value,P.defaultValue,P.children)}A=P.children,typeof A!="string"&&typeof A!="number"&&typeof A!="bigint"||m.textContent===""+A||P.suppressHydrationWarning===!0||km(m.textContent,A)?(P.popover!=null&&(In("beforetoggle",m),In("toggle",m)),P.onScroll!=null&&In("scroll",m),P.onScrollEnd!=null&&In("scrollend",m),P.onClick!=null&&(m.onclick=tl),m=!0):m=!1,m||Va(d,!0)}function Il(d){for(js=d.return;js;)switch(js.tag){case 5:case 31:case 13:po=!1;return;case 27:case 3:po=!0;return;default:js=js.return}}function kl(d){if(d!==js)return!1;if(!bn)return Il(d),bn=!0,!1;var m=d.tag,A;if((A=m!==3&&m!==27)&&((A=m===5)&&(A=d.type,A=!(A!=="form"&&A!=="button")||vg(d.type,d.memoizedProps)),A=!A),A&&nr&&Va(d),Il(d),m===13){if(d=d.memoizedState,d=d!==null?d.dehydrated:null,!d)throw Error(r(317));nr=qs(d)}else if(m===31){if(d=d.memoizedState,d=d!==null?d.dehydrated:null,!d)throw Error(r(317));nr=qs(d)}else m===27?(m=nr,$u(d.type)?(d=qa,qa=null,nr=d):nr=m):nr=js?ml(d.stateNode.nextSibling):null;return!0}function Ga(){nr=js=null,bn=!1}function Dl(){var d=al;return d!==null&&(Xo===null?Xo=d:Xo.push.apply(Xo,d),al=null),d}function hc(d){al===null?al=[d]:al.push(d)}var fc=Ye(null),zo=null,Lo=null;function Ol(d,m,A){vi(fc,m._currentValue),m._currentValue=A}function Fl(d){d._currentValue=fc.current,Gt(fc)}function md(d,m,A){for(;d!==null;){var P=d.alternate;if((d.childLanes&m)!==m?(d.childLanes|=m,P!==null&&(P.childLanes|=m)):P!==null&&(P.childLanes&m)!==m&&(P.childLanes|=m),d===A)break;d=d.return}}function _d(d,m,A,P){var L=d.child;for(L!==null&&(L.return=d);L!==null;){var X=L.dependencies;if(X!==null){var ae=L.child;X=X.firstContext;e:for(;X!==null;){var Te=X;X=L;for(var qe=0;qe<m.length;qe++)if(Te.context===m[qe]){X.lanes|=A,Te=X.alternate,Te!==null&&(Te.lanes|=A),md(X.return,A,d),P||(ae=null);break e}X=Te.next}}else if(L.tag===18){if(ae=L.return,ae===null)throw Error(r(341));ae.lanes|=A,X=ae.alternate,X!==null&&(X.lanes|=A),md(ae,A,d),ae=null}else ae=L.child;if(ae!==null)ae.return=L;else for(ae=L;ae!==null;){if(ae===d){ae=null;break}if(L=ae.sibling,L!==null){L.return=ae.return,ae=L;break}ae=ae.return}L=ae}}function go(d,m,A,P){d=null;for(var L=m,X=!1;L!==null;){if(!X){if((L.flags&524288)!==0)X=!0;else if((L.flags&262144)!==0)break}if(L.tag===10){var ae=L.alternate;if(ae===null)throw Error(r(387));if(ae=ae.memoizedProps,ae!==null){var Te=L.type;ns(L.pendingProps.value,ae.value)||(d!==null?d.push(Te):d=[Te])}}else if(L===yn.current){if(ae=L.alternate,ae===null)throw Error(r(387));ae.memoizedState.memoizedState!==L.memoizedState.memoizedState&&(d!==null?d.push(qd):d=[qd])}L=L.return}d!==null&&_d(m,d,A,P),m.flags|=262144}function bh(d){for(d=d.firstContext;d!==null;){if(!ns(d.context._currentValue,d.memoizedValue))return!0;d=d.next}return!1}function dc(d){zo=d,Lo=null,d=d.dependencies,d!==null&&(d.firstContext=null)}function ps(d){return yd(zo,d)}function Ef(d,m){return zo===null&&dc(d),yd(d,m)}function yd(d,m){var A=m._currentValue;if(m={context:m,memoizedValue:A,next:null},Lo===null){if(d===null)throw Error(r(308));Lo=m,d.dependencies={lanes:0,firstContext:m},d.flags|=524288}else Lo=Lo.next=m;return A}var b0=typeof AbortController<"u"?AbortController:function(){var d=[],m=this.signal={aborted:!1,addEventListener:function(A,P){d.push(P)}};this.abort=function(){m.aborted=!0,d.forEach(function(A){return A()})}},Wp=i.unstable_scheduleCallback,A0=i.unstable_NormalPriority,rs={$$typeof:Be,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Nl(){return{controller:new b0,data:new Map,refCount:0}}function Ah(d){d.refCount--,d.refCount===0&&Wp(A0,function(){d.controller.abort()})}var oa=null,mo=0,Pu=0,la=null;function tm(d,m){if(oa===null){var A=oa=[];mo=0,Pu=K0(),la={status:"pending",value:void 0,then:function(P){A.push(P)}}}return mo++,m.then(pc,pc),m}function pc(){if(--mo===0&&oa!==null){la!==null&&(la.status="fulfilled");var d=oa;oa=null,Pu=0,la=null;for(var m=0;m<d.length;m++)(0,d[m])()}}function Mf(d,m){var A=[],P={status:"pending",value:null,reason:null,then:function(L){A.push(L)}};return d.then(function(){P.status="fulfilled",P.value=m;for(var L=0;L<A.length;L++)(0,A[L])(m)},function(L){for(P.status="rejected",P.reason=L,L=0;L<A.length;L++)(0,A[L])(void 0)}),P}var Ds=nt.S;nt.S=function(d,m){N_=Qr(),typeof m=="object"&&m!==null&&typeof m.then=="function"&&tm(d,m),Ds!==null&&Ds(d,m)};var ol=Ye(null);function vd(){var d=ol.current;return d!==null?d:Rr.pooledCache}function xd(d,m){m===null?vi(ol,ol.current):vi(ol,m.pool)}function Zp(){var d=vd();return d===null?null:{parent:rs._currentValue,pool:d}}var ll=Error(r(460)),gc=Error(r(474)),Wa=Error(r(542)),yi={then:function(){}};function wh(d){return d=d.status,d==="fulfilled"||d==="rejected"}function Hc(d,m,A){switch(A=d[A],A===void 0?d.push(m):A!==m&&(m.then(tl,tl),m=A),m.status){case"fulfilled":return m.value;case"rejected":throw d=m.reason,bd(d),d;default:if(typeof m.status=="string")m.then(tl,tl);else{if(d=Rr,d!==null&&100<d.shellSuspendCounter)throw Error(r(482));d=m,d.status="pending",d.then(function(P){if(m.status==="pending"){var L=m;L.status="fulfilled",L.value=P}},function(P){if(m.status==="pending"){var L=m;L.status="rejected",L.reason=P}})}switch(m.status){case"fulfilled":return m.value;case"rejected":throw d=m.reason,bd(d),d}throw cl=m,ll}}function Uo(d){try{var m=d._init;return m(d._payload)}catch(A){throw A!==null&&typeof A=="object"&&typeof A.then=="function"?(cl=A,ll):A}}var cl=null;function Th(){if(cl===null)throw Error(r(459));var d=cl;return cl=null,d}function bd(d){if(d===ll||d===Wa)throw Error(r(483))}var Bl=null,Iu=0;function Rf(d){var m=Iu;return Iu+=1,Bl===null&&(Bl=[]),Hc(Bl,d,m)}function zl(d,m){m=m.props.ref,d.ref=m!==void 0?m:null}function Sh(d,m){throw m.$$typeof===$?Error(r(525)):(d=Object.prototype.toString.call(m),Error(r(31,d==="[object Object]"?"object with keys {"+Object.keys(m).join(", ")+"}":d)))}function Eh(d){function m(ft,tt){if(d){var Tt=ft.deletions;Tt===null?(ft.deletions=[tt],ft.flags|=16):Tt.push(tt)}}function A(ft,tt){if(!d)return null;for(;tt!==null;)m(ft,tt),tt=tt.sibling;return null}function P(ft){for(var tt=new Map;ft!==null;)ft.key!==null?tt.set(ft.key,ft):tt.set(ft.index,ft),ft=ft.sibling;return tt}function L(ft,tt){return ft=fo(ft,tt),ft.index=0,ft.sibling=null,ft}function X(ft,tt,Tt){return ft.index=Tt,d?(Tt=ft.alternate,Tt!==null?(Tt=Tt.index,Tt<tt?(ft.flags|=67108866,tt):Tt):(ft.flags|=67108866,tt)):(ft.flags|=1048576,tt)}function ae(ft){return d&&ft.alternate===null&&(ft.flags|=67108866),ft}function Te(ft,tt,Tt,Zt){return tt===null||tt.tag!==6?(tt=v0(Tt,ft.mode,Zt),tt.return=ft,tt):(tt=L(tt,Tt),tt.return=ft,tt)}function qe(ft,tt,Tt,Zt){var Zi=Tt.type;return Zi===Ae?Lt(ft,tt,Tt.props.children,Zt,Tt.key):tt!==null&&(tt.elementType===Zi||typeof Zi=="object"&&Zi!==null&&Zi.$$typeof===Ht&&Uo(Zi)===tt.type)?(tt=L(tt,Tt.props),zl(tt,Tt),tt.return=ft,tt):(tt=gd(Tt.type,Tt.key,Tt.props,null,ft.mode,Zt),zl(tt,Tt),tt.return=ft,tt)}function wt(ft,tt,Tt,Zt){return tt===null||tt.tag!==4||tt.stateNode.containerInfo!==Tt.containerInfo||tt.stateNode.implementation!==Tt.implementation?(tt=Rl(Tt,ft.mode,Zt),tt.return=ft,tt):(tt=L(tt,Tt.children||[]),tt.return=ft,tt)}function Lt(ft,tt,Tt,Zt,Zi){return tt===null||tt.tag!==7?(tt=Zc(Tt,ft.mode,Zt,Zi),tt.return=ft,tt):(tt=L(tt,Tt),tt.return=ft,tt)}function $t(ft,tt,Tt){if(typeof tt=="string"&&tt!==""||typeof tt=="number"||typeof tt=="bigint")return tt=v0(""+tt,ft.mode,Tt),tt.return=ft,tt;if(typeof tt=="object"&&tt!==null){switch(tt.$$typeof){case se:return Tt=gd(tt.type,tt.key,tt.props,null,ft.mode,Tt),zl(Tt,tt),Tt.return=ft,Tt;case de:return tt=Rl(tt,ft.mode,Tt),tt.return=ft,tt;case Ht:return tt=Uo(tt),$t(ft,tt,Tt)}if(Ui(tt)||Ei(tt))return tt=Zc(tt,ft.mode,Tt,null),tt.return=ft,tt;if(typeof tt.then=="function")return $t(ft,Rf(tt),Tt);if(tt.$$typeof===Be)return $t(ft,Ef(ft,tt),Tt);Sh(ft,tt)}return null}function It(ft,tt,Tt,Zt){var Zi=tt!==null?tt.key:null;if(typeof Tt=="string"&&Tt!==""||typeof Tt=="number"||typeof Tt=="bigint")return Zi!==null?null:Te(ft,tt,""+Tt,Zt);if(typeof Tt=="object"&&Tt!==null){switch(Tt.$$typeof){case se:return Tt.key===Zi?qe(ft,tt,Tt,Zt):null;case de:return Tt.key===Zi?wt(ft,tt,Tt,Zt):null;case Ht:return Tt=Uo(Tt),It(ft,tt,Tt,Zt)}if(Ui(Tt)||Ei(Tt))return Zi!==null?null:Lt(ft,tt,Tt,Zt,null);if(typeof Tt.then=="function")return It(ft,tt,Rf(Tt),Zt);if(Tt.$$typeof===Be)return It(ft,tt,Ef(ft,Tt),Zt);Sh(ft,Tt)}return null}function Nt(ft,tt,Tt,Zt,Zi){if(typeof Zt=="string"&&Zt!==""||typeof Zt=="number"||typeof Zt=="bigint")return ft=ft.get(Tt)||null,Te(tt,ft,""+Zt,Zi);if(typeof Zt=="object"&&Zt!==null){switch(Zt.$$typeof){case se:return ft=ft.get(Zt.key===null?Tt:Zt.key)||null,qe(tt,ft,Zt,Zi);case de:return ft=ft.get(Zt.key===null?Tt:Zt.key)||null,wt(tt,ft,Zt,Zi);case Ht:return Zt=Uo(Zt),Nt(ft,tt,Tt,Zt,Zi)}if(Ui(Zt)||Ei(Zt))return ft=ft.get(Tt)||null,Lt(tt,ft,Zt,Zi,null);if(typeof Zt.then=="function")return Nt(ft,tt,Tt,Rf(Zt),Zi);if(Zt.$$typeof===Be)return Nt(ft,tt,Tt,Ef(tt,Zt),Zi);Sh(tt,Zt)}return null}function Fi(ft,tt,Tt,Zt){for(var Zi=null,Qn=null,Ni=tt,ji=tt=0,An=null;Ni!==null&&ji<Tt.length;ji++){Ni.index>ji?(An=Ni,Ni=null):An=Ni.sibling;var Gn=It(ft,Ni,Tt[ji],Zt);if(Gn===null){Ni===null&&(Ni=An);break}d&&Ni&&Gn.alternate===null&&m(ft,Ni),tt=X(Gn,tt,ji),Qn===null?Zi=Gn:Qn.sibling=Gn,Qn=Gn,Ni=An}if(ji===Tt.length)return A(ft,Ni),bn&&Ia(ft,ji),Zi;if(Ni===null){for(;ji<Tt.length;ji++)Ni=$t(ft,Tt[ji],Zt),Ni!==null&&(tt=X(Ni,tt,ji),Qn===null?Zi=Ni:Qn.sibling=Ni,Qn=Ni);return bn&&Ia(ft,ji),Zi}for(Ni=P(Ni);ji<Tt.length;ji++)An=Nt(Ni,ft,ji,Tt[ji],Zt),An!==null&&(d&&An.alternate!==null&&Ni.delete(An.key===null?ji:An.key),tt=X(An,tt,ji),Qn===null?Zi=An:Qn.sibling=An,Qn=An);return d&&Ni.forEach(function(Pc){return m(ft,Pc)}),bn&&Ia(ft,ji),Zi}function Hi(ft,tt,Tt,Zt){if(Tt==null)throw Error(r(151));for(var Zi=null,Qn=null,Ni=tt,ji=tt=0,An=null,Gn=Tt.next();Ni!==null&&!Gn.done;ji++,Gn=Tt.next()){Ni.index>ji?(An=Ni,Ni=null):An=Ni.sibling;var Pc=It(ft,Ni,Gn.value,Zt);if(Pc===null){Ni===null&&(Ni=An);break}d&&Ni&&Pc.alternate===null&&m(ft,Ni),tt=X(Pc,tt,ji),Qn===null?Zi=Pc:Qn.sibling=Pc,Qn=Pc,Ni=An}if(Gn.done)return A(ft,Ni),bn&&Ia(ft,ji),Zi;if(Ni===null){for(;!Gn.done;ji++,Gn=Tt.next())Gn=$t(ft,Gn.value,Zt),Gn!==null&&(tt=X(Gn,tt,ji),Qn===null?Zi=Gn:Qn.sibling=Gn,Qn=Gn);return bn&&Ia(ft,ji),Zi}for(Ni=P(Ni);!Gn.done;ji++,Gn=Tt.next())Gn=Nt(Ni,ft,ji,Gn.value,Zt),Gn!==null&&(d&&Gn.alternate!==null&&Ni.delete(Gn.key===null?ji:Gn.key),tt=X(Gn,tt,ji),Qn===null?Zi=Gn:Qn.sibling=Gn,Qn=Gn);return d&&Ni.forEach(function(Qm){return m(ft,Qm)}),bn&&Ia(ft,ji),Zi}function dr(ft,tt,Tt,Zt){if(typeof Tt=="object"&&Tt!==null&&Tt.type===Ae&&Tt.key===null&&(Tt=Tt.props.children),typeof Tt=="object"&&Tt!==null){switch(Tt.$$typeof){case se:e:{for(var Zi=Tt.key;tt!==null;){if(tt.key===Zi){if(Zi=Tt.type,Zi===Ae){if(tt.tag===7){A(ft,tt.sibling),Zt=L(tt,Tt.props.children),Zt.return=ft,ft=Zt;break e}}else if(tt.elementType===Zi||typeof Zi=="object"&&Zi!==null&&Zi.$$typeof===Ht&&Uo(Zi)===tt.type){A(ft,tt.sibling),Zt=L(tt,Tt.props),zl(Zt,Tt),Zt.return=ft,ft=Zt;break e}A(ft,tt);break}else m(ft,tt);tt=tt.sibling}Tt.type===Ae?(Zt=Zc(Tt.props.children,ft.mode,Zt,Tt.key),Zt.return=ft,ft=Zt):(Zt=gd(Tt.type,Tt.key,Tt.props,null,ft.mode,Zt),zl(Zt,Tt),Zt.return=ft,ft=Zt)}return ae(ft);case de:e:{for(Zi=Tt.key;tt!==null;){if(tt.key===Zi)if(tt.tag===4&&tt.stateNode.containerInfo===Tt.containerInfo&&tt.stateNode.implementation===Tt.implementation){A(ft,tt.sibling),Zt=L(tt,Tt.children||[]),Zt.return=ft,ft=Zt;break e}else{A(ft,tt);break}else m(ft,tt);tt=tt.sibling}Zt=Rl(Tt,ft.mode,Zt),Zt.return=ft,ft=Zt}return ae(ft);case Ht:return Tt=Uo(Tt),dr(ft,tt,Tt,Zt)}if(Ui(Tt))return Fi(ft,tt,Tt,Zt);if(Ei(Tt)){if(Zi=Ei(Tt),typeof Zi!="function")throw Error(r(150));return Tt=Zi.call(Tt),Hi(ft,tt,Tt,Zt)}if(typeof Tt.then=="function")return dr(ft,tt,Rf(Tt),Zt);if(Tt.$$typeof===Be)return dr(ft,tt,Ef(ft,Tt),Zt);Sh(ft,Tt)}return typeof Tt=="string"&&Tt!==""||typeof Tt=="number"||typeof Tt=="bigint"?(Tt=""+Tt,tt!==null&&tt.tag===6?(A(ft,tt.sibling),Zt=L(tt,Tt),Zt.return=ft,ft=Zt):(A(ft,tt),Zt=v0(Tt,ft.mode,Zt),Zt.return=ft,ft=Zt),ae(ft)):A(ft,tt)}return function(ft,tt,Tt,Zt){try{Iu=0;var Zi=dr(ft,tt,Tt,Zt);return Bl=null,Zi}catch(Ni){if(Ni===ll||Ni===Wa)throw Ni;var Qn=Ca(29,Ni,null,ft.mode);return Qn.lanes=Zt,Qn.return=ft,Qn}finally{}}}var Ll=Eh(!0),w0=Eh(!1),ul=!1;function ca(d){d.updateQueue={baseState:d.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function ku(d,m){d=d.updateQueue,m.updateQueue===d&&(m.updateQueue={baseState:d.baseState,firstBaseUpdate:d.firstBaseUpdate,lastBaseUpdate:d.lastBaseUpdate,shared:d.shared,callbacks:null})}function ss(d){return{lane:d,tag:0,payload:null,callback:null,next:null}}function Nr(d,m,A){var P=d.updateQueue;if(P===null)return null;if(P=P.shared,(Rn&2)!==0){var L=P.pending;return L===null?m.next=m:(m.next=L.next,L.next=m),P.pending=m,m=an(d),y0(d,null,A),m}return Sf(d,P,m,A),an(d)}function Br(d,m,A){if(m=m.updateQueue,m!==null&&(m=m.shared,(A&4194048)!==0)){var P=m.lanes;P&=d.pendingLanes,A|=P,m.lanes=A,es(d,A)}}function Un(d,m){var A=d.updateQueue,P=d.alternate;if(P!==null&&(P=P.updateQueue,A===P)){var L=null,X=null;if(A=A.firstBaseUpdate,A!==null){do{var ae={lane:A.lane,tag:A.tag,payload:A.payload,callback:null,next:null};X===null?L=X=ae:X=X.next=ae,A=A.next}while(A!==null);X===null?L=X=m:X=X.next=m}else L=X=m;A={baseState:P.baseState,firstBaseUpdate:L,lastBaseUpdate:X,shared:P.shared,callbacks:P.callbacks},d.updateQueue=A;return}d=A.lastBaseUpdate,d===null?A.firstBaseUpdate=m:d.next=m,A.lastBaseUpdate=m}var T0=!1;function mc(){if(T0){var d=la;if(d!==null)throw d}}function $c(d,m,A,P){T0=!1;var L=d.updateQueue;ul=!1;var X=L.firstBaseUpdate,ae=L.lastBaseUpdate,Te=L.shared.pending;if(Te!==null){L.shared.pending=null;var qe=Te,wt=qe.next;qe.next=null,ae===null?X=wt:ae.next=wt,ae=qe;var Lt=d.alternate;Lt!==null&&(Lt=Lt.updateQueue,Te=Lt.lastBaseUpdate,Te!==ae&&(Te===null?Lt.firstBaseUpdate=wt:Te.next=wt,Lt.lastBaseUpdate=qe))}if(X!==null){var $t=L.baseState;ae=0,Lt=wt=qe=null,Te=X;do{var It=Te.lane&-536870913,Nt=It!==Te.lane;if(Nt?(hn&It)===It:(P&It)===It){It!==0&&It===Pu&&(T0=!0),Lt!==null&&(Lt=Lt.next={lane:0,tag:Te.tag,payload:Te.payload,callback:null,next:null});e:{var Fi=d,Hi=Te;It=m;var dr=A;switch(Hi.tag){case 1:if(Fi=Hi.payload,typeof Fi=="function"){$t=Fi.call(dr,$t,It);break e}$t=Fi;break e;case 3:Fi.flags=Fi.flags&-65537|128;case 0:if(Fi=Hi.payload,It=typeof Fi=="function"?Fi.call(dr,$t,It):Fi,It==null)break e;$t=j({},$t,It);break e;case 2:ul=!0}}It=Te.callback,It!==null&&(d.flags|=64,Nt&&(d.flags|=8192),Nt=L.callbacks,Nt===null?L.callbacks=[It]:Nt.push(It))}else Nt={lane:It,tag:Te.tag,payload:Te.payload,callback:Te.callback,next:null},Lt===null?(wt=Lt=Nt,qe=$t):Lt=Lt.next=Nt,ae|=It;if(Te=Te.next,Te===null){if(Te=L.shared.pending,Te===null)break;Nt=Te,Te=Nt.next,Nt.next=null,L.lastBaseUpdate=Nt,L.shared.pending=null}}while(!0);Lt===null&&(qe=$t),L.baseState=qe,L.firstBaseUpdate=wt,L.lastBaseUpdate=Lt,X===null&&(L.shared.lanes=0),Vu|=ae,d.lanes=ae,d.memoizedState=$t}}function Cf(d,m){if(typeof d!="function")throw Error(r(191,d));d.call(m)}function Ad(d,m){var A=d.callbacks;if(A!==null)for(d.callbacks=null,d=0;d<A.length;d++)Cf(A[d],m)}var Du=Ye(null),Pf=Ye(0);function S0(d,m){d=Uu,vi(Pf,d),vi(Du,m),Uu=d|m.baseLanes}function _o(){vi(Pf,Uu),vi(Du,Du.current)}function Ou(){Uu=Pf.current,Gt(Du),Gt(Pf)}var xi=Ye(null),Mi=null;function Vo(d){var m=d.alternate;vi(hr,hr.current&1),vi(xi,d),Mi===null&&(m===null||Du.current!==null||m.memoizedState!==null)&&(Mi=d)}function Mh(d){vi(hr,hr.current),vi(xi,d),Mi===null&&(Mi=d)}function Rh(d){d.tag===22?(vi(hr,hr.current),vi(xi,d),Mi===null&&(Mi=d)):Er()}function Er(){vi(hr,hr.current),vi(xi,xi.current)}function rn(d){Gt(xi),Mi===d&&(Mi=null),Gt(hr)}var hr=Ye(0);function Ch(d){for(var m=d;m!==null;){if(m.tag===13){var A=m.memoizedState;if(A!==null&&(A=A.dehydrated,A===null||$a(A)||Ms(A)))return m}else if(m.tag===19&&(m.memoizedProps.revealOrder==="forwards"||m.memoizedProps.revealOrder==="backwards"||m.memoizedProps.revealOrder==="unstable_legacy-backwards"||m.memoizedProps.revealOrder==="together")){if((m.flags&128)!==0)return m}else if(m.child!==null){m.child.return=m,m=m.child;continue}if(m===d)break;for(;m.sibling===null;){if(m.return===null||m.return===d)return null;m=m.return}m.sibling.return=m.return,m=m.sibling}return null}var _c=0,un=null,Vn=null,zi=null,_r=!1,yo=!1,Za=!1,qc=0,Yc=0,Ul=null,wd=0;function lr(){throw Error(r(321))}function vo(d,m){if(m===null)return!1;for(var A=0;A<m.length&&A<d.length;A++)if(!ns(d[A],m[A]))return!1;return!0}function Ph(d,m,A,P,L,X){return _c=X,un=m,m.memoizedState=null,m.updateQueue=null,m.lanes=0,nt.H=d===null||d.memoizedState===null?ar:gs,Za=!1,X=A(P,L),Za=!1,yo&&(X=Ih(m,A,P,L)),Zr(d),X}function Zr(d){nt.H=Xn;var m=Vn!==null&&Vn.next!==null;if(_c=0,zi=Vn=un=null,_r=!1,Yc=0,Ul=null,m)throw Error(r(300));d===null||Ws||(d=d.dependencies,d!==null&&bh(d)&&(Ws=!0))}function Ih(d,m,A,P){un=d;var L=0;do{if(yo&&(Ul=null),Yc=0,yo=!1,25<=L)throw Error(r(301));if(L+=1,zi=Vn=null,d.updateQueue!=null){var X=d.updateQueue;X.lastEffect=null,X.events=null,X.stores=null,X.memoCache!=null&&(X.memoCache.index=0)}nt.H=Ts,X=m(A,P)}while(yo);return X}function If(){var d=nt.H,m=d.useState()[0];return m=typeof m.then=="function"?Fu(m):m,d=d.useState()[0],(Vn!==null?Vn.memoizedState:null)!==d&&(un.flags|=1024),m}function Jc(){var d=qc!==0;return qc=0,d}function Vl(d,m,A){m.updateQueue=d.updateQueue,m.flags&=-2053,d.lanes&=~A}function jl(d){if(_r){for(d=d.memoizedState;d!==null;){var m=d.queue;m!==null&&(m.pending=null),d=d.next}_r=!1}_c=0,zi=Vn=un=null,yo=!1,Yc=qc=0,Ul=null}function ea(){var d={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return zi===null?un.memoizedState=zi=d:zi=zi.next=d,zi}function Mr(){if(Vn===null){var d=un.alternate;d=d!==null?d.memoizedState:null}else d=Vn.next;var m=zi===null?un.memoizedState:zi.next;if(m!==null)zi=m,Vn=d;else{if(d===null)throw un.alternate===null?Error(r(467)):Error(r(310));Vn=d,d={memoizedState:Vn.memoizedState,baseState:Vn.baseState,baseQueue:Vn.baseQueue,queue:Vn.queue,next:null},zi===null?un.memoizedState=zi=d:zi=zi.next=d}return zi}function Gl(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Fu(d){var m=Yc;return Yc+=1,Ul===null&&(Ul=[]),d=Hc(Ul,d,m),m=un,(zi===null?m.memoizedState:zi.next)===null&&(m=m.alternate,nt.H=m===null||m.memoizedState===null?ar:gs),d}function Nu(d){if(d!==null&&typeof d=="object"){if(typeof d.then=="function")return Fu(d);if(d.$$typeof===Be)return ps(d)}throw Error(r(438,String(d)))}function kh(d){var m=null,A=un.updateQueue;if(A!==null&&(m=A.memoCache),m==null){var P=un.alternate;P!==null&&(P=P.updateQueue,P!==null&&(P=P.memoCache,P!=null&&(m={data:P.data.map(function(L){return L.slice()}),index:0})))}if(m==null&&(m={data:[],index:0}),A===null&&(A=Gl(),un.updateQueue=A),A.memoCache=m,A=m.data[m.index],A===void 0)for(A=m.data[m.index]=Array(d),P=0;P<d;P++)A[P]=hi;return m.index++,A}function hl(d,m){return typeof m=="function"?m(d):m}function C(d){var m=Mr();return s(m,Vn,d)}function s(d,m,A){var P=d.queue;if(P===null)throw Error(r(311));P.lastRenderedReducer=A;var L=d.baseQueue,X=P.pending;if(X!==null){if(L!==null){var ae=L.next;L.next=X.next,X.next=ae}m.baseQueue=L=X,P.pending=null}if(X=d.baseState,L===null)d.memoizedState=X;else{m=L.next;var Te=ae=null,qe=null,wt=m,Lt=!1;do{var $t=wt.lane&-536870913;if($t!==wt.lane?(hn&$t)===$t:(_c&$t)===$t){var It=wt.revertLane;if(It===0)qe!==null&&(qe=qe.next={lane:0,revertLane:0,gesture:null,action:wt.action,hasEagerState:wt.hasEagerState,eagerState:wt.eagerState,next:null}),$t===Pu&&(Lt=!0);else if((_c&It)===It){wt=wt.next,It===Pu&&(Lt=!0);continue}else $t={lane:0,revertLane:wt.revertLane,gesture:null,action:wt.action,hasEagerState:wt.hasEagerState,eagerState:wt.eagerState,next:null},qe===null?(Te=qe=$t,ae=X):qe=qe.next=$t,un.lanes|=It,Vu|=It;$t=wt.action,Za&&A(X,$t),X=wt.hasEagerState?wt.eagerState:A(X,$t)}else It={lane:$t,revertLane:wt.revertLane,gesture:wt.gesture,action:wt.action,hasEagerState:wt.hasEagerState,eagerState:wt.eagerState,next:null},qe===null?(Te=qe=It,ae=X):qe=qe.next=It,un.lanes|=$t,Vu|=$t;wt=wt.next}while(wt!==null&&wt!==m);if(qe===null?ae=X:qe.next=Te,!ns(X,d.memoizedState)&&(Ws=!0,Lt&&(A=la,A!==null)))throw A;d.memoizedState=X,d.baseState=ae,d.baseQueue=qe,P.lastRenderedState=X}return L===null&&(P.lanes=0),[d.memoizedState,P.dispatch]}function g(d){var m=Mr(),A=m.queue;if(A===null)throw Error(r(311));A.lastRenderedReducer=d;var P=A.dispatch,L=A.pending,X=m.memoizedState;if(L!==null){A.pending=null;var ae=L=L.next;do X=d(X,ae.action),ae=ae.next;while(ae!==L);ns(X,m.memoizedState)||(Ws=!0),m.memoizedState=X,m.baseQueue===null&&(m.baseState=X),A.lastRenderedState=X}return[X,P]}function x(d,m,A){var P=un,L=Mr(),X=bn;if(X){if(A===void 0)throw Error(r(407));A=A()}else A=m();var ae=!ns((Vn||L).memoizedState,A);if(ae&&(L.memoizedState=A,Ws=!0),L=L.queue,_t(O.bind(null,P,L,d),[d]),L.getSnapshot!==m||ae||zi!==null&&zi.memoizedState.tag&1){if(P.flags|=2048,Ue(9,{destroy:void 0},I.bind(null,P,L,A,m),null),Rr===null)throw Error(r(349));X||(_c&127)!==0||T(P,m,A)}return A}function T(d,m,A){d.flags|=16384,d={getSnapshot:m,value:A},m=un.updateQueue,m===null?(m=Gl(),un.updateQueue=m,m.stores=[d]):(A=m.stores,A===null?m.stores=[d]:A.push(d))}function I(d,m,A,P){m.value=A,m.getSnapshot=P,z(m)&&G(d)}function O(d,m,A){return A(function(){z(m)&&G(d)})}function z(d){var m=d.getSnapshot;d=d.value;try{var A=m();return!ns(d,A)}catch{return!0}}function G(d){var m=Bo(d,2);m!==null&&$o(m,d,2)}function q(d){var m=ea();if(typeof d=="function"){var A=d;if(d=A(),Za){He(!0);try{A()}finally{He(!1)}}}return m.memoizedState=m.baseState=d,m.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:hl,lastRenderedState:d},m}function J(d,m,A,P){return d.baseState=A,s(d,Vn,typeof P=="function"?P:hl)}function re(d,m,A,P,L){if(xo(d))throw Error(r(485));if(d=m.action,d!==null){var X={payload:L,action:d,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(ae){X.listeners.push(ae)}};nt.T!==null?A(!0):X.isTransition=!1,P(X),A=m.pending,A===null?(X.next=m.pending=X,ie(m,X)):(X.next=A.next,m.pending=A.next=X)}}function ie(d,m){var A=m.action,P=m.payload,L=d.state;if(m.isTransition){var X=nt.T,ae={};nt.T=ae;try{var Te=A(L,P),qe=nt.S;qe!==null&&qe(ae,Te),ce(d,m,Te)}catch(wt){Me(d,m,wt)}finally{X!==null&&ae.types!==null&&(X.types=ae.types),nt.T=X}}else try{X=A(L,P),ce(d,m,X)}catch(wt){Me(d,m,wt)}}function ce(d,m,A){A!==null&&typeof A=="object"&&typeof A.then=="function"?A.then(function(P){_e(d,m,P)},function(P){return Me(d,m,P)}):_e(d,m,A)}function _e(d,m,A){m.status="fulfilled",m.value=A,Pe(m),d.state=A,m=d.pending,m!==null&&(A=m.next,A===m?d.pending=null:(A=A.next,m.next=A,ie(d,A)))}function Me(d,m,A){var P=d.pending;if(d.pending=null,P!==null){P=P.next;do m.status="rejected",m.reason=A,Pe(m),m=m.next;while(m!==P)}d.action=null}function Pe(d){d=d.listeners;for(var m=0;m<d.length;m++)(0,d[m])()}function Ce(d,m){return m}function Oe(d,m){if(bn){var A=Rr.formState;if(A!==null){e:{var P=un;if(bn){if(nr){t:{for(var L=nr,X=po;L.nodeType!==8;){if(!X){L=null;break t}if(L=ml(L.nextSibling),L===null){L=null;break t}}X=L.data,L=X==="F!"||X==="F"?L:null}if(L){nr=ml(L.nextSibling),P=L.data==="F!";break e}}Va(P)}P=!1}P&&(m=A[0])}}return A=ea(),A.memoizedState=A.baseState=m,P={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ce,lastRenderedState:m},A.queue=P,A=Wl.bind(null,un,P),P.dispatch=A,P=q(!1),X=Xa.bind(null,un,!1,P.queue),P=ea(),L={state:m,dispatch:null,action:d,pending:null},P.queue=L,A=re.bind(null,un,L,X,A),L.dispatch=A,P.memoizedState=d,[m,A,!1]}function We(d){var m=Mr();return ke(m,Vn,d)}function ke(d,m,A){if(m=s(d,m,Ce)[0],d=C(hl)[0],typeof m=="object"&&m!==null&&typeof m.then=="function")try{var P=Fu(m)}catch(ae){throw ae===ll?Wa:ae}else P=m;m=Mr();var L=m.queue,X=L.dispatch;return A!==m.memoizedState&&(un.flags|=2048,Ue(9,{destroy:void 0},Ge.bind(null,L,A),null)),[P,X,d]}function Ge(d,m){d.action=m}function Xe(d){var m=Mr(),A=Vn;if(A!==null)return ke(m,A,d);Mr(),m=m.memoizedState,A=Mr();var P=A.queue.dispatch;return A.memoizedState=d,[m,P,!1]}function Ue(d,m,A,P){return d={tag:d,create:A,deps:P,inst:m,next:null},m=un.updateQueue,m===null&&(m=Gl(),un.updateQueue=m),A=m.lastEffect,A===null?m.lastEffect=d.next=d:(P=A.next,A.next=d,d.next=P,m.lastEffect=d),d}function et(){return Mr().memoizedState}function At(d,m,A,P){var L=ea();un.flags|=d,L.memoizedState=Ue(1|m,{destroy:void 0},A,P===void 0?null:P)}function pt(d,m,A,P){var L=Mr();P=P===void 0?null:P;var X=L.memoizedState.inst;Vn!==null&&P!==null&&vo(P,Vn.memoizedState.deps)?L.memoizedState=Ue(m,X,A,P):(un.flags|=d,L.memoizedState=Ue(1|m,X,A,P))}function bt(d,m){At(8390656,8,d,m)}function _t(d,m){pt(2048,8,d,m)}function ti(d){un.flags|=4;var m=un.updateQueue;if(m===null)m=Gl(),un.updateQueue=m,m.events=[d];else{var A=m.events;A===null?m.events=[d]:A.push(d)}}function ii(d){var m=Mr().memoizedState;return ti({ref:m,nextImpl:d}),function(){if((Rn&2)!==0)throw Error(r(440));return m.impl.apply(void 0,arguments)}}function Wt(d,m){return pt(4,2,d,m)}function ri(d,m){return pt(4,4,d,m)}function Ji(d,m){if(typeof m=="function"){d=d();var A=m(d);return function(){typeof A=="function"?A():m(null)}}if(m!=null)return d=d(),m.current=d,function(){m.current=null}}function sn(d,m,A){A=A!=null?A.concat([d]):null,pt(4,4,Ji.bind(null,m,d),A)}function rr(){}function sr(d,m){var A=Mr();m=m===void 0?null:m;var P=A.memoizedState;return m!==null&&vo(m,P[1])?P[0]:(A.memoizedState=[d,m],d)}function yr(d,m){var A=Mr();m=m===void 0?null:m;var P=A.memoizedState;if(m!==null&&vo(m,P[1]))return P[0];if(P=d(),Za){He(!0);try{d()}finally{He(!1)}}return A.memoizedState=[P,m],P}function qn(d,m,A){return A===void 0||(_c&1073741824)!==0&&(hn&261930)===0?d.memoizedState=m:(d.memoizedState=A,d=B_(),un.lanes|=d,Vu|=d,A)}function zr(d,m,A,P){return ns(A,m)?A:Du.current!==null?(d=qn(d,A,P),ns(d,m)||(Ws=!0),d):(_c&42)===0||(_c&1073741824)!==0&&(hn&261930)===0?(Ws=!0,d.memoizedState=A):(d=B_(),un.lanes|=d,Vu|=d,m)}function vr(d,m,A,P,L){var X=Ut.p;Ut.p=X!==0&&8>X?X:8;var ae=nt.T,Te={};nt.T=Te,Xa(d,!1,m,A);try{var qe=L(),wt=nt.S;if(wt!==null&&wt(Te,qe),qe!==null&&typeof qe=="object"&&typeof qe.then=="function"){var Lt=Mf(qe,P);jo(d,m,Lt,Ho(d))}else jo(d,m,P,Ho(d))}catch($t){jo(d,m,{then:function(){},status:"rejected",reason:$t},Ho())}finally{Ut.p=X,ae!==null&&Te.types!==null&&(ae.types=Te.types),nt.T=ae}}function Gs(){}function Xr(d,m,A,P){if(d.tag!==5)throw Error(r(476));var L=jn(d).queue;vr(d,L,m,mi,A===null?Gs:function(){return fr(d),A(P)})}function jn(d){var m=d.memoizedState;if(m!==null)return m;m={memoizedState:mi,baseState:mi,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:hl,lastRenderedState:mi},next:null};var A={};return m.next={memoizedState:A,baseState:A,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:hl,lastRenderedState:A},next:null},d.memoizedState=m,d=d.alternate,d!==null&&(d.memoizedState=m),m}function fr(d){var m=jn(d);m.next===null&&(m=d.alternate.memoizedState),jo(d,m.next.queue,{},Ho())}function Os(){return ps(qd)}function Fs(){return Mr().memoizedState}function ws(){return Mr().memoizedState}function Hr(d){for(var m=d.return;m!==null;){switch(m.tag){case 24:case 3:var A=Ho();d=ss(A);var P=Nr(m,d,A);P!==null&&($o(P,m,A),Br(P,m,A)),m={cache:Nl()},d.payload=m;return}m=m.return}}function ua(d,m,A){var P=Ho();A={lane:P,revertLane:0,gesture:null,action:A,hasEagerState:!1,eagerState:null,next:null},xo(d)?Go(m,A):(A=Wc(d,m,A,P),A!==null&&($o(A,d,P),$r(A,m,P)))}function Wl(d,m,A){var P=Ho();jo(d,m,A,P)}function jo(d,m,A,P){var L={lane:P,revertLane:0,gesture:null,action:A,hasEagerState:!1,eagerState:null,next:null};if(xo(d))Go(m,L);else{var X=d.alternate;if(d.lanes===0&&(X===null||X.lanes===0)&&(X=m.lastRenderedReducer,X!==null))try{var ae=m.lastRenderedState,Te=X(ae,A);if(L.hasEagerState=!0,L.eagerState=Te,ns(Te,ae))return Sf(d,m,L,0),Rr===null&&xh(),!1}catch{}finally{}if(A=Wc(d,m,L,P),A!==null)return $o(A,d,P),$r(A,m,P),!0}return!1}function Xa(d,m,A,P){if(P={lane:2,revertLane:K0(),gesture:null,action:P,hasEagerState:!1,eagerState:null,next:null},xo(d)){if(m)throw Error(r(479))}else m=Wc(d,A,P,2),m!==null&&$o(m,d,2)}function xo(d){var m=d.alternate;return d===un||m!==null&&m===un}function Go(d,m){yo=_r=!0;var A=d.pending;A===null?m.next=m:(m.next=A.next,A.next=m),d.pending=m}function $r(d,m,A){if((A&4194048)!==0){var P=m.lanes;P&=d.pendingLanes,A|=P,m.lanes=A,es(d,A)}}var Xn={readContext:ps,use:Nu,useCallback:lr,useContext:lr,useEffect:lr,useImperativeHandle:lr,useLayoutEffect:lr,useInsertionEffect:lr,useMemo:lr,useReducer:lr,useRef:lr,useState:lr,useDebugValue:lr,useDeferredValue:lr,useTransition:lr,useSyncExternalStore:lr,useId:lr,useHostTransitionStatus:lr,useFormState:lr,useActionState:lr,useOptimistic:lr,useMemoCache:lr,useCacheRefresh:lr};Xn.useEffectEvent=lr;var ar={readContext:ps,use:Nu,useCallback:function(d,m){return ea().memoizedState=[d,m===void 0?null:m],d},useContext:ps,useEffect:bt,useImperativeHandle:function(d,m,A){A=A!=null?A.concat([d]):null,At(4194308,4,Ji.bind(null,m,d),A)},useLayoutEffect:function(d,m){return At(4194308,4,d,m)},useInsertionEffect:function(d,m){At(4,2,d,m)},useMemo:function(d,m){var A=ea();m=m===void 0?null:m;var P=d();if(Za){He(!0);try{d()}finally{He(!1)}}return A.memoizedState=[P,m],P},useReducer:function(d,m,A){var P=ea();if(A!==void 0){var L=A(m);if(Za){He(!0);try{A(m)}finally{He(!1)}}}else L=m;return P.memoizedState=P.baseState=L,d={pending:null,lanes:0,dispatch:null,lastRenderedReducer:d,lastRenderedState:L},P.queue=d,d=d.dispatch=ua.bind(null,un,d),[P.memoizedState,d]},useRef:function(d){var m=ea();return d={current:d},m.memoizedState=d},useState:function(d){d=q(d);var m=d.queue,A=Wl.bind(null,un,m);return m.dispatch=A,[d.memoizedState,A]},useDebugValue:rr,useDeferredValue:function(d,m){var A=ea();return qn(A,d,m)},useTransition:function(){var d=q(!1);return d=vr.bind(null,un,d.queue,!0,!1),ea().memoizedState=d,[!1,d]},useSyncExternalStore:function(d,m,A){var P=un,L=ea();if(bn){if(A===void 0)throw Error(r(407));A=A()}else{if(A=m(),Rr===null)throw Error(r(349));(hn&127)!==0||T(P,m,A)}L.memoizedState=A;var X={value:A,getSnapshot:m};return L.queue=X,bt(O.bind(null,P,X,d),[d]),P.flags|=2048,Ue(9,{destroy:void 0},I.bind(null,P,X,A,m),null),A},useId:function(){var d=ea(),m=Rr.identifierPrefix;if(bn){var A=Ua,P=Cl;A=(P&~(1<<32-st(P)-1)).toString(32)+A,m="_"+m+"R_"+A,A=qc++,0<A&&(m+="H"+A.toString(32)),m+="_"}else A=wd++,m="_"+m+"r_"+A.toString(32)+"_";return d.memoizedState=m},useHostTransitionStatus:Os,useFormState:Oe,useActionState:Oe,useOptimistic:function(d){var m=ea();m.memoizedState=m.baseState=d;var A={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return m.queue=A,m=Xa.bind(null,un,!0,A),A.dispatch=m,[d,m]},useMemoCache:kh,useCacheRefresh:function(){return ea().memoizedState=Hr.bind(null,un)},useEffectEvent:function(d){var m=ea(),A={impl:d};return m.memoizedState=A,function(){if((Rn&2)!==0)throw Error(r(440));return A.impl.apply(void 0,arguments)}}},gs={readContext:ps,use:Nu,useCallback:sr,useContext:ps,useEffect:_t,useImperativeHandle:sn,useInsertionEffect:Wt,useLayoutEffect:ri,useMemo:yr,useReducer:C,useRef:et,useState:function(){return C(hl)},useDebugValue:rr,useDeferredValue:function(d,m){var A=Mr();return zr(A,Vn.memoizedState,d,m)},useTransition:function(){var d=C(hl)[0],m=Mr().memoizedState;return[typeof d=="boolean"?d:Fu(d),m]},useSyncExternalStore:x,useId:Fs,useHostTransitionStatus:Os,useFormState:We,useActionState:We,useOptimistic:function(d,m){var A=Mr();return J(A,Vn,d,m)},useMemoCache:kh,useCacheRefresh:ws};gs.useEffectEvent=ii;var Ts={readContext:ps,use:Nu,useCallback:sr,useContext:ps,useEffect:_t,useImperativeHandle:sn,useInsertionEffect:Wt,useLayoutEffect:ri,useMemo:yr,useReducer:g,useRef:et,useState:function(){return g(hl)},useDebugValue:rr,useDeferredValue:function(d,m){var A=Mr();return Vn===null?qn(A,d,m):zr(A,Vn.memoizedState,d,m)},useTransition:function(){var d=g(hl)[0],m=Mr().memoizedState;return[typeof d=="boolean"?d:Fu(d),m]},useSyncExternalStore:x,useId:Fs,useHostTransitionStatus:Os,useFormState:Xe,useActionState:Xe,useOptimistic:function(d,m){var A=Mr();return Vn!==null?J(A,Vn,d,m):(A.baseState=d,[d,A.queue.dispatch])},useMemoCache:kh,useCacheRefresh:ws};Ts.useEffectEvent=ii;function Td(d,m,A,P){m=d.memoizedState,A=A(P,m),A=A==null?m:j({},m,A),d.memoizedState=A,d.lanes===0&&(d.updateQueue.baseState=A)}var Sd={enqueueSetState:function(d,m,A){d=d._reactInternals;var P=Ho(),L=ss(P);L.payload=m,A!=null&&(L.callback=A),m=Nr(d,L,P),m!==null&&($o(m,d,P),Br(m,d,P))},enqueueReplaceState:function(d,m,A){d=d._reactInternals;var P=Ho(),L=ss(P);L.tag=1,L.payload=m,A!=null&&(L.callback=A),m=Nr(d,L,P),m!==null&&($o(m,d,P),Br(m,d,P))},enqueueForceUpdate:function(d,m){d=d._reactInternals;var A=Ho(),P=ss(A);P.tag=2,m!=null&&(P.callback=m),m=Nr(d,P,A),m!==null&&($o(m,d,A),Br(m,d,A))}};function Qc(d,m,A,P,L,X,ae){return d=d.stateNode,typeof d.shouldComponentUpdate=="function"?d.shouldComponentUpdate(P,X,ae):m.prototype&&m.prototype.isPureReactComponent?!ks(A,P)||!ks(L,X):!0}function E0(d,m,A,P){d=m.state,typeof m.componentWillReceiveProps=="function"&&m.componentWillReceiveProps(A,P),typeof m.UNSAFE_componentWillReceiveProps=="function"&&m.UNSAFE_componentWillReceiveProps(A,P),m.state!==d&&Sd.enqueueReplaceState(m,m.state,null)}function yc(d,m){var A=m;if("ref"in m){A={};for(var P in m)P!=="ref"&&(A[P]=m[P])}if(d=d.defaultProps){A===m&&(A=j({},A));for(var L in d)A[L]===void 0&&(A[L]=d[L])}return A}function Ed(d){Ml(d)}function vc(d){console.error(d)}function Ss(d){Ml(d)}function as(d,m){try{var A=d.onUncaughtError;A(m.value,{componentStack:m.stack})}catch(P){setTimeout(function(){throw P})}}function Kc(d,m,A){try{var P=d.onCaughtError;P(A.value,{componentStack:A.stack,errorBoundary:m.tag===1?m.stateNode:null})}catch(L){setTimeout(function(){throw L})}}function kf(d,m,A){return A=ss(A),A.tag=3,A.payload={element:null},A.callback=function(){as(d,m)},A}function xc(d){return d=ss(d),d.tag=3,d}function Df(d,m,A,P){var L=A.type.getDerivedStateFromError;if(typeof L=="function"){var X=P.value;d.payload=function(){return L(X)},d.callback=function(){Kc(m,A,P)}}var ae=A.stateNode;ae!==null&&typeof ae.componentDidCatch=="function"&&(d.callback=function(){Kc(m,A,P),typeof L!="function"&&(ju===null?ju=new Set([this]):ju.add(this));var Te=P.stack;this.componentDidCatch(P.value,{componentStack:Te!==null?Te:""})})}function Of(d,m,A,P,L){if(A.flags|=32768,P!==null&&typeof P=="object"&&typeof P.then=="function"){if(m=A.alternate,m!==null&&go(m,A,L,!0),A=xi.current,A!==null){switch(A.tag){case 31:case 13:return Mi===null?Y0():A.alternate===null&&ms===0&&(ms=3),A.flags&=-257,A.flags|=65536,A.lanes=L,P===yi?A.flags|=16384:(m=A.updateQueue,m===null?A.updateQueue=new Set([P]):m.add(P),lg(d,P,L)),!1;case 22:return A.flags|=65536,P===yi?A.flags|=16384:(m=A.updateQueue,m===null?(m={transitions:null,markerInstances:null,retryQueue:new Set([P])},A.updateQueue=m):(A=m.retryQueue,A===null?m.retryQueue=new Set([P]):A.add(P)),lg(d,P,L)),!1}throw Error(r(435,A.tag))}return lg(d,P,L),Y0(),!1}if(bn)return m=xi.current,m!==null?((m.flags&65536)===0&&(m.flags|=256),m.flags|=65536,m.lanes=L,P!==Fr&&(d=Error(r(422),{cause:P}),hc(Pa(d,A)))):(P!==Fr&&(m=Error(r(423),{cause:P}),hc(Pa(m,A))),d=d.current.alternate,d.flags|=65536,L&=-L,d.lanes|=L,P=Pa(P,A),L=kf(d.stateNode,P,L),Un(d,L),ms!==4&&(ms=2)),!1;var X=Error(r(520),{cause:P});if(X=Pa(X,A),W0===null?W0=[X]:W0.push(X),ms!==4&&(ms=2),m===null)return!0;P=Pa(P,A),A=m;do{switch(A.tag){case 3:return A.flags|=65536,d=L&-L,A.lanes|=d,d=kf(A.stateNode,P,d),Un(A,d),!1;case 1:if(m=A.type,X=A.stateNode,(A.flags&128)===0&&(typeof m.getDerivedStateFromError=="function"||X!==null&&typeof X.componentDidCatch=="function"&&(ju===null||!ju.has(X))))return A.flags|=65536,L&=-L,A.lanes|=L,L=xc(L),Df(L,d,A,P),Un(A,L),!1}A=A.return}while(A!==null);return!1}var Ff=Error(r(461)),Ws=!1;function Zs(d,m,A,P){m.child=d===null?w0(m,null,A,P):Ll(m,d.child,A,P)}function im(d,m,A,P,L){A=A.render;var X=m.ref;if("ref"in P){var ae={};for(var Te in P)Te!=="ref"&&(ae[Te]=P[Te])}else ae=P;return dc(m),P=Ph(d,m,A,ae,X,L),Te=Jc(),d!==null&&!Ws?(Vl(d,m,L),Ac(d,m,L)):(bn&&Te&&Cu(m),m.flags|=1,Zs(d,m,P,L),m.child)}function eu(d,m,A,P,L){if(d===null){var X=A.type;return typeof X=="function"&&!pd(X)&&X.defaultProps===void 0&&A.compare===null?(m.tag=15,m.type=X,Xp(d,m,X,P,L)):(d=gd(A.type,null,P,m,m.mode,L),d.ref=m.ref,d.return=m,m.child=d)}if(X=d.child,!P0(d,L)){var ae=X.memoizedProps;if(A=A.compare,A=A!==null?A:ks,A(ae,P)&&d.ref===m.ref)return Ac(d,m,L)}return m.flags|=1,d=fo(X,P),d.ref=m.ref,d.return=m,m.child=d}function Xp(d,m,A,P,L){if(d!==null){var X=d.memoizedProps;if(ks(X,P)&&d.ref===m.ref)if(Ws=!1,m.pendingProps=P=X,P0(d,L))(d.flags&131072)!==0&&(Ws=!0);else return m.lanes=d.lanes,Ac(d,m,L)}return Rd(d,m,A,P,L)}function Hp(d,m,A,P){var L=P.children,X=d!==null?d.memoizedState:null;if(d===null&&m.stateNode===null&&(m.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),P.mode==="hidden"){if((m.flags&128)!==0){if(X=X!==null?X.baseLanes|A:A,d!==null){for(P=m.child=d.child,L=0;P!==null;)L=L|P.lanes|P.childLanes,P=P.sibling;P=L&~X}else P=0,m.child=null;return k_(d,m,X,A,P)}if((A&536870912)!==0)m.memoizedState={baseLanes:0,cachePool:null},d!==null&&xd(m,X!==null?X.cachePool:null),X!==null?S0(m,X):_o(),Rh(m);else return P=m.lanes=536870912,k_(d,m,X!==null?X.baseLanes|A:A,A,P)}else X!==null?(xd(m,X.cachePool),S0(m,X),Er(),m.memoizedState=null):(d!==null&&xd(m,null),_o(),Er());return Zs(d,m,L,A),m.child}function Zl(d,m){return d!==null&&d.tag===22||m.stateNode!==null||(m.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),m.sibling}function k_(d,m,A,P,L){var X=vd();return X=X===null?null:{parent:rs._currentValue,pool:X},m.memoizedState={baseLanes:A,cachePool:X},d!==null&&xd(m,null),_o(),Rh(m),d!==null&&go(d,m,P,!0),m.childLanes=L,null}function Xl(d,m){return m=qp({mode:m.mode,children:m.children},d.mode),m.ref=d.ref,d.child=m,m.return=d,m}function bc(d,m,A){return Ll(m,d.child,null,A),d=Xl(m,m.pendingProps),d.flags|=2,rn(m),m.memoizedState=null,d}function Md(d,m,A){var P=m.pendingProps,L=(m.flags&128)!==0;if(m.flags&=-129,d===null){if(bn){if(P.mode==="hidden")return d=Xl(m,P),m.lanes=536870912,Zl(null,d);if(Mh(m),(d=nr)?(d=Yh(d,po),d=d!==null&&d.data==="&"?d:null,d!==null&&(m.memoizedState={dehydrated:d,treeContext:sl!==null?{id:Cl,overflow:Ua}:null,retryLane:536870912,hydrationErrors:null},A=Eu(d),A.return=m,m.child=A,js=m,nr=null)):d=null,d===null)throw Va(m);return m.lanes=536870912,null}return Xl(m,P)}var X=d.memoizedState;if(X!==null){var ae=X.dehydrated;if(Mh(m),L)if(m.flags&256)m.flags&=-257,m=bc(d,m,A);else if(m.memoizedState!==null)m.child=d.child,m.flags|=128,m=null;else throw Error(r(558));else if(Ws||go(d,m,A,!1),L=(A&d.childLanes)!==0,Ws||L){if(P=Rr,P!==null&&(ae=tr(P,A),ae!==0&&ae!==X.retryLane))throw X.retryLane=ae,Bo(d,ae),$o(P,d,ae),Ff;Y0(),m=bc(d,m,A)}else d=X.treeContext,nr=ml(ae.nextSibling),js=m,bn=!0,al=null,po=!1,d!==null&&x0(m,d),m=Xl(m,P),m.flags|=4096;return m}return d=fo(d.child,{mode:P.mode,children:P.children}),d.ref=m.ref,m.child=d,d.return=m,d}function M0(d,m){var A=m.ref;if(A===null)d!==null&&d.ref!==null&&(m.flags|=4194816);else{if(typeof A!="function"&&typeof A!="object")throw Error(r(284));(d===null||d.ref!==A)&&(m.flags|=4194816)}}function Rd(d,m,A,P,L){return dc(m),A=Ph(d,m,A,P,void 0,L),P=Jc(),d!==null&&!Ws?(Vl(d,m,L),Ac(d,m,L)):(bn&&P&&Cu(m),m.flags|=1,Zs(d,m,A,L),m.child)}function R0(d,m,A,P,L,X){return dc(m),m.updateQueue=null,A=Ih(m,P,A,L),Zr(d),P=Jc(),d!==null&&!Ws?(Vl(d,m,X),Ac(d,m,X)):(bn&&P&&Cu(m),m.flags|=1,Zs(d,m,A,X),m.child)}function Dh(d,m,A,P,L){if(dc(m),m.stateNode===null){var X=tn,ae=A.contextType;typeof ae=="object"&&ae!==null&&(X=ps(ae)),X=new A(P,X),m.memoizedState=X.state!==null&&X.state!==void 0?X.state:null,X.updater=Sd,m.stateNode=X,X._reactInternals=m,X=m.stateNode,X.props=P,X.state=m.memoizedState,X.refs={},ca(m),ae=A.contextType,X.context=typeof ae=="object"&&ae!==null?ps(ae):tn,X.state=m.memoizedState,ae=A.getDerivedStateFromProps,typeof ae=="function"&&(Td(m,A,ae,P),X.state=m.memoizedState),typeof A.getDerivedStateFromProps=="function"||typeof X.getSnapshotBeforeUpdate=="function"||typeof X.UNSAFE_componentWillMount!="function"&&typeof X.componentWillMount!="function"||(ae=X.state,typeof X.componentWillMount=="function"&&X.componentWillMount(),typeof X.UNSAFE_componentWillMount=="function"&&X.UNSAFE_componentWillMount(),ae!==X.state&&Sd.enqueueReplaceState(X,X.state,null),$c(m,P,X,L),mc(),X.state=m.memoizedState),typeof X.componentDidMount=="function"&&(m.flags|=4194308),P=!0}else if(d===null){X=m.stateNode;var Te=m.memoizedProps,qe=yc(A,Te);X.props=qe;var wt=X.context,Lt=A.contextType;ae=tn,typeof Lt=="object"&&Lt!==null&&(ae=ps(Lt));var $t=A.getDerivedStateFromProps;Lt=typeof $t=="function"||typeof X.getSnapshotBeforeUpdate=="function",Te=m.pendingProps!==Te,Lt||typeof X.UNSAFE_componentWillReceiveProps!="function"&&typeof X.componentWillReceiveProps!="function"||(Te||wt!==ae)&&E0(m,X,P,ae),ul=!1;var It=m.memoizedState;X.state=It,$c(m,P,X,L),mc(),wt=m.memoizedState,Te||It!==wt||ul?(typeof $t=="function"&&(Td(m,A,$t,P),wt=m.memoizedState),(qe=ul||Qc(m,A,qe,P,It,wt,ae))?(Lt||typeof X.UNSAFE_componentWillMount!="function"&&typeof X.componentWillMount!="function"||(typeof X.componentWillMount=="function"&&X.componentWillMount(),typeof X.UNSAFE_componentWillMount=="function"&&X.UNSAFE_componentWillMount()),typeof X.componentDidMount=="function"&&(m.flags|=4194308)):(typeof X.componentDidMount=="function"&&(m.flags|=4194308),m.memoizedProps=P,m.memoizedState=wt),X.props=P,X.state=wt,X.context=ae,P=qe):(typeof X.componentDidMount=="function"&&(m.flags|=4194308),P=!1)}else{X=m.stateNode,ku(d,m),ae=m.memoizedProps,Lt=yc(A,ae),X.props=Lt,$t=m.pendingProps,It=X.context,wt=A.contextType,qe=tn,typeof wt=="object"&&wt!==null&&(qe=ps(wt)),Te=A.getDerivedStateFromProps,(wt=typeof Te=="function"||typeof X.getSnapshotBeforeUpdate=="function")||typeof X.UNSAFE_componentWillReceiveProps!="function"&&typeof X.componentWillReceiveProps!="function"||(ae!==$t||It!==qe)&&E0(m,X,P,qe),ul=!1,It=m.memoizedState,X.state=It,$c(m,P,X,L),mc();var Nt=m.memoizedState;ae!==$t||It!==Nt||ul||d!==null&&d.dependencies!==null&&bh(d.dependencies)?(typeof Te=="function"&&(Td(m,A,Te,P),Nt=m.memoizedState),(Lt=ul||Qc(m,A,Lt,P,It,Nt,qe)||d!==null&&d.dependencies!==null&&bh(d.dependencies))?(wt||typeof X.UNSAFE_componentWillUpdate!="function"&&typeof X.componentWillUpdate!="function"||(typeof X.componentWillUpdate=="function"&&X.componentWillUpdate(P,Nt,qe),typeof X.UNSAFE_componentWillUpdate=="function"&&X.UNSAFE_componentWillUpdate(P,Nt,qe)),typeof X.componentDidUpdate=="function"&&(m.flags|=4),typeof X.getSnapshotBeforeUpdate=="function"&&(m.flags|=1024)):(typeof X.componentDidUpdate!="function"||ae===d.memoizedProps&&It===d.memoizedState||(m.flags|=4),typeof X.getSnapshotBeforeUpdate!="function"||ae===d.memoizedProps&&It===d.memoizedState||(m.flags|=1024),m.memoizedProps=P,m.memoizedState=Nt),X.props=P,X.state=Nt,X.context=qe,P=Lt):(typeof X.componentDidUpdate!="function"||ae===d.memoizedProps&&It===d.memoizedState||(m.flags|=4),typeof X.getSnapshotBeforeUpdate!="function"||ae===d.memoizedProps&&It===d.memoizedState||(m.flags|=1024),P=!1)}return X=P,M0(d,m),P=(m.flags&128)!==0,X||P?(X=m.stateNode,A=P&&typeof A.getDerivedStateFromError!="function"?null:X.render(),m.flags|=1,d!==null&&P?(m.child=Ll(m,d.child,null,L),m.child=Ll(m,null,A,L)):Zs(d,m,A,L),m.memoizedState=X.state,d=m.child):d=Ac(d,m,L),d}function $p(d,m,A,P){return Ga(),m.flags|=256,Zs(d,m,A,P),m.child}var C0={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Oh(d){return{baseLanes:d,cachePool:Zp()}}function fl(d,m,A){return d=d!==null?d.childLanes&~A:0,m&&(d|=ka),d}function nm(d,m,A){var P=m.pendingProps,L=!1,X=(m.flags&128)!==0,ae;if((ae=X)||(ae=d!==null&&d.memoizedState===null?!1:(hr.current&2)!==0),ae&&(L=!0,m.flags&=-129),ae=(m.flags&32)!==0,m.flags&=-33,d===null){if(bn){if(L?Vo(m):Er(),(d=nr)?(d=Yh(d,po),d=d!==null&&d.data!=="&"?d:null,d!==null&&(m.memoizedState={dehydrated:d,treeContext:sl!==null?{id:Cl,overflow:Ua}:null,retryLane:536870912,hydrationErrors:null},A=Eu(d),A.return=m,m.child=A,js=m,nr=null)):d=null,d===null)throw Va(m);return Ms(d)?m.lanes=32:m.lanes=536870912,null}var Te=P.children;return P=P.fallback,L?(Er(),L=m.mode,Te=qp({mode:"hidden",children:Te},L),P=Zc(P,L,A,null),Te.return=m,P.return=m,Te.sibling=P,m.child=Te,P=m.child,P.memoizedState=Oh(A),P.childLanes=fl(d,ae,A),m.memoizedState=C0,Zl(null,P)):(Vo(m),rm(m,Te))}var qe=d.memoizedState;if(qe!==null&&(Te=qe.dehydrated,Te!==null)){if(X)m.flags&256?(Vo(m),m.flags&=-257,m=Yp(d,m,A)):m.memoizedState!==null?(Er(),m.child=d.child,m.flags|=128,m=null):(Er(),Te=P.fallback,L=m.mode,P=qp({mode:"visible",children:P.children},L),Te=Zc(Te,L,A,null),Te.flags|=2,P.return=m,Te.return=m,P.sibling=Te,m.child=P,Ll(m,d.child,null,A),P=m.child,P.memoizedState=Oh(A),P.childLanes=fl(d,ae,A),m.memoizedState=C0,m=Zl(null,P));else if(Vo(m),Ms(Te)){if(ae=Te.nextSibling&&Te.nextSibling.dataset,ae)var wt=ae.dgst;ae=wt,P=Error(r(419)),P.stack="",P.digest=ae,hc({value:P,source:null,stack:null}),m=Yp(d,m,A)}else if(Ws||go(d,m,A,!1),ae=(A&d.childLanes)!==0,Ws||ae){if(ae=Rr,ae!==null&&(P=tr(ae,A),P!==0&&P!==qe.retryLane))throw qe.retryLane=P,Bo(d,P),$o(ae,d,P),Ff;$a(Te)||Y0(),m=Yp(d,m,A)}else $a(Te)?(m.flags|=192,m.child=d.child,m=null):(d=qe.treeContext,nr=ml(Te.nextSibling),js=m,bn=!0,al=null,po=!1,d!==null&&x0(m,d),m=rm(m,P.children),m.flags|=4096);return m}return L?(Er(),Te=P.fallback,L=m.mode,qe=d.child,wt=qe.sibling,P=fo(qe,{mode:"hidden",children:P.children}),P.subtreeFlags=qe.subtreeFlags&65011712,wt!==null?Te=fo(wt,Te):(Te=Zc(Te,L,A,null),Te.flags|=2),Te.return=m,P.return=m,P.sibling=Te,m.child=P,Zl(null,P),P=m.child,Te=d.child.memoizedState,Te===null?Te=Oh(A):(L=Te.cachePool,L!==null?(qe=rs._currentValue,L=L.parent!==qe?{parent:qe,pool:qe}:L):L=Zp(),Te={baseLanes:Te.baseLanes|A,cachePool:L}),P.memoizedState=Te,P.childLanes=fl(d,ae,A),m.memoizedState=C0,Zl(d.child,P)):(Vo(m),A=d.child,d=A.sibling,A=fo(A,{mode:"visible",children:P.children}),A.return=m,A.sibling=null,d!==null&&(ae=m.deletions,ae===null?(m.deletions=[d],m.flags|=16):ae.push(d)),m.child=A,m.memoizedState=null,A)}function rm(d,m){return m=qp({mode:"visible",children:m},d.mode),m.return=d,d.child=m}function qp(d,m){return d=Ca(22,d,null,m),d.lanes=0,d}function Yp(d,m,A){return Ll(m,d.child,null,A),d=rm(m,m.pendingProps.children),d.flags|=2,m.memoizedState=null,d}function sm(d,m,A){d.lanes|=m;var P=d.alternate;P!==null&&(P.lanes|=m),md(d.return,m,A)}function am(d,m,A,P,L,X){var ae=d.memoizedState;ae===null?d.memoizedState={isBackwards:m,rendering:null,renderingStartTime:0,last:P,tail:A,tailMode:L,treeForkCount:X}:(ae.isBackwards=m,ae.rendering=null,ae.renderingStartTime=0,ae.last=P,ae.tail=A,ae.tailMode=L,ae.treeForkCount=X)}function Cd(d,m,A){var P=m.pendingProps,L=P.revealOrder,X=P.tail;P=P.children;var ae=hr.current,Te=(ae&2)!==0;if(Te?(ae=ae&1|2,m.flags|=128):ae&=1,vi(hr,ae),Zs(d,m,P,A),P=bn?rl:0,!Te&&d!==null&&(d.flags&128)!==0)e:for(d=m.child;d!==null;){if(d.tag===13)d.memoizedState!==null&&sm(d,A,m);else if(d.tag===19)sm(d,A,m);else if(d.child!==null){d.child.return=d,d=d.child;continue}if(d===m)break e;for(;d.sibling===null;){if(d.return===null||d.return===m)break e;d=d.return}d.sibling.return=d.return,d=d.sibling}switch(L){case"forwards":for(A=m.child,L=null;A!==null;)d=A.alternate,d!==null&&Ch(d)===null&&(L=A),A=A.sibling;A=L,A===null?(L=m.child,m.child=null):(L=A.sibling,A.sibling=null),am(m,!1,L,A,X,P);break;case"backwards":case"unstable_legacy-backwards":for(A=null,L=m.child,m.child=null;L!==null;){if(d=L.alternate,d!==null&&Ch(d)===null){m.child=L;break}d=L.sibling,L.sibling=A,A=L,L=d}am(m,!0,A,null,X,P);break;case"together":am(m,!1,null,null,void 0,P);break;default:m.memoizedState=null}return m.child}function Ac(d,m,A){if(d!==null&&(m.dependencies=d.dependencies),Vu|=m.lanes,(A&m.childLanes)===0)if(d!==null){if(go(d,m,A,!1),(A&m.childLanes)===0)return null}else return null;if(d!==null&&m.child!==d.child)throw Error(r(153));if(m.child!==null){for(d=m.child,A=fo(d,d.pendingProps),m.child=A,A.return=m;d.sibling!==null;)d=d.sibling,A=A.sibling=fo(d,d.pendingProps),A.return=m;A.sibling=null}return m.child}function P0(d,m){return(d.lanes&m)!==0?!0:(d=d.dependencies,!!(d!==null&&bh(d)))}function I0(d,m,A){switch(m.tag){case 3:Kn(m,m.stateNode.containerInfo),Ol(m,rs,d.memoizedState.cache),Ga();break;case 27:case 5:Co(m);break;case 4:Kn(m,m.stateNode.containerInfo);break;case 10:Ol(m,m.type,m.memoizedProps.value);break;case 31:if(m.memoizedState!==null)return m.flags|=128,Mh(m),null;break;case 13:var P=m.memoizedState;if(P!==null)return P.dehydrated!==null?(Vo(m),m.flags|=128,null):(A&m.child.childLanes)!==0?nm(d,m,A):(Vo(m),d=Ac(d,m,A),d!==null?d.sibling:null);Vo(m);break;case 19:var L=(d.flags&128)!==0;if(P=(A&m.childLanes)!==0,P||(go(d,m,A,!1),P=(A&m.childLanes)!==0),L){if(P)return Cd(d,m,A);m.flags|=128}if(L=m.memoizedState,L!==null&&(L.rendering=null,L.tail=null,L.lastEffect=null),vi(hr,hr.current),P)break;return null;case 22:return m.lanes=0,Hp(d,m,A,m.pendingProps);case 24:Ol(m,rs,d.memoizedState.cache)}return Ac(d,m,A)}function Ha(d,m,A){if(d!==null)if(d.memoizedProps!==m.pendingProps)Ws=!0;else{if(!P0(d,A)&&(m.flags&128)===0)return Ws=!1,I0(d,m,A);Ws=(d.flags&131072)!==0}else Ws=!1,bn&&(m.flags&1048576)!==0&&uc(m,rl,m.index);switch(m.lanes=0,m.tag){case 16:e:{var P=m.pendingProps;if(d=Uo(m.elementType),m.type=d,typeof d=="function")pd(d)?(P=yc(d,P),m.tag=1,m=Dh(null,m,d,P,A)):(m.tag=0,m=Rd(null,m,d,P,A));else{if(d!=null){var L=d.$$typeof;if(L===Je){m.tag=11,m=im(null,m,d,P,A);break e}else if(L===kt){m.tag=14,m=eu(null,m,d,P,A);break e}}throw m=fi(d)||d,Error(r(306,m,""))}}return m;case 0:return Rd(d,m,m.type,m.pendingProps,A);case 1:return P=m.type,L=yc(P,m.pendingProps),Dh(d,m,P,L,A);case 3:e:{if(Kn(m,m.stateNode.containerInfo),d===null)throw Error(r(387));P=m.pendingProps;var X=m.memoizedState;L=X.element,ku(d,m),$c(m,P,null,A);var ae=m.memoizedState;if(P=ae.cache,Ol(m,rs,P),P!==X.cache&&_d(m,[rs],A,!0),mc(),P=ae.element,X.isDehydrated)if(X={element:P,isDehydrated:!1,cache:ae.cache},m.updateQueue.baseState=X,m.memoizedState=X,m.flags&256){m=$p(d,m,P,A);break e}else if(P!==L){L=Pa(Error(r(424)),m),hc(L),m=$p(d,m,P,A);break e}else{switch(d=m.stateNode.containerInfo,d.nodeType){case 9:d=d.body;break;default:d=d.nodeName==="HTML"?d.ownerDocument.body:d}for(nr=ml(d.firstChild),js=m,bn=!0,al=null,po=!0,A=w0(m,null,P,A),m.child=A;A;)A.flags=A.flags&-3|4096,A=A.sibling}else{if(Ga(),P===L){m=Ac(d,m,A);break e}Zs(d,m,P,A)}m=m.child}return m;case 26:return M0(d,m),d===null?(A=Um(m.type,null,m.pendingProps,null))?m.memoizedState=A:bn||(A=m.type,d=m.pendingProps,P=ip(Vi.current).createElement(A),P[vn]=m,P[ei]=d,Es(P,A,d),cr(P),m.stateNode=P):m.memoizedState=Um(m.type,d.memoizedProps,m.pendingProps,d.memoizedState),null;case 27:return Co(m),d===null&&bn&&(P=m.stateNode=ty(m.type,m.pendingProps,Vi.current),js=m,po=!0,L=nr,$u(m.type)?(qa=L,nr=ml(P.firstChild)):nr=L),Zs(d,m,m.pendingProps.children,A),M0(d,m),d===null&&(m.flags|=4194304),m.child;case 5:return d===null&&bn&&((L=P=nr)&&(P=ha(P,m.type,m.pendingProps,po),P!==null?(m.stateNode=P,js=m,nr=ml(P.firstChild),po=!1,L=!0):L=!1),L||Va(m)),Co(m),L=m.type,X=m.pendingProps,ae=d!==null?d.memoizedProps:null,P=X.children,vg(L,X)?P=null:ae!==null&&vg(L,ae)&&(m.flags|=32),m.memoizedState!==null&&(L=Ph(d,m,If,null,null,A),qd._currentValue=L),M0(d,m),Zs(d,m,P,A),m.child;case 6:return d===null&&bn&&((d=A=nr)&&(A=Rc(A,m.pendingProps,po),A!==null?(m.stateNode=A,js=m,nr=null,d=!0):d=!1),d||Va(m)),null;case 13:return nm(d,m,A);case 4:return Kn(m,m.stateNode.containerInfo),P=m.pendingProps,d===null?m.child=Ll(m,null,P,A):Zs(d,m,P,A),m.child;case 11:return im(d,m,m.type,m.pendingProps,A);case 7:return Zs(d,m,m.pendingProps,A),m.child;case 8:return Zs(d,m,m.pendingProps.children,A),m.child;case 12:return Zs(d,m,m.pendingProps.children,A),m.child;case 10:return P=m.pendingProps,Ol(m,m.type,P.value),Zs(d,m,P.children,A),m.child;case 9:return L=m.type._context,P=m.pendingProps.children,dc(m),L=ps(L),P=P(L),m.flags|=1,Zs(d,m,P,A),m.child;case 14:return eu(d,m,m.type,m.pendingProps,A);case 15:return Xp(d,m,m.type,m.pendingProps,A);case 19:return Cd(d,m,A);case 31:return Md(d,m,A);case 22:return Hp(d,m,A,m.pendingProps);case 24:return dc(m),P=ps(rs),d===null?(L=vd(),L===null&&(L=Rr,X=Nl(),L.pooledCache=X,X.refCount++,X!==null&&(L.pooledCacheLanes|=A),L=X),m.memoizedState={parent:P,cache:L},ca(m),Ol(m,rs,L)):((d.lanes&A)!==0&&(ku(d,m),$c(m,null,null,A),mc()),L=d.memoizedState,X=m.memoizedState,L.parent!==P?(L={parent:P,cache:P},m.memoizedState=L,m.lanes===0&&(m.memoizedState=m.updateQueue.baseState=L),Ol(m,rs,P)):(P=X.cache,Ol(m,rs,P),P!==L.cache&&_d(m,[rs],A,!0))),Zs(d,m,m.pendingProps.children,A),m.child;case 29:throw m.pendingProps}throw Error(r(156,m.tag))}function tu(d){d.flags|=4}function k0(d,m,A,P,L){if((m=(d.mode&32)!==0)&&(m=!1),m){if(d.flags|=16777216,(L&335544128)===L)if(d.stateNode.complete)d.flags|=8192;else if(xm())d.flags|=8192;else throw cl=yi,gc}else d.flags&=-16777217}function D_(d,m){if(m.type!=="stylesheet"||(m.state.loading&4)!==0)d.flags&=-16777217;else if(d.flags|=16777216,!lp(m))if(xm())d.flags|=8192;else throw cl=yi,gc}function D0(d,m){m!==null&&(d.flags|=4),d.flags&16384&&(m=d.tag!==22?ki():536870912,d.lanes|=m,zf|=m)}function O0(d,m){if(!bn)switch(d.tailMode){case"hidden":m=d.tail;for(var A=null;m!==null;)m.alternate!==null&&(A=m),m=m.sibling;A===null?d.tail=null:A.sibling=null;break;case"collapsed":A=d.tail;for(var P=null;A!==null;)A.alternate!==null&&(P=A),A=A.sibling;P===null?m||d.tail===null?d.tail=null:d.tail.sibling=null:P.sibling=null}}function Lr(d){var m=d.alternate!==null&&d.alternate.child===d.child,A=0,P=0;if(m)for(var L=d.child;L!==null;)A|=L.lanes|L.childLanes,P|=L.subtreeFlags&65011712,P|=L.flags&65011712,L.return=d,L=L.sibling;else for(L=d.child;L!==null;)A|=L.lanes|L.childLanes,P|=L.subtreeFlags,P|=L.flags,L.return=d,L=L.sibling;return d.subtreeFlags|=P,d.childLanes=A,m}function Jp(d,m,A){var P=m.pendingProps;switch(Pl(m),m.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Lr(m),null;case 1:return Lr(m),null;case 3:return A=m.stateNode,P=null,d!==null&&(P=d.memoizedState.cache),m.memoizedState.cache!==P&&(m.flags|=2048),Fl(rs),mr(),A.pendingContext&&(A.context=A.pendingContext,A.pendingContext=null),(d===null||d.child===null)&&(kl(m)?tu(m):d===null||d.memoizedState.isDehydrated&&(m.flags&256)===0||(m.flags|=1024,Dl())),Lr(m),null;case 26:var L=m.type,X=m.memoizedState;return d===null?(tu(m),X!==null?(Lr(m),D_(m,X)):(Lr(m),k0(m,L,null,P,A))):X?X!==d.memoizedState?(tu(m),Lr(m),D_(m,X)):(Lr(m),m.flags&=-16777217):(d=d.memoizedProps,d!==P&&tu(m),Lr(m),k0(m,L,d,P,A)),null;case 27:if(Oa(m),A=Vi.current,L=m.type,d!==null&&m.stateNode!=null)d.memoizedProps!==P&&tu(m);else{if(!P){if(m.stateNode===null)throw Error(r(166));return Lr(m),null}d=Si.current,kl(m)?ja(m):(d=ty(L,P,A),m.stateNode=d,tu(m))}return Lr(m),null;case 5:if(Oa(m),L=m.type,d!==null&&m.stateNode!=null)d.memoizedProps!==P&&tu(m);else{if(!P){if(m.stateNode===null)throw Error(r(166));return Lr(m),null}if(X=Si.current,kl(m))ja(m);else{var ae=ip(Vi.current);switch(X){case 1:X=ae.createElementNS("http://www.w3.org/2000/svg",L);break;case 2:X=ae.createElementNS("http://www.w3.org/1998/Math/MathML",L);break;default:switch(L){case"svg":X=ae.createElementNS("http://www.w3.org/2000/svg",L);break;case"math":X=ae.createElementNS("http://www.w3.org/1998/Math/MathML",L);break;case"script":X=ae.createElement("div"),X.innerHTML="<script><\/script>",X=X.removeChild(X.firstChild);break;case"select":X=typeof P.is=="string"?ae.createElement("select",{is:P.is}):ae.createElement("select"),P.multiple?X.multiple=!0:P.size&&(X.size=P.size);break;default:X=typeof P.is=="string"?ae.createElement(L,{is:P.is}):ae.createElement(L)}}X[vn]=m,X[ei]=P;e:for(ae=m.child;ae!==null;){if(ae.tag===5||ae.tag===6)X.appendChild(ae.stateNode);else if(ae.tag!==4&&ae.tag!==27&&ae.child!==null){ae.child.return=ae,ae=ae.child;continue}if(ae===m)break e;for(;ae.sibling===null;){if(ae.return===null||ae.return===m)break e;ae=ae.return}ae.sibling.return=ae.return,ae=ae.sibling}m.stateNode=X;e:switch(Es(X,L,P),L){case"button":case"input":case"select":case"textarea":P=!!P.autoFocus;break e;case"img":P=!0;break e;default:P=!1}P&&tu(m)}}return Lr(m),k0(m,m.type,d===null?null:d.memoizedProps,m.pendingProps,A),null;case 6:if(d&&m.stateNode!=null)d.memoizedProps!==P&&tu(m);else{if(typeof P!="string"&&m.stateNode===null)throw Error(r(166));if(d=Vi.current,kl(m)){if(d=m.stateNode,A=m.memoizedProps,P=null,L=js,L!==null)switch(L.tag){case 27:case 5:P=L.memoizedProps}d[vn]=m,d=!!(d.nodeValue===A||P!==null&&P.suppressHydrationWarning===!0||km(d.nodeValue,A)),d||Va(m,!0)}else d=ip(d).createTextNode(P),d[vn]=m,m.stateNode=d}return Lr(m),null;case 31:if(A=m.memoizedState,d===null||d.memoizedState!==null){if(P=kl(m),A!==null){if(d===null){if(!P)throw Error(r(318));if(d=m.memoizedState,d=d!==null?d.dehydrated:null,!d)throw Error(r(557));d[vn]=m}else Ga(),(m.flags&128)===0&&(m.memoizedState=null),m.flags|=4;Lr(m),d=!1}else A=Dl(),d!==null&&d.memoizedState!==null&&(d.memoizedState.hydrationErrors=A),d=!0;if(!d)return m.flags&256?(rn(m),m):(rn(m),null);if((m.flags&128)!==0)throw Error(r(558))}return Lr(m),null;case 13:if(P=m.memoizedState,d===null||d.memoizedState!==null&&d.memoizedState.dehydrated!==null){if(L=kl(m),P!==null&&P.dehydrated!==null){if(d===null){if(!L)throw Error(r(318));if(L=m.memoizedState,L=L!==null?L.dehydrated:null,!L)throw Error(r(317));L[vn]=m}else Ga(),(m.flags&128)===0&&(m.memoizedState=null),m.flags|=4;Lr(m),L=!1}else L=Dl(),d!==null&&d.memoizedState!==null&&(d.memoizedState.hydrationErrors=L),L=!0;if(!L)return m.flags&256?(rn(m),m):(rn(m),null)}return rn(m),(m.flags&128)!==0?(m.lanes=A,m):(A=P!==null,d=d!==null&&d.memoizedState!==null,A&&(P=m.child,L=null,P.alternate!==null&&P.alternate.memoizedState!==null&&P.alternate.memoizedState.cachePool!==null&&(L=P.alternate.memoizedState.cachePool.pool),X=null,P.memoizedState!==null&&P.memoizedState.cachePool!==null&&(X=P.memoizedState.cachePool.pool),X!==L&&(P.flags|=2048)),A!==d&&A&&(m.child.flags|=8192),D0(m,m.updateQueue),Lr(m),null);case 4:return mr(),d===null&&Im(m.stateNode.containerInfo),Lr(m),null;case 10:return Fl(m.type),Lr(m),null;case 19:if(Gt(hr),P=m.memoizedState,P===null)return Lr(m),null;if(L=(m.flags&128)!==0,X=P.rendering,X===null)if(L)O0(P,!1);else{if(ms!==0||d!==null&&(d.flags&128)!==0)for(d=m.child;d!==null;){if(X=Ch(d),X!==null){for(m.flags|=128,O0(P,!1),d=X.updateQueue,m.updateQueue=d,D0(m,d),m.subtreeFlags=0,d=A,A=m.child;A!==null;)Gp(A,d),A=A.sibling;return vi(hr,hr.current&1|2),bn&&Ia(m,P.treeForkCount),m.child}d=d.sibling}P.tail!==null&&Qr()>X0&&(m.flags|=128,L=!0,O0(P,!1),m.lanes=4194304)}else{if(!L)if(d=Ch(X),d!==null){if(m.flags|=128,L=!0,d=d.updateQueue,m.updateQueue=d,D0(m,d),O0(P,!0),P.tail===null&&P.tailMode==="hidden"&&!X.alternate&&!bn)return Lr(m),null}else 2*Qr()-P.renderingStartTime>X0&&A!==536870912&&(m.flags|=128,L=!0,O0(P,!1),m.lanes=4194304);P.isBackwards?(X.sibling=m.child,m.child=X):(d=P.last,d!==null?d.sibling=X:m.child=X,P.last=X)}return P.tail!==null?(d=P.tail,P.rendering=d,P.tail=d.sibling,P.renderingStartTime=Qr(),d.sibling=null,A=hr.current,vi(hr,L?A&1|2:A&1),bn&&Ia(m,P.treeForkCount),d):(Lr(m),null);case 22:case 23:return rn(m),Ou(),P=m.memoizedState!==null,d!==null?d.memoizedState!==null!==P&&(m.flags|=8192):P&&(m.flags|=8192),P?(A&536870912)!==0&&(m.flags&128)===0&&(Lr(m),m.subtreeFlags&6&&(m.flags|=8192)):Lr(m),A=m.updateQueue,A!==null&&D0(m,A.retryQueue),A=null,d!==null&&d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(A=d.memoizedState.cachePool.pool),P=null,m.memoizedState!==null&&m.memoizedState.cachePool!==null&&(P=m.memoizedState.cachePool.pool),P!==A&&(m.flags|=2048),d!==null&&Gt(ol),null;case 24:return A=null,d!==null&&(A=d.memoizedState.cache),m.memoizedState.cache!==A&&(m.flags|=2048),Fl(rs),Lr(m),null;case 25:return null;case 30:return null}throw Error(r(156,m.tag))}function o2(d,m){switch(Pl(m),m.tag){case 1:return d=m.flags,d&65536?(m.flags=d&-65537|128,m):null;case 3:return Fl(rs),mr(),d=m.flags,(d&65536)!==0&&(d&128)===0?(m.flags=d&-65537|128,m):null;case 26:case 27:case 5:return Oa(m),null;case 31:if(m.memoizedState!==null){if(rn(m),m.alternate===null)throw Error(r(340));Ga()}return d=m.flags,d&65536?(m.flags=d&-65537|128,m):null;case 13:if(rn(m),d=m.memoizedState,d!==null&&d.dehydrated!==null){if(m.alternate===null)throw Error(r(340));Ga()}return d=m.flags,d&65536?(m.flags=d&-65537|128,m):null;case 19:return Gt(hr),null;case 4:return mr(),null;case 10:return Fl(m.type),null;case 22:case 23:return rn(m),Ou(),d!==null&&Gt(ol),d=m.flags,d&65536?(m.flags=d&-65537|128,m):null;case 24:return Fl(rs),null;case 25:return null;default:return null}}function Fh(d,m){switch(Pl(m),m.tag){case 3:Fl(rs),mr();break;case 26:case 27:case 5:Oa(m);break;case 4:mr();break;case 31:m.memoizedState!==null&&rn(m);break;case 13:rn(m);break;case 19:Gt(hr);break;case 10:Fl(m.type);break;case 22:case 23:rn(m),Ou(),d!==null&&Gt(ol);break;case 24:Fl(rs)}}function Pd(d,m){try{var A=m.updateQueue,P=A!==null?A.lastEffect:null;if(P!==null){var L=P.next;A=L;do{if((A.tag&d)===d){P=void 0;var X=A.create,ae=A.inst;P=X(),ae.destroy=P}A=A.next}while(A!==L)}}catch(Te){Yn(m,m.return,Te)}}function Bu(d,m,A){try{var P=m.updateQueue,L=P!==null?P.lastEffect:null;if(L!==null){var X=L.next;P=X;do{if((P.tag&d)===d){var ae=P.inst,Te=ae.destroy;if(Te!==void 0){ae.destroy=void 0,L=m;var qe=A,wt=Te;try{wt()}catch(Lt){Yn(L,qe,Lt)}}}P=P.next}while(P!==X)}}catch(Lt){Yn(m,m.return,Lt)}}function om(d){var m=d.updateQueue;if(m!==null){var A=d.stateNode;try{Ad(m,A)}catch(P){Yn(d,d.return,P)}}}function O_(d,m,A){A.props=yc(d.type,d.memoizedProps),A.state=d.memoizedState;try{A.componentWillUnmount()}catch(P){Yn(d,m,P)}}function F0(d,m){try{var A=d.ref;if(A!==null){switch(d.tag){case 26:case 27:case 5:var P=d.stateNode;break;case 30:P=d.stateNode;break;default:P=d.stateNode}typeof A=="function"?d.refCleanup=A(P):A.current=P}}catch(L){Yn(d,m,L)}}function dl(d,m){var A=d.ref,P=d.refCleanup;if(A!==null)if(typeof P=="function")try{P()}catch(L){Yn(d,m,L)}finally{d.refCleanup=null,d=d.alternate,d!=null&&(d.refCleanup=null)}else if(typeof A=="function")try{A(null)}catch(L){Yn(d,m,L)}else A.current=null}function Qp(d){var m=d.type,A=d.memoizedProps,P=d.stateNode;try{e:switch(m){case"button":case"input":case"select":case"textarea":A.autoFocus&&P.focus();break e;case"img":A.src?P.src=A.src:A.srcSet&&(P.srcset=A.srcSet)}}catch(L){Yn(d,d.return,L)}}function Kp(d,m,A){try{var P=d.stateNode;K_(P,d.type,A,m),P[ei]=m}catch(L){Yn(d,d.return,L)}}function Nh(d){return d.tag===5||d.tag===3||d.tag===26||d.tag===27&&$u(d.type)||d.tag===4}function Nf(d){e:for(;;){for(;d.sibling===null;){if(d.return===null||Nh(d.return))return null;d=d.return}for(d.sibling.return=d.return,d=d.sibling;d.tag!==5&&d.tag!==6&&d.tag!==18;){if(d.tag===27&&$u(d.type)||d.flags&2||d.child===null||d.tag===4)continue e;d.child.return=d,d=d.child}if(!(d.flags&2))return d.stateNode}}function lm(d,m,A){var P=d.tag;if(P===5||P===6)d=d.stateNode,m?(A.nodeType===9?A.body:A.nodeName==="HTML"?A.ownerDocument.body:A).insertBefore(d,m):(m=A.nodeType===9?A.body:A.nodeName==="HTML"?A.ownerDocument.body:A,m.appendChild(d),A=A._reactRootContainer,A!=null||m.onclick!==null||(m.onclick=tl));else if(P!==4&&(P===27&&$u(d.type)&&(A=d.stateNode,m=null),d=d.child,d!==null))for(lm(d,m,A),d=d.sibling;d!==null;)lm(d,m,A),d=d.sibling}function N0(d,m,A){var P=d.tag;if(P===5||P===6)d=d.stateNode,m?A.insertBefore(d,m):A.appendChild(d);else if(P!==4&&(P===27&&$u(d.type)&&(A=d.stateNode),d=d.child,d!==null))for(N0(d,m,A),d=d.sibling;d!==null;)N0(d,m,A),d=d.sibling}function cm(d){var m=d.stateNode,A=d.memoizedProps;try{for(var P=d.type,L=m.attributes;L.length;)m.removeAttributeNode(L[0]);Es(m,P,A),m[vn]=d,m[ei]=A}catch(X){Yn(d,d.return,X)}}var zu=!1,Xs=!1,eg=!1,um=typeof WeakSet=="function"?WeakSet:Set,Ns=null;function l2(d,m){if(d=d.containerInfo,Zd=dp,d=g0(d),ld(d)){if("selectionStart"in d)var A={start:d.selectionStart,end:d.selectionEnd};else e:{A=(A=d.ownerDocument)&&A.defaultView||window;var P=A.getSelection&&A.getSelection();if(P&&P.rangeCount!==0){A=P.anchorNode;var L=P.anchorOffset,X=P.focusNode;P=P.focusOffset;try{A.nodeType,X.nodeType}catch{A=null;break e}var ae=0,Te=-1,qe=-1,wt=0,Lt=0,$t=d,It=null;t:for(;;){for(var Nt;$t!==A||L!==0&&$t.nodeType!==3||(Te=ae+L),$t!==X||P!==0&&$t.nodeType!==3||(qe=ae+P),$t.nodeType===3&&(ae+=$t.nodeValue.length),(Nt=$t.firstChild)!==null;)It=$t,$t=Nt;for(;;){if($t===d)break t;if(It===A&&++wt===L&&(Te=ae),It===X&&++Lt===P&&(qe=ae),(Nt=$t.nextSibling)!==null)break;$t=It,It=$t.parentNode}$t=Nt}A=Te===-1||qe===-1?null:{start:Te,end:qe}}else A=null}A=A||{start:0,end:0}}else A=null;for(Dm={focusedElem:d,selectionRange:A},dp=!1,Ns=m;Ns!==null;)if(m=Ns,d=m.child,(m.subtreeFlags&1028)!==0&&d!==null)d.return=m,Ns=d;else for(;Ns!==null;){switch(m=Ns,X=m.alternate,d=m.flags,m.tag){case 0:if((d&4)!==0&&(d=m.updateQueue,d=d!==null?d.events:null,d!==null))for(A=0;A<d.length;A++)L=d[A],L.ref.impl=L.nextImpl;break;case 11:case 15:break;case 1:if((d&1024)!==0&&X!==null){d=void 0,A=m,L=X.memoizedProps,X=X.memoizedState,P=A.stateNode;try{var Fi=yc(A.type,L);d=P.getSnapshotBeforeUpdate(Fi,X),P.__reactInternalSnapshotBeforeUpdate=d}catch(Hi){Yn(A,A.return,Hi)}}break;case 3:if((d&1024)!==0){if(d=m.stateNode.containerInfo,A=d.nodeType,A===9)Mc(d);else if(A===1)switch(d.nodeName){case"HEAD":case"HTML":case"BODY":Mc(d);break;default:d.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((d&1024)!==0)throw Error(r(163))}if(d=m.sibling,d!==null){d.return=m.return,Ns=d;break}Ns=m.return}}function hm(d,m,A){var P=A.flags;switch(A.tag){case 0:case 11:case 15:Zo(d,A),P&4&&Pd(5,A);break;case 1:if(Zo(d,A),P&4)if(d=A.stateNode,m===null)try{d.componentDidMount()}catch(ae){Yn(A,A.return,ae)}else{var L=yc(A.type,m.memoizedProps);m=m.memoizedState;try{d.componentDidUpdate(L,m,d.__reactInternalSnapshotBeforeUpdate)}catch(ae){Yn(A,A.return,ae)}}P&64&&om(A),P&512&&F0(A,A.return);break;case 3:if(Zo(d,A),P&64&&(d=A.updateQueue,d!==null)){if(m=null,A.child!==null)switch(A.child.tag){case 27:case 5:m=A.child.stateNode;break;case 1:m=A.child.stateNode}try{Ad(d,m)}catch(ae){Yn(A,A.return,ae)}}break;case 27:m===null&&P&4&&cm(A);case 26:case 5:Zo(d,A),m===null&&P&4&&Qp(A),P&512&&F0(A,A.return);break;case 12:Zo(d,A);break;case 31:Zo(d,A),P&4&&B0(d,A);break;case 13:Zo(d,A),P&4&&z0(d,A),P&64&&(d=A.memoizedState,d!==null&&(d=d.dehydrated,d!==null&&(A=cg.bind(null,A),$s(d,A))));break;case 22:if(P=A.memoizedState!==null||zu,!P){m=m!==null&&m.memoizedState!==null||Xs,L=zu;var X=Xs;zu=P,(Xs=m)&&!X?Lu(d,A,(A.subtreeFlags&8772)!==0):Zo(d,A),zu=L,Xs=X}break;case 30:break;default:Zo(d,A)}}function Id(d){var m=d.alternate;m!==null&&(d.alternate=null,Id(m)),d.child=null,d.deletions=null,d.sibling=null,d.tag===5&&(m=d.stateNode,m!==null&&Ko(m)),d.stateNode=null,d.return=null,d.dependencies=null,d.memoizedProps=null,d.memoizedState=null,d.pendingProps=null,d.stateNode=null,d.updateQueue=null}var os=null,Fn=!1;function Wo(d,m,A){for(A=A.child;A!==null;)fm(d,m,A),A=A.sibling}function fm(d,m,A){if(Fe&&typeof Fe.onCommitFiberUnmount=="function")try{Fe.onCommitFiberUnmount(ve,A)}catch{}switch(A.tag){case 26:Xs||dl(A,m),Wo(d,m,A),A.memoizedState?A.memoizedState.count--:A.stateNode&&(A=A.stateNode,A.parentNode.removeChild(A));break;case 27:Xs||dl(A,m);var P=os,L=Fn;$u(A.type)&&(os=A.stateNode,Fn=!1),Wo(d,m,A),Xd(A.stateNode),os=P,Fn=L;break;case 5:Xs||dl(A,m);case 6:if(P=os,L=Fn,os=null,Wo(d,m,A),os=P,Fn=L,os!==null)if(Fn)try{(os.nodeType===9?os.body:os.nodeName==="HTML"?os.ownerDocument.body:os).removeChild(A.stateNode)}catch(X){Yn(A,m,X)}else try{os.removeChild(A.stateNode)}catch(X){Yn(A,m,X)}break;case 18:os!==null&&(Fn?(d=os,ey(d.nodeType===9?d.body:d.nodeName==="HTML"?d.ownerDocument.body:d,A.stateNode),ef(d)):ey(os,A.stateNode));break;case 4:P=os,L=Fn,os=A.stateNode.containerInfo,Fn=!0,Wo(d,m,A),os=P,Fn=L;break;case 0:case 11:case 14:case 15:Bu(2,A,m),Xs||Bu(4,A,m),Wo(d,m,A);break;case 1:Xs||(dl(A,m),P=A.stateNode,typeof P.componentWillUnmount=="function"&&O_(A,m,P)),Wo(d,m,A);break;case 21:Wo(d,m,A);break;case 22:Xs=(P=Xs)||A.memoizedState!==null,Wo(d,m,A),Xs=P;break;default:Wo(d,m,A)}}function B0(d,m){if(m.memoizedState===null&&(d=m.alternate,d!==null&&(d=d.memoizedState,d!==null))){d=d.dehydrated;try{ef(d)}catch(A){Yn(m,m.return,A)}}}function z0(d,m){if(m.memoizedState===null&&(d=m.alternate,d!==null&&(d=d.memoizedState,d!==null&&(d=d.dehydrated,d!==null))))try{ef(d)}catch(A){Yn(m,m.return,A)}}function L0(d){switch(d.tag){case 31:case 13:case 19:var m=d.stateNode;return m===null&&(m=d.stateNode=new um),m;case 22:return d=d.stateNode,m=d._retryCache,m===null&&(m=d._retryCache=new um),m;default:throw Error(r(435,d.tag))}}function kd(d,m){var A=L0(d);m.forEach(function(P){if(!A.has(P)){A.add(P);var L=h2.bind(null,d,P);P.then(L,L)}})}function bo(d,m){var A=m.deletions;if(A!==null)for(var P=0;P<A.length;P++){var L=A[P],X=d,ae=m,Te=ae;e:for(;Te!==null;){switch(Te.tag){case 27:if($u(Te.type)){os=Te.stateNode,Fn=!1;break e}break;case 5:os=Te.stateNode,Fn=!1;break e;case 3:case 4:os=Te.stateNode.containerInfo,Fn=!0;break e}Te=Te.return}if(os===null)throw Error(r(160));fm(X,ae,L),os=null,Fn=!1,X=L.alternate,X!==null&&(X.return=null),L.return=null}if(m.subtreeFlags&13886)for(m=m.child;m!==null;)U0(m,d),m=m.sibling}var Ao=null;function U0(d,m){var A=d.alternate,P=d.flags;switch(d.tag){case 0:case 11:case 14:case 15:bo(m,d),ta(d),P&4&&(Bu(3,d,d.return),Pd(3,d),Bu(5,d,d.return));break;case 1:bo(m,d),ta(d),P&512&&(Xs||A===null||dl(A,A.return)),P&64&&zu&&(d=d.updateQueue,d!==null&&(P=d.callbacks,P!==null&&(A=d.shared.hiddenCallbacks,d.shared.hiddenCallbacks=A===null?P:A.concat(P))));break;case 26:var L=Ao;if(bo(m,d),ta(d),P&512&&(Xs||A===null||dl(A,A.return)),P&4){var X=A!==null?A.memoizedState:null;if(P=d.memoizedState,A===null)if(P===null)if(d.stateNode===null){e:{P=d.type,A=d.memoizedProps,L=L.ownerDocument||L;t:switch(P){case"title":X=L.getElementsByTagName("title")[0],(!X||X[Yi]||X[vn]||X.namespaceURI==="http://www.w3.org/2000/svg"||X.hasAttribute("itemprop"))&&(X=L.createElement(P),L.head.insertBefore(X,L.querySelector("head > title"))),Es(X,P,A),X[vn]=d,cr(X),P=X;break e;case"link":var ae=Wm("link","href",L).get(P+(A.href||""));if(ae){for(var Te=0;Te<ae.length;Te++)if(X=ae[Te],X.getAttribute("href")===(A.href==null||A.href===""?null:A.href)&&X.getAttribute("rel")===(A.rel==null?null:A.rel)&&X.getAttribute("title")===(A.title==null?null:A.title)&&X.getAttribute("crossorigin")===(A.crossOrigin==null?null:A.crossOrigin)){ae.splice(Te,1);break t}}X=L.createElement(P),Es(X,P,A),L.head.appendChild(X);break;case"meta":if(ae=Wm("meta","content",L).get(P+(A.content||""))){for(Te=0;Te<ae.length;Te++)if(X=ae[Te],X.getAttribute("content")===(A.content==null?null:""+A.content)&&X.getAttribute("name")===(A.name==null?null:A.name)&&X.getAttribute("property")===(A.property==null?null:A.property)&&X.getAttribute("http-equiv")===(A.httpEquiv==null?null:A.httpEquiv)&&X.getAttribute("charset")===(A.charSet==null?null:A.charSet)){ae.splice(Te,1);break t}}X=L.createElement(P),Es(X,P,A),L.head.appendChild(X);break;default:throw Error(r(468,P))}X[vn]=d,cr(X),P=X}d.stateNode=P}else ap(L,d.type,d.stateNode);else d.stateNode=Gm(L,P,d.memoizedProps);else X!==P?(X===null?A.stateNode!==null&&(A=A.stateNode,A.parentNode.removeChild(A)):X.count--,P===null?ap(L,d.type,d.stateNode):Gm(L,P,d.memoizedProps)):P===null&&d.stateNode!==null&&Kp(d,d.memoizedProps,A.memoizedProps)}break;case 27:bo(m,d),ta(d),P&512&&(Xs||A===null||dl(A,A.return)),A!==null&&P&4&&Kp(d,d.memoizedProps,A.memoizedProps);break;case 5:if(bo(m,d),ta(d),P&512&&(Xs||A===null||dl(A,A.return)),d.flags&32){L=d.stateNode;try{oc(L,"")}catch(Fi){Yn(d,d.return,Fi)}}P&4&&d.stateNode!=null&&(L=d.memoizedProps,Kp(d,L,A!==null?A.memoizedProps:L)),P&1024&&(eg=!0);break;case 6:if(bo(m,d),ta(d),P&4){if(d.stateNode===null)throw Error(r(162));P=d.memoizedProps,A=d.stateNode;try{A.nodeValue=P}catch(Fi){Yn(d,d.return,Fi)}}break;case 3:if(wg=null,L=Ao,Ao=xg(m.containerInfo),bo(m,d),Ao=L,ta(d),P&4&&A!==null&&A.memoizedState.isDehydrated)try{ef(m.containerInfo)}catch(Fi){Yn(d,d.return,Fi)}eg&&(eg=!1,Dd(d));break;case 4:P=Ao,Ao=xg(d.stateNode.containerInfo),bo(m,d),ta(d),Ao=P;break;case 12:bo(m,d),ta(d);break;case 31:bo(m,d),ta(d),P&4&&(P=d.updateQueue,P!==null&&(d.updateQueue=null,kd(d,P)));break;case 13:bo(m,d),ta(d),d.child.flags&8192&&d.memoizedState!==null!=(A!==null&&A.memoizedState!==null)&&(Z0=Qr()),P&4&&(P=d.updateQueue,P!==null&&(d.updateQueue=null,kd(d,P)));break;case 22:L=d.memoizedState!==null;var qe=A!==null&&A.memoizedState!==null,wt=zu,Lt=Xs;if(zu=wt||L,Xs=Lt||qe,bo(m,d),Xs=Lt,zu=wt,ta(d),P&8192)e:for(m=d.stateNode,m._visibility=L?m._visibility&-2:m._visibility|1,L&&(A===null||qe||zu||Xs||Hl(d)),A=null,m=d;;){if(m.tag===5||m.tag===26){if(A===null){qe=A=m;try{if(X=qe.stateNode,L)ae=X.style,typeof ae.setProperty=="function"?ae.setProperty("display","none","important"):ae.display="none";else{Te=qe.stateNode;var $t=qe.memoizedProps.style,It=$t!=null&&$t.hasOwnProperty("display")?$t.display:null;Te.style.display=It==null||typeof It=="boolean"?"":(""+It).trim()}}catch(Fi){Yn(qe,qe.return,Fi)}}}else if(m.tag===6){if(A===null){qe=m;try{qe.stateNode.nodeValue=L?"":qe.memoizedProps}catch(Fi){Yn(qe,qe.return,Fi)}}}else if(m.tag===18){if(A===null){qe=m;try{var Nt=qe.stateNode;L?on(Nt,!0):on(qe.stateNode,!1)}catch(Fi){Yn(qe,qe.return,Fi)}}}else if((m.tag!==22&&m.tag!==23||m.memoizedState===null||m===d)&&m.child!==null){m.child.return=m,m=m.child;continue}if(m===d)break e;for(;m.sibling===null;){if(m.return===null||m.return===d)break e;A===m&&(A=null),m=m.return}A===m&&(A=null),m.sibling.return=m.return,m=m.sibling}P&4&&(P=d.updateQueue,P!==null&&(A=P.retryQueue,A!==null&&(P.retryQueue=null,kd(d,A))));break;case 19:bo(m,d),ta(d),P&4&&(P=d.updateQueue,P!==null&&(d.updateQueue=null,kd(d,P)));break;case 30:break;case 21:break;default:bo(m,d),ta(d)}}function ta(d){var m=d.flags;if(m&2){try{for(var A,P=d.return;P!==null;){if(Nh(P)){A=P;break}P=P.return}if(A==null)throw Error(r(160));switch(A.tag){case 27:var L=A.stateNode,X=Nf(d);N0(d,X,L);break;case 5:var ae=A.stateNode;A.flags&32&&(oc(ae,""),A.flags&=-33);var Te=Nf(d);N0(d,Te,ae);break;case 3:case 4:var qe=A.stateNode.containerInfo,wt=Nf(d);lm(d,wt,qe);break;default:throw Error(r(161))}}catch(Lt){Yn(d,d.return,Lt)}d.flags&=-3}m&4096&&(d.flags&=-4097)}function Dd(d){if(d.subtreeFlags&1024)for(d=d.child;d!==null;){var m=d;Dd(m),m.tag===5&&m.flags&1024&&m.stateNode.reset(),d=d.sibling}}function Zo(d,m){if(m.subtreeFlags&8772)for(m=m.child;m!==null;)hm(d,m.alternate,m),m=m.sibling}function Hl(d){for(d=d.child;d!==null;){var m=d;switch(m.tag){case 0:case 11:case 14:case 15:Bu(4,m,m.return),Hl(m);break;case 1:dl(m,m.return);var A=m.stateNode;typeof A.componentWillUnmount=="function"&&O_(m,m.return,A),Hl(m);break;case 27:Xd(m.stateNode);case 26:case 5:dl(m,m.return),Hl(m);break;case 22:m.memoizedState===null&&Hl(m);break;case 30:Hl(m);break;default:Hl(m)}d=d.sibling}}function Lu(d,m,A){for(A=A&&(m.subtreeFlags&8772)!==0,m=m.child;m!==null;){var P=m.alternate,L=d,X=m,ae=X.flags;switch(X.tag){case 0:case 11:case 15:Lu(L,X,A),Pd(4,X);break;case 1:if(Lu(L,X,A),P=X,L=P.stateNode,typeof L.componentDidMount=="function")try{L.componentDidMount()}catch(wt){Yn(P,P.return,wt)}if(P=X,L=P.updateQueue,L!==null){var Te=P.stateNode;try{var qe=L.shared.hiddenCallbacks;if(qe!==null)for(L.shared.hiddenCallbacks=null,L=0;L<qe.length;L++)Cf(qe[L],Te)}catch(wt){Yn(P,P.return,wt)}}A&&ae&64&&om(X),F0(X,X.return);break;case 27:cm(X);case 26:case 5:Lu(L,X,A),A&&P===null&&ae&4&&Qp(X),F0(X,X.return);break;case 12:Lu(L,X,A);break;case 31:Lu(L,X,A),A&&ae&4&&B0(L,X);break;case 13:Lu(L,X,A),A&&ae&4&&z0(L,X);break;case 22:X.memoizedState===null&&Lu(L,X,A),F0(X,X.return);break;case 30:break;default:Lu(L,X,A)}m=m.sibling}}function V0(d,m){var A=null;d!==null&&d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(A=d.memoizedState.cachePool.pool),d=null,m.memoizedState!==null&&m.memoizedState.cachePool!==null&&(d=m.memoizedState.cachePool.pool),d!==A&&(d!=null&&d.refCount++,A!=null&&Ah(A))}function iu(d,m){d=null,m.alternate!==null&&(d=m.alternate.memoizedState.cache),m=m.memoizedState.cache,m!==d&&(m.refCount++,d!=null&&Ah(d))}function wc(d,m,A,P){if(m.subtreeFlags&10256)for(m=m.child;m!==null;)dm(d,m,A,P),m=m.sibling}function dm(d,m,A,P){var L=m.flags;switch(m.tag){case 0:case 11:case 15:wc(d,m,A,P),L&2048&&Pd(9,m);break;case 1:wc(d,m,A,P);break;case 3:wc(d,m,A,P),L&2048&&(d=null,m.alternate!==null&&(d=m.alternate.memoizedState.cache),m=m.memoizedState.cache,m!==d&&(m.refCount++,d!=null&&Ah(d)));break;case 12:if(L&2048){wc(d,m,A,P),d=m.stateNode;try{var X=m.memoizedProps,ae=X.id,Te=X.onPostCommit;typeof Te=="function"&&Te(ae,m.alternate===null?"mount":"update",d.passiveEffectDuration,-0)}catch(qe){Yn(m,m.return,qe)}}else wc(d,m,A,P);break;case 31:wc(d,m,A,P);break;case 13:wc(d,m,A,P);break;case 23:break;case 22:X=m.stateNode,ae=m.alternate,m.memoizedState!==null?X._visibility&2?wc(d,m,A,P):Sc(d,m):X._visibility&2?wc(d,m,A,P):(X._visibility|=2,Tc(d,m,A,P,(m.subtreeFlags&10256)!==0||!1)),L&2048&&V0(ae,m);break;case 24:wc(d,m,A,P),L&2048&&iu(m.alternate,m);break;default:wc(d,m,A,P)}}function Tc(d,m,A,P,L){for(L=L&&((m.subtreeFlags&10256)!==0||!1),m=m.child;m!==null;){var X=d,ae=m,Te=A,qe=P,wt=ae.flags;switch(ae.tag){case 0:case 11:case 15:Tc(X,ae,Te,qe,L),Pd(8,ae);break;case 23:break;case 22:var Lt=ae.stateNode;ae.memoizedState!==null?Lt._visibility&2?Tc(X,ae,Te,qe,L):Sc(X,ae):(Lt._visibility|=2,Tc(X,ae,Te,qe,L)),L&&wt&2048&&V0(ae.alternate,ae);break;case 24:Tc(X,ae,Te,qe,L),L&&wt&2048&&iu(ae.alternate,ae);break;default:Tc(X,ae,Te,qe,L)}m=m.sibling}}function Sc(d,m){if(m.subtreeFlags&10256)for(m=m.child;m!==null;){var A=d,P=m,L=P.flags;switch(P.tag){case 22:Sc(A,P),L&2048&&V0(P.alternate,P);break;case 24:Sc(A,P),L&2048&&iu(P.alternate,P);break;default:Sc(A,P)}m=m.sibling}}var Bh=8192;function zh(d,m,A){if(d.subtreeFlags&Bh)for(d=d.child;d!==null;)pm(d,m,A),d=d.sibling}function pm(d,m,A){switch(d.tag){case 26:zh(d,m,A),d.flags&Bh&&d.memoizedState!==null&&Zm(A,Ao,d.memoizedState,d.memoizedProps);break;case 5:zh(d,m,A);break;case 3:case 4:var P=Ao;Ao=xg(d.stateNode.containerInfo),zh(d,m,A),Ao=P;break;case 22:d.memoizedState===null&&(P=d.alternate,P!==null&&P.memoizedState!==null?(P=Bh,Bh=16777216,zh(d,m,A),Bh=P):zh(d,m,A));break;default:zh(d,m,A)}}function j0(d){var m=d.alternate;if(m!==null&&(d=m.child,d!==null)){m.child=null;do m=d.sibling,d.sibling=null,d=m;while(d!==null)}}function Od(d){var m=d.deletions;if((d.flags&16)!==0){if(m!==null)for(var A=0;A<m.length;A++){var P=m[A];Ns=P,Bf(P,d)}j0(d)}if(d.subtreeFlags&10256)for(d=d.child;d!==null;)gm(d),d=d.sibling}function gm(d){switch(d.tag){case 0:case 11:case 15:Od(d),d.flags&2048&&Bu(9,d,d.return);break;case 3:Od(d);break;case 12:Od(d);break;case 22:var m=d.stateNode;d.memoizedState!==null&&m._visibility&2&&(d.return===null||d.return.tag!==13)?(m._visibility&=-3,G0(d)):Od(d);break;default:Od(d)}}function G0(d){var m=d.deletions;if((d.flags&16)!==0){if(m!==null)for(var A=0;A<m.length;A++){var P=m[A];Ns=P,Bf(P,d)}j0(d)}for(d=d.child;d!==null;){switch(m=d,m.tag){case 0:case 11:case 15:Bu(8,m,m.return),G0(m);break;case 22:A=m.stateNode,A._visibility&2&&(A._visibility&=-3,G0(m));break;default:G0(m)}d=d.sibling}}function Bf(d,m){for(;Ns!==null;){var A=Ns;switch(A.tag){case 0:case 11:case 15:Bu(8,A,m);break;case 23:case 22:if(A.memoizedState!==null&&A.memoizedState.cachePool!==null){var P=A.memoizedState.cachePool.pool;P!=null&&P.refCount++}break;case 24:Ah(A.memoizedState.cache)}if(P=A.child,P!==null)P.return=A,Ns=P;else e:for(A=d;Ns!==null;){P=Ns;var L=P.sibling,X=P.return;if(Id(P),P===A){Ns=null;break e}if(L!==null){L.return=X,Ns=L;break e}Ns=X}}}var c2={getCacheForType:function(d){var m=ps(rs),A=m.data.get(d);return A===void 0&&(A=d(),m.data.set(d,A)),A},cacheSignal:function(){return ps(rs).controller.signal}},F_=typeof WeakMap=="function"?WeakMap:Map,Rn=0,Rr=null,Pn=null,hn=0,zn=0,wo=null,$l=!1,Lh=!1,tg=!1,Uu=0,ms=0,Vu=0,Uh=0,mm=0,ka=0,zf=0,W0=null,Xo=null,_m=!1,Z0=0,N_=0,X0=1/0,Fd=null,ju=null,Hs=0,Gu=null,Nd=null,pl=0,ym=0,ig=null,ng=null,H0=0,Bd=null;function Ho(){return(Rn&2)!==0&&hn!==0?hn&-hn:nt.T!==null?K0():Ar()}function B_(){if(ka===0)if((hn&536870912)===0||bn){var d=Pt;Pt<<=1,(Pt&3932160)===0&&(Pt=262144),ka=d}else ka=536870912;return d=xi.current,d!==null&&(d.flags|=32),ka}function $o(d,m,A){(d===Rr&&(zn===2||zn===9)||d.cancelPendingCommit!==null)&&(zd(d,0),jh(d,hn,ka,!1)),Bn(d,A),((Rn&2)===0||d!==Rr)&&(d===Rr&&((Rn&2)===0&&(Uh|=A),ms===4&&jh(d,hn,ka,!1)),Ec(d))}function Bs(d,m,A){if((Rn&6)!==0)throw Error(r(327));var P=!A&&(m&127)===0&&(m&d.expiredLanes)===0||Tn(d,m),L=P?Ld(d,m):sg(d,m,!0),X=P;do{if(L===0){Lh&&!P&&jh(d,m,0,!1);break}else{if(A=d.current.alternate,X&&!u2(A)){L=sg(d,m,!1),X=!1;continue}if(L===2){if(X=m,d.errorRecoveryDisabledLanes&X)var ae=0;else ae=d.pendingLanes&-536870913,ae=ae!==0?ae:ae&536870912?536870912:0;if(ae!==0){m=ae;e:{var Te=d;L=W0;var qe=Te.current.memoizedState.isDehydrated;if(qe&&(zd(Te,ae).flags|=256),ae=sg(Te,ae,!1),ae!==2){if(tg&&!qe){Te.errorRecoveryDisabledLanes|=X,Uh|=X,L=4;break e}X=Xo,Xo=L,X!==null&&(Xo===null?Xo=X:Xo.push.apply(Xo,X))}L=ae}if(X=!1,L!==2)continue}}if(L===1){zd(d,0),jh(d,m,0,!0);break}e:{switch(P=d,X=L,X){case 0:case 1:throw Error(r(345));case 4:if((m&4194048)!==m)break;case 6:jh(P,m,ka,!$l);break e;case 2:Xo=null;break;case 3:case 5:break;default:throw Error(r(329))}if((m&62914560)===m&&(L=Z0+300-Qr(),10<L)){if(jh(P,m,ka,!$l),Oi(P,0,!0)!==0)break e;pl=m,P.timeoutHandle=Hu(Vh.bind(null,P,A,Xo,Fd,_m,m,ka,Uh,zf,$l,X,"Throttled",-0,0),L);break e}Vh(P,A,Xo,Fd,_m,m,ka,Uh,zf,$l,X,null,-0,0)}}break}while(!0);Ec(d)}function Vh(d,m,A,P,L,X,ae,Te,qe,wt,Lt,$t,It,Nt){if(d.timeoutHandle=-1,$t=m.subtreeFlags,$t&8192||($t&16785408)===16785408){$t={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:tl},pm(m,X,$t);var Fi=(X&62914560)===X?Z0-Qr():(X&4194048)===X?N_-Qr():0;if(Fi=Xm($t,Fi),Fi!==null){pl=X,d.cancelPendingCommit=Fi(j_.bind(null,d,m,X,A,P,L,ae,Te,qe,Lt,$t,null,It,Nt)),jh(d,X,ae,!wt);return}}j_(d,m,X,A,P,L,ae,Te,qe)}function u2(d){for(var m=d;;){var A=m.tag;if((A===0||A===11||A===15)&&m.flags&16384&&(A=m.updateQueue,A!==null&&(A=A.stores,A!==null)))for(var P=0;P<A.length;P++){var L=A[P],X=L.getSnapshot;L=L.value;try{if(!ns(X(),L))return!1}catch{return!1}}if(A=m.child,m.subtreeFlags&16384&&A!==null)A.return=m,m=A;else{if(m===d)break;for(;m.sibling===null;){if(m.return===null||m.return===d)return!0;m=m.return}m.sibling.return=m.return,m=m.sibling}}return!0}function jh(d,m,A,P){m&=~mm,m&=~Uh,d.suspendedLanes|=m,d.pingedLanes&=~m,P&&(d.warmLanes|=m),P=d.expirationTimes;for(var L=m;0<L;){var X=31-st(L),ae=1<<X;P[X]=-1,L&=~ae}A!==0&&Kr(d,A,m)}function $0(){return(Rn&6)===0?(gl(0),!1):!0}function q0(){if(Pn!==null){if(zn===0)var d=Pn.return;else d=Pn,Lo=zo=null,jl(d),Bl=null,Iu=0,d=Pn;for(;d!==null;)Fh(d.alternate,d),d=d.return;Pn=null}}function zd(d,m){var A=d.timeoutHandle;A!==-1&&(d.timeoutHandle=-1,qh(A)),A=d.cancelPendingCommit,A!==null&&(d.cancelPendingCommit=null,A()),pl=0,q0(),Rr=d,Pn=A=fo(d.current,null),hn=m,zn=0,wo=null,$l=!1,Lh=Tn(d,m),tg=!1,zf=ka=mm=Uh=Vu=ms=0,Xo=W0=null,_m=!1,(m&8)!==0&&(m|=m&32);var P=d.entangledLanes;if(P!==0)for(d=d.entanglements,P&=m;0<P;){var L=31-st(P),X=1<<L;m|=d[L],P&=~X}return Uu=m,xh(),A}function vm(d,m){un=null,nt.H=Xn,m===ll||m===Wa?(m=Th(),zn=3):m===gc?(m=Th(),zn=4):zn=m===Ff?8:m!==null&&typeof m=="object"&&typeof m.then=="function"?6:1,wo=m,Pn===null&&(ms=1,as(d,Pa(m,d.current)))}function xm(){var d=xi.current;return d===null?!0:(hn&4194048)===hn?Mi===null:(hn&62914560)===hn||(hn&536870912)!==0?d===Mi:!1}function Lf(){var d=nt.H;return nt.H=Xn,d===null?Xn:d}function rg(){var d=nt.A;return nt.A=c2,d}function Y0(){ms=4,$l||(hn&4194048)!==hn&&xi.current!==null||(Lh=!0),(Vu&134217727)===0&&(Uh&134217727)===0||Rr===null||jh(Rr,hn,ka,!1)}function sg(d,m,A){var P=Rn;Rn|=2;var L=Lf(),X=rg();(Rr!==d||hn!==m)&&(Fd=null,zd(d,m)),m=!1;var ae=ms;e:do try{if(zn!==0&&Pn!==null){var Te=Pn,qe=wo;switch(zn){case 8:q0(),ae=6;break e;case 3:case 2:case 9:case 6:xi.current===null&&(m=!0);var wt=zn;if(zn=0,wo=null,Ud(d,Te,qe,wt),A&&Lh){ae=0;break e}break;default:wt=zn,zn=0,wo=null,Ud(d,Te,qe,wt)}}ag(),ae=ms;break}catch(Lt){vm(d,Lt)}while(!0);return m&&d.shellSuspendCounter++,Lo=zo=null,Rn=P,nt.H=L,nt.A=X,Pn===null&&(Rr=null,hn=0,xh()),ae}function ag(){for(;Pn!==null;)L_(Pn)}function Ld(d,m){var A=Rn;Rn|=2;var P=Lf(),L=rg();Rr!==d||hn!==m?(Fd=null,X0=Qr()+500,zd(d,m)):Lh=Tn(d,m);e:do try{if(zn!==0&&Pn!==null){m=Pn;var X=wo;t:switch(zn){case 1:zn=0,wo=null,Ud(d,m,X,1);break;case 2:case 9:if(wh(X)){zn=0,wo=null,U_(m);break}m=function(){zn!==2&&zn!==9||Rr!==d||(zn=7),Ec(d)},X.then(m,m);break e;case 3:zn=7;break e;case 4:zn=5;break e;case 7:wh(X)?(zn=0,wo=null,U_(m)):(zn=0,wo=null,Ud(d,m,X,7));break;case 5:var ae=null;switch(Pn.tag){case 26:ae=Pn.memoizedState;case 5:case 27:var Te=Pn;if(ae?lp(ae):Te.stateNode.complete){zn=0,wo=null;var qe=Te.sibling;if(qe!==null)Pn=qe;else{var wt=Te.return;wt!==null?(Pn=wt,J0(wt)):Pn=null}break t}}zn=0,wo=null,Ud(d,m,X,5);break;case 6:zn=0,wo=null,Ud(d,m,X,6);break;case 8:q0(),ms=6;break e;default:throw Error(r(462))}}z_();break}catch(Lt){vm(d,Lt)}while(!0);return Lo=zo=null,nt.H=P,nt.A=L,Rn=A,Pn!==null?0:(Rr=null,hn=0,xh(),ms)}function z_(){for(;Pn!==null&&!ic();)L_(Pn)}function L_(d){var m=Ha(d.alternate,d,Uu);d.memoizedProps=d.pendingProps,m===null?J0(d):Pn=m}function U_(d){var m=d,A=m.alternate;switch(m.tag){case 15:case 0:m=R0(A,m,m.pendingProps,m.type,void 0,hn);break;case 11:m=R0(A,m,m.pendingProps,m.type.render,m.ref,hn);break;case 5:jl(m);default:Fh(A,m),m=Pn=Gp(m,Uu),m=Ha(A,m,Uu)}d.memoizedProps=d.pendingProps,m===null?J0(d):Pn=m}function Ud(d,m,A,P){Lo=zo=null,jl(m),Bl=null,Iu=0;var L=m.return;try{if(Of(d,L,m,A,hn)){ms=1,as(d,Pa(A,d.current)),Pn=null;return}}catch(X){if(L!==null)throw Pn=L,X;ms=1,as(d,Pa(A,d.current)),Pn=null;return}m.flags&32768?(bn||P===1?d=!0:Lh||(hn&536870912)!==0?d=!1:($l=d=!0,(P===2||P===9||P===3||P===6)&&(P=xi.current,P!==null&&P.tag===13&&(P.flags|=16384))),V_(m,d)):J0(m)}function J0(d){var m=d;do{if((m.flags&32768)!==0){V_(m,$l);return}d=m.return;var A=Jp(m.alternate,m,Uu);if(A!==null){Pn=A;return}if(m=m.sibling,m!==null){Pn=m;return}Pn=m=d}while(m!==null);ms===0&&(ms=5)}function V_(d,m){do{var A=o2(d.alternate,d);if(A!==null){A.flags&=32767,Pn=A;return}if(A=d.return,A!==null&&(A.flags|=32768,A.subtreeFlags=0,A.deletions=null),!m&&(d=d.sibling,d!==null)){Pn=d;return}Pn=d=A}while(d!==null);ms=6,Pn=null}function j_(d,m,A,P,L,X,ae,Te,qe){d.cancelPendingCommit=null;do og();while(Hs!==0);if((Rn&6)!==0)throw Error(r(327));if(m!==null){if(m===d.current)throw Error(r(177));if(X=m.lanes|m.childLanes,X|=Su,er(d,A,X,ae,Te,qe),d===Rr&&(Pn=Rr=null,hn=0),Nd=m,Gu=d,pl=A,ym=X,ig=L,ng=P,(m.subtreeFlags&10256)!==0||(m.flags&10256)!==0?(d.callbackNode=null,d.callbackPriority=0,X_(Ls,function(){return Z_(),null})):(d.callbackNode=null,d.callbackPriority=0),P=(m.flags&13878)!==0,(m.subtreeFlags&13878)!==0||P){P=nt.T,nt.T=null,L=Ut.p,Ut.p=2,ae=Rn,Rn|=4;try{l2(d,m,A)}finally{Rn=ae,Ut.p=L,nt.T=P}}Hs=1,bm(),G_(),Am()}}function bm(){if(Hs===1){Hs=0;var d=Gu,m=Nd,A=(m.flags&13878)!==0;if((m.subtreeFlags&13878)!==0||A){A=nt.T,nt.T=null;var P=Ut.p;Ut.p=2;var L=Rn;Rn|=4;try{U0(m,d);var X=Dm,ae=g0(d.containerInfo),Te=X.focusedElem,qe=X.selectionRange;if(ae!==Te&&Te&&Te.ownerDocument&&od(Te.ownerDocument.documentElement,Te)){if(qe!==null&&ld(Te)){var wt=qe.start,Lt=qe.end;if(Lt===void 0&&(Lt=wt),"selectionStart"in Te)Te.selectionStart=wt,Te.selectionEnd=Math.min(Lt,Te.value.length);else{var $t=Te.ownerDocument||document,It=$t&&$t.defaultView||window;if(It.getSelection){var Nt=It.getSelection(),Fi=Te.textContent.length,Hi=Math.min(qe.start,Fi),dr=qe.end===void 0?Hi:Math.min(qe.end,Fi);!Nt.extend&&Hi>dr&&(ae=dr,dr=Hi,Hi=ae);var ft=wu(Te,Hi),tt=wu(Te,dr);if(ft&&tt&&(Nt.rangeCount!==1||Nt.anchorNode!==ft.node||Nt.anchorOffset!==ft.offset||Nt.focusNode!==tt.node||Nt.focusOffset!==tt.offset)){var Tt=$t.createRange();Tt.setStart(ft.node,ft.offset),Nt.removeAllRanges(),Hi>dr?(Nt.addRange(Tt),Nt.extend(tt.node,tt.offset)):(Tt.setEnd(tt.node,tt.offset),Nt.addRange(Tt))}}}}for($t=[],Nt=Te;Nt=Nt.parentNode;)Nt.nodeType===1&&$t.push({element:Nt,left:Nt.scrollLeft,top:Nt.scrollTop});for(typeof Te.focus=="function"&&Te.focus(),Te=0;Te<$t.length;Te++){var Zt=$t[Te];Zt.element.scrollLeft=Zt.left,Zt.element.scrollTop=Zt.top}}dp=!!Zd,Dm=Zd=null}finally{Rn=L,Ut.p=P,nt.T=A}}d.current=m,Hs=2}}function G_(){if(Hs===2){Hs=0;var d=Gu,m=Nd,A=(m.flags&8772)!==0;if((m.subtreeFlags&8772)!==0||A){A=nt.T,nt.T=null;var P=Ut.p;Ut.p=2;var L=Rn;Rn|=4;try{hm(d,m.alternate,m)}finally{Rn=L,Ut.p=P,nt.T=A}}Hs=3}}function Am(){if(Hs===4||Hs===3){Hs=0,so();var d=Gu,m=Nd,A=pl,P=ng;(m.subtreeFlags&10256)!==0||(m.flags&10256)!==0?Hs=5:(Hs=0,Nd=Gu=null,W_(d,d.pendingLanes));var L=d.pendingLanes;if(L===0&&(ju=null),Vt(A),m=m.stateNode,Fe&&typeof Fe.onCommitFiberRoot=="function")try{Fe.onCommitFiberRoot(ve,m,void 0,(m.current.flags&128)===128)}catch{}if(P!==null){m=nt.T,L=Ut.p,Ut.p=2,nt.T=null;try{for(var X=d.onRecoverableError,ae=0;ae<P.length;ae++){var Te=P[ae];X(Te.value,{componentStack:Te.stack})}}finally{nt.T=m,Ut.p=L}}(pl&3)!==0&&og(),Ec(d),L=d.pendingLanes,(A&261930)!==0&&(L&42)!==0?d===Bd?H0++:(H0=0,Bd=d):H0=0,gl(0)}}function W_(d,m){(d.pooledCacheLanes&=m)===0&&(m=d.pooledCache,m!=null&&(d.pooledCache=null,Ah(m)))}function og(){return bm(),G_(),Am(),Z_()}function Z_(){if(Hs!==5)return!1;var d=Gu,m=ym;ym=0;var A=Vt(pl),P=nt.T,L=Ut.p;try{Ut.p=32>A?32:A,nt.T=null,A=ig,ig=null;var X=Gu,ae=pl;if(Hs=0,Nd=Gu=null,pl=0,(Rn&6)!==0)throw Error(r(331));var Te=Rn;if(Rn|=4,gm(X.current),dm(X,X.current,ae,A),Rn=Te,gl(0,!1),Fe&&typeof Fe.onPostCommitFiberRoot=="function")try{Fe.onPostCommitFiberRoot(ve,X)}catch{}return!0}finally{Ut.p=L,nt.T=P,W_(d,m)}}function wm(d,m,A){m=Pa(A,m),m=kf(d.stateNode,m,2),d=Nr(d,m,2),d!==null&&(Bn(d,2),Ec(d))}function Yn(d,m,A){if(d.tag===3)wm(d,d,A);else for(;m!==null;){if(m.tag===3){wm(m,d,A);break}else if(m.tag===1){var P=m.stateNode;if(typeof m.type.getDerivedStateFromError=="function"||typeof P.componentDidCatch=="function"&&(ju===null||!ju.has(P))){d=Pa(A,d),A=xc(2),P=Nr(m,A,2),P!==null&&(Df(A,P,m,d),Bn(P,2),Ec(P));break}}m=m.return}}function lg(d,m,A){var P=d.pingCache;if(P===null){P=d.pingCache=new F_;var L=new Set;P.set(m,L)}else L=P.get(m),L===void 0&&(L=new Set,P.set(m,L));L.has(A)||(tg=!0,L.add(A),d=Gh.bind(null,d,m,A),m.then(d,d))}function Gh(d,m,A){var P=d.pingCache;P!==null&&P.delete(m),d.pingedLanes|=d.suspendedLanes&A,d.warmLanes&=~A,Rr===d&&(hn&A)===A&&(ms===4||ms===3&&(hn&62914560)===hn&&300>Qr()-Z0?(Rn&2)===0&&zd(d,0):mm|=A,zf===hn&&(zf=0)),Ec(d)}function Q0(d,m){m===0&&(m=ki()),d=Bo(d,m),d!==null&&(Bn(d,m),Ec(d))}function cg(d){var m=d.memoizedState,A=0;m!==null&&(A=m.retryLane),Q0(d,A)}function h2(d,m){var A=0;switch(d.tag){case 31:case 13:var P=d.stateNode,L=d.memoizedState;L!==null&&(A=L.retryLane);break;case 19:P=d.stateNode;break;case 22:P=d.stateNode._retryCache;break;default:throw Error(r(314))}P!==null&&P.delete(m),Q0(d,A)}function X_(d,m){return Nc(d,m)}var ug=null,Vd=null,Tm=!1,hg=!1,Sm=!1,Wu=0;function Ec(d){d!==Vd&&d.next===null&&(Vd===null?ug=Vd=d:Vd=Vd.next=d),hg=!0,Tm||(Tm=!0,Mm())}function gl(d,m){if(!Sm&&hg){Sm=!0;do for(var A=!1,P=ug;P!==null;){if(d!==0){var L=P.pendingLanes;if(L===0)var X=0;else{var ae=P.suspendedLanes,Te=P.pingedLanes;X=(1<<31-st(42|d)+1)-1,X&=L&~(ae&~Te),X=X&201326741?X&201326741|1:X?X|2:0}X!==0&&(A=!0,Zu(P,X))}else X=hn,X=Oi(P,P===Rr?X:0,P.cancelPendingCommit!==null||P.timeoutHandle!==-1),(X&3)===0||Tn(P,X)||(A=!0,Zu(P,X));P=P.next}while(A);Sm=!1}}function Wh(){Em()}function Em(){hg=Tm=!1;var d=0;Wu!==0&&Xu()&&(d=Wu);for(var m=Qr(),A=null,P=ug;P!==null;){var L=P.next,X=fg(P,m);X===0?(P.next=null,A===null?ug=L:A.next=L,L===null&&(Vd=A)):(A=P,(d!==0||(X&3)!==0)&&(hg=!0)),P=L}Hs!==0&&Hs!==5||gl(d),Wu!==0&&(Wu=0)}function fg(d,m){for(var A=d.suspendedLanes,P=d.pingedLanes,L=d.expirationTimes,X=d.pendingLanes&-62914561;0<X;){var ae=31-st(X),Te=1<<ae,qe=L[ae];qe===-1?((Te&A)===0||(Te&P)!==0)&&(L[ae]=bi(Te,m)):qe<=m&&(d.expiredLanes|=Te),X&=~Te}if(m=Rr,A=hn,A=Oi(d,d===m?A:0,d.cancelPendingCommit!==null||d.timeoutHandle!==-1),P=d.callbackNode,A===0||d===m&&(zn===2||zn===9)||d.cancelPendingCommit!==null)return P!==null&&P!==null&&Po(P),d.callbackNode=null,d.callbackPriority=0;if((A&3)===0||Tn(d,A)){if(m=A&-A,m===d.callbackPriority)return m;switch(P!==null&&Po(P),Vt(A)){case 2:case 8:A=Qo;break;case 32:A=Ls;break;case 268435456:A=it;break;default:A=Ls}return P=H_.bind(null,d),A=Nc(A,P),d.callbackPriority=m,d.callbackNode=A,m}return P!==null&&P!==null&&Po(P),d.callbackPriority=2,d.callbackNode=null,2}function H_(d,m){if(Hs!==0&&Hs!==5)return d.callbackNode=null,d.callbackPriority=0,null;var A=d.callbackNode;if(og()&&d.callbackNode!==A)return null;var P=hn;return P=Oi(d,d===Rr?P:0,d.cancelPendingCommit!==null||d.timeoutHandle!==-1),P===0?null:(Bs(d,P,m),fg(d,Qr()),d.callbackNode!=null&&d.callbackNode===A?H_.bind(null,d):null)}function Zu(d,m){if(og())return null;Bs(d,m,!0)}function Mm(){Nm(function(){(Rn&6)!==0?Nc(nc,Wh):Em()})}function K0(){if(Wu===0){var d=Pu;d===0&&(d=zt,zt<<=1,(zt&261888)===0&&(zt=256)),Wu=d}return Wu}function dg(d){return d==null||typeof d=="symbol"||typeof d=="boolean"?null:typeof d=="function"?d:Qi(""+d)}function pg(d,m){var A=m.ownerDocument.createElement("input");return A.name=m.name,A.value=m.value,d.id&&A.setAttribute("form",d.id),m.parentNode.insertBefore(A,m),d=new FormData(d),A.parentNode.removeChild(A),d}function jd(d,m,A,P,L){if(m==="submit"&&A&&A.stateNode===L){var X=dg((L[ei]||null).action),ae=P.submitter;ae&&(m=(m=ae[ei]||null)?dg(m.formAction):ae.getAttribute("formAction"),m!==null&&(X=m,ae=null));var Te=new gf("action","action",null,P,L);d.push({event:Te,listeners:[{instance:null,listener:function(){if(P.defaultPrevented){if(Wu!==0){var qe=ae?pg(L,ae):new FormData(L);Xr(A,{pending:!0,data:qe,method:L.method,action:X},null,qe)}}else typeof X=="function"&&(Te.preventDefault(),qe=ae?pg(L,ae):new FormData(L),Xr(A,{pending:!0,data:qe,method:L.method,action:X},X,qe))},currentTarget:L}]})}}for(var gg=0;gg<fd.length;gg++){var mg=fd[gg],Rm=mg.toLowerCase(),Cm=mg[0].toUpperCase()+mg.slice(1);ho(Rm,"on"+Cm)}ho(Af,"onAnimationEnd"),ho(wf,"onAnimationIteration"),ho(hd,"onAnimationStart"),ho("dblclick","onDoubleClick"),ho("focusin","onFocus"),ho("focusout","onBlur"),ho(Tu,"onTransitionRun"),ho(Tf,"onTransitionStart"),ho(vh,"onTransitionCancel"),ho(uo,"onTransitionEnd"),aa("onMouseEnter",["mouseout","mouseover"]),aa("onMouseLeave",["mouseout","mouseover"]),aa("onPointerEnter",["pointerout","pointerover"]),aa("onPointerLeave",["pointerout","pointerover"]),En("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),En("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),En("onBeforeInput",["compositionend","keypress","textInput","paste"]),En("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),En("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),En("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Zh="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),$_=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Zh));function q_(d,m){m=(m&4)!==0;for(var A=0;A<d.length;A++){var P=d[A],L=P.event;P=P.listeners;e:{var X=void 0;if(m)for(var ae=P.length-1;0<=ae;ae--){var Te=P[ae],qe=Te.instance,wt=Te.currentTarget;if(Te=Te.listener,qe!==X&&L.isPropagationStopped())break e;X=Te,L.currentTarget=wt;try{X(L)}catch(Lt){Ml(Lt)}L.currentTarget=null,X=qe}else for(ae=0;ae<P.length;ae++){if(Te=P[ae],qe=Te.instance,wt=Te.currentTarget,Te=Te.listener,qe!==X&&L.isPropagationStopped())break e;X=Te,L.currentTarget=wt;try{X(L)}catch(Lt){Ml(Lt)}L.currentTarget=null,X=qe}}}}function In(d,m){var A=m[en];A===void 0&&(A=m[en]=new Set);var P=d+"__bubble";A.has(P)||(yg(m,d,2,!1),A.add(P))}function Pm(d,m,A){var P=0;m&&(P|=4),yg(A,d,P,m)}var _g="_reactListening"+Math.random().toString(36).slice(2);function Im(d){if(!d[_g]){d[_g]=!0,Bc.forEach(function(A){A!=="selectionchange"&&($_.has(A)||Pm(A,!1,d),Pm(A,!0,d))});var m=d.nodeType===9?d:d.ownerDocument;m===null||m[_g]||(m[_g]=!0,Pm("selectionchange",!1,m))}}function yg(d,m,A,P){switch(Gf(m)){case 2:var L=Yd;break;case 8:L=cy;break;default:L=$m}A=L.bind(null,m,A,d),L=void 0,!Ta||m!=="touchstart"&&m!=="touchmove"&&m!=="wheel"||(L=!0),P?L!==void 0?d.addEventListener(m,A,{capture:!0,passive:L}):d.addEventListener(m,A,!0):L!==void 0?d.addEventListener(m,A,{passive:L}):d.addEventListener(m,A,!1)}function nu(d,m,A,P,L){var X=P;if((m&1)===0&&(m&2)===0&&P!==null)e:for(;;){if(P===null)return;var ae=P.tag;if(ae===3||ae===4){var Te=P.stateNode.containerInfo;if(Te===L)break;if(ae===4)for(ae=P.return;ae!==null;){var qe=ae.tag;if((qe===3||qe===4)&&ae.stateNode.containerInfo===L)return;ae=ae.return}for(;Te!==null;){if(ae=Al(Te),ae===null)return;if(qe=ae.tag,qe===5||qe===6||qe===26||qe===27){P=X=ae;continue e}Te=Te.parentNode}}P=P.return}Wn(function(){var wt=X,Lt=gh(A),$t=[];e:{var It=_0.get(d);if(It!==void 0){var Nt=gf,Fi=d;switch(d){case"keypress":if(lo(A)===0)break e;case"keydown":case"keyup":Nt=Dr;break;case"focusin":Fi="focus",Nt=Vc;break;case"focusout":Fi="blur",Nt=Vc;break;case"beforeblur":case"afterblur":Nt=Vc;break;case"click":if(A.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Nt=yu;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Nt=mh;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Nt=d0;break;case Af:case wf:case hd:Nt=Np;break;case uo:Nt=me;break;case"scroll":case"scrollend":Nt=_u;break;case"wheel":Nt=Z;break;case"copy":case"cut":case"paste":Nt=xn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Nt=bu;break;case"toggle":case"beforetoggle":Nt=c}var Hi=(m&4)!==0,dr=!Hi&&(d==="scroll"||d==="scrollend"),ft=Hi?It!==null?It+"Capture":null:It;Hi=[];for(var tt=wt,Tt;tt!==null;){var Zt=tt;if(Tt=Zt.stateNode,Zt=Zt.tag,Zt!==5&&Zt!==26&&Zt!==27||Tt===null||ft===null||(Zt=fs(tt,ft),Zt!=null&&Hi.push(Uf(tt,Zt,Tt))),dr)break;tt=tt.return}0<Hi.length&&(It=new Nt(It,Fi,null,A,Lt),$t.push({event:It,listeners:Hi}))}}if((m&7)===0){e:{if(It=d==="mouseover"||d==="pointerover",Nt=d==="mouseout"||d==="pointerout",It&&A!==rd&&(Fi=A.relatedTarget||A.fromElement)&&(Al(Fi)||Fi[Xi]))break e;if((Nt||It)&&(It=Lt.window===Lt?Lt:(It=Lt.ownerDocument)?It.defaultView||It.parentWindow:window,Nt?(Fi=A.relatedTarget||A.toElement,Nt=wt,Fi=Fi?Al(Fi):null,Fi!==null&&(dr=p(Fi),Hi=Fi.tag,Fi!==dr||Hi!==5&&Hi!==27&&Hi!==6)&&(Fi=null)):(Nt=null,Fi=wt),Nt!==Fi)){if(Hi=yu,Zt="onMouseLeave",ft="onMouseEnter",tt="mouse",(d==="pointerout"||d==="pointerover")&&(Hi=bu,Zt="onPointerLeave",ft="onPointerEnter",tt="pointer"),dr=Nt==null?It:wl(Nt),Tt=Fi==null?It:wl(Fi),It=new Hi(Zt,tt+"leave",Nt,A,Lt),It.target=dr,It.relatedTarget=Tt,Zt=null,Al(Lt)===wt&&(Hi=new Hi(ft,tt+"enter",Fi,A,Lt),Hi.target=Tt,Hi.relatedTarget=dr,Zt=Hi),dr=Zt,Nt&&Fi)t:{for(Hi=Y_,ft=Nt,tt=Fi,Tt=0,Zt=ft;Zt;Zt=Hi(Zt))Tt++;Zt=0;for(var Zi=tt;Zi;Zi=Hi(Zi))Zt++;for(;0<Tt-Zt;)ft=Hi(ft),Tt--;for(;0<Zt-Tt;)tt=Hi(tt),Zt--;for(;Tt--;){if(ft===tt||tt!==null&&ft===tt.alternate){Hi=ft;break t}ft=Hi(ft),tt=Hi(tt)}Hi=null}else Hi=null;Nt!==null&&Xh($t,It,Nt,Hi,!1),Fi!==null&&dr!==null&&Xh($t,dr,Fi,Hi,!0)}}e:{if(It=wt?wl(wt):window,Nt=It.nodeName&&It.nodeName.toLowerCase(),Nt==="select"||Nt==="input"&&It.type==="file")var Qn=Gc;else if(pn(It))if(ir)Qn=Vp;else{Qn=p0;var Ni=Up}else Nt=It.nodeName,!Nt||Nt.toLowerCase()!=="input"||It.type!=="checkbox"&&It.type!=="radio"?wt&&ko(wt.elementType)&&(Qn=Gc):Qn=Sl;if(Qn&&(Qn=Qn(d,wt))){No($t,Qn,A,Lt);break e}Ni&&Ni(d,It,wt),d==="focusout"&&wt&&It.type==="number"&&wt.memoizedProps.value!=null&&sc(It,"number",It.value)}switch(Ni=wt?wl(wt):window,d){case"focusin":(pn(Ni)||Ni.contentEditable==="true")&&(il=Ni,xf=wt,bf=null);break;case"focusout":bf=xf=il=null;break;case"mousedown":ud=!0;break;case"contextmenu":case"mouseup":case"dragend":ud=!1,m0($t,A,Lt);break;case"selectionchange":if(cd)break;case"keydown":case"keyup":m0($t,A,Lt)}var ji;if(Ft)e:{switch(d){case"compositionstart":var An="onCompositionStart";break e;case"compositionend":An="onCompositionEnd";break e;case"compositionupdate":An="onCompositionUpdate";break e}An=void 0}else Or?ur(d,A)&&(An="onCompositionEnd"):d==="keydown"&&A.keyCode===229&&(An="onCompositionStart");An&&(dt&&A.locale!=="ko"&&(Or||An!=="onCompositionStart"?An==="onCompositionEnd"&&Or&&(ji=za()):(oo=Lt,Do="value"in oo?oo.value:oo.textContent,Or=!0)),Ni=ep(wt,An),0<Ni.length&&(An=new h0(An,d,null,A,Lt),$t.push({event:An,listeners:Ni}),ji?An.data=ji:(ji=Us(A),ji!==null&&(An.data=ji)))),(ji=si?La(d,A):jc(d,A))&&(An=ep(wt,"onBeforeInput"),0<An.length&&(Ni=new h0("onBeforeInput","beforeinput",null,A,Lt),$t.push({event:Ni,listeners:An}),Ni.data=ji)),jd($t,d,wt,A,Lt)}q_($t,m)})}function Uf(d,m,A){return{instance:d,listener:m,currentTarget:A}}function ep(d,m){for(var A=m+"Capture",P=[];d!==null;){var L=d,X=L.stateNode;if(L=L.tag,L!==5&&L!==26&&L!==27||X===null||(L=fs(d,A),L!=null&&P.unshift(Uf(d,L,X)),L=fs(d,m),L!=null&&P.push(Uf(d,L,X))),d.tag===3)return P;d=d.return}return[]}function Y_(d){if(d===null)return null;do d=d.return;while(d&&d.tag!==5&&d.tag!==27);return d||null}function Xh(d,m,A,P,L){for(var X=m._reactName,ae=[];A!==null&&A!==P;){var Te=A,qe=Te.alternate,wt=Te.stateNode;if(Te=Te.tag,qe!==null&&qe===P)break;Te!==5&&Te!==26&&Te!==27||wt===null||(qe=wt,L?(wt=fs(A,X),wt!=null&&ae.unshift(Uf(A,wt,qe))):L||(wt=fs(A,X),wt!=null&&ae.push(Uf(A,wt,qe)))),A=A.return}ae.length!==0&&d.push({event:m,listeners:ae})}var J_=/\r\n?/g,Q_=/\u0000|\uFFFD/g;function tp(d){return(typeof d=="string"?d:""+d).replace(J_,`
`).replace(Q_,"")}function km(d,m){return m=tp(m),tp(d)===m}function Jn(d,m,A,P,L,X){switch(A){case"children":typeof P=="string"?m==="body"||m==="textarea"&&P===""||oc(d,P):(typeof P=="number"||typeof P=="bigint")&&m!=="body"&&oc(d,""+P);break;case"className":Tl(d,"class",P);break;case"tabIndex":Tl(d,"tabindex",P);break;case"dir":case"role":case"viewBox":case"width":case"height":Tl(d,A,P);break;case"style":nd(d,P,X);break;case"data":if(m!=="object"){Tl(d,"data",P);break}case"src":case"href":if(P===""&&(m!=="a"||A!=="href")){d.removeAttribute(A);break}if(P==null||typeof P=="function"||typeof P=="symbol"||typeof P=="boolean"){d.removeAttribute(A);break}P=Qi(""+P),d.setAttribute(A,P);break;case"action":case"formAction":if(typeof P=="function"){d.setAttribute(A,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof X=="function"&&(A==="formAction"?(m!=="input"&&Jn(d,m,"name",L.name,L,null),Jn(d,m,"formEncType",L.formEncType,L,null),Jn(d,m,"formMethod",L.formMethod,L,null),Jn(d,m,"formTarget",L.formTarget,L,null)):(Jn(d,m,"encType",L.encType,L,null),Jn(d,m,"method",L.method,L,null),Jn(d,m,"target",L.target,L,null)));if(P==null||typeof P=="symbol"||typeof P=="boolean"){d.removeAttribute(A);break}P=Qi(""+P),d.setAttribute(A,P);break;case"onClick":P!=null&&(d.onclick=tl);break;case"onScroll":P!=null&&In("scroll",d);break;case"onScrollEnd":P!=null&&In("scrollend",d);break;case"dangerouslySetInnerHTML":if(P!=null){if(typeof P!="object"||!("__html"in P))throw Error(r(61));if(A=P.__html,A!=null){if(L.children!=null)throw Error(r(60));d.innerHTML=A}}break;case"multiple":d.multiple=P&&typeof P!="function"&&typeof P!="symbol";break;case"muted":d.muted=P&&typeof P!="function"&&typeof P!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(P==null||typeof P=="function"||typeof P=="boolean"||typeof P=="symbol"){d.removeAttribute("xlink:href");break}A=Qi(""+P),d.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",A);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":P!=null&&typeof P!="function"&&typeof P!="symbol"?d.setAttribute(A,""+P):d.removeAttribute(A);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":P&&typeof P!="function"&&typeof P!="symbol"?d.setAttribute(A,""):d.removeAttribute(A);break;case"capture":case"download":P===!0?d.setAttribute(A,""):P!==!1&&P!=null&&typeof P!="function"&&typeof P!="symbol"?d.setAttribute(A,P):d.removeAttribute(A);break;case"cols":case"rows":case"size":case"span":P!=null&&typeof P!="function"&&typeof P!="symbol"&&!isNaN(P)&&1<=P?d.setAttribute(A,P):d.removeAttribute(A);break;case"rowSpan":case"start":P==null||typeof P=="function"||typeof P=="symbol"||isNaN(P)?d.removeAttribute(A):d.setAttribute(A,P);break;case"popover":In("beforetoggle",d),In("toggle",d),du(d,"popover",P);break;case"xlinkActuate":Io(d,"http://www.w3.org/1999/xlink","xlink:actuate",P);break;case"xlinkArcrole":Io(d,"http://www.w3.org/1999/xlink","xlink:arcrole",P);break;case"xlinkRole":Io(d,"http://www.w3.org/1999/xlink","xlink:role",P);break;case"xlinkShow":Io(d,"http://www.w3.org/1999/xlink","xlink:show",P);break;case"xlinkTitle":Io(d,"http://www.w3.org/1999/xlink","xlink:title",P);break;case"xlinkType":Io(d,"http://www.w3.org/1999/xlink","xlink:type",P);break;case"xmlBase":Io(d,"http://www.w3.org/XML/1998/namespace","xml:base",P);break;case"xmlLang":Io(d,"http://www.w3.org/XML/1998/namespace","xml:lang",P);break;case"xmlSpace":Io(d,"http://www.w3.org/XML/1998/namespace","xml:space",P);break;case"is":du(d,"is",P);break;case"innerText":case"textContent":break;default:(!(2<A.length)||A[0]!=="o"&&A[0]!=="O"||A[1]!=="n"&&A[1]!=="N")&&(A=lc.get(A)||A,du(d,A,P))}}function Gd(d,m,A,P,L,X){switch(A){case"style":nd(d,P,X);break;case"dangerouslySetInnerHTML":if(P!=null){if(typeof P!="object"||!("__html"in P))throw Error(r(61));if(A=P.__html,A!=null){if(L.children!=null)throw Error(r(60));d.innerHTML=A}}break;case"children":typeof P=="string"?oc(d,P):(typeof P=="number"||typeof P=="bigint")&&oc(d,""+P);break;case"onScroll":P!=null&&In("scroll",d);break;case"onScrollEnd":P!=null&&In("scrollend",d);break;case"onClick":P!=null&&(d.onclick=tl);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!sa.hasOwnProperty(A))e:{if(A[0]==="o"&&A[1]==="n"&&(L=A.endsWith("Capture"),m=A.slice(2,L?A.length-7:void 0),X=d[ei]||null,X=X!=null?X[A]:null,typeof X=="function"&&d.removeEventListener(m,X,L),typeof P=="function")){typeof X!="function"&&X!==null&&(A in d?d[A]=null:d.hasAttribute(A)&&d.removeAttribute(A)),d.addEventListener(m,P,L);break e}A in d?d[A]=P:P===!0?d.setAttribute(A,""):du(d,A,P)}}}function Es(d,m,A){switch(m){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":In("error",d),In("load",d);var P=!1,L=!1,X;for(X in A)if(A.hasOwnProperty(X)){var ae=A[X];if(ae!=null)switch(X){case"src":P=!0;break;case"srcSet":L=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(r(137,m));default:Jn(d,m,X,ae,A,null)}}L&&Jn(d,m,"srcSet",A.srcSet,A,null),P&&Jn(d,m,"src",A.src,A,null);return;case"input":In("invalid",d);var Te=X=ae=L=null,qe=null,wt=null;for(P in A)if(A.hasOwnProperty(P)){var Lt=A[P];if(Lt!=null)switch(P){case"name":L=Lt;break;case"type":ae=Lt;break;case"checked":qe=Lt;break;case"defaultChecked":wt=Lt;break;case"value":X=Lt;break;case"defaultValue":Te=Lt;break;case"children":case"dangerouslySetInnerHTML":if(Lt!=null)throw Error(r(137,m));break;default:Jn(d,m,P,Lt,A,null)}}id(d,X,Te,qe,wt,ae,L,!1);return;case"select":In("invalid",d),P=ae=X=null;for(L in A)if(A.hasOwnProperty(L)&&(Te=A[L],Te!=null))switch(L){case"value":X=Te;break;case"defaultValue":ae=Te;break;case"multiple":P=Te;default:Jn(d,m,L,Te,A,null)}m=X,A=ae,d.multiple=!!P,m!=null?Lc(d,!!P,m,!1):A!=null&&Lc(d,!!P,A,!0);return;case"textarea":In("invalid",d),X=L=P=null;for(ae in A)if(A.hasOwnProperty(ae)&&(Te=A[ae],Te!=null))switch(ae){case"value":P=Te;break;case"defaultValue":L=Te;break;case"children":X=Te;break;case"dangerouslySetInnerHTML":if(Te!=null)throw Error(r(91));break;default:Jn(d,m,ae,Te,A,null)}ac(d,P,L,X);return;case"option":for(qe in A)if(A.hasOwnProperty(qe)&&(P=A[qe],P!=null))switch(qe){case"selected":d.selected=P&&typeof P!="function"&&typeof P!="symbol";break;default:Jn(d,m,qe,P,A,null)}return;case"dialog":In("beforetoggle",d),In("toggle",d),In("cancel",d),In("close",d);break;case"iframe":case"object":In("load",d);break;case"video":case"audio":for(P=0;P<Zh.length;P++)In(Zh[P],d);break;case"image":In("error",d),In("load",d);break;case"details":In("toggle",d);break;case"embed":case"source":case"link":In("error",d),In("load",d);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(wt in A)if(A.hasOwnProperty(wt)&&(P=A[wt],P!=null))switch(wt){case"children":case"dangerouslySetInnerHTML":throw Error(r(137,m));default:Jn(d,m,wt,P,A,null)}return;default:if(ko(m)){for(Lt in A)A.hasOwnProperty(Lt)&&(P=A[Lt],P!==void 0&&Gd(d,m,Lt,P,A,void 0));return}}for(Te in A)A.hasOwnProperty(Te)&&(P=A[Te],P!=null&&Jn(d,m,Te,P,A,null))}function K_(d,m,A,P){switch(m){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var L=null,X=null,ae=null,Te=null,qe=null,wt=null,Lt=null;for(Nt in A){var $t=A[Nt];if(A.hasOwnProperty(Nt)&&$t!=null)switch(Nt){case"checked":break;case"value":break;case"defaultValue":qe=$t;default:P.hasOwnProperty(Nt)||Jn(d,m,Nt,null,P,$t)}}for(var It in P){var Nt=P[It];if($t=A[It],P.hasOwnProperty(It)&&(Nt!=null||$t!=null))switch(It){case"type":X=Nt;break;case"name":L=Nt;break;case"checked":wt=Nt;break;case"defaultChecked":Lt=Nt;break;case"value":ae=Nt;break;case"defaultValue":Te=Nt;break;case"children":case"dangerouslySetInnerHTML":if(Nt!=null)throw Error(r(137,m));break;default:Nt!==$t&&Jn(d,m,It,Nt,P,$t)}}pf(d,ae,Te,qe,wt,Lt,X,L);return;case"select":Nt=ae=Te=It=null;for(X in A)if(qe=A[X],A.hasOwnProperty(X)&&qe!=null)switch(X){case"value":break;case"multiple":Nt=qe;default:P.hasOwnProperty(X)||Jn(d,m,X,null,P,qe)}for(L in P)if(X=P[L],qe=A[L],P.hasOwnProperty(L)&&(X!=null||qe!=null))switch(L){case"value":It=X;break;case"defaultValue":Te=X;break;case"multiple":ae=X;default:X!==qe&&Jn(d,m,L,X,P,qe)}m=Te,A=ae,P=Nt,It!=null?Lc(d,!!A,It,!1):!!P!=!!A&&(m!=null?Lc(d,!!A,m,!0):Lc(d,!!A,A?[]:"",!1));return;case"textarea":Nt=It=null;for(Te in A)if(L=A[Te],A.hasOwnProperty(Te)&&L!=null&&!P.hasOwnProperty(Te))switch(Te){case"value":break;case"children":break;default:Jn(d,m,Te,null,P,L)}for(ae in P)if(L=P[ae],X=A[ae],P.hasOwnProperty(ae)&&(L!=null||X!=null))switch(ae){case"value":It=L;break;case"defaultValue":Nt=L;break;case"children":break;case"dangerouslySetInnerHTML":if(L!=null)throw Error(r(91));break;default:L!==X&&Jn(d,m,ae,L,P,X)}Op(d,It,Nt);return;case"option":for(var Fi in A)if(It=A[Fi],A.hasOwnProperty(Fi)&&It!=null&&!P.hasOwnProperty(Fi))switch(Fi){case"selected":d.selected=!1;break;default:Jn(d,m,Fi,null,P,It)}for(qe in P)if(It=P[qe],Nt=A[qe],P.hasOwnProperty(qe)&&It!==Nt&&(It!=null||Nt!=null))switch(qe){case"selected":d.selected=It&&typeof It!="function"&&typeof It!="symbol";break;default:Jn(d,m,qe,It,P,Nt)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Hi in A)It=A[Hi],A.hasOwnProperty(Hi)&&It!=null&&!P.hasOwnProperty(Hi)&&Jn(d,m,Hi,null,P,It);for(wt in P)if(It=P[wt],Nt=A[wt],P.hasOwnProperty(wt)&&It!==Nt&&(It!=null||Nt!=null))switch(wt){case"children":case"dangerouslySetInnerHTML":if(It!=null)throw Error(r(137,m));break;default:Jn(d,m,wt,It,P,Nt)}return;default:if(ko(m)){for(var dr in A)It=A[dr],A.hasOwnProperty(dr)&&It!==void 0&&!P.hasOwnProperty(dr)&&Gd(d,m,dr,void 0,P,It);for(Lt in P)It=P[Lt],Nt=A[Lt],!P.hasOwnProperty(Lt)||It===Nt||It===void 0&&Nt===void 0||Gd(d,m,Lt,It,P,Nt);return}}for(var ft in A)It=A[ft],A.hasOwnProperty(ft)&&It!=null&&!P.hasOwnProperty(ft)&&Jn(d,m,ft,null,P,It);for($t in P)It=P[$t],Nt=A[$t],!P.hasOwnProperty($t)||It===Nt||It==null&&Nt==null||Jn(d,m,$t,It,P,Nt)}function qo(d){switch(d){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function Wd(){if(typeof performance.getEntriesByType=="function"){for(var d=0,m=0,A=performance.getEntriesByType("resource"),P=0;P<A.length;P++){var L=A[P],X=L.transferSize,ae=L.initiatorType,Te=L.duration;if(X&&Te&&qo(ae)){for(ae=0,Te=L.responseEnd,P+=1;P<A.length;P++){var qe=A[P],wt=qe.startTime;if(wt>Te)break;var Lt=qe.transferSize,$t=qe.initiatorType;Lt&&qo($t)&&(qe=qe.responseEnd,ae+=Lt*(qe<Te?1:(Te-wt)/(qe-wt)))}if(--P,m+=8*(X+ae)/(L.duration/1e3),d++,10<d)break}}if(0<d)return m/d/1e6}return navigator.connection&&(d=navigator.connection.downlink,typeof d=="number")?d:5}var Zd=null,Dm=null;function ip(d){return d.nodeType===9?d:d.ownerDocument}function Hh(d){switch(d){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Om(d,m){if(d===0)switch(m){case"svg":return 1;case"math":return 2;default:return 0}return d===1&&m==="foreignObject"?0:d}function vg(d,m){return d==="textarea"||d==="noscript"||typeof m.children=="string"||typeof m.children=="number"||typeof m.children=="bigint"||typeof m.dangerouslySetInnerHTML=="object"&&m.dangerouslySetInnerHTML!==null&&m.dangerouslySetInnerHTML.__html!=null}var $h=null;function Xu(){var d=window.event;return d&&d.type==="popstate"?d===$h?!1:($h=d,!0):($h=null,!1)}var Hu=typeof setTimeout=="function"?setTimeout:void 0,qh=typeof clearTimeout=="function"?clearTimeout:void 0,Fm=typeof Promise=="function"?Promise:void 0,Nm=typeof queueMicrotask=="function"?queueMicrotask:typeof Fm<"u"?function(d){return Fm.resolve(null).then(d).catch(np)}:Hu;function np(d){setTimeout(function(){throw d})}function $u(d){return d==="head"}function ey(d,m){var A=m,P=0;do{var L=A.nextSibling;if(d.removeChild(A),L&&L.nodeType===8)if(A=L.data,A==="/$"||A==="/&"){if(P===0){d.removeChild(L),ef(m);return}P--}else if(A==="$"||A==="$?"||A==="$~"||A==="$!"||A==="&")P++;else if(A==="html")Xd(d.ownerDocument.documentElement);else if(A==="head"){A=d.ownerDocument.head,Xd(A);for(var X=A.firstChild;X;){var ae=X.nextSibling,Te=X.nodeName;X[Yi]||Te==="SCRIPT"||Te==="STYLE"||Te==="LINK"&&X.rel.toLowerCase()==="stylesheet"||A.removeChild(X),X=ae}}else A==="body"&&Xd(d.ownerDocument.body);A=L}while(A);ef(m)}function on(d,m){var A=d;d=0;do{var P=A.nextSibling;if(A.nodeType===1?m?(A._stashedDisplay=A.style.display,A.style.display="none"):(A.style.display=A._stashedDisplay||"",A.getAttribute("style")===""&&A.removeAttribute("style")):A.nodeType===3&&(m?(A._stashedText=A.nodeValue,A.nodeValue=""):A.nodeValue=A._stashedText||""),P&&P.nodeType===8)if(A=P.data,A==="/$"){if(d===0)break;d--}else A!=="$"&&A!=="$?"&&A!=="$~"&&A!=="$!"||d++;A=P}while(A)}function Mc(d){var m=d.firstChild;for(m&&m.nodeType===10&&(m=m.nextSibling);m;){var A=m;switch(m=m.nextSibling,A.nodeName){case"HTML":case"HEAD":case"BODY":Mc(A),Ko(A);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(A.rel.toLowerCase()==="stylesheet")continue}d.removeChild(A)}}function ha(d,m,A,P){for(;d.nodeType===1;){var L=A;if(d.nodeName.toLowerCase()!==m.toLowerCase()){if(!P&&(d.nodeName!=="INPUT"||d.type!=="hidden"))break}else if(P){if(!d[Yi])switch(m){case"meta":if(!d.hasAttribute("itemprop"))break;return d;case"link":if(X=d.getAttribute("rel"),X==="stylesheet"&&d.hasAttribute("data-precedence"))break;if(X!==L.rel||d.getAttribute("href")!==(L.href==null||L.href===""?null:L.href)||d.getAttribute("crossorigin")!==(L.crossOrigin==null?null:L.crossOrigin)||d.getAttribute("title")!==(L.title==null?null:L.title))break;return d;case"style":if(d.hasAttribute("data-precedence"))break;return d;case"script":if(X=d.getAttribute("src"),(X!==(L.src==null?null:L.src)||d.getAttribute("type")!==(L.type==null?null:L.type)||d.getAttribute("crossorigin")!==(L.crossOrigin==null?null:L.crossOrigin))&&X&&d.hasAttribute("async")&&!d.hasAttribute("itemprop"))break;return d;default:return d}}else if(m==="input"&&d.type==="hidden"){var X=L.name==null?null:""+L.name;if(L.type==="hidden"&&d.getAttribute("name")===X)return d}else return d;if(d=ml(d.nextSibling),d===null)break}return null}function Rc(d,m,A){if(m==="")return null;for(;d.nodeType!==3;)if((d.nodeType!==1||d.nodeName!=="INPUT"||d.type!=="hidden")&&!A||(d=ml(d.nextSibling),d===null))return null;return d}function Yh(d,m){for(;d.nodeType!==8;)if((d.nodeType!==1||d.nodeName!=="INPUT"||d.type!=="hidden")&&!m||(d=ml(d.nextSibling),d===null))return null;return d}function $a(d){return d.data==="$?"||d.data==="$~"}function Ms(d){return d.data==="$!"||d.data==="$?"&&d.ownerDocument.readyState!=="loading"}function $s(d,m){var A=d.ownerDocument;if(d.data==="$~")d._reactRetry=m;else if(d.data!=="$?"||A.readyState!=="loading")m();else{var P=function(){m(),A.removeEventListener("DOMContentLoaded",P)};A.addEventListener("DOMContentLoaded",P),d._reactRetry=P}}function ml(d){for(;d!=null;d=d.nextSibling){var m=d.nodeType;if(m===1||m===3)break;if(m===8){if(m=d.data,m==="$"||m==="$!"||m==="$?"||m==="$~"||m==="&"||m==="F!"||m==="F")break;if(m==="/$"||m==="/&")return null}}return d}var qa=null;function qs(d){d=d.nextSibling;for(var m=0;d;){if(d.nodeType===8){var A=d.data;if(A==="/$"||A==="/&"){if(m===0)return ml(d.nextSibling);m--}else A!=="$"&&A!=="$!"&&A!=="$?"&&A!=="$~"&&A!=="&"||m++}d=d.nextSibling}return null}function rp(d){d=d.previousSibling;for(var m=0;d;){if(d.nodeType===8){var A=d.data;if(A==="$"||A==="$!"||A==="$?"||A==="$~"||A==="&"){if(m===0)return d;m--}else A!=="/$"&&A!=="/&"||m++}d=d.previousSibling}return null}function ty(d,m,A){switch(m=ip(A),d){case"html":if(d=m.documentElement,!d)throw Error(r(452));return d;case"head":if(d=m.head,!d)throw Error(r(453));return d;case"body":if(d=m.body,!d)throw Error(r(454));return d;default:throw Error(r(451))}}function Xd(d){for(var m=d.attributes;m.length;)d.removeAttributeNode(m[0]);Ko(d)}var fa=new Map,Vf=new Set;function xg(d){return typeof d.getRootNode=="function"?d.getRootNode():d.nodeType===9?d:d.ownerDocument}var ru=Ut.d;Ut.d={f:iy,r:ny,D:zm,C:Ya,L:Cc,m:Ja,X:bg,S:qu,M:Lm};function iy(){var d=ru.f(),m=$0();return d||m}function ny(d){var m=rc(d);m!==null&&m.tag===5&&m.type==="form"?fr(m):ru.r(d)}var Jh=typeof document>"u"?null:document;function Bm(d,m,A){var P=Jh;if(P&&typeof m=="string"&&m){var L=Aa(m);L='link[rel="'+d+'"][href="'+L+'"]',typeof A=="string"&&(L+='[crossorigin="'+A+'"]'),Vf.has(L)||(Vf.add(L),d={rel:d,crossOrigin:A,href:m},P.querySelector(L)===null&&(m=P.createElement("link"),Es(m,"link",d),cr(m),P.head.appendChild(m)))}}function zm(d){ru.D(d),Bm("dns-prefetch",d,null)}function Ya(d,m){ru.C(d,m),Bm("preconnect",d,m)}function Cc(d,m,A){ru.L(d,m,A);var P=Jh;if(P&&d&&m){var L='link[rel="preload"][as="'+Aa(m)+'"]';m==="image"&&A&&A.imageSrcSet?(L+='[imagesrcset="'+Aa(A.imageSrcSet)+'"]',typeof A.imageSizes=="string"&&(L+='[imagesizes="'+Aa(A.imageSizes)+'"]')):L+='[href="'+Aa(d)+'"]';var X=L;switch(m){case"style":X=jf(d);break;case"script":X=Yu(d)}fa.has(X)||(d=j({rel:"preload",href:m==="image"&&A&&A.imageSrcSet?void 0:d,as:m},A),fa.set(X,d),P.querySelector(L)!==null||m==="style"&&P.querySelector(Hd(X))||m==="script"&&P.querySelector($d(X))||(m=P.createElement("link"),Es(m,"link",d),cr(m),P.head.appendChild(m)))}}function Ja(d,m){ru.m(d,m);var A=Jh;if(A&&d){var P=m&&typeof m.as=="string"?m.as:"script",L='link[rel="modulepreload"][as="'+Aa(P)+'"][href="'+Aa(d)+'"]',X=L;switch(P){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":X=Yu(d)}if(!fa.has(X)&&(d=j({rel:"modulepreload",href:d},m),fa.set(X,d),A.querySelector(L)===null)){switch(P){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(A.querySelector($d(X)))return}P=A.createElement("link"),Es(P,"link",d),cr(P),A.head.appendChild(P)}}}function qu(d,m,A){ru.S(d,m,A);var P=Jh;if(P&&d){var L=Ba(P).hoistableStyles,X=jf(d);m=m||"default";var ae=L.get(X);if(!ae){var Te={loading:0,preload:null};if(ae=P.querySelector(Hd(X)))Te.loading=5;else{d=j({rel:"stylesheet",href:d,"data-precedence":m},A),(A=fa.get(X))&&sp(d,A);var qe=ae=P.createElement("link");cr(qe),Es(qe,"link",d),qe._p=new Promise(function(wt,Lt){qe.onload=wt,qe.onerror=Lt}),qe.addEventListener("load",function(){Te.loading|=1}),qe.addEventListener("error",function(){Te.loading|=2}),Te.loading|=4,Ju(ae,m,P)}ae={type:"stylesheet",instance:ae,count:1,state:Te},L.set(X,ae)}}}function bg(d,m){ru.X(d,m);var A=Jh;if(A&&d){var P=Ba(A).hoistableScripts,L=Yu(d),X=P.get(L);X||(X=A.querySelector($d(L)),X||(d=j({src:d,async:!0},m),(m=fa.get(L))&&Ag(d,m),X=A.createElement("script"),cr(X),Es(X,"link",d),A.head.appendChild(X)),X={type:"script",instance:X,count:1,state:null},P.set(L,X))}}function Lm(d,m){ru.M(d,m);var A=Jh;if(A&&d){var P=Ba(A).hoistableScripts,L=Yu(d),X=P.get(L);X||(X=A.querySelector($d(L)),X||(d=j({src:d,async:!0,type:"module"},m),(m=fa.get(L))&&Ag(d,m),X=A.createElement("script"),cr(X),Es(X,"link",d),A.head.appendChild(X)),X={type:"script",instance:X,count:1,state:null},P.set(L,X))}}function Um(d,m,A,P){var L=(L=Vi.current)?xg(L):null;if(!L)throw Error(r(446));switch(d){case"meta":case"title":return null;case"style":return typeof A.precedence=="string"&&typeof A.href=="string"?(m=jf(A.href),A=Ba(L).hoistableStyles,P=A.get(m),P||(P={type:"style",instance:null,count:0,state:null},A.set(m,P)),P):{type:"void",instance:null,count:0,state:null};case"link":if(A.rel==="stylesheet"&&typeof A.href=="string"&&typeof A.precedence=="string"){d=jf(A.href);var X=Ba(L).hoistableStyles,ae=X.get(d);if(ae||(L=L.ownerDocument||L,ae={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},X.set(d,ae),(X=L.querySelector(Hd(d)))&&!X._p&&(ae.instance=X,ae.state.loading=5),fa.has(d)||(A={rel:"preload",as:"style",href:A.href,crossOrigin:A.crossOrigin,integrity:A.integrity,media:A.media,hrefLang:A.hrefLang,referrerPolicy:A.referrerPolicy},fa.set(d,A),X||jm(L,d,A,ae.state))),m&&P===null)throw Error(r(528,""));return ae}if(m&&P!==null)throw Error(r(529,""));return null;case"script":return m=A.async,A=A.src,typeof A=="string"&&m&&typeof m!="function"&&typeof m!="symbol"?(m=Yu(A),A=Ba(L).hoistableScripts,P=A.get(m),P||(P={type:"script",instance:null,count:0,state:null},A.set(m,P)),P):{type:"void",instance:null,count:0,state:null};default:throw Error(r(444,d))}}function jf(d){return'href="'+Aa(d)+'"'}function Hd(d){return'link[rel="stylesheet"]['+d+"]"}function Vm(d){return j({},d,{"data-precedence":d.precedence,precedence:null})}function jm(d,m,A,P){d.querySelector('link[rel="preload"][as="style"]['+m+"]")?P.loading=1:(m=d.createElement("link"),P.preload=m,m.addEventListener("load",function(){return P.loading|=1}),m.addEventListener("error",function(){return P.loading|=2}),Es(m,"link",A),cr(m),d.head.appendChild(m))}function Yu(d){return'[src="'+Aa(d)+'"]'}function $d(d){return"script[async]"+d}function Gm(d,m,A){if(m.count++,m.instance===null)switch(m.type){case"style":var P=d.querySelector('style[data-href~="'+Aa(A.href)+'"]');if(P)return m.instance=P,cr(P),P;var L=j({},A,{"data-href":A.href,"data-precedence":A.precedence,href:null,precedence:null});return P=(d.ownerDocument||d).createElement("style"),cr(P),Es(P,"style",L),Ju(P,A.precedence,d),m.instance=P;case"stylesheet":L=jf(A.href);var X=d.querySelector(Hd(L));if(X)return m.state.loading|=4,m.instance=X,cr(X),X;P=Vm(A),(L=fa.get(L))&&sp(P,L),X=(d.ownerDocument||d).createElement("link"),cr(X);var ae=X;return ae._p=new Promise(function(Te,qe){ae.onload=Te,ae.onerror=qe}),Es(X,"link",P),m.state.loading|=4,Ju(X,A.precedence,d),m.instance=X;case"script":return X=Yu(A.src),(L=d.querySelector($d(X)))?(m.instance=L,cr(L),L):(P=A,(L=fa.get(X))&&(P=j({},A),Ag(P,L)),d=d.ownerDocument||d,L=d.createElement("script"),cr(L),Es(L,"link",P),d.head.appendChild(L),m.instance=L);case"void":return null;default:throw Error(r(443,m.type))}else m.type==="stylesheet"&&(m.state.loading&4)===0&&(P=m.instance,m.state.loading|=4,Ju(P,A.precedence,d));return m.instance}function Ju(d,m,A){for(var P=A.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),L=P.length?P[P.length-1]:null,X=L,ae=0;ae<P.length;ae++){var Te=P[ae];if(Te.dataset.precedence===m)X=Te;else if(X!==L)break}X?X.parentNode.insertBefore(d,X.nextSibling):(m=A.nodeType===9?A.head:A,m.insertBefore(d,m.firstChild))}function sp(d,m){d.crossOrigin==null&&(d.crossOrigin=m.crossOrigin),d.referrerPolicy==null&&(d.referrerPolicy=m.referrerPolicy),d.title==null&&(d.title=m.title)}function Ag(d,m){d.crossOrigin==null&&(d.crossOrigin=m.crossOrigin),d.referrerPolicy==null&&(d.referrerPolicy=m.referrerPolicy),d.integrity==null&&(d.integrity=m.integrity)}var wg=null;function Wm(d,m,A){if(wg===null){var P=new Map,L=wg=new Map;L.set(A,P)}else L=wg,P=L.get(A),P||(P=new Map,L.set(A,P));if(P.has(d))return P;for(P.set(d,null),A=A.getElementsByTagName(d),L=0;L<A.length;L++){var X=A[L];if(!(X[Yi]||X[vn]||d==="link"&&X.getAttribute("rel")==="stylesheet")&&X.namespaceURI!=="http://www.w3.org/2000/svg"){var ae=X.getAttribute(m)||"";ae=d+ae;var Te=P.get(ae);Te?Te.push(X):P.set(ae,[X])}}return P}function ap(d,m,A){d=d.ownerDocument||d,d.head.insertBefore(A,m==="title"?d.querySelector("head > title"):null)}function op(d,m,A){if(A===1||m.itemProp!=null)return!1;switch(d){case"meta":case"title":return!0;case"style":if(typeof m.precedence!="string"||typeof m.href!="string"||m.href==="")break;return!0;case"link":if(typeof m.rel!="string"||typeof m.href!="string"||m.href===""||m.onLoad||m.onError)break;switch(m.rel){case"stylesheet":return d=m.disabled,typeof m.precedence=="string"&&d==null;default:return!0}case"script":if(m.async&&typeof m.async!="function"&&typeof m.async!="symbol"&&!m.onLoad&&!m.onError&&m.src&&typeof m.src=="string")return!0}return!1}function lp(d){return!(d.type==="stylesheet"&&(d.state.loading&3)===0)}function Zm(d,m,A,P){if(A.type==="stylesheet"&&(typeof P.media!="string"||matchMedia(P.media).matches!==!1)&&(A.state.loading&4)===0){if(A.instance===null){var L=jf(P.href),X=m.querySelector(Hd(L));if(X){m=X._p,m!==null&&typeof m=="object"&&typeof m.then=="function"&&(d.count++,d=up.bind(d),m.then(d,d)),A.state.loading|=4,A.instance=X,cr(X);return}X=m.ownerDocument||m,P=Vm(P),(L=fa.get(L))&&sp(P,L),X=X.createElement("link"),cr(X);var ae=X;ae._p=new Promise(function(Te,qe){ae.onload=Te,ae.onerror=qe}),Es(X,"link",P),A.instance=X}d.stylesheets===null&&(d.stylesheets=new Map),d.stylesheets.set(A,m),(m=A.state.preload)&&(A.state.loading&3)===0&&(d.count++,A=up.bind(d),m.addEventListener("load",A),m.addEventListener("error",A))}}var cp=0;function Xm(d,m){return d.stylesheets&&d.count===0&&fp(d,d.stylesheets),0<d.count||0<d.imgCount?function(A){var P=setTimeout(function(){if(d.stylesheets&&fp(d,d.stylesheets),d.unsuspend){var X=d.unsuspend;d.unsuspend=null,X()}},6e4+m);0<d.imgBytes&&cp===0&&(cp=62500*Wd());var L=setTimeout(function(){if(d.waitingForImages=!1,d.count===0&&(d.stylesheets&&fp(d,d.stylesheets),d.unsuspend)){var X=d.unsuspend;d.unsuspend=null,X()}},(d.imgBytes>cp?50:800)+m);return d.unsuspend=A,function(){d.unsuspend=null,clearTimeout(P),clearTimeout(L)}}:null}function up(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)fp(this,this.stylesheets);else if(this.unsuspend){var d=this.unsuspend;this.unsuspend=null,d()}}}var hp=null;function fp(d,m){d.stylesheets=null,d.unsuspend!==null&&(d.count++,hp=new Map,m.forEach(ry,d),hp=null,up.call(d))}function ry(d,m){if(!(m.state.loading&4)){var A=hp.get(d);if(A)var P=A.get(null);else{A=new Map,hp.set(d,A);for(var L=d.querySelectorAll("link[data-precedence],style[data-precedence]"),X=0;X<L.length;X++){var ae=L[X];(ae.nodeName==="LINK"||ae.getAttribute("media")!=="not all")&&(A.set(ae.dataset.precedence,ae),P=ae)}P&&A.set(null,P)}L=m.instance,ae=L.getAttribute("data-precedence"),X=A.get(ae)||P,X===P&&A.set(null,L),A.set(ae,L),this.count++,P=up.bind(this),L.addEventListener("load",P),L.addEventListener("error",P),X?X.parentNode.insertBefore(L,X.nextSibling):(d=d.nodeType===9?d.head:d,d.insertBefore(L,d.firstChild)),m.state.loading|=4}}var qd={$$typeof:Be,Provider:null,Consumer:null,_currentValue:mi,_currentValue2:mi,_threadCount:0};function f2(d,m,A,P,L,X,ae,Te,qe){this.tag=1,this.containerInfo=d,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=qi(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=qi(0),this.hiddenUpdates=qi(null),this.identifierPrefix=P,this.onUncaughtError=L,this.onCaughtError=X,this.onRecoverableError=ae,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=qe,this.incompleteTransitions=new Map}function Hm(d,m,A,P,L,X,ae,Te,qe,wt,Lt,$t){return d=new f2(d,m,A,ae,qe,wt,Lt,$t,Te),m=1,X===!0&&(m|=24),X=Ca(3,null,null,m),d.current=X,X.stateNode=d,m=Nl(),m.refCount++,d.pooledCache=m,m.refCount++,X.memoizedState={element:P,isDehydrated:A,cache:m},ca(X),d}function sy(d){return d?(d=tn,d):tn}function ay(d,m,A,P,L,X){L=sy(L),P.context===null?P.context=L:P.pendingContext=L,P=ss(m),P.payload={element:A},X=X===void 0?null:X,X!==null&&(P.callback=X),A=Nr(d,P,m),A!==null&&($o(A,d,m),Br(A,d,m))}function Tg(d,m){if(d=d.memoizedState,d!==null&&d.dehydrated!==null){var A=d.retryLane;d.retryLane=A!==0&&A<m?A:m}}function Sg(d,m){Tg(d,m),(d=d.alternate)&&Tg(d,m)}function oy(d){if(d.tag===13||d.tag===31){var m=Bo(d,67108864);m!==null&&$o(m,d,67108864),Sg(d,67108864)}}function ly(d){if(d.tag===13||d.tag===31){var m=Ho();m=$i(m);var A=Bo(d,m);A!==null&&$o(A,d,m),Sg(d,m)}}var dp=!0;function Yd(d,m,A,P){var L=nt.T;nt.T=null;var X=Ut.p;try{Ut.p=2,$m(d,m,A,P)}finally{Ut.p=X,nt.T=L}}function cy(d,m,A,P){var L=nt.T;nt.T=null;var X=Ut.p;try{Ut.p=8,$m(d,m,A,P)}finally{Ut.p=X,nt.T=L}}function $m(d,m,A,P){if(dp){var L=pp(P);if(L===null)nu(d,m,P,Jd,A),qm(d,P);else if(p2(L,d,m,A,P))P.stopPropagation();else if(qm(d,P),m&4&&-1<d2.indexOf(d)){for(;L!==null;){var X=rc(L);if(X!==null)switch(X.tag){case 3:if(X=X.stateNode,X.current.memoizedState.isDehydrated){var ae=Ke(X.pendingLanes);if(ae!==0){var Te=X;for(Te.pendingLanes|=2,Te.entangledLanes|=2;ae;){var qe=1<<31-st(ae);Te.entanglements[1]|=qe,ae&=~qe}Ec(X),(Rn&6)===0&&(X0=Qr()+500,gl(0))}}break;case 31:case 13:Te=Bo(X,2),Te!==null&&$o(Te,X,2),$0(),Sg(X,2)}if(X=pp(P),X===null&&nu(d,m,P,Jd,A),X===L)break;L=X}L!==null&&P.stopPropagation()}else nu(d,m,P,null,A)}}function pp(d){return d=gh(d),Eg(d)}var Jd=null;function Eg(d){if(Jd=null,d=Al(d),d!==null){var m=p(d);if(m===null)d=null;else{var A=m.tag;if(A===13){if(d=_(m),d!==null)return d;d=null}else if(A===31){if(d=l(m),d!==null)return d;d=null}else if(A===3){if(m.stateNode.current.memoizedState.isDehydrated)return m.tag===3?m.stateNode.containerInfo:null;d=null}else m!==d&&(d=null)}}return Jd=d,null}function Gf(d){switch(d){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(ao()){case nc:return 2;case Qo:return 8;case Ls:case hh:return 32;case it:return 268435456;default:return 32}default:return 32}}var Mg=!1,Qh=null,ql=null,Kh=null,gp=new Map,Qd=new Map,Qu=[],d2="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function qm(d,m){switch(d){case"focusin":case"focusout":Qh=null;break;case"dragenter":case"dragleave":ql=null;break;case"mouseover":case"mouseout":Kh=null;break;case"pointerover":case"pointerout":gp.delete(m.pointerId);break;case"gotpointercapture":case"lostpointercapture":Qd.delete(m.pointerId)}}function mp(d,m,A,P,L,X){return d===null||d.nativeEvent!==X?(d={blockedOn:m,domEventName:A,eventSystemFlags:P,nativeEvent:X,targetContainers:[L]},m!==null&&(m=rc(m),m!==null&&oy(m)),d):(d.eventSystemFlags|=P,m=d.targetContainers,L!==null&&m.indexOf(L)===-1&&m.push(L),d)}function p2(d,m,A,P,L){switch(m){case"focusin":return Qh=mp(Qh,d,m,A,P,L),!0;case"dragenter":return ql=mp(ql,d,m,A,P,L),!0;case"mouseover":return Kh=mp(Kh,d,m,A,P,L),!0;case"pointerover":var X=L.pointerId;return gp.set(X,mp(gp.get(X)||null,d,m,A,P,L)),!0;case"gotpointercapture":return X=L.pointerId,Qd.set(X,mp(Qd.get(X)||null,d,m,A,P,L)),!0}return!1}function uy(d){var m=Al(d.target);if(m!==null){var A=p(m);if(A!==null){if(m=A.tag,m===13){if(m=_(A),m!==null){d.blockedOn=m,Cs(d.priority,function(){ly(A)});return}}else if(m===31){if(m=l(A),m!==null){d.blockedOn=m,Cs(d.priority,function(){ly(A)});return}}else if(m===3&&A.stateNode.current.memoizedState.isDehydrated){d.blockedOn=A.tag===3?A.stateNode.containerInfo:null;return}}}d.blockedOn=null}function _p(d){if(d.blockedOn!==null)return!1;for(var m=d.targetContainers;0<m.length;){var A=pp(d.nativeEvent);if(A===null){A=d.nativeEvent;var P=new A.constructor(A.type,A);rd=P,A.target.dispatchEvent(P),rd=null}else return m=rc(A),m!==null&&oy(m),d.blockedOn=A,!1;m.shift()}return!0}function hy(d,m,A){_p(d)&&A.delete(m)}function yp(){Mg=!1,Qh!==null&&_p(Qh)&&(Qh=null),ql!==null&&_p(ql)&&(ql=null),Kh!==null&&_p(Kh)&&(Kh=null),gp.forEach(hy),Qd.forEach(hy)}function Rg(d,m){d.blockedOn===m&&(d.blockedOn=null,Mg||(Mg=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,yp)))}var Cg=null;function fy(d){Cg!==d&&(Cg=d,i.unstable_scheduleCallback(i.unstable_NormalPriority,function(){Cg===d&&(Cg=null);for(var m=0;m<d.length;m+=3){var A=d[m],P=d[m+1],L=d[m+2];if(typeof P!="function"){if(Eg(P||A)===null)continue;break}var X=rc(A);X!==null&&(d.splice(m,3),m-=3,Xr(X,{pending:!0,data:L,method:A.method,action:P},P,L))}}))}function ef(d){function m(qe){return Rg(qe,d)}Qh!==null&&Rg(Qh,d),ql!==null&&Rg(ql,d),Kh!==null&&Rg(Kh,d),gp.forEach(m),Qd.forEach(m);for(var A=0;A<Qu.length;A++){var P=Qu[A];P.blockedOn===d&&(P.blockedOn=null)}for(;0<Qu.length&&(A=Qu[0],A.blockedOn===null);)uy(A),A.blockedOn===null&&Qu.shift();if(A=(d.ownerDocument||d).$$reactFormReplay,A!=null)for(P=0;P<A.length;P+=3){var L=A[P],X=A[P+1],ae=L[ei]||null;if(typeof X=="function")ae||fy(A);else if(ae){var Te=null;if(X&&X.hasAttribute("formAction")){if(L=X,ae=X[ei]||null)Te=ae.formAction;else if(Eg(L)!==null)continue}else Te=ae.action;typeof Te=="function"?A[P+1]=Te:(A.splice(P,3),P-=3),fy(A)}}}function Ym(){function d(X){X.canIntercept&&X.info==="react-transition"&&X.intercept({handler:function(){return new Promise(function(ae){return L=ae})},focusReset:"manual",scroll:"manual"})}function m(){L!==null&&(L(),L=null),P||setTimeout(A,20)}function A(){if(!P&&!navigation.transition){var X=navigation.currentEntry;X&&X.url!=null&&navigation.navigate(X.url,{state:X.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var P=!1,L=null;return navigation.addEventListener("navigate",d),navigation.addEventListener("navigatesuccess",m),navigation.addEventListener("navigateerror",m),setTimeout(A,100),function(){P=!0,navigation.removeEventListener("navigate",d),navigation.removeEventListener("navigatesuccess",m),navigation.removeEventListener("navigateerror",m),L!==null&&(L(),L=null)}}}function dy(d){this._internalRoot=d}Pg.prototype.render=dy.prototype.render=function(d){var m=this._internalRoot;if(m===null)throw Error(r(409));var A=m.current,P=Ho();ay(A,P,d,m,null,null)},Pg.prototype.unmount=dy.prototype.unmount=function(){var d=this._internalRoot;if(d!==null){this._internalRoot=null;var m=d.containerInfo;ay(d.current,2,null,d,null,null),$0(),m[Xi]=null}};function Pg(d){this._internalRoot=d}Pg.prototype.unstable_scheduleHydration=function(d){if(d){var m=Ar();d={blockedOn:null,target:d,priority:m};for(var A=0;A<Qu.length&&m!==0&&m<Qu[A].priority;A++);Qu.splice(A,0,d),A===0&&uy(d)}};var Jm=e.version;if(Jm!=="19.2.4")throw Error(r(527,Jm,"19.2.4"));Ut.findDOMNode=function(d){var m=d._reactInternals;if(m===void 0)throw typeof d.render=="function"?Error(r(188)):(d=Object.keys(d).join(","),Error(r(268,d)));return d=D(m),d=d!==null?B(d):null,d=d===null?null:d.stateNode,d};var py={bundleType:0,version:"19.2.4",rendererPackageName:"react-dom",currentDispatcherRef:nt,reconcilerVersion:"19.2.4"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Ig=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ig.isDisabled&&Ig.supportsFiber)try{ve=Ig.inject(py),Fe=Ig}catch{}}return D2.createRoot=function(d,m){if(!o(d))throw Error(r(299));var A=!1,P="",L=Ed,X=vc,ae=Ss;return m!=null&&(m.unstable_strictMode===!0&&(A=!0),m.identifierPrefix!==void 0&&(P=m.identifierPrefix),m.onUncaughtError!==void 0&&(L=m.onUncaughtError),m.onCaughtError!==void 0&&(X=m.onCaughtError),m.onRecoverableError!==void 0&&(ae=m.onRecoverableError)),m=Hm(d,1,!1,null,null,A,P,null,L,X,ae,Ym),d[Xi]=m.current,Im(d),new dy(m)},D2.hydrateRoot=function(d,m,A){if(!o(d))throw Error(r(299));var P=!1,L="",X=Ed,ae=vc,Te=Ss,qe=null;return A!=null&&(A.unstable_strictMode===!0&&(P=!0),A.identifierPrefix!==void 0&&(L=A.identifierPrefix),A.onUncaughtError!==void 0&&(X=A.onUncaughtError),A.onCaughtError!==void 0&&(ae=A.onCaughtError),A.onRecoverableError!==void 0&&(Te=A.onRecoverableError),A.formState!==void 0&&(qe=A.formState)),m=Hm(d,1,!0,m,A??null,P,L,qe,X,ae,Te,Ym),m.context=sy(null),A=m.current,P=Ho(),P=$i(P),L=ss(P),L.callback=null,Nr(A,L,P),A=P,m.current.lanes=A,Bn(m,A),Ec(m),d[Xi]=m.current,Im(d),new Pg(m)},D2.version="19.2.4",D2}var iT;function l6(){if(iT)return db.exports;iT=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(e){console.error(e)}}return i(),db.exports=o6(),db.exports}var c6=l6();function Nv(i,e){if(!i)throw new Error(e||"loader assertion failed.")}const aw=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),nT=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);nT&&parseFloat(nT[1]);const K1=globalThis,Ty=globalThis.process||{},u6=globalThis.navigator||{};function US(i){var r,o;if(typeof window<"u"&&((r=window.process)==null?void 0:r.type)==="renderer"||typeof process<"u"&&((o=process.versions)!=null&&o.electron))return!0;const t=typeof navigator<"u"&&navigator.userAgent;return!!(t&&t.indexOf("Electron")>=0)}function C_(){return!(typeof process=="object"&&String(process)==="[object process]"&&!(process!=null&&process.browser))||US()}function h6(i){return C_()?US()?"Electron":(u6.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node"}const VS="4.1.0";function f6(i){try{const e=window[i],t="__storage_test__";return e.setItem(t,t),e.removeItem(t),e}catch{return null}}class d6{constructor(e,t,r="sessionStorage"){this.storage=f6(r),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}function p6(i){let e;return i<10?e=`${i.toFixed(2)}ms`:i<100?e=`${i.toFixed(1)}ms`:i<1e3?e=`${i.toFixed(0)}ms`:e=`${(i/1e3).toFixed(2)}s`,e}function g6(i,e=8){const t=Math.max(e-i.length,0);return`${" ".repeat(t)}${i}`}var Bv;(function(i){i[i.BLACK=30]="BLACK",i[i.RED=31]="RED",i[i.GREEN=32]="GREEN",i[i.YELLOW=33]="YELLOW",i[i.BLUE=34]="BLUE",i[i.MAGENTA=35]="MAGENTA",i[i.CYAN=36]="CYAN",i[i.WHITE=37]="WHITE",i[i.BRIGHT_BLACK=90]="BRIGHT_BLACK",i[i.BRIGHT_RED=91]="BRIGHT_RED",i[i.BRIGHT_GREEN=92]="BRIGHT_GREEN",i[i.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",i[i.BRIGHT_BLUE=94]="BRIGHT_BLUE",i[i.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",i[i.BRIGHT_CYAN=96]="BRIGHT_CYAN",i[i.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Bv||(Bv={}));const m6=10;function rT(i){return typeof i!="string"?i:(i=i.toUpperCase(),Bv[i]||Bv.WHITE)}function _6(i,e,t){return!C_&&typeof i=="string"&&(e&&(i=`\x1B[${rT(e)}m${i}\x1B[39m`),t&&(i=`\x1B[${rT(t)+m6}m${i}\x1B[49m`)),i}function y6(i,e=["constructor"]){const t=Object.getPrototypeOf(i),r=Object.getOwnPropertyNames(t),o=i;for(const p of r){const _=o[p];typeof _=="function"&&(e.find(l=>p===l)||(o[p]=_.bind(i)))}}function ow(i,e){if(!i)throw new Error("Assertion failed")}function Sy(){var e,t,r;let i;if(C_()&&K1.performance)i=(t=(e=K1==null?void 0:K1.performance)==null?void 0:e.now)==null?void 0:t.call(e);else if("hrtime"in Ty){const o=(r=Ty==null?void 0:Ty.hrtime)==null?void 0:r.call(Ty);i=o[0]*1e3+o[1]/1e6}else i=Date.now();return i}const Ey={debug:C_()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},v6={enabled:!0,level:0};function My(){}const sT={},aT={once:!0};class S1{constructor({id:e}={id:""}){this.VERSION=VS,this._startTs=Sy(),this._deltaTs=Sy(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new d6(`__probe-${this.id}__`,v6),this.timeStamp(`${this.id} started`),y6(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Sy()-this._startTs).toPrecision(10))}getDelta(){return Number((Sy()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){if(!e)throw new Error(t||"Assertion failed")}warn(e){return this._getLogFunction(0,e,Ey.warn,arguments,aT)}error(e){return this._getLogFunction(0,e,Ey.error,arguments)}deprecated(e,t){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${t}\` instead`)}removed(e,t){return this.error(`\`${e}\` has been removed. Use \`${t}\` instead`)}probe(e,t){return this._getLogFunction(e,t,Ey.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,Ey.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,Ey.debug||Ey.info,arguments,aT)}table(e,t,r){return t?this._getLogFunction(e,t,console.table||My,r&&[r],{tag:b6(t)}):My}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||My)}group(e,t,r={collapsed:!1}){const o=oT({logLevel:e,message:t,opts:r}),{collapsed:p}=r;return o.method=(p?console.groupCollapsed:console.group)||console.info,this._getLogFunction(o)}groupCollapsed(e,t,r={}){return this.group(e,t,Object.assign({},r,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||My)}withGroup(e,t,r){this.group(e,t)();try{r()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=jS(e)}_getLogFunction(e,t,r,o,p){if(this._shouldLog(e)){p=oT({logLevel:e,message:t,args:o,opts:p}),r=r||p.method,ow(r),p.total=this.getTotal(),p.delta=this.getDelta(),this._deltaTs=Sy();const _=p.tag||p.message;if(p.once&&_)if(!sT[_])sT[_]=Sy();else return My;return t=x6(this.id,p.message,p),r.bind(console,t,...p.args)}return My}}S1.VERSION=VS;function jS(i){if(!i)return 0;let e;switch(typeof i){case"number":e=i;break;case"object":e=i.logLevel||i.priority||0;break;default:return 0}return ow(Number.isFinite(e)&&e>=0),e}function oT(i){const{logLevel:e,message:t}=i;i.logLevel=jS(e);const r=i.args?Array.from(i.args):[];for(;r.length&&r.shift()!==t;);switch(typeof e){case"string":case"function":t!==void 0&&r.unshift(t),i.message=e;break;case"object":Object.assign(i,e);break}typeof i.message=="function"&&(i.message=i.message());const o=typeof i.message;return ow(o==="string"||o==="object"),Object.assign(i,{args:r},i.opts)}function x6(i,e,t){if(typeof e=="string"){const r=t.time?g6(p6(t.total)):"";e=t.time?`${i}: ${r}  ${e}`:`${i}: ${e}`,e=_6(e,t.color,t.background)}return e}function b6(i){for(const e in i)for(const t in i[e])return t||"untitled";return"empty"}const _b="4.3.3",A6=_b[0]>="0"&&_b[0]<="9"?`v${_b}`:"";function w6(){const i=new S1({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=i,globalThis.loaders.version=A6,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=i,i}const T6=w6();function S6(i,e){return GS(i||{},e)}function GS(i,e,t=0){if(t>3)return e;const r={...i};for(const[o,p]of Object.entries(e))p&&typeof p=="object"&&!Array.isArray(p)?r[o]=GS(r[o]||{},e[o],t+1):r[o]=e[o];return r}const E6="latest";function M6(){var i;return(i=globalThis._loadersgl_)!=null&&i.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.3"),globalThis._loadersgl_.version}const R6=M6();function $g(i,e){if(!i)throw new Error(e||"loaders.gl assertion failed.")}const m_=typeof process!="object"||String(process)!=="[object process]"||process.browser,C6=typeof window<"u"&&typeof window.orientation<"u",lT=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);lT&&parseFloat(lT[1]);class P6{constructor(e,t){pe(this,"name");pe(this,"workerThread");pe(this,"isRunning",!0);pe(this,"result");pe(this,"_resolve",()=>{});pe(this,"_reject",()=>{});this.name=e,this.workerThread=t,this.result=new Promise((r,o)=>{this._resolve=r,this._reject=o})}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){$g(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){$g(this.isRunning),this.isRunning=!1,this._reject(e)}}class yb{terminate(){}}const vb=new Map;function I6(i){$g(i.source&&!i.url||!i.source&&i.url);let e=vb.get(i.source||i.url);return e||(i.url&&(e=k6(i.url),vb.set(i.url,e)),i.source&&(e=WS(i.source),vb.set(i.source,e))),$g(e),e}function k6(i){if(!i.startsWith("http"))return i;const e=D6(i);return WS(e)}function WS(i){const e=new Blob([i],{type:"application/javascript"});return URL.createObjectURL(e)}function D6(i){return`try {
  importScripts('${i}');
} catch (error) {
  console.error(error);
  throw error;
}`}function ZS(i,e=!0,t){const r=t||new Set;if(i){if(cT(i))r.add(i);else if(cT(i.buffer))r.add(i.buffer);else if(!ArrayBuffer.isView(i)){if(e&&typeof i=="object")for(const o in i)ZS(i[o],e,r)}}return t===void 0?Array.from(r):[]}function cT(i){return i?i instanceof ArrayBuffer||typeof MessagePort<"u"&&i instanceof MessagePort||typeof ImageBitmap<"u"&&i instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&i instanceof OffscreenCanvas:!1}const xb=()=>{};class lA{constructor(e){pe(this,"name");pe(this,"source");pe(this,"url");pe(this,"terminated",!1);pe(this,"worker");pe(this,"onMessage");pe(this,"onError");pe(this,"_loadableURL","");const{name:t,source:r,url:o}=e;$g(r||o),this.name=t,this.source=r,this.url=o,this.onMessage=xb,this.onError=p=>console.log(p),this.worker=m_?this._createBrowserWorker():this._createNodeWorker()}static isSupported(){return typeof Worker<"u"&&m_||typeof yb<"u"&&!m_}destroy(){this.onMessage=xb,this.onError=xb,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,t){t=t||ZS(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+=`worker ${this.name} from ${this.url}. `,e.message&&(t+=`${e.message} in `),e.lineno&&(t+=`:${e.lineno}:${e.colno}`),new Error(t)}_createBrowserWorker(){this._loadableURL=I6({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=t=>{t.data?this.onMessage(t.data):this.onError(new Error("No data received"))},e.onerror=t=>{this.onError(this._getErrorFromErrorEvent(t)),this.terminated=!0},e.onmessageerror=t=>console.error(t),e}_createNodeWorker(){let e;if(this.url){const r=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new yb(r,{eval:!1})}else if(this.source)e=new yb(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",t=>{this.onMessage(t)}),e.on("error",t=>{this.onError(t)}),e.on("exit",t=>{}),e}}class O6{constructor(e){pe(this,"name","unnamed");pe(this,"source");pe(this,"url");pe(this,"maxConcurrency",1);pe(this,"maxMobileConcurrency",1);pe(this,"onDebug",()=>{});pe(this,"reuseWorkers",!0);pe(this,"props",{});pe(this,"jobQueue",[]);pe(this,"idleQueue",[]);pe(this,"count",0);pe(this,"isDestroyed",!1);this.source=e.source,this.url=e.url,this.setProps(e)}static isSupported(){return lA.isSupported()}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,t=(o,p,_)=>o.done(_),r=(o,p)=>o.error(p)){const o=new Promise(p=>(this.jobQueue.push({name:e,onMessage:t,onError:r,onStart:p}),this));return this._startQueuedJob(),await o}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});const r=new P6(t.name,e);e.onMessage=o=>t.onMessage(r,o.type,o.payload),e.onError=o=>t.onError(r,o),t.onStart(r);try{await r.result}catch(o){console.error(`Worker exception: ${o}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!m_||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new lA({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return C6?this.maxMobileConcurrency:this.maxConcurrency}}const F6={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},jg=class jg{constructor(e){pe(this,"props");pe(this,"workerPools",new Map);this.props={...F6},this.setProps(e),this.workerPools=new Map}static isSupported(){return lA.isSupported()}static getWorkerFarm(e={}){return jg._workerFarm=jg._workerFarm||new jg({}),jg._workerFarm.setProps(e),jg._workerFarm}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const t of this.workerPools.values())t.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:t,source:r,url:o}=e;let p=this.workerPools.get(t);return p||(p=new O6({name:t,source:r,url:o}),p.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,p)),p}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};pe(jg,"_workerFarm");let zv=jg;function N6(i,e={}){const t=e[i.id]||{},r=m_?`${i.id}-worker.js`:`${i.id}-worker-node.js`;let o=t.workerUrl;if(!o&&i.id==="compression"&&(o=e.workerUrl),e._workerType==="test"&&(m_?o=`modules/${i.module}/dist/${r}`:o=`modules/${i.module}/src/workers/${i.id}-worker-node.ts`),!o){let p=i.version;p==="latest"&&(p=E6);const _=p?`@${p}`:"";o=`https://unpkg.com/@loaders.gl/${i.module}${_}/dist/${r}`}return $g(o),o}function B6(i,e=R6){$g(i,"no worker provided");const t=i.version;return!(!e||!t)}function z6(i,e){return!zv.isSupported()||!m_&&!(e!=null&&e._nodeWorkers)?!1:i.worker&&(e==null?void 0:e.worker)}async function L6(i,e,t,r,o){const p=i.id,_=N6(i,t),M=zv.getWorkerFarm(t).getWorkerPool({name:p,url:_});t=JSON.parse(JSON.stringify(t)),r=JSON.parse(JSON.stringify(r||{}));const D=await M.startJob("process-on-worker",U6.bind(null,o));return D.postMessage("process",{input:e,options:t,context:r}),await(await D.result).result}async function U6(i,e,t,r){switch(t){case"done":e.done(r);break;case"error":e.error(new Error(r.error));break;case"process":const{id:o,input:p,options:_}=r;try{const l=await i(p,_);e.postMessage("done",{id:o,result:l})}catch(l){const M=l instanceof Error?l.message:"unknown error";e.postMessage("error",{id:o,error:M})}break;default:console.warn(`parse-with-worker unknown message ${t}`)}}function V6(i,e,t){if(t=t||i.byteLength,i.byteLength<t||e.byteLength<t)return!1;const r=new Uint8Array(i),o=new Uint8Array(e);for(let p=0;p<r.length;++p)if(r[p]!==o[p])return!1;return!0}function j6(...i){return G6(i)}function G6(i){const e=i.map(p=>p instanceof ArrayBuffer?new Uint8Array(p):p),t=e.reduce((p,_)=>p+_.byteLength,0),r=new Uint8Array(t);let o=0;for(const p of e)r.set(p,o),o+=p.byteLength;return r.buffer}async function W6(i){const e=[];for await(const t of i)e.push(t);return j6(...e)}function uT(){let i;if(typeof window<"u"&&window.performance)i=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();i=e[0]*1e3+e[1]/1e6}else i=Date.now();return i}class hT{constructor(e,t){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=uT(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(uT()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class kx{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,t="count"){return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const t of Object.values(this.stats))e(t)}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(t=>this._getOrCreate(t))}_getOrCreate(e){const{name:t,type:r}=e;let o=this.stats[t];return o||(e instanceof hT?o=e:o=new hT(t,r),this.stats[t]=o),o}}let Z6="";const fT={};function X6(i){for(const e in fT)if(i.startsWith(e)){const t=fT[e];i=i.replace(e,t)}return!i.startsWith("http://")&&!i.startsWith("https://")&&(i=`${Z6}${i}`),i}function H6(i){return i&&typeof i=="object"&&i.isBuffer}function XS(i){if(H6(i))return i;if(i instanceof ArrayBuffer)return i;if(ArrayBuffer.isView(i))return i.byteOffset===0&&i.byteLength===i.buffer.byteLength?i.buffer:i.buffer.slice(i.byteOffset,i.byteOffset+i.byteLength);if(typeof i=="string"){const e=i;return new TextEncoder().encode(e).buffer}if(i&&typeof i=="object"&&i._toArrayBuffer)return i._toArrayBuffer();throw new Error("toArrayBuffer")}function HS(i){const e=i?i.lastIndexOf("/"):-1;return e>=0?i.substr(e+1):""}function $6(i){const e=i?i.lastIndexOf("/"):-1;return e>=0?i.substr(0,e):""}const q6=i=>typeof i=="boolean",H2=i=>typeof i=="function",E1=i=>i!==null&&typeof i=="object",dT=i=>E1(i)&&i.constructor==={}.constructor,Y6=i=>!!i&&typeof i[Symbol.iterator]=="function",J6=i=>i&&typeof i[Symbol.asyncIterator]=="function",P_=i=>typeof Response<"u"&&i instanceof Response||i&&i.arrayBuffer&&i.text&&i.json,I_=i=>typeof Blob<"u"&&i instanceof Blob,Q6=i=>i&&typeof i=="object"&&i.isBuffer,K6=i=>typeof ReadableStream<"u"&&i instanceof ReadableStream||E1(i)&&H2(i.tee)&&H2(i.cancel)&&H2(i.getReader),e8=i=>E1(i)&&H2(i.read)&&H2(i.pipe)&&q6(i.readable),$S=i=>K6(i)||e8(i);class t8 extends Error{constructor(t,r){super(t);pe(this,"reason");pe(this,"url");pe(this,"response");this.reason=r.reason,this.url=r.url,this.response=r.response}}const i8=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,n8=/^([-\w.]+\/[-\w.+]+)/;function pT(i,e){return i.toLowerCase()===e.toLowerCase()}function r8(i){const e=n8.exec(i);return e?e[1]:i}function gT(i){const e=i8.exec(i);return e?e[1]:""}const qS=/\?.*/;function s8(i){const e=i.match(qS);return e&&e[0]}function lw(i){return i.replace(qS,"")}function a8(i){if(i.length<50)return i;const e=i.slice(i.length-15);return`${i.substr(0,32)}...${e}`}function Dx(i){return P_(i)?i.url:I_(i)?i.name||"":typeof i=="string"?i:""}function cw(i){if(P_(i)){const e=i,t=e.headers.get("content-type")||"",r=lw(e.url);return r8(t)||gT(r)}return I_(i)?i.type||"":typeof i=="string"?gT(i):""}function o8(i){return P_(i)?i.headers["content-length"]||-1:I_(i)?i.size:typeof i=="string"?i.length:i instanceof ArrayBuffer||ArrayBuffer.isView(i)?i.byteLength:-1}async function YS(i){if(P_(i))return i;const e={},t=o8(i);t>=0&&(e["content-length"]=String(t));const r=Dx(i),o=cw(i);o&&(e["content-type"]=o);const p=await u8(i);p&&(e["x-first-bytes"]=p),typeof i=="string"&&(i=new TextEncoder().encode(i));const _=new Response(i,{headers:e});return Object.defineProperty(_,"url",{value:r}),_}async function l8(i){if(!i.ok)throw await c8(i)}async function c8(i){const e=a8(i.url);let t=`Failed to fetch resource (${i.status}) ${i.statusText}: ${e}`;t=t.length>100?`${t.slice(0,100)}...`:t;const r={reason:i.statusText,url:i.url,response:i};try{const o=i.headers.get("Content-Type");r.reason=!i.bodyUsed&&(o!=null&&o.includes("application/json"))?await i.json():await i.text()}catch{}return new t8(t,r)}async function u8(i){if(typeof i=="string")return`data:,${i.slice(0,5)}`;if(i instanceof Blob){const t=i.slice(0,5);return await new Promise(r=>{const o=new FileReader;o.onload=p=>{var _;return r((_=p==null?void 0:p.target)==null?void 0:_.result)},o.readAsDataURL(t)})}if(i instanceof ArrayBuffer){const t=i.slice(0,5);return`data:base64,${h8(t)}`}return null}function h8(i){let e="";const t=new Uint8Array(i);for(let r=0;r<t.byteLength;r++)e+=String.fromCharCode(t[r]);return btoa(e)}function f8(i){return!d8(i)&&!p8(i)}function d8(i){return i.startsWith("http:")||i.startsWith("https:")}function p8(i){return i.startsWith("data:")}async function mT(i,e){var t,r;if(typeof i=="string"){const o=X6(i);return f8(o)&&(t=globalThis.loaders)!=null&&t.fetchNode?(r=globalThis.loaders)==null?void 0:r.fetchNode(o,e):await fetch(o,e)}return await YS(i)}const _T=new S1({id:"loaders.gl"});class g8{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class m8{constructor(){pe(this,"console");this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const JS={fetch:null,mimeType:void 0,nothrow:!1,log:new m8,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:aw,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},_8={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function QS(){globalThis.loaders=globalThis.loaders||{};const{loaders:i}=globalThis;return i._state||(i._state={}),i._state}function KS(){const i=QS();return i.globalOptions=i.globalOptions||{...JS},i.globalOptions}function y8(i,e,t,r){return t=t||[],t=Array.isArray(t)?t:[t],v8(i,t),b8(e,i,r)}function v8(i,e){yT(i,null,JS,_8,e);for(const t of e){const r=i&&i[t.id]||{},o=t.options&&t.options[t.id]||{},p=t.deprecatedOptions&&t.deprecatedOptions[t.id]||{};yT(r,t.id,o,p,e)}}function yT(i,e,t,r,o){const p=e||"Top level",_=e?`${e}.`:"";for(const l in i){const M=!e&&E1(i[l]),D=l==="baseUri"&&!e,B=l==="workerUrl"&&e;if(!(l in t)&&!D&&!B){if(l in r)_T.warn(`${p} loader option '${_}${l}' no longer supported, use '${r[l]}'`)();else if(!M){const j=x8(l,o);_T.warn(`${p} loader option '${_}${l}' not recognized. ${j}`)()}}}}function x8(i,e){const t=i.toLowerCase();let r="";for(const o of e)for(const p in o.options){if(i===p)return`Did you mean '${o.id}.${p}'?`;const _=p.toLowerCase();(t.startsWith(_)||_.startsWith(t))&&(r=r||`Did you mean '${o.id}.${p}'?`)}return r}function b8(i,e,t){const o={...i.options||{}};return A8(o,t),o.log===null&&(o.log=new g8),vT(o,KS()),vT(o,e),o}function vT(i,e){for(const t in e)if(t in e){const r=e[t];dT(r)&&dT(i[t])?i[t]={...i[t],...e[t]}:i[t]=e[t]}}function A8(i,e){e&&!("baseUri"in i)&&(i.baseUri=e)}function uw(i){return i?(Array.isArray(i)&&(i=i[0]),Array.isArray(i==null?void 0:i.extensions)):!1}function hw(i){Nv(i,"null loader"),Nv(uw(i),"invalid loader");let e;return Array.isArray(i)&&(e=i[1],i=i[0],i={...i,options:{...i.options,...e}}),(i!=null&&i.parseTextSync||i!=null&&i.parseText)&&(i.text=!0),i.text||(i.binary=!0),i}const eE=()=>{const i=QS();return i.loaderRegistry=i.loaderRegistry||[],i.loaderRegistry};function w8(i){const e=eE();i=Array.isArray(i)?i:[i];for(const t of i){const r=hw(t);e.find(o=>r===o)||e.unshift(r)}}function T8(){return eE()}const S8=/\.([^.]+)$/;async function E8(i,e=[],t,r){if(!tE(i))return null;let o=xT(i,e,{...t,nothrow:!0},r);if(o)return o;if(I_(i)&&(i=await i.slice(0,10).arrayBuffer(),o=xT(i,e,t,r)),!o&&!(t!=null&&t.nothrow))throw new Error(iE(i));return o}function xT(i,e=[],t,r){if(!tE(i))return null;if(e&&!Array.isArray(e))return hw(e);let o=[];e&&(o=o.concat(e)),t!=null&&t.ignoreRegisteredLoaders||o.push(...T8()),R8(o);const p=M8(i,o,t,r);if(!p&&!(t!=null&&t.nothrow))throw new Error(iE(i));return p}function M8(i,e,t,r){const o=Dx(i),p=cw(i),_=lw(o)||(r==null?void 0:r.url);let l=null,M="";return t!=null&&t.mimeType&&(l=bb(e,t==null?void 0:t.mimeType),M=`match forced by supplied MIME type ${t==null?void 0:t.mimeType}`),l=l||C8(e,_),M=M||(l?`matched url ${_}`:""),l=l||bb(e,p),M=M||(l?`matched MIME type ${p}`:""),l=l||I8(e,i),M=M||(l?`matched initial data ${nE(i)}`:""),t!=null&&t.fallbackMimeType&&(l=l||bb(e,t==null?void 0:t.fallbackMimeType),M=M||(l?`matched fallback MIME type ${p}`:"")),M&&T6.log(1,`selectLoader selected ${l==null?void 0:l.name}: ${M}.`),l}function tE(i){return!(i instanceof Response&&i.status===204)}function iE(i){const e=Dx(i),t=cw(i);let r="No valid loader found (";r+=e?`${HS(e)}, `:"no url provided, ",r+=`MIME type: ${t?`"${t}"`:"not provided"}, `;const o=i?nE(i):"";return r+=o?` first bytes: "${o}"`:"first bytes: not available",r+=")",r}function R8(i){for(const e of i)hw(e)}function C8(i,e){const t=e&&S8.exec(e),r=t&&t[1];return r?P8(i,r):null}function P8(i,e){e=e.toLowerCase();for(const t of i)for(const r of t.extensions)if(r.toLowerCase()===e)return t;return null}function bb(i,e){var t;for(const r of i)if((t=r.mimeTypes)!=null&&t.some(o=>pT(e,o))||pT(e,`application/x.${r.id}`))return r;return null}function I8(i,e){if(!e)return null;for(const t of i)if(typeof e=="string"){if(k8(e,t))return t}else if(ArrayBuffer.isView(e)){if(bT(e.buffer,e.byteOffset,t))return t}else if(e instanceof ArrayBuffer&&bT(e,0,t))return t;return null}function k8(i,e){return e.testText?e.testText(i):(Array.isArray(e.tests)?e.tests:[e.tests]).some(r=>i.startsWith(r))}function bT(i,e,t){return(Array.isArray(t.tests)?t.tests:[t.tests]).some(o=>D8(i,e,t,o))}function D8(i,e,t,r){if(r instanceof ArrayBuffer)return V6(r,i,r.byteLength);switch(typeof r){case"function":return r(i);case"string":const o=cA(i,e,r.length);return r===o;default:return!1}}function nE(i,e=5){return typeof i=="string"?i.slice(0,e):ArrayBuffer.isView(i)?cA(i.buffer,i.byteOffset,e):i instanceof ArrayBuffer?cA(i,0,e):""}function cA(i,e,t){if(i.byteLength<e+t)return"";const r=new DataView(i);let o="";for(let p=0;p<t;p++)o+=String.fromCharCode(r.getUint8(e+p));return o}const O8=256*1024;function*F8(i,e){const t=(e==null?void 0:e.chunkSize)||O8;let r=0;const o=new TextEncoder;for(;r<i.length;){const p=Math.min(i.length-r,t),_=i.slice(r,r+p);r+=p,yield o.encode(_)}}const N8=256*1024;function*B8(i,e={}){const{chunkSize:t=N8}=e;let r=0;for(;r<i.byteLength;){const o=Math.min(i.byteLength-r,t),p=new ArrayBuffer(o),_=new Uint8Array(i,r,o);new Uint8Array(p).set(_),r+=o,yield p}}const z8=1024*1024;async function*L8(i,e){const t=(e==null?void 0:e.chunkSize)||z8;let r=0;for(;r<i.size;){const o=r+t,p=await i.slice(r,o).arrayBuffer();r=o,yield p}}function AT(i,e){return aw?U8(i,e):V8(i)}async function*U8(i,e){const t=i.getReader();let r;try{for(;;){const o=r||t.read();e!=null&&e._streamReadAhead&&(r=t.read());const{done:p,value:_}=await o;if(p)return;yield XS(_)}}catch{t.releaseLock()}}async function*V8(i,e){for await(const t of i)yield XS(t)}function j8(i,e){if(typeof i=="string")return F8(i,e);if(i instanceof ArrayBuffer)return B8(i,e);if(I_(i))return L8(i,e);if($S(i))return AT(i,e);if(P_(i))return AT(i.body,e);throw new Error("makeIterator")}const rE="Cannot convert supplied data type";function G8(i,e,t){if(e.text&&typeof i=="string")return i;if(Q6(i)&&(i=i.buffer),i instanceof ArrayBuffer){const r=i;return e.text&&!e.binary?new TextDecoder("utf8").decode(r):r}if(ArrayBuffer.isView(i)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(i);let r=i.buffer;const o=i.byteLength||i.length;return(i.byteOffset!==0||o!==r.byteLength)&&(r=r.slice(i.byteOffset,i.byteOffset+o)),r}throw new Error(rE)}async function W8(i,e,t){const r=i instanceof ArrayBuffer||ArrayBuffer.isView(i);if(typeof i=="string"||r)return G8(i,e);if(I_(i)&&(i=await YS(i)),P_(i)){const o=i;return await l8(o),e.binary?await o.arrayBuffer():await o.text()}if($S(i)&&(i=j8(i,t)),Y6(i)||J6(i))return W6(i);throw new Error(rE)}function sE(i,e){const t=KS(),r=i||t;return typeof r.fetch=="function"?r.fetch:E1(r.fetch)?o=>mT(o,r.fetch):e!=null&&e.fetch?e==null?void 0:e.fetch:mT}function Z8(i,e,t){if(t)return t;const r={fetch:sE(e,i),...i};if(r.url){const o=lw(r.url);r.baseUrl=o,r.queryString=s8(r.url),r.filename=HS(o),r.baseUrl=$6(o)}return Array.isArray(r.loaders)||(r.loaders=null),r}function X8(i,e){if(i&&!Array.isArray(i))return i;let t;if(i&&(t=Array.isArray(i)?i:[i]),e&&e.loaders){const r=Array.isArray(e.loaders)?e.loaders:[e.loaders];t=t?[...t,...r]:r}return t&&t.length?t:void 0}async function Lv(i,e,t,r){e&&!Array.isArray(e)&&!uw(e)&&(r=void 0,t=e,e=void 0),i=await i,t=t||{};const o=Dx(i),_=X8(e,r),l=await E8(i,_,t);return l?(t=y8(t,l,_,o),r=Z8({url:o,_parse:Lv,loaders:_},t,r||null),await H8(l,i,t,r)):null}async function H8(i,e,t,r){if(B6(i),t=S6(i.options,t),P_(e)){const p=e,{ok:_,redirected:l,status:M,statusText:D,type:B,url:j}=p,$=Object.fromEntries(p.headers.entries());r.response={headers:$,ok:_,redirected:l,status:M,statusText:D,type:B,url:j}}e=await W8(e,i,t);const o=i;if(o.parseTextSync&&typeof e=="string")return o.parseTextSync(e,t,r);if(z6(i,t))return await L6(i,e,t,r,Lv);if(o.parseText&&typeof e=="string")return await o.parseText(e,t,r);if(o.parse)return await o.parse(e,t,r);throw $g(!o.parseSync),new Error(`${i.id} loader - no parser found and worker is disabled`)}function $8(i){switch(i.constructor){case Int8Array:return"int8";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int16Array:return"int16";case Uint16Array:return"uint16";case Int32Array:return"int32";case Uint32Array:return"uint32";case Float32Array:return"float32";case Float64Array:return"float64";default:return"null"}}function q8(i){let e=1/0,t=1/0,r=1/0,o=-1/0,p=-1/0,_=-1/0;const l=i.POSITION?i.POSITION.value:[],M=l&&l.length;for(let D=0;D<M;D+=3){const B=l[D],j=l[D+1],$=l[D+2];e=B<e?B:e,t=j<t?j:t,r=$<r?$:r,o=B>o?B:o,p=j>p?j:p,_=$>_?$:_}return[[e,t,r],[o,p,_]]}function Y8(i,e={}){return{fields:Q8(i),metadata:e}}function J8(i,e,t){const r=$8(e.value),o=t||K8(e);return{name:i,type:{type:"fixed-size-list",listSize:e.size,children:[{name:"value",type:r}]},nullable:!1,metadata:o}}function Q8(i){const e=[];for(const t in i){const r=i[t];e.push(J8(t,r))}return e}function K8(i){const e={};return"byteOffset"in i&&(e.byteOffset=i.byteOffset.toString(10)),"byteStride"in i&&(e.byteStride=i.byteStride.toString(10)),"normalized"in i&&(e.normalized=i.normalized.toString()),e}async function Uv(i,e,t,r){let o,p;!Array.isArray(e)&&!uw(e)?(o=[],p=e):(o=e,p=t);const _=sE(p);let l=i;return typeof i=="string"&&(l=await _(i)),I_(i)&&(l=await _(i)),Array.isArray(o)?await Lv(l,o,p):await Lv(l,o,p)}const e5="4.3.3",t5={dataType:null,batchType:null,name:"LAS",id:"las",module:"las",version:e5,worker:!0,extensions:["las","laz"],mimeTypes:["application/octet-stream"],text:!0,binary:!0,tests:["LAS"],options:{las:{shape:"mesh",fp64:!1,skip:1,colorDepth:8}}};function i5(){var i=typeof i<"u"?i:{},e={},t;for(t in i)i.hasOwnProperty(t)&&(e[t]=i[t]);var r=!1,o=!1,p=!1,_=!1;r=typeof window=="object",o=typeof importScripts=="function",p=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",_=!r&&!p&&!o;var l="";function M(ye){return i.locateFile?i.locateFile(ye,l):l+ye}var D,B,j,$,se;p?(o?l=require("path").dirname(l)+"/":l=(typeof __dirname<"u"?__dirname:"")+"/",D=function(me,Ve){var Z=Ma(me);return Z?Ve?Z:Z.toString():($||($=require("fs")),se||(se=require("path")),me=se.normalize(me),$.readFileSync(me,Ve?null:"utf8"))},j=function(me){var Ve=D(me,!0);return Ve.buffer||(Ve=new Uint8Array(Ve)),Rt(Ve.buffer),Ve},process.argv.length>1&&process.argv[1].replace(/\\/g,"/"),process.argv.slice(2),typeof rw<"u"&&(rw.exports=i),process.on("uncaughtException",function(ye){if(!(ye instanceof Bp))throw ye}),process.on("unhandledRejection",Qo),i.inspect=function(){return"[Emscripten Module object]"}):_?(typeof read<"u"&&(D=function(me){var Ve=Ma(me);return Ve?mh(Ve):read(me)}),j=function(me){var Ve;return Ve=Ma(me),Ve||(typeof readbuffer=="function"?new Uint8Array(readbuffer(me)):(Ve=read(me,"binary"),Rt(typeof Ve=="object"),Ve))},typeof scriptArgs<"u"&&scriptArgs,typeof print<"u"&&(typeof console>"u"&&(console={}),console.log=print,console.warn=console.error=typeof printErr<"u"?printErr:print)):(r||o)&&(o?l=self.location.href:document.currentScript&&(l=document.currentScript.src),l.indexOf("blob:")!==0?l=l.substr(0,l.lastIndexOf("/")+1):l="",D=function(me){try{var Ve=new XMLHttpRequest;return Ve.open("GET",me,!1),Ve.send(null),Ve.responseText}catch(mt){var Z=Ma(me);if(Z)return mh(Z);throw mt}},o&&(j=function(me){try{var Ve=new XMLHttpRequest;return Ve.open("GET",me,!1),Ve.responseType="arraybuffer",Ve.send(null),new Uint8Array(Ve.response)}catch(mt){var Z=Ma(me);if(Z)return Z;throw mt}}),B=function(me,Ve,Z){var mt=new XMLHttpRequest;mt.open("GET",me,!0),mt.responseType="arraybuffer",mt.onload=function(){if(mt.status==200||mt.status==0&&mt.response){Ve(mt.response);return}var Re=Ma(me);if(Re){Ve(Re.buffer);return}Z()},mt.onerror=Z,mt.send(null)});var de=i.print||console.log.bind(console),Ae=i.printErr||console.warn.bind(console);for(t in e)e.hasOwnProperty(t)&&(i[t]=e[t]);e=null,i.arguments&&i.arguments,i.thisProgram&&i.thisProgram,i.quit&&i.quit,new Array(0);var he=0,Le=function(ye){he=ye},$e=function(){return he},Be=8;i.wasmBinary&&i.wasmBinary,i.noExitRuntime&&i.noExitRuntime;var Je=!1;function Rt(ye,me){ye||Qo("Assertion failed: "+me)}var Et=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function kt(ye,me,Ve){for(var Z=me+Ve,mt=me;ye[mt]&&!(mt>=Z);)++mt;if(mt-me>16&&ye.subarray&&Et)return Et.decode(ye.subarray(me,mt));for(var c="";me<mt;){var Re=ye[me++];if(!(Re&128)){c+=String.fromCharCode(Re);continue}var Ft=ye[me++]&63;if((Re&224)==192){c+=String.fromCharCode((Re&31)<<6|Ft);continue}var ci=ye[me++]&63;if((Re&240)==224?Re=(Re&15)<<12|Ft<<6|ci:Re=(Re&7)<<18|Ft<<12|ci<<6|ye[me++]&63,Re<65536)c+=String.fromCharCode(Re);else{var si=Re-65536;c+=String.fromCharCode(55296|si>>10,56320|si&1023)}}return c}function Ht(ye,me){return ye?kt(Ye,ye,me):""}function Xt(ye,me,Ve,Z){if(!(Z>0))return 0;for(var mt=Ve,c=Ve+Z-1,Re=0;Re<ye.length;++Re){var Ft=ye.charCodeAt(Re);if(Ft>=55296&&Ft<=57343){var ci=ye.charCodeAt(++Re);Ft=65536+((Ft&1023)<<10)|ci&1023}if(Ft<=127){if(Ve>=c)break;me[Ve++]=Ft}else if(Ft<=2047){if(Ve+1>=c)break;me[Ve++]=192|Ft>>6,me[Ve++]=128|Ft&63}else if(Ft<=65535){if(Ve+2>=c)break;me[Ve++]=224|Ft>>12,me[Ve++]=128|Ft>>6&63,me[Ve++]=128|Ft&63}else{if(Ve+3>=c)break;me[Ve++]=240|Ft>>18,me[Ve++]=128|Ft>>12&63,me[Ve++]=128|Ft>>6&63,me[Ve++]=128|Ft&63}}return me[Ve]=0,Ve-mt}function hi(ye,me,Ve){return Xt(ye,Ye,me,Ve)}function di(ye){for(var me=0,Ve=0;Ve<ye.length;++Ve){var Z=ye.charCodeAt(Ve);Z>=55296&&Z<=57343&&(Z=65536+((Z&1023)<<10)|ye.charCodeAt(++Ve)&1023),Z<=127?++me:Z<=2047?me+=2:Z<=65535?me+=3:me+=4}return me}var Ei=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0;function Ii(ye,me){for(var Ve=ye,Z=Ve>>1,mt=Z+me/2;!(Z>=mt)&&vi[Z];)++Z;if(Ve=Z<<1,Ve-ye>32&&Ei)return Ei.decode(Ye.subarray(ye,Ve));for(var c=0,Re="";;){var Ft=Gt[ye+c*2>>1];if(Ft==0||c==me/2)return Re;++c,Re+=String.fromCharCode(Ft)}}function fi(ye,me,Ve){if(Ve===void 0&&(Ve=2147483647),Ve<2)return 0;Ve-=2;for(var Z=me,mt=Ve<ye.length*2?Ve/2:ye.length,c=0;c<mt;++c){var Re=ye.charCodeAt(c);Gt[me>>1]=Re,me+=2}return Gt[me>>1]=0,me-Z}function Ui(ye){return ye.length*2}function nt(ye,me){for(var Ve=0,Z="";!(Ve>=me/4);){var mt=Si[ye+Ve*4>>2];if(mt==0)break;if(++Ve,mt>=65536){var c=mt-65536;Z+=String.fromCharCode(55296|c>>10,56320|c&1023)}else Z+=String.fromCharCode(mt)}return Z}function Ut(ye,me,Ve){if(Ve===void 0&&(Ve=2147483647),Ve<4)return 0;for(var Z=me,mt=Z+Ve-4,c=0;c<ye.length;++c){var Re=ye.charCodeAt(c);if(Re>=55296&&Re<=57343){var Ft=ye.charCodeAt(++c);Re=65536+((Re&1023)<<10)|Ft&1023}if(Si[me>>2]=Re,me+=4,me+4>mt)break}return Si[me>>2]=0,me-Z}function mi(ye){for(var me=0,Ve=0;Ve<ye.length;++Ve){var Z=ye.charCodeAt(Ve);Z>=55296&&Z<=57343&&++Ve,me+=4}return me}var li,Wi,Ye,Gt,vi,Si,Li,Vi,yn;function Kn(ye){li=ye,i.HEAP8=Wi=new Int8Array(ye),i.HEAP16=Gt=new Int16Array(ye),i.HEAP32=Si=new Int32Array(ye),i.HEAPU8=Ye=new Uint8Array(ye),i.HEAPU16=vi=new Uint16Array(ye),i.HEAPU32=Li=new Uint32Array(ye),i.HEAPF32=Vi=new Float32Array(ye),i.HEAPF64=yn=new Float64Array(ye)}var mr=5265264,Co=22176,Oa=i.INITIAL_MEMORY||167772160;i.buffer?li=i.buffer:li=new ArrayBuffer(Oa),Oa=li.byteLength,Kn(li),Si[Co>>2]=mr;function ra(ye){for(;ye.length>0;){var me=ye.shift();if(typeof me=="function"){me(i);continue}var Ve=me.func;typeof Ve=="number"?me.arg===void 0?i.dynCall_v(Ve):i.dynCall_vi(Ve,me.arg):Ve(me.arg===void 0?null:me.arg)}}var uh=[],br=[],Fa=[],Na=[];function Ir(){if(i.preRun)for(typeof i.preRun=="function"&&(i.preRun=[i.preRun]);i.preRun.length;)Po(i.preRun.shift());ra(uh)}function xl(){ra(br)}function Fc(){ra(Fa)}function Nc(){if(i.postRun)for(typeof i.postRun=="function"&&(i.postRun=[i.postRun]);i.postRun.length;)ic(i.postRun.shift());ra(Na)}function Po(ye){uh.unshift(ye)}function ic(ye){Na.unshift(ye)}var so=0,Qr=null;function ao(ye){so++,i.monitorRunDependencies&&i.monitorRunDependencies(so)}function nc(ye){if(so--,i.monitorRunDependencies&&i.monitorRunDependencies(so),so==0&&Qr){var me=Qr;Qr=null,me()}}i.preloadedImages={},i.preloadedAudios={};function Qo(ye){throw i.onAbort&&i.onAbort(ye),ye+="",de(ye),Ae(ye),Je=!0,ye="abort("+ye+"). Build with -s ASSERTIONS=1 for more info.",ye}var Ls=null;function hh(ye,me){return String.prototype.startsWith?ye.startsWith(me):ye.indexOf(me)===0}var it="data:application/octet-stream;base64,";function fe(ye){return hh(ye,it)}br.push({func:function(){Sr()}}),Ls="data:application/octet-stream;base64,AAAAAAAAAAAPDg0MCwoJCA4AAQMGCgoJDQECBAcLCwoMAwQFCAwMCwsGBwgJDQ0MCgoLDA0ODg0JCgsMDQ4PDggJCgsMDQ4PAAECAwQFBgcBAAECAwQFBgIBAAECAwQFAwIBAAECAwQEAwIBAAECAwUEAwIBAAECBgUEAwIBAAEHBgUEAwIBAMgPAAAoDQAAEBAAACAQAADIDwAAUA0AABAQAAAgEAAAEQAKABEREQAAAAAFAAAAAAAACQAAAAALAAAAAAAAAAARAA8KERERAwoHAAEACQsLAAAJBgsAAAsABhEAAAAREREAAAAAAAAAAAAAAAAAAAAACwAAAAAAAAAAEQAKChEREQAKAAACAAkLAAAACQALAAALAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAADAAAAAAJDAAAAAAADAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAANAAAABA0AAAAACQ4AAAAAAA4AAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAADwAAAAAPAAAAAAkQAAAAAAAQAAAQAAASAAAAEhISAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAASEhIAAAAAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALAAAAAAAAAAAAAAAKAAAAAAoAAAAACQsAAAAAAAsAAAsAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAMAAAAAAkMAAAAAAAMAAAMAAAwMTIzNDU2Nzg5QUJDREVGGRJEOwI/LEcUPTMwChsGRktFNw9JDo4XA0AdPGkrNh9KLRwBICUpIQgMFRYiLhA4Pgs0MRhkdHV2L0EJfzkRI0MyQomKiwUEJignDSoeNYwHGkiTE5SVAAAAAAAAAAAASWxsZWdhbCBieXRlIHNlcXVlbmNlAERvbWFpbiBlcnJvcgBSZXN1bHQgbm90IHJlcHJlc2VudGFibGUATm90IGEgdHR5AFBlcm1pc3Npb24gZGVuaWVkAE9wZXJhdGlvbiBub3QgcGVybWl0dGVkAE5vIHN1Y2ggZmlsZSBvciBkaXJlY3RvcnkATm8gc3VjaCBwcm9jZXNzAEZpbGUgZXhpc3RzAFZhbHVlIHRvbyBsYXJnZSBmb3IgZGF0YSB0eXBlAE5vIHNwYWNlIGxlZnQgb24gZGV2aWNlAE91dCBvZiBtZW1vcnkAUmVzb3VyY2UgYnVzeQBJbnRlcnJ1cHRlZCBzeXN0ZW0gY2FsbABSZXNvdXJjZSB0ZW1wb3JhcmlseSB1bmF2YWlsYWJsZQBJbnZhbGlkIHNlZWsAQ3Jvc3MtZGV2aWNlIGxpbmsAUmVhZC1vbmx5IGZpbGUgc3lzdGVtAERpcmVjdG9yeSBub3QgZW1wdHkAQ29ubmVjdGlvbiByZXNldCBieSBwZWVyAE9wZXJhdGlvbiB0aW1lZCBvdXQAQ29ubmVjdGlvbiByZWZ1c2VkAEhvc3QgaXMgZG93bgBIb3N0IGlzIHVucmVhY2hhYmxlAEFkZHJlc3MgaW4gdXNlAEJyb2tlbiBwaXBlAEkvTyBlcnJvcgBObyBzdWNoIGRldmljZSBvciBhZGRyZXNzAEJsb2NrIGRldmljZSByZXF1aXJlZABObyBzdWNoIGRldmljZQBOb3QgYSBkaXJlY3RvcnkASXMgYSBkaXJlY3RvcnkAVGV4dCBmaWxlIGJ1c3kARXhlYyBmb3JtYXQgZXJyb3IASW52YWxpZCBhcmd1bWVudABBcmd1bWVudCBsaXN0IHRvbyBsb25nAFN5bWJvbGljIGxpbmsgbG9vcABGaWxlbmFtZSB0b28gbG9uZwBUb28gbWFueSBvcGVuIGZpbGVzIGluIHN5c3RlbQBObyBmaWxlIGRlc2NyaXB0b3JzIGF2YWlsYWJsZQBCYWQgZmlsZSBkZXNjcmlwdG9yAE5vIGNoaWxkIHByb2Nlc3MAQmFkIGFkZHJlc3MARmlsZSB0b28gbGFyZ2UAVG9vIG1hbnkgbGlua3MATm8gbG9ja3MgYXZhaWxhYmxlAFJlc291cmNlIGRlYWRsb2NrIHdvdWxkIG9jY3VyAFN0YXRlIG5vdCByZWNvdmVyYWJsZQBQcmV2aW91cyBvd25lciBkaWVkAE9wZXJhdGlvbiBjYW5jZWxlZABGdW5jdGlvbiBub3QgaW1wbGVtZW50ZWQATm8gbWVzc2FnZSBvZiBkZXNpcmVkIHR5cGUASWRlbnRpZmllciByZW1vdmVkAERldmljZSBub3QgYSBzdHJlYW0ATm8gZGF0YSBhdmFpbGFibGUARGV2aWNlIHRpbWVvdXQAT3V0IG9mIHN0cmVhbXMgcmVzb3VyY2VzAExpbmsgaGFzIGJlZW4gc2V2ZXJlZABQcm90b2NvbCBlcnJvcgBCYWQgbWVzc2FnZQBGaWxlIGRlc2NyaXB0b3IgaW4gYmFkIHN0YXRlAE5vdCBhIHNvY2tldABEZXN0aW5hdGlvbiBhZGRyZXNzIHJlcXVpcmVkAE1lc3NhZ2UgdG9vIGxhcmdlAFByb3RvY29sIHdyb25nIHR5cGUgZm9yIHNvY2tldABQcm90b2NvbCBub3QgYXZhaWxhYmxlAFByb3RvY29sIG5vdCBzdXBwb3J0ZWQAU29ja2V0IHR5cGUgbm90IHN1cHBvcnRlZABOb3Qgc3VwcG9ydGVkAFByb3RvY29sIGZhbWlseSBub3Qgc3VwcG9ydGVkAEFkZHJlc3MgZmFtaWx5IG5vdCBzdXBwb3J0ZWQgYnkgcHJvdG9jb2wAQWRkcmVzcyBub3QgYXZhaWxhYmxlAE5ldHdvcmsgaXMgZG93bgBOZXR3b3JrIHVucmVhY2hhYmxlAENvbm5lY3Rpb24gcmVzZXQgYnkgbmV0d29yawBDb25uZWN0aW9uIGFib3J0ZWQATm8gYnVmZmVyIHNwYWNlIGF2YWlsYWJsZQBTb2NrZXQgaXMgY29ubmVjdGVkAFNvY2tldCBub3QgY29ubmVjdGVkAENhbm5vdCBzZW5kIGFmdGVyIHNvY2tldCBzaHV0ZG93bgBPcGVyYXRpb24gYWxyZWFkeSBpbiBwcm9ncmVzcwBPcGVyYXRpb24gaW4gcHJvZ3Jlc3MAU3RhbGUgZmlsZSBoYW5kbGUAUmVtb3RlIEkvTyBlcnJvcgBRdW90YSBleGNlZWRlZABObyBtZWRpdW0gZm91bmQAV3JvbmcgbWVkaXVtIHR5cGUATm8gZXJyb3IgaW5mb3JtYXRpb24AAAAAAADgFgAAmRgAAGAQAAAAAAAA4BYAAEIZAABgEAAAAAAAAOAWAAAqGgAASA8AAAAAAAC4FgAANBsAAOAWAACfGgAAMAoAAAAAAADgFgAAaRsAAEgPAAAAAAAA4BYAAIobAABIDwAAAAAAALgWAAAPHAAA4BYAAHwcAABIDwAAAAAAAOAWAACVHAAASA8AAAAAAADgFgAAHh0AAEgPAAAAAAAA4BYAAHcdAABIDwAAAAAAAOAWAACQHQAASA8AAAAAAADgFgAAQh4AAEgPAAAAAAAA4BYAAIceAABgEAAAAAAAAOAWAACkHwAASA8AAAAAAAC4FgAAZyAAAOAWAADkHwAA8AoAAAAAAADgFgAAjyAAAGAQAAAAAAAAuBYAAMMiAADgFgAAAiIAABgLAAAAAAAA4BYAAOEiAABgEAAAAAAAAOAWAADQJAAAGAsAAAAAAADgFgAAkSUAAGAQAAAAAAAA4BYAAIAnAAAYCwAAAAAAAOAWAAA9KAAAYBAAAAAAAADgFgAAJCoAABgLAAAAAAAA4BYAAOkqAABgEAAAAAAAAOAWAADgLAAA8AoAAAAAAADgFgAAui0AAGAQAAAAAAAA4BYAANsvAADwCgAAAAAAAOAWAADTMAAAYBAAAAAAAADgFgAAMDMAAPAKAAAAAAAA4BYAACQ0AABgEAAAAAAAAOAWAAB5NgAA8AoAAAAAAADgFgAAizcAAGAQAAAAAAAA4BYAABw6AABgEAAAAAAAAOAWAACdOgAAYBAAAAAAAADgFgAAXjsAAPAKAAAAAAAA4BYAALU7AABgEAAAAAAAAOAWAADMPAAAGAsAAAAAAADgFgAATz0AAGAQAAAAAAAA4BYAAL4+AAAYCwAAAAAAAOAWAABBPwAAYBAAAAAAAADgFgAAsEAAABgLAAAAAAAA4BYAADNBAABgEAAAAAAAAOAWAACiQgAAGAsAAAAAAADgFgAAJUMAAGAQAAAAAAAA4BYAAJREAAAYCwAAAAAAAOAWAAAXRQAAYBAAAAAAAADgFgAAhkYAABgLAAAAAAAA4BYAAAlHAABgEAAAAAAAALgWAAB4SAAAiBcAAIBIAAAAAAAAIA0AAIgXAACJSAAAAQAAACANAAC4FgAAqkgAAIgXAAC6SAAAAAAAAEgNAACIFwAAy0gAAAEAAABIDQAAuBYAABhMAAC4FgAAN0wAALgWAABWTAAAuBYAAHVMAAC4FgAAlEwAALgWAACzTAAAuBYAANJMAAC4FgAA8UwAALgWAAAQTQAAuBYAAC9NAAC4FgAATk0AALgWAABtTQAAuBYAAIxNAACkFwAAn00AAAAAAAABAAAA8A0AAAAAAAC4FgAA4U0AAKQXAAAHTgAAAAAAAAEAAADwDQAAAAAAAKQXAABJTgAAAAAAAAEAAADwDQAAAAAAAKQXAACITgAAAAAAAAEAAADwDQAAAAAAAKQXAADHTgAAAAAAAAEAAADwDQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP//////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALgWAADNTwAA4BYAAC1QAAAADwAAAAAAAOAWAADaTwAAEA8AAAAAAAC4FgAA+08AAOAWAAAIUAAA8A4AAAAAAADgFgAAhlAAAOgOAAAAAAAA4BYAAJNQAADoDgAAAAAAAOAWAACjUAAA6A4AAAAAAADgFgAAtVAAADgPAAAAAAAA4BYAAMZQAAA4DwAAAAAAAOAWAADXUAAAAA8AAAAAAADgFgAA+VAAAHgPAAAAAAAA4BYAAB1RAAAADwAAAAAAAOAWAABCUQAAeA8AAAAAAADgFgAAjlEAAAAPAAAAAAAAbBcAALZRAABsFwAAuFEAAGwXAAC7UQAAbBcAAL1RAABsFwAAv1EAAGwXAADBUQAAbBcAAMNRAABsFwAAxVEAAGwXAADHUQAAbBcAAMlRAABsFwAAy1EAAGwXAADNUQAAbBcAAM9RAABsFwAA0VEAAOAWAADTUQAA8A4AAAAAAADgFgAARlIAAOgOAAAAAAAAuBYAAGJSAACkFwAAe1IAAAAAAAABAAAAWBAAAAAAAADgFgAA9FIAAIgQAAAAAAAA4BYAABdTAACYEAAAAAAAALgWAAAuUwAA4BYAAHBTAACIEAAAAAAAAOAWAACSUwAASA8AAAAAAAAAAAAAAAoAAAEAAAACAAAAAwAAAAEAAAAEAAAAAAAAABAKAAABAAAABQAAAAYAAAACAAAABwAAAAAAAAAgCgAACAAAAAkAAAABAAAAAAAAADgKAAAKAAAACwAAAAIAAAABAAAADAAAAA0AAAACAAAAAwAAAAMAAAAAAAAASAoAAAgAAAAOAAAAAQAAAAAAAABYCgAACAAAAA8AAAABAAAAAAAAAIAKAAAIAAAAEAAAAAEAAAAAAAAAcAoAAAgAAAARAAAAAQAAAAAAAACQCgAACAAAABIAAAABAAAAAAAAAKAKAAAIAAAAEwAAAAEAAAAAAAAAsAoAAAgAAAAUAAAAAQAAAAAAAADACgAACAAAABUAAAABAAAAAAAAANAKAAABAAAAFgAAABcAAAAEAAAAGAAAAAAAAADgCgAACAAAABkAAAABAAAAAAAAAPgKAAAFAAAAGgAAABsAAAAAAAAA8AoAAAEAAAAcAAAAHQAAAAAAAAAICwAAAQAAAB4AAAAfAAAABgAAACAAAAAAAAAAIAsAACEAAAAiAAAABwAAAAgAAAAAAAAAGAsAACMAAAAkAAAABwAAAAkAAAAAAAAAMAsAAAEAAAAlAAAAJgAAAAoAAAAnAAAAAAAAAEALAAAoAAAAKQAAAAcAAAALAAAAAAAAAFALAAABAAAAKgAAACsAAAAMAAAALAAAAAAAAABgCwAALQAAAC4AAAAHAAAADQAAAAAAAABwCwAAAQAAAC8AAAAwAAAADgAAADEAAAAAAAAAgAsAADIAAAAzAAAABwAAAA8AAAAAAAAAkAsAAAEAAAA0AAAANQAAABAAAAA2AAAAAAAAAKALAAARAAAANwAAADgAAAAAAAAAsAsAAAEAAAA5AAAAOgAAABIAAAA7AAAAAAAAAMALAAATAAAAPAAAAD0AAAAAAAAA0AsAAAEAAAA+AAAAPwAAABQAAABAAAAAAAAAAOALAAAVAAAAQQAAAEIAAAAAAAAA8AsAAAEAAABDAAAARAAAABYAAABFAAAAAAAAAAAMAAAXAAAARgAAAEcAAAAAAAAAEAwAAAEAAABIAAAASQAAABgAAABKAAAAAAAAACAMAAABAAAASwAAAEwAAAAZAAAATQAAAAAAAAAwDAAAAQAAAE4AAABPAAAAGgAAAFAAAAAAAAAAQAwAABsAAABRAAAAUgAAAAAAAABQDAAAAQAAAFMAAABUAAAAHAAAAFUAAAAAAAAAYAwAAFYAAABXAAAABwAAAB0AAAAAAAAAcAwAAAEAAABYAAAAWQAAAB4AAABaAAAAAAAAAIAMAABbAAAAXAAAAAcAAAAfAAAAAAAAAJAMAAABAAAAXQAAAF4AAAAgAAAAXwAAAAAAAACgDAAAYAAAAGEAAAAHAAAAIQAAAAAAAACwDAAAAQAAAGIAAABjAAAAIgAAAGQAAAAAAAAAwAwAAGUAAABmAAAABwAAACMAAAAAAAAA0AwAAAEAAABnAAAAaAAAACQAAABpAAAAAAAAAOAMAABqAAAAawAAAAcAAAAlAAAAAAAAAPAMAAABAAAAbAAAAG0AAAAmAAAAbgAAAAAAAAAADQAAbwAAAHAAAAAHAAAAJwAAAAAAAAAQDQAAAQAAAHEAAAByAAAAKAAAAHMAAAAoDQAAyA8AACgNAAAIEAAAEBAAACgNAABQDQAAyA8AAFANAAAgEAAAyA8AAFANAAAIEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABsVAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADwDgAAdAAAAHUAAAB2AAAAdwAAAAIAAAABAAAAAQAAAAEAAAAAAAAAGA8AAHQAAAB4AAAAdgAAAHcAAAACAAAAAgAAAAIAAAACAAAAAAAAACgPAAB5AAAAegAAAAQAAAAAAAAAOA8AAHsAAAB8AAAABQAAAAAAAABIDwAACAAAAH0AAAABAAAAAAAAAFgPAAB7AAAAfgAAAAUAAAAAAAAAaA8AAHsAAAB/AAAABQAAAAAAAAC4DwAAdAAAAIAAAAB2AAAAdwAAAAMAAAAAAAAAiA8AAHQAAACBAAAAdgAAAHcAAAAEAAAAAAAAADgQAAB0AAAAggAAAHYAAAB3AAAAAgAAAAMAAAADAAAAAwAAAAAAAABIEAAAgwAAAIQAAAAGAAAAAAAAAHgQAACFAAAAhgAAAAcAAAABAAAABQAAAAYAAAACAAAAAAAAAKAQAACFAAAAhwAAAAgAAAADAAAABQAAAAYAAAAEAAAA4BcAAAQYAAAAAAAAsBAAAIgAAACJAAAAAQAAAExBU1ppcABvcGVuAGdldFBvaW50AGdldENvdW50AER5bmFtaWNMQVNaaXAAYWRkRmllbGRGbG9hdGluZwBhZGRGaWVsZFNpZ25lZABhZGRGaWVsZFVuc2lnbmVkAE5TdDNfXzIyMF9fc2hhcmVkX3B0cl9wb2ludGVySVBONmxhc3ppcDdzdHJlYW1zMTNtZW1vcnlfc3RyZWFtRU5TXzE0ZGVmYXVsdF9kZWxldGVJUzNfRUVOU185YWxsb2NhdG9ySVMzX0VFRUUATlN0M19fMjE0ZGVmYXVsdF9kZWxldGVJTjZsYXN6aXA3c3RyZWFtczEzbWVtb3J5X3N0cmVhbUVFRQBOU3QzX18yMjBfX3NoYXJlZF9wdHJfcG9pbnRlcklQTjZsYXN6aXAyaW82cmVhZGVyMTBiYXNpY19maWxlSU5TMV83c3RyZWFtczEzbWVtb3J5X3N0cmVhbUVFRU5TXzE0ZGVmYXVsdF9kZWxldGVJUzdfRUVOU185YWxsb2NhdG9ySVM3X0VFRUUATlN0M19fMjE0ZGVmYXVsdF9kZWxldGVJTjZsYXN6aXAyaW82cmVhZGVyMTBiYXNpY19maWxlSU5TMV83c3RyZWFtczEzbWVtb3J5X3N0cmVhbUVFRUVFAExBU0YATjZsYXN6aXAxM2ludmFsaWRfbWFnaWNFAGFsbG9jYXRvcjxUPjo6YWxsb2NhdGUoc2l6ZV90IG4pICduJyBleGNlZWRzIG1heGltdW0gc3VwcG9ydGVkIHNpemUARmlsZSBtYWdpYyBpcyBub3QgdmFsaWQATlN0M19fMjEwX19mdW5jdGlvbjZfX2Z1bmNJWk42bGFzemlwMmlvNnJlYWRlcjEwYmFzaWNfZmlsZUlOUzJfN3N0cmVhbXMxM21lbW9yeV9zdHJlYW1FRTExX3ZhbGlkYXRvcnNFdkVVbFJOUzNfNmhlYWRlckVFX05TXzlhbGxvY2F0b3JJU0JfRUVGdlNBX0VFRQBOU3QzX18yMTBfX2Z1bmN0aW9uNl9fYmFzZUlGdlJONmxhc3ppcDJpbzZoZWFkZXJFRUVFAE42bGFzemlwMjFvbGRfc3R5bGVfY29tcHJlc3Npb25FAE42bGFzemlwMTRub3RfY29tcHJlc3NlZEUAVGhlIGZpbGUgc2VlbXMgdG8gaGF2ZSBvbGQgc3R5bGUgY29tcHJlc3Npb24gd2hpY2ggaXMgbm90IHN1cHBvcnRlZABUaGUgZmlsZSBkb2Vzbid0IHNlZW0gdG8gYmUgY29tcHJlc3NlZABaTjZsYXN6aXAyaW82cmVhZGVyMTBiYXNpY19maWxlSU5TXzdzdHJlYW1zMTNtZW1vcnlfc3RyZWFtRUUxMV92YWxpZGF0b3JzRXZFVWxSTlMwXzZoZWFkZXJFRV8AbGFzemlwIGVuY29kZWQATjZsYXN6aXAxM25vX2xhc3ppcF92bHJFAE42bGFzemlwMjVsYXN6aXBfZm9ybWF0X3Vuc3VwcG9ydGVkRQBPbmx5IExBU3ppcCBQT0lOVFdJU0UgQ0hVTktFRCBkZWNvbXByZXNzb3IgaXMgc3VwcG9ydGVkAE5vIExBU3ppcCBWTFIgd2FzIGZvdW5kIGluIHRoZSBWTFJzIHNlY3Rpb24ATjZsYXN6aXAyMmNodW5rX3RhYmxlX3JlYWRfZXJyb3JFAENodW5rIHRhYmxlIG9mZnNldCA9PSAtMSBpcyBub3Qgc3VwcG9ydGVkIGF0IHRoaXMgdGltZQBONmxhc3ppcDEzbm90X3N1cHBvcnRlZEUATjZsYXN6aXAyNnVua25vd25fY2h1bmtfdGFibGVfZm9ybWF0RQBjaHVua19zaXplID09IHVpbnQubWF4IGlzIG5vdCBzdXBwb3J0ZWQgYXQgdGhpcyB0aW1lLgBUaGVyZSB3YXMgYSBwcm9ibGVtIHJlYWRpbmcgdGhlIGNodW5rIHRhYmxlAFRoZSBjaHVuayB0YWJsZSB2ZXJzaW9uIG51bWJlciBpcyB1bmtub3duAE42bGFzemlwMTFlbmRfb2ZfZmlsZUUAUmVhY2hlZCBFbmQgb2YgZmlsZQBJbnZhbGlkIG51bWJlciBvZiBzeW1ib2xzAE5TdDNfXzIyMF9fc2hhcmVkX3B0cl9wb2ludGVySVBONmxhc3ppcDhkZWNvZGVyczEwYXJpdGhtZXRpY0lOUzFfMmlvMThfX2lmc3RyZWFtX3dyYXBwZXJJTlMxXzdzdHJlYW1zMTNtZW1vcnlfc3RyZWFtRUVFRUVOU18xNGRlZmF1bHRfZGVsZXRlSVM5X0VFTlNfOWFsbG9jYXRvcklTOV9FRUVFAE5TdDNfXzIxNGRlZmF1bHRfZGVsZXRlSU42bGFzemlwOGRlY29kZXJzMTBhcml0aG1ldGljSU5TMV8yaW8xOF9faWZzdHJlYW1fd3JhcHBlcklOUzFfN3N0cmVhbXMxM21lbW9yeV9zdHJlYW1FRUVFRUVFAE42bGFzemlwMTl1bmtub3duX3NjaGVtYV90eXBlRQBUaGUgTEFaIHNjaGVtYSBpcyBub3QgcmVjb2duaXplZABONmxhc3ppcDdmb3JtYXRzMjZkeW5hbWljX2ZpZWxkX2RlY29tcHJlc3NvcklOU184ZGVjb2RlcnMxMGFyaXRobWV0aWNJTlNfMmlvMThfX2lmc3RyZWFtX3dyYXBwZXJJTlNfN3N0cmVhbXMxM21lbW9yeV9zdHJlYW1FRUVFRUVFAE42bGFzemlwN2Zvcm1hdHMyMGR5bmFtaWNfZGVjb21wcmVzc29yRQBOU3QzX18yMjBfX3NoYXJlZF9wdHJfcG9pbnRlcklQTjZsYXN6aXA3Zm9ybWF0czI2ZHluYW1pY19maWVsZF9kZWNvbXByZXNzb3JJTlMxXzhkZWNvZGVyczEwYXJpdGhtZXRpY0lOUzFfMmlvMThfX2lmc3RyZWFtX3dyYXBwZXJJTlMxXzdzdHJlYW1zMTNtZW1vcnlfc3RyZWFtRUVFRUVFRU5TXzE0ZGVmYXVsdF9kZWxldGVJU0NfRUVOU185YWxsb2NhdG9ySVNDX0VFRUUATlN0M19fMjE0ZGVmYXVsdF9kZWxldGVJTjZsYXN6aXA3Zm9ybWF0czI2ZHluYW1pY19maWVsZF9kZWNvbXByZXNzb3JJTlMxXzhkZWNvZGVyczEwYXJpdGhtZXRpY0lOUzFfMmlvMThfX2lmc3RyZWFtX3dyYXBwZXJJTlMxXzdzdHJlYW1zMTNtZW1vcnlfc3RyZWFtRUVFRUVFRUVFAE42bGFzemlwN2Zvcm1hdHMyNmR5bmFtaWNfZGVjb21wcmVzc29yX2ZpZWxkSU5TXzhkZWNvZGVyczEwYXJpdGhtZXRpY0lOU18yaW8xOF9faWZzdHJlYW1fd3JhcHBlcklOU183c3RyZWFtczEzbWVtb3J5X3N0cmVhbUVFRUVFTlMwXzVmaWVsZElOUzBfM2xhczdwb2ludDEwRU5TMF8yMHN0YW5kYXJkX2RpZmZfbWV0aG9kSVNDX0VFRUVFRQBONmxhc3ppcDdmb3JtYXRzMTBiYXNlX2ZpZWxkRQBOU3QzX18yMjBfX3NoYXJlZF9wdHJfcG9pbnRlcklQTjZsYXN6aXA3Zm9ybWF0czI2ZHluYW1pY19kZWNvbXByZXNzb3JfZmllbGRJTlMxXzhkZWNvZGVyczEwYXJpdGhtZXRpY0lOUzFfMmlvMThfX2lmc3RyZWFtX3dyYXBwZXJJTlMxXzdzdHJlYW1zMTNtZW1vcnlfc3RyZWFtRUVFRUVOUzJfNWZpZWxkSU5TMl8zbGFzN3BvaW50MTBFTlMyXzIwc3RhbmRhcmRfZGlmZl9tZXRob2RJU0VfRUVFRUVFTlNfMTRkZWZhdWx0X2RlbGV0ZUlTSV9FRU5TXzlhbGxvY2F0b3JJU0lfRUVFRQBOU3QzX18yMTRkZWZhdWx0X2RlbGV0ZUlONmxhc3ppcDdmb3JtYXRzMjZkeW5hbWljX2RlY29tcHJlc3Nvcl9maWVsZElOUzFfOGRlY29kZXJzMTBhcml0aG1ldGljSU5TMV8yaW8xOF9faWZzdHJlYW1fd3JhcHBlcklOUzFfN3N0cmVhbXMxM21lbW9yeV9zdHJlYW1FRUVFRU5TMl81ZmllbGRJTlMyXzNsYXM3cG9pbnQxMEVOUzJfMjBzdGFuZGFyZF9kaWZmX21ldGhvZElTRV9FRUVFRUVFRQBONmxhc3ppcDdmb3JtYXRzMjZkeW5hbWljX2RlY29tcHJlc3Nvcl9maWVsZElOU184ZGVjb2RlcnMxMGFyaXRobWV0aWNJTlNfMmlvMThfX2lmc3RyZWFtX3dyYXBwZXJJTlNfN3N0cmVhbXMxM21lbW9yeV9zdHJlYW1FRUVFRU5TMF81ZmllbGRJTlMwXzNsYXM3Z3BzdGltZUVOUzBfMjBzdGFuZGFyZF9kaWZmX21ldGhvZElTQ19FRUVFRUUATlN0M19fMjIwX19zaGFyZWRfcHRyX3BvaW50ZXJJUE42bGFzemlwN2Zvcm1hdHMyNmR5bmFtaWNfZGVjb21wcmVzc29yX2ZpZWxkSU5TMV84ZGVjb2RlcnMxMGFyaXRobWV0aWNJTlMxXzJpbzE4X19pZnN0cmVhbV93cmFwcGVySU5TMV83c3RyZWFtczEzbWVtb3J5X3N0cmVhbUVFRUVFTlMyXzVmaWVsZElOUzJfM2xhczdncHN0aW1lRU5TMl8yMHN0YW5kYXJkX2RpZmZfbWV0aG9kSVNFX0VFRUVFRU5TXzE0ZGVmYXVsdF9kZWxldGVJU0lfRUVOU185YWxsb2NhdG9ySVNJX0VFRUUATlN0M19fMjE0ZGVmYXVsdF9kZWxldGVJTjZsYXN6aXA3Zm9ybWF0czI2ZHluYW1pY19kZWNvbXByZXNzb3JfZmllbGRJTlMxXzhkZWNvZGVyczEwYXJpdGhtZXRpY0lOUzFfMmlvMThfX2lmc3RyZWFtX3dyYXBwZXJJTlMxXzdzdHJlYW1zMTNtZW1vcnlfc3RyZWFtRUVFRUVOUzJfNWZpZWxkSU5TMl8zbGFzN2dwc3RpbWVFTlMyXzIwc3RhbmRhcmRfZGlmZl9tZXRob2RJU0VfRUVFRUVFRUUATjZsYXN6aXA3Zm9ybWF0czI2ZHluYW1pY19kZWNvbXByZXNzb3JfZmllbGRJTlNfOGRlY29kZXJzMTBhcml0aG1ldGljSU5TXzJpbzE4X19pZnN0cmVhbV93cmFwcGVySU5TXzdzdHJlYW1zMTNtZW1vcnlfc3RyZWFtRUVFRUVOUzBfNWZpZWxkSU5TMF8zbGFzM3JnYkVOUzBfMjBzdGFuZGFyZF9kaWZmX21ldGhvZElTQ19FRUVFRUUATlN0M19fMjIwX19zaGFyZWRfcHRyX3BvaW50ZXJJUE42bGFzemlwN2Zvcm1hdHMyNmR5bmFtaWNfZGVjb21wcmVzc29yX2ZpZWxkSU5TMV84ZGVjb2RlcnMxMGFyaXRobWV0aWNJTlMxXzJpbzE4X19pZnN0cmVhbV93cmFwcGVySU5TMV83c3RyZWFtczEzbWVtb3J5X3N0cmVhbUVFRUVFTlMyXzVmaWVsZElOUzJfM2xhczNyZ2JFTlMyXzIwc3RhbmRhcmRfZGlmZl9tZXRob2RJU0VfRUVFRUVFTlNfMTRkZWZhdWx0X2RlbGV0ZUlTSV9FRU5TXzlhbGxvY2F0b3JJU0lfRUVFRQBOU3QzX18yMTRkZWZhdWx0X2RlbGV0ZUlONmxhc3ppcDdmb3JtYXRzMjZkeW5hbWljX2RlY29tcHJlc3Nvcl9maWVsZElOUzFfOGRlY29kZXJzMTBhcml0aG1ldGljSU5TMV8yaW8xOF9faWZzdHJlYW1fd3JhcHBlcklOUzFfN3N0cmVhbXMxM21lbW9yeV9zdHJlYW1FRUVFRU5TMl81ZmllbGRJTlMyXzNsYXMzcmdiRU5TMl8yMHN0YW5kYXJkX2RpZmZfbWV0aG9kSVNFX0VFRUVFRUVFAE42bGFzemlwN2Zvcm1hdHMyNmR5bmFtaWNfZGVjb21wcmVzc29yX2ZpZWxkSU5TXzhkZWNvZGVyczEwYXJpdGhtZXRpY0lOU18yaW8xOF9faWZzdHJlYW1fd3JhcHBlcklOU183c3RyZWFtczEzbWVtb3J5X3N0cmVhbUVFRUVFTlMwXzVmaWVsZElOUzBfM2xhczEwZXh0cmFieXRlc0VOUzBfMjBzdGFuZGFyZF9kaWZmX21ldGhvZElTQ19FRUVFRUUATlN0M19fMjIwX19zaGFyZWRfcHRyX3BvaW50ZXJJUE42bGFzemlwN2Zvcm1hdHMyNmR5bmFtaWNfZGVjb21wcmVzc29yX2ZpZWxkSU5TMV84ZGVjb2RlcnMxMGFyaXRobWV0aWNJTlMxXzJpbzE4X19pZnN0cmVhbV93cmFwcGVySU5TMV83c3RyZWFtczEzbWVtb3J5X3N0cmVhbUVFRUVFTlMyXzVmaWVsZElOUzJfM2xhczEwZXh0cmFieXRlc0VOUzJfMjBzdGFuZGFyZF9kaWZmX21ldGhvZElTRV9FRUVFRUVOU18xNGRlZmF1bHRfZGVsZXRlSVNJX0VFTlNfOWFsbG9jYXRvcklTSV9FRUVFAE5TdDNfXzIxNGRlZmF1bHRfZGVsZXRlSU42bGFzemlwN2Zvcm1hdHMyNmR5bmFtaWNfZGVjb21wcmVzc29yX2ZpZWxkSU5TMV84ZGVjb2RlcnMxMGFyaXRobWV0aWNJTlMxXzJpbzE4X19pZnN0cmVhbV93cmFwcGVySU5TMV83c3RyZWFtczEzbWVtb3J5X3N0cmVhbUVFRUVFTlMyXzVmaWVsZElOUzJfM2xhczEwZXh0cmFieXRlc0VOUzJfMjBzdGFuZGFyZF9kaWZmX21ldGhvZElTRV9FRUVFRUVFRQBONmxhc3ppcDdmb3JtYXRzMjFkeW5hbWljX2RlY29tcHJlc3NvcjFJTlNfOGRlY29kZXJzMTBhcml0aG1ldGljSU5TXzJpbzE4X19pZnN0cmVhbV93cmFwcGVySU5TXzdzdHJlYW1zMTNtZW1vcnlfc3RyZWFtRUVFRUVOUzBfMTlyZWNvcmRfZGVjb21wcmVzc29ySUpOUzBfNWZpZWxkSU5TMF8zbGFzN3BvaW50MTBFTlMwXzIwc3RhbmRhcmRfZGlmZl9tZXRob2RJU0RfRUVFRUVFRUVFAE5TdDNfXzIyMF9fc2hhcmVkX3B0cl9wb2ludGVySVBONmxhc3ppcDdmb3JtYXRzMjFkeW5hbWljX2RlY29tcHJlc3NvcjFJTlMxXzhkZWNvZGVyczEwYXJpdGhtZXRpY0lOUzFfMmlvMThfX2lmc3RyZWFtX3dyYXBwZXJJTlMxXzdzdHJlYW1zMTNtZW1vcnlfc3RyZWFtRUVFRUVOUzJfMTlyZWNvcmRfZGVjb21wcmVzc29ySUpOUzJfNWZpZWxkSU5TMl8zbGFzN3BvaW50MTBFTlMyXzIwc3RhbmRhcmRfZGlmZl9tZXRob2RJU0ZfRUVFRUVFRUVFTlNfMTRkZWZhdWx0X2RlbGV0ZUlTS19FRU5TXzlhbGxvY2F0b3JJU0tfRUVFRQBOU3QzX18yMTRkZWZhdWx0X2RlbGV0ZUlONmxhc3ppcDdmb3JtYXRzMjFkeW5hbWljX2RlY29tcHJlc3NvcjFJTlMxXzhkZWNvZGVyczEwYXJpdGhtZXRpY0lOUzFfMmlvMThfX2lmc3RyZWFtX3dyYXBwZXJJTlMxXzdzdHJlYW1zMTNtZW1vcnlfc3RyZWFtRUVFRUVOUzJfMTlyZWNvcmRfZGVjb21wcmVzc29ySUpOUzJfNWZpZWxkSU5TMl8zbGFzN3BvaW50MTBFTlMyXzIwc3RhbmRhcmRfZGlmZl9tZXRob2RJU0ZfRUVFRUVFRUVFRUUATjZsYXN6aXA3Zm9ybWF0czIxZHluYW1pY19kZWNvbXByZXNzb3IxSU5TXzhkZWNvZGVyczEwYXJpdGhtZXRpY0lOU18yaW8xOF9faWZzdHJlYW1fd3JhcHBlcklOU183c3RyZWFtczEzbWVtb3J5X3N0cmVhbUVFRUVFTlMwXzE5cmVjb3JkX2RlY29tcHJlc3NvcklKTlMwXzVmaWVsZElOUzBfM2xhczdwb2ludDEwRU5TMF8yMHN0YW5kYXJkX2RpZmZfbWV0aG9kSVNEX0VFRUVOU0JfSU5TQ183Z3BzdGltZUVOU0VfSVNIX0VFRUVFRUVFRQBOU3QzX18yMjBfX3NoYXJlZF9wdHJfcG9pbnRlcklQTjZsYXN6aXA3Zm9ybWF0czIxZHluYW1pY19kZWNvbXByZXNzb3IxSU5TMV84ZGVjb2RlcnMxMGFyaXRobWV0aWNJTlMxXzJpbzE4X19pZnN0cmVhbV93cmFwcGVySU5TMV83c3RyZWFtczEzbWVtb3J5X3N0cmVhbUVFRUVFTlMyXzE5cmVjb3JkX2RlY29tcHJlc3NvcklKTlMyXzVmaWVsZElOUzJfM2xhczdwb2ludDEwRU5TMl8yMHN0YW5kYXJkX2RpZmZfbWV0aG9kSVNGX0VFRUVOU0RfSU5TRV83Z3BzdGltZUVOU0dfSVNKX0VFRUVFRUVFRU5TXzE0ZGVmYXVsdF9kZWxldGVJU05fRUVOU185YWxsb2NhdG9ySVNOX0VFRUUATlN0M19fMjE0ZGVmYXVsdF9kZWxldGVJTjZsYXN6aXA3Zm9ybWF0czIxZHluYW1pY19kZWNvbXByZXNzb3IxSU5TMV84ZGVjb2RlcnMxMGFyaXRobWV0aWNJTlMxXzJpbzE4X19pZnN0cmVhbV93cmFwcGVySU5TMV83c3RyZWFtczEzbWVtb3J5X3N0cmVhbUVFRUVFTlMyXzE5cmVjb3JkX2RlY29tcHJlc3NvcklKTlMyXzVmaWVsZElOUzJfM2xhczdwb2ludDEwRU5TMl8yMHN0YW5kYXJkX2RpZmZfbWV0aG9kSVNGX0VFRUVOU0RfSU5TRV83Z3BzdGltZUVOU0dfSVNKX0VFRUVFRUVFRUVFAE42bGFzemlwN2Zvcm1hdHMyMWR5bmFtaWNfZGVjb21wcmVzc29yMUlOU184ZGVjb2RlcnMxMGFyaXRobWV0aWNJTlNfMmlvMThfX2lmc3RyZWFtX3dyYXBwZXJJTlNfN3N0cmVhbXMxM21lbW9yeV9zdHJlYW1FRUVFRU5TMF8xOXJlY29yZF9kZWNvbXByZXNzb3JJSk5TMF81ZmllbGRJTlMwXzNsYXM3cG9pbnQxMEVOUzBfMjBzdGFuZGFyZF9kaWZmX21ldGhvZElTRF9FRUVFTlNCX0lOU0NfM3JnYkVOU0VfSVNIX0VFRUVFRUVFRQBOU3QzX18yMjBfX3NoYXJlZF9wdHJfcG9pbnRlcklQTjZsYXN6aXA3Zm9ybWF0czIxZHluYW1pY19kZWNvbXByZXNzb3IxSU5TMV84ZGVjb2RlcnMxMGFyaXRobWV0aWNJTlMxXzJpbzE4X19pZnN0cmVhbV93cmFwcGVySU5TMV83c3RyZWFtczEzbWVtb3J5X3N0cmVhbUVFRUVFTlMyXzE5cmVjb3JkX2RlY29tcHJlc3NvcklKTlMyXzVmaWVsZElOUzJfM2xhczdwb2ludDEwRU5TMl8yMHN0YW5kYXJkX2RpZmZfbWV0aG9kSVNGX0VFRUVOU0RfSU5TRV8zcmdiRU5TR19JU0pfRUVFRUVFRUVFTlNfMTRkZWZhdWx0X2RlbGV0ZUlTTl9FRU5TXzlhbGxvY2F0b3JJU05fRUVFRQBOU3QzX18yMTRkZWZhdWx0X2RlbGV0ZUlONmxhc3ppcDdmb3JtYXRzMjFkeW5hbWljX2RlY29tcHJlc3NvcjFJTlMxXzhkZWNvZGVyczEwYXJpdGhtZXRpY0lOUzFfMmlvMThfX2lmc3RyZWFtX3dyYXBwZXJJTlMxXzdzdHJlYW1zMTNtZW1vcnlfc3RyZWFtRUVFRUVOUzJfMTlyZWNvcmRfZGVjb21wcmVzc29ySUpOUzJfNWZpZWxkSU5TMl8zbGFzN3BvaW50MTBFTlMyXzIwc3RhbmRhcmRfZGlmZl9tZXRob2RJU0ZfRUVFRU5TRF9JTlNFXzNyZ2JFTlNHX0lTSl9FRUVFRUVFRUVFRQBONmxhc3ppcDdmb3JtYXRzMjFkeW5hbWljX2RlY29tcHJlc3NvcjFJTlNfOGRlY29kZXJzMTBhcml0aG1ldGljSU5TXzJpbzE4X19pZnN0cmVhbV93cmFwcGVySU5TXzdzdHJlYW1zMTNtZW1vcnlfc3RyZWFtRUVFRUVOUzBfMTlyZWNvcmRfZGVjb21wcmVzc29ySUpOUzBfNWZpZWxkSU5TMF8zbGFzN3BvaW50MTBFTlMwXzIwc3RhbmRhcmRfZGlmZl9tZXRob2RJU0RfRUVFRU5TQl9JTlNDXzdncHN0aW1lRU5TRV9JU0hfRUVFRU5TQl9JTlNDXzNyZ2JFTlNFX0lTS19FRUVFRUVFRUUATlN0M19fMjIwX19zaGFyZWRfcHRyX3BvaW50ZXJJUE42bGFzemlwN2Zvcm1hdHMyMWR5bmFtaWNfZGVjb21wcmVzc29yMUlOUzFfOGRlY29kZXJzMTBhcml0aG1ldGljSU5TMV8yaW8xOF9faWZzdHJlYW1fd3JhcHBlcklOUzFfN3N0cmVhbXMxM21lbW9yeV9zdHJlYW1FRUVFRU5TMl8xOXJlY29yZF9kZWNvbXByZXNzb3JJSk5TMl81ZmllbGRJTlMyXzNsYXM3cG9pbnQxMEVOUzJfMjBzdGFuZGFyZF9kaWZmX21ldGhvZElTRl9FRUVFTlNEX0lOU0VfN2dwc3RpbWVFTlNHX0lTSl9FRUVFTlNEX0lOU0VfM3JnYkVOU0dfSVNNX0VFRUVFRUVFRU5TXzE0ZGVmYXVsdF9kZWxldGVJU1FfRUVOU185YWxsb2NhdG9ySVNRX0VFRUUATlN0M19fMjE0ZGVmYXVsdF9kZWxldGVJTjZsYXN6aXA3Zm9ybWF0czIxZHluYW1pY19kZWNvbXByZXNzb3IxSU5TMV84ZGVjb2RlcnMxMGFyaXRobWV0aWNJTlMxXzJpbzE4X19pZnN0cmVhbV93cmFwcGVySU5TMV83c3RyZWFtczEzbWVtb3J5X3N0cmVhbUVFRUVFTlMyXzE5cmVjb3JkX2RlY29tcHJlc3NvcklKTlMyXzVmaWVsZElOUzJfM2xhczdwb2ludDEwRU5TMl8yMHN0YW5kYXJkX2RpZmZfbWV0aG9kSVNGX0VFRUVOU0RfSU5TRV83Z3BzdGltZUVOU0dfSVNKX0VFRUVOU0RfSU5TRV8zcmdiRU5TR19JU01fRUVFRUVFRUVFRUUATlN0M19fMjIwX19zaGFyZWRfcHRyX3BvaW50ZXJJUDEwYnVmX3N0cmVhbU5TXzE0ZGVmYXVsdF9kZWxldGVJUzFfRUVOU185YWxsb2NhdG9ySVMxX0VFRUUATlN0M19fMjE0ZGVmYXVsdF9kZWxldGVJMTBidWZfc3RyZWFtRUUATlN0M19fMjIwX19zaGFyZWRfcHRyX3BvaW50ZXJJUE42bGFzemlwOGRlY29kZXJzMTBhcml0aG1ldGljSTEwYnVmX3N0cmVhbUVFTlNfMTRkZWZhdWx0X2RlbGV0ZUlTNV9FRU5TXzlhbGxvY2F0b3JJUzVfRUVFRQBOU3QzX18yMTRkZWZhdWx0X2RlbGV0ZUlONmxhc3ppcDhkZWNvZGVyczEwYXJpdGhtZXRpY0kxMGJ1Zl9zdHJlYW1FRUVFAE42bGFzemlwN2Zvcm1hdHMyNmR5bmFtaWNfZmllbGRfZGVjb21wcmVzc29ySU5TXzhkZWNvZGVyczEwYXJpdGhtZXRpY0kxMGJ1Zl9zdHJlYW1FRUVFAE5TdDNfXzIyMF9fc2hhcmVkX3B0cl9wb2ludGVySVBONmxhc3ppcDdmb3JtYXRzMjZkeW5hbWljX2ZpZWxkX2RlY29tcHJlc3NvcklOUzFfOGRlY29kZXJzMTBhcml0aG1ldGljSTEwYnVmX3N0cmVhbUVFRUVOU18xNGRlZmF1bHRfZGVsZXRlSVM4X0VFTlNfOWFsbG9jYXRvcklTOF9FRUVFAE5TdDNfXzIxNGRlZmF1bHRfZGVsZXRlSU42bGFzemlwN2Zvcm1hdHMyNmR5bmFtaWNfZmllbGRfZGVjb21wcmVzc29ySU5TMV84ZGVjb2RlcnMxMGFyaXRobWV0aWNJMTBidWZfc3RyZWFtRUVFRUVFAE42bGFzemlwN2Zvcm1hdHMyNmR5bmFtaWNfZGVjb21wcmVzc29yX2ZpZWxkSU5TXzhkZWNvZGVyczEwYXJpdGhtZXRpY0kxMGJ1Zl9zdHJlYW1FRU5TMF81ZmllbGRJaU5TMF8yMHN0YW5kYXJkX2RpZmZfbWV0aG9kSWlFRUVFRUUATlN0M19fMjIwX19zaGFyZWRfcHRyX3BvaW50ZXJJUE42bGFzemlwN2Zvcm1hdHMyNmR5bmFtaWNfZGVjb21wcmVzc29yX2ZpZWxkSU5TMV84ZGVjb2RlcnMxMGFyaXRobWV0aWNJMTBidWZfc3RyZWFtRUVOUzJfNWZpZWxkSWlOUzJfMjBzdGFuZGFyZF9kaWZmX21ldGhvZElpRUVFRUVFTlNfMTRkZWZhdWx0X2RlbGV0ZUlTQ19FRU5TXzlhbGxvY2F0b3JJU0NfRUVFRQBOU3QzX18yMTRkZWZhdWx0X2RlbGV0ZUlONmxhc3ppcDdmb3JtYXRzMjZkeW5hbWljX2RlY29tcHJlc3Nvcl9maWVsZElOUzFfOGRlY29kZXJzMTBhcml0aG1ldGljSTEwYnVmX3N0cmVhbUVFTlMyXzVmaWVsZElpTlMyXzIwc3RhbmRhcmRfZGlmZl9tZXRob2RJaUVFRUVFRUVFAE42bGFzemlwN2Zvcm1hdHMyNmR5bmFtaWNfZGVjb21wcmVzc29yX2ZpZWxkSU5TXzhkZWNvZGVyczEwYXJpdGhtZXRpY0kxMGJ1Zl9zdHJlYW1FRU5TMF81ZmllbGRJak5TMF8yMHN0YW5kYXJkX2RpZmZfbWV0aG9kSWpFRUVFRUUATlN0M19fMjIwX19zaGFyZWRfcHRyX3BvaW50ZXJJUE42bGFzemlwN2Zvcm1hdHMyNmR5bmFtaWNfZGVjb21wcmVzc29yX2ZpZWxkSU5TMV84ZGVjb2RlcnMxMGFyaXRobWV0aWNJMTBidWZfc3RyZWFtRUVOUzJfNWZpZWxkSWpOUzJfMjBzdGFuZGFyZF9kaWZmX21ldGhvZElqRUVFRUVFTlNfMTRkZWZhdWx0X2RlbGV0ZUlTQ19FRU5TXzlhbGxvY2F0b3JJU0NfRUVFRQBOU3QzX18yMTRkZWZhdWx0X2RlbGV0ZUlONmxhc3ppcDdmb3JtYXRzMjZkeW5hbWljX2RlY29tcHJlc3Nvcl9maWVsZElOUzFfOGRlY29kZXJzMTBhcml0aG1ldGljSTEwYnVmX3N0cmVhbUVFTlMyXzVmaWVsZElqTlMyXzIwc3RhbmRhcmRfZGlmZl9tZXRob2RJakVFRUVFRUVFAE42bGFzemlwN2Zvcm1hdHMyNmR5bmFtaWNfZGVjb21wcmVzc29yX2ZpZWxkSU5TXzhkZWNvZGVyczEwYXJpdGhtZXRpY0kxMGJ1Zl9zdHJlYW1FRU5TMF81ZmllbGRJYU5TMF8yMHN0YW5kYXJkX2RpZmZfbWV0aG9kSWFFRUVFRUUATlN0M19fMjIwX19zaGFyZWRfcHRyX3BvaW50ZXJJUE42bGFzemlwN2Zvcm1hdHMyNmR5bmFtaWNfZGVjb21wcmVzc29yX2ZpZWxkSU5TMV84ZGVjb2RlcnMxMGFyaXRobWV0aWNJMTBidWZfc3RyZWFtRUVOUzJfNWZpZWxkSWFOUzJfMjBzdGFuZGFyZF9kaWZmX21ldGhvZElhRUVFRUVFTlNfMTRkZWZhdWx0X2RlbGV0ZUlTQ19FRU5TXzlhbGxvY2F0b3JJU0NfRUVFRQBOU3QzX18yMTRkZWZhdWx0X2RlbGV0ZUlONmxhc3ppcDdmb3JtYXRzMjZkeW5hbWljX2RlY29tcHJlc3Nvcl9maWVsZElOUzFfOGRlY29kZXJzMTBhcml0aG1ldGljSTEwYnVmX3N0cmVhbUVFTlMyXzVmaWVsZElhTlMyXzIwc3RhbmRhcmRfZGlmZl9tZXRob2RJYUVFRUVFRUVFAE42bGFzemlwN2Zvcm1hdHMyNmR5bmFtaWNfZGVjb21wcmVzc29yX2ZpZWxkSU5TXzhkZWNvZGVyczEwYXJpdGhtZXRpY0kxMGJ1Zl9zdHJlYW1FRU5TMF81ZmllbGRJc05TMF8yMHN0YW5kYXJkX2RpZmZfbWV0aG9kSXNFRUVFRUUATlN0M19fMjIwX19zaGFyZWRfcHRyX3BvaW50ZXJJUE42bGFzemlwN2Zvcm1hdHMyNmR5bmFtaWNfZGVjb21wcmVzc29yX2ZpZWxkSU5TMV84ZGVjb2RlcnMxMGFyaXRobWV0aWNJMTBidWZfc3RyZWFtRUVOUzJfNWZpZWxkSXNOUzJfMjBzdGFuZGFyZF9kaWZmX21ldGhvZElzRUVFRUVFTlNfMTRkZWZhdWx0X2RlbGV0ZUlTQ19FRU5TXzlhbGxvY2F0b3JJU0NfRUVFRQBOU3QzX18yMTRkZWZhdWx0X2RlbGV0ZUlONmxhc3ppcDdmb3JtYXRzMjZkeW5hbWljX2RlY29tcHJlc3Nvcl9maWVsZElOUzFfOGRlY29kZXJzMTBhcml0aG1ldGljSTEwYnVmX3N0cmVhbUVFTlMyXzVmaWVsZElzTlMyXzIwc3RhbmRhcmRfZGlmZl9tZXRob2RJc0VFRUVFRUVFAE42bGFzemlwN2Zvcm1hdHMyNmR5bmFtaWNfZGVjb21wcmVzc29yX2ZpZWxkSU5TXzhkZWNvZGVyczEwYXJpdGhtZXRpY0kxMGJ1Zl9zdHJlYW1FRU5TMF81ZmllbGRJaE5TMF8yMHN0YW5kYXJkX2RpZmZfbWV0aG9kSWhFRUVFRUUATlN0M19fMjIwX19zaGFyZWRfcHRyX3BvaW50ZXJJUE42bGFzemlwN2Zvcm1hdHMyNmR5bmFtaWNfZGVjb21wcmVzc29yX2ZpZWxkSU5TMV84ZGVjb2RlcnMxMGFyaXRobWV0aWNJMTBidWZfc3RyZWFtRUVOUzJfNWZpZWxkSWhOUzJfMjBzdGFuZGFyZF9kaWZmX21ldGhvZEloRUVFRUVFTlNfMTRkZWZhdWx0X2RlbGV0ZUlTQ19FRU5TXzlhbGxvY2F0b3JJU0NfRUVFRQBOU3QzX18yMTRkZWZhdWx0X2RlbGV0ZUlONmxhc3ppcDdmb3JtYXRzMjZkeW5hbWljX2RlY29tcHJlc3Nvcl9maWVsZElOUzFfOGRlY29kZXJzMTBhcml0aG1ldGljSTEwYnVmX3N0cmVhbUVFTlMyXzVmaWVsZEloTlMyXzIwc3RhbmRhcmRfZGlmZl9tZXRob2RJaEVFRUVFRUVFAE42bGFzemlwN2Zvcm1hdHMyNmR5bmFtaWNfZGVjb21wcmVzc29yX2ZpZWxkSU5TXzhkZWNvZGVyczEwYXJpdGhtZXRpY0kxMGJ1Zl9zdHJlYW1FRU5TMF81ZmllbGRJdE5TMF8yMHN0YW5kYXJkX2RpZmZfbWV0aG9kSXRFRUVFRUUATlN0M19fMjIwX19zaGFyZWRfcHRyX3BvaW50ZXJJUE42bGFzemlwN2Zvcm1hdHMyNmR5bmFtaWNfZGVjb21wcmVzc29yX2ZpZWxkSU5TMV84ZGVjb2RlcnMxMGFyaXRobWV0aWNJMTBidWZfc3RyZWFtRUVOUzJfNWZpZWxkSXROUzJfMjBzdGFuZGFyZF9kaWZmX21ldGhvZEl0RUVFRUVFTlNfMTRkZWZhdWx0X2RlbGV0ZUlTQ19FRU5TXzlhbGxvY2F0b3JJU0NfRUVFRQBOU3QzX18yMTRkZWZhdWx0X2RlbGV0ZUlONmxhc3ppcDdmb3JtYXRzMjZkeW5hbWljX2RlY29tcHJlc3Nvcl9maWVsZElOUzFfOGRlY29kZXJzMTBhcml0aG1ldGljSTEwYnVmX3N0cmVhbUVFTlMyXzVmaWVsZEl0TlMyXzIwc3RhbmRhcmRfZGlmZl9tZXRob2RJdEVFRUVFRUVFADZMQVNaaXAAUDZMQVNaaXAAUEs2TEFTWmlwAGlpAHYAdmkAdmlpaWkAdmlpaQBpaWkAMTNEeW5hbWljTEFTWmlwAFAxM0R5bmFtaWNMQVNaaXAAUEsxM0R5bmFtaWNMQVNaaXAAdm9pZABib29sAGNoYXIAc2lnbmVkIGNoYXIAdW5zaWduZWQgY2hhcgBzaG9ydAB1bnNpZ25lZCBzaG9ydABpbnQAdW5zaWduZWQgaW50AGxvbmcAdW5zaWduZWQgbG9uZwBmbG9hdABkb3VibGUAc3RkOjpzdHJpbmcAc3RkOjpiYXNpY19zdHJpbmc8dW5zaWduZWQgY2hhcj4Ac3RkOjp3c3RyaW5nAHN0ZDo6dTE2c3RyaW5nAHN0ZDo6dTMyc3RyaW5nAGVtc2NyaXB0ZW46OnZhbABlbXNjcmlwdGVuOjptZW1vcnlfdmlldzxjaGFyPgBlbXNjcmlwdGVuOjptZW1vcnlfdmlldzxzaWduZWQgY2hhcj4AZW1zY3JpcHRlbjo6bWVtb3J5X3ZpZXc8dW5zaWduZWQgY2hhcj4AZW1zY3JpcHRlbjo6bWVtb3J5X3ZpZXc8c2hvcnQ+AGVtc2NyaXB0ZW46Om1lbW9yeV92aWV3PHVuc2lnbmVkIHNob3J0PgBlbXNjcmlwdGVuOjptZW1vcnlfdmlldzxpbnQ+AGVtc2NyaXB0ZW46Om1lbW9yeV92aWV3PHVuc2lnbmVkIGludD4AZW1zY3JpcHRlbjo6bWVtb3J5X3ZpZXc8bG9uZz4AZW1zY3JpcHRlbjo6bWVtb3J5X3ZpZXc8dW5zaWduZWQgbG9uZz4AZW1zY3JpcHRlbjo6bWVtb3J5X3ZpZXc8aW50OF90PgBlbXNjcmlwdGVuOjptZW1vcnlfdmlldzx1aW50OF90PgBlbXNjcmlwdGVuOjptZW1vcnlfdmlldzxpbnQxNl90PgBlbXNjcmlwdGVuOjptZW1vcnlfdmlldzx1aW50MTZfdD4AZW1zY3JpcHRlbjo6bWVtb3J5X3ZpZXc8aW50MzJfdD4AZW1zY3JpcHRlbjo6bWVtb3J5X3ZpZXc8dWludDMyX3Q+AGVtc2NyaXB0ZW46Om1lbW9yeV92aWV3PGZsb2F0PgBlbXNjcmlwdGVuOjptZW1vcnlfdmlldzxkb3VibGU+AGVtc2NyaXB0ZW46Om1lbW9yeV92aWV3PGxvbmcgZG91YmxlPgBOMTBlbXNjcmlwdGVuMTFtZW1vcnlfdmlld0llRUUATjEwZW1zY3JpcHRlbjExbWVtb3J5X3ZpZXdJZEVFAE4xMGVtc2NyaXB0ZW4xMW1lbW9yeV92aWV3SWZFRQBOMTBlbXNjcmlwdGVuMTFtZW1vcnlfdmlld0ltRUUATjEwZW1zY3JpcHRlbjExbWVtb3J5X3ZpZXdJbEVFAE4xMGVtc2NyaXB0ZW4xMW1lbW9yeV92aWV3SWpFRQBOMTBlbXNjcmlwdGVuMTFtZW1vcnlfdmlld0lpRUUATjEwZW1zY3JpcHRlbjExbWVtb3J5X3ZpZXdJdEVFAE4xMGVtc2NyaXB0ZW4xMW1lbW9yeV92aWV3SXNFRQBOMTBlbXNjcmlwdGVuMTFtZW1vcnlfdmlld0loRUUATjEwZW1zY3JpcHRlbjExbWVtb3J5X3ZpZXdJYUVFAE4xMGVtc2NyaXB0ZW4xMW1lbW9yeV92aWV3SWNFRQBOMTBlbXNjcmlwdGVuM3ZhbEUATlN0M19fMjEyYmFzaWNfc3RyaW5nSURpTlNfMTFjaGFyX3RyYWl0c0lEaUVFTlNfOWFsbG9jYXRvcklEaUVFRUUATlN0M19fMjIxX19iYXNpY19zdHJpbmdfY29tbW9uSUxiMUVFRQBOU3QzX18yMTJiYXNpY19zdHJpbmdJRHNOU18xMWNoYXJfdHJhaXRzSURzRUVOU185YWxsb2NhdG9ySURzRUVFRQBOU3QzX18yMTJiYXNpY19zdHJpbmdJd05TXzExY2hhcl90cmFpdHNJd0VFTlNfOWFsbG9jYXRvckl3RUVFRQBOU3QzX18yMTJiYXNpY19zdHJpbmdJaE5TXzExY2hhcl90cmFpdHNJaEVFTlNfOWFsbG9jYXRvckloRUVFRQBOU3QzX18yMTJiYXNpY19zdHJpbmdJY05TXzExY2hhcl90cmFpdHNJY0VFTlNfOWFsbG9jYXRvckljRUVFRQAtKyAgIDBYMHgAKG51bGwpAC0wWCswWCAwWC0weCsweCAweABpbmYASU5GAG5hbgBOQU4ALgB0ZXJtaW5hdGluZyB3aXRoICVzIGV4Y2VwdGlvbiBvZiB0eXBlICVzOiAlcwB0ZXJtaW5hdGluZyB3aXRoICVzIGV4Y2VwdGlvbiBvZiB0eXBlICVzAHRlcm1pbmF0aW5nIHdpdGggJXMgZm9yZWlnbiBleGNlcHRpb24AdGVybWluYXRpbmcAdW5jYXVnaHQAU3Q5ZXhjZXB0aW9uAE4xMF9fY3h4YWJpdjExNl9fc2hpbV90eXBlX2luZm9FAFN0OXR5cGVfaW5mbwBOMTBfX2N4eGFiaXYxMjBfX3NpX2NsYXNzX3R5cGVfaW5mb0UATjEwX19jeHhhYml2MTE3X19jbGFzc190eXBlX2luZm9FAHRlcm1pbmF0ZV9oYW5kbGVyIHVuZXhwZWN0ZWRseSByZXR1cm5lZABzdGQ6OmJhZF9hbGxvYwBTdDliYWRfYWxsb2MAU3QxMWxvZ2ljX2Vycm9yAFN0MTNydW50aW1lX2Vycm9yAFN0MTJsZW5ndGhfZXJyb3IAU3QxMm91dF9vZl9yYW5nZQBOMTBfX2N4eGFiaXYxMTdfX3BiYXNlX3R5cGVfaW5mb0UATjEwX19jeHhhYml2MTE5X19wb2ludGVyX3R5cGVfaW5mb0UATjEwX19jeHhhYml2MTIwX19mdW5jdGlvbl90eXBlX2luZm9FAE4xMF9fY3h4YWJpdjEyOV9fcG9pbnRlcl90b19tZW1iZXJfdHlwZV9pbmZvRQBQdXJlIHZpcnR1YWwgZnVuY3Rpb24gY2FsbGVkIQBOMTBfX2N4eGFiaXYxMjNfX2Z1bmRhbWVudGFsX3R5cGVfaW5mb0UAdgBEbgBiAGMAaABhAHMAdABpAGoAbABtAGYAZABOMTBfX2N4eGFiaXYxMjFfX3ZtaV9jbGFzc190eXBlX2luZm9FAF9fY3hhX2d1YXJkX2FjcXVpcmUgZGV0ZWN0ZWQgcmVjdXJzaXZlIGluaXRpYWxpemF0aW9uAHN0ZDo6YmFkX2Z1bmN0aW9uX2NhbGwATlN0M19fMjE3YmFkX2Z1bmN0aW9uX2NhbGxFAE5TdDNfXzIxNF9fc2hhcmVkX2NvdW50RQBOU3QzX18yMTlfX3NoYXJlZF93ZWFrX2NvdW50RQBtdXRleCBsb2NrIGZhaWxlZABiYXNpY19zdHJpbmcAdW5zcGVjaWZpZWQgZ2VuZXJpY19jYXRlZ29yeSBlcnJvcgBVbmtub3duIGVycm9yICVkAGdlbmVyaWMATlN0M19fMjI0X19nZW5lcmljX2Vycm9yX2NhdGVnb3J5RQBOU3QzX18yMTJfX2RvX21lc3NhZ2VFAE5TdDNfXzIxNGVycm9yX2NhdGVnb3J5RQB1bnNwZWNpZmllZCBzeXN0ZW1fY2F0ZWdvcnkgZXJyb3IAc3lzdGVtAE5TdDNfXzIyM19fc3lzdGVtX2Vycm9yX2NhdGVnb3J5RQBOU3QzX18yMTJzeXN0ZW1fZXJyb3JFADogAHZlY3Rvcg==";var ge=22368;function ve(ye){return Fo(ye)}var Fe={};function He(ye){if(ye){var me=Fe[ye];me.refcount++}}function st(ye){if(!ye||Fe[ye])return ye;for(var me in Fe)for(var Ve=+me,Z=Fe[Ve].adjusted,mt=Z.length,c=0;c<mt;c++)if(Z[c]===ye)return Ve;return ye}function xt(ye){var me=Fe[ye];return me&&!me.caught&&(me.caught=!0,_f.uncaught_exceptions--),me&&(me.rethrown=!1),He(st(ye)),ye}function Qe(ye,me,Ve){throw Fe[ye]={ptr:ye,adjusted:[ye],type:me,destructor:Ve,refcount:0,caught:!1,rethrown:!1},"uncaught_exception"in _f?_f.uncaught_exceptions++:_f.uncaught_exceptions=1,ye}function ht(){return _f.uncaught_exceptions}function zt(){}function Pt(ye){switch(ye){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+ye)}}function qt(){for(var ye=new Array(256),me=0;me<256;++me)ye[me]=String.fromCharCode(me);Ke=ye}var Ke=void 0;function Oi(ye){for(var me="",Ve=ye;Ye[Ve];)me+=Ke[Ye[Ve++]];return me}var Tn={},bi={},ki={},qi=48,Bn=57;function er(ye){if(ye===void 0)return"_unknown";ye=ye.replace(/[^a-zA-Z0-9_]/g,"$");var me=ye.charCodeAt(0);return me>=qi&&me<=Bn?"_"+ye:ye}function Kr(ye,me){return ye=er(ye),new Function("body","return function "+ye+`() {
    "use strict";    return body.apply(this, arguments);
};
`)(me)}function es(ye,me){var Ve=Kr(me,function(Z){this.name=me,this.message=Z;var mt=new Error(Z).stack;mt!==void 0&&(this.stack=this.toString()+`
`+mt.replace(/^Error(:[^\n]*)?\n/,""))});return Ve.prototype=Object.create(ye.prototype),Ve.prototype.constructor=Ve,Ve.prototype.toString=function(){return this.message===void 0?this.name:this.name+": "+this.message},Ve}var tr=void 0;function $i(ye){throw new tr(ye)}var Vt=void 0;function Ar(ye){throw new Vt(ye)}function Cs(ye,me,Ve){ye.forEach(function(Ft){ki[Ft]=me});function Z(Ft){var ci=Ve(Ft);ci.length!==ye.length&&Ar("Mismatched type converter count");for(var si=0;si<ye.length;++si)ts(ye[si],ci[si])}var mt=new Array(me.length),c=[],Re=0;me.forEach(function(Ft,ci){bi.hasOwnProperty(Ft)?mt[ci]=bi[Ft]:(c.push(Ft),Tn.hasOwnProperty(Ft)||(Tn[Ft]=[]),Tn[Ft].push(function(){mt[ci]=bi[Ft],++Re,Re===c.length&&Z(mt)}))}),c.length===0&&Z(mt)}function ts(ye,me,Ve){if(Ve=Ve||{},!("argPackAdvance"in me))throw new TypeError("registerType registeredInstance requires argPackAdvance");var Z=me.name;if(ye||$i('type "'+Z+'" must have a positive integer typeid pointer'),bi.hasOwnProperty(ye)){if(Ve.ignoreDuplicateRegistrations)return;$i("Cannot register type '"+Z+"' twice")}if(bi[ye]=me,delete ki[ye],Tn.hasOwnProperty(ye)){var mt=Tn[ye];delete Tn[ye],mt.forEach(function(c){c()})}}function vn(ye,me,Ve,Z,mt){var c=Pt(Ve);me=Oi(me),ts(ye,{name:me,fromWireType:function(Re){return!!Re},toWireType:function(Re,Ft){return Ft?Z:mt},argPackAdvance:8,readValueFromPointer:function(Re){var Ft;if(Ve===1)Ft=Wi;else if(Ve===2)Ft=Gt;else if(Ve===4)Ft=Si;else throw new TypeError("Unknown boolean type size: "+me);return this.fromWireType(Ft[Re>>c])},destructorFunction:null})}function ei(ye){if(!(this instanceof aa)||!(ye instanceof aa))return!1;for(var me=this.$$.ptrType.registeredClass,Ve=this.$$.ptr,Z=ye.$$.ptrType.registeredClass,mt=ye.$$.ptr;me.baseClass;)Ve=me.upcast(Ve),me=me.baseClass;for(;Z.baseClass;)mt=Z.upcast(mt),Z=Z.baseClass;return me===Z&&Ve===mt}function Xi(ye){return{count:ye.count,deleteScheduled:ye.deleteScheduled,preservePointerOnDelete:ye.preservePointerOnDelete,ptr:ye.ptr,ptrType:ye.ptrType,smartPtr:ye.smartPtr,smartPtrType:ye.smartPtrType}}function en(ye){function me(Ve){return Ve.$$.ptrType.registeredClass.name}$i(me(ye)+" instance already deleted")}var ba=!1;function df(ye){}function bl(ye){ye.smartPtr?ye.smartPtrType.rawDestructor(ye.smartPtr):ye.ptrType.registeredClass.rawDestructor(ye.ptr)}function Yi(ye){ye.count.value-=1;var me=ye.count.value===0;me&&bl(ye)}function Ko(ye){return typeof FinalizationGroup>"u"?(Ko=function(me){return me},ye):(ba=new FinalizationGroup(function(me){for(var Ve=me.next();!Ve.done;Ve=me.next()){var Z=Ve.value;Z.ptr?Yi(Z):console.warn("object already deleted: "+Z.ptr)}}),Ko=function(me){return ba.register(me,me.$$,me.$$),me},df=function(me){ba.unregister(me.$$)},Ko(ye))}function Al(){if(this.$$.ptr||en(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var ye=Ko(Object.create(Object.getPrototypeOf(this),{$$:{value:Xi(this.$$)}}));return ye.$$.count.value+=1,ye.$$.deleteScheduled=!1,ye}function rc(){this.$$.ptr||en(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&$i("Object already scheduled for deletion"),df(this),Yi(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)}function wl(){return!this.$$.ptr}var Ba=void 0,cr=[];function Bc(){for(;cr.length;){var ye=cr.pop();ye.$$.deleteScheduled=!1,ye.delete()}}function sa(){return this.$$.ptr||en(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&$i("Object already scheduled for deletion"),cr.push(this),cr.length===1&&Ba&&Ba(Bc),this.$$.deleteScheduled=!0,this}function En(){aa.prototype.isAliasOf=ei,aa.prototype.clone=Al,aa.prototype.delete=rc,aa.prototype.isDeleted=wl,aa.prototype.deleteLater=sa}function aa(){}var hu={};function fu(ye,me,Ve){if(ye[me].overloadTable===void 0){var Z=ye[me];ye[me]=function(){return ye[me].overloadTable.hasOwnProperty(arguments.length)||$i("Function '"+Ve+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+ye[me].overloadTable+")!"),ye[me].overloadTable[arguments.length].apply(this,arguments)},ye[me].overloadTable=[],ye[me].overloadTable[Z.argCount]=Z}}function zc(ye,me,Ve){i.hasOwnProperty(ye)?($i("Cannot register public name '"+ye+"' twice"),fu(i,ye,ye),i.hasOwnProperty(Ve)&&$i("Cannot register multiple overloads of a function with the same number of arguments ("+Ve+")!"),i[ye].overloadTable[Ve]=me):i[ye]=me}function el(ye,me,Ve,Z,mt,c,Re,Ft){this.name=ye,this.constructor=me,this.instancePrototype=Ve,this.rawDestructor=Z,this.baseClass=mt,this.getActualType=c,this.upcast=Re,this.downcast=Ft,this.pureVirtualFunctions=[]}function du(ye,me,Ve){for(;me!==Ve;)me.upcast||$i("Expected null or instance of "+Ve.name+", got an instance of "+me.name),ye=me.upcast(ye),me=me.baseClass;return ye}function Tl(ye,me){if(me===null)return this.isReference&&$i("null is not a valid "+this.name),0;me.$$||$i('Cannot pass "'+za(me)+'" as a '+this.name),me.$$.ptr||$i("Cannot pass deleted object as a pointer of type "+this.name);var Ve=me.$$.ptrType.registeredClass,Z=du(me.$$.ptr,Ve,this.registeredClass);return Z}function Io(ye,me){var Ve;if(me===null)return this.isReference&&$i("null is not a valid "+this.name),this.isSmartPointer?(Ve=this.rawConstructor(),ye!==null&&ye.push(this.rawDestructor,Ve),Ve):0;me.$$||$i('Cannot pass "'+za(me)+'" as a '+this.name),me.$$.ptr||$i("Cannot pass deleted object as a pointer of type "+this.name),!this.isConst&&me.$$.ptrType.isConst&&$i("Cannot convert argument of type "+(me.$$.smartPtrType?me.$$.smartPtrType.name:me.$$.ptrType.name)+" to parameter type "+this.name);var Z=me.$$.ptrType.registeredClass;if(Ve=du(me.$$.ptr,Z,this.registeredClass),this.isSmartPointer)switch(me.$$.smartPtr===void 0&&$i("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:me.$$.smartPtrType===this?Ve=me.$$.smartPtr:$i("Cannot convert argument of type "+(me.$$.smartPtrType?me.$$.smartPtrType.name:me.$$.ptrType.name)+" to parameter type "+this.name);break;case 1:Ve=me.$$.smartPtr;break;case 2:if(me.$$.smartPtrType===this)Ve=me.$$.smartPtr;else{var mt=me.clone();Ve=this.rawShare(Ve,Do(function(){mt.delete()})),ye!==null&&ye.push(this.rawDestructor,Ve)}break;default:$i("Unsupporting sharing policy")}return Ve}function kn(ye,me){if(me===null)return this.isReference&&$i("null is not a valid "+this.name),0;me.$$||$i('Cannot pass "'+za(me)+'" as a '+this.name),me.$$.ptr||$i("Cannot pass deleted object as a pointer of type "+this.name),me.$$.ptrType.isConst&&$i("Cannot convert argument of type "+me.$$.ptrType.name+" to parameter type "+this.name);var Ve=me.$$.ptrType.registeredClass,Z=du(me.$$.ptr,Ve,this.registeredClass);return Z}function fh(ye){return this.fromWireType(Li[ye>>2])}function kp(ye){return this.rawGetPointee&&(ye=this.rawGetPointee(ye)),ye}function pu(ye){this.rawDestructor&&this.rawDestructor(ye)}function u0(ye){ye!==null&&ye.delete()}function dh(ye,me,Ve){if(me===Ve)return ye;if(Ve.baseClass===void 0)return null;var Z=dh(ye,me,Ve.baseClass);return Z===null?null:Ve.downcast(Z)}function Dp(){return Object.keys(sc).length}function Aa(){var ye=[];for(var me in sc)sc.hasOwnProperty(me)&&ye.push(sc[me]);return ye}function pf(ye){Ba=ye,cr.length&&Ba&&Ba(Bc)}function id(){i.getInheritedInstanceCount=Dp,i.getLiveInheritedInstances=Aa,i.flushPendingDeletes=Bc,i.setDelayFunction=pf}var sc={};function Lc(ye,me){for(me===void 0&&$i("ptr should not be undefined");ye.baseClass;)me=ye.upcast(me),ye=ye.baseClass;return me}function Op(ye,me){return me=Lc(ye,me),sc[me]}function ac(ye,me){(!me.ptrType||!me.ptr)&&Ar("makeClassHandle requires ptr and ptrType");var Ve=!!me.smartPtrType,Z=!!me.smartPtr;return Ve!==Z&&Ar("Both smartPtrType and smartPtr must be specified"),me.count={value:1},Ko(Object.create(ye,{$$:{value:me}}))}function oc(ye){var me=this.getPointee(ye);if(!me)return this.destructor(ye),null;var Ve=Op(this.registeredClass,me);if(Ve!==void 0){if(Ve.$$.count.value===0)return Ve.$$.ptr=me,Ve.$$.smartPtr=ye,Ve.clone();var Z=Ve.clone();return this.destructor(ye),Z}function mt(){return this.isSmartPointer?ac(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:me,smartPtrType:this,smartPtr:ye}):ac(this.registeredClass.instancePrototype,{ptrType:this,ptr:ye})}var c=this.registeredClass.getActualType(me),Re=hu[c];if(!Re)return mt.call(this);var Ft;this.isConst?Ft=Re.constPointerType:Ft=Re.pointerType;var ci=dh(me,this.registeredClass,Ft.registeredClass);return ci===null?mt.call(this):this.isSmartPointer?ac(Ft.registeredClass.instancePrototype,{ptrType:Ft,ptr:ci,smartPtrType:this,smartPtr:ye}):ac(Ft.registeredClass.instancePrototype,{ptrType:Ft,ptr:ci})}function Fp(){wa.prototype.getPointee=kp,wa.prototype.destructor=pu,wa.prototype.argPackAdvance=8,wa.prototype.readValueFromPointer=fh,wa.prototype.deleteObject=u0,wa.prototype.fromWireType=oc}function wa(ye,me,Ve,Z,mt,c,Re,Ft,ci,si,dt){this.name=ye,this.registeredClass=me,this.isReference=Ve,this.isConst=Z,this.isSmartPointer=mt,this.pointeeType=c,this.sharingPolicy=Re,this.rawGetPointee=Ft,this.rawConstructor=ci,this.rawShare=si,this.rawDestructor=dt,!mt&&me.baseClass===void 0?Z?(this.toWireType=Tl,this.destructorFunction=null):(this.toWireType=kn,this.destructorFunction=null):this.toWireType=Io}function nd(ye,me,Ve){i.hasOwnProperty(ye)||Ar("Replacing nonexistant public symbol"),i[ye].overloadTable!==void 0&&Ve!==void 0||(i[ye]=me,i[ye].argCount=Ve)}function ko(ye,me){ye=Oi(ye);function Ve(c){for(var Re=[],Ft=1;Ft<ye.length;++Ft)Re.push("a"+Ft);var ci="dynCall_"+ye+"_"+me,si="return function "+ci+"("+Re.join(", ")+`) {
`;return si+="    return dynCall(rawFunction"+(Re.length?", ":"")+Re.join(", ")+`);
`,si+=`};
`,new Function("dynCall","rawFunction",si)(c,me)}var Z=i["dynCall_"+ye],mt=Ve(Z);return typeof mt!="function"&&$i("unknown function pointer with signature "+ye+": "+me),mt}var lc=void 0;function ph(ye){var me=h0(ye),Ve=Oi(me);return is(me),Ve}function Qi(ye,me){var Ve=[],Z={};function mt(c){if(!Z[c]&&!bi[c]){if(ki[c]){ki[c].forEach(mt);return}Ve.push(c),Z[c]=!0}}throw me.forEach(mt),new lc(ye+": "+Ve.map(ph).join([", "]))}function tl(ye,me,Ve,Z,mt,c,Re,Ft,ci,si,dt,mn,or){dt=Oi(dt),c=ko(mt,c),Ft&&(Ft=ko(Re,Ft)),si&&(si=ko(ci,si)),or=ko(mn,or);var ur=er(dt);zc(ur,function(){Qi("Cannot construct "+dt+" due to unbound types",[Z])}),Cs([ye,me,Ve],Z?[Z]:[],function(Us){Us=Us[0];var Or,La;Z?(Or=Us.registeredClass,La=Or.instancePrototype):La=aa.prototype;var jc=Kr(ur,function(){if(Object.getPrototypeOf(this)!==yf)throw new tr("Use 'new' to construct "+dt);if(pn.constructor_body===void 0)throw new tr(dt+" has no accessible constructor");var Dn=pn.constructor_body[arguments.length];if(Dn===void 0)throw new tr("Tried to invoke ctor of "+dt+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(pn.constructor_body).toString()+") parameters instead!");return Dn.apply(this,arguments)}),yf=Object.create(La,{constructor:{value:jc}});jc.prototype=yf;var pn=new el(dt,jc,yf,or,Or,c,Ft,si),No=new wa(dt,pn,!0,!1,!1),ds=new wa(dt+"*",pn,!1,!1,!1),Ln=new wa(dt+" const*",pn,!1,!0,!1);return hu[ye]={pointerType:ds,constPointerType:Ln},nd(ur,jc),[No,ds,Ln]})}function rd(ye,me){for(var Ve=[],Z=0;Z<ye;Z++)Ve.push(Si[(me>>2)+Z]);return Ve}function gh(ye){for(;ye.length;){var me=ye.pop(),Ve=ye.pop();Ve(me)}}function Ps(ye,me,Ve,Z,mt,c){Rt(me>0);var Re=rd(me,Ve);mt=ko(Z,mt);var Ft=[c],ci=[];Cs([],[ye],function(si){si=si[0];var dt="constructor "+si.name;if(si.registeredClass.constructor_body===void 0&&(si.registeredClass.constructor_body=[]),si.registeredClass.constructor_body[me-1]!==void 0)throw new tr("Cannot register multiple constructors with identical number of parameters ("+(me-1)+") for class '"+si.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return si.registeredClass.constructor_body[me-1]=function(){Qi("Cannot construct "+si.name+" due to unbound types",Re)},Cs([],Re,function(mn){return si.registeredClass.constructor_body[me-1]=function(){arguments.length!==me-1&&$i(dt+" called with "+arguments.length+" arguments, expected "+(me-1)),ci.length=0,Ft.length=me;for(var ur=1;ur<me;++ur)Ft[ur]=mn[ur].toWireType(ci,arguments[ur-1]);var Us=mt.apply(null,Ft);return gh(ci),mn[0].fromWireType(Us)},[]}),[]})}function hs(ye,me){if(!(ye instanceof Function))throw new TypeError("new_ called with constructor type "+typeof ye+" which is not a function");var Ve=Kr(ye.name||"unknownFunctionName",function(){});Ve.prototype=ye.prototype;var Z=new Ve,mt=ye.apply(Z,me);return mt instanceof Object?mt:Z}function wr(ye,me,Ve,Z,mt){var c=me.length;c<2&&$i("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var Re=me[1]!==null&&Ve!==null,Ft=!1,ci=1;ci<me.length;++ci)if(me[ci]!==null&&me[ci].destructorFunction===void 0){Ft=!0;break}for(var si=me[0].name!=="void",dt="",mn="",ci=0;ci<c-2;++ci)dt+=(ci!==0?", ":"")+"arg"+ci,mn+=(ci!==0?", ":"")+"arg"+ci+"Wired";var or="return function "+er(ye)+"("+dt+`) {
if (arguments.length !== `+(c-2)+`) {
throwBindingError('function `+ye+" called with ' + arguments.length + ' arguments, expected "+(c-2)+` args!');
}
`;Ft&&(or+=`var destructors = [];
`);var ur=Ft?"destructors":"null",Us=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],Or=[$i,Z,mt,gh,me[0],me[1]];Re&&(or+="var thisWired = classParam.toWireType("+ur+`, this);
`);for(var ci=0;ci<c-2;++ci)or+="var arg"+ci+"Wired = argType"+ci+".toWireType("+ur+", arg"+ci+"); // "+me[ci+2].name+`
`,Us.push("argType"+ci),Or.push(me[ci+2]);if(Re&&(mn="thisWired"+(mn.length>0?", ":"")+mn),or+=(si?"var rv = ":"")+"invoker(fn"+(mn.length>0?", ":"")+mn+`);
`,Ft)or+=`runDestructors(destructors);
`;else for(var ci=Re?1:2;ci<me.length;++ci){var La=ci===1?"thisWired":"arg"+(ci-2)+"Wired";me[ci].destructorFunction!==null&&(or+=La+"_dtor("+La+"); // "+me[ci].name+`
`,Us.push(La+"_dtor"),Or.push(me[ci].destructorFunction))}si&&(or+=`var ret = retType.fromWireType(rv);
return ret;
`),or+=`}
`,Us.push(or);var jc=hs(Function,Us).apply(null,Or);return jc}function Gi(ye,me,Ve,Z,mt,c,Re,Ft){var ci=rd(Ve,Z);me=Oi(me),c=ko(mt,c),Cs([],[ye],function(si){si=si[0];var dt=si.name+"."+me;Ft&&si.registeredClass.pureVirtualFunctions.push(me);function mn(){Qi("Cannot call "+dt+" due to unbound types",ci)}var or=si.registeredClass.instancePrototype,ur=or[me];return ur===void 0||ur.overloadTable===void 0&&ur.className!==si.name&&ur.argCount===Ve-2?(mn.argCount=Ve-2,mn.className=si.name,or[me]=mn):(fu(or,me,dt),or[me].overloadTable[Ve-2]=mn),Cs([],ci,function(Us){var Or=wr(dt,Us,si,c,Re);return or[me].overloadTable===void 0?(Or.argCount=Ve-2,or[me]=Or):or[me].overloadTable[Ve-2]=Or,[]}),[]})}var Wn=[],fs=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function kr(ye){ye>4&&--fs[ye].refcount===0&&(fs[ye]=void 0,Wn.push(ye))}function Ta(){for(var ye=0,me=5;me<fs.length;++me)fs[me]!==void 0&&++ye;return ye}function Is(){for(var ye=5;ye<fs.length;++ye)if(fs[ye]!==void 0)return fs[ye];return null}function oo(){i.count_emval_handles=Ta,i.get_first_emval=Is}function Do(ye){switch(ye){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:{var me=Wn.length?Wn.pop():fs.length;return fs[me]={refcount:1,value:ye},me}}}function Tr(ye,me){me=Oi(me),ts(ye,{name:me,fromWireType:function(Ve){var Z=fs[Ve].value;return kr(Ve),Z},toWireType:function(Ve,Z){return Do(Z)},argPackAdvance:8,readValueFromPointer:fh,destructorFunction:null})}function za(ye){if(ye===null)return"null";var me=typeof ye;return me==="object"||me==="array"||me==="function"?ye.toString():""+ye}function lo(ye,me){switch(me){case 2:return function(Ve){return this.fromWireType(Vi[Ve>>2])};case 3:return function(Ve){return this.fromWireType(yn[Ve>>3])};default:throw new TypeError("Unknown float type: "+ye)}}function gu(ye,me,Ve){var Z=Pt(Ve);me=Oi(me),ts(ye,{name:me,fromWireType:function(mt){return mt},toWireType:function(mt,c){if(typeof c!="number"&&typeof c!="boolean")throw new TypeError('Cannot convert "'+za(c)+'" to '+this.name);return c},argPackAdvance:8,readValueFromPointer:lo(me,Z),destructorFunction:null})}function Sa(ye,me,Ve){switch(me){case 0:return Ve?function(mt){return Wi[mt]}:function(mt){return Ye[mt]};case 1:return Ve?function(mt){return Gt[mt>>1]}:function(mt){return vi[mt>>1]};case 2:return Ve?function(mt){return Si[mt>>2]}:function(mt){return Li[mt>>2]};default:throw new TypeError("Unknown integer type: "+ye)}}function bs(ye,me,Ve,Z,mt){me=Oi(me),mt===-1&&(mt=4294967295);var c=Pt(Ve),Re=function(si){return si};if(Z===0){var Ft=32-8*Ve;Re=function(si){return si<<Ft>>>Ft}}var ci=me.indexOf("unsigned")!=-1;ts(ye,{name:me,fromWireType:Re,toWireType:function(si,dt){if(typeof dt!="number"&&typeof dt!="boolean")throw new TypeError('Cannot convert "'+za(dt)+'" to '+this.name);if(dt<Z||dt>mt)throw new TypeError('Passing a number "'+za(dt)+'" from JS side to C/C++ side to an argument of type "'+me+'", which is outside the valid range ['+Z+", "+mt+"]!");return ci?dt>>>0:dt|0},argPackAdvance:8,readValueFromPointer:Sa(me,c,Z!==0),destructorFunction:null})}function Ea(ye,me,Ve){var Z=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],mt=Z[me];function c(Re){Re=Re>>2;var Ft=Li,ci=Ft[Re],si=Ft[Re+1];return new mt(li,si,ci)}Ve=Oi(Ve),ts(ye,{name:Ve,fromWireType:c,argPackAdvance:8,readValueFromPointer:c},{ignoreDuplicateRegistrations:!0})}function gf(ye,me){me=Oi(me);var Ve=me==="std::string";ts(ye,{name:me,fromWireType:function(Z){var mt=Li[Z>>2],c;if(Ve)for(var Re=Z+4,Ft=0;Ft<=mt;++Ft){var ci=Z+4+Ft;if(Ye[ci]==0||Ft==mt){var si=ci-Re,dt=Ht(Re,si);c===void 0?c=dt:(c+="\0",c+=dt),Re=ci+1}}else{for(var mn=new Array(mt),Ft=0;Ft<mt;++Ft)mn[Ft]=String.fromCharCode(Ye[Z+4+Ft]);c=mn.join("")}return is(Z),c},toWireType:function(Z,mt){mt instanceof ArrayBuffer&&(mt=new Uint8Array(mt));var c,Re=typeof mt=="string";Re||mt instanceof Uint8Array||mt instanceof Uint8ClampedArray||mt instanceof Int8Array||$i("Cannot pass non-string to std::string"),Ve&&Re?c=function(){return di(mt)}:c=function(){return mt.length};var Ft=c(),ci=Fo(4+Ft+1);if(Li[ci>>2]=Ft,Ve&&Re)hi(mt,ci+4,Ft+1);else if(Re)for(var si=0;si<Ft;++si){var dt=mt.charCodeAt(si);dt>255&&(is(ci),$i("String has UTF-16 code units that do not fit in 8 bits")),Ye[ci+4+si]=dt}else for(var si=0;si<Ft;++si)Ye[ci+4+si]=mt[si];return Z!==null&&Z.push(is,ci),ci},argPackAdvance:8,readValueFromPointer:fh,destructorFunction:function(Z){is(Z)}})}function mu(ye,me,Ve){Ve=Oi(Ve);var Z,mt,c,Re,Ft;me===2?(Z=Ii,mt=fi,Re=Ui,c=function(){return vi},Ft=1):me===4&&(Z=nt,mt=Ut,Re=mi,c=function(){return Li},Ft=2),ts(ye,{name:Ve,fromWireType:function(ci){for(var si=Li[ci>>2],dt=c(),mn,or=ci+4,ur=0;ur<=si;++ur){var Us=ci+4+ur*me;if(dt[Us>>Ft]==0||ur==si){var Or=Us-or,La=Z(or,Or);mn===void 0?mn=La:(mn+="\0",mn+=La),or=Us+me}}return is(ci),mn},toWireType:function(ci,si){typeof si!="string"&&$i("Cannot pass non-string to C++ string type "+Ve);var dt=Re(si),mn=Fo(4+dt+me);return Li[mn>>2]=dt>>Ft,mt(si,mn+4,dt+me),ci!==null&&ci.push(is,mn),mn},argPackAdvance:8,readValueFromPointer:fh,destructorFunction:function(ci){is(ci)}})}function _u(ye,me){me=Oi(me),ts(ye,{isVoid:!0,name:me,argPackAdvance:0,fromWireType:function(){},toWireType:function(Ve,Z){}})}function $n(){Qo()}function Uc(){return Ye.length}function fn(ye){Qo("OOM")}function Ki(ye){fn()}function yu(){Qo("trap!")}function Mn(ye,me,Ve){Ye.copyWithin(ye,me,me+Ve)}qt(),tr=i.BindingError=es(Error,"BindingError"),Vt=i.InternalError=es(Error,"InternalError"),En(),Fp(),id(),lc=i.UnboundTypeError=es(Error,"UnboundTypeError"),oo();function mh(ye){for(var me=[],Ve=0;Ve<ye.length;Ve++){var Z=ye[Ve];Z>255&&(Z&=255),me.push(String.fromCharCode(Z))}return me.join("")}var Oo=typeof atob=="function"?atob:function(ye){var me="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Ve="",Z,mt,c,Re,Ft,ci,si,dt=0;ye=ye.replace(/[^A-Za-z0-9\+\/\=]/g,"");do Re=me.indexOf(ye.charAt(dt++)),Ft=me.indexOf(ye.charAt(dt++)),ci=me.indexOf(ye.charAt(dt++)),si=me.indexOf(ye.charAt(dt++)),Z=Re<<2|Ft>>4,mt=(Ft&15)<<4|ci>>2,c=(ci&3)<<6|si,Ve=Ve+String.fromCharCode(Z),ci!==64&&(Ve=Ve+String.fromCharCode(mt)),si!==64&&(Ve=Ve+String.fromCharCode(c));while(dt<ye.length);return Ve};function Vc(ye){if(typeof p=="boolean"&&p){var me;try{me=Buffer.from(ye,"base64")}catch{me=new Buffer(ye,"base64")}return new Uint8Array(me.buffer,me.byteOffset,me.byteLength)}try{for(var Ve=Oo(ye),Z=new Uint8Array(Ve.length),mt=0;mt<Ve.length;++mt)Z[mt]=Ve.charCodeAt(mt);return Z}catch{throw new Error("Converting base64 string to bytes failed.")}}function Ma(ye){if(fe(ye))return Vc(ye.slice(it.length))}var Np={Math,Int8Array,Int16Array,Int32Array,Uint8Array,Uint16Array,Float32Array,Float64Array},mf={A:Mn,B:Ki,C:yu,D:ge,a:Qo,b:Le,c:$e,d:ve,e:xt,f:Qe,g:ht,h:He,i:st,j:zt,k:vn,l:tl,m:Ps,n:Gi,o:Tr,p:gu,q:bs,r:Ea,s:gf,t:mu,u:_u,v:kr,w:Do,x:$n,y:za,z:Uc},xn=(function(ye,me,Ve){var Z=new ye.Int8Array(Ve),mt=new ye.Int16Array(Ve),c=new ye.Int32Array(Ve),Re=new ye.Uint8Array(Ve),Ft=new ye.Uint16Array(Ve),ci=new ye.Float32Array(Ve),si=new ye.Float64Array(Ve),dt=me.D|0,mn=0,or=0,ur=0,Us=0,Or=0,La=0,jc=0,yf=0,pn=ye.Math.imul,No=ye.Math.clz32,ds=me.a,Ln=me.b,Dn=me.c,Zn=me.d,Gc=me.e,ir=me.f,vf=me.g,Au=me.h,zp=me.i,sd=me.j,Lp=me.k,Up=me.l,p0=me.m,Sl=me.n,Vp=me.o,ad=me.p,ns=me.q,ks=me.r,co=me.s,wu=me.t,od=me.u,g0=me.v,ld=me.w,cd=me.x,il=me.y,xf=me.z,bf=me.A,ud=me.B,m0=me.C,ee=22384,yh=5265264,jp=0;function On(){Qa(),Ys()}function El(){Af(0)}function Af(n){n=n|0;var u=0,v=0,w=0,R=0,N=0,U=0,W=0,Q=0,ne=0,be=0,Se=0;n=ee,ee=ee+16|0,u=n+8|0,v=n,Se=Jm()|0,N=py()|0,R=d()|0,U=m()|0,W=A()|0,Q=P()|0,ne=wt()|0,be=Lt()|0,w=Lt()|0,Up(R|0,U|0,W|0,Q|0,ne|0,9,be|0,Se|0,w|0,N|0,6204,$t()|0,138),Nt(1),c[v>>2]=5,c[v+4>>2]=0,c[u>>2]=c[v>>2],c[u+4>>2]=c[v+4>>2],Zt(6211,u),c[v>>2]=3,c[v+4>>2]=0,c[u>>2]=c[v>>2],c[u+4>>2]=c[v+4>>2],B1(6216,u),c[v>>2]=10,c[v+4>>2]=0,c[u>>2]=c[v>>2],c[u+4>>2]=c[v+4>>2],m2(6225,u),N=a()|0,w=h()|0,Se=b()|0,be=S()|0,ne=E()|0,Q=P()|0,W=wt()|0,U=Lt()|0,R=Lt()|0,Up(Se|0,be|0,ne|0,Q|0,W|0,11,U|0,N|0,R|0,w|0,6234,$t()|0,139),te(2),c[v>>2]=6,c[v+4>>2]=0,c[u>>2]=c[v>>2],c[u+4>>2]=c[v+4>>2],Ee(6211,u),c[v>>2]=4,c[v+4>>2]=0,c[u>>2]=c[v>>2],c[u+4>>2]=c[v+4>>2],ai(6248,u),c[v>>2]=5,c[v+4>>2]=0,c[u>>2]=c[v>>2],c[u+4>>2]=c[v+4>>2],ai(6265,u),c[v>>2]=6,c[v+4>>2]=0,c[u>>2]=c[v>>2],c[u+4>>2]=c[v+4>>2],ai(6280,u),c[v>>2]=7,c[v+4>>2]=0,c[u>>2]=c[v>>2],c[u+4>>2]=c[v+4>>2],Ti(6216,u),ee=n}function wf(n,u,v){n=n|0,u=u|0,v=v|0;var w=0,R=0,N=0,U=0,W=0;w=ee,ee=ee+32|0,U=w+16|0,R=w+8|0,W=w,N=Pi(20)|0,ho(N,u,v),c[W>>2]=0,c[U>>2]=c[W>>2],Ra(R,N,U),u=c[R>>2]|0,c[R>>2]=c[n>>2],c[n>>2]=u,u=R+4|0,v=n+4|0,N=c[u>>2]|0,c[u>>2]=c[v>>2],c[v>>2]=N,nl(R),v=Pi(352)|0,Ml(v,c[n>>2]|0),N=n+8|0,c[W>>2]=0,c[U>>2]=c[W>>2],dd(R,v,U),v=c[R>>2]|0,c[R>>2]=c[N>>2],c[N>>2]=v,N=R+4|0,v=n+12|0,u=c[N>>2]|0,c[N>>2]=c[v>>2],c[v>>2]=u,Ca(R),ee=w}function hd(n,u){n=n|0,u=u|0,ea(c[n+8>>2]|0,u)}function Tu(n){return n=n|0,n=(Wh(c[n+8>>2]|0)|0)+107|0,Re[n>>0]|Re[n+1>>0]<<8|Re[n+2>>0]<<16|Re[n+3>>0]<<24|0}function Tf(n,u,v){n=n|0,u=u|0,v=v|0;var w=0,R=0,N=0,U=0,W=0;w=ee,ee=ee+32|0,N=w+16|0,R=w+8|0,U=w,W=Pi(12)|0,Em(W,u,v),c[U>>2]=0,c[N>>2]=c[U>>2],Mm(R,W,N),W=c[R>>2]|0,c[R>>2]=c[n>>2],c[n>>2]=W,W=R+4|0,v=n+4|0,u=c[W>>2]|0,c[W>>2]=c[v>>2],c[v>>2]=u,K0(R),v=n+8|0,u=Pi(12)|0,fg(u,c[n>>2]|0),c[U>>2]=0,c[N>>2]=c[U>>2],Rm(R,u,N),u=c[R>>2]|0,c[R>>2]=c[v>>2],c[v>>2]=u,u=R+4|0,U=n+12|0,W=c[u>>2]|0,c[u>>2]=c[U>>2],c[U>>2]=W,Cm(R),H_(R,c[v>>2]|0),v=n+16|0,U=c[R>>2]|0,W=R+4|0,u=c[W>>2]|0,c[R>>2]=0,c[W>>2]=0,c[N>>2]=c[v>>2],c[v>>2]=U,v=n+20|0,c[N+4>>2]=c[v>>2],c[v>>2]=u,Zu(N),Zu(R),ee=w}function vh(n,u){n=n|0,u=u|0;var v=0;n=n+16|0,v=c[n>>2]|0;e:do if(v|0)switch(u|0){case 4:{Gd(v);break e}case 8:{Es(v),Es(c[n>>2]|0);break e}default:break e}while(!1)}function uo(n,u){n=n|0,u=u|0;var v=0;v=n+16|0,n=c[v>>2]|0;e:do if(n|0){switch(u|0){case 1:{Bm(n);break e}case 2:{zm(n);break e}case 8:{Gd(n),n=c[v>>2]|0;break}case 4:break;default:break e}Gd(n)}while(!1)}function _0(n,u){n=n|0,u=u|0;var v=0;v=n+16|0,n=c[v>>2]|0;e:do if(n|0){switch(u|0){case 1:{Tg(n);break e}case 2:{Sg(n);break e}case 8:{Es(n),n=c[v>>2]|0;break}case 4:break;default:break e}Es(n)}while(!1)}function fd(n,u){n=n|0,u=u|0,n=c[n+16>>2]|0,n|0&&R2[c[c[n>>2]>>2]&63](n,u)|0}function ho(n,u,v){n=n|0,u=u|0,v=v|0,c[n>>2]=u,c[n+4>>2]=v,c[n+8>>2]=0,Z[n+12>>0]=0,Z[n+13>>0]=0,c[n+16>>2]=0}function Ml(n,u){n=n|0,u=u|0,c[n>>2]=u,As(n+4|0,u),Vs(n+247|0),c[n+288>>2]=0,c[n+292>>2]=0,c[n+296>>2]=0,sl(n+300|0),u=n+312|0,c[u>>2]=0,c[u+4>>2]=0,c[u+8>>2]=0,c[u+12>>2]=0,Cl(n+328|0),Ua(n)}function Ra(n,u,v){n=n|0,u=u|0,v=v|0;var w=0,R=0;v=ee,ee=ee+16|0,w=v,c[n>>2]=u,R=Pi(16)|0,c[R+4>>2]=0,c[R+8>>2]=0,c[R>>2]=4296,c[R+12>>2]=u,c[n+4>>2]=R,c[w>>2]=u,c[w+4>>2]=u,Su(n,w),ee=v}function nl(n){n=n|0;var u=0,v=0;n=c[n+4>>2]|0,n|0&&(v=n+4|0,u=c[v>>2]|0,c[v>>2]=u+-1,(u|0)==0)&&(Jr[c[(c[n>>2]|0)+8>>2]&255](n),wp(n))}function Su(n,u){n=n|0,u=u|0}function xh(n){n=n|0,Gc(n|0)|0,mP()}function Sf(n){n=n|0,ma(n),Ai(n)}function Wc(n){n=n|0,n=c[n+12>>2]|0,n|0&&Ai(n)}function Bo(n,u){return n=n|0,u=u|0,((c[u+4>>2]|0)==6407?n+12|0:0)|0}function y0(n){n=n|0,an(n,16)}function an(n,u){n=n|0,u=u|0,tn(n)}function tn(n){n=n|0,Ai(n)}function dd(n,u,v){n=n|0,u=u|0,v=v|0;var w=0,R=0;v=ee,ee=ee+16|0,w=v,c[n>>2]=u,R=Pi(16)|0,c[R+4>>2]=0,c[R+8>>2]=0,c[R>>2]=4324,c[R+12>>2]=u,c[n+4>>2]=R,c[w>>2]=u,c[w+4>>2]=u,pd(n,w),ee=v}function Ca(n){n=n|0;var u=0,v=0;n=c[n+4>>2]|0,n|0&&(v=n+4|0,u=c[v>>2]|0,c[v>>2]=u+-1,(u|0)==0)&&(Jr[c[(c[n>>2]|0)+8>>2]&255](n),wp(n))}function pd(n,u){n=n|0,u=u|0}function fo(n){n=n|0,ma(n),Ai(n)}function Gp(n){n=n|0,n=c[n+12>>2]|0,n|0&&(v0(n),Ai(n))}function gd(n,u){return n=n|0,u=u|0,((c[u+4>>2]|0)==6605?n+12|0:0)|0}function Zc(n){n=n|0,an(n,16)}function v0(n){n=n|0,Eu(n+320|0),Rl(n+312|0),Mu(n+300|0),Ru(n+288|0),Pa(n+247|0),cc(n+4|0)}function Eu(n){n=n|0;var u=0,v=0;n=c[n+4>>2]|0,n|0&&(v=n+4|0,u=c[v>>2]|0,c[v>>2]=u+-1,(u|0)==0)&&(Jr[c[(c[n>>2]|0)+8>>2]&255](n),wp(n))}function Rl(n){n=n|0;var u=0,v=0;n=c[n+4>>2]|0,n|0&&(v=n+4|0,u=c[v>>2]|0,c[v>>2]=u+-1,(u|0)==0)&&(Jr[c[(c[n>>2]|0)+8>>2]&255](n),wp(n))}function Mu(n){n=n|0,Xc(n)}function Pa(n){n=n|0,n=n+34|0,n=Re[n>>0]|Re[n+1>>0]<<8|Re[n+2>>0]<<16|Re[n+3>>0]<<24,n|0&&D3(n)}function cc(n){n=n|0,rl(c[n+12>>2]|0)}function Xc(n){n=n|0;var u=0,v=0;u=c[n>>2]|0,v=u,u|0&&(c[n+4>>2]=v,an(u,(c[n+8>>2]|0)-v|0))}function Ru(n){n=n|0;var u=0,v=0;u=c[n>>2]|0,v=u,u|0&&(c[n+4>>2]=v,an(u,(c[n+8>>2]|0)-v|0))}function rl(n){n=n|0,rb(c[n+-4>>2]|0)}function As(n,u){n=n|0,u=u|0,c[n>>2]=u,c[n+4>>2]=0,c[n+8>>2]=0,c[n+12>>2]=Ia(1048576)|0}function Vs(n){n=n|0;var u=0;u=n+32|0,Z[u>>0]=0,Z[u+1>>0]=0,n=n+34|0,Z[n>>0]=0,Z[n+1>>0]=0,Z[n+2>>0]=0,Z[n+3>>0]=0}function sl(n){n=n|0,c[n>>2]=0,c[n+4>>2]=0,c[n+8>>2]=0}function Cl(n){n=n|0,c[n>>2]=0,c[n+4>>2]=0,c[n+8>>2]=0,c[n+12>>2]=0,n=n+16|0,c[n>>2]=-1,c[n+4>>2]=-1}function Ua(n){n=n|0;var u=0,v=0,w=0,R=0,N=0,U=0;if(U=ee,ee=ee+64|0,R=U+32|0,v=U+56|0,u=U+16|0,N=U,uc(c[n>>2]|0,v,4),kl(R,v,v+4|0),v=Il(6693)|0,w=Z[R+11>>0]|0,(v|0)==((w<<24>>24<0?c[R+4>>2]|0:w&255)|0)){if(w=(uI(R,0,-1,6693,v)|0)==0,M2(R),w){if(v=c[n>>2]|0,c[u>>2]=0,c[u+4>>2]=0,c[u+8>>2]=0,c[u+12>>2]=0,c[R>>2]=c[u>>2],c[R+4>>2]=c[u+4>>2],c[R+8>>2]=c[u+8>>2],c[R+12>>2]=c[u+12>>2],Pl(v,R),v=n+20|0,uc(c[n>>2]|0,v,227),x0(n,v),w=js()|0,u=c[w>>2]|0,w=c[w+4>>2]|0,(u|0)!=(w|0))do nr(R,u),bn(R,v),al(R),u=u+24|0;while((u|0)!=(w|0));po(n),Fr(n),Va(c[n>>2]|0),w=c[n>>2]|0,u=(c[n+116>>2]|0)+8|0,v=N,c[v>>2]=0,c[v+4>>2]=0,v=N+8|0,c[v>>2]=u,c[v+4>>2]=0,c[R>>2]=c[N>>2],c[R+4>>2]=c[N+4>>2],c[R+8>>2]=c[N+8>>2],c[R+12>>2]=c[N+12>>2],Pl(w,R),ja(n+4|0),ee=U;return}}else M2(R);U=Zn(8)|0,Cu(U),ir(U|0,2592,8)}function Ia(n){n=n|0;var u=0;return u=q1(n+68|0)|0,n=u+68&-64,c[n+-4>>2]=u,n|0}function uc(n,u,v){n=n|0,u=u|0,v=v|0;var w=0,R=0,N=0,U=0,W=0,Q=0;U=n+13|0,Z[U>>0]|0?Z[n+12>>0]=1:(N=n+4|0,w=c[N>>2]|0,W=n+8|0,R=c[W>>2]|0,Q=w-R|0,v=(Q|0)<(v|0)?Q:v,v&&(rf(u|0,(c[n>>2]|0)+R|0,v|0)|0,R=c[W>>2]|0,w=c[N>>2]|0),Q=R+v|0,c[W>>2]=Q,c[n+16>>2]=v,(Q|0)>=(w|0)&&(Z[U>>0]=1))}function Cu(n){n=n|0,Xf(n,6791),c[n>>2]=4352}function Pl(n,u){n=n|0,u=u|0;var v=0,w=0,R=0;R=u+8|0,u=c[R>>2]|0,R=c[R+4>>2]|0,v=c[n+4>>2]|0,w=((v|0)<0)<<31>>31,(R|0)<(w|0)|(R|0)==(w|0)&u>>>0<v>>>0?c[n+8>>2]=u:Z[n+12>>0]=1}function x0(n,u){n=n|0,u=u|0;var v=0,w=0,R=0,N=0,U=0,W=0,Q=0,ne=0,be=0,Se=0;be=u+179|0,Z[dt>>0]=Z[be>>0],Z[dt+1>>0]=Z[be+1>>0],Z[dt+2>>0]=Z[be+2>>0],Z[dt+3>>0]=Z[be+3>>0],Z[dt+4>>0]=Z[be+4>>0],Z[dt+5>>0]=Z[be+5>>0],Z[dt+6>>0]=Z[be+6>>0],Z[dt+7>>0]=Z[be+7>>0],ne=+si[dt>>3],U=u+187|0,Z[dt>>0]=Z[U>>0],Z[dt+1>>0]=Z[U+1>>0],Z[dt+2>>0]=Z[U+2>>0],Z[dt+3>>0]=Z[U+3>>0],Z[dt+4>>0]=Z[U+4>>0],Z[dt+5>>0]=Z[U+5>>0],Z[dt+6>>0]=Z[U+6>>0],Z[dt+7>>0]=Z[U+7>>0],Se=+si[dt>>3],n=u+195|0,Z[dt>>0]=Z[n>>0],Z[dt+1>>0]=Z[n+1>>0],Z[dt+2>>0]=Z[n+2>>0],Z[dt+3>>0]=Z[n+3>>0],Z[dt+4>>0]=Z[n+4>>0],Z[dt+5>>0]=Z[n+5>>0],Z[dt+6>>0]=Z[n+6>>0],Z[dt+7>>0]=Z[n+7>>0],N=+si[dt>>3],Q=u+203|0,Z[dt>>0]=Z[Q>>0],Z[dt+1>>0]=Z[Q+1>>0],Z[dt+2>>0]=Z[Q+2>>0],Z[dt+3>>0]=Z[Q+3>>0],Z[dt+4>>0]=Z[Q+4>>0],Z[dt+5>>0]=Z[Q+5>>0],Z[dt+6>>0]=Z[Q+6>>0],Z[dt+7>>0]=Z[Q+7>>0],W=+si[dt>>3],R=u+211|0,Z[dt>>0]=Z[R>>0],Z[dt+1>>0]=Z[R+1>>0],Z[dt+2>>0]=Z[R+2>>0],Z[dt+3>>0]=Z[R+3>>0],Z[dt+4>>0]=Z[R+4>>0],Z[dt+5>>0]=Z[R+5>>0],Z[dt+6>>0]=Z[R+6>>0],Z[dt+7>>0]=Z[R+7>>0],v=+si[dt>>3],u=u+219|0,Z[dt>>0]=Z[u>>0],Z[dt+1>>0]=Z[u+1>>0],Z[dt+2>>0]=Z[u+2>>0],Z[dt+3>>0]=Z[u+3>>0],Z[dt+4>>0]=Z[u+4>>0],Z[dt+5>>0]=Z[u+5>>0],Z[dt+6>>0]=Z[u+6>>0],Z[dt+7>>0]=Z[u+7>>0],w=+si[dt>>3],si[dt>>3]=Se,Z[be>>0]=Z[dt>>0],Z[be+1>>0]=Z[dt+1>>0],Z[be+2>>0]=Z[dt+2>>0],Z[be+3>>0]=Z[dt+3>>0],Z[be+4>>0]=Z[dt+4>>0],Z[be+5>>0]=Z[dt+5>>0],Z[be+6>>0]=Z[dt+6>>0],Z[be+7>>0]=Z[dt+7>>0],si[dt>>3]=ne,Z[Q>>0]=Z[dt>>0],Z[Q+1>>0]=Z[dt+1>>0],Z[Q+2>>0]=Z[dt+2>>0],Z[Q+3>>0]=Z[dt+3>>0],Z[Q+4>>0]=Z[dt+4>>0],Z[Q+5>>0]=Z[dt+5>>0],Z[Q+6>>0]=Z[dt+6>>0],Z[Q+7>>0]=Z[dt+7>>0],si[dt>>3]=W,Z[U>>0]=Z[dt>>0],Z[U+1>>0]=Z[dt+1>>0],Z[U+2>>0]=Z[dt+2>>0],Z[U+3>>0]=Z[dt+3>>0],Z[U+4>>0]=Z[dt+4>>0],Z[U+5>>0]=Z[dt+5>>0],Z[U+6>>0]=Z[dt+6>>0],Z[U+7>>0]=Z[dt+7>>0],si[dt>>3]=N,Z[R>>0]=Z[dt>>0],Z[R+1>>0]=Z[dt+1>>0],Z[R+2>>0]=Z[dt+2>>0],Z[R+3>>0]=Z[dt+3>>0],Z[R+4>>0]=Z[dt+4>>0],Z[R+5>>0]=Z[dt+5>>0],Z[R+6>>0]=Z[dt+6>>0],Z[R+7>>0]=Z[dt+7>>0],si[dt>>3]=w,Z[n>>0]=Z[dt>>0],Z[n+1>>0]=Z[dt+1>>0],Z[n+2>>0]=Z[dt+2>>0],Z[n+3>>0]=Z[dt+3>>0],Z[n+4>>0]=Z[dt+4>>0],Z[n+5>>0]=Z[dt+5>>0],Z[n+6>>0]=Z[dt+6>>0],Z[n+7>>0]=Z[dt+7>>0],si[dt>>3]=v,Z[u>>0]=Z[dt>>0],Z[u+1>>0]=Z[dt+1>>0],Z[u+2>>0]=Z[dt+2>>0],Z[u+3>>0]=Z[dt+3>>0],Z[u+4>>0]=Z[dt+4>>0],Z[u+5>>0]=Z[dt+5>>0],Z[u+6>>0]=Z[dt+6>>0],Z[u+7>>0]=Z[dt+7>>0]}function js(){var n=0,u=0,v=0,w=0,R=0,N=0,U=0,W=0;if(R=ee,ee=ee+48|0,v=R+24|0,w=R,n=R+44|0,(Z[21440]|0)==0&&n_(21440)|0&&(c[5374]=0,c[5375]=0,c[5376]=0,r_(21440)),(Z[21448]|0)==0&&n_(21448)|0&&r_(21448),(c[5374]|0)==(c[5375]|0)){if(iI(21508),(c[5374]|0)==(c[5375]|0)){Z[v>>0]=Z[n>>0]|0,hc(w,v),n=c[5375]|0;do if(n>>>0>=(c[5376]|0)>>>0)if(n=((n-(c[5374]|0)|0)/24|0)+1|0,u=go(21496)|0,u>>>0<n>>>0)Yl(21496);else{N=c[5374]|0,W=((c[5376]|0)-N|0)/24|0,U=W<<1,Fl(v,W>>>0<u>>>1>>>0?U>>>0<n>>>0?n:U:u,((c[5375]|0)-N|0)/24|0,21504),u=v+8|0,Lo(c[u>>2]|0,w),c[u>>2]=(c[u>>2]|0)+24,md(21496,v),_d(v);break}else fc(v,21496,1),W=v+4|0,Lo(c[W>>2]|0,w),c[W>>2]=(c[W>>2]|0)+24,zo(v);while(!1);al(w)}nI(21508)}return ee=R,21496}function nr(n,u){n=n|0,u=u|0;var v=0,w=0;v=u+16|0,w=c[v>>2]|0;do if(w)if((u|0)==(w|0)){w=Ol(n)|0,c[n+16>>2]=w,v=c[v>>2]|0,Ng[c[(c[v>>2]|0)+12>>2]&15](v,w);break}else{c[n+16>>2]=J1[c[(c[w>>2]|0)+8>>2]&15](w)|0;break}else c[n+16>>2]=0;while(!1)}function bn(n,u){if(n=n|0,u=u|0,n=c[n+16>>2]|0,!n)u=Zn(4)|0,c[u>>2]=0,tm(u),ir(u|0,4168,131);else{Ng[c[(c[n>>2]|0)+24>>2]&15](n,u);return}}function al(n){n=n|0;var u=0;u=c[n+16>>2]|0,(n|0)!=(u|0)?u|0&&Jr[c[(c[u>>2]|0)+20>>2]&255](u):Jr[c[(c[u>>2]|0)+16>>2]&255](u)}function po(n){n=n|0;var u=0,v=0,w=0,R=0,N=0,U=0,W=0,Q=0,ne=0,be=0,Se=0,je=0;je=ee,ee=ee+96|0,R=je+16|0,be=je,W=je+72|0,N=c[n>>2]|0,Q=Ft[n+114>>1]|0,ne=be,c[ne>>2]=0,c[ne+4>>2]=0,ne=be+8|0,c[ne>>2]=Q,c[ne+4>>2]=0,c[R>>2]=c[be>>2],c[R+4>>2]=c[be+4>>2],c[R+8>>2]=c[be+8>>2],c[R+12>>2]=c[be+12>>2],Pl(N,R),N=n+120|0;e:do if(c[N>>2]|0){for(U=R+2|0,Q=R+16|0,ne=R+20|0,be=R+18|0,v=0;;){if(!(pc(c[n>>2]|0)|0)||Mf(c[n>>2]|0)|0)break e;for(uc(c[n>>2]|0,R,54),u=7277,w=U;(Z[w>>0]|0)==(Z[u>>0]|0);)if(w=w+1|0,(w|0)==(Q|0)){Se=8;break}else u=u+1|0;if((Se|0)==8&&(Se=0,(Re[be>>0]|Re[be+1>>0]<<8)<<16>>16==22204))break;if(ol(c[n>>2]|0,(Re[ne>>0]|Re[ne+1>>0]<<8)&65535,0,1),v=v+1|0,v>>>0>=(c[N>>2]|0)>>>0)break e}be=(Re[ne>>0]|Re[ne+1>>0]<<8)&65535,Se=k3(be)|0,uc(c[n>>2]|0,Se,be),Ds(n,Se),Ai(Se),Se=n+125|0,xd(W,n+247|0,(Re[Se>>0]|Re[Se+1>>0]<<8)&65535),Zp(n+300|0,W)|0,Mu(W),ee=je;return}while(!1);je=Zn(8)|0,vd(je),ir(je|0,2672,8)}function Fr(n){n=n|0;var u=0,v=0,w=0,R=0,N=0,U=0,W=0,Q=0,ne=0,be=0,Se=0,je=0;if(Se=ee,ee=ee+176|0,R=Se+40|0,N=Se+24|0,u=Se+16|0,w=Se,Q=Se+152|0,ne=Se+136|0,be=Se+56|0,W=c[n>>2]|0,U=n+116|0,je=c[U>>2]|0,v=N,c[v>>2]=0,c[v+4>>2]=0,v=N+8|0,c[v>>2]=je,c[v+4>>2]=0,c[R>>2]=c[N>>2],c[R+4>>2]=c[N+4>>2],c[R+8>>2]=c[N+8>>2],c[R+12>>2]=c[N+12>>2],Pl(W,R),W=u,c[W>>2]=0,c[W+4>>2]=0,uc(c[n>>2]|0,u,8),pc(c[n>>2]|0)|0||(je=Zn(8)|0,Sh(je),ir(je|0,2704,8)),v=u,u=c[v>>2]|0,v=c[v+4>>2]|0,(u|0)==-1&(v|0)==-1&&(je=Zn(8)|0,Eh(je,7488),ir(je|0,2720,8)),je=c[n>>2]|0,W=w,c[W>>2]=0,c[W+4>>2]=0,W=w+8|0,c[W>>2]=u,c[W+4>>2]=v,c[R>>2]=c[w>>2],c[R+4>>2]=c[w+4>>2],c[R+8>>2]=c[w+8>>2],c[R+12>>2]=c[w+12>>2],Pl(je,R),pc(c[n>>2]|0)|0||(je=Zn(8)|0,Sh(je),ir(je|0,2704,8)),uc(c[n>>2]|0,R,8),pc(c[n>>2]|0)|0||(je=Zn(8)|0,Sh(je),ir(je|0,2704,8)),c[R>>2]|0&&(je=Zn(8)|0,Ll(je),ir(je|0,2736,8)),N=n+288|0,W=n+292|0,c[W>>2]=c[N>>2],je=n+259|0,(Re[je>>0]|Re[je+1>>0]<<8|Re[je+2>>0]<<16|Re[je+3>>0]<<24|0)==-1&&(je=Zn(8)|0,Eh(je,7606),ir(je|0,2720,8)),w=R+4|0,w0(N,(c[w>>2]|0)+1|0),je=c[N>>2]|0,c[je>>2]=(c[U>>2]|0)+8,c[je+4>>2]=0,(c[w>>2]|0)>>>0>1){if(As(Q,c[n>>2]|0),ul(ne,Q),ca(be,32,2,8,0),ku(ne),ss(be),!(c[w>>2]|0))N=c[N>>2]|0,v=N;else{v=1;do v>>>0>1?u=c[(c[N>>2]|0)+(v+-1<<3)>>2]|0:u=0,U=Nr(be,ne,u,1)|0,u=c[N>>2]|0,je=u+(v<<3)|0,c[je>>2]=U,c[je+4>>2]=((U|0)<0)<<31>>31,v=v+1|0;while(v>>>0<=(c[w>>2]|0)>>>0);v=u,N=u}if(u=c[W>>2]|0,u-v>>3>>>0>1){R=u-N>>3,w=N,u=1,v=c[w>>2]|0,w=c[w+4>>2]|0;do je=N+(u<<3)|0,W=je,v=nf(c[W>>2]|0,c[W+4>>2]|0,v|0,w|0)|0,w=Dn()|0,c[je>>2]=v,c[je+4>>2]=w,u=u+1|0;while(u>>>0<R>>>0)}Br(be),Un(ne),cc(Q)}ee=Se}function Va(n){n=n|0,Z[n+12>>0]=0,Z[n+13>>0]=0}function ja(n){n=n|0,c[n+8>>2]=0,c[n+4>>2]=0}function Il(n){return n=n|0,Z1(n)|0}function kl(n,u,v){n=n|0,u=u|0,v=v|0;var w=0,R=0,N=0,U=0,W=0,Q=0;if(U=ee,ee=ee+16|0,R=u,N=U,w=v-R|0,w>>>0>4294967279&&nb(n),w>>>0<11?Z[n+11>>0]=w:(Q=w+16&-16,W=Pi(Q)|0,c[n>>2]=W,c[n+8>>2]=Q|-2147483648,c[n+4>>2]=w,n=W),(u|0)!=(v|0)){for(R=v-R|0,w=n;Ga(w,u),u=u+1|0,(u|0)!=(v|0);)w=w+1|0;n=n+R|0}Z[N>>0]=0,Ga(n,N),ee=U}function Ga(n,u){n=n|0,u=u|0,Z[n>>0]=Z[u>>0]|0}function Dl(n){n=n|0,nh(n),Ai(n)}function hc(n,u){n=n|0,u=u|0,c[n>>2]=4372,c[n+16>>2]=n}function fc(n,u,v){n=n|0,u=u|0,v=v|0,c[n>>2]=u,u=c[u+4>>2]|0,c[n+4>>2]=u,c[n+8>>2]=u+(v*24|0)}function zo(n){n=n|0,c[(c[n>>2]|0)+4>>2]=c[n+4>>2]}function Lo(n,u){n=n|0,u=u|0;var v=0,w=0;v=u+16|0,w=c[v>>2]|0;do if(w)if((u|0)==(w|0)){w=Ol(n)|0,c[n+16>>2]=w,v=c[v>>2]|0,Ng[c[(c[v>>2]|0)+12>>2]&15](v,w);break}else{c[n+16>>2]=w,c[v>>2]=0;break}else c[n+16>>2]=0;while(!1)}function Ol(n){return n=n|0,n|0}function Fl(n,u,v,w){n=n|0,u=u|0,v=v|0,w=w|0;var R=0;R=n+12|0,c[R>>2]=0,c[n+16>>2]=w;do if(u)if(u>>>0>178956970)R=Zn(8)|0,Tp(R,6723),c[R>>2]=5956,ir(R|0,3928,123);else{w=Pi(u*24|0)|0;break}else w=0;while(!1);c[n>>2]=w,v=w+(v*24|0)|0,c[n+8>>2]=v,c[n+4>>2]=v,c[R>>2]=w+(u*24|0)}function md(n,u){n=n|0,u=u|0;var v=0,w=0,R=0,N=0,U=0,W=0,Q=0;if(W=c[n>>2]|0,Q=n+4|0,v=c[Q>>2]|0,U=u+4|0,(v|0)==(W|0))R=U,N=n,w=c[U>>2]|0,v=W;else{w=c[U>>2]|0;do v=v+-24|0,Lo(w+-24|0,v),w=(c[U>>2]|0)+-24|0,c[U>>2]=w;while((v|0)!=(W|0));R=U,N=n,v=c[n>>2]|0}c[N>>2]=w,c[R>>2]=v,W=u+8|0,U=c[Q>>2]|0,c[Q>>2]=c[W>>2],c[W>>2]=U,W=n+8|0,Q=u+12|0,n=c[W>>2]|0,c[W>>2]=c[Q>>2],c[Q>>2]=n,c[u>>2]=c[R>>2]}function _d(n){n=n|0;var u=0,v=0,w=0,R=0;if(v=c[n+4>>2]|0,w=n+8|0,u=c[w>>2]|0,(u|0)!=(v|0))do R=u+-24|0,c[w>>2]=R,al(R),u=c[w>>2]|0;while((u|0)!=(v|0));u=c[n>>2]|0,u|0&&an(u,(c[n+12>>2]|0)-u|0)}function go(n){return n=n|0,178956970}function bh(n){n=n|0,Ai(n)}function dc(n){return n=n|0,n=Pi(8)|0,c[n>>2]=4372,n|0}function ps(n,u){n=n|0,u=u|0,c[u>>2]=4372}function Ef(n){n=n|0}function yd(n){n=n|0,an(n,8)}function b0(n,u){n=n|0,u=u|0,Nl(n+4|0,u)}function Wp(n,u){return n=n|0,u=u|0,((c[u+4>>2]|0)==7183?n+4|0:0)|0}function A0(n){return n=n|0,2664}function rs(n){n=n|0}function Nl(n,u){n=n|0,u=u|0,Ah(n,u)}function Ah(n,u){n=n|0,u=u|0;var v=0,w=0;if(n=u+104|0,u=Re[n>>0]|0,v=u>>>7,w=u>>>6&1,(v|0)==1&(w|0)!=0&&(w=Zn(8)|0,oa(w),ir(w|0,2632,8)),(v|0)==(w|0))w=Zn(8)|0,mo(w),ir(w|0,2648,8);else{Z[n>>0]=u&63;return}}function oa(n){n=n|0,Xf(n,7076),c[n>>2]=4416}function mo(n){n=n|0,Xf(n,7144),c[n>>2]=4436}function Pu(n){n=n|0,nh(n),Ai(n)}function la(n){n=n|0,nh(n),Ai(n)}function tm(n){n=n|0,c[n>>2]=6092}function pc(n){n=n|0;var u=0;return u=n+12|0,n=(Z[u>>0]|0)==0,Z[u>>0]=0,n|0}function Mf(n){return n=n|0,(Z[n+13>>0]|0)!=0|0}function Ds(n,u){n=n|0,u=u|0,n=n+247|0,ll(n,u),(Re[n>>0]|Re[n+1>>0]<<8)<<16>>16!=2&&(u=Zn(8)|0,gc(u),ir(u|0,2688,8))}function ol(n,u,v,w){n=n|0,u=u|0,v=v|0,w=w|0;var R=0,N=0;switch(w|0){case 0:break;case 2:{w=c[n+4>>2]|0,u=nf(nf(u|0,v|0,-1,-1)|0,Dn()|0,w|0,((w|0)<0)<<31>>31|0)|0,v=Dn()|0;break}case 1:{w=c[n+8>>2]|0,u=nf(w|0,((w|0)<0)<<31>>31|0,u|0,v|0)|0,v=Dn()|0;break}default:v=0,u=0}R=c[n+4>>2]|0,N=((R|0)<0)<<31>>31,w=n+12|0,(v|0)<0|((v|0)>(N|0)|(v|0)==(N|0)&u>>>0>=R>>>0)?Z[w>>0]=1:(Z[w>>0]=0,c[n+8>>2]=u)}function vd(n){n=n|0,Xf(n,7410),c[n>>2]=4476}function xd(n,u,v){n=n|0,u=u|0,v=v|0;var w=0,R=0,N=0,U=0,W=0,Q=0,ne=0;if(U=ee,ee=ee+16|0,N=U,sl(n),R=u+32|0,(Re[R>>0]|Re[R+1>>0]<<8)<<16>>16){w=u+34|0,u=0;do Q=Re[w>>0]|Re[w+1>>0]<<8|Re[w+2>>0]<<16|Re[w+3>>0]<<24,ne=Q+(u*6|0)|0,W=Q+(u*6|0)+2|0,Q=Q+(u*6|0)+4|0,Hc(N,(Re[ne>>0]|Re[ne+1>>0]<<8)&65535,(Re[W>>0]|Re[W+1>>0]<<8)&65535,(Re[Q>>0]|Re[Q+1>>0]<<8)&65535),wh(n,N),v=v-((Re[W>>0]|Re[W+1>>0]<<8)&65535)|0,u=u+1|0;while(u>>>0<((Re[R>>0]|Re[R+1>>0]<<8)&65535)>>>0)}(v|0)<0&&(ne=Zn(8)|0,gc(ne),ir(ne|0,2688,8)),v|0&&(Hc(N,0,v,2),wh(n,N)),ee=U}function Zp(n,u){n=n|0,u=u|0;var v=0,w=0;return v=ee,ee=ee+16|0,w=v+1|0,Z[w>>0]=Z[v>>0]|0,Rf(n,u,w),ee=v,n|0}function ll(n,u){n=n|0,u=u|0;var v=0,w=0,R=0,N=0,U=0,W=0,Q=0;if(w=u+2|0,N=Re[u>>0]|Re[u+1>>0]<<8,Z[n>>0]=N,Z[n+1>>0]=N>>8,N=n+2|0,w=Re[w>>0]|Re[w+1>>0]<<8,Z[N>>0]=w,Z[N+1>>0]=w>>8,Z[n+4>>0]=Z[u+4>>0]|0,N=u+6|0,Z[n+5>>0]=Z[u+5>>0]|0,w=u+8|0,v=n+6|0,N=Re[N>>0]|Re[N+1>>0]<<8,Z[v>>0]=N,Z[v+1>>0]=N>>8,v=u+12|0,N=n+8|0,w=Re[w>>0]|Re[w+1>>0]<<8|Re[w+2>>0]<<16|Re[w+3>>0]<<24,Z[N>>0]=w,Z[N+1>>0]=w>>8,Z[N+2>>0]=w>>16,Z[N+3>>0]=w>>24,N=n+12|0,v=Re[v>>0]|Re[v+1>>0]<<8|Re[v+2>>0]<<16|Re[v+3>>0]<<24,Z[N>>0]=v,Z[N+1>>0]=v>>8,Z[N+2>>0]=v>>16,Z[N+3>>0]=v>>24,N=u+16|0,v=N,v=Re[v>>0]|Re[v+1>>0]<<8|Re[v+2>>0]<<16|Re[v+3>>0]<<24,N=N+4|0,N=Re[N>>0]|Re[N+1>>0]<<8|Re[N+2>>0]<<16|Re[N+3>>0]<<24,w=n+16|0,U=w,Z[U>>0]=v,Z[U+1>>0]=v>>8,Z[U+2>>0]=v>>16,Z[U+3>>0]=v>>24,w=w+4|0,Z[w>>0]=N,Z[w+1>>0]=N>>8,Z[w+2>>0]=N>>16,Z[w+3>>0]=N>>24,w=u+32|0,N=u+24|0,U=N,U=Re[U>>0]|Re[U+1>>0]<<8|Re[U+2>>0]<<16|Re[U+3>>0]<<24,N=N+4|0,N=Re[N>>0]|Re[N+1>>0]<<8|Re[N+2>>0]<<16|Re[N+3>>0]<<24,v=n+24|0,R=v,Z[R>>0]=U,Z[R+1>>0]=U>>8,Z[R+2>>0]=U>>16,Z[R+3>>0]=U>>24,v=v+4|0,Z[v>>0]=N,Z[v+1>>0]=N>>8,Z[v+2>>0]=N>>16,Z[v+3>>0]=N>>24,v=u+34|0,N=n+32|0,w=Re[w>>0]|Re[w+1>>0]<<8,Z[N>>0]=w,Z[N+1>>0]=w>>8,R=n+34|0,n=Re[R>>0]|Re[R+1>>0]<<8|Re[R+2>>0]<<16|Re[R+3>>0]<<24,n?(D3(n),n=Re[N>>0]|Re[N+1>>0]<<8):n=w,w=k3((n&65535)*6|0)|0,Z[R>>0]=w,Z[R+1>>0]=w>>8,Z[R+2>>0]=w>>16,Z[R+3>>0]=w>>24,n<<16>>16&&(n=u+36|0,U=Re[v>>0]|Re[v+1>>0]<<8,Z[w>>0]=U,Z[w+1>>0]=U>>8,u=u+38|0,U=w+2|0,n=Re[n>>0]|Re[n+1>>0]<<8,Z[U>>0]=n,Z[U+1>>0]=n>>8,U=w+4|0,u=Re[u>>0]|Re[u+1>>0]<<8,Z[U>>0]=u,Z[U+1>>0]=u>>8,((Re[N>>0]|Re[N+1>>0]<<8)&65535)>1)){n=1;do u=v,v=v+6|0,U=Re[R>>0]|Re[R+1>>0]<<8|Re[R+2>>0]<<16|Re[R+3>>0]<<24,W=u+8|0,w=U+(n*6|0)|0,Q=Re[v>>0]|Re[v+1>>0]<<8,Z[w>>0]=Q,Z[w+1>>0]=Q>>8,u=u+10|0,w=U+(n*6|0)+2|0,W=Re[W>>0]|Re[W+1>>0]<<8,Z[w>>0]=W,Z[w+1>>0]=W>>8,U=U+(n*6|0)+4|0,u=Re[u>>0]|Re[u+1>>0]<<8,Z[U>>0]=u,Z[U+1>>0]=u>>8,n=n+1|0;while(n>>>0<((Re[N>>0]|Re[N+1>>0]<<8)&65535)>>>0)}}function gc(n){n=n|0,Xf(n,7354),c[n>>2]=4456}function Wa(n){n=n|0,nh(n),Ai(n)}function yi(n){n=n|0,nh(n),Ai(n)}function wh(n,u){n=n|0,u=u|0;var v=0,w=0,R=0,N=0,U=0,W=0,Q=0,ne=0;W=ee,ee=ee+32|0,R=W,N=n+4|0,v=c[N>>2]|0,U=n+8|0;do if((v|0)==(c[U>>2]|0))if(v=((v-(c[n>>2]|0)|0)/12|0)+1|0,w=Iu(n)|0,w>>>0<v>>>0)Yl(n);else{Q=c[n>>2]|0,ne=((c[U>>2]|0)-Q|0)/12|0,U=ne<<1,Th(R,ne>>>0<w>>>1>>>0?U>>>0<v>>>0?v:U:w,((c[N>>2]|0)-Q|0)/12|0,n+8|0),U=R+8|0,N=c[U>>2]|0,c[N>>2]=c[u>>2],c[N+4>>2]=c[u+4>>2],c[N+8>>2]=c[u+8>>2],c[U>>2]=(c[U>>2]|0)+12,bd(n,R),Bl(R);break}else Uo(R,n,1),ne=R+4|0,Q=c[ne>>2]|0,c[Q>>2]=c[u>>2],c[Q+4>>2]=c[u+4>>2],c[Q+8>>2]=c[u+8>>2],c[ne>>2]=(c[ne>>2]|0)+12,cl(R);while(!1);ee=W}function Hc(n,u,v,w){n=n|0,u=u|0,v=v|0,w=w|0,c[n>>2]=u,c[n+4>>2]=v,c[n+8>>2]=w}function Uo(n,u,v){n=n|0,u=u|0,v=v|0,c[n>>2]=u,u=c[u+4>>2]|0,c[n+4>>2]=u,c[n+8>>2]=u+(v*12|0)}function cl(n){n=n|0,c[(c[n>>2]|0)+4>>2]=c[n+4>>2]}function Th(n,u,v,w){n=n|0,u=u|0,v=v|0,w=w|0;var R=0;R=n+12|0,c[R>>2]=0,c[n+16>>2]=w;do if(u)if(u>>>0>357913941)R=Zn(8)|0,Tp(R,6723),c[R>>2]=5956,ir(R|0,3928,123);else{w=Pi(u*12|0)|0;break}else w=0;while(!1);c[n>>2]=w,v=w+(v*12|0)|0,c[n+8>>2]=v,c[n+4>>2]=v,c[R>>2]=w+(u*12|0)}function bd(n,u){n=n|0,u=u|0;var v=0,w=0,R=0,N=0,U=0;w=c[n>>2]|0,U=n+4|0,N=u+4|0,R=(c[U>>2]|0)-w|0,v=(c[N>>2]|0)+(((R|0)/-12|0)*12|0)|0,c[N>>2]=v,(R|0)>0?(rh(v|0,w|0,R|0)|0,w=N,v=c[N>>2]|0):w=N,N=c[n>>2]|0,c[n>>2]=v,c[w>>2]=N,N=u+8|0,R=c[U>>2]|0,c[U>>2]=c[N>>2],c[N>>2]=R,N=n+8|0,U=u+12|0,n=c[N>>2]|0,c[N>>2]=c[U>>2],c[U>>2]=n,c[u>>2]=c[w>>2]}function Bl(n){n=n|0;var u=0,v=0,w=0;u=c[n+4>>2]|0,v=n+8|0,w=c[v>>2]|0,(w|0)!=(u|0)&&(c[v>>2]=w+(~(((w+-12-u|0)>>>0)/12|0)*12|0)),u=c[n>>2]|0,u|0&&an(u,(c[n+12>>2]|0)-u|0)}function Iu(n){return n=n|0,357913941}function Rf(n,u,v){n=n|0,u=u|0,v=v|0;var w=0;zl(n),c[n>>2]=c[u>>2],v=u+4|0,c[n+4>>2]=c[v>>2],w=u+8|0,c[n+8>>2]=c[w>>2],c[w>>2]=0,c[v>>2]=0,c[u>>2]=0}function zl(n){n=n|0;var u=0,v=0,w=0,R=0;u=c[n>>2]|0,v=u,u|0&&(w=n+4|0,c[w>>2]=v,R=n+8|0,an(u,(c[R>>2]|0)-v|0),c[R>>2]=0,c[w>>2]=0,c[n>>2]=0)}function Sh(n){n=n|0,Xf(n,7660),c[n>>2]=4496}function Eh(n,u){n=n|0,u=u|0,Xf(n,u),c[n>>2]=4516}function Ll(n){n=n|0,Xf(n,7704),c[n>>2]=4536}function w0(n,u){n=n|0,u=u|0;var v=0,w=0,R=0;v=n+4|0,R=c[n>>2]|0,w=(c[v>>2]|0)-R>>3,w>>>0>=u>>>0?w>>>0>u>>>0&&(c[v>>2]=R+(u<<3)):Cf(n,u-w|0)}function ul(n,u){n=n|0,u=u|0,c[n>>2]=u,c[n+4>>2]=0,c[n+8>>2]=-1}function ca(n,u,v,w,R){n=n|0,u=u|0,v=v|0,w=w|0,R=R|0;var N=0;c[n+4>>2]=u,c[n+8>>2]=v,c[n+12>>2]=w,c[n+16>>2]=R,c[n+36>>2]=0,c[n+40>>2]=0,c[n+44>>2]=0,Rh(n+48|0),c[n+68>>2]=0,c[n+72>>2]=0,c[n+76>>2]=0;do if(R){for(w=n+20|0,c[w>>2]=0,c[n+24>>2]=R,v=R,N=0;v=v>>>1,u=N+1|0,v;)N=u;c[w>>2]=(1<<N|0)==(R|0)?N:u,v=R>>>1,c[n+28>>2]=0-v,v=R+-1-v|0}else if(v=n+20|0,(u+-1|0)>>>0<31){c[v>>2]=u,R=1<<u,c[n+24>>2]=R,v=R>>>1,c[n+28>>2]=0-v,v=R+-1-v|0;break}else{c[v>>2]=32,c[n+24>>2]=0,c[n+28>>2]=-2147483648,v=2147483647;break}while(!1);c[n+32>>2]=v,c[n>>2]=0}function ku(n){n=n|0;var u=0;u=((hr(c[n>>2]|0)|0)&255)<<24,u=((hr(c[n>>2]|0)|0)&255)<<16|u,u=u|((hr(c[n>>2]|0)|0)&255)<<8,c[n+4>>2]=u|(hr(c[n>>2]|0)|0)&255}function ss(n){n=n|0;var u=0,v=0,w=0,R=0,N=0,U=0,W=0,Q=0,ne=0,be=0,Se=0,je=0,ct=0,vt=0,ot=0,nn=0,ui=0,Jt=0;ot=ee,ee=ee+64|0,ct=ot+44|0,vt=ot,ne=n+36|0,be=n+40|0;e:do if((c[ne>>2]|0)==(c[be>>2]|0)){Se=n+8|0;t:do if(!(c[Se>>2]|0))je=n+20|0;else{for(R=n+20|0,N=n+44|0,U=ct+4|0,W=n+44|0,Q=ct+8|0,w=0;;){if(zi(vt,(c[R>>2]|0)+1|0,0,0),u=c[be>>2]|0,u>>>0<(c[N>>2]|0)>>>0)_r(ct,ne,1),Za(c[U>>2]|0,vt),c[U>>2]=(c[U>>2]|0)+44,yo(ct);else{if(u=((u-(c[ne>>2]|0)|0)/44|0)+1|0,v=wd(ne)|0,v>>>0<u>>>0)break;nn=c[ne>>2]|0,Jt=((c[N>>2]|0)-nn|0)/44|0,ui=Jt<<1,qc(ct,Jt>>>0<v>>>1>>>0?ui>>>0<u>>>0?u:ui:v,((c[be>>2]|0)-nn|0)/44|0,W),Za(c[Q>>2]|0,vt),c[Q>>2]=(c[Q>>2]|0)+44,Yc(ne,ct),Ul(ct)}if(rn(vt),w=w+1|0,w>>>0>=(c[Se>>2]|0)>>>0){je=R;break t}}Yl(ne)}while(!1);if(c[je>>2]|0){for(U=n+12|0,W=n+68|0,Q=n+72|0,ne=n+76|0,be=ct+4|0,R=n+76|0,N=ct+8|0,w=1;;){if(u=c[U>>2]|0,zi(vt,1<<(w>>>0>u>>>0?u:w),0,0),u=c[Q>>2]|0,u>>>0<(c[ne>>2]|0)>>>0)_r(ct,W,1),Za(c[be>>2]|0,vt),c[be>>2]=(c[be>>2]|0)+44,yo(ct);else{if(u=((u-(c[W>>2]|0)|0)/44|0)+1|0,v=wd(W)|0,v>>>0<u>>>0)break;Jt=c[W>>2]|0,nn=((c[ne>>2]|0)-Jt|0)/44|0,ui=nn<<1,qc(ct,nn>>>0<v>>>1>>>0?ui>>>0<u>>>0?u:ui:v,((c[Q>>2]|0)-Jt|0)/44|0,R),Za(c[N>>2]|0,vt),c[N>>2]=(c[N>>2]|0)+44,Yc(W,ct),Ul(ct)}if(rn(vt),w=w+1|0,w>>>0>(c[je>>2]|0)>>>0)break e}Yl(W)}}while(!1);ee=ot}function Nr(n,u,v,w){return n=n|0,u=u|0,v=v|0,w=w|0,v=(Ph(n,u,(c[n+36>>2]|0)+(w*44|0)|0)|0)+v|0,u=c[n+24>>2]|0,(v|0)<0?v+u|0:v-(v>>>0<u>>>0?0:u)|0}function Br(n){n=n|0,Er(n+68|0),Er(n+36|0)}function Un(n){n=n|0}function T0(n){n=n|0,nh(n),Ai(n)}function mc(n){n=n|0,nh(n),Ai(n)}function $c(n){n=n|0,nh(n),Ai(n)}function Cf(n,u){n=n|0,u=u|0;var v=0,w=0,R=0,N=0,U=0,W=0,Q=0,ne=0;W=ee,ee=ee+32|0,R=W,N=n+8|0,U=n+4|0,v=c[U>>2]|0;do if((c[N>>2]|0)-v>>3>>>0<u>>>0)if(v=(v-(c[n>>2]|0)>>3)+u|0,w=Mi(n)|0,w>>>0<v>>>0)Yl(n);else{Q=c[n>>2]|0,ne=(c[N>>2]|0)-Q|0,N=ne>>2,Du(R,ne>>3>>>0<w>>>1>>>0?N>>>0<v>>>0?v:N:w,(c[U>>2]|0)-Q>>3,n+8|0),Pf(R,u),S0(n,R),_o(R);break}else Ad(n,u);while(!1);ee=W}function Ad(n,u){n=n|0,u=u|0;var v=0,w=0,R=0;R=ee,ee=ee+16|0,w=R,Ou(w,n,u),n=w+4|0,u=c[n>>2]|0,v=c[w+8>>2]|0,(u|0)!=(v|0)&&(v=v+-8-u|0,a_(u|0,0,v+8&-8|0)|0,c[n>>2]=u+((v>>>3)+1<<3)),xi(w),ee=R}function Du(n,u,v,w){n=n|0,u=u|0,v=v|0,w=w|0;var R=0;R=n+12|0,c[R>>2]=0,c[n+16>>2]=w;do if(u)if(u>>>0>536870911)R=Zn(8)|0,Tp(R,6723),c[R>>2]=5956,ir(R|0,3928,123);else{w=Pi(u<<3)|0;break}else w=0;while(!1);c[n>>2]=w,v=w+(v<<3)|0,c[n+8>>2]=v,c[n+4>>2]=v,c[R>>2]=w+(u<<3)}function Pf(n,u){n=n|0,u=u|0;var v=0,w=0;w=ee,ee=ee+16|0,v=w,Vo(v,n+8|0,u),n=c[v>>2]|0,u=c[v+4>>2]|0,(n|0)!=(u|0)&&(u=u+-8-n|0,a_(n|0,0,u+8&-8|0)|0,c[v>>2]=n+((u>>>3)+1<<3)),Mh(v),ee=w}function S0(n,u){n=n|0,u=u|0;var v=0,w=0,R=0,N=0,U=0;w=c[n>>2]|0,U=n+4|0,N=u+4|0,R=(c[U>>2]|0)-w|0,v=(c[N>>2]|0)+(0-(R>>3)<<3)|0,c[N>>2]=v,(R|0)>0?(rh(v|0,w|0,R|0)|0,w=N,v=c[N>>2]|0):w=N,N=c[n>>2]|0,c[n>>2]=v,c[w>>2]=N,N=u+8|0,R=c[U>>2]|0,c[U>>2]=c[N>>2],c[N>>2]=R,N=n+8|0,U=u+12|0,n=c[N>>2]|0,c[N>>2]=c[U>>2],c[U>>2]=n,c[u>>2]=c[w>>2]}function _o(n){n=n|0;var u=0,v=0,w=0;u=c[n+4>>2]|0,v=n+8|0,w=c[v>>2]|0,(w|0)!=(u|0)&&(c[v>>2]=w+(~((w+-8-u|0)>>>3)<<3)),u=c[n>>2]|0,u|0&&an(u,(c[n+12>>2]|0)-u|0)}function Ou(n,u,v){n=n|0,u=u|0,v=v|0,c[n>>2]=u,u=c[u+4>>2]|0,c[n+4>>2]=u,c[n+8>>2]=u+(v<<3)}function xi(n){n=n|0,c[(c[n>>2]|0)+4>>2]=c[n+4>>2]}function Mi(n){return n=n|0,536870911}function Vo(n,u,v){n=n|0,u=u|0,v=v|0,c[n>>2]=c[u>>2],c[n+4>>2]=(c[u>>2]|0)+(v<<3),c[n+8>>2]=u}function Mh(n){n=n|0,c[c[n+8>>2]>>2]=c[n>>2]}function Rh(n){n=n|0,c[n+12>>2]=1,c[n+16>>2]=2,c[n+8>>2]=4096,c[n+4>>2]=4,c[n>>2]=4}function Er(n){n=n|0;var u=0,v=0,w=0;if(v=c[n>>2]|0,v|0){if(w=n+4|0,u=c[w>>2]|0,(u|0)==(v|0))u=v;else{do u=u+-44|0,rn(u);while((u|0)!=(v|0));u=c[n>>2]|0}c[w>>2]=v,an(u,(c[n+8>>2]|0)-u|0)}}function rn(n){n=n|0;var u=0;u=c[n+8>>2]|0,u|0&&rl(u),u=c[n+12>>2]|0,u|0&&rl(u),u=c[n+16>>2]|0,u|0&&rl(u)}function hr(n){n=n|0;var u=0,v=0;return v=n+4|0,u=c[v>>2]|0,(u|0)>=(c[n+8>>2]|0)&&(Ch(n),u=c[v>>2]|0),n=c[n+12>>2]|0,c[v>>2]=u+1,Z[n+u>>0]|0}function Ch(n){n=n|0;var u=0;if(c[n+4>>2]=0,uc(c[n>>2]|0,c[n+12>>2]|0,1048576),u=_c(c[n>>2]|0)|0,c[n+8>>2]=u,!u)u=Zn(8)|0,un(u),ir(u|0,2752,8);else return}function _c(n){return n=n|0,c[n+16>>2]|0}function un(n){n=n|0,Xf(n,7769),c[n>>2]=4556}function Vn(n){n=n|0,nh(n),Ai(n)}function zi(n,u,v,w){n=n|0,u=u|0,v=v|0,w=w|0;var R=0,N=0,U=0;if(c[n>>2]=u,Z[n+4>>0]=v&1,N=n+8|0,c[N>>2]=0,U=n+12|0,c[U>>2]=0,R=n+16|0,c[R>>2]=0,(u+-2|0)>>>0>2046&&(n=Zn(8)|0,Xf(n,7789),ir(n|0,3912,8)),c[n+32>>2]=u+-1,u>>>0>16&(v^1)){for(v=3;1<<v+2>>>0<u>>>0;)v=v+1|0;u=1<<v,c[n+36>>2]=u,c[n+40>>2]=15-v,c[R>>2]=Ia((u<<2)+8|0)|0,u=c[n>>2]|0}else c[R>>2]=0,c[n+40>>2]=0,c[n+36>>2]=0;if(c[N>>2]=Ia(u<<2)|0,R=Ia(c[n>>2]<<2)|0,c[U>>2]=R,c[n+20>>2]=0,u=c[n>>2]|0,v=n+24|0,c[v>>2]=u,u=(u|0)!=0,w){if(u){u=0;do c[R+(u<<2)>>2]=c[w+(u<<2)>>2],u=u+1|0;while(u>>>0<(c[n>>2]|0)>>>0)}}else if(u){u=0;do c[R+(u<<2)>>2]=1,u=u+1|0;while(u>>>0<(c[n>>2]|0)>>>0)}vo(n),w=((c[n>>2]|0)+6|0)>>>1,c[v>>2]=w,c[n+28>>2]=w}function _r(n,u,v){n=n|0,u=u|0,v=v|0,c[n>>2]=u,u=c[u+4>>2]|0,c[n+4>>2]=u,c[n+8>>2]=u+(v*44|0)}function yo(n){n=n|0,c[(c[n>>2]|0)+4>>2]=c[n+4>>2]}function Za(n,u){n=n|0,u=u|0;var v=0;c[n>>2]=c[u>>2],Z[n+4>>0]=Z[u+4>>0]|0,v=u+8|0,c[n+8>>2]=c[v>>2],c[n+12>>2]=c[u+12>>2],c[n+16>>2]=c[u+16>>2],c[n+20>>2]=c[u+20>>2],c[n+24>>2]=c[u+24>>2],c[n+28>>2]=c[u+28>>2],c[n+32>>2]=c[u+32>>2],c[n+36>>2]=c[u+36>>2],c[n+40>>2]=c[u+40>>2],c[v>>2]=0,c[v+4>>2]=0,c[v+8>>2]=0}function qc(n,u,v,w){n=n|0,u=u|0,v=v|0,w=w|0;var R=0;R=n+12|0,c[R>>2]=0,c[n+16>>2]=w;do if(u)if(u>>>0>97612893)R=Zn(8)|0,Tp(R,6723),c[R>>2]=5956,ir(R|0,3928,123);else{w=Pi(u*44|0)|0;break}else w=0;while(!1);c[n>>2]=w,v=w+(v*44|0)|0,c[n+8>>2]=v,c[n+4>>2]=v,c[R>>2]=w+(u*44|0)}function Yc(n,u){n=n|0,u=u|0;var v=0,w=0,R=0,N=0,U=0,W=0,Q=0;if(W=c[n>>2]|0,Q=n+4|0,v=c[Q>>2]|0,U=u+4|0,(v|0)==(W|0))R=U,N=n,w=c[U>>2]|0,v=W;else{w=c[U>>2]|0;do v=v+-44|0,lr(w+-44|0,v),w=(c[U>>2]|0)+-44|0,c[U>>2]=w;while((v|0)!=(W|0));R=U,N=n,v=c[n>>2]|0}c[N>>2]=w,c[R>>2]=v,W=u+8|0,U=c[Q>>2]|0,c[Q>>2]=c[W>>2],c[W>>2]=U,W=n+8|0,Q=u+12|0,n=c[W>>2]|0,c[W>>2]=c[Q>>2],c[Q>>2]=n,c[u>>2]=c[R>>2]}function Ul(n){n=n|0;var u=0,v=0,w=0,R=0;if(v=c[n+4>>2]|0,w=n+8|0,u=c[w>>2]|0,(u|0)!=(v|0))do R=u+-44|0,c[w>>2]=R,rn(R),u=c[w>>2]|0;while((u|0)!=(v|0));u=c[n>>2]|0,u|0&&an(u,(c[n+12>>2]|0)-u|0)}function wd(n){return n=n|0,97612893}function lr(n,u){n=n|0,u=u|0;var v=0,w=0,R=0,N=0;v=c[u>>2]|0,c[n>>2]=v,Z[n+4>>0]=Z[u+4>>0]|0,c[n+20>>2]=c[u+20>>2],c[n+24>>2]=c[u+24>>2],c[n+28>>2]=c[u+28>>2],c[n+32>>2]=c[u+32>>2],N=n+36|0,c[N>>2]=c[u+36>>2],c[n+40>>2]=c[u+40>>2],v=v<<2,w=Ia(v)|0,c[n+8>>2]=w,R=c[n>>2]|0,R|0&&rf(w|0,c[u+8>>2]|0,R<<2|0)|0,v=Ia(v)|0,c[n+12>>2]=v,w=c[n>>2]|0,w|0&&rf(v|0,c[u+12>>2]|0,w<<2|0)|0,v=c[N>>2]|0,v?(w=Ia((v<<2)+8|0)|0,c[n+16>>2]=w,v=(c[N>>2]<<2)+8|0,v|0&&rf(w|0,c[u+16>>2]|0,v|0)|0):c[n+16>>2]=0}function vo(n){n=n|0;var u=0,v=0,w=0,R=0,N=0,U=0,W=0,Q=0,ne=0,be=0,Se=0,je=0,ct=0,vt=0;if(vt=n+24|0,R=n+20|0,u=(c[R>>2]|0)+(c[vt>>2]|0)|0,c[R>>2]=u,u>>>0>32768)if(c[R>>2]=0,!(c[n>>2]|0))u=0;else{w=c[n+12>>2]|0,v=0;do Se=w+(v<<2)|0,u=((c[Se>>2]|0)+1|0)>>>1,c[Se>>2]=u,u=(c[R>>2]|0)+u|0,c[R>>2]=u,v=v+1|0;while(v>>>0<(c[n>>2]|0)>>>0)}Se=2147483648/(u>>>0)|0;do if((Z[n+4>>0]|0)==0&&(je=n+36|0,(c[je>>2]|0)!=0)){if(c[n>>2]|0){W=c[n+8>>2]|0,Q=c[n+12>>2]|0,ne=n+40|0,be=n+16|0,u=0,N=0,U=0;do{if(v=(pn(N,Se)|0)>>>16,c[W+(U<<2)>>2]=v,N=(c[Q+(U<<2)>>2]|0)+N|0,v=v>>>(c[ne>>2]|0),u>>>0<v>>>0){w=U+-1|0,R=c[be>>2]|0;do u=u+1|0,c[R+(u<<2)>>2]=w;while((u|0)!=(v|0));u=v}U=U+1|0}while(U>>>0<(c[n>>2]|0)>>>0);if(v=c[be>>2]|0,c[v>>2]=0,u>>>0>(c[je>>2]|0)>>>0){u=n;break}}else v=c[n+16>>2]|0,c[v>>2]=0,u=0;do u=u+1|0,c[v+(u<<2)>>2]=(c[n>>2]|0)+-1;while(u>>>0<=(c[je>>2]|0)>>>0);u=n}else ct=7;while(!1);if((ct|0)==7)if(!(c[n>>2]|0))u=n;else{w=c[n+8>>2]|0,R=c[n+12>>2]|0,u=0,v=0;do c[w+(u<<2)>>2]=(pn(v,Se)|0)>>>16,v=(c[R+(u<<2)>>2]|0)+v|0,u=u+1|0;while(u>>>0<(c[n>>2]|0)>>>0);u=n}ct=((c[vt>>2]|0)*5|0)>>>2,je=(c[u>>2]<<3)+48|0,ct=ct>>>0>je>>>0?je:ct,c[vt>>2]=ct,c[n+28>>2]=ct}function Ph(n,u,v){n=n|0,u=u|0,v=v|0;var w=0;v=Zr(u,v)|0,c[n>>2]=v;do if(v){if(v>>>0>=32){v=c[n+28>>2]|0;break}if(w=c[n+12>>2]|0,v>>>0>w>>>0?(w=v-w|0,v=Zr(u,(c[n+68>>2]|0)+((v+-1|0)*44|0)|0)|0,w=v<<w|(Ih(u,w)|0)):w=Zr(u,(c[n+68>>2]|0)+((v+-1|0)*44|0)|0)|0,v=c[n>>2]|0,(w|0)<(1<<v+-1|0)){v=w+1+(-1<<v)|0;break}else{v=w+1|0;break}}else v=If(u,n+48|0)|0;while(!1);return v|0}function Zr(n,u){n=n|0,u=u|0;var v=0,w=0,R=0,N=0,U=0,W=0,Q=0,ne=0,be=0,Se=0,je=0,ct=0;if(je=n+8|0,Se=c[je>>2]|0,R=c[u+16>>2]|0,R){if(w=n+4|0,v=c[w>>2]|0,be=Se>>>15,c[je>>2]=be,Q=(v>>>0)/(be>>>0)|0,W=Q>>>(c[u+40>>2]|0),N=c[R+(W<<2)>>2]|0,W=(c[R+(W+1<<2)>>2]|0)+1|0,U=N+1|0,ne=c[u+8>>2]|0,W>>>0>U>>>0){R=N,N=W;do U=(N+R|0)>>>1,W=(c[ne+(U<<2)>>2]|0)>>>0>Q>>>0,R=W?R:U,N=W?U:N,U=R+1|0;while(N>>>0>U>>>0);N=R}R=pn(c[ne+(N<<2)>>2]|0,be)|0,(N|0)==(c[u+32>>2]|0)?U=Se:U=pn(c[ne+(U<<2)>>2]|0,be)|0}else{ne=Se>>>15,c[je>>2]=ne,W=c[u>>2]|0,be=c[u+8>>2]|0,w=n+4|0,v=c[w>>2]|0,Q=W>>>1,R=0,U=Se,N=0;do ct=pn(c[be+(Q<<2)>>2]|0,ne)|0,Se=ct>>>0>v>>>0,U=Se?ct:U,R=Se?R:ct,N=Se?N:Q,W=Se?Q:W,Q=(N+W|0)>>>1;while((Q|0)!=(N|0))}return c[w>>2]=v-R,ct=U-R|0,c[je>>2]=ct,ct>>>0<16777216&&Jc(n),je=(c[u+12>>2]|0)+(N<<2)|0,c[je>>2]=(c[je>>2]|0)+1,je=u+28|0,ct=(c[je>>2]|0)+-1|0,c[je>>2]=ct,ct||vo(u),N|0}function Ih(n,u){n=n|0,u=u|0;var v=0,w=0,R=0,N=0;return u>>>0>19?(v=(Vl(n)|0)&65535,(Ih(n,u+-16|0)|0)<<16|v|0):(w=n+4|0,R=c[w>>2]|0,N=n+8|0,v=(c[N>>2]|0)>>>u,c[N>>2]=v,u=(R>>>0)/(v>>>0)|0,c[w>>2]=R-(pn(u,v)|0),v>>>0<16777216&&Jc(n),u|0)}function If(n,u){n=n|0,u=u|0;var v=0,w=0,R=0,N=0,U=0,W=0;return w=n+8|0,R=c[w>>2]|0,v=pn(R>>>13,c[u+8>>2]|0)|0,N=n+4|0,U=c[N>>2]|0,W=U>>>0>=v>>>0,W?(c[N>>2]=U-v,v=R-v|0,c[w>>2]=v):(c[w>>2]=v,U=u+12|0,c[U>>2]=(c[U>>2]|0)+1),v>>>0<16777216&&Jc(n),U=u+4|0,n=(c[U>>2]|0)+-1|0,c[U>>2]=n,n||jl(u),W&1|0}function Jc(n){n=n|0;var u=0,v=0,w=0,R=0;u=n+4|0,v=n+8|0,w=c[u>>2]|0;do w=w<<8|(hr(c[n>>2]|0)|0)&255,c[u>>2]=w,R=c[v>>2]<<8,c[v>>2]=R;while(R>>>0<16777216)}function Vl(n){n=n|0;var u=0,v=0,w=0,R=0;return v=n+4|0,R=c[v>>2]|0,u=n+8|0,w=(c[u>>2]|0)>>>16,c[u>>2]=w,u=(R>>>0)/(w>>>0)|0,c[v>>2]=R-(pn(u,w)|0),Jc(n),u&65535|0}function jl(n){n=n|0;var u=0,v=0,w=0,R=0,N=0;R=c[n>>2]|0,v=n+16|0,u=(c[v>>2]|0)+R|0,c[v>>2]=u,u>>>0>8192?(w=(u+1|0)>>>1,c[v>>2]=w,N=n+12|0,u=((c[N>>2]|0)+1|0)>>>1,c[N>>2]=u,(u|0)==(w|0)?(u=w+1|0,c[v>>2]=u,v=u,u=w):v=w):(v=u,u=c[n+12>>2]|0),c[n+8>>2]=(pn(u,2147483648/(v>>>0)|0)|0)>>>18,N=R*5|0,N=N>>>0>259?64:N>>>2,c[n>>2]=N,c[n+4>>2]=N}function ea(n,u){n=n|0,u=u|0;var v=0,w=0,R=0,N=0,U=0,W=0,Q=0,ne=0,be=0,Se=0,je=0;be=ee,ee=ee+32|0,N=be+16|0,U=be+8|0,W=be,Q=n+336|0,w=Q,R=n+259|0,(c[w+4>>2]|0)==0&&(c[w>>2]|0)==(Re[R>>0]|Re[R+1>>0]<<8|Re[R+2>>0]<<16|Re[R+3>>0]<<24|0)?(w=n+320|0,v=c[n+320>>2]|0,ne=5):(w=n+320|0,v=c[w>>2]|0,R=v,(v|0)!=0&&(c[n+312>>2]|0)!=0||(v=R,ne=5)),(ne|0)==5&&(ne=n+320|0,c[N>>2]=v,c[ne>>2]=0,v=n+324|0,c[N+4>>2]=c[v>>2],c[v>>2]=0,Eu(N),R=n+312|0,c[N>>2]=c[R>>2],c[R>>2]=0,Se=n+316|0,c[N+4>>2]=c[Se>>2],c[Se>>2]=0,Rl(N),je=Pi(12)|0,ul(je,n+4|0),c[W>>2]=0,c[N>>2]=c[W>>2],Gl(U,je,N),je=c[U>>2]|0,c[U>>2]=c[R>>2],c[R>>2]=je,je=U+4|0,W=c[je>>2]|0,c[je>>2]=c[Se>>2],c[Se>>2]=W,Rl(U),Mr(U,c[R>>2]|0,n+300|0),R=c[U>>2]|0,Se=U+4|0,W=c[Se>>2]|0,c[U>>2]=0,c[Se>>2]=0,c[N>>2]=c[ne>>2],c[ne>>2]=R,c[N+4>>2]=c[v>>2],c[v>>2]=W,Eu(N),Eu(U),v=n+328|0,W=v,W=nf(c[W>>2]|0,c[W+4>>2]|0,1,0)|0,ne=Dn()|0,c[v>>2]=W,c[v+4>>2]=ne,v=Q,c[v>>2]=0,c[v+4>>2]=0,v=c[w>>2]|0),R2[c[c[v>>2]>>2]&63](v,u)|0,ne=Q,ne=nf(c[ne>>2]|0,c[ne+4>>2]|0,1,0)|0,Se=Dn()|0,je=Q,c[je>>2]=ne,c[je+4>>2]=Se,ee=be}function Mr(n,u,v){n=n|0,u=u|0,v=v|0;var w=0,R=0,N=0,U=0;U=ee,ee=ee+64|0,w=U+56|0,R=U,N=s(v)|0,(N|0)==-1&&(U=Zn(8)|0,g(U),ir(U|0,2784,8)),v=x(v)|0;e:do if(v)T(w,u),I(c[w>>2]|0),(N|2|0)==3&&O(c[w>>2]|0),(N|1|0)==3&&z(c[w>>2]|0),N=c[w>>2]|0,q(R,v),G(N,R),J(R),c[n>>2]=c[w>>2],N=w+4|0,c[n+4>>2]=c[N>>2],c[w>>2]=0,c[N>>2]=0,re(w);else switch(N|0){case 0:{N=Pi(4788)|0,ce(N),ie(n,u,N);break e}case 1:{N=Pi(5116)|0,Me(N),_e(n,u,N);break e}case 2:{N=Pi(5104)|0,Ce(N),Pe(n,u,N);break e}case 3:{N=Pi(5432)|0,We(N),Oe(n,u,N);break e}default:{c[n>>2]=0,c[n+4>>2]=0;break e}}while(!1);ee=U}function Gl(n,u,v){n=n|0,u=u|0,v=v|0;var w=0,R=0;v=ee,ee=ee+16|0,w=v,c[n>>2]=u,R=Pi(16)|0,c[R+4>>2]=0,c[R+8>>2]=0,c[R>>2]=4576,c[R+12>>2]=u,c[n+4>>2]=R,c[w>>2]=u,c[w+4>>2]=u,Fu(n,w),ee=v}function Fu(n,u){n=n|0,u=u|0}function Nu(n){n=n|0,ma(n),Ai(n)}function kh(n){n=n|0,n=c[n+12>>2]|0,n|0&&(Un(n),Ai(n))}function hl(n,u){return n=n|0,u=u|0,((c[u+4>>2]|0)==7983?n+12|0:0)|0}function C(n){n=n|0,an(n,16)}function s(n){n=n|0;var u=0,v=0;u=(c[n+4>>2]|0)-(c[n>>2]|0)|0;e:do if((u|0)!=0&&(v=((u|0)/12|0)+(((x(n)|0)!=0)<<31>>31)|0,(v|0)!=0)&&(u=c[n>>2]|0,!(ke(u,Ge()|0)|0))){switch(v|0){case 1:{n=0;break e}case 2:{if(Xe((c[n>>2]|0)+12|0,Ue()|0)|0){n=1;break e}if(Xe((c[n>>2]|0)+12|0,et()|0)|0){n=2;break e}break}case 3:{if(Xe((c[n>>2]|0)+12|0,Ue()|0)|0&&(v=(c[n>>2]|0)+24|0,Xe(v,et()|0)|0)){n=3;break e}break}default:}n=-1}else n=-1;while(!1);return n|0}function g(n){n=n|0,Xf(n,8131),c[n>>2]=4604}function x(n){n=n|0;var u=0,v=0;return u=c[n+4>>2]|0,(u|0)!=(c[n>>2]|0)&&(v=u,(c[v+-12>>2]|0)==0)&&(c[v+-4>>2]|0)==2?n=c[v+-8>>2]|0:n=0,n|0}function T(n,u){n=n|0,u=u|0;var v=0,w=0,R=0,N=0;v=ee,ee=ee+16|0,w=v+4|0,N=v,R=Pi(24)|0,pt(R,u),c[N>>2]=0,c[w>>2]=c[N>>2],bt(n,R,w),ee=v}function I(n){n=n|0;var u=0,v=0,w=0,R=0,N=0,U=0,W=0,Q=0,ne=0,be=0;Q=ee,ee=ee+32|0,w=Q+12|0,R=Q,u=Q+8|0,U=Pi(4792)|0,Gs(U,c[n+4>>2]|0),N=n+8|0,c[u>>2]=0,c[w>>2]=c[u>>2],Xr(R,U,w),U=n+12|0,u=c[U>>2]|0,W=n+16|0;do if(u>>>0>=(c[W>>2]|0)>>>0)if(u=(u-(c[N>>2]|0)>>3)+1|0,v=Hr(N)|0,v>>>0<u>>>0)Yl(N);else{ne=c[N>>2]|0,be=(c[W>>2]|0)-ne|0,W=be>>2,Os(w,be>>3>>>0<v>>>1>>>0?W>>>0<u>>>0?u:W:v,(c[U>>2]|0)-ne>>3,n+16|0),W=w+8|0,U=c[W>>2]|0,c[U>>2]=c[R>>2],n=R+4|0,c[U+4>>2]=c[n>>2],c[R>>2]=0,c[n>>2]=0,c[W>>2]=U+8,Fs(N,w),ws(w);break}else jn(w,N,1),be=w+4|0,ne=c[be>>2]|0,c[ne>>2]=c[R>>2],W=R+4|0,c[ne+4>>2]=c[W>>2],c[R>>2]=0,c[W>>2]=0,c[be>>2]=ne+8,fr(w);while(!1);sn(R),ee=Q}function O(n){n=n|0;var u=0,v=0,w=0,R=0,N=0,U=0,W=0,Q=0,ne=0,be=0;Q=ee,ee=ee+32|0,w=Q+12|0,R=Q,u=Q+8|0,U=Pi(336)|0,sm(U,c[n+4>>2]|0),N=n+8|0,c[u>>2]=0,c[w>>2]=c[u>>2],am(R,U,w),U=n+12|0,u=c[U>>2]|0,W=n+16|0;do if(u>>>0>=(c[W>>2]|0)>>>0)if(u=(u-(c[N>>2]|0)>>3)+1|0,v=Hr(N)|0,v>>>0<u>>>0)Yl(N);else{ne=c[N>>2]|0,be=(c[W>>2]|0)-ne|0,W=be>>2,Os(w,be>>3>>>0<v>>>1>>>0?W>>>0<u>>>0?u:W:v,(c[U>>2]|0)-ne>>3,n+16|0),W=w+8|0,U=c[W>>2]|0,c[U>>2]=c[R>>2],n=R+4|0,c[U+4>>2]=c[n>>2],c[R>>2]=0,c[n>>2]=0,c[W>>2]=U+8,Fs(N,w),ws(w);break}else jn(w,N,1),be=w+4|0,ne=c[be>>2]|0,c[ne>>2]=c[R>>2],W=R+4|0,c[ne+4>>2]=c[W>>2],c[R>>2]=0,c[W>>2]=0,c[be>>2]=ne+8,fr(w);while(!1);sn(R),ee=Q}function z(n){n=n|0;var u=0,v=0,w=0,R=0,N=0,U=0,W=0,Q=0,ne=0,be=0;Q=ee,ee=ee+32|0,w=Q+12|0,R=Q,u=Q+8|0,U=Pi(324)|0,Nf(U,c[n+4>>2]|0),N=n+8|0,c[u>>2]=0,c[w>>2]=c[u>>2],lm(R,U,w),U=n+12|0,u=c[U>>2]|0,W=n+16|0;do if(u>>>0>=(c[W>>2]|0)>>>0)if(u=(u-(c[N>>2]|0)>>3)+1|0,v=Hr(N)|0,v>>>0<u>>>0)Yl(N);else{ne=c[N>>2]|0,be=(c[W>>2]|0)-ne|0,W=be>>2,Os(w,be>>3>>>0<v>>>1>>>0?W>>>0<u>>>0?u:W:v,(c[U>>2]|0)-ne>>3,n+16|0),W=w+8|0,U=c[W>>2]|0,c[U>>2]=c[R>>2],n=R+4|0,c[U+4>>2]=c[n>>2],c[R>>2]=0,c[n>>2]=0,c[W>>2]=U+8,Fs(N,w),ws(w);break}else jn(w,N,1),be=w+4|0,ne=c[be>>2]|0,c[ne>>2]=c[R>>2],W=R+4|0,c[ne+4>>2]=c[W>>2],c[R>>2]=0,c[W>>2]=0,c[be>>2]=ne+8,fr(w);while(!1);sn(R),ee=Q}function G(n,u){n=n|0,u=u|0;var v=0,w=0,R=0,N=0,U=0,W=0,Q=0,ne=0,be=0;Q=ee,ee=ee+32|0,U=Q+12|0,W=Q,w=Q+8|0,N=Pi(64)|0,B0(N,c[n+4>>2]|0,u),R=n+8|0,c[w>>2]=0,c[U>>2]=c[w>>2],z0(W,N,U),N=n+12|0,u=c[N>>2]|0,w=n+16|0;do if(u>>>0>=(c[w>>2]|0)>>>0)if(u=(u-(c[R>>2]|0)>>3)+1|0,v=Hr(R)|0,v>>>0<u>>>0)Yl(R);else{ne=c[R>>2]|0,be=(c[w>>2]|0)-ne|0,w=be>>2,Os(U,be>>3>>>0<v>>>1>>>0?w>>>0<u>>>0?u:w:v,(c[N>>2]|0)-ne>>3,n+16|0),n=U+8|0,N=c[n>>2]|0,c[N>>2]=c[W>>2],w=W+4|0,c[N+4>>2]=c[w>>2],c[W>>2]=0,c[w>>2]=0,c[n>>2]=N+8,Fs(R,U),ws(U);break}else jn(U,R,1),be=U+4|0,ne=c[be>>2]|0,c[ne>>2]=c[W>>2],n=W+4|0,c[ne+4>>2]=c[n>>2],c[W>>2]=0,c[n>>2]=0,c[be>>2]=ne+8,fr(U);while(!1);sn(W),ee=Q}function q(n,u){n=n|0,u=u|0;var v=0,w=0;v=ee,ee=ee+48|0,w=v,c[n>>2]=u,Z[n+4>>0]=0,Z0(n+8|0,u),Z0(n+20|0,u),zi(w,256,0,0),N_(n+32|0,u,w),rn(w),ee=v}function J(n){n=n|0,ju(n+32|0),Hl(n+20|0),Hl(n+8|0)}function re(n){n=n|0;var u=0,v=0;n=c[n+4>>2]|0,n|0&&(v=n+4|0,u=c[v>>2]|0,c[v>>2]=u+-1,(u|0)==0)&&(Jr[c[(c[n>>2]|0)+8>>2]&255](n),wp(n))}function ie(n,u,v){n=n|0,u=u|0,v=v|0;var w=0,R=0,N=0,U=0;w=ee,ee=ee+16|0,R=w+4|0,U=w,N=Pi(12)|0,Hs(N,u,v),c[U>>2]=0,c[R>>2]=c[U>>2],Gu(n,N,R),ee=w}function ce(n){n=n|0,Wl(n),Vh(n+4784|0)}function _e(n,u,v){n=n|0,u=u|0,v=v|0;var w=0,R=0,N=0,U=0;w=ee,ee=ee+16|0,R=w+4|0,U=w,N=Pi(12)|0,u2(N,u,v),c[U>>2]=0,c[R>>2]=c[U>>2],jh(n,N,R),ee=w}function Me(n){n=n|0,Wl(n),z_(n+4784|0)}function Pe(n,u,v){n=n|0,u=u|0,v=v|0;var w=0,R=0,N=0,U=0;w=ee,ee=ee+16|0,R=w+4|0,U=w,N=Pi(12)|0,L_(N,u,v),c[U>>2]=0,c[R>>2]=c[U>>2],U_(n,N,R),ee=w}function Ce(n){n=n|0,Wl(n),Yn(n+4784|0)}function Oe(n,u,v){n=n|0,u=u|0,v=v|0;var w=0,R=0,N=0,U=0;w=ee,ee=ee+16|0,R=w+4|0,U=w,N=Pi(12)|0,lg(N,u,v),c[U>>2]=0,c[R>>2]=c[U>>2],Gh(n,N,R),ee=w}function We(n){n=n|0,Wl(n),gl(n+4784|0)}function ke(n,u){return n=n|0,u=u|0,(Xe(n,u)|0)^1|0}function Ge(){return(Z[21456]|0)==0&&n_(21456)|0&&(Hc(21536,6,20,2),r_(21456)),21536}function Xe(n,u){return n=n|0,u=u|0,(c[n>>2]|0)==(c[u>>2]|0)&&(c[n+8>>2]|0)==(c[u+8>>2]|0)?n=(c[n+4>>2]|0)==(c[u+4>>2]|0):n=0,n|0}function Ue(){return(Z[21464]|0)==0&&n_(21464)|0&&(Hc(21548,7,8,2),r_(21464)),21548}function et(){return(Z[21472]|0)==0&&n_(21472)|0&&(Hc(21560,8,6,2),r_(21472)),21560}function At(n){n=n|0,nh(n),Ai(n)}function pt(n,u){n=n|0,u=u|0,_t(n),c[n>>2]=4624,c[n+4>>2]=u,c[n+8>>2]=0,c[n+12>>2]=0,c[n+16>>2]=0,Z[n+20>>0]=1}function bt(n,u,v){n=n|0,u=u|0,v=v|0;var w=0,R=0;v=ee,ee=ee+16|0,w=v,c[n>>2]=u,R=Pi(16)|0,c[R+4>>2]=0,c[R+8>>2]=0,c[R>>2]=4664,c[R+12>>2]=u,c[n+4>>2]=R,c[w>>2]=u,c[w+4>>2]=u,sr(n,w),ee=v}function _t(n){n=n|0,c[n>>2]=4644}function ti(n,u){n=n|0,u=u|0;var v=0,w=0,R=0,N=0,U=0,W=0,Q=0;if(Q=ee,ee=ee+16|0,N=Q,v=c[n+8>>2]|0,U=c[n+12>>2]|0,(v|0)!=(U|0)){W=N+4|0;do w=c[v>>2]|0,c[N>>2]=w,R=c[v+4>>2]|0,c[W>>2]=R,R|0&&(R=R+4|0,c[R>>2]=(c[R>>2]|0)+1),u=R2[c[(c[w>>2]|0)+12>>2]&63](w,u)|0,sn(N),v=v+8|0;while((v|0)!=(U|0))}return v=n+20|0,Z[v>>0]|0&&(Z[v>>0]=0,ku(c[n+4>>2]|0)),ee=Q,u|0}function ii(n){n=n|0,c[n>>2]=4624,rr(n+8|0),ri(n)}function Wt(n){n=n|0,ii(n),Ai(n)}function ri(n){n=n|0}function Ji(n){n=n|0,m0()}function sn(n){n=n|0;var u=0,v=0;n=c[n+4>>2]|0,n|0&&(v=n+4|0,u=c[v>>2]|0,c[v>>2]=u+-1,(u|0)==0)&&(Jr[c[(c[n>>2]|0)+8>>2]&255](n),wp(n))}function rr(n){n=n|0;var u=0,v=0,w=0;if(v=c[n>>2]|0,v|0){if(w=n+4|0,u=c[w>>2]|0,(u|0)==(v|0))u=v;else{do u=u+-8|0,sn(u);while((u|0)!=(v|0));u=c[n>>2]|0}c[w>>2]=v,an(u,(c[n+8>>2]|0)-u|0)}}function sr(n,u){n=n|0,u=u|0}function yr(n){n=n|0,ma(n),Ai(n)}function qn(n){n=n|0,n=c[n+12>>2]|0,n|0&&Jr[c[(c[n>>2]|0)+8>>2]&255](n)}function zr(n,u){return n=n|0,u=u|0,((c[u+4>>2]|0)==8546?n+12|0:0)|0}function vr(n){n=n|0,an(n,16)}function Gs(n,u){n=n|0,u=u|0,ua(n),c[n>>2]=4692,c[n+4>>2]=u,Wl(n+8|0)}function Xr(n,u,v){n=n|0,u=u|0,v=v|0;var w=0,R=0;v=ee,ee=ee+16|0,w=v,c[n>>2]=u,R=Pi(16)|0,c[R+4>>2]=0,c[R+8>>2]=0,c[R>>2]=4740,c[R+12>>2]=u,c[n+4>>2]=R,c[w>>2]=u,c[w+4>>2]=u,fl(n,w),ee=v}function jn(n,u,v){n=n|0,u=u|0,v=v|0,c[n>>2]=u,u=c[u+4>>2]|0,c[n+4>>2]=u,c[n+8>>2]=u+(v<<3)}function fr(n){n=n|0,c[(c[n>>2]|0)+4>>2]=c[n+4>>2]}function Os(n,u,v,w){n=n|0,u=u|0,v=v|0,w=w|0;var R=0;R=n+12|0,c[R>>2]=0,c[n+16>>2]=w;do if(u)if(u>>>0>536870911)R=Zn(8)|0,Tp(R,6723),c[R>>2]=5956,ir(R|0,3928,123);else{w=Pi(u<<3)|0;break}else w=0;while(!1);c[n>>2]=w,v=w+(v<<3)|0,c[n+8>>2]=v,c[n+4>>2]=v,c[R>>2]=w+(u<<3)}function Fs(n,u){n=n|0,u=u|0;var v=0,w=0,R=0,N=0,U=0,W=0,Q=0;if(W=c[n>>2]|0,Q=n+4|0,v=c[Q>>2]|0,U=u+4|0,(v|0)==(W|0))R=U,N=n,w=c[U>>2]|0,v=W;else{w=c[U>>2]|0;do N=v,v=v+-8|0,c[w+-8>>2]=c[v>>2],N=N+-4|0,c[w+-4>>2]=c[N>>2],c[v>>2]=0,c[N>>2]=0,w=(c[U>>2]|0)+-8|0,c[U>>2]=w;while((v|0)!=(W|0));R=U,N=n,v=c[n>>2]|0}c[N>>2]=w,c[R>>2]=v,W=u+8|0,U=c[Q>>2]|0,c[Q>>2]=c[W>>2],c[W>>2]=U,W=n+8|0,Q=u+12|0,n=c[W>>2]|0,c[W>>2]=c[Q>>2],c[Q>>2]=n,c[u>>2]=c[R>>2]}function ws(n){n=n|0;var u=0,v=0,w=0,R=0;if(v=c[n+4>>2]|0,w=n+8|0,u=c[w>>2]|0,(u|0)!=(v|0))do R=u+-8|0,c[w>>2]=R,sn(R),u=c[w>>2]|0;while((u|0)!=(v|0));u=c[n>>2]|0,u|0&&an(u,(c[n+12>>2]|0)-u|0)}function Hr(n){return n=n|0,536870911}function ua(n){n=n|0,c[n>>2]=4716}function Wl(n){n=n|0,gs(n),Ts(n+3980|0),Td(n+4380|0),Z[n+4780>>0]=0,Z[n+4781>>0]=0}function jo(n){n=n|0,c[n>>2]=4692,Kc(n+8|0),$r(n)}function Xa(n){n=n|0,jo(n),Ai(n)}function xo(n,u){return n=n|0,u=u|0,u|0}function Go(n,u){return n=n|0,u=u|0,xc(n+8|0,c[n+4>>2]|0,u)|0}function $r(n){n=n|0}function Xn(n){n=n|0,$r(n),Ai(n)}function ar(n,u){return n=n|0,u=u|0,u|0}function gs(n){n=n|0;var u=0,v=0;E0(n),yc(n+52|0),yc(n+436|0),zi(n+852|0,64,0,0),Z[n+3976>>0]=0,u=n+20|0,v=u+32|0;do mt[u>>1]=0,u=u+2|0;while((u|0)<(v|0));u=Pi(44)|0,zi(u,256,0,0),c[n+896>>2]=u,u=Pi(44)|0,zi(u,256,0,0),c[n+900>>2]=u,u=n+820|0,c[u>>2]=0,c[u+4>>2]=0,c[u+8>>2]=0,c[u+12>>2]=0,c[u+16>>2]=0,c[u+20>>2]=0,c[u+24>>2]=0,c[u+28>>2]=0,u=0;do v=Pi(44)|0,zi(v,256,0,0),c[n+904+(u<<2)>>2]=v,v=Pi(44)|0,zi(v,256,0,0),c[n+1928+(u<<2)>>2]=v,v=Pi(44)|0,zi(v,256,0,0),c[n+2952+(u<<2)>>2]=v,u=u+1|0;while(u>>>0<256)}function Ts(n){n=n|0,Ss(n,16,4,8,0),Ss(n+80|0,16,1,8,0),Ss(n+160|0,32,2,8,0),Ss(n+240|0,32,22,8,0),Ss(n+320|0,32,20,8,0)}function Td(n){n=n|0,ca(n,16,4,8,0),ca(n+80|0,16,1,8,0),ca(n+160|0,32,2,8,0),ca(n+240|0,32,22,8,0),ca(n+320|0,32,20,8,0)}function Sd(n){n=n|0,as(n+320|0),as(n+240|0),as(n+160|0),as(n+80|0),as(n)}function Qc(n){n=n|0;var u=0,v=0;u=c[n+896>>2]|0,u|0&&(rn(u),Ai(u)),u=c[n+900>>2]|0,u|0&&(rn(u),Ai(u)),v=0;do u=c[n+904+(v<<2)>>2]|0,u|0&&(rn(u),Ai(u)),u=c[n+1928+(v<<2)>>2]|0,u|0&&(rn(u),Ai(u)),u=c[n+2952+(v<<2)>>2]|0,u|0&&(rn(u),Ai(u)),v=v+1|0;while((v|0)!=256);rn(n+852|0)}function E0(n){n=n|0;var u=0;Z[n>>0]=0,Z[n+1>>0]=0,Z[n+2>>0]=0,Z[n+3>>0]=0,u=n+4|0,Z[u>>0]=0,Z[u+1>>0]=0,Z[u+2>>0]=0,Z[u+3>>0]=0,n=n+12|0,u=n,Z[u>>0]=0,Z[u+1>>0]=0,Z[u+2>>0]=0,Z[u+3>>0]=0,n=n+4|0,Z[n>>0]=0,Z[n+1>>0]=0,Z[n+2>>0]=0,Z[n+3>>0]=0}function yc(n){n=n|0;var u=0;u=n+384|0;do Ed(n),n=n+24|0;while((n|0)!=(u|0))}function Ed(n){n=n|0,vc(n)}function vc(n){n=n|0,c[n>>2]=0,c[n+4>>2]=0,c[n+8>>2]=0,c[n+12>>2]=0,c[n+16>>2]=0,Z[n+20>>0]=1}function Ss(n,u,v,w,R){n=n|0,u=u|0,v=v|0,w=w|0,R=R|0;var N=0;c[n+4>>2]=u,c[n+8>>2]=v,c[n+12>>2]=w,c[n+16>>2]=R,c[n+36>>2]=0,c[n+40>>2]=0,c[n+44>>2]=0,Rh(n+48|0),c[n+68>>2]=0,c[n+72>>2]=0,c[n+76>>2]=0;do if(R){for(w=n+20|0,c[w>>2]=0,c[n+24>>2]=R,v=R,N=0;v=v>>>1,u=N+1|0,v;)N=u;c[w>>2]=(1<<N|0)==(R|0)?N:u,v=R>>>1,c[n+28>>2]=0-v,v=R+-1-v|0}else if(v=n+20|0,(u+-1|0)>>>0<31){c[v>>2]=u,R=1<<u,c[n+24>>2]=R,v=R>>>1,c[n+28>>2]=0-v,v=R+-1-v|0;break}else{c[v>>2]=32,c[n+24>>2]=0,c[n+28>>2]=-2147483648,v=2147483647;break}while(!1);c[n+32>>2]=v,c[n>>2]=0}function as(n){n=n|0;var u=0,v=0,w=0,R=0,N=0;if(N=n+36|0,v=c[N>>2]|0,w=n+40|0,u=c[w>>2]|0,(u|0)!=(v|0))do u=u+-44|0,rn(u);while((u|0)!=(v|0));if(c[w>>2]=v,w=n+68|0,R=c[w>>2]|0,v=n+72|0,u=c[v>>2]|0,(u|0)!=(R|0))do u=u+-44|0,rn(u);while((u|0)!=(R|0));c[v>>2]=R,Er(w),Er(N)}function Kc(n){n=n|0,kf(n+4380|0),Sd(n+3980|0),Qc(n)}function kf(n){n=n|0,Br(n+320|0),Br(n+240|0),Br(n+160|0),Br(n+80|0),Br(n)}function xc(n,u,v){n=n|0,u=u|0,v=v|0;var w=0,R=0,N=0,U=0,W=0,Q=0,ne=0,be=0,Se=0;if(be=ee,ee=ee+32|0,ne=be,w=n+4781|0,Z[w>>0]|0||(Df(n+4380|0),Z[w>>0]=1),w=n+3976|0,Z[w>>0]|0)W=Zr(u,n+852|0)|0,W?(W&32|0&&im((Zr(u,c[n+904+(((Zs(n)|0)&255)<<2)>>2]|0)|0)&255,n),Q=n+14|0,N=Z[Q>>0]|0,w=N&7,N=(N&255)>>>3&7,R=Re[16+(N<<3)+w>>0]|0,w=Re[80+(N<<3)+w>>0]|0,W&16?(Se=n+20+(R<<1)|0,U=(Nr(n+4380|0,u,Ft[Se>>1]|0,R>>>0<3?R:3)|0)&65535,mt[Se>>1]=U):U=mt[n+20+(R<<1)>>1]|0,mt[n+12>>1]=U,W&8|0&&(Se=n+15|0,Z[Se>>0]=Zr(u,c[n+1928+(Re[Se>>0]<<2)>>2]|0)|0),W&4|0&&(Q=Zr(u,c[n+896+(((Re[Q>>0]|0)>>>6&1)<<2)>>2]|0)|0,Se=n+16|0,Z[Se>>0]=eu(Q+(Z[Se>>0]|0)|0)|0),W&2|0&&(Se=n+17|0,Z[Se>>0]=Zr(u,c[n+2952+(Re[Se>>0]<<2)>>2]|0)|0),W&1&&(Se=n+18|0,mt[Se>>1]=Nr(n+4460|0,u,Ft[Se>>1]|0,0)|0)):(Se=Z[n+14>>0]|0,w=Se&7,Se=(Se&255)>>>3&7,N=Se,R=Re[16+(Se<<3)+w>>0]|0,w=Re[80+(Se<<3)+w>>0]|0),U=n+52+(R*24|0)|0,W=n+4540|0,Q=(N|0)==1&1,N=Nr(W,u,Xp(U)|0,Q)|0,c[ne>>2]=N,c[n>>2]=(c[n>>2]|0)+N,Hp(U,ne),U=n+436+(R*24|0)|0,N=Xp(U)|0,R=Zl(W)|0,Se=n+4620|0,R=Nr(Se,u,N,(R>>>0<20?R&-2:20)|Q)|0,c[ne>>2]=R,N=n+4|0,c[N>>2]=(c[N>>2]|0)+R,Hp(U,ne),ne=Zl(W)|0,ne=(Zl(Se)|0)+ne|0,Se=n+820+(w<<2)|0,ne=Nr(n+4700|0,u,c[Se>>2]|0,(ne>>>0<36?ne>>>1&2147483646:18)|Q)|0,c[n+8>>2]=ne,c[Se>>2]=ne,k_(n,v);else{Z[w>>0]=1,Ff(Of(u)|0,v,20),Ws(ne,v),N=n,w=ne,R=N+20|0;do Z[N>>0]=Z[w>>0]|0,N=N+1|0,w=w+1|0;while((N|0)<(R|0));mt[n+12>>1]=0}return ee=be,v+20|0}function Df(n){n=n|0,ss(n),ss(n+80|0),ss(n+160|0),ss(n+240|0),ss(n+320|0)}function Of(n){return n=n|0,c[n>>2]|0}function Ff(n,u,v){n=n|0,u=u|0,v=v|0;var w=0,R=0,N=0,U=0,W=0,Q=0;if(Q=n+4|0,w=c[Q>>2]|0,W=(c[n+8>>2]|0)-w|0,W=W>>>0>v>>>0?v:W,U=n+12|0,R=(c[U>>2]|0)+w|0,N=R+W|0,W){for(w=R,R=u;Z[R>>0]=Z[w>>0]|0,w=w+1|0,(w|0)!=(N|0);)R=R+1|0;w=c[Q>>2]|0}if(c[Q>>2]=w+W,v=v-W|0,v|0){for(Ch(n),R=(c[U>>2]|0)+(c[Q>>2]|0)|0,N=R+v|0,w=u+W|0;Z[w>>0]=Z[R>>0]|0,R=R+1|0,(R|0)!=(N|0);)w=w+1|0;c[Q>>2]=(c[Q>>2]|0)+v}}function Ws(n,u){n=n|0,u=u|0,E0(n),c[n>>2]=Xl(u)|0,c[n+4>>2]=Xl(u+4|0)|0,c[n+8>>2]=Xl(u+8|0)|0,mt[n+12>>1]=bc(u+12|0)|0,im(Md(u+14|0)|0,n),Z[n+15>>0]=Md(u+15|0)|0,Z[n+16>>0]=M0(u+16|0)|0,Z[n+17>>0]=M0(u+17|0)|0,mt[n+18>>1]=bc(u+18|0)|0}function Zs(n){return n=n|0,Z[n+14>>0]|0}function im(n,u){n=n|0,u=u|0,Z[u+14>>0]=n}function eu(n){return n=n|0,n&255|0}function Xp(n){return n=n|0,c[n+8>>2]|0}function Hp(n,u){n=n|0,u=u|0;var v=0,w=0,R=0,N=0,U=0,W=0,Q=0;Q=n+20|0;do if(Z[Q>>0]|0){if(R=c[u>>2]|0,U=n+8|0,v=c[U>>2]|0,N=n+12|0,w=c[N>>2]|0,(R|0)>=(v|0)){v=n+16|0,(R|0)<(w|0)?(c[v>>2]=w,c[N>>2]=c[u>>2]):c[v>>2]=R,Z[Q>>0]=0;break}if(c[n+16>>2]=w,c[N>>2]=v,v=c[u>>2]|0,w=c[n>>2]|0,R=n+4|0,N=c[R>>2]|0,(v|0)<(w|0)){c[U>>2]=N,c[R>>2]=w,c[n>>2]=c[u>>2];break}if((v|0)<(N|0)){c[U>>2]=N,c[R>>2]=c[u>>2];break}else{c[U>>2]=v;break}}else{if(W=n+8|0,v=c[W>>2]|0,w=c[u>>2]|0,R=n+4|0,N=c[R>>2]|0,(v|0)>=(w|0)){(N|0)<(w|0)?(c[n>>2]=N,c[R>>2]=c[u>>2]):c[n>>2]=w,Z[Q>>0]=1;break}if(c[n>>2]=N,c[R>>2]=v,R=n+16|0,N=c[R>>2]|0,U=c[u>>2]|0,v=n+12|0,w=c[v>>2]|0,(N|0)<(U|0)){c[W>>2]=w,c[v>>2]=N,c[R>>2]=c[u>>2];break}if((w|0)<(U|0)){c[W>>2]=w,c[v>>2]=c[u>>2];break}else{c[W>>2]=U;break}}while(!1)}function Zl(n){return n=n|0,c[n>>2]|0}function k_(n,u){n=n|0,u=u|0;var v=0;R0(Re[n>>0]|Re[n+1>>0]<<8|Re[n+2>>0]<<16|Re[n+3>>0]<<24,u),v=n+4|0,R0(Re[v>>0]|Re[v+1>>0]<<8|Re[v+2>>0]<<16|Re[v+3>>0]<<24,u+4|0),v=n+8|0,R0(Re[v>>0]|Re[v+1>>0]<<8|Re[v+2>>0]<<16|Re[v+3>>0]<<24,u+8|0),v=n+12|0,Dh(Re[v>>0]|Re[v+1>>0]<<8,u+12|0),$p(Zs(n)|0,u+14|0),$p(Z[n+15>>0]|0,u+15|0),C0(Z[n+16>>0]|0,u+16|0),C0(Z[n+17>>0]|0,u+17|0),n=n+18|0,Dh(Re[n>>0]|Re[n+1>>0]<<8,u+18|0)}function Xl(n){return n=n|0,Rd(n)|0}function bc(n){return n=n|0,(Z[n+1>>0]<<8|Re[n>>0])&65535|0}function Md(n){return n=n|0,Z[n>>0]|0}function M0(n){return n=n|0,Z[n>>0]|0}function Rd(n){return n=n|0,(Re[n+1>>0]|0)<<8|(Re[n>>0]|0)|(Re[n+2>>0]|0)<<16|(Re[n+3>>0]|0)<<24|0}function R0(n,u){n=n|0,u=u|0,Oh(n,u)}function Dh(n,u){n=n|0,u=u|0,Z[u+1>>0]=(n&65535)>>>8,Z[u>>0]=n}function $p(n,u){n=n|0,u=u|0,Z[u>>0]=n}function C0(n,u){n=n|0,u=u|0,Z[u>>0]=n}function Oh(n,u){n=n|0,u=u|0,Z[u+3>>0]=n>>>24,Z[u+2>>0]=n>>>16,Z[u+1>>0]=n>>>8,Z[u>>0]=n}function fl(n,u){n=n|0,u=u|0}function nm(n){n=n|0,ma(n),Ai(n)}function rm(n){n=n|0,n=c[n+12>>2]|0,n|0&&Jr[c[(c[n>>2]|0)+4>>2]&255](n)}function qp(n,u){return n=n|0,u=u|0,((c[u+4>>2]|0)==9202?n+12|0:0)|0}function Yp(n){n=n|0,an(n,16)}function sm(n,u){n=n|0,u=u|0,ua(n),c[n>>2]=4768,c[n+4>>2]=u,Cd(n+8|0)}function am(n,u,v){n=n|0,u=u|0,v=v|0;var w=0,R=0;v=ee,ee=ee+16|0,w=v,c[n>>2]=u,R=Pi(16)|0,c[R+4>>2]=0,c[R+8>>2]=0,c[R>>2]=4792,c[R+12>>2]=u,c[n+4>>2]=R,c[w>>2]=u,c[w+4>>2]=u,fl(n,w),ee=v}function Cd(n){n=n|0,Ha(n),tu(n+164|0),k0(n+244|0),Z[n+324>>0]=0,Z[n+325>>0]=0}function Ac(n){n=n|0,c[n>>2]=4768,Jp(n+8|0),$r(n)}function P0(n){n=n|0,Ac(n),Ai(n)}function I0(n,u){return n=n|0,u=u|0,Fh(n+8|0,c[n+4>>2]|0,u)|0}function Ha(n){n=n|0;var u=0,v=0,w=0,R=0,N=0,U=0,W=0;for(N=ee,ee=ee+16|0,w=N,Z[n>>0]=0,zi(n+4|0,516,0,0),zi(n+48|0,6,0,0),c[n+92>>2]=0,c[n+96>>2]=0,v=n+100|0,O0(v),Lr(w),R=c[w>>2]|0,w=c[w+4>>2]|0,u=4;U=v,W=U,Z[W>>0]=R,Z[W+1>>0]=R>>8,Z[W+2>>0]=R>>16,Z[W+3>>0]=R>>24,U=U+4|0,Z[U>>0]=w,Z[U+1>>0]=w>>8,Z[U+2>>0]=w>>16,Z[U+3>>0]=w>>24,u=u+-1|0,u;)v=v+8|0;W=n+132|0,c[W>>2]=0,c[W+4>>2]=0,c[W+8>>2]=0,c[W+12>>2]=0,c[W+16>>2]=0,c[W+20>>2]=0,c[W+24>>2]=0,c[W+28>>2]=0,ee=N}function tu(n){n=n|0,Ss(n,32,9,8,0)}function k0(n){n=n|0,ca(n,32,9,8,0)}function D_(n){n=n|0,as(n)}function D0(n){n=n|0,rn(n+48|0),rn(n+4|0)}function O0(n){n=n|0;var u=0;u=n+32|0;do Lr(n),n=n+8|0;while((n|0)!=(u|0))}function Lr(n){n=n|0;var u=0;u=n,Z[u>>0]=0,Z[u+1>>0]=0,Z[u+2>>0]=0,Z[u+3>>0]=0,n=n+4|0,Z[n>>0]=0,Z[n+1>>0]=0,Z[n+2>>0]=0,Z[n+3>>0]=0}function Jp(n){n=n|0,o2(n+244|0),D_(n+164|0),D0(n)}function o2(n){n=n|0,Br(n)}function Fh(n,u,v){n=n|0,u=u|0,v=v|0;var w=0,R=0,N=0,U=0,W=0;if(w=n+325|0,Z[w>>0]|0||(Pd(n+244|0),Z[w>>0]=1),!(Z[n>>0]|0))Z[n>>0]=1,Ff(Of(u)|0,v,8),N=Bu(v)|0,U=Dn()|0,n=n+100|0,u=n,Z[u>>0]=N,Z[u+1>>0]=N>>8,Z[u+2>>0]=N>>16,Z[u+3>>0]=N>>24,n=n+4|0,Z[n>>0]=U,Z[n+1>>0]=U>>8,Z[n+2>>0]=U>>16,Z[n+3>>0]=U>>24;else{U=n+92|0;e:do if(c[n+132+(c[U>>2]<<2)>>2]|0){if(N=Zr(u,n+4|0)|0,(N|0)==1){w=Nr(n+244|0,u,c[n+132+(c[U>>2]<<2)>>2]|0,1)|0,W=c[U>>2]|0,u=n+100+(W<<3)|0,N=u,R=N,N=N+4|0,w=nf(Re[R>>0]|Re[R+1>>0]<<8|Re[R+2>>0]<<16|Re[R+3>>0]<<24|0,Re[N>>0]|Re[N+1>>0]<<8|Re[N+2>>0]<<16|Re[N+3>>0]<<24|0,w|0,((w|0)<0)<<31>>31|0)|0,N=Dn()|0,R=u,Z[R>>0]=w,Z[R+1>>0]=w>>8,Z[R+2>>0]=w>>16,Z[R+3>>0]=w>>24,u=u+4|0,Z[u>>0]=N,Z[u+1>>0]=N>>8,Z[u+2>>0]=N>>16,Z[u+3>>0]=N>>24,c[n+148+(W<<2)>>2]=0;break}if((N|0)>=511){if((N|0)==512){W=n+96|0,c[W>>2]=(c[W>>2]|0)+1&3,N=n+100+(c[U>>2]<<3)+4|0,N=Nr(n+244|0,u,Re[N>>0]|Re[N+1>>0]<<8|Re[N+2>>0]<<16|Re[N+3>>0]<<24,8)|0,w=n+100+(c[W>>2]<<3)|0,R=w,Z[R>>0]=0,Z[R+1>>0]=0,Z[R+2>>0]=0,Z[R+3>>0]=0,w=w+4|0,Z[w>>0]=N,Z[w+1>>0]=N>>8,Z[w+2>>0]=N>>16,Z[w+3>>0]=N>>24,w=om(u)|0,W=c[W>>2]|0,u=n+100+(W<<3)|0,N=u,R=N,N=N+4|0,N=Re[N>>0]|Re[N+1>>0]<<8|Re[N+2>>0]<<16|Re[N+3>>0]<<24,w=Re[R>>0]|Re[R+1>>0]<<8|Re[R+2>>0]<<16|Re[R+3>>0]<<24|w,R=u,Z[R>>0]=w,Z[R+1>>0]=w>>8,Z[R+2>>0]=w>>16,Z[R+3>>0]=w>>24,u=u+4|0,Z[u>>0]=N,Z[u+1>>0]=N>>8,Z[u+2>>0]=N>>16,Z[u+3>>0]=N>>24,c[U>>2]=W,c[n+132+(W<<2)>>2]=0,c[n+148+(c[U>>2]<<2)>>2]=0;break}if((N|0)<=511)break;c[U>>2]=(c[U>>2]|0)+N&3,Fh(n,u,v)|0;break}do if(!N)w=Nr(n+244|0,u,0,7)|0,R=n+148+(c[U>>2]<<2)|0,c[R>>2]=(c[R>>2]|0)+1,R=c[U>>2]|0,(c[n+148+(R<<2)>>2]|0)>3&&(c[n+132+(R<<2)>>2]=w,c[n+148+(c[U>>2]<<2)>>2]=0);else{if((N|0)<500)if(w=n+244|0,R=pn(c[n+132+(c[U>>2]<<2)>>2]|0,N)|0,(N|0)<10){w=Nr(w,u,R,2)|0;break}else{w=Nr(w,u,R,3)|0;break}if((N|0)==500){if(w=Nr(n+244|0,u,(c[n+132+(c[U>>2]<<2)>>2]|0)*500|0,4)|0,R=n+148+(c[U>>2]<<2)|0,c[R>>2]=(c[R>>2]|0)+1,R=c[U>>2]|0,(c[n+148+(R<<2)>>2]|0)<=3)break;c[n+132+(R<<2)>>2]=w,c[n+148+(c[U>>2]<<2)>>2]=0;break}if(w=500-N|0,R=n+244|0,N=c[n+132+(c[U>>2]<<2)>>2]|0,(w|0)>-10){w=Nr(R,u,pn(N,w)|0,5)|0;break}w=Nr(R,u,pn(N,-10)|0,6)|0,R=n+148+(c[U>>2]<<2)|0,c[R>>2]=(c[R>>2]|0)+1,R=c[U>>2]|0,(c[n+148+(R<<2)>>2]|0)>3&&(c[n+132+(R<<2)>>2]=w,c[n+148+(c[U>>2]<<2)>>2]=0)}while(!1);W=n+100+(c[U>>2]<<3)|0,R=W,u=R,R=R+4|0,R=nf(Re[u>>0]|Re[u+1>>0]<<8|Re[u+2>>0]<<16|Re[u+3>>0]<<24|0,Re[R>>0]|Re[R+1>>0]<<8|Re[R+2>>0]<<16|Re[R+3>>0]<<24|0,w|0,((w|0)<0)<<31>>31|0)|0,u=Dn()|0,N=W,Z[N>>0]=R,Z[N+1>>0]=R>>8,Z[N+2>>0]=R>>16,Z[N+3>>0]=R>>24,W=W+4|0,Z[W>>0]=u,Z[W+1>>0]=u>>8,Z[W+2>>0]=u>>16,Z[W+3>>0]=u>>24}else switch(w=Zr(u,n+48|0)|0,w|0){case 1:{u=Nr(n+244|0,u,0,0)|0,c[n+132+(c[U>>2]<<2)>>2]=u,u=c[U>>2]|0,W=c[n+132+(u<<2)>>2]|0,N=n+100+(u<<3)|0,R=N,w=R,R=R+4|0,W=nf(Re[w>>0]|Re[w+1>>0]<<8|Re[w+2>>0]<<16|Re[w+3>>0]<<24|0,Re[R>>0]|Re[R+1>>0]<<8|Re[R+2>>0]<<16|Re[R+3>>0]<<24|0,W|0,((W|0)<0)<<31>>31|0)|0,R=Dn()|0,w=N,Z[w>>0]=W,Z[w+1>>0]=W>>8,Z[w+2>>0]=W>>16,Z[w+3>>0]=W>>24,N=N+4|0,Z[N>>0]=R,Z[N+1>>0]=R>>8,Z[N+2>>0]=R>>16,Z[N+3>>0]=R>>24,c[n+148+(u<<2)>>2]=0;break e}case 2:{W=n+96|0,c[W>>2]=(c[W>>2]|0)+1&3,N=n+100+(c[U>>2]<<3)+4|0,N=Nr(n+244|0,u,Re[N>>0]|Re[N+1>>0]<<8|Re[N+2>>0]<<16|Re[N+3>>0]<<24,8)|0,w=n+100+(c[W>>2]<<3)|0,R=w,Z[R>>0]=0,Z[R+1>>0]=0,Z[R+2>>0]=0,Z[R+3>>0]=0,w=w+4|0,Z[w>>0]=N,Z[w+1>>0]=N>>8,Z[w+2>>0]=N>>16,Z[w+3>>0]=N>>24,w=om(u)|0,W=c[W>>2]|0,u=n+100+(W<<3)|0,N=u,R=N,N=N+4|0,N=Re[N>>0]|Re[N+1>>0]<<8|Re[N+2>>0]<<16|Re[N+3>>0]<<24,w=Re[R>>0]|Re[R+1>>0]<<8|Re[R+2>>0]<<16|Re[R+3>>0]<<24|w,R=u,Z[R>>0]=w,Z[R+1>>0]=w>>8,Z[R+2>>0]=w>>16,Z[R+3>>0]=w>>24,u=u+4|0,Z[u>>0]=N,Z[u+1>>0]=N>>8,Z[u+2>>0]=N>>16,Z[u+3>>0]=N>>24,c[U>>2]=W,c[n+132+(W<<2)>>2]=0,c[n+148+(c[U>>2]<<2)>>2]=0;break e}default:{if((w|0)<=2)break e;c[U>>2]=w+2+(c[U>>2]|0)&3,Fh(n,u,v)|0;break e}}while(!1);O_(n+100+(c[U>>2]<<3)|0,v)}return v+8|0}function Pd(n){n=n|0,ss(n)}function Bu(n){n=n|0;var u=0,v=0,w=0;return u=ee,ee=ee+16|0,v=u,w=Rd(n)|0,F0(v,w,Rd(n+4|0)|0),n=c[v>>2]|0,Ln(c[v+4>>2]|0),ee=u,n|0}function om(n){n=n|0;var u=0;return u=(Vl(n)|0)&65535,((Vl(n)|0)&65535)<<16|u|0}function O_(n,u){n=n|0,u=u|0;var v=0;v=n,Oh(Re[v>>0]|Re[v+1>>0]<<8|Re[v+2>>0]<<16|Re[v+3>>0]<<24,u),n=n+4|0,Oh(Re[n>>0]|Re[n+1>>0]<<8|Re[n+2>>0]<<16|Re[n+3>>0]<<24,u+4|0)}function F0(n,u,v){n=n|0,u=u|0,v=v|0;var w=0;w=n,Z[w>>0]=u,Z[w+1>>0]=u>>8,Z[w+2>>0]=u>>16,Z[w+3>>0]=u>>24,u=n+4|0,Z[u>>0]=v,Z[u+1>>0]=v>>8,Z[u+2>>0]=v>>16,Z[u+3>>0]=v>>24}function dl(n){n=n|0,ma(n),Ai(n)}function Qp(n){n=n|0,n=c[n+12>>2]|0,n|0&&Jr[c[(c[n>>2]|0)+4>>2]&255](n)}function Kp(n,u){return n=n|0,u=u|0,((c[u+4>>2]|0)==9890?n+12|0:0)|0}function Nh(n){n=n|0,an(n,16)}function Nf(n,u){n=n|0,u=u|0,ua(n),c[n>>2]=4820,c[n+4>>2]=u,N0(n+8|0)}function lm(n,u,v){n=n|0,u=u|0,v=v|0;var w=0,R=0;v=ee,ee=ee+16|0,w=v,c[n>>2]=u,R=Pi(16)|0,c[R+4>>2]=0,c[R+8>>2]=0,c[R>>2]=4844,c[R+12>>2]=u,c[n+4>>2]=R,c[w>>2]=u,c[w+4>>2]=u,fl(n,w),ee=v}function N0(n){n=n|0,Z[n>>0]=0,eg(n+1|0),zi(n+8|0,128,0,0),zi(n+52|0,256,0,0),zi(n+96|0,256,0,0),zi(n+140|0,256,0,0),zi(n+184|0,256,0,0),zi(n+228|0,256,0,0),zi(n+272|0,256,0,0)}function cm(n){n=n|0,c[n>>2]=4820,um(n+8|0),$r(n)}function zu(n){n=n|0,cm(n),Ai(n)}function Xs(n,u){return n=n|0,u=u|0,Ns(n+8|0,c[n+4>>2]|0,u)|0}function eg(n){n=n|0;var u=0;Z[n>>0]=0,Z[n+1>>0]=0,u=n+2|0,Z[u>>0]=0,Z[u+1>>0]=0,n=n+4|0,Z[n>>0]=0,Z[n+1>>0]=0}function um(n){n=n|0,rn(n+272|0),rn(n+228|0),rn(n+184|0),rn(n+140|0),rn(n+96|0),rn(n+52|0),rn(n+8|0)}function Ns(n,u,v){n=n|0,u=u|0,v=v|0;var w=0,R=0,N=0,U=0,W=0,Q=0,ne=0,be=0,Se=0;if(be=ee,ee=ee+16|0,Q=be,!(Z[n>>0]|0))Z[n>>0]=1,Ff(Of(u)|0,v,6),l2(Q,v),ne=n+1|0,Z[ne>>0]=Z[Q>>0]|0,Z[ne+1>>0]=Z[Q+1>>0]|0,Z[ne+2>>0]=Z[Q+2>>0]|0,Z[ne+3>>0]=Z[Q+3>>0]|0,Z[ne+4>>0]=Z[Q+4>>0]|0,Z[ne+5>>0]=Z[Q+5>>0]|0;else{ne=Zr(u,n+8|0)|0,eg(Q),ne&1?(W=(Zr(u,n+52|0)|0)&255,w=n+1|0,w=(eu(W+((Re[w>>0]|Re[w+1>>0]<<8)&255)|0)|0)&255):(w=n+1|0,w=(Re[w>>0]|Re[w+1>>0]<<8)&255),mt[Q>>1]=w,ne&2?(w=(Zr(u,n+96|0)|0)&255,W=n+1|0,w=((eu((((Re[W>>0]|Re[W+1>>0]<<8)&65535)>>>8)+w|0)|0)&255)<<8,w=(w|Ft[Q>>1])&65535):(W=n+1|0,w=w|(Re[W>>0]|Re[W+1>>0]<<8)&-256),mt[Q>>1]=w;do if(ne&64)if(U=n+1|0,R=(w&255)-((Re[U>>0]|Re[U+1>>0]<<8)&255)|0,ne&4?(w=(Zr(u,n+140|0)|0)&255,W=n+3|0,W=R+((Re[W>>0]|Re[W+1>>0]<<8)&255)|0,w=(eu(((W|0)<1?0:(W|0)>254?255:W&255)+w|0)|0)&255):(w=n+3|0,w=(Re[w>>0]|Re[w+1>>0]<<8)&255),W=Q+2|0,mt[W>>1]=w,ne&16?(w=Zr(u,n+228|0)|0,Se=n+3|0,N=n+5|0,N=((R+(mt[W>>1]&255)-((Re[Se>>0]|Re[Se+1>>0]<<8)&255)|0)/2|0)+((Re[N>>0]|Re[N+1>>0]<<8)&255)|0,w=(eu(((N|0)<1?0:(N|0)>254?255:N&255)+(w&255)|0)|0)&255):(w=n+5|0,w=(Re[w>>0]|Re[w+1>>0]<<8)&255),N=Q+4|0,mt[N>>1]=w,w=((Ft[Q>>1]|0)>>>8)-(((Re[U>>0]|Re[U+1>>0]<<8)&65535)>>>8)|0,ne&8?(R=(Zr(u,n+184|0)|0)&255,Se=n+3|0,Se=(((Re[Se>>0]|Re[Se+1>>0]<<8)&65535)>>>8)+w|0,R=((eu(((Se|0)<1?0:(Se|0)>254?255:Se&255)+R|0)|0)&255)<<8,R=(R|Ft[W>>1])&65535):(R=n+3|0,R=mt[W>>1]|(Re[R>>0]|Re[R+1>>0]<<8)&-256),mt[W>>1]=R,ne&32){Se=Zr(u,n+272|0)|0,u=n+3|0,ne=n+5|0,ne=((((Ft[W>>1]|0)>>>8)+w-(((Re[u>>0]|Re[u+1>>0]<<8)&65535)>>>8)|0)/2|0)+(((Re[ne>>0]|Re[ne+1>>0]<<8)&65535)>>>8)|0,Se=((eu(((ne|0)<1?0:(ne|0)>254?255:ne&255)+(Se&255)|0)|0)&255)<<8,mt[N>>1]=Se|Ft[N>>1];break}else{Se=n+5|0,mt[N>>1]=mt[N>>1]|(Re[Se>>0]|Re[Se+1>>0]<<8)&-256;break}else mt[Q+2>>1]=w,mt[Q+4>>1]=w;while(!1);Se=n+1|0,Z[Se>>0]=Z[Q>>0]|0,Z[Se+1>>0]=Z[Q+1>>0]|0,Z[Se+2>>0]=Z[Q+2>>0]|0,Z[Se+3>>0]=Z[Q+3>>0]|0,Z[Se+4>>0]=Z[Q+4>>0]|0,Z[Se+5>>0]=Z[Q+5>>0]|0,hm(Se,v)}return ee=be,v+6|0}function l2(n,u){n=n|0,u=u|0;var v=0,w=0;w=bc(u)|0,v=bc(u+2|0)|0,Id(n,w,v,bc(u+4|0)|0)}function hm(n,u){n=n|0,u=u|0;var v=0;Dh(Re[n>>0]|Re[n+1>>0]<<8,u),v=n+2|0,Dh(Re[v>>0]|Re[v+1>>0]<<8,u+2|0),n=n+4|0,Dh(Re[n>>0]|Re[n+1>>0]<<8,u+4|0)}function Id(n,u,v,w){n=n|0,u=u|0,v=v|0,w=w|0,Z[n>>0]=u,Z[n+1>>0]=u>>8,u=n+2|0,Z[u>>0]=v,Z[u+1>>0]=v>>8,v=n+4|0,Z[v>>0]=w,Z[v+1>>0]=w>>8}function os(n){n=n|0,ma(n),Ai(n)}function Fn(n){n=n|0,n=c[n+12>>2]|0,n|0&&Jr[c[(c[n>>2]|0)+4>>2]&255](n)}function Wo(n,u){return n=n|0,u=u|0,((c[u+4>>2]|0)==10570?n+12|0:0)|0}function fm(n){n=n|0,an(n,16)}function B0(n,u,v){n=n|0,u=u|0,v=v|0,ua(n),c[n>>2]=4872,c[n+4>>2]=u,L0(n+8|0,v)}function z0(n,u,v){n=n|0,u=u|0,v=v|0;var w=0,R=0;v=ee,ee=ee+16|0,w=v,c[n>>2]=u,R=Pi(16)|0,c[R+4>>2]=0,c[R+8>>2]=0,c[R>>2]=4896,c[R+12>>2]=u,c[n+4>>2]=R,c[w>>2]=u,c[w+4>>2]=u,fl(n,w),ee=v}function L0(n,u){n=n|0,u=u|0,c[n>>2]=c[u>>2],Z[n+4>>0]=Z[u+4>>0]|0,U0(n+8|0,u+8|0),U0(n+20|0,u+20|0),ta(n+32|0,u+32|0)}function kd(n){n=n|0,c[n>>2]=4872,J(n+8|0),$r(n)}function bo(n){n=n|0,kd(n),Ai(n)}function Ao(n,u){return n=n|0,u=u|0,mm(n+8|0,c[n+4>>2]|0,u)|0}function U0(n,u){n=n|0,u=u|0;var v=0,w=0;c[n>>2]=0,c[n+4>>2]=0,c[n+8>>2]=0,v=u+4|0,w=(c[v>>2]|0)-(c[u>>2]|0)|0,w|0&&(Dd(n,w),Zo(n,c[u>>2]|0,c[v>>2]|0,w))}function ta(n,u){n=n|0,u=u|0;var v=0,w=0,R=0,N=0,U=0;v=ee,ee=ee+32|0,w=v+24|0,R=v+16|0,U=v+8|0,N=v,c[n>>2]=0,c[n+4>>2]=0,c[n+8>>2]=0,c[n+12>>2]=0,c[n+16>>2]=0,c[n+20>>2]=0,Uu(U,u),ms(N,u),c[R>>2]=c[U>>2],c[R+4>>2]=c[U+4>>2],c[w>>2]=c[N>>2],c[w+4>>2]=c[N+4>>2],wc(n,R,w,0),ee=v}function Dd(n,u){n=n|0,u=u|0;var v=0;if((Lu(n)|0)>>>0<u>>>0)Yl(n);else{v=Pi(u)|0,c[n+4>>2]=v,c[n>>2]=v,c[n+8>>2]=v+u;return}}function Zo(n,u,v,w){n=n|0,u=u|0,v=v|0,w=w|0;var R=0,N=0;N=ee,ee=ee+16|0,R=N,V0(R,n,w),w=R+4|0,n=v-u|0,(n|0)>0&&(rh(c[w>>2]|0,u|0,n|0)|0,c[w>>2]=(c[w>>2]|0)+n),iu(R),ee=N}function Hl(n){n=n|0;var u=0,v=0;u=c[n>>2]|0,v=u,u|0&&(c[n+4>>2]=v,an(u,(c[n+8>>2]|0)-v|0))}function Lu(n){return n=n|0,2147483647}function V0(n,u,v){n=n|0,u=u|0,v=v|0,c[n>>2]=u,u=c[u+4>>2]|0,c[n+4>>2]=u,c[n+8>>2]=u+v}function iu(n){n=n|0,c[(c[n>>2]|0)+4>>2]=c[n+4>>2]}function wc(n,u,v,w){n=n|0,u=u|0,v=v|0,w=w|0;var R=0,N=0,U=0,W=0,Q=0,ne=0,be=0,Se=0,je=0,ct=0,vt=0,ot=0;if(ot=ee,ee=ee+96|0,vt=ot+80|0,Se=ot+64|0,Q=ot+48|0,ne=ot+40|0,be=ot+8|0,W=ot,je=ot+32|0,ct=ot+16|0,U=u,N=c[U>>2]|0,U=c[U+4>>2]|0,R=v,v=c[R>>2]|0,R=c[R+4>>2]|0,w=N,(R|0)==(U|0)?U=0:U=((R-(c[v>>2]|0)|0)/44|0)+((v-N>>2)*93|0)+((U-(c[N>>2]|0)|0)/-44|0)|0,v=(c[n+8>>2]|0)-(c[n+4>>2]|0)|0,v=((v|0)==0?0:((v>>2)*93|0)+-1|0)-((c[n+20>>2]|0)+(c[n+16>>2]|0))|0,U>>>0>v>>>0&&Tc(n,U-v|0),Sc(ne,n),Sc(W,n),R=W,v=c[R>>2]|0,R=c[R+4>>2]|0,N=be,c[N>>2]=v,c[N+4>>2]=R,N=v,U|0&&(v=((R-(c[v>>2]|0)|0)/44|0)+U|0,(v|0)>0?(W=(v>>>0)/93|0,U=N+(W<<2)|0,c[be>>2]=U,v=(c[U>>2]|0)+((v-(W*93|0)|0)*44|0)|0):(v=92-v|0,W=N+(((v|0)/-93|0)<<2)|0,c[be>>2]=W,v=(c[W>>2]|0)+((92-((v|0)%93|0)|0)*44|0)|0),c[be+4>>2]=v),c[Se>>2]=c[ne>>2],c[Se+4>>2]=c[ne+4>>2],c[vt>>2]=c[be>>2],c[vt+4>>2]=c[be+4>>2],Bh(Q,Se,vt),zh(vt,Q),pm(Se,Q),j0(vt,Se)|0){N=ct+4|0,U=u+4|0;do{if(Od(je,vt),gm(ct,n,je),v=c[ct>>2]|0,(v|0)!=(c[N>>2]|0)){R=c[U>>2]|0;do lr(v,R),v=(c[ct>>2]|0)+44|0,c[ct>>2]=v,R=R+44|0,c[U>>2]=R,(R-(c[w>>2]|0)|0)==4092&&(w=w+4|0,c[u>>2]=w,R=c[w>>2]|0,c[U>>2]=R);while((v|0)!=(c[N>>2]|0))}G0(ct),Bf(vt)|0}while(j0(vt,Se)|0)}ee=ot}function dm(n){n=n|0;var u=0,v=0,w=0;u=c[n+4>>2]|0,v=n+8|0,w=c[v>>2]|0,(w|0)!=(u|0)&&(c[v>>2]=w+(~((w+-4-u|0)>>>2)<<2)),u=c[n>>2]|0,u|0&&an(u,(c[n+12>>2]|0)-u|0)}function Tc(n,u){n=n|0,u=u|0;var v=0,w=0,R=0,N=0,U=0,W=0,Q=0,ne=0,be=0,Se=0,je=0,ct=0,vt=0,ot=0,nn=0,ui=0,Jt=0,Di=0,Mt=0,pr=0,zs=0,gr=0,Cn=0,vs=0,ln=0;vs=ee,ee=ee+64|0,Di=vs+52|0,Jt=vs+48|0,Mt=vs+28|0,pr=vs+24|0,zs=vs+20|0,vt=vs,gr=n+8|0,v=c[gr>>2]|0,Cn=n+4|0,Q=c[Cn>>2]|0,nn=((v|0)==(Q|0)&1)+u|0,U=(nn>>>0)/93|0,U=U+((nn-(U*93|0)|0)!=0&1)|0,nn=n+16|0,w=c[nn>>2]|0,W=(w>>>0)/93|0,ot=U>>>0<W>>>0?U:W,u=U-ot|0,N=v;e:do if(u)if(ui=n+12|0,w=c[ui>>2]|0,R=w-(c[n>>2]|0)|0,v=N-Q>>2,u>>>0>((R>>2)-v|0)>>>0){ct=R>>1,je=v+u|0,Rn(vt,ct>>>0<je>>>0?je:ct,v-ot|0,n+12|0);do c[Di>>2]=Pi(4092)|0,Rr(vt,Di),u=u+-1|0;while((u|0)!=0);if(!ot)v=c[Cn>>2]|0;else{W=vt+8|0,Q=vt+12|0,ne=vt+4|0,be=vt+16|0,Se=Mt+4|0,je=Mt+8|0,ct=Mt+12|0,U=ot,u=c[W>>2]|0,v=c[Cn>>2]|0;do{N=c[Q>>2]|0,w=N;do if((u|0)==(N|0)){if(R=c[ne>>2]|0,N=c[vt>>2]|0,u=N,R>>>0<=N>>>0){u=w-u|0,u=(u|0)==0?1:u>>1,Rn(Mt,u,u>>>2,c[be>>2]|0),c[pr>>2]=c[ne>>2],c[zs>>2]=c[W>>2],c[Jt>>2]=c[pr>>2],c[Di>>2]=c[zs>>2],zn(Mt,Jt,Di),u=c[vt>>2]|0,c[vt>>2]=c[Mt>>2],c[Mt>>2]=u,u=c[ne>>2]|0,c[ne>>2]=c[Se>>2],c[Se>>2]=u,u=c[W>>2]|0,c[W>>2]=c[je>>2],c[je>>2]=u,u=c[Q>>2]|0,c[Q>>2]=c[ct>>2],c[ct>>2]=u,hn(Mt),u=c[W>>2]|0;break}ln=R,u=((ln-u>>2)+1|0)/-2|0,N=R+(u<<2)|0,w=w-ln|0,w?(rf(N|0,R|0,w|0)|0,u=(c[ne>>2]|0)+(u<<2)|0):u=N,ln=N+(w>>2<<2)|0,c[W>>2]=ln,c[ne>>2]=u,u=ln}while(!1);c[u>>2]=c[v>>2],u=(c[W>>2]|0)+4|0,c[W>>2]=u,v=(c[Cn>>2]|0)+4|0,c[Cn>>2]=v,U=U+-1|0}while((U|0)!=0)}if(u=c[gr>>2]|0,(u|0)!=(v|0)){do u=u+-4|0,Pn(vt,u),v=c[Cn>>2]|0;while((u|0)!=(v|0));u=c[gr>>2]|0}ln=c[n>>2]|0,c[n>>2]=c[vt>>2],c[vt>>2]=ln,ln=vt+4|0,c[Cn>>2]=c[ln>>2],c[ln>>2]=v,ln=vt+8|0,c[gr>>2]=c[ln>>2],c[ln>>2]=u,ln=vt+12|0,Cn=c[ui>>2]|0,c[ui>>2]=c[ln>>2],c[ln>>2]=Cn,c[nn>>2]=(c[nn>>2]|0)+(pn(ot,-93)|0),hn(vt);break}else{t:do if((w|0)==(N|0))ne=18;else{for(;c[Di>>2]=Pi(4092)|0,c2(n,Di),u=u+-1|0,!!u;)if((c[ui>>2]|0)==(c[gr>>2]|0)){ne=18;break t}v=ot,u=c[nn>>2]|0}while(!1);if((ne|0)==18){w=~(U>>>0>W>>>0?W:U),v=u;do c[Di>>2]=Pi(4092)|0,F_(n,Di),v=v+-1|0,R=(((c[gr>>2]|0)-(c[Cn>>2]|0)|0)==4?92:93)+(c[nn>>2]|0)|0,c[nn>>2]=R;while((v|0)!=0);v=u+-1-w|0,u=R}if(c[nn>>2]=u+(pn(v,-93)|0),!v)break;W=n+12|0,Q=Mt+4|0,ne=Mt+8|0,be=Mt+12|0,u=c[gr>>2]|0;do{N=c[Cn>>2]|0,U=c[N>>2]|0,N=N+4|0,c[Cn>>2]=N,ln=c[ui>>2]|0,w=ln;do if((u|0)==(ln|0)){if(ln=c[n>>2]|0,u=ln,N>>>0<=ln>>>0){u=w-u|0,u=(u|0)==0?1:u>>1,Rn(Mt,u,u>>>2,W),c[pr>>2]=c[Cn>>2],c[zs>>2]=c[gr>>2],c[Jt>>2]=c[pr>>2],c[Di>>2]=c[zs>>2],zn(Mt,Jt,Di),u=c[n>>2]|0,c[n>>2]=c[Mt>>2],c[Mt>>2]=u,u=c[Cn>>2]|0,c[Cn>>2]=c[Q>>2],c[Q>>2]=u,u=c[gr>>2]|0,c[gr>>2]=c[ne>>2],c[ne>>2]=u,u=c[ui>>2]|0,c[ui>>2]=c[be>>2],c[be>>2]=u,hn(Mt),u=c[gr>>2]|0;break}ln=N,u=((ln-u>>2)+1|0)/-2|0,R=N+(u<<2)|0,w=w-ln|0,w?(rf(R|0,N|0,w|0)|0,u=(c[Cn>>2]|0)+(u<<2)|0):u=R,ln=R+(w>>2<<2)|0,c[gr>>2]=ln,c[Cn>>2]=u,u=ln}while(!1);c[u>>2]=U,u=(c[gr>>2]|0)+4|0,c[gr>>2]=u,v=v+-1|0}while((v|0)!=0)}else if(c[nn>>2]=(pn(ot,-93)|0)+w,ot|0)for(W=n+12|0,ne=n+12|0,be=Mt+4|0,Se=Mt+8|0,je=Mt+12|0,u=ot,w=Q;;){U=c[w>>2]|0,N=w+4|0,c[Cn>>2]=N,ui=c[W>>2]|0,w=ui;do if((v|0)==(ui|0)){if(ui=c[n>>2]|0,v=ui,N>>>0<=ui>>>0){v=w-v|0,v=(v|0)==0?1:v>>1,Rn(Mt,v,v>>>2,ne),c[pr>>2]=c[Cn>>2],c[zs>>2]=c[gr>>2],c[Jt>>2]=c[pr>>2],c[Di>>2]=c[zs>>2],zn(Mt,Jt,Di),v=c[n>>2]|0,c[n>>2]=c[Mt>>2],c[Mt>>2]=v,v=c[Cn>>2]|0,c[Cn>>2]=c[be>>2],c[be>>2]=v,v=c[gr>>2]|0,c[gr>>2]=c[Se>>2],c[Se>>2]=v,v=c[W>>2]|0,c[W>>2]=c[je>>2],c[je>>2]=v,hn(Mt),v=c[gr>>2]|0;break}ui=N,v=((ui-v>>2)+1|0)/-2|0,R=N+(v<<2)|0,w=w-ui|0,w?(rf(R|0,N|0,w|0)|0,v=(c[Cn>>2]|0)+(v<<2)|0):v=R,ui=R+(w>>2<<2)|0,c[gr>>2]=ui,c[Cn>>2]=v,v=ui}while(!1);if(c[v>>2]=U,v=(c[gr>>2]|0)+4|0,c[gr>>2]=v,u=u+-1|0,!u)break e;w=c[Cn>>2]|0}while(!1);ee=vs}function Sc(n,u){n=n|0,u=u|0;var v=0,w=0,R=0,N=0;v=(c[u+16>>2]|0)+(c[u+20>>2]|0)|0,N=c[u+4>>2]|0,w=(v>>>0)/93|0,R=N+(w<<2)|0,(c[u+8>>2]|0)==(N|0)?u=0:u=(c[R>>2]|0)+((v-(w*93|0)|0)*44|0)|0,c[n>>2]=R,c[n+4>>2]=u}function Bh(n,u,v){n=n|0,u=u|0,v=v|0;var w=0,R=0;R=u,u=c[R+4>>2]|0,w=n,c[w>>2]=c[R>>2],c[w+4>>2]=u,w=v,u=c[w+4>>2]|0,v=n+8|0,c[v>>2]=c[w>>2],c[v+4>>2]=u}function zh(n,u){n=n|0,u=u|0,c[n>>2]=c[u>>2],c[n+4>>2]=c[u+4>>2],c[n+8>>2]=c[u+8>>2],c[n+12>>2]=c[u+12>>2]}function pm(n,u){n=n|0,u=u|0;var v=0,w=0,R=0,N=0,U=0,W=0,Q=0;v=ee,ee=ee+32|0,w=v+24|0,R=v+16|0,U=v+8|0,N=v,W=u+8|0,Q=c[W>>2]|0,W=c[W+4>>2]|0,u=U,c[u>>2]=Q,c[u+4>>2]=W,u=N,c[u>>2]=Q,c[u+4>>2]=W,c[R>>2]=c[U>>2],c[R+4>>2]=c[U+4>>2],c[w>>2]=c[N>>2],c[w+4>>2]=c[N+4>>2],Bh(n,R,w),ee=v}function j0(n,u){return n=n|0,u=u|0,(Lh(n,u)|0)^1|0}function Od(n,u){n=n|0,u=u|0;var v=0,w=0;v=c[u>>2]|0,w=c[u+4>>2]|0,(v|0)==(c[u+8>>2]|0)?tg(n,w,c[u+12>>2]|0):tg(n,w,(c[v>>2]|0)+4092|0)}function gm(n,u,v){n=n|0,u=u|0,v=v|0;var w=0;w=c[v>>2]|0,c[n>>2]=w,c[n+4>>2]=c[v+4>>2],c[n+8>>2]=w,c[n+12>>2]=u}function G0(n){n=n|0;var u=0;u=(c[n+12>>2]|0)+20|0,c[u>>2]=(c[u>>2]|0)+(((c[n>>2]|0)-(c[n+8>>2]|0)|0)/44|0)}function Bf(n){n=n|0;var u=0,v=0,w=0;return u=c[n>>2]|0,v=n+8|0,(u|0)==(c[v>>2]|0)?(w=v,u=c[w+4>>2]|0,v=n,c[v>>2]=c[w>>2],c[v+4>>2]=u):(w=u+4|0,c[n>>2]=w,c[n+4>>2]=c[w>>2]),n|0}function c2(n,u){n=n|0,u=u|0;var v=0,w=0,R=0,N=0,U=0,W=0,Q=0,ne=0,be=0,Se=0,je=0,ct=0,vt=0,ot=0;vt=ee,ee=ee+48|0,R=vt+32|0,w=vt+28|0,W=vt+8|0,Q=vt+4|0,ne=vt,ct=n+8|0,v=c[ct>>2]|0,be=n+12|0,je=c[be>>2]|0,N=je;do if((v|0)==(je|0)){if(je=n+4|0,Se=c[je>>2]|0,ot=c[n>>2]|0,U=ot,Se>>>0<=ot>>>0){v=N-U|0,v=(v|0)==0?1:v>>1,Rn(W,v,v>>>2,n+12|0),c[Q>>2]=c[je>>2],c[ne>>2]=c[ct>>2],c[w>>2]=c[Q>>2],c[R>>2]=c[ne>>2],zn(W,w,R),v=c[n>>2]|0,c[n>>2]=c[W>>2],c[W>>2]=v,v=W+4|0,ot=c[je>>2]|0,c[je>>2]=c[v>>2],c[v>>2]=ot,v=W+8|0,ot=c[ct>>2]|0,c[ct>>2]=c[v>>2],c[v>>2]=ot,v=W+12|0,ot=c[be>>2]|0,c[be>>2]=c[v>>2],c[v>>2]=ot,hn(W),v=c[ct>>2]|0;break}R=Se,w=((R-U>>2)+1|0)/-2|0,n=Se+(w<<2)|0,R=v-R|0,R?(rf(n|0,Se|0,R|0)|0,v=(c[je>>2]|0)+(w<<2)|0):v=n,ot=n+(R>>2<<2)|0,c[ct>>2]=ot,c[je>>2]=v,v=ot}while(!1);c[v>>2]=c[u>>2],c[ct>>2]=(c[ct>>2]|0)+4,ee=vt}function F_(n,u){n=n|0,u=u|0;var v=0,w=0,R=0,N=0,U=0,W=0,Q=0,ne=0,be=0,Se=0,je=0,ct=0,vt=0,ot=0;vt=ee,ee=ee+48|0,w=vt+32|0,v=vt+28|0,U=vt+8|0,W=vt+4|0,Q=vt,ct=n+4|0,Se=c[ct>>2]|0,je=c[n>>2]|0,ne=je;do if((Se|0)==(je|0)){if(je=n+8|0,be=c[je>>2]|0,N=n+12|0,ot=c[N>>2]|0,R=ot,be>>>0>=ot>>>0){ot=R-ne|0,ot=(ot|0)==0?1:ot>>1,Rn(U,ot,(ot+3|0)>>>2,n+12|0),c[W>>2]=c[ct>>2],c[Q>>2]=c[je>>2],c[v>>2]=c[W>>2],c[w>>2]=c[Q>>2],zn(U,v,w),v=c[n>>2]|0,c[n>>2]=c[U>>2],c[U>>2]=v,v=U+4|0,ot=c[ct>>2]|0,c[ct>>2]=c[v>>2],c[v>>2]=ot,v=U+8|0,ot=c[je>>2]|0,c[je>>2]=c[v>>2],c[v>>2]=ot,v=U+12|0,ot=c[N>>2]|0,c[N>>2]=c[v>>2],c[v>>2]=ot,hn(U),v=c[ct>>2]|0;break}w=be,n=((R-w>>2)+1|0)/2|0,R=be+(n<<2)|0,w=w-Se|0,v=R+(0-(w>>2)<<2)|0,w?(rf(v|0,Se|0,w|0)|0,w=(c[je>>2]|0)+(n<<2)|0):(v=R,w=R),c[ct>>2]=v,c[je>>2]=w}else v=Se;while(!1);c[v+-4>>2]=c[u>>2],c[ct>>2]=(c[ct>>2]|0)+-4,ee=vt}function Rn(n,u,v,w){n=n|0,u=u|0,v=v|0,w=w|0;var R=0;R=n+12|0,c[R>>2]=0,c[n+16>>2]=w;do if(u)if(u>>>0>1073741823)R=Zn(8)|0,Tp(R,6723),c[R>>2]=5956,ir(R|0,3928,123);else{w=Pi(u<<2)|0;break}else w=0;while(!1);c[n>>2]=w,v=w+(v<<2)|0,c[n+8>>2]=v,c[n+4>>2]=v,c[R>>2]=w+(u<<2)}function Rr(n,u){n=n|0,u=u|0;var v=0,w=0,R=0,N=0,U=0,W=0,Q=0,ne=0,be=0,Se=0,je=0,ct=0,vt=0,ot=0;vt=ee,ee=ee+48|0,R=vt+32|0,w=vt+28|0,W=vt+8|0,Q=vt+4|0,ne=vt,ct=n+8|0,v=c[ct>>2]|0,be=n+12|0,je=c[be>>2]|0,N=je;do if((v|0)==(je|0)){if(je=n+4|0,Se=c[je>>2]|0,ot=c[n>>2]|0,U=ot,Se>>>0<=ot>>>0){v=N-U|0,v=(v|0)==0?1:v>>1,Rn(W,v,v>>>2,c[n+16>>2]|0),c[Q>>2]=c[je>>2],c[ne>>2]=c[ct>>2],c[w>>2]=c[Q>>2],c[R>>2]=c[ne>>2],zn(W,w,R),v=c[n>>2]|0,c[n>>2]=c[W>>2],c[W>>2]=v,v=W+4|0,ot=c[je>>2]|0,c[je>>2]=c[v>>2],c[v>>2]=ot,v=W+8|0,ot=c[ct>>2]|0,c[ct>>2]=c[v>>2],c[v>>2]=ot,v=W+12|0,ot=c[be>>2]|0,c[be>>2]=c[v>>2],c[v>>2]=ot,hn(W),v=c[ct>>2]|0;break}R=Se,w=((R-U>>2)+1|0)/-2|0,n=Se+(w<<2)|0,R=v-R|0,R?(rf(n|0,Se|0,R|0)|0,v=(c[je>>2]|0)+(w<<2)|0):v=n,ot=n+(R>>2<<2)|0,c[ct>>2]=ot,c[je>>2]=v,v=ot}while(!1);c[v>>2]=c[u>>2],c[ct>>2]=(c[ct>>2]|0)+4,ee=vt}function Pn(n,u){n=n|0,u=u|0;var v=0,w=0,R=0,N=0,U=0,W=0,Q=0,ne=0,be=0,Se=0,je=0,ct=0,vt=0,ot=0;vt=ee,ee=ee+48|0,w=vt+32|0,v=vt+28|0,U=vt+8|0,W=vt+4|0,Q=vt,ct=n+4|0,Se=c[ct>>2]|0,je=c[n>>2]|0,ne=je;do if((Se|0)==(je|0)){if(je=n+8|0,be=c[je>>2]|0,N=n+12|0,ot=c[N>>2]|0,R=ot,be>>>0>=ot>>>0){ot=R-ne|0,ot=(ot|0)==0?1:ot>>1,Rn(U,ot,(ot+3|0)>>>2,c[n+16>>2]|0),c[W>>2]=c[ct>>2],c[Q>>2]=c[je>>2],c[v>>2]=c[W>>2],c[w>>2]=c[Q>>2],zn(U,v,w),v=c[n>>2]|0,c[n>>2]=c[U>>2],c[U>>2]=v,v=U+4|0,ot=c[ct>>2]|0,c[ct>>2]=c[v>>2],c[v>>2]=ot,v=U+8|0,ot=c[je>>2]|0,c[je>>2]=c[v>>2],c[v>>2]=ot,v=U+12|0,ot=c[N>>2]|0,c[N>>2]=c[v>>2],c[v>>2]=ot,hn(U),v=c[ct>>2]|0;break}w=be,n=((R-w>>2)+1|0)/2|0,R=be+(n<<2)|0,w=w-Se|0,v=R+(0-(w>>2)<<2)|0,w?(rf(v|0,Se|0,w|0)|0,w=(c[je>>2]|0)+(n<<2)|0):(v=R,w=R),c[ct>>2]=v,c[je>>2]=w}else v=Se;while(!1);c[v+-4>>2]=c[u>>2],c[ct>>2]=(c[ct>>2]|0)+-4,ee=vt}function hn(n){n=n|0;var u=0,v=0,w=0;u=c[n+4>>2]|0,v=n+8|0,w=c[v>>2]|0,(w|0)!=(u|0)&&(c[v>>2]=w+(~((w+-4-u|0)>>>2)<<2)),u=c[n>>2]|0,u|0&&an(u,(c[n+12>>2]|0)-u|0)}function zn(n,u,v){n=n|0,u=u|0,v=v|0;var w=0,R=0,N=0,U=0;if(U=ee,ee=ee+16|0,N=U,R=c[u>>2]|0,wo(N,n+8|0,(c[v>>2]|0)-R>>2),n=c[N>>2]|0,w=N+4|0,(n|0)!=(c[w>>2]|0)){v=R;do c[n>>2]=c[v>>2],n=(c[N>>2]|0)+4|0,c[N>>2]=n,v=v+4|0;while((n|0)!=(c[w>>2]|0));c[u>>2]=v}$l(N),ee=U}function wo(n,u,v){n=n|0,u=u|0,v=v|0,c[n>>2]=c[u>>2],c[n+4>>2]=(c[u>>2]|0)+(v<<2),c[n+8>>2]=u}function $l(n){n=n|0,c[c[n+8>>2]>>2]=c[n>>2]}function Lh(n,u){return n=n|0,u=u|0,(c[n+4>>2]|0)==(c[u+4>>2]|0)|0}function tg(n,u,v){n=n|0,u=u|0,v=v|0,c[n>>2]=u,c[n+4>>2]=v}function Uu(n,u){n=n|0,u=u|0;var v=0,w=0,R=0,N=0;N=c[u+4>>2]|0,v=c[u+16>>2]|0,w=(v>>>0)/93|0,R=N+(w<<2)|0,(c[u+8>>2]|0)==(N|0)?u=0:u=(c[R>>2]|0)+((v-(w*93|0)|0)*44|0)|0,c[n>>2]=R,c[n+4>>2]=u}function ms(n,u){n=n|0,u=u|0;var v=0,w=0,R=0,N=0;v=(c[u+16>>2]|0)+(c[u+20>>2]|0)|0,N=c[u+4>>2]|0,w=(v>>>0)/93|0,R=N+(w<<2)|0,(c[u+8>>2]|0)==(N|0)?u=0:u=(c[R>>2]|0)+((v-(w*93|0)|0)*44|0)|0,c[n>>2]=R,c[n+4>>2]=u}function Vu(n){n=n|0;var u=0,v=0,w=0,R=0,N=0,U=0,W=0;if(W=ee,ee=ee+16|0,w=W+8|0,N=W,Uh(w,n),Sc(N,n),R=w+4|0,u=c[R>>2]|0,N=N+4|0,(u|0)!=(c[N>>2]|0))do rn(u),u=(c[R>>2]|0)+44|0,c[R>>2]=u,v=c[w>>2]|0,(u-(c[v>>2]|0)|0)==4092&&(u=v+4|0,c[w>>2]=u,u=c[u>>2]|0,c[R>>2]=u);while((u|0)!=(c[N>>2]|0));if(c[n+20>>2]=0,R=n+8|0,w=n+4|0,v=c[w>>2]|0,u=(c[R>>2]|0)-v>>2,u>>>0>2)do an(c[v>>2]|0,4092),v=(c[w>>2]|0)+4|0,c[w>>2]=v,u=(c[R>>2]|0)-v>>2;while(u>>>0>2);switch(u|0){case 1:{u=46,U=11;break}case 2:{u=93,U=11;break}default:}(U|0)==11&&(c[n+16>>2]=u),ee=W}function Uh(n,u){n=n|0,u=u|0;var v=0,w=0,R=0,N=0;N=c[u+4>>2]|0,v=c[u+16>>2]|0,w=(v>>>0)/93|0,R=N+(w<<2)|0,(c[u+8>>2]|0)==(N|0)?u=0:u=(c[R>>2]|0)+((v-(w*93|0)|0)*44|0)|0,c[n>>2]=R,c[n+4>>2]=u}function mm(n,u,v){n=n|0,u=u|0,v=v|0;var w=0,R=0,N=0,U=0,W=0,Q=0,ne=0;if(ne=ee,ee=ee+16|0,Q=ne,U=n+4|0,Z[U>>0]|0){if(R=c[n+20>>2]|0,w=c[n+8>>2]|0,Uh(Q,n+32|0),n=n+12|0,(w|0)!=(c[n>>2]|0))for(W=Q+4|0,U=w,N=R,w=c[W>>2]|0;R=Re[U>>0]|0,R=ka((Zr(u,w)|0)+R|0)|0,Z[N>>0]=R,Z[v>>0]=R,Z[U>>0]=R,U=U+1|0,v=v+1|0,R=c[Q>>2]|0,w=(c[W>>2]|0)+44|0,c[W>>2]=w,(w-(c[R>>2]|0)|0)==4092&&(w=R+4|0,c[Q>>2]=w,w=c[w>>2]|0,c[W>>2]=w),(U|0)!=(c[n>>2]|0);)N=N+1|0}else{if(Q=Of(u)|0,Ff(Q,v,c[n>>2]|0),Q=c[n>>2]|0,N=v+Q|0,!Q)w=0;else{for(w=v,R=c[n+8>>2]|0;Z[R>>0]=Z[w>>0]|0,w=w+1|0,(w|0)!=(N|0);)R=R+1|0;w=c[n>>2]|0}Z[U>>0]=1,v=v+w|0}return ee=ne,v|0}function ka(n){return n=n|0,n&255|0}function zf(n){n=n|0,ma(n),Ai(n)}function W0(n){n=n|0,n=c[n+12>>2]|0,n|0&&Jr[c[(c[n>>2]|0)+4>>2]&255](n)}function Xo(n,u){return n=n|0,u=u|0,((c[u+4>>2]|0)==11262?n+12|0:0)|0}function _m(n){n=n|0,an(n,16)}function Z0(n,u){n=n|0,u=u|0,c[n>>2]=0,c[n+4>>2]=0,c[n+8>>2]=0,u|0&&(Dd(n,u),X0(n,u))}function N_(n,u,v){n=n|0,u=u|0,v=v|0,c[n>>2]=0,c[n+4>>2]=0,c[n+8>>2]=0,c[n+12>>2]=0,c[n+16>>2]=0,c[n+20>>2]=0,u|0&&Fd(n,u,v)}function X0(n,u){n=n|0,u=u|0;var v=0,w=0,R=0;if(R=ee,ee=ee+16|0,w=R,V0(w,n,u),u=w+4|0,n=c[u>>2]|0,v=w+8|0,(n|0)!=(c[v>>2]|0))do Z[n>>0]=0,n=(c[u>>2]|0)+1|0,c[u>>2]=n;while((n|0)!=(c[v>>2]|0));iu(w),ee=R}function Fd(n,u,v){n=n|0,u=u|0,v=v|0;var w=0,R=0,N=0,U=0,W=0,Q=0,ne=0,be=0,Se=0,je=0,ct=0;if(ct=ee,ee=ee+96|0,je=ct+80|0,ne=ct+64|0,U=ct+48|0,W=ct+40|0,Q=ct+8|0,R=ct,be=ct+32|0,Se=ct+16|0,w=(c[n+8>>2]|0)-(c[n+4>>2]|0)|0,w=((w|0)==0?0:((w>>2)*93|0)+-1|0)-((c[n+20>>2]|0)+(c[n+16>>2]|0))|0,w>>>0<u>>>0&&Tc(n,u-w|0),Sc(W,n),Sc(R,n),w=c[R>>2]|0,R=c[R+4>>2]|0,N=Q,c[N>>2]=w,c[N+4>>2]=R,N=w,u|0&&(w=((R-(c[w>>2]|0)|0)/44|0)+u|0,(w|0)>0?(u=(w>>>0)/93|0,N=N+(u<<2)|0,c[Q>>2]=N,w=(c[N>>2]|0)+((w-(u*93|0)|0)*44|0)|0):(w=92-w|0,u=N+(((w|0)/-93|0)<<2)|0,c[Q>>2]=u,w=(c[u>>2]|0)+((92-((w|0)%93|0)|0)*44|0)|0),c[Q+4>>2]=w),c[ne>>2]=c[W>>2],c[ne+4>>2]=c[W+4>>2],c[je>>2]=c[Q>>2],c[je+4>>2]=c[Q+4>>2],Bh(U,ne,je),zh(je,U),pm(ne,U),j0(je,ne)|0){R=Se+4|0;do{if(Od(be,je),gm(Se,n,be),w=c[Se>>2]|0,(w|0)!=(c[R>>2]|0))do lr(w,v),w=(c[Se>>2]|0)+44|0,c[Se>>2]=w;while((w|0)!=(c[R>>2]|0));G0(Se),Bf(je)|0}while(j0(je,ne)|0)}ee=ct}function ju(n){n=n|0;var u=0,v=0;if(Vu(n),u=c[n+4>>2]|0,v=c[n+8>>2]|0,(u|0)!=(v|0))do an(c[u>>2]|0,4092),u=u+4|0;while((u|0)!=(v|0));dm(n)}function Hs(n,u,v){n=n|0,u=u|0,v=v|0,_t(n),c[n>>2]=4924,c[n+4>>2]=u,c[n+8>>2]=v}function Gu(n,u,v){n=n|0,u=u|0,v=v|0;var w=0,R=0;v=ee,ee=ee+16|0,w=v,c[n>>2]=u,R=Pi(16)|0,c[R+4>>2]=0,c[R+8>>2]=0,c[R>>2]=4944,c[R+12>>2]=u,c[n+4>>2]=R,c[w>>2]=u,c[w+4>>2]=u,Bd(n,w),ee=v}function Nd(n,u){return n=n|0,u=u|0,ig(c[n+8>>2]|0,c[n+4>>2]|0,u)|0}function pl(n){n=n|0;var u=0,v=0;c[n>>2]=4924,v=n+8|0,u=c[v>>2]|0,c[v>>2]=0,u|0&&(H0(u),Ai(u)),ri(n)}function ym(n){n=n|0,pl(n),Ai(n)}function ig(n,u,v){return n=n|0,u=u|0,v=v|0,ng(n+4784|0,u,xc(n,u,v)|0)|0}function ng(n,u,v){return n=n|0,u=u|0,v=v|0,Z[n>>0]|0&&(ku(u),Z[n>>0]=0),v|0}function H0(n){n=n|0,Kc(n)}function Bd(n,u){n=n|0,u=u|0}function Ho(n){n=n|0,ma(n),Ai(n)}function B_(n){n=n|0,n=c[n+12>>2]|0,n|0&&Jr[c[(c[n>>2]|0)+8>>2]&255](n)}function $o(n,u){return n=n|0,u=u|0,((c[u+4>>2]|0)==12004?n+12|0:0)|0}function Bs(n){n=n|0,an(n,16)}function Vh(n){n=n|0,Z[n>>0]=1}function u2(n,u,v){n=n|0,u=u|0,v=v|0,_t(n),c[n>>2]=4972,c[n+4>>2]=u,c[n+8>>2]=v}function jh(n,u,v){n=n|0,u=u|0,v=v|0;var w=0,R=0;v=ee,ee=ee+16|0,w=v,c[n>>2]=u,R=Pi(16)|0,c[R+4>>2]=0,c[R+8>>2]=0,c[R>>2]=4992,c[R+12>>2]=u,c[n+4>>2]=R,c[w>>2]=u,c[w+4>>2]=u,Bd(n,w),ee=v}function $0(n,u){return n=n|0,u=u|0,vm(c[n+8>>2]|0,c[n+4>>2]|0,u)|0}function q0(n){n=n|0;var u=0,v=0;c[n>>2]=4972,v=n+8|0,u=c[v>>2]|0,c[v>>2]=0,u|0&&(Lf(u),Ai(u)),ri(n)}function zd(n){n=n|0,q0(n),Ai(n)}function vm(n,u,v){return n=n|0,u=u|0,v=v|0,xm(n+4784|0,u,xc(n,u,v)|0)|0}function xm(n,u,v){return n=n|0,u=u|0,v=v|0,ng(n+328|0,u,Fh(n,u,v)|0)|0}function Lf(n){n=n|0,rg(n+4784|0),Kc(n)}function rg(n){n=n|0,Jp(n)}function Y0(n){n=n|0,ma(n),Ai(n)}function sg(n){n=n|0,n=c[n+12>>2]|0,n|0&&Jr[c[(c[n>>2]|0)+8>>2]&255](n)}function ag(n,u){return n=n|0,u=u|0,((c[u+4>>2]|0)==12827?n+12|0:0)|0}function Ld(n){n=n|0,an(n,16)}function z_(n){n=n|0,Cd(n),Vh(n+328|0)}function L_(n,u,v){n=n|0,u=u|0,v=v|0,_t(n),c[n>>2]=5020,c[n+4>>2]=u,c[n+8>>2]=v}function U_(n,u,v){n=n|0,u=u|0,v=v|0;var w=0,R=0;v=ee,ee=ee+16|0,w=v,c[n>>2]=u,R=Pi(16)|0,c[R+4>>2]=0,c[R+8>>2]=0,c[R>>2]=5040,c[R+12>>2]=u,c[n+4>>2]=R,c[w>>2]=u,c[w+4>>2]=u,Bd(n,w),ee=v}function Ud(n,u){return n=n|0,u=u|0,j_(c[n+8>>2]|0,c[n+4>>2]|0,u)|0}function J0(n){n=n|0;var u=0,v=0;c[n>>2]=5020,v=n+8|0,u=c[v>>2]|0,c[v>>2]=0,u|0&&(G_(u),Ai(u)),ri(n)}function V_(n){n=n|0,J0(n),Ai(n)}function j_(n,u,v){return n=n|0,u=u|0,v=v|0,bm(n+4784|0,u,xc(n,u,v)|0)|0}function bm(n,u,v){return n=n|0,u=u|0,v=v|0,ng(n+316|0,u,Ns(n,u,v)|0)|0}function G_(n){n=n|0,Am(n+4784|0),Kc(n)}function Am(n){n=n|0,um(n)}function W_(n){n=n|0,ma(n),Ai(n)}function og(n){n=n|0,n=c[n+12>>2]|0,n|0&&Jr[c[(c[n>>2]|0)+8>>2]&255](n)}function Z_(n,u){return n=n|0,u=u|0,((c[u+4>>2]|0)==13672?n+12|0:0)|0}function wm(n){n=n|0,an(n,16)}function Yn(n){n=n|0,N0(n),Vh(n+316|0)}function lg(n,u,v){n=n|0,u=u|0,v=v|0,_t(n),c[n>>2]=5068,c[n+4>>2]=u,c[n+8>>2]=v}function Gh(n,u,v){n=n|0,u=u|0,v=v|0;var w=0,R=0;v=ee,ee=ee+16|0,w=v,c[n>>2]=u,R=Pi(16)|0,c[R+4>>2]=0,c[R+8>>2]=0,c[R>>2]=5088,c[R+12>>2]=u,c[n+4>>2]=R,c[w>>2]=u,c[w+4>>2]=u,Bd(n,w),ee=v}function Q0(n,u){return n=n|0,u=u|0,X_(c[n+8>>2]|0,c[n+4>>2]|0,u)|0}function cg(n){n=n|0;var u=0,v=0;c[n>>2]=5068,v=n+8|0,u=c[v>>2]|0,c[v>>2]=0,u|0&&(Vd(u),Ai(u)),ri(n)}function h2(n){n=n|0,cg(n),Ai(n)}function X_(n,u,v){return n=n|0,u=u|0,v=v|0,ug(n+4784|0,u,xc(n,u,v)|0)|0}function ug(n,u,v){return n=n|0,u=u|0,v=v|0,bm(n+328|0,u,Fh(n,u,v)|0)|0}function Vd(n){n=n|0,Tm(n+4784|0),Kc(n)}function Tm(n){n=n|0,Am(n+328|0),Jp(n)}function hg(n){n=n|0,ma(n),Ai(n)}function Sm(n){n=n|0,n=c[n+12>>2]|0,n|0&&Jr[c[(c[n>>2]|0)+8>>2]&255](n)}function Wu(n,u){return n=n|0,u=u|0,((c[u+4>>2]|0)==14573?n+12|0:0)|0}function Ec(n){n=n|0,an(n,16)}function gl(n){n=n|0,Cd(n),Yn(n+328|0)}function Wh(n){return n=n|0,n+20|0}function Em(n,u,v){n=n|0,u=u|0,v=v|0,c[n>>2]=u,c[n+4>>2]=v,c[n+8>>2]=0}function fg(n,u){n=n|0,u=u|0,c[n>>2]=u,c[n+4>>2]=0,c[n+8>>2]=-1}function H_(n,u){n=n|0,u=u|0;var v=0,w=0,R=0,N=0;v=ee,ee=ee+16|0,w=v+4|0,N=v,R=Pi(24)|0,Im(R,u),c[N>>2]=0,c[w>>2]=c[N>>2],yg(n,R,w),ee=v}function Zu(n){n=n|0;var u=0,v=0;n=c[n+4>>2]|0,n|0&&(v=n+4|0,u=c[v>>2]|0,c[v>>2]=u+-1,(u|0)==0)&&(Jr[c[(c[n>>2]|0)+8>>2]&255](n),wp(n))}function Mm(n,u,v){n=n|0,u=u|0,v=v|0;var w=0,R=0;v=ee,ee=ee+16|0,w=v,c[n>>2]=u,R=Pi(16)|0,c[R+4>>2]=0,c[R+8>>2]=0,c[R>>2]=5116,c[R+12>>2]=u,c[n+4>>2]=R,c[w>>2]=u,c[w+4>>2]=u,dg(n,w),ee=v}function K0(n){n=n|0;var u=0,v=0;n=c[n+4>>2]|0,n|0&&(v=n+4|0,u=c[v>>2]|0,c[v>>2]=u+-1,(u|0)==0)&&(Jr[c[(c[n>>2]|0)+8>>2]&255](n),wp(n))}function dg(n,u){n=n|0,u=u|0}function pg(n){n=n|0,ma(n),Ai(n)}function jd(n){n=n|0,n=c[n+12>>2]|0,n|0&&Ai(n)}function gg(n,u){return n=n|0,u=u|0,((c[u+4>>2]|0)==14966?n+12|0:0)|0}function mg(n){n=n|0,an(n,16)}function Rm(n,u,v){n=n|0,u=u|0,v=v|0;var w=0,R=0;v=ee,ee=ee+16|0,w=v,c[n>>2]=u,R=Pi(16)|0,c[R+4>>2]=0,c[R+8>>2]=0,c[R>>2]=5144,c[R+12>>2]=u,c[n+4>>2]=R,c[w>>2]=u,c[w+4>>2]=u,Zh(n,w),ee=v}function Cm(n){n=n|0;var u=0,v=0;n=c[n+4>>2]|0,n|0&&(v=n+4|0,u=c[v>>2]|0,c[v>>2]=u+-1,(u|0)==0)&&(Jr[c[(c[n>>2]|0)+8>>2]&255](n),wp(n))}function Zh(n,u){n=n|0,u=u|0}function $_(n){n=n|0,ma(n),Ai(n)}function q_(n){n=n|0,n=c[n+12>>2]|0,n|0&&(_g(n),Ai(n))}function In(n,u){return n=n|0,u=u|0,((c[u+4>>2]|0)==15127?n+12|0:0)|0}function Pm(n){n=n|0,an(n,16)}function _g(n){n=n|0}function Im(n,u){n=n|0,u=u|0,_t(n),c[n>>2]=5172,c[n+4>>2]=u,c[n+8>>2]=0,c[n+12>>2]=0,c[n+16>>2]=0,Z[n+20>>0]=1}function yg(n,u,v){n=n|0,u=u|0,v=v|0;var w=0,R=0;v=ee,ee=ee+16|0,w=v,c[n>>2]=u,R=Pi(16)|0,c[R+4>>2]=0,c[R+8>>2]=0,c[R>>2]=5192,c[R+12>>2]=u,c[n+4>>2]=R,c[w>>2]=u,c[w+4>>2]=u,J_(n,w),ee=v}function nu(n,u){n=n|0,u=u|0;var v=0,w=0,R=0,N=0,U=0,W=0,Q=0;if(Q=ee,ee=ee+16|0,N=Q,v=c[n+8>>2]|0,U=c[n+12>>2]|0,(v|0)!=(U|0)){W=N+4|0;do w=c[v>>2]|0,c[N>>2]=w,R=c[v+4>>2]|0,c[W>>2]=R,R|0&&(R=R+4|0,c[R>>2]=(c[R>>2]|0)+1),u=R2[c[(c[w>>2]|0)+12>>2]&63](w,u)|0,sn(N),v=v+8|0;while((v|0)!=(U|0))}return v=n+20|0,Z[v>>0]|0&&(Z[v>>0]=0,Y_(c[n+4>>2]|0)),ee=Q,u|0}function Uf(n){n=n|0,c[n>>2]=5172,rr(n+8|0),ri(n)}function ep(n){n=n|0,Uf(n),Ai(n)}function Y_(n){n=n|0;var u=0;u=((Xh(c[n>>2]|0)|0)&255)<<24,u=((Xh(c[n>>2]|0)|0)&255)<<16|u,u=u|((Xh(c[n>>2]|0)|0)&255)<<8,c[n+4>>2]=u|(Xh(c[n>>2]|0)|0)&255}function Xh(n){n=n|0;var u=0,v=0;return u=c[n>>2]|0,v=n+8|0,n=c[v>>2]|0,c[v>>2]=n+1,Z[u+n>>0]|0}function J_(n,u){n=n|0,u=u|0}function Q_(n){n=n|0,ma(n),Ai(n)}function tp(n){n=n|0,n=c[n+12>>2]|0,n|0&&Jr[c[(c[n>>2]|0)+8>>2]&255](n)}function km(n,u){return n=n|0,u=u|0,((c[u+4>>2]|0)==15450?n+12|0:0)|0}function Jn(n){n=n|0,an(n,16)}function Gd(n){n=n|0;var u=0,v=0,w=0,R=0,N=0,U=0,W=0,Q=0,ne=0,be=0;Q=ee,ee=ee+32|0,w=Q+12|0,R=Q,u=Q+8|0,U=Pi(180)|0,K_(U,c[n+4>>2]|0),N=n+8|0,c[u>>2]=0,c[w>>2]=c[u>>2],qo(R,U,w),U=n+12|0,u=c[U>>2]|0,W=n+16|0;do if(u>>>0>=(c[W>>2]|0)>>>0)if(u=(u-(c[N>>2]|0)>>3)+1|0,v=Hr(N)|0,v>>>0<u>>>0)Yl(N);else{ne=c[N>>2]|0,be=(c[W>>2]|0)-ne|0,W=be>>2,Os(w,be>>3>>>0<v>>>1>>>0?W>>>0<u>>>0?u:W:v,(c[U>>2]|0)-ne>>3,n+16|0),W=w+8|0,U=c[W>>2]|0,c[U>>2]=c[R>>2],n=R+4|0,c[U+4>>2]=c[n>>2],c[R>>2]=0,c[n>>2]=0,c[W>>2]=U+8,Fs(N,w),ws(w);break}else jn(w,N,1),be=w+4|0,ne=c[be>>2]|0,c[ne>>2]=c[R>>2],W=R+4|0,c[ne+4>>2]=c[W>>2],c[R>>2]=0,c[W>>2]=0,c[be>>2]=ne+8,fr(w);while(!1);sn(R),ee=Q}function Es(n){n=n|0;var u=0,v=0,w=0,R=0,N=0,U=0,W=0,Q=0,ne=0,be=0;Q=ee,ee=ee+32|0,w=Q+12|0,R=Q,u=Q+8|0,U=Pi(180)|0,Ms(U,c[n+4>>2]|0),N=n+8|0,c[u>>2]=0,c[w>>2]=c[u>>2],$s(R,U,w),U=n+12|0,u=c[U>>2]|0,W=n+16|0;do if(u>>>0>=(c[W>>2]|0)>>>0)if(u=(u-(c[N>>2]|0)>>3)+1|0,v=Hr(N)|0,v>>>0<u>>>0)Yl(N);else{ne=c[N>>2]|0,be=(c[W>>2]|0)-ne|0,W=be>>2,Os(w,be>>3>>>0<v>>>1>>>0?W>>>0<u>>>0?u:W:v,(c[U>>2]|0)-ne>>3,n+16|0),W=w+8|0,U=c[W>>2]|0,c[U>>2]=c[R>>2],n=R+4|0,c[U+4>>2]=c[n>>2],c[R>>2]=0,c[n>>2]=0,c[W>>2]=U+8,Fs(N,w),ws(w);break}else jn(w,N,1),be=w+4|0,ne=c[be>>2]|0,c[ne>>2]=c[R>>2],W=R+4|0,c[ne+4>>2]=c[W>>2],c[R>>2]=0,c[W>>2]=0,c[be>>2]=ne+8,fr(w);while(!1);sn(R),ee=Q}function K_(n,u){n=n|0,u=u|0,ua(n),c[n>>2]=5220,c[n+4>>2]=u,Wd(n+8|0)}function qo(n,u,v){n=n|0,u=u|0,v=v|0;var w=0,R=0;v=ee,ee=ee+16|0,w=v,c[n>>2]=u,R=Pi(16)|0,c[R+4>>2]=0,c[R+8>>2]=0,c[R>>2]=5244,c[R+12>>2]=u,c[n+4>>2]=R,c[w>>2]=u,c[w+4>>2]=u,fl(n,w),ee=v}function Wd(n){n=n|0,Ss(n,32,1,8,0),ca(n+80|0,32,1,8,0),Z[n+160>>0]=0,Z[n+161>>0]=0,Hh(n+164|0)}function Zd(n){n=n|0,c[n>>2]=5220,Om(n+8|0),$r(n)}function Dm(n){n=n|0,Zd(n),Ai(n)}function ip(n,u){return n=n|0,u=u|0,vg(n+8|0,c[n+4>>2]|0,u)|0}function Hh(n){n=n|0,Z[n+4>>0]=0}function Om(n){n=n|0,Br(n+80|0),as(n)}function vg(n,u,v){n=n|0,u=u|0,v=v|0;var w=0,R=0,N=0;return N=ee,ee=ee+16|0,w=N,Z[n+161>>0]|0||ss(n+80|0),R=n+164|0,$h(R)|0?(u=Xu(n+80|0,u,c[R>>2]|0,0)|0,c[w>>2]=u,R0(u,v)):(qh(Hu(u)|0,v,4),c[w>>2]=Xl(v)|0),Fm(R,w),ee=N,v+4|0}function $h(n){return n=n|0,(Z[n+4>>0]|0)!=0|0}function Xu(n,u,v,w){return n=n|0,u=u|0,v=v|0,w=w|0,v=(Nm(n,u,(c[n+36>>2]|0)+(w*44|0)|0)|0)+v|0,u=c[n+24>>2]|0,(v|0)<0?v+u|0:v-(v>>>0<u>>>0?0:u)|0}function Hu(n){return n=n|0,c[n>>2]|0}function qh(n,u,v){n=n|0,u=u|0,v=v|0;var w=0;if((v|0)>0){w=0;do Z[u+w>>0]=Xh(n)|0,w=w+1|0;while((w|0)!=(v|0))}}function Fm(n,u){n=n|0,u=u|0;var v=0;v=n+4|0,Z[v>>0]|0||(Z[v>>0]=1),c[n>>2]=c[u>>2]}function Nm(n,u,v){n=n|0,u=u|0,v=v|0;var w=0;v=np(u,v)|0,c[n>>2]=v;do if(v){if(v>>>0>=32){v=c[n+28>>2]|0;break}if(w=c[n+12>>2]|0,v>>>0>w>>>0?(w=v-w|0,v=np(u,(c[n+68>>2]|0)+((v+-1|0)*44|0)|0)|0,w=v<<w|($u(u,w)|0)):w=np(u,(c[n+68>>2]|0)+((v+-1|0)*44|0)|0)|0,v=c[n>>2]|0,(w|0)<(1<<v+-1|0)){v=w+1+(-1<<v)|0;break}else{v=w+1|0;break}}else v=ey(u,n+48|0)|0;while(!1);return v|0}function np(n,u){n=n|0,u=u|0;var v=0,w=0,R=0,N=0,U=0,W=0,Q=0,ne=0,be=0,Se=0,je=0,ct=0;if(je=n+8|0,Se=c[je>>2]|0,R=c[u+16>>2]|0,R){if(w=n+4|0,v=c[w>>2]|0,be=Se>>>15,c[je>>2]=be,Q=(v>>>0)/(be>>>0)|0,W=Q>>>(c[u+40>>2]|0),N=c[R+(W<<2)>>2]|0,W=(c[R+(W+1<<2)>>2]|0)+1|0,U=N+1|0,ne=c[u+8>>2]|0,W>>>0>U>>>0){R=N,N=W;do U=(N+R|0)>>>1,W=(c[ne+(U<<2)>>2]|0)>>>0>Q>>>0,R=W?R:U,N=W?U:N,U=R+1|0;while(N>>>0>U>>>0);N=R}R=pn(c[ne+(N<<2)>>2]|0,be)|0,(N|0)==(c[u+32>>2]|0)?U=Se:U=pn(c[ne+(U<<2)>>2]|0,be)|0}else{ne=Se>>>15,c[je>>2]=ne,W=c[u>>2]|0,be=c[u+8>>2]|0,w=n+4|0,v=c[w>>2]|0,Q=W>>>1,R=0,U=Se,N=0;do ct=pn(c[be+(Q<<2)>>2]|0,ne)|0,Se=ct>>>0>v>>>0,U=Se?ct:U,R=Se?R:ct,N=Se?N:Q,W=Se?Q:W,Q=(N+W|0)>>>1;while((Q|0)!=(N|0))}return c[w>>2]=v-R,ct=U-R|0,c[je>>2]=ct,ct>>>0<16777216&&on(n),je=(c[u+12>>2]|0)+(N<<2)|0,c[je>>2]=(c[je>>2]|0)+1,je=u+28|0,ct=(c[je>>2]|0)+-1|0,c[je>>2]=ct,ct||vo(u),N|0}function $u(n,u){n=n|0,u=u|0;var v=0,w=0,R=0,N=0;return u>>>0>19?(v=(Mc(n)|0)&65535,($u(n,u+-16|0)|0)<<16|v|0):(w=n+4|0,R=c[w>>2]|0,N=n+8|0,v=(c[N>>2]|0)>>>u,c[N>>2]=v,u=(R>>>0)/(v>>>0)|0,c[w>>2]=R-(pn(u,v)|0),v>>>0<16777216&&on(n),u|0)}function ey(n,u){n=n|0,u=u|0;var v=0,w=0,R=0,N=0,U=0,W=0;return w=n+8|0,R=c[w>>2]|0,v=pn(R>>>13,c[u+8>>2]|0)|0,N=n+4|0,U=c[N>>2]|0,W=U>>>0>=v>>>0,W?(c[N>>2]=U-v,v=R-v|0,c[w>>2]=v):(c[w>>2]=v,U=u+12|0,c[U>>2]=(c[U>>2]|0)+1),v>>>0<16777216&&on(n),U=u+4|0,n=(c[U>>2]|0)+-1|0,c[U>>2]=n,n||jl(u),W&1|0}function on(n){n=n|0;var u=0,v=0,w=0,R=0;u=n+4|0,v=n+8|0,w=c[u>>2]|0;do w=w<<8|(Xh(c[n>>2]|0)|0)&255,c[u>>2]=w,R=c[v>>2]<<8,c[v>>2]=R;while(R>>>0<16777216)}function Mc(n){n=n|0;var u=0,v=0,w=0,R=0;return v=n+4|0,R=c[v>>2]|0,u=n+8|0,w=(c[u>>2]|0)>>>16,c[u>>2]=w,u=(R>>>0)/(w>>>0)|0,c[v>>2]=R-(pn(u,w)|0),on(n),u&65535|0}function ha(n){n=n|0,ma(n),Ai(n)}function Rc(n){n=n|0,n=c[n+12>>2]|0,n|0&&Jr[c[(c[n>>2]|0)+4>>2]&255](n)}function Yh(n,u){return n=n|0,u=u|0,((c[u+4>>2]|0)==15904?n+12|0:0)|0}function $a(n){n=n|0,an(n,16)}function Ms(n,u){n=n|0,u=u|0,ua(n),c[n>>2]=5272,c[n+4>>2]=u,ml(n+8|0)}function $s(n,u,v){n=n|0,u=u|0,v=v|0;var w=0,R=0;v=ee,ee=ee+16|0,w=v,c[n>>2]=u,R=Pi(16)|0,c[R+4>>2]=0,c[R+8>>2]=0,c[R>>2]=5296,c[R+12>>2]=u,c[n+4>>2]=R,c[w>>2]=u,c[w+4>>2]=u,fl(n,w),ee=v}function ml(n){n=n|0,Ss(n,32,1,8,0),ca(n+80|0,32,1,8,0),Z[n+160>>0]=0,Z[n+161>>0]=0,ty(n+164|0)}function qa(n){n=n|0,c[n>>2]=5272,Xd(n+8|0),$r(n)}function qs(n){n=n|0,qa(n),Ai(n)}function rp(n,u){return n=n|0,u=u|0,fa(n+8|0,c[n+4>>2]|0,u)|0}function ty(n){n=n|0,Z[n+4>>0]=0}function Xd(n){n=n|0,Br(n+80|0),as(n)}function fa(n,u,v){n=n|0,u=u|0,v=v|0;var w=0,R=0,N=0;return N=ee,ee=ee+16|0,w=N,Z[n+161>>0]|0||ss(n+80|0),R=n+164|0,Vf(R)|0?(u=Xu(n+80|0,u,c[R>>2]|0,0)|0,c[w>>2]=u,Oh(u,v)):(qh(Hu(u)|0,v,4),c[w>>2]=Rd(v)|0),xg(R,w),ee=N,v+4|0}function Vf(n){return n=n|0,(Z[n+4>>0]|0)!=0|0}function xg(n,u){n=n|0,u=u|0;var v=0;v=n+4|0,Z[v>>0]|0||(Z[v>>0]=1),c[n>>2]=c[u>>2]}function ru(n){n=n|0,ma(n),Ai(n)}function iy(n){n=n|0,n=c[n+12>>2]|0,n|0&&Jr[c[(c[n>>2]|0)+4>>2]&255](n)}function ny(n,u){return n=n|0,u=u|0,((c[u+4>>2]|0)==16402?n+12|0:0)|0}function Jh(n){n=n|0,an(n,16)}function Bm(n){n=n|0;var u=0,v=0,w=0,R=0,N=0,U=0,W=0,Q=0,ne=0,be=0;Q=ee,ee=ee+32|0,w=Q+12|0,R=Q,u=Q+8|0,U=Pi(172)|0,Ya(U,c[n+4>>2]|0),N=n+8|0,c[u>>2]=0,c[w>>2]=c[u>>2],Cc(R,U,w),U=n+12|0,u=c[U>>2]|0,W=n+16|0;do if(u>>>0>=(c[W>>2]|0)>>>0)if(u=(u-(c[N>>2]|0)>>3)+1|0,v=Hr(N)|0,v>>>0<u>>>0)Yl(N);else{ne=c[N>>2]|0,be=(c[W>>2]|0)-ne|0,W=be>>2,Os(w,be>>3>>>0<v>>>1>>>0?W>>>0<u>>>0?u:W:v,(c[U>>2]|0)-ne>>3,n+16|0),W=w+8|0,U=c[W>>2]|0,c[U>>2]=c[R>>2],n=R+4|0,c[U+4>>2]=c[n>>2],c[R>>2]=0,c[n>>2]=0,c[W>>2]=U+8,Fs(N,w),ws(w);break}else jn(w,N,1),be=w+4|0,ne=c[be>>2]|0,c[ne>>2]=c[R>>2],W=R+4|0,c[ne+4>>2]=c[W>>2],c[R>>2]=0,c[W>>2]=0,c[be>>2]=ne+8,fr(w);while(!1);sn(R),ee=Q}function zm(n){n=n|0;var u=0,v=0,w=0,R=0,N=0,U=0,W=0,Q=0,ne=0,be=0;Q=ee,ee=ee+32|0,w=Q+12|0,R=Q,u=Q+8|0,U=Pi(176)|0,wg(U,c[n+4>>2]|0),N=n+8|0,c[u>>2]=0,c[w>>2]=c[u>>2],Wm(R,U,w),U=n+12|0,u=c[U>>2]|0,W=n+16|0;do if(u>>>0>=(c[W>>2]|0)>>>0)if(u=(u-(c[N>>2]|0)>>3)+1|0,v=Hr(N)|0,v>>>0<u>>>0)Yl(N);else{ne=c[N>>2]|0,be=(c[W>>2]|0)-ne|0,W=be>>2,Os(w,be>>3>>>0<v>>>1>>>0?W>>>0<u>>>0?u:W:v,(c[U>>2]|0)-ne>>3,n+16|0),W=w+8|0,U=c[W>>2]|0,c[U>>2]=c[R>>2],n=R+4|0,c[U+4>>2]=c[n>>2],c[R>>2]=0,c[n>>2]=0,c[W>>2]=U+8,Fs(N,w),ws(w);break}else jn(w,N,1),be=w+4|0,ne=c[be>>2]|0,c[ne>>2]=c[R>>2],W=R+4|0,c[ne+4>>2]=c[W>>2],c[R>>2]=0,c[W>>2]=0,c[be>>2]=ne+8,fr(w);while(!1);sn(R),ee=Q}function Ya(n,u){n=n|0,u=u|0,ua(n),c[n>>2]=5324,c[n+4>>2]=u,Ja(n+8|0)}function Cc(n,u,v){n=n|0,u=u|0,v=v|0;var w=0,R=0;v=ee,ee=ee+16|0,w=v,c[n>>2]=u,R=Pi(16)|0,c[R+4>>2]=0,c[R+8>>2]=0,c[R>>2]=5348,c[R+12>>2]=u,c[n+4>>2]=R,c[w>>2]=u,c[w+4>>2]=u,fl(n,w),ee=v}function Ja(n){n=n|0,Ss(n,8,1,8,0),ca(n+80|0,8,1,8,0),Z[n+160>>0]=0,Z[n+161>>0]=0,Um(n+162|0)}function qu(n){n=n|0,c[n>>2]=5324,jf(n+8|0),$r(n)}function bg(n){n=n|0,qu(n),Ai(n)}function Lm(n,u){return n=n|0,u=u|0,Hd(n+8|0,c[n+4>>2]|0,u)|0}function Um(n){n=n|0,Z[n+1>>0]=0}function jf(n){n=n|0,Br(n+80|0),as(n)}function Hd(n,u,v){n=n|0,u=u|0,v=v|0;var w=0,R=0,N=0;return N=ee,ee=ee+16|0,w=N,Z[n+161>>0]|0||ss(n+80|0),R=n+162|0,Vm(R)|0?(u=(Xu(n+80|0,u,Z[R>>0]|0,0)|0)&255,Z[w>>0]=u,jm(u,v)):(qh(Hu(u)|0,v,1),Z[w>>0]=Yu(v)|0),$d(R,w),ee=N,v+1|0}function Vm(n){return n=n|0,(Z[n+1>>0]|0)!=0|0}function jm(n,u){n=n|0,u=u|0,Z[u>>0]=n}function Yu(n){return n=n|0,Z[n>>0]|0}function $d(n,u){n=n|0,u=u|0;var v=0;v=n+1|0,Z[v>>0]|0||(Z[v>>0]=1),Z[n>>0]=Z[u>>0]|0}function Gm(n){n=n|0,ma(n),Ai(n)}function Ju(n){n=n|0,n=c[n+12>>2]|0,n|0&&Jr[c[(c[n>>2]|0)+4>>2]&255](n)}function sp(n,u){return n=n|0,u=u|0,((c[u+4>>2]|0)==16900?n+12|0:0)|0}function Ag(n){n=n|0,an(n,16)}function wg(n,u){n=n|0,u=u|0,ua(n),c[n>>2]=5376,c[n+4>>2]=u,ap(n+8|0)}function Wm(n,u,v){n=n|0,u=u|0,v=v|0;var w=0,R=0;v=ee,ee=ee+16|0,w=v,c[n>>2]=u,R=Pi(16)|0,c[R+4>>2]=0,c[R+8>>2]=0,c[R>>2]=5400,c[R+12>>2]=u,c[n+4>>2]=R,c[w>>2]=u,c[w+4>>2]=u,fl(n,w),ee=v}function ap(n){n=n|0,Ss(n,16,1,8,0),ca(n+80|0,16,1,8,0),Z[n+160>>0]=0,Z[n+161>>0]=0,cp(n+162|0)}function op(n){n=n|0,c[n>>2]=5376,Xm(n+8|0),$r(n)}function lp(n){n=n|0,op(n),Ai(n)}function Zm(n,u){return n=n|0,u=u|0,up(n+8|0,c[n+4>>2]|0,u)|0}function cp(n){n=n|0,Z[n+2>>0]=0}function Xm(n){n=n|0,Br(n+80|0),as(n)}function up(n,u,v){n=n|0,u=u|0,v=v|0;var w=0,R=0,N=0;return N=ee,ee=ee+16|0,w=N,Z[n+161>>0]|0||ss(n+80|0),R=n+162|0,hp(R)|0?(u=(Xu(n+80|0,u,mt[R>>1]|0,0)|0)&65535,mt[w>>1]=u,fp(u,v)):(qh(Hu(u)|0,v,2),mt[w>>1]=ry(v)|0),qd(R,w),ee=N,v+2|0}function hp(n){return n=n|0,(Z[n+2>>0]|0)!=0|0}function fp(n,u){n=n|0,u=u|0,Dh(n,u)}function ry(n){return n=n|0,bc(n)|0}function qd(n,u){n=n|0,u=u|0;var v=0;v=n+2|0,Z[v>>0]|0||(Z[v>>0]=1),mt[n>>1]=mt[u>>1]|0}function f2(n){n=n|0,ma(n),Ai(n)}function Hm(n){n=n|0,n=c[n+12>>2]|0,n|0&&Jr[c[(c[n>>2]|0)+4>>2]&255](n)}function sy(n,u){return n=n|0,u=u|0,((c[u+4>>2]|0)==17398?n+12|0:0)|0}function ay(n){n=n|0,an(n,16)}function Tg(n){n=n|0;var u=0,v=0,w=0,R=0,N=0,U=0,W=0,Q=0,ne=0,be=0;Q=ee,ee=ee+32|0,w=Q+12|0,R=Q,u=Q+8|0,U=Pi(172)|0,oy(U,c[n+4>>2]|0),N=n+8|0,c[u>>2]=0,c[w>>2]=c[u>>2],ly(R,U,w),U=n+12|0,u=c[U>>2]|0,W=n+16|0;do if(u>>>0>=(c[W>>2]|0)>>>0)if(u=(u-(c[N>>2]|0)>>3)+1|0,v=Hr(N)|0,v>>>0<u>>>0)Yl(N);else{ne=c[N>>2]|0,be=(c[W>>2]|0)-ne|0,W=be>>2,Os(w,be>>3>>>0<v>>>1>>>0?W>>>0<u>>>0?u:W:v,(c[U>>2]|0)-ne>>3,n+16|0),W=w+8|0,U=c[W>>2]|0,c[U>>2]=c[R>>2],n=R+4|0,c[U+4>>2]=c[n>>2],c[R>>2]=0,c[n>>2]=0,c[W>>2]=U+8,Fs(N,w),ws(w);break}else jn(w,N,1),be=w+4|0,ne=c[be>>2]|0,c[ne>>2]=c[R>>2],W=R+4|0,c[ne+4>>2]=c[W>>2],c[R>>2]=0,c[W>>2]=0,c[be>>2]=ne+8,fr(w);while(!1);sn(R),ee=Q}function Sg(n){n=n|0;var u=0,v=0,w=0,R=0,N=0,U=0,W=0,Q=0,ne=0,be=0;Q=ee,ee=ee+32|0,w=Q+12|0,R=Q,u=Q+8|0,U=Pi(176)|0,Qd(U,c[n+4>>2]|0),N=n+8|0,c[u>>2]=0,c[w>>2]=c[u>>2],Qu(R,U,w),U=n+12|0,u=c[U>>2]|0,W=n+16|0;do if(u>>>0>=(c[W>>2]|0)>>>0)if(u=(u-(c[N>>2]|0)>>3)+1|0,v=Hr(N)|0,v>>>0<u>>>0)Yl(N);else{ne=c[N>>2]|0,be=(c[W>>2]|0)-ne|0,W=be>>2,Os(w,be>>3>>>0<v>>>1>>>0?W>>>0<u>>>0?u:W:v,(c[U>>2]|0)-ne>>3,n+16|0),W=w+8|0,U=c[W>>2]|0,c[U>>2]=c[R>>2],n=R+4|0,c[U+4>>2]=c[n>>2],c[R>>2]=0,c[n>>2]=0,c[W>>2]=U+8,Fs(N,w),ws(w);break}else jn(w,N,1),be=w+4|0,ne=c[be>>2]|0,c[ne>>2]=c[R>>2],W=R+4|0,c[ne+4>>2]=c[W>>2],c[R>>2]=0,c[W>>2]=0,c[be>>2]=ne+8,fr(w);while(!1);sn(R),ee=Q}function oy(n,u){n=n|0,u=u|0,ua(n),c[n>>2]=5428,c[n+4>>2]=u,dp(n+8|0)}function ly(n,u,v){n=n|0,u=u|0,v=v|0;var w=0,R=0;v=ee,ee=ee+16|0,w=v,c[n>>2]=u,R=Pi(16)|0,c[R+4>>2]=0,c[R+8>>2]=0,c[R>>2]=5452,c[R+12>>2]=u,c[n+4>>2]=R,c[w>>2]=u,c[w+4>>2]=u,fl(n,w),ee=v}function dp(n){n=n|0,Ss(n,8,1,8,0),ca(n+80|0,8,1,8,0),Z[n+160>>0]=0,Z[n+161>>0]=0,pp(n+162|0)}function Yd(n){n=n|0,c[n>>2]=5428,Jd(n+8|0),$r(n)}function cy(n){n=n|0,Yd(n),Ai(n)}function $m(n,u){return n=n|0,u=u|0,Eg(n+8|0,c[n+4>>2]|0,u)|0}function pp(n){n=n|0,Z[n+1>>0]=0}function Jd(n){n=n|0,Br(n+80|0),as(n)}function Eg(n,u,v){n=n|0,u=u|0,v=v|0;var w=0,R=0,N=0;return N=ee,ee=ee+16|0,w=N,Z[n+161>>0]|0||ss(n+80|0),R=n+162|0,Gf(R)|0?(u=(Xu(n+80|0,u,Re[R>>0]|0,0)|0)&255,Z[w>>0]=u,$p(u,v)):(qh(Hu(u)|0,v,1),Z[w>>0]=Md(v)|0),Mg(R,w),ee=N,v+1|0}function Gf(n){return n=n|0,(Z[n+1>>0]|0)!=0|0}function Mg(n,u){n=n|0,u=u|0;var v=0;v=n+1|0,Z[v>>0]|0||(Z[v>>0]=1),Z[n>>0]=Z[u>>0]|0}function Qh(n){n=n|0,ma(n),Ai(n)}function ql(n){n=n|0,n=c[n+12>>2]|0,n|0&&Jr[c[(c[n>>2]|0)+4>>2]&255](n)}function Kh(n,u){return n=n|0,u=u|0,((c[u+4>>2]|0)==17896?n+12|0:0)|0}function gp(n){n=n|0,an(n,16)}function Qd(n,u){n=n|0,u=u|0,ua(n),c[n>>2]=5480,c[n+4>>2]=u,d2(n+8|0)}function Qu(n,u,v){n=n|0,u=u|0,v=v|0;var w=0,R=0;v=ee,ee=ee+16|0,w=v,c[n>>2]=u,R=Pi(16)|0,c[R+4>>2]=0,c[R+8>>2]=0,c[R>>2]=5504,c[R+12>>2]=u,c[n+4>>2]=R,c[w>>2]=u,c[w+4>>2]=u,fl(n,w),ee=v}function d2(n){n=n|0,Ss(n,16,1,8,0),ca(n+80|0,16,1,8,0),Z[n+160>>0]=0,Z[n+161>>0]=0,uy(n+162|0)}function qm(n){n=n|0,c[n>>2]=5480,_p(n+8|0),$r(n)}function mp(n){n=n|0,qm(n),Ai(n)}function p2(n,u){return n=n|0,u=u|0,hy(n+8|0,c[n+4>>2]|0,u)|0}function uy(n){n=n|0,Z[n+2>>0]=0}function _p(n){n=n|0,Br(n+80|0),as(n)}function hy(n,u,v){n=n|0,u=u|0,v=v|0;var w=0,R=0,N=0;return N=ee,ee=ee+16|0,w=N,Z[n+161>>0]|0||ss(n+80|0),R=n+162|0,yp(R)|0?(u=(Xu(n+80|0,u,Ft[R>>1]|0,0)|0)&65535,mt[w>>1]=u,Dh(u,v)):(qh(Hu(u)|0,v,2),mt[w>>1]=bc(v)|0),Rg(R,w),ee=N,v+2|0}function yp(n){return n=n|0,(Z[n+2>>0]|0)!=0|0}function Rg(n,u){n=n|0,u=u|0;var v=0;v=n+2|0,Z[v>>0]|0||(Z[v>>0]=1),mt[n>>1]=mt[u>>1]|0}function Cg(n){n=n|0,ma(n),Ai(n)}function fy(n){n=n|0,n=c[n+12>>2]|0,n|0&&Jr[c[(c[n>>2]|0)+4>>2]&255](n)}function ef(n,u){return n=n|0,u=u|0,((c[u+4>>2]|0)==18394?n+12|0:0)|0}function Ym(n){n=n|0,an(n,16)}function dy(){}function Pg(n){return n=n|0,L(n)|0}function Jm(){return 0}function py(){return 0}function Ig(n){n=n|0,n|0&&(X(n),Ai(n))}function d(){return ae()|0}function m(){return Te()|0}function A(){return qe()|0}function P(){return 0}function L(n){return n=n|0,3360}function X(n){n=n|0;var u=0,v=0,w=0,R=0;u=ee,ee=ee+16|0,w=u,c[w>>2]=c[n>>2],c[n>>2]=0,v=n+4|0,c[w+4>>2]=c[v>>2],c[v>>2]=0,nl(w),v=n+8|0,c[w>>2]=c[v>>2],c[v>>2]=0,R=n+12|0,c[w+4>>2]=c[R>>2],c[R>>2]=0,Ca(w),Ca(v),nl(n),ee=u}function ae(){return 3360}function Te(){return 3368}function qe(){return 3384}function wt(){return 18579}function Lt(){return 18582}function $t(){return 18584}function It(){var n=0;return n=Pi(16)|0,Tt(n),n|0}function Nt(n){n=n|0;var u=0,v=0,w=0,R=0;u=ee,ee=ee+16|0,v=u,R=d()|0,w=Hi(v)|0,v=dr(v)|0,p0(R|0,w|0,v|0,wt()|0,12,n|0),ee=u}function Fi(n){return n=n|0,ft(cb[n&3]()|0)|0}function Hi(n){return n=n|0,1}function dr(n){return n=n|0,tt()|0}function ft(n){return n=n|0,n|0}function tt(){return 5524}function Tt(n){n=n|0,c[n>>2]=0,c[n+4>>2]=0,c[n+8>>2]=0,c[n+12>>2]=0}function Zt(n,u){n=n|0,u=u|0;var v=0,w=0,R=0,N=0,U=0;v=ee,ee=ee+16|0,w=v,R=v+8|0,U=c[u+4>>2]|0,c[w>>2]=c[u>>2],c[w+4>>2]=U,U=d()|0,N=Qn(R)|0,R=Ni(R)|0,u=N1()|0,Sl(U|0,n|0,N|0,R|0,u|0,4,ji(w)|0,0),ee=v}function Zi(n,u,v,w){n=n|0,u=u|0,v=v|0,w=w|0;var R=0,N=0;N=An(u)|0,u=c[n>>2]|0,R=c[n+4>>2]|0,n=N+(R>>1)|0,R&1&&(u=c[(c[n>>2]|0)+u>>2]|0),R=Gn(v)|0,N=Pc(w)|0,C2[u&15](n,R,N)}function Qn(n){return n=n|0,4}function Ni(n){return n=n|0,Qm()|0}function ji(n){n=n|0;var u=0,v=0;return u=Pi(8)|0,v=c[n+4>>2]|0,c[u>>2]=c[n>>2],c[u+4>>2]=v,u|0}function An(n){return n=n|0,n|0}function Gn(n){return n=n|0,n|0}function Pc(n){return n=n|0,n|0}function Qm(){return 144}function N1(){return 18587}function B1(n,u){n=n|0,u=u|0;var v=0,w=0,R=0,N=0,U=0;v=ee,ee=ee+16|0,w=v,R=v+8|0,U=c[u+4>>2]|0,c[w>>2]=c[u>>2],c[w+4>>2]=U,U=d()|0,N=Lx(R)|0,R=L1(R)|0,u=vp()|0,Sl(U|0,n|0,N|0,R|0,u|0,7,g2(w)|0,0),ee=v}function z1(n,u,v){n=n|0,u=u|0,v=v|0;var w=0,R=0;R=An(u)|0,u=c[n>>2]|0,w=c[n+4>>2]|0,n=R+(w>>1)|0,w&1&&(u=c[(c[n>>2]|0)+u>>2]|0),R=gy(v)|0,Ng[u&15](n,R)}function Lx(n){return n=n|0,3}function L1(n){return n=n|0,U1()|0}function g2(n){n=n|0;var u=0,v=0;return u=Pi(8)|0,v=c[n+4>>2]|0,c[u>>2]=c[n>>2],c[u+4>>2]=v,u|0}function gy(n){return n=n|0,n|0}function U1(){return 5528}function vp(){return 18593}function m2(n,u){n=n|0,u=u|0;var v=0,w=0,R=0,N=0,U=0;v=ee,ee=ee+16|0,w=v,R=v+8|0,U=c[u+4>>2]|0,c[w>>2]=c[u>>2],c[w+4>>2]=U,U=d()|0,N=_2(R)|0,R=my(R)|0,u=x2()|0,Sl(U|0,n|0,N|0,R|0,u|0,41,Km(w)|0,0),ee=v}function V1(n,u){n=n|0,u=u|0;var v=0,w=0,R=0,N=0;return w=ee,ee=ee+16|0,v=w,N=An(u)|0,u=c[n>>2]|0,R=c[n+4>>2]|0,n=N+(R>>1)|0,R&1&&(u=c[(c[n>>2]|0)+u>>2]|0),c[v>>2]=J1[u&15](n)|0,N=y2(v)|0,ee=w,N|0}function _2(n){return n=n|0,2}function my(n){return n=n|0,v2()|0}function Km(n){n=n|0;var u=0,v=0;return u=Pi(8)|0,v=c[n+4>>2]|0,c[u>>2]=c[n>>2],c[u+4>>2]=v,u|0}function y2(n){return n=n|0,c[n>>2]|0}function v2(){return 5540}function x2(){return 18598}function d3(){}function f(n){return n=n|0,k(n)|0}function a(){return 0}function h(){return 0}function y(n){n=n|0,n|0&&(F(n),Ai(n))}function b(){return V()|0}function S(){return H()|0}function E(){return Y()|0}function k(n){return n=n|0,3400}function F(n){n=n|0;var u=0,v=0,w=0,R=0;u=ee,ee=ee+16|0,w=u,c[w>>2]=c[n>>2],c[n>>2]=0,v=n+4|0,c[w+4>>2]=c[v>>2],c[v>>2]=0,K0(w),v=n+16|0,c[w>>2]=c[v>>2],c[v>>2]=0,R=n+20|0,c[w+4>>2]=c[R>>2],c[R>>2]=0,Zu(w),c[w>>2]=c[v>>2],c[v>>2]=0,c[w+4>>2]=c[R>>2],c[R>>2]=0,Zu(w),Zu(v),Cm(n+8|0),K0(n),ee=u}function V(){return 3400}function H(){return 3408}function Y(){return 3424}function K(){var n=0;return n=Pi(24)|0,we(n),n|0}function te(n){n=n|0;var u=0,v=0,w=0,R=0;u=ee,ee=ee+16|0,v=u,R=b()|0,w=le(v)|0,v=ue(v)|0,p0(R|0,w|0,v|0,wt()|0,13,n|0),ee=u}function oe(n){return n=n|0,xe(cb[n&3]()|0)|0}function le(n){return n=n|0,1}function ue(n){return n=n|0,De()|0}function xe(n){return n=n|0,n|0}function De(){return 5548}function we(n){n=n|0,c[n>>2]=0,c[n+4>>2]=0,c[n+8>>2]=0,c[n+12>>2]=0,c[n+16>>2]=0,c[n+20>>2]=0}function Ee(n,u){n=n|0,u=u|0;var v=0,w=0,R=0,N=0,U=0;v=ee,ee=ee+16|0,w=v,R=v+8|0,U=c[u+4>>2]|0,c[w>>2]=c[u>>2],c[w+4>>2]=U,U=b()|0,N=Ze(R)|0,R=yt(R)|0,u=N1()|0,Sl(U|0,n|0,N|0,R|0,u|0,5,Bt(w)|0,0),ee=v}function Ne(n,u,v,w){n=n|0,u=u|0,v=v|0,w=w|0;var R=0,N=0;N=Dt(u)|0,u=c[n>>2]|0,R=c[n+4>>2]|0,n=N+(R>>1)|0,R&1&&(u=c[(c[n>>2]|0)+u>>2]|0),R=Gn(v)|0,N=Pc(w)|0,C2[u&15](n,R,N)}function Ze(n){return n=n|0,4}function yt(n){return n=n|0,jt()|0}function Bt(n){n=n|0;var u=0,v=0;return u=Pi(8)|0,v=c[n+4>>2]|0,c[u>>2]=c[n>>2],c[u+4>>2]=v,u|0}function Dt(n){return n=n|0,n|0}function jt(){return 160}function ai(n,u){n=n|0,u=u|0;var v=0,w=0,R=0,N=0,U=0;v=ee,ee=ee+16|0,w=v,R=v+8|0,U=c[u+4>>2]|0,c[w>>2]=c[u>>2],c[w+4>>2]=U,U=b()|0,N=Ot(R)|0,R=Ct(R)|0,u=vp()|0,Sl(U|0,n|0,N|0,R|0,u|0,8,_i(w)|0,0),ee=v}function Qt(n,u,v){n=n|0,u=u|0,v=v|0;var w=0,R=0;R=Dt(u)|0,u=c[n>>2]|0,w=c[n+4>>2]|0,n=R+(w>>1)|0,w&1&&(u=c[(c[n>>2]|0)+u>>2]|0),R=Pc(v)|0,Ng[u&15](n,R)}function Ot(n){return n=n|0,3}function Ct(n){return n=n|0,pi()|0}function _i(n){n=n|0;var u=0,v=0;return u=Pi(8)|0,v=c[n+4>>2]|0,c[u>>2]=c[n>>2],c[u+4>>2]=v,u|0}function pi(){return 5552}function Ti(n,u){n=n|0,u=u|0;var v=0,w=0,R=0,N=0,U=0;v=ee,ee=ee+16|0,w=v,R=v+8|0,U=c[u+4>>2]|0,c[w>>2]=c[u>>2],c[w+4>>2]=U,U=b()|0,N=Bi(R)|0,R=Nn(R)|0,u=vp()|0,Sl(U|0,n|0,N|0,R|0,u|0,9,_n(w)|0,0),ee=v}function gi(n,u,v){n=n|0,u=u|0,v=v|0;var w=0,R=0;R=Dt(u)|0,u=c[n>>2]|0,w=c[n+4>>2]|0,n=R+(w>>1)|0,w&1&&(u=c[(c[n>>2]|0)+u>>2]|0),R=gy(v)|0,Ng[u&15](n,R)}function Bi(n){return n=n|0,3}function Nn(n){return n=n|0,qr()|0}function _n(n){n=n|0;var u=0,v=0;return u=Pi(8)|0,v=c[n+4>>2]|0,c[u>>2]=c[n>>2],c[u+4>>2]=v,u|0}function qr(){return 5564}function Qa(){El()}function Ys(){Yr()}function Yr(){Ur(22144)}function Ur(n){n=n|0;var u=0;u=ee,ee=ee+16|0,c[u>>2]=n,Hn(),ee=u}function Hn(){od(_s()|0,18653),Lp(Rs()|0,18658,1,1,0),Cr(18663),_l(18668),Ka(18680),yl(18694),su(18700),da(18715),ls(18719),Js(18732),ys(18737),pa(18751),Wf(18757),co(Ku()|0,18764),co(e_()|0,18776),wu(Kd()|0,4,18809),wu(xp()|0,2,18822),wu(kg()|0,4,18837),Vp(Dg()|0,18852),Og(18868),b2(18898),A2(18935),w2(18974),T2(19005),_y(19045),yy(19074),Zf(19112),j1(19142),b2(19181),A2(19213),w2(19246),T2(19279),_y(19313),yy(19346),G1(19380),Ux(19411),Vx(19443)}function _s(){return IC()|0}function Rs(){return PC()|0}function Cr(n){n=n|0;var u=0,v=0;u=ee,ee=ee+16|0,v=u,c[v>>2]=n,n=RC()|0,ns(n|0,c[v>>2]|0,1,-128<<24>>24|0,127<<24>>24|0),ee=u}function _l(n){n=n|0;var u=0,v=0;u=ee,ee=ee+16|0,v=u,c[v>>2]=n,n=EC()|0,ns(n|0,c[v>>2]|0,1,-128<<24>>24|0,127<<24>>24|0),ee=u}function Ka(n){n=n|0;var u=0,v=0;u=ee,ee=ee+16|0,v=u,c[v>>2]=n,n=TC()|0,ns(n|0,c[v>>2]|0,1,0,255),ee=u}function yl(n){n=n|0;var u=0,v=0;u=ee,ee=ee+16|0,v=u,c[v>>2]=n,n=AC()|0,ns(n|0,c[v>>2]|0,2,-32768<<16>>16|0,32767<<16>>16|0),ee=u}function su(n){n=n|0;var u=0,v=0;u=ee,ee=ee+16|0,v=u,c[v>>2]=n,n=xC()|0,ns(n|0,c[v>>2]|0,2,0,65535),ee=u}function da(n){n=n|0;var u=0,v=0;u=ee,ee=ee+16|0,v=u,c[v>>2]=n,n=yC()|0,ns(n|0,c[v>>2]|0,4,-2147483648,2147483647),ee=u}function ls(n){n=n|0;var u=0,v=0;u=ee,ee=ee+16|0,v=u,c[v>>2]=n,n=mC()|0,ns(n|0,c[v>>2]|0,4,0,-1),ee=u}function Js(n){n=n|0;var u=0,v=0;u=ee,ee=ee+16|0,v=u,c[v>>2]=n,n=pC()|0,ns(n|0,c[v>>2]|0,4,-2147483648,2147483647),ee=u}function ys(n){n=n|0;var u=0,v=0;u=ee,ee=ee+16|0,v=u,c[v>>2]=n,n=fC()|0,ns(n|0,c[v>>2]|0,4,0,-1),ee=u}function pa(n){n=n|0;var u=0,v=0;u=ee,ee=ee+16|0,v=u,c[v>>2]=n,n=uC()|0,ad(n|0,c[v>>2]|0,4),ee=u}function Wf(n){n=n|0;var u=0,v=0;u=ee,ee=ee+16|0,v=u,c[v>>2]=n,n=lC()|0,ad(n|0,c[v>>2]|0,8),ee=u}function Ku(){return oC()|0}function e_(){return aC()|0}function Kd(){return sC()|0}function xp(){return rC()|0}function kg(){return nC()|0}function Dg(){return iC()|0}function Og(n){n=n|0;var u=0,v=0,w=0;u=ee,ee=ee+16|0,v=u,c[v>>2]=n,w=KR()|0,n=eC()|0,ks(w|0,n|0,c[v>>2]|0),ee=u}function b2(n){n=n|0;var u=0,v=0,w=0;u=ee,ee=ee+16|0,v=u,c[v>>2]=n,w=YR()|0,n=JR()|0,ks(w|0,n|0,c[v>>2]|0),ee=u}function A2(n){n=n|0;var u=0,v=0,w=0;u=ee,ee=ee+16|0,v=u,c[v>>2]=n,w=HR()|0,n=$R()|0,ks(w|0,n|0,c[v>>2]|0),ee=u}function w2(n){n=n|0;var u=0,v=0,w=0;u=ee,ee=ee+16|0,v=u,c[v>>2]=n,w=WR()|0,n=ZR()|0,ks(w|0,n|0,c[v>>2]|0),ee=u}function T2(n){n=n|0;var u=0,v=0,w=0;u=ee,ee=ee+16|0,v=u,c[v>>2]=n,w=VR()|0,n=jR()|0,ks(w|0,n|0,c[v>>2]|0),ee=u}function _y(n){n=n|0;var u=0,v=0,w=0;u=ee,ee=ee+16|0,v=u,c[v>>2]=n,w=zR()|0,n=LR()|0,ks(w|0,n|0,c[v>>2]|0),ee=u}function yy(n){n=n|0;var u=0,v=0,w=0;u=ee,ee=ee+16|0,v=u,c[v>>2]=n,w=th()|0,n=Ap()|0,ks(w|0,n|0,c[v>>2]|0),ee=u}function Zf(n){n=n|0;var u=0,v=0,w=0;u=ee,ee=ee+16|0,v=u,c[v>>2]=n,w=To()|0,n=Ic()|0,ks(w|0,n|0,c[v>>2]|0),ee=u}function j1(n){n=n|0;var u=0,v=0,w=0;u=ee,ee=ee+16|0,v=u,c[v>>2]=n,w=$x()|0,n=qx()|0,ks(w|0,n|0,c[v>>2]|0),ee=u}function G1(n){n=n|0;var u=0,v=0,w=0;u=ee,ee=ee+16|0,v=u,c[v>>2]=n,w=eh()|0,n=vy()|0,ks(w|0,n|0,c[v>>2]|0),ee=u}function Ux(n){n=n|0;var u=0,v=0,w=0;u=ee,ee=ee+16|0,v=u,c[v>>2]=n,w=Zx()|0,n=Xx()|0,ks(w|0,n|0,c[v>>2]|0),ee=u}function Vx(n){n=n|0;var u=0,v=0,w=0;u=ee,ee=ee+16|0,v=u,c[v>>2]=n,w=jx()|0,n=Gx()|0,ks(w|0,n|0,c[v>>2]|0),ee=u}function jx(){return Wx()|0}function Gx(){return 7}function Wx(){return 3440}function Zx(){return Hx()|0}function Xx(){return 7}function Hx(){return 3448}function eh(){return W1()|0}function vy(){return 6}function W1(){return 3456}function $x(){return Yx()|0}function qx(){return 5}function Yx(){return 3464}function To(){return bp()|0}function Ic(){return 4}function bp(){return 3472}function th(){return tf()|0}function Ap(){return 5}function tf(){return 3480}function zR(){return UR()|0}function LR(){return 4}function UR(){return 3488}function VR(){return GR()|0}function jR(){return 3}function GR(){return 3496}function WR(){return XR()|0}function ZR(){return 2}function XR(){return 3504}function HR(){return qR()|0}function $R(){return 1}function qR(){return 3512}function YR(){return QR()|0}function JR(){return 0}function QR(){return 3520}function KR(){return tC()|0}function eC(){return 0}function tC(){return 3528}function iC(){return 3536}function nC(){return 3544}function rC(){return 3576}function sC(){return 3600}function aC(){return 3624}function oC(){return 3648}function lC(){return cC()|0}function cC(){return 4144}function uC(){return hC()|0}function hC(){return 4136}function fC(){return dC()|0}function dC(){return 4128}function pC(){return gC()|0}function gC(){return 4120}function mC(){return _C()|0}function _C(){return 4112}function yC(){return vC()|0}function vC(){return 4104}function xC(){return bC()|0}function bC(){return 4096}function AC(){return wC()|0}function wC(){return 4088}function TC(){return SC()|0}function SC(){return 4072}function EC(){return MC()|0}function MC(){return 4080}function RC(){return CC()|0}function CC(){return 4064}function PC(){return 4056}function IC(){return 4040}function kC(n){n=n|0;var u=0,v=0,w=0,R=0;return u=ee,ee=ee+16|0,v=u+8|0,w=u+4|0,R=u,c[R>>2]=n,c[w>>2]=c[R>>2],c[v>>2]=c[(c[w>>2]|0)+4>>2],n=QC(c[v>>2]|0)|0,ee=u,n|0}function e0(){return 21636}function S2(n){return n=n|0,(n+-48|0)>>>0<10|0}function p3(){return 5576}function g3(n,u){n=n|0,u=u|0;var v=0,w=0;if(v=Z[n>>0]|0,w=Z[u>>0]|0,v<<24>>24==0||v<<24>>24!=w<<24>>24)n=w;else{do n=n+1|0,u=u+1|0,v=Z[n>>0]|0,w=Z[u>>0]|0;while(!(v<<24>>24==0||v<<24>>24!=w<<24>>24));n=w}return(v&255)-(n&255)|0}function Z1(n){n=n|0;var u=0,v=0,w=0;w=n;e:do if(!(w&3))v=5;else for(u=w;;){if(!(Z[n>>0]|0)){n=u;break e}if(n=n+1|0,u=n,!(u&3)){v=5;break}}while(!1);if((v|0)==5){for(;u=c[n>>2]|0,!((u&-2139062144^-2139062144)&u+-16843009);)n=n+4|0;if((u&255)<<24>>24)do n=n+1|0;while((Z[n>>0]|0)!=0)}return n-w|0}function DC(n){n=n|0}function OC(n){return n=n|0,1}function FC(n){n=n|0;var u=0,v=0;return u=n+74|0,v=Z[u>>0]|0,Z[u>>0]=v+255|v,u=c[n>>2]|0,u&8?(c[n>>2]=u|32,n=-1):(c[n+8>>2]=0,c[n+4>>2]=0,v=c[n+44>>2]|0,c[n+28>>2]=v,c[n+20>>2]=v,c[n+16>>2]=v+(c[n+48>>2]|0),n=0),n|0}function NC(n,u,v){n=n|0,u=u|0,v=v|0;var w=0,R=0,N=0,U=0,W=0;w=v+16|0,R=c[w>>2]|0,R?N=5:FC(v)|0?w=0:(R=c[w>>2]|0,N=5);e:do if((N|0)==5){if(W=v+20|0,U=c[W>>2]|0,w=U,(R-U|0)>>>0<u>>>0){w=wy[c[v+36>>2]&7](v,n,u)|0;break}t:do if((Z[v+75>>0]|0)<0|(u|0)==0)N=0,R=n;else{for(U=u;R=U+-1|0,(Z[n+R>>0]|0)!=10;)if(R)U=R;else{N=0,R=n;break t}if(w=wy[c[v+36>>2]&7](v,n,U)|0,w>>>0<U>>>0)break e;N=U,R=n+U|0,u=u-U|0,w=c[W>>2]|0}while(!1);rh(w|0,R|0,u|0)|0,c[W>>2]=(c[W>>2]|0)+u,w=N+u|0}while(!1);return w|0}function BC(n,u){return n=n|0,u=u|0,u?u=zC(c[u>>2]|0,c[u+4>>2]|0,n)|0:u=0,((u|0)==0?n:u)|0}function zC(n,u,v){n=n|0,u=u|0,v=v|0;var w=0,R=0,N=0,U=0,W=0,Q=0,ne=0,be=0,Se=0,je=0;je=(c[n>>2]|0)+1794895138|0,N=t_(c[n+8>>2]|0,je)|0,w=t_(c[n+12>>2]|0,je)|0,R=t_(c[n+16>>2]|0,je)|0;e:do if(N>>>0<u>>>2>>>0&&(Se=u-(N<<2)|0,w>>>0<Se>>>0&R>>>0<Se>>>0)&&((R|w)&3|0)==0){for(Se=w>>>2,be=R>>>2,ne=0;;){if(W=N>>>1,Q=ne+W|0,U=Q<<1,R=U+Se|0,w=t_(c[n+(R<<2)>>2]|0,je)|0,R=t_(c[n+(R+1<<2)>>2]|0,je)|0,!(R>>>0<u>>>0&w>>>0<(u-R|0)>>>0)){w=0;break e}if(Z[n+(R+w)>>0]|0){w=0;break e}if(w=g3(v,n+R|0)|0,!w)break;if(w=(w|0)<0,(N|0)==1){w=0;break e}ne=w?ne:Q,N=w?W:N-W|0}w=U+be|0,R=t_(c[n+(w<<2)>>2]|0,je)|0,w=t_(c[n+(w+1<<2)>>2]|0,je)|0,w>>>0<u>>>0&R>>>0<(u-w|0)>>>0?w=(Z[n+(w+R)>>0]|0)==0?n+w|0:0:w=0}else w=0;while(!1);return w|0}function t_(n,u){n=n|0,u=u|0;var v=0;return v=j3(n|0)|0,((u|0)==0?n:v)|0}function LC(n,u,v){n=n|0,u=u|0,v=v|0;var w=0,R=0,N=0;N=u&255,w=(v|0)!=0;e:do if(w&(n&3|0)!=0)for(R=u&255;;){if((Z[n>>0]|0)==R<<24>>24){R=6;break e}if(n=n+1|0,v=v+-1|0,w=(v|0)!=0,!(w&(n&3|0)!=0)){R=5;break}}else R=5;while(!1);(R|0)==5&&(w?R=6:n=0);e:do if((R|0)==6){if((Z[n>>0]|0)!=(u&255)<<24>>24){w=pn(N,16843009)|0;t:do if(v>>>0>3)do{if(N=c[n>>2]^w,(N&-2139062144^-2139062144)&N+-16843009|0)break t;n=n+4|0,v=v+-4|0}while(v>>>0>3);while(!1)}if(!v)n=0;else for(w=u&255;;){if((Z[n>>0]|0)==w<<24>>24)break e;if(v=v+-1|0,v)n=n+1|0;else{n=0;break}}}while(!1);return n|0}function UC(n,u,v){return n=n|0,u=u|0,v=v|0,GC(n,u,v,1,8)|0}function VC(n,u,v,w,R,N){n=n|0,u=+u,v=v|0,w=w|0,R=R|0,N=N|0;var U=0,W=0,Q=0,ne=0,be=0,Se=0,je=0,ct=0,vt=0,ot=0,nn=0,ui=0,Jt=0,Di=0,Mt=0,pr=0,zs=0,gr=0,Cn=0,vs=0,ln=0,dn=0,Hf=0;Hf=ee,ee=ee+560|0,Q=Hf+32|0,ui=Hf+536|0,dn=Hf,ln=dn,ne=Hf+540|0,c[ui>>2]=0,vs=ne+12|0,v3(u)|0,U=Dn()|0,(U|0)<0?(u=-u,v3(u)|0,Cn=1,gr=20247,U=Dn()|0):(Cn=(R&2049|0)!=0&1,gr=(R&2048|0)==0?(R&1|0)==0?20248:20253:20250);do if(!0&(U&2146435072|0)==2146435072)dn=(N&32|0)!=0,U=Cn+3|0,Yo(n,32,v,U,R&-65537),So(n,gr,Cn),So(n,u!=u|!1?dn?20274:20278:dn?20266:20270,3),Yo(n,32,v,U,R^8192);else{if(ct=+x3(u,ui)*2,U=ct!=0,U&&(c[ui>>2]=(c[ui>>2]|0)+-1),nn=N|32,(nn|0)==97){Se=N&32,vt=(Se|0)==0?gr:gr+9|0,je=Cn|2,U=12-w|0;do if(w>>>0>11|(U|0)==0)u=ct;else{u=8;do U=U+-1|0,u=u*16;while((U|0)!=0);if((Z[vt>>0]|0)==45){u=-(u+(-ct-u));break}else{u=ct+u-u;break}}while(!1);W=c[ui>>2]|0,U=(W|0)<0?0-W|0:W,U=xy(U,((U|0)<0)<<31>>31,vs)|0,(U|0)==(vs|0)&&(U=ne+11|0,Z[U>>0]=48),Z[U+-1>>0]=(W>>31&2)+43,be=U+-2|0,Z[be>>0]=N+15,W=(w|0)<1,Q=(R&8|0)==0,ne=dn;do Cn=~~u,U=ne+1|0,Z[ne>>0]=Se|Re[640+Cn>>0],u=(u-+(Cn|0))*16,(U-ln|0)==1&&!(Q&(W&u==0))?(Z[U>>0]=46,ne=ne+2|0):ne=U;while(u!=0);(w|0)!=0&&(-2-ln+ne|0)<(w|0)?(W=vs,Q=be,U=w+2+W-Q|0):(W=vs,Q=be,U=W-ln-Q+ne|0),vs=U+je|0,Yo(n,32,v,vs,R),So(n,vt,je),Yo(n,48,v,vs,R^65536),ln=ne-ln|0,So(n,dn,ln),dn=W-Q|0,Yo(n,48,U-(ln+dn)|0,0,0),So(n,be,dn),Yo(n,32,v,vs,R^8192),U=vs;break}W=(w|0)<0?6:w,U?(U=(c[ui>>2]|0)+-28|0,c[ui>>2]=U,u=ct*268435456):(u=ct,U=c[ui>>2]|0),zs=(U|0)<0?Q:Q+288|0,Q=zs;do Mt=~~u>>>0,c[Q>>2]=Mt,Q=Q+4|0,u=(u-+(Mt>>>0))*1e9;while(u!=0);if(Mt=zs,(U|0)>0)for(Se=zs;;){if(be=(U|0)<29?U:29,U=Q+-4|0,U>>>0>=Se>>>0){ne=0;do ot=U3(c[U>>2]|0,0,be|0)|0,ot=nf(ot|0,Dn()|0,ne|0,0)|0,Jt=Dn()|0,ne=ab(ot|0,Jt|0,1e9,0)|0,Di=sb(ne|0,Dn()|0,1e9,0)|0,Di=Ay(ot|0,Jt|0,Di|0,Dn()|0)|0,Dn()|0,c[U>>2]=Di,U=U+-4|0;while(U>>>0>=Se>>>0);ne?(Di=Se+-4|0,c[Di>>2]=ne,ne=Di):ne=Se}else ne=Se;e:do if(Q>>>0>ne>>>0)for(U=Q;;){if(Q=U+-4|0,c[Q>>2]|0){Q=U;break e}if(Q>>>0>ne>>>0)U=Q;else break}while(!1);if(U=(c[ui>>2]|0)-be|0,c[ui>>2]=U,(U|0)>0)Se=ne;else break}else ne=zs;if((U|0)<0){w=((W+25|0)/9|0)+1|0,ot=(nn|0)==102;do{if(vt=0-U|0,vt=(vt|0)<9?vt:9,ne>>>0<Q>>>0){be=(1<<vt)+-1|0,Se=1e9>>>vt,je=0,U=ne;do Di=c[U>>2]|0,c[U>>2]=(Di>>>vt)+je,je=pn(Di&be,Se)|0,U=U+4|0;while(U>>>0<Q>>>0);ne=(c[ne>>2]|0)==0?ne+4|0:ne,je&&(c[Q>>2]=je,Q=Q+4|0)}else ne=(c[ne>>2]|0)==0?ne+4|0:ne;U=ot?zs:ne,Q=(Q-U>>2|0)>(w|0)?U+(w<<2)|0:Q,U=(c[ui>>2]|0)+vt|0,c[ui>>2]=U}while((U|0)<0);ot=ne}else ot=ne;if(ot>>>0<Q>>>0){if(U=(Mt-ot>>2)*9|0,be=c[ot>>2]|0,be>>>0>=10){ne=10;do ne=ne*10|0,U=U+1|0;while(be>>>0>=ne>>>0)}}else U=0;if(Jt=(nn|0)==103,Di=(W|0)!=0,ne=W-((nn|0)==102?0:U)+((Di&Jt)<<31>>31)|0,(ne|0)<(((Q-Mt>>2)*9|0)+-9|0)){if(ui=ne+9216|0,ne=(ui|0)/9|0,w=zs+4+(ne+-1024<<2)|0,ne=ui-(ne*9|0)|0,(ne|0)<8)for(be=10;be=be*10|0,(ne|0)<7;)ne=ne+1|0;else be=10;if(je=c[w>>2]|0,ne=(je>>>0)/(be>>>0)|0,vt=je-(pn(ne,be)|0)|0,Se=(w+4|0)==(Q|0),Se&(vt|0)==0)ne=w,be=ot;else if(ct=(ne&1|0)==0?9007199254740992:9007199254740994,ui=be>>>1,u=vt>>>0<ui>>>0?.5:Se&(vt|0)==(ui|0)?1:1.5,Cn&&(ui=(Z[gr>>0]|0)==45,u=ui?-u:u,ct=ui?-ct:ct),ne=je-vt|0,c[w>>2]=ne,ct+u!=ct){if(ui=ne+be|0,c[w>>2]=ui,ui>>>0>999999999)for(be=w,U=ot;;)if(ne=be+-4|0,c[be>>2]=0,ne>>>0<U>>>0&&(U=U+-4|0,c[U>>2]=0),ui=(c[ne>>2]|0)+1|0,c[ne>>2]=ui,ui>>>0>999999999)be=ne;else{be=U;break}else ne=w,be=ot;if(U=(Mt-be>>2)*9|0,je=c[be>>2]|0,je>>>0>=10){Se=10;do Se=Se*10|0,U=U+1|0;while(je>>>0>=Se>>>0)}}else ne=w,be=ot;ui=ne+4|0,Q=Q>>>0>ui>>>0?ui:Q}else be=ot;w=0-U|0;e:do if(Q>>>0>be>>>0)for(;;){if(ne=Q+-4|0,c[ne>>2]|0){ui=Q,nn=1;break e}if(ne>>>0>be>>>0)Q=ne;else{ui=ne,nn=0;break}}else ui=Q,nn=0;while(!1);do if(Jt){if(W=W+((Di^1)&1)|0,(W|0)>(U|0)&(U|0)>-5?(Se=N+-1|0,W=W+-1-U|0):(Se=N+-2|0,W=W+-1|0),!(R&8)){if(nn&&(pr=c[ui+-4>>2]|0,(pr|0)!=0))if((pr>>>0)%10|0)ne=0;else{ne=0,Q=10;do Q=Q*10|0,ne=ne+1|0;while(!((pr>>>0)%(Q>>>0)|0|0))}else ne=9;if(Q=((ui-Mt>>2)*9|0)+-9|0,(Se|32|0)==102){N=Q-ne|0,N=(N|0)>0?N:0,W=(W|0)<(N|0)?W:N;break}else{N=Q+U-ne|0,N=(N|0)>0?N:0,W=(W|0)<(N|0)?W:N;break}}}else Se=N;while(!1);if(ot=(W|0)!=0,je=ot?1:R>>>3&1,vt=(Se|32|0)==102,vt)Jt=0,U=(U|0)>0?U:0;else{if(Q=(U|0)<0?w:U,Q=xy(Q,((Q|0)<0)<<31>>31,vs)|0,ne=vs,(ne-Q|0)<2)do Q=Q+-1|0,Z[Q>>0]=48;while((ne-Q|0)<2);Z[Q+-1>>0]=(U>>31&2)+43,U=Q+-2|0,Z[U>>0]=Se,Jt=U,U=ne-U|0}if(U=Cn+1+W+je+U|0,Yo(n,32,v,U,R),So(n,gr,Cn),Yo(n,48,v,U,R^65536),vt){je=be>>>0>zs>>>0?zs:be,vt=dn+9|0,be=vt,Se=dn+8|0,ne=je;do{if(Q=xy(c[ne>>2]|0,0,vt)|0,(ne|0)==(je|0))(Q|0)==(vt|0)&&(Z[Se>>0]=48,Q=Se);else if(Q>>>0>dn>>>0){a_(dn|0,48,Q-ln|0)|0;do Q=Q+-1|0;while(Q>>>0>dn>>>0)}So(n,Q,be-Q|0),ne=ne+4|0}while(ne>>>0<=zs>>>0);if((R&8|0)==0&(ot^1)||So(n,20282,1),ne>>>0<ui>>>0&(W|0)>0)for(;;){if(Q=xy(c[ne>>2]|0,0,vt)|0,Q>>>0>dn>>>0){a_(dn|0,48,Q-ln|0)|0;do Q=Q+-1|0;while(Q>>>0>dn>>>0)}if(So(n,Q,(W|0)<9?W:9),ne=ne+4|0,Q=W+-9|0,ne>>>0<ui>>>0&(W|0)>9)W=Q;else{W=Q;break}}Yo(n,48,W+9|0,9,0)}else{if(ui=nn?ui:be+4|0,be>>>0<ui>>>0&(W|0)>-1){w=dn+9|0,ot=(R&8|0)==0,nn=w,je=0-ln|0,vt=dn+8|0,Se=be;do{Q=xy(c[Se>>2]|0,0,w)|0,(Q|0)==(w|0)&&(Z[vt>>0]=48,Q=vt);do if((Se|0)==(be|0)){if(ne=Q+1|0,So(n,Q,1),ot&(W|0)<1){Q=ne;break}So(n,20282,1),Q=ne}else{if(Q>>>0<=dn>>>0)break;a_(dn|0,48,Q+je|0)|0;do Q=Q+-1|0;while(Q>>>0>dn>>>0)}while(!1);ln=nn-Q|0,So(n,Q,(W|0)>(ln|0)?ln:W),W=W-ln|0,Se=Se+4|0}while(Se>>>0<ui>>>0&(W|0)>-1)}Yo(n,48,W+18|0,18,0),So(n,Jt,vs-Jt|0)}Yo(n,32,v,U,R^8192)}while(!1);return ee=Hf,((U|0)<(v|0)?v:U)|0}function jC(n,u){n=n|0,u=u|0;var v=0,w=0;w=(c[u>>2]|0)+7&-8,v=+si[w>>3],c[u>>2]=w+8,si[n>>3]=v}function GC(n,u,v,w,R){n=n|0,u=u|0,v=v|0,w=w|0,R=R|0;var N=0,U=0,W=0,Q=0,ne=0,be=0,Se=0,je=0,ct=0,vt=0,ot=0,nn=0,ui=0;ui=ee,ee=ee+224|0,ct=ui+208|0,vt=ui+160|0,ot=ui+80|0,nn=ui,N=vt,U=N+40|0;do c[N>>2]=0,N=N+4|0;while((N|0)<(U|0));return c[ct>>2]=c[v>>2],(Jx(0,u,ct,ot,vt,w,R)|0)<0?v=-1:((c[n+76>>2]|0)>-1?je=OC(n)|0:je=0,v=c[n>>2]|0,Se=v&32,(Z[n+74>>0]|0)<1&&(c[n>>2]=v&-33),N=n+48|0,c[N>>2]|0?v=Jx(n,u,ct,ot,vt,w,R)|0:(U=n+44|0,W=c[U>>2]|0,c[U>>2]=nn,Q=n+28|0,c[Q>>2]=nn,ne=n+20|0,c[ne>>2]=nn,c[N>>2]=80,be=n+16|0,c[be>>2]=nn+80,v=Jx(n,u,ct,ot,vt,w,R)|0,W&&(wy[c[n+36>>2]&7](n,0,0)|0,v=(c[ne>>2]|0)==0?-1:v,c[U>>2]=W,c[N>>2]=0,c[be>>2]=0,c[Q>>2]=0,c[ne>>2]=0)),N=c[n>>2]|0,c[n>>2]=N|Se,je|0&&DC(n),v=(N&32|0)==0?v:-1),ee=ui,v|0}function Jx(n,u,v,w,R,N,U){n=n|0,u=u|0,v=v|0,w=w|0,R=R|0,N=N|0,U=U|0;var W=0,Q=0,ne=0,be=0,Se=0,je=0,ct=0,vt=0,ot=0,nn=0,ui=0,Jt=0,Di=0,Mt=0,pr=0,zs=0,gr=0,Cn=0,vs=0,ln=0,dn=0,Hf=0,Qs=0,l_=0,sf=0;l_=ee,ee=ee+64|0,dn=l_+56|0,Qs=l_+40|0,zs=l_,Cn=l_+48|0,vs=l_+60|0,c[dn>>2]=u,Di=(n|0)!=0,Mt=zs+40|0,pr=Mt,zs=zs+39|0,gr=Cn+4|0,W=0,u=0,ne=0;e:for(;;){do{do if((u|0)>-1)if((W|0)>(2147483647-u|0)){c[(e0()|0)>>2]=61,u=-1;break}else{u=W+u|0;break}while(!1);if(ct=c[dn>>2]|0,W=Z[ct>>0]|0,!(W<<24>>24)){Jt=92;break e}Q=ct;t:for(;;){switch(W<<24>>24){case 37:{Jt=10;break t}case 0:{W=Q;break t}default:}ui=Q+1|0,c[dn>>2]=ui,W=Z[ui>>0]|0,Q=ui}t:do if((Jt|0)==10){Jt=0,W=Q;do{if((Z[Q+1>>0]|0)!=37)break t;W=W+1|0,Q=Q+2|0,c[dn>>2]=Q}while((Z[Q>>0]|0)==37)}while(!1);W=W-ct|0,Di&&So(n,ct,W)}while((W|0)!=0);if(ui=(S2(Z[(c[dn>>2]|0)+1>>0]|0)|0)==0,Q=c[dn>>2]|0,!ui&&(Z[Q+2>>0]|0)==36?(ot=(Z[Q+1>>0]|0)+-48|0,Se=1,W=3):(ot=-1,Se=ne,W=1),W=Q+W|0,c[dn>>2]=W,Q=Z[W>>0]|0,ne=(Q<<24>>24)+-32|0,ne>>>0>31|(1<<ne&75913|0)==0)be=0;else{be=0;do be=1<<ne|be,W=W+1|0,c[dn>>2]=W,Q=Z[W>>0]|0,ne=(Q<<24>>24)+-32|0;while(!(ne>>>0>31|(1<<ne&75913|0)==0))}if(Q<<24>>24==42){if((S2(Z[W+1>>0]|0)|0)!=0&&(Hf=c[dn>>2]|0,(Z[Hf+2>>0]|0)==36))W=Hf+1|0,c[R+((Z[W>>0]|0)+-48<<2)>>2]=10,W=c[w+((Z[W>>0]|0)+-48<<3)>>2]|0,ne=1,Q=Hf+3|0;else{if(Se|0){u=-1;break}Di?(ui=(c[v>>2]|0)+3&-4,W=c[ui>>2]|0,c[v>>2]=ui+4):W=0,ne=0,Q=(c[dn>>2]|0)+1|0}c[dn>>2]=Q,ui=(W|0)<0,nn=ui?0-W|0:W,be=ui?be|8192:be,ui=ne}else{if(W=m3(dn)|0,(W|0)<0){u=-1;break}nn=W,ui=Se,Q=c[dn>>2]|0}do if((Z[Q>>0]|0)==46){if(W=Q+1|0,(Z[W>>0]|0)!=42){c[dn>>2]=W,W=m3(dn)|0,Q=c[dn>>2]|0;break}if(S2(Z[Q+2>>0]|0)|0&&(ln=c[dn>>2]|0,(Z[ln+3>>0]|0)==36)){W=ln+2|0,c[R+((Z[W>>0]|0)+-48<<2)>>2]=10,W=c[w+((Z[W>>0]|0)+-48<<3)>>2]|0,Q=ln+4|0,c[dn>>2]=Q;break}if(ui|0){u=-1;break e}Di?(vt=(c[v>>2]|0)+3&-4,W=c[vt>>2]|0,c[v>>2]=vt+4):W=0,Q=(c[dn>>2]|0)+2|0,c[dn>>2]=Q}else W=-1;while(!1);for(vt=0;;){if(((Z[Q>>0]|0)+-65|0)>>>0>57){u=-1;break e}if(ne=Q,Q=Q+1|0,c[dn>>2]=Q,ne=Z[(Z[ne>>0]|0)+-65+(176+(vt*58|0))>>0]|0,Se=ne&255,(Se+-1|0)>>>0>=8)break;vt=Se}if(!(ne<<24>>24)){u=-1;break}je=(ot|0)>-1;do if(ne<<24>>24==19)if(je){u=-1;break e}else Jt=54;else{if(je){c[R+(ot<<2)>>2]=Se,je=w+(ot<<3)|0,ot=c[je+4>>2]|0,Jt=Qs,c[Jt>>2]=c[je>>2],c[Jt+4>>2]=ot,Jt=54;break}if(!Di){u=0;break e}_3(Qs,Se,v,U),Q=c[dn>>2]|0,Jt=55}while(!1);(Jt|0)==54&&(Jt=0,Di?Jt=55:W=0);t:do if((Jt|0)==55){Jt=0,Q=Z[Q+-1>>0]|0,Q=(vt|0)!=0&(Q&15|0)==3?Q&-33:Q,ne=be&-65537,ot=(be&8192|0)==0?be:ne;i:do switch(Q|0){case 110:switch((vt&255)<<24>>24){case 0:{c[c[Qs>>2]>>2]=u,W=0;break t}case 1:{c[c[Qs>>2]>>2]=u,W=0;break t}case 2:{W=c[Qs>>2]|0,c[W>>2]=u,c[W+4>>2]=((u|0)<0)<<31>>31,W=0;break t}case 3:{mt[c[Qs>>2]>>1]=u,W=0;break t}case 4:{Z[c[Qs>>2]>>0]=u,W=0;break t}case 6:{c[c[Qs>>2]>>2]=u,W=0;break t}case 7:{W=c[Qs>>2]|0,c[W>>2]=u,c[W+4>>2]=((u|0)<0)<<31>>31,W=0;break t}default:{W=0;break t}}case 112:{Q=120,W=W>>>0>8?W:8,ne=ot|8,Jt=67;break}case 88:case 120:{ne=ot,Jt=67;break}case 111:{je=Qs,je=ZC(c[je>>2]|0,c[je+4>>2]|0,Mt)|0,ne=pr-je|0,be=0,Se=20230,W=(ot&8|0)==0|(W|0)>(ne|0)?W:ne+1|0,ne=ot,Jt=73;break}case 105:case 100:if(ne=Qs,Q=c[ne>>2]|0,ne=c[ne+4>>2]|0,(ne|0)<0){Q=Ay(0,0,Q|0,ne|0)|0,ne=Dn()|0,be=Qs,c[be>>2]=Q,c[be+4>>2]=ne,be=1,Se=20230,Jt=72;break i}else{be=(ot&2049|0)!=0&1,Se=(ot&2048|0)==0?(ot&1|0)==0?20230:20232:20231,Jt=72;break i}case 117:{ne=Qs,be=0,Se=20230,Q=c[ne>>2]|0,ne=c[ne+4>>2]|0,Jt=72;break}case 99:{Z[zs>>0]=c[Qs>>2],ct=zs,be=0,Se=20230,je=1,Q=ne,W=pr;break}case 115:{vt=c[Qs>>2]|0,vt=(vt|0)==0?20240:vt,ot=LC(vt,0,W)|0,sf=(ot|0)==0,ct=vt,be=0,Se=20230,je=sf?W:ot-vt|0,Q=ne,W=sf?vt+W|0:ot;break}case 67:{c[Cn>>2]=c[Qs>>2],c[gr>>2]=0,c[Qs>>2]=Cn,Se=-1,Jt=79;break}case 83:{W?(Se=W,Jt=79):(Yo(n,32,nn,0,ot),W=0,Jt=89);break}case 65:case 71:case 70:case 69:case 97:case 103:case 102:case 101:{W=X3[N&1](n,+si[Qs>>3],nn,W,ot,Q)|0;break t}default:be=0,Se=20230,je=W,Q=ot,W=pr}while(!1);i:do if((Jt|0)==67)je=Qs,je=WC(c[je>>2]|0,c[je+4>>2]|0,Mt,Q&32)|0,Se=Qs,Se=(ne&8|0)==0|(c[Se>>2]|0)==0&(c[Se+4>>2]|0)==0,be=Se?0:2,Se=Se?20230:20230+(Q>>>4)|0,Jt=73;else if((Jt|0)==72)je=xy(Q,ne,Mt)|0,ne=ot,Jt=73;else if((Jt|0)==79){for(Jt=0,be=c[Qs>>2]|0,W=0;Q=c[be>>2]|0,!!Q;){if(Q=y3(vs,Q)|0,ne=(Q|0)<0,ne|Q>>>0>(Se-W|0)>>>0){Jt=83;break}if(W=Q+W|0,Se>>>0>W>>>0)be=be+4|0;else break}if((Jt|0)==83&&(Jt=0,ne)){u=-1;break e}if(Yo(n,32,nn,W,ot),!W)W=0,Jt=89;else for(ne=c[Qs>>2]|0,be=0;;){if(Q=c[ne>>2]|0,!Q){Jt=89;break i}if(Q=y3(vs,Q)|0,be=Q+be|0,(be|0)>(W|0)){Jt=89;break i}if(So(n,vs,Q),be>>>0>=W>>>0){Jt=89;break}else ne=ne+4|0}}while(!1);if((Jt|0)==73)Jt=0,Q=Qs,Q=(c[Q>>2]|0)!=0|(c[Q+4>>2]|0)!=0,sf=(W|0)!=0|Q,Q=pr-je+((Q^1)&1)|0,ct=sf?je:Mt,je=sf?(W|0)>(Q|0)?W:Q:0,Q=(W|0)>-1?ne&-65537:ne,W=pr;else if((Jt|0)==89){Jt=0,Yo(n,32,nn,W,ot^8192),W=(nn|0)>(W|0)?nn:W;break}ot=W-ct|0,vt=(je|0)<(ot|0)?ot:je,sf=vt+be|0,W=(nn|0)<(sf|0)?sf:nn,Yo(n,32,W,sf,Q),So(n,Se,be),Yo(n,48,W,sf,Q^65536),Yo(n,48,vt,ot,0),So(n,ct,ot),Yo(n,32,W,sf,Q^8192)}while(!1);ne=ui}e:do if((Jt|0)==92&&!n)if(!ne)u=0;else{for(u=1;W=c[R+(u<<2)>>2]|0,!!W;)if(_3(w+(u<<3)|0,W,v,U),u=u+1|0,u>>>0>=10){u=1;break e}for(;;){if(c[R+(u<<2)>>2]|0){u=-1;break e}if(u=u+1|0,u>>>0>=10){u=1;break}}}while(!1);return ee=l_,u|0}function So(n,u,v){n=n|0,u=u|0,v=v|0,c[n>>2]&32||NC(u,v,n)|0}function m3(n){n=n|0;var u=0,v=0;if(!(S2(Z[c[n>>2]>>0]|0)|0))u=0;else{u=0;do v=c[n>>2]|0,u=(u*10|0)+-48+(Z[v>>0]|0)|0,v=v+1|0,c[n>>2]=v;while((S2(Z[v>>0]|0)|0)!=0)}return u|0}function _3(n,u,v,w){n=n|0,u=u|0,v=v|0,w=w|0;var R=0,N=0;e:do if(u>>>0<=20)do switch(u|0){case 9:{u=(c[v>>2]|0)+3&-4,w=c[u>>2]|0,c[v>>2]=u+4,c[n>>2]=w;break e}case 10:{w=(c[v>>2]|0)+3&-4,u=c[w>>2]|0,c[v>>2]=w+4,w=n,c[w>>2]=u,c[w+4>>2]=((u|0)<0)<<31>>31;break e}case 11:{w=(c[v>>2]|0)+3&-4,u=c[w>>2]|0,c[v>>2]=w+4,w=n,c[w>>2]=u,c[w+4>>2]=0;break e}case 12:{w=(c[v>>2]|0)+7&-8,u=w,R=c[u>>2]|0,u=c[u+4>>2]|0,c[v>>2]=w+8,w=n,c[w>>2]=R,c[w+4>>2]=u;break e}case 13:{R=(c[v>>2]|0)+3&-4,w=c[R>>2]|0,c[v>>2]=R+4,w=(w&65535)<<16>>16,R=n,c[R>>2]=w,c[R+4>>2]=((w|0)<0)<<31>>31;break e}case 14:{R=(c[v>>2]|0)+3&-4,w=c[R>>2]|0,c[v>>2]=R+4,R=n,c[R>>2]=w&65535,c[R+4>>2]=0;break e}case 15:{R=(c[v>>2]|0)+3&-4,w=c[R>>2]|0,c[v>>2]=R+4,w=(w&255)<<24>>24,R=n,c[R>>2]=w,c[R+4>>2]=((w|0)<0)<<31>>31;break e}case 16:{R=(c[v>>2]|0)+3&-4,w=c[R>>2]|0,c[v>>2]=R+4,R=n,c[R>>2]=w&255,c[R+4>>2]=0;break e}case 17:{R=(c[v>>2]|0)+7&-8,N=+si[R>>3],c[v>>2]=R+8,si[n>>3]=N;break e}case 18:{Ng[w&15](n,v);break e}default:break e}while(!1);while(!1)}function WC(n,u,v,w){if(n=n|0,u=u|0,v=v|0,w=w|0,!((n|0)==0&(u|0)==0))do v=v+-1|0,Z[v>>0]=Re[640+(n&15)>>0]|0|w,n=Y1(n|0,u|0,4)|0,u=Dn()|0;while(!((n|0)==0&(u|0)==0));return v|0}function ZC(n,u,v){if(n=n|0,u=u|0,v=v|0,!((n|0)==0&(u|0)==0))do v=v+-1|0,Z[v>>0]=n&7|48,n=Y1(n|0,u|0,3)|0,u=Dn()|0;while(!((n|0)==0&(u|0)==0));return v|0}function xy(n,u,v){n=n|0,u=u|0,v=v|0;var w=0,R=0,N=0;if(u>>>0>0|(u|0)==0&n>>>0>4294967295){do w=n,n=ab(n|0,u|0,10,0)|0,R=u,u=Dn()|0,N=sb(n|0,u|0,10,0)|0,N=Ay(w|0,R|0,N|0,Dn()|0)|0,Dn()|0,v=v+-1|0,Z[v>>0]=N&255|48;while(R>>>0>9|(R|0)==9&w>>>0>4294967295);u=n}else u=n;if(u)do N=u,u=(u>>>0)/10|0,v=v+-1|0,Z[v>>0]=N-(u*10|0)|48;while(N>>>0>=10);return v|0}function Yo(n,u,v,w,R){n=n|0,u=u|0,v=v|0,w=w|0,R=R|0;var N=0,U=0;if(U=ee,ee=ee+256|0,N=U,(v|0)>(w|0)&(R&73728|0)==0){if(R=v-w|0,a_(N|0,u<<24>>24|0,(R>>>0<256?R:256)|0)|0,R>>>0>255){u=v-w|0;do So(n,N,256),R=R+-256|0;while(R>>>0>255);R=u&255}So(n,N,R)}ee=U}function y3(n,u){return n=n|0,u=u|0,n?n=XC(n,u,0)|0:n=0,n|0}function XC(n,u,v){n=n|0,u=u|0,v=v|0;do if(n){if(u>>>0<128){Z[n>>0]=u,n=1;break}if(!(c[c[(HC()|0)+176>>2]>>2]|0))if((u&-128|0)==57216){Z[n>>0]=u,n=1;break}else{c[(e0()|0)>>2]=25,n=-1;break}if(u>>>0<2048){Z[n>>0]=u>>>6|192,Z[n+1>>0]=u&63|128,n=2;break}if(u>>>0<55296|(u&-8192|0)==57344){Z[n>>0]=u>>>12|224,Z[n+1>>0]=u>>>6&63|128,Z[n+2>>0]=u&63|128,n=3;break}if((u+-65536|0)>>>0<1048576){Z[n>>0]=u>>>18|240,Z[n+1>>0]=u>>>12&63|128,Z[n+2>>0]=u>>>6&63|128,Z[n+3>>0]=u&63|128,n=4;break}else{c[(e0()|0)>>2]=25,n=-1;break}}else n=1;while(!1);return n|0}function HC(){return p3()|0}function v3(n){n=+n;var u=0;return si[dt>>3]=n,u=c[dt>>2]|0,Ln(c[dt+4>>2]|0),u|0}function x3(n,u){n=+n,u=u|0;var v=0,w=0,R=0;switch(si[dt>>3]=n,v=c[dt>>2]|0,w=c[dt+4>>2]|0,R=Y1(v|0,w|0,52)|0,Dn()|0,R&2047){case 0:{n!=0?(n=+x3(n*18446744073709552e3,u),v=(c[u>>2]|0)+-64|0):v=0,c[u>>2]=v;break}case 2047:break;default:c[u>>2]=(R&2047)+-1022,c[dt>>2]=v,c[dt+4>>2]=w&-2146435073|1071644672,n=+si[dt>>3]}return+n}function $C(n,u,v){n=n|0,u=u|0,v=v|0;var w=0,R=0;e:do if(!v)n=0;else{for(;w=Z[n>>0]|0,R=Z[u>>0]|0,w<<24>>24==R<<24>>24;)if(v=v+-1|0,v)n=n+1|0,u=u+1|0;else{n=0;break e}n=(w&255)-(R&255)|0}while(!1);return n|0}function qC(n,u,v,w){n=n|0,u=u|0,v=v|0,w=w|0;var R=0,N=0;return R=ee,ee=ee+16|0,N=R,c[N>>2]=w,w=YC(n,u,v,N)|0,ee=R,w|0}function YC(n,u,v,w){n=n|0,u=u|0,v=v|0,w=w|0;var R=0,N=0,U=0,W=0;return W=ee,ee=ee+160|0,R=W+144|0,U=W,rh(U|0,3672,144)|0,(u+-1|0)>>>0>2147483646?u?(c[(e0()|0)>>2]=61,u=-1):(n=R,u=1,N=4):N=4,(N|0)==4&&(N=-2-n|0,N=u>>>0>N>>>0?N:u,c[U+48>>2]=N,R=U+20|0,c[R>>2]=n,c[U+44>>2]=n,u=n+N|0,n=U+16|0,c[n>>2]=u,c[U+28>>2]=u,u=UC(U,v,w)|0,N&&(U=c[R>>2]|0,Z[U+(((U|0)==(c[n>>2]|0))<<31>>31)>>0]=0)),ee=W,u|0}function JC(n,u,v){n=n|0,u=u|0,v=v|0;var w=0,R=0;return w=n+20|0,R=c[w>>2]|0,n=(c[n+16>>2]|0)-R|0,n=n>>>0>v>>>0?v:n,rh(R|0,u|0,n|0)|0,c[w>>2]=(c[w>>2]|0)+n,v|0}function QC(n){n=n|0;var u=0,v=0;return u=(Z1(n)|0)+1|0,v=q1(u)|0,v?n=rh(v|0,n|0,u|0)|0:n=0,n|0}function KC(n,u){n=n|0,u=u|0;var v=0,w=0;for(v=0;;){if((Re[656+v>>0]|0)==(n|0)){w=4;break}if(v=v+1|0,(v|0)==87){n=87,w=5;break}}if((w|0)==4&&(v?(n=v,w=5):v=752),(w|0)==5){v=752;do{do w=v,v=v+1|0;while((Z[w>>0]|0)!=0);n=n+-1|0}while((n|0)!=0)}return eP(v,c[u+20>>2]|0)|0}function eP(n,u){return n=n|0,u=u|0,BC(n,u)|0}function tP(n){return n=n|0,KC(n,c[(iP()|0)+176>>2]|0)|0}function iP(){return p3()|0}function nP(n,u,v){n=n|0,u=u|0,v=v|0;var w=0;return w=tP(n)|0,n=Z1(w)|0,n>>>0>=v>>>0?(n=v+-1|0,v&&(rh(u|0,w|0,n|0)|0,Z[u+n>>0]=0),n=68):(rh(u|0,w|0,n+1|0)|0,n=0),n|0}function rP(){var n=0,u=0,v=0,w=0,R=0,N=0,U=0;w=ee,ee=ee+48|0,N=w+32|0,u=w+24|0,U=w+16|0,R=w,w=w+36|0,n=b3()|0,n|0&&(v=c[n>>2]|0,v|0)&&(n=v+48|0,A3(n)|0||(c[u>>2]=20420,i_(20370,u)),u=w3(n)|0,(u|0)==1126902529&(Dn()|0)==1129074247?n=c[v+44>>2]|0:n=v+80|0,c[w>>2]=n,v=c[v>>2]|0,n=c[v+4>>2]|0,wy[c[(c[954]|0)+16>>2]&7](3816,v,w)|0?(U=c[w>>2]|0,U=J1[c[(c[U>>2]|0)+8>>2]&15](U)|0,c[R>>2]=20420,c[R+4>>2]=n,c[R+8>>2]=U,i_(20284,R)):(c[U>>2]=20420,c[U+4>>2]=n,i_(20329,U))),i_(20408,N)}function b3(){return 21640}function A3(n){return n=n|0,n=w3(n)|0,(n&-256|0)==1126902528&(Dn()|0)==1129074247|0}function w3(n){n=n|0;var u=0;return u=n,n=c[u>>2]|0,Ln(c[u+4>>2]|0),n|0}function i_(n,u){n=n|0,u=u|0,m0()}function by(n){n=n|0}function sP(n){n=n|0,by(n),Ai(n)}function aP(n){n=n|0}function oP(n){n=n|0}function lP(n,u,v){n=n|0,u=u|0,v=v|0;var w=0,R=0,N=0,U=0,W=0,Q=0;if(Q=ee,ee=ee+64|0,U=Q,ga(n,u,0)|0)n=1;else if((u|0)!=0&&(W=ih(u,3840,3824,0)|0,(W|0)!=0)){c[U>>2]=W,c[U+4>>2]=0,c[U+8>>2]=n,c[U+12>>2]=-1,n=U+16|0,u=U+24|0,w=U+48|0,R=n,N=R+36|0;do c[R>>2]=0,R=R+4|0;while((R|0)<(N|0));mt[n+36>>1]=0,Z[n+38>>0]=0,c[w>>2]=1,P2[c[(c[W>>2]|0)+28>>2]&7](W,U,c[v>>2]|0,1),(c[u>>2]|0)==1?(c[v>>2]=c[n>>2],n=1):n=0}else n=0;return ee=Q,n|0}function cP(n,u,v,w,R,N){n=n|0,u=u|0,v=v|0,w=w|0,R=R|0,N=N|0,ga(n,c[u+8>>2]|0,N)|0&&eb(0,u,v,w,R)}function uP(n,u,v,w,R){n=n|0,u=u|0,v=v|0,w=w|0,R=R|0;var N=0;do if(ga(n,c[u+8>>2]|0,R)|0)Kx(0,u,v,w);else if(ga(n,c[u>>2]|0,R)|0){if((c[u+16>>2]|0)!=(v|0)&&(N=u+20|0,(c[N>>2]|0)!=(v|0))){c[u+32>>2]=w,c[N>>2]=v,R=u+40|0,c[R>>2]=(c[R>>2]|0)+1,(c[u+36>>2]|0)==1&&(c[u+24>>2]|0)==2&&(Z[u+54>>0]=1),c[u+44>>2]=4;break}(w|0)==1&&(c[u+32>>2]=1)}while(!1)}function hP(n,u,v,w){n=n|0,u=u|0,v=v|0,w=w|0,ga(n,c[u+8>>2]|0,0)|0&&Qx(0,u,v,w)}function ga(n,u,v){return n=n|0,u=u|0,v=v|0,v?(n|0)==(u|0)?n=1:n=(g3(c[n+4>>2]|0,c[u+4>>2]|0)|0)==0:n=(c[n+4>>2]|0)==(c[u+4>>2]|0),n|0}function Qx(n,u,v,w){n=n|0,u=u|0,v=v|0,w=w|0;var R=0;n=u+16|0,R=c[n>>2]|0;do if(R){if((R|0)!=(v|0)){w=u+36|0,c[w>>2]=(c[w>>2]|0)+1,c[u+24>>2]=2,Z[u+54>>0]=1;break}n=u+24|0,(c[n>>2]|0)==2&&(c[n>>2]=w)}else c[n>>2]=v,c[u+24>>2]=w,c[u+36>>2]=1;while(!1)}function Kx(n,u,v,w){n=n|0,u=u|0,v=v|0,w=w|0;var R=0;(c[u+4>>2]|0)==(v|0)&&(R=u+28|0,(c[R>>2]|0)!=1)&&(c[R>>2]=w)}function eb(n,u,v,w,R){n=n|0,u=u|0,v=v|0,w=w|0,R=R|0,Z[u+53>>0]=1;do if((c[u+4>>2]|0)==(w|0)){if(Z[u+52>>0]=1,n=u+16|0,w=c[n>>2]|0,!w){if(c[n>>2]=v,c[u+24>>2]=R,c[u+36>>2]=1,!((R|0)==1&&(c[u+48>>2]|0)==1))break;Z[u+54>>0]=1;break}if((w|0)!=(v|0)){R=u+36|0,c[R>>2]=(c[R>>2]|0)+1,Z[u+54>>0]=1;break}w=u+24|0,n=c[w>>2]|0,(n|0)==2&&(c[w>>2]=R,n=R),(n|0)==1&&(c[u+48>>2]|0)==1&&(Z[u+54>>0]=1)}while(!1)}function ih(n,u,v,w){n=n|0,u=u|0,v=v|0,w=w|0;var R=0,N=0,U=0,W=0,Q=0,ne=0,be=0,Se=0,je=0;je=ee,ee=ee+64|0,be=je,ne=c[n>>2]|0,Se=n+(c[ne+-8>>2]|0)|0,ne=c[ne+-4>>2]|0,c[be>>2]=v,c[be+4>>2]=n,c[be+8>>2]=u,c[be+12>>2]=w,n=be+16|0,u=be+20|0,w=be+24|0,R=be+28|0,N=be+32|0,U=be+40|0,W=n,Q=W+36|0;do c[W>>2]=0,W=W+4|0;while((W|0)<(Q|0));mt[n+36>>1]=0,Z[n+38>>0]=0;e:do if(ga(ne,v,0)|0)c[be+48>>2]=1,I2[c[(c[ne>>2]|0)+20>>2]&3](ne,be,Se,Se,1,0),n=(c[w>>2]|0)==1?Se:0;else{switch(Q1[c[(c[ne>>2]|0)+24>>2]&3](ne,be,Se,1,0),c[be+36>>2]|0){case 0:{n=(c[U>>2]|0)==1&(c[R>>2]|0)==1&(c[N>>2]|0)==1?c[u>>2]|0:0;break e}case 1:break;default:{n=0;break e}}if((c[w>>2]|0)!=1&&!((c[U>>2]|0)==0&(c[R>>2]|0)==1&(c[N>>2]|0)==1)){n=0;break}n=c[n>>2]|0}while(!1);return ee=je,n|0}function fP(n){n=n|0,by(n),Ai(n)}function dP(n,u,v,w,R,N){n=n|0,u=u|0,v=v|0,w=w|0,R=R|0,N=N|0,ga(n,c[u+8>>2]|0,N)|0?eb(0,u,v,w,R):(n=c[n+8>>2]|0,I2[c[(c[n>>2]|0)+20>>2]&3](n,u,v,w,R,N))}function pP(n,u,v,w,R){n=n|0,u=u|0,v=v|0,w=w|0,R=R|0;var N=0,U=0,W=0;e:do if(ga(n,c[u+8>>2]|0,R)|0)Kx(0,u,v,w);else{if(!(ga(n,c[u>>2]|0,R)|0)){U=c[n+8>>2]|0,Q1[c[(c[U>>2]|0)+24>>2]&3](U,u,v,w,R);break}if((c[u+16>>2]|0)!=(v|0)&&(U=u+20|0,(c[U>>2]|0)!=(v|0))){c[u+32>>2]=w,w=u+44|0;do if((c[w>>2]|0)!=4)if(N=u+52|0,Z[N>>0]=0,W=u+53|0,Z[W>>0]=0,n=c[n+8>>2]|0,I2[c[(c[n>>2]|0)+20>>2]&3](n,u,v,v,1,R),Z[W>>0]|0){if(W=(Z[N>>0]|0)==0,c[w>>2]=3,W)break;break e}else{c[w>>2]=4;break}while(!1);if(c[U>>2]=v,W=u+40|0,c[W>>2]=(c[W>>2]|0)+1,(c[u+36>>2]|0)!=1||(c[u+24>>2]|0)!=2)break;Z[u+54>>0]=1;break}(w|0)==1&&(c[u+32>>2]=1)}while(!1)}function gP(n,u,v,w){n=n|0,u=u|0,v=v|0,w=w|0,ga(n,c[u+8>>2]|0,0)|0?Qx(0,u,v,w):(n=c[n+8>>2]|0,P2[c[(c[n>>2]|0)+28>>2]&7](n,u,v,w))}function Ai(n){n=n|0,rb(n)}function CX(n){n=n|0}function mP(){var n=0,u=0;n=b3()|0,n|0&&(u=c[n>>2]|0,u|0)&&A3(u+48|0)|0&&T3(c[u+12>>2]|0),T3(_P()|0)}function T3(n){n=n|0;var u=0;u=ee,ee=ee+16|0,ub[n&3](),i_(20559,u)}function _P(){return 2}function yP(n){n=n|0}function vP(n){n=n|0,Ai(n)}function xP(n){return n=n|0,20599}function X1(n){n=n|0,c[n>>2]=5916,E3(n+4|0)}function bP(n){n=n|0,X1(n),Ai(n)}function AP(n){return n=n|0,S3(n+4|0)|0}function S3(n){return n=n|0,c[n>>2]|0}function E3(n){n=n|0;var u=0,v=0;wP(n)|0&&(u=TP(c[n>>2]|0)|0,v=u+8|0,n=c[v>>2]|0,c[v>>2]=n+-1,(n|0)<1)&&Ai(u)}function wP(n){return n=n|0,1}function TP(n){return n=n|0,n+-12|0}function nh(n){n=n|0,c[n>>2]=5936,E3(n+4|0)}function SP(n){n=n|0,nh(n),Ai(n)}function EP(n){return n=n|0,S3(n+4|0)|0}function MP(n){n=n|0,X1(n),Ai(n)}function RP(n){n=n|0,X1(n),Ai(n)}function CP(){var n=0;n=ee,ee=ee+16|0,i_(20848,n)}function PP(n){n=n|0,by(n),Ai(n)}function IP(n,u,v){return n=n|0,u=u|0,v=v|0,ga(n,u,0)|0}function kP(n){n=n|0,by(n),Ai(n)}function DP(n,u,v){n=n|0,u=u|0,v=v|0;var w=0,R=0,N=0,U=0,W=0,Q=0,ne=0,be=0;be=ee,ee=ee+64|0,Q=be;do if(ga(u,4048,0)|0)c[v>>2]=0,u=1;else{if(OP(n,u,0)|0){if(u=c[v>>2]|0,!u){u=1;break}c[v>>2]=c[u>>2],u=1;break}if((u|0)!=0&&(w=ih(u,3840,3976,0)|0,(w|0)!=0))if(u=c[v>>2]|0,u|0&&(c[v>>2]=c[u>>2]),u=c[w+8>>2]|0,N=n+8|0,R=c[N>>2]|0,(u&7&(R^7)|0)==0&&((u&96^96)&R|0)==0)if(R=n+12|0,n=c[R>>2]|0,w=w+12|0,u=c[w>>2]|0,ga(n,u,0)|0)u=1;else{if(ga(n,4040,0)|0){if(!u){u=1;break}u=(ih(u,3840,3992,0)|0)==0;break}if(n){if(u=ih(n,3840,3976,0)|0,u|0){if(!(c[N>>2]&1)){u=0;break}u=FP(u,c[w>>2]|0)|0;break}if(u=c[R>>2]|0,u){if(u=ih(u,3840,4008,0)|0,u|0){if(!(c[N>>2]&1)){u=0;break}u=M3(u,c[w>>2]|0)|0;break}if(u=c[R>>2]|0,(u|0)!=0&&(U=ih(u,3840,3824,0)|0,(U|0)!=0)&&(W=c[w>>2]|0,(W|0)!=0)&&(ne=ih(W,3840,3824,0)|0,(ne|0)!=0)){c[Q>>2]=ne,c[Q+4>>2]=0,c[Q+8>>2]=U,c[Q+12>>2]=-1,u=Q+16|0,n=Q+24|0,w=Q+48|0,R=u,N=R+36|0;do c[R>>2]=0,R=R+4|0;while((R|0)<(N|0));mt[u+36>>1]=0,Z[u+38>>0]=0,c[w>>2]=1,P2[c[(c[ne>>2]|0)+28>>2]&7](ne,Q,c[v>>2]|0,1);do if((c[n>>2]|0)==1){if(!(c[v>>2]|0)){u=1;break}c[v>>2]=c[u>>2],u=1}else u=0;while(!1)}else u=0}else u=0}else u=0}else u=0;else u=0}while(!1);return ee=be,u|0}function OP(n,u,v){n=n|0,u=u|0,v=v|0;var w=0,R=0;return c[n+8>>2]&24?(v=1,R=5):(u|0)!=0&&(w=ih(u,3840,3960,0)|0,(w|0)!=0)?(v=(c[w+8>>2]&24|0)!=0,R=5):v=0,(R|0)==5&&(v=ga(n,u,v)|0),v|0}function FP(n,u){n=n|0,u=u|0;for(var v=0,w=0,R=0,N=0,U=0;;){if(!u){u=0;break}if(v=ih(u,3840,3976,0)|0,!v){u=0;break}if(R=c[n+8>>2]|0,c[v+8>>2]&~R|0){u=0;break}if(w=n+12|0,u=c[w>>2]|0,v=v+12|0,ga(u,c[v>>2]|0,0)|0){u=1;break}if((R&1|0)==0|(u|0)==0){u=0;break}if(n=ih(u,3840,3976,0)|0,!n){U=9;break}u=c[v>>2]|0}return(U|0)==9&&(u=c[w>>2]|0,(u|0)!=0&&(N=ih(u,3840,4008,0)|0,(N|0)!=0)?u=M3(N,c[v>>2]|0)|0:u=0),u|0}function M3(n,u){n=n|0,u=u|0;var v=0;return(u|0)!=0&&(v=ih(u,3840,4008,0)|0,(v|0)!=0)&&(c[v+8>>2]&~c[n+8>>2]|0)==0&&ga(c[n+12>>2]|0,c[v+12>>2]|0,0)|0?n=ga(c[n+16>>2]|0,c[v+16>>2]|0,0)|0:n=0,n|0}function NP(n){n=n|0,by(n),Ai(n)}function BP(n,u,v,w,R,N){n=n|0,u=u|0,v=v|0,w=w|0,R=R|0,N=N|0;var U=0,W=0,Q=0,ne=0,be=0,Se=0,je=0,ct=0,vt=0,ot=0;if(ga(n,c[u+8>>2]|0,N)|0)eb(0,u,v,w,R);else{ot=u+52|0,W=Z[ot>>0]|0,vt=u+53|0,U=Z[vt>>0]|0,ct=c[n+12>>2]|0,be=n+16+(ct<<3)|0,Z[ot>>0]=0,Z[vt>>0]=0,tb(n+16|0,u,v,w,R,N),Q=Z[ot>>0]|0,W=Q|W,ne=Z[vt>>0]|0,U=ne|U;e:do if((ct|0)>1){Se=u+24|0,je=n+8|0,ct=u+54|0,n=n+24|0;do{if(U=U&1,W=W&1,Z[ct>>0]|0)break e;if(Q<<24>>24){if((c[Se>>2]|0)==1||!(c[je>>2]&2))break e}else if(ne<<24>>24&&(c[je>>2]&1|0)==0)break e;Z[ot>>0]=0,Z[vt>>0]=0,tb(n,u,v,w,R,N),Q=Z[ot>>0]|0,W=Q|W,ne=Z[vt>>0]|0,U=ne|U,n=n+8|0}while(n>>>0<be>>>0)}while(!1);Z[ot>>0]=W<<24>>24!=0&1,Z[vt>>0]=U<<24>>24!=0&1}}function zP(n,u,v,w,R){n=n|0,u=u|0,v=v|0,w=w|0,R=R|0;var N=0,U=0,W=0,Q=0,ne=0,be=0,Se=0,je=0,ct=0;e:do if(ga(n,c[u+8>>2]|0,R)|0)Kx(0,u,v,w);else{if(!(ga(n,c[u>>2]|0,R)|0)){if(ct=c[n+12>>2]|0,Q=n+16+(ct<<3)|0,H1(n+16|0,u,v,w,R),N=n+24|0,(ct|0)<=1)break;if(n=c[n+8>>2]|0,(n&2|0)==0&&(W=u+36|0,(c[W>>2]|0)!=1)){if(!(n&1)){for(n=u+54|0;;)if(Z[n>>0]|0||(c[W>>2]|0)==1||(H1(N,u,v,w,R),N=N+8|0,N>>>0>=Q>>>0))break e}for(n=u+24|0,U=u+54|0;;)if(Z[U>>0]|0||(c[W>>2]|0)==1&&(c[n>>2]|0)==1||(H1(N,u,v,w,R),N=N+8|0,N>>>0>=Q>>>0))break e}for(n=u+54|0;;)if(Z[n>>0]|0||(H1(N,u,v,w,R),N=N+8|0,N>>>0>=Q>>>0))break e}if((c[u+16>>2]|0)!=(v|0)&&(ct=u+20|0,(c[ct>>2]|0)!=(v|0))){if(c[u+32>>2]=w,je=u+44|0,(c[je>>2]|0)!=4){W=n+16+(c[n+12>>2]<<3)|0,Q=u+52|0,w=u+53|0,ne=u+54|0,be=n+8|0,Se=u+24|0,N=0,U=n+16|0,n=0;t:for(;;){if(U>>>0>=W>>>0){U=18;break}if(Z[Q>>0]=0,Z[w>>0]=0,tb(U,u,v,v,1,R),Z[ne>>0]|0){U=18;break}do if(Z[w>>0]|0){if(!(Z[Q>>0]|0))if(c[be>>2]&1){n=1;break}else{U=19;break t}if((c[Se>>2]|0)==1){N=1,U=19;break t}if(c[be>>2]&2)N=1,n=1;else{N=1,U=19;break t}}while(!1);U=U+8|0}if((U|0)==18&&(n?U=19:n=4),(U|0)==19&&(n=3),c[je>>2]=n,N&1)break}if(c[ct>>2]=v,v=u+40|0,c[v>>2]=(c[v>>2]|0)+1,(c[u+36>>2]|0)!=1||(c[u+24>>2]|0)!=2)break;Z[u+54>>0]=1;break}(w|0)==1&&(c[u+32>>2]=1)}while(!1)}function LP(n,u,v,w){n=n|0,u=u|0,v=v|0,w=w|0;var R=0,N=0;e:do if(ga(n,c[u+8>>2]|0,0)|0)Qx(0,u,v,w);else if(N=c[n+12>>2]|0,R=n+16+(N<<3)|0,R3(n+16|0,u,v,w),(N|0)>1){N=u+54|0,n=n+24|0;do{if(R3(n,u,v,w),Z[N>>0]|0)break e;n=n+8|0}while(n>>>0<R>>>0)}while(!1)}function R3(n,u,v,w){n=n|0,u=u|0,v=v|0,w=w|0;var R=0,N=0;N=c[n+4>>2]|0,v?(R=N>>8,N&1&&(R=c[(c[v>>2]|0)+R>>2]|0)):R=0,n=c[n>>2]|0,P2[c[(c[n>>2]|0)+28>>2]&7](n,u,v+R|0,(N&2|0)==0?2:w)}function tb(n,u,v,w,R,N){n=n|0,u=u|0,v=v|0,w=w|0,R=R|0,N=N|0;var U=0,W=0;W=c[n+4>>2]|0,U=W>>8,W&1&&(U=c[(c[w>>2]|0)+U>>2]|0),n=c[n>>2]|0,I2[c[(c[n>>2]|0)+20>>2]&3](n,u,v,w+U|0,(W&2|0)==0?2:R,N)}function H1(n,u,v,w,R){n=n|0,u=u|0,v=v|0,w=w|0,R=R|0;var N=0,U=0;U=c[n+4>>2]|0,N=U>>8,U&1&&(N=c[(c[v>>2]|0)+N>>2]|0),n=c[n>>2]|0,Q1[c[(c[n>>2]|0)+24>>2]&3](n,u,v+N|0,(U&2|0)==0?2:w,R)}function UP(n){n=n|0,c[n>>2]=5896}function n_(n){n=n|0;var u=0,v=0;return u=ee,ee=ee+16|0,v=u,C3(v,n),n=VP(v)|0,ee=u,n|0}function C3(n,u){n=n|0,u=u|0,WP(n,u)}function VP(n){n=n|0;var u=0,v=0;return u=ee,ee=ee+16|0,v=u,P3(v,c[n+4>>2]|0),(jP(v)|0)<<24>>24?n=0:n=GP(I3(n)|0)|0,ee=u,n|0}function P3(n,u){n=n|0,u=u|0,c[n>>2]=u}function jP(n){return n=n|0,Z[c[n>>2]>>0]|0}function I3(n){return n=n|0,n|0}function GP(n){n=n|0;var u=0,v=0,w=0,R=0;R=ee,ee=ee+16|0,w=R,n=c[n+8>>2]|0,u=Z[n>>0]|0;do if(u<<24>>24!=1)if(u&2)i_(20985,w);else{Z[n>>0]=2,v=1;break}else v=0;while(!1);return ee=R,v|0}function WP(n,u){n=n|0,u=u|0,c[n>>2]=u,c[n+4>>2]=u,c[n+8>>2]=u+1,c[n+12>>2]=0}function r_(n){n=n|0;var u=0,v=0;u=ee,ee=ee+16|0,v=u,C3(v,n),ZP(v),ee=u}function ZP(n){n=n|0;var u=0,v=0;u=ee,ee=ee+16|0,v=u,P3(v,c[n+4>>2]|0),XP(v),HP(I3(n)|0),ee=u}function XP(n){n=n|0,Z[c[n>>2]>>0]=1}function HP(n){n=n|0,Z[c[n+8>>2]>>0]=1}function $P(){return 0}function Pi(n){n=n|0;var u=0,v=0;for(v=(n|0)==0?1:n;;){if(u=q1(v)|0,u|0){n=6;break}if(n=$P()|0,!n){n=5;break}ub[n&3]()}if((n|0)==5)v=Zn(4)|0,UP(v),ir(v|0,3880,121);else if((n|0)==6)return u|0;return 0}function k3(n){return n=n|0,Pi(n)|0}function D3(n){n=n|0,Ai(n)}function qP(n,u,v){n=n|0,u=u|0,v=v|0;var w=0,R=0;return R=ee,ee=ee+16|0,w=R,c[w>>2]=c[v>>2],n=wy[c[(c[n>>2]|0)+16>>2]&7](n,u,w)|0,n&&(c[v>>2]=c[w>>2]),ee=R,n&1|0}function YP(n){return n=n|0,n?n=(ih(n,3840,3976,0)|0)!=0&1:n=0,n|0}function JP(n){return n=n|0,0}function QP(){return(KP()|0)>0|0}function KP(){return vf()|0}function O3(n){n=n|0}function eI(n){n=n|0,O3(n),Ai(n)}function tI(n){return n=n|0,21039}function ma(n){n=n|0}function wp(n){n=n|0;var u=0,v=0;u=n+8|0,(c[u>>2]|0)!=0&&(v=c[u>>2]|0,c[u>>2]=v+-1,(v|0)!=0)||Jr[c[(c[n>>2]|0)+16>>2]&255](n)}function iI(n){if(n=n|0,n=JP(n)|0,n)CI(n,21145);else return}function nI(n){n=n|0}function ib(n,u){n=n|0,u=u|0;var v=0,w=0;w=Z1(u)|0,v=Pi(w+13|0)|0,c[v>>2]=w,c[v+4>>2]=w,c[v+8>>2]=0,v=rI(v)|0,rh(v|0,u|0,w+1|0)|0,c[n>>2]=v}function rI(n){return n=n|0,n+12|0}function Tp(n,u){n=n|0,u=u|0,c[n>>2]=5916,ib(n+4|0,u)}function sI(n,u){n=n|0,u=u|0,c[n>>2]=5936,ib(n+4|0,(Z[u+11>>0]|0)<0?c[u>>2]|0:u)}function Xf(n,u){n=n|0,u=u|0,c[n>>2]=5936,ib(n+4|0,u)}function nb(n){n=n|0,n=Zn(8)|0,Tp(n,21163),c[n>>2]=5956,ir(n|0,3928,123)}function aI(n){n=n|0,n=Zn(8)|0,Tp(n,21163),c[n>>2]=5976,ir(n|0,3944,123)}function $1(n,u,v){n=n|0,u=u|0,v=v|0;var w=0,R=0,N=0,U=0;R=ee,ee=ee+16|0,w=R,v>>>0>4294967279&&nb(n),v>>>0<11?Z[n+11>>0]=v:(U=v+16&-16,N=Pi(U)|0,c[n>>2]=N,c[n+8>>2]=U|-2147483648,c[n+4>>2]=v,n=N),E2(n,u,v)|0,Z[w>>0]=0,Ga(n+v|0,w),ee=R}function E2(n,u,v){return n=n|0,u=u|0,v=v|0,v|0&&rh(n|0,u|0,v|0)|0,n|0}function M2(n){n=n|0,(Z[n+11>>0]|0)<0&&an(c[n>>2]|0,c[n+8>>2]&2147483647)}function oI(n,u,v,w,R,N,U,W){n=n|0,u=u|0,v=v|0,w=w|0,R=R|0,N=N|0,U=U|0,W=W|0;var Q=0,ne=0,be=0,Se=0,je=0;je=ee,ee=ee+16|0,Se=je,(-18-u|0)>>>0<v>>>0&&nb(n),(Z[n+11>>0]|0)<0?be=c[n>>2]|0:be=n,u>>>0<2147483623?(Q=v+u|0,ne=u<<1,Q=Q>>>0<ne>>>0?ne:Q,Q=Q>>>0<11?11:Q+16&-16):Q=-17,ne=Pi(Q)|0,R|0&&E2(ne,be,R)|0,U|0&&E2(ne+R|0,W,U)|0,w=w-N|0,v=w-R|0,v|0&&E2(ne+R+U|0,be+R+N|0,v)|0,v=u+1|0,(v|0)!=11&&an(be,v),c[n>>2]=ne,c[n+8>>2]=Q|-2147483648,U=w+U|0,c[n+4>>2]=U,Z[Se>>0]=0,Ga(ne+U|0,Se),ee=je}function F3(n,u,v){n=n|0,u=u|0,v=v|0;var w=0,R=0,N=0,U=0,W=0,Q=0;return Q=ee,ee=ee+16|0,U=Q,W=n+11|0,w=Z[W>>0]|0,N=w<<24>>24<0,N?(R=(c[n+8>>2]&2147483647)+-1|0,w=c[n+4>>2]|0):(R=10,w=w&255),(R-w|0)>>>0>=v>>>0?v|0&&(N?R=c[n>>2]|0:R=n,E2(R+w|0,u,v)|0,w=w+v|0,(Z[W>>0]|0)<0?c[n+4>>2]=w:Z[W>>0]=w,Z[U>>0]=0,Ga(R+w|0,U)):oI(n,R,w+v-R|0,w,w,0,v,u),ee=Q,n|0}function lI(n,u){return n=n|0,u=u|0,F3(n,u,Il(u)|0)|0}function cI(n,u,v){return n=n|0,u=u|0,v=v|0,v?n=$C(n,u,v)|0:n=0,n|0}function uI(n,u,v,w,R){n=n|0,u=u|0,v=v|0,w=w|0,R=R|0;var N=0,U=0;return N=Z[n+11>>0]|0,U=N<<24>>24<0,U?N=c[n+4>>2]|0:N=N&255,(R|0)==-1|N>>>0<u>>>0&&aI(n),N=N-u|0,v=N>>>0<v>>>0?N:v,U&&(n=c[n>>2]|0),N=v>>>0>R>>>0,n=cI(n+u|0,w,N?R:v)|0,n?n|0:(v>>>0<R>>>0?-1:N&1)|0}function hI(n){n=n|0}function fI(n){n=n|0,Ai(n)}function dI(n){return n=n|0,21228}function pI(n,u,v){n=n|0,u=u|0,v=v|0,c[n>>2]=v,c[n+4>>2]=u}function gI(n,u,v){n=n|0,u=u|0,v=v|0;var w=0,R=0;return R=ee,ee=ee+16|0,w=R,C2[c[(c[n>>2]|0)+12>>2]&15](w,n,u),(c[w+4>>2]|0)==(c[v+4>>2]|0)?n=(c[w>>2]|0)==(c[v>>2]|0):n=0,ee=R,n|0}function mI(n,u,v){return n=n|0,u=u|0,v=v|0,((c[u>>2]|0)==(v|0)?(c[u+4>>2]|0)==(n|0):0)|0}function _I(n,u,v){n=n|0,u=u|0,v=v|0,(v|0)>256?$1(n,21176,Il(21176)|0):N3(n,0,v)}function N3(n,u,v){n=n|0,u=u|0,v=v|0,yI(n,v)}function yI(n,u){n=n|0,u=u|0;var v=0,w=0,R=0,N=0,U=0;U=ee,ee=ee+1040|0,R=U+1024|0,v=U,N=c[(e0()|0)>>2]|0,w=vI(nP(u,v,1024)|0,v)|0,Z[w>>0]|0?v=w:(c[R>>2]=u,qC(v,1024,21211,R)|0),c[(e0()|0)>>2]=N,$1(n,v,Il(v)|0),ee=U}function vI(n,u){n=n|0,u=u|0;var v=0,w=0;switch(n|0){case 0:{v=u;break}case-1:{n=c[(e0()|0)>>2]|0,w=3;break}default:w=3}return(w|0)==3&&((n|0)==28?v=22145:cd()),v|0}function xI(n){n=n|0,Ai(n)}function bI(n){return n=n|0,21353}function AI(n,u,v){n=n|0,u=u|0,v=v|0,(v|0)>256?(B3()|0,u=6180):(TI()|0,u=6176),c[n>>2]=v,c[n+4>>2]=u}function wI(n,u,v){n=n|0,u=u|0,v=v|0,(v|0)>256?$1(n,21319,Il(21319)|0):N3(n,0,v)}function B3(){return(Z[21488]|0)==0&&n_(21488)|0&&r_(21488),6180}function TI(){return(Z[21480]|0)==0&&n_(21480)|0&&r_(21480),6176}function z3(n){n=n|0,nh(n)}function SI(n){n=n|0,z3(n),Ai(n)}function EI(n,u){n=n|0,u=u|0;var v=0;v=c[u+4>>2]|0,C2[c[(c[v>>2]|0)+24>>2]&15](n,v,c[u>>2]|0)}function MI(n,u,v){n=n|0,u=u|0,v=v|0;var w=0,R=0,N=0;for(N=ee,ee=ee+16|0,R=N,c[u>>2]|0&&(w=Z[v+11>>0]|0,w<<24>>24<0?w=c[v+4>>2]|0:w=w&255,w|0&&lI(v,21417)|0,EI(R,u),u=Z[R+11>>0]|0,w=u<<24>>24<0,F3(v,w?c[R>>2]|0:R,w?c[R+4>>2]|0:u&255)|0,M2(R)),c[n>>2]=c[v>>2],c[n+4>>2]=c[v+4>>2],c[n+8>>2]=c[v+8>>2],w=0;(w|0)!=3;)c[v+(w<<2)>>2]=0,w=w+1|0;ee=N}function RI(n,u,v){n=n|0,u=u|0,v=v|0;var w=0,R=0,N=0;w=ee,ee=ee+32|0,N=w+12|0,R=w,$1(R,v,Il(v)|0),MI(N,u,R),sI(n,N),M2(N),M2(R),c[n>>2]=6192,R=u,u=c[R+4>>2]|0,v=n+8|0,c[v>>2]=c[R>>2],c[v+4>>2]=u,ee=w}function CI(n,u){n=n|0,u=u|0;var v=0,w=0,R=0;R=ee,ee=ee+16|0,w=R+8|0,v=Zn(16)|0,B3()|0,c[R>>2]=n,c[R+4>>2]=6180,c[w>>2]=c[R>>2],c[w+4>>2]=c[R+4>>2],RI(v,w,u),ir(v|0,4272,136)}function Yl(n){n=n|0,n=Zn(8)|0,Tp(n,21420),c[n>>2]=5956,ir(n|0,3928,123)}function q1(n){n=n|0;var u=0,v=0,w=0,R=0,N=0,U=0,W=0,Q=0,ne=0,be=0,Se=0,je=0,ct=0,vt=0,ot=0,nn=0,ui=0,Jt=0,Di=0,Mt=0,pr=0;pr=ee,ee=ee+16|0,je=pr;do if(n>>>0<245){if(ne=n>>>0<11?16:n+11&-8,n=ne>>>3,Se=c[5412]|0,v=Se>>>n,v&3|0)return u=(v&1^1)+n|0,n=21688+(u<<1<<2)|0,v=n+8|0,w=c[v>>2]|0,R=w+8|0,N=c[R>>2]|0,(N|0)==(n|0)?c[5412]=Se&~(1<<u):(c[N+12>>2]=n,c[v>>2]=N),Mt=u<<3,c[w+4>>2]=Mt|3,Mt=w+Mt+4|0,c[Mt>>2]=c[Mt>>2]|1,Mt=R,ee=pr,Mt|0;if(be=c[5414]|0,ne>>>0>be>>>0){if(v|0)return u=2<<n,u=v<<n&(u|0-u),u=(u&0-u)+-1|0,W=u>>>12&16,u=u>>>W,v=u>>>5&8,u=u>>>v,N=u>>>2&4,u=u>>>N,n=u>>>1&2,u=u>>>n,w=u>>>1&1,w=(v|W|N|n|w)+(u>>>w)|0,u=21688+(w<<1<<2)|0,n=u+8|0,N=c[n>>2]|0,W=N+8|0,v=c[W>>2]|0,(v|0)==(u|0)?(n=Se&~(1<<w),c[5412]=n):(c[v+12>>2]=u,c[n>>2]=v,n=Se),Mt=w<<3,U=Mt-ne|0,c[N+4>>2]=ne|3,R=N+ne|0,c[R+4>>2]=U|1,c[N+Mt>>2]=U,be|0&&(w=c[5417]|0,u=be>>>3,v=21688+(u<<1<<2)|0,u=1<<u,n&u?(n=v+8|0,u=c[n>>2]|0):(c[5412]=n|u,u=v,n=v+8|0),c[n>>2]=w,c[u+12>>2]=w,c[w+8>>2]=u,c[w+12>>2]=v),c[5414]=U,c[5417]=R,Mt=W,ee=pr,Mt|0;if(N=c[5413]|0,N){for(v=(N&0-N)+-1|0,R=v>>>12&16,v=v>>>R,w=v>>>5&8,v=v>>>w,U=v>>>2&4,v=v>>>U,W=v>>>1&2,v=v>>>W,Q=v>>>1&1,Q=c[21952+((w|R|U|W|Q)+(v>>>Q)<<2)>>2]|0,v=Q,W=Q,Q=(c[Q+4>>2]&-8)-ne|0;n=c[v+16>>2]|0,!(!n&&(n=c[v+20>>2]|0,!n));)U=(c[n+4>>2]&-8)-ne|0,R=U>>>0<Q>>>0,v=n,W=R?n:W,Q=R?U:Q;if(U=W+ne|0,U>>>0>W>>>0){R=c[W+24>>2]|0,u=c[W+12>>2]|0;do if((u|0)==(W|0)){if(n=W+20|0,u=c[n>>2]|0,!u&&(n=W+16|0,u=c[n>>2]|0,!u)){v=0;break}for(;;)if(w=u+20|0,v=c[w>>2]|0,v)u=v,n=w;else if(w=u+16|0,v=c[w>>2]|0,v)u=v,n=w;else break;c[n>>2]=0,v=u}else v=c[W+8>>2]|0,c[v+12>>2]=u,c[u+8>>2]=v,v=u;while(!1);do if(R|0){if(u=c[W+28>>2]|0,n=21952+(u<<2)|0,(W|0)==(c[n>>2]|0)){if(c[n>>2]=v,!v){c[5413]=N&~(1<<u);break}}else if(Mt=R+16|0,c[((c[Mt>>2]|0)==(W|0)?Mt:R+20|0)>>2]=v,!v)break;c[v+24>>2]=R,u=c[W+16>>2]|0,u|0&&(c[v+16>>2]=u,c[u+24>>2]=v),u=c[W+20>>2]|0,u|0&&(c[v+20>>2]=u,c[u+24>>2]=v)}while(!1);return Q>>>0<16?(Mt=Q+ne|0,c[W+4>>2]=Mt|3,Mt=W+Mt+4|0,c[Mt>>2]=c[Mt>>2]|1):(c[W+4>>2]=ne|3,c[U+4>>2]=Q|1,c[U+Q>>2]=Q,be|0&&(w=c[5417]|0,u=be>>>3,v=21688+(u<<1<<2)|0,u=1<<u,u&Se?(n=v+8|0,u=c[n>>2]|0):(c[5412]=u|Se,u=v,n=v+8|0),c[n>>2]=w,c[u+12>>2]=w,c[w+8>>2]=u,c[w+12>>2]=v),c[5414]=Q,c[5417]=U),Mt=W+8|0,ee=pr,Mt|0}else Se=ne}else Se=ne}else Se=ne}else if(n>>>0<=4294967231)if(n=n+11|0,ne=n&-8,w=c[5413]|0,w){R=0-ne|0,n=n>>>8,n?ne>>>0>16777215?Q=31:(Se=(n+1048320|0)>>>16&8,ot=n<<Se,W=(ot+520192|0)>>>16&4,ot=ot<<W,Q=(ot+245760|0)>>>16&2,Q=14-(W|Se|Q)+(ot<<Q>>>15)|0,Q=ne>>>(Q+7|0)&1|Q<<1):Q=0,v=c[21952+(Q<<2)>>2]|0;e:do if(!v)v=0,n=0,ot=61;else for(n=0,W=ne<<((Q|0)==31?0:25-(Q>>>1)|0),N=0;;){if(U=(c[v+4>>2]&-8)-ne|0,U>>>0<R>>>0)if(U)n=v,R=U;else{n=v,R=0,ot=65;break e}if(ot=c[v+20>>2]|0,v=c[v+16+(W>>>31<<2)>>2]|0,N=(ot|0)==0|(ot|0)==(v|0)?N:ot,v)W=W<<1;else{v=N,ot=61;break}}while(!1);if((ot|0)==61){if((v|0)==0&(n|0)==0){if(n=2<<Q,n=(n|0-n)&w,!n){Se=ne;break}Se=(n&0-n)+-1|0,U=Se>>>12&16,Se=Se>>>U,N=Se>>>5&8,Se=Se>>>N,W=Se>>>2&4,Se=Se>>>W,Q=Se>>>1&2,Se=Se>>>Q,v=Se>>>1&1,n=0,v=c[21952+((N|U|W|Q|v)+(Se>>>v)<<2)>>2]|0}v?ot=65:(W=n,U=R)}if((ot|0)==65)for(N=v;;)if(Se=(c[N+4>>2]&-8)-ne|0,v=Se>>>0<R>>>0,R=v?Se:R,n=v?N:n,v=c[N+16>>2]|0,v||(v=c[N+20>>2]|0),v)N=v;else{W=n,U=R;break}if((W|0)!=0&&U>>>0<((c[5414]|0)-ne|0)>>>0&&(be=W+ne|0,be>>>0>W>>>0)){N=c[W+24>>2]|0,u=c[W+12>>2]|0;do if((u|0)==(W|0)){if(n=W+20|0,u=c[n>>2]|0,!u&&(n=W+16|0,u=c[n>>2]|0,!u)){u=0;break}for(;;)if(R=u+20|0,v=c[R>>2]|0,v)u=v,n=R;else if(R=u+16|0,v=c[R>>2]|0,v)u=v,n=R;else break;c[n>>2]=0}else Mt=c[W+8>>2]|0,c[Mt+12>>2]=u,c[u+8>>2]=Mt;while(!1);do if(N){if(n=c[W+28>>2]|0,v=21952+(n<<2)|0,(W|0)==(c[v>>2]|0)){if(c[v>>2]=u,!u){w=w&~(1<<n),c[5413]=w;break}}else if(Mt=N+16|0,c[((c[Mt>>2]|0)==(W|0)?Mt:N+20|0)>>2]=u,!u)break;c[u+24>>2]=N,n=c[W+16>>2]|0,n|0&&(c[u+16>>2]=n,c[n+24>>2]=u),n=c[W+20>>2]|0,n&&(c[u+20>>2]=n,c[n+24>>2]=u)}while(!1);e:do if(U>>>0<16)Mt=U+ne|0,c[W+4>>2]=Mt|3,Mt=W+Mt+4|0,c[Mt>>2]=c[Mt>>2]|1;else{if(c[W+4>>2]=ne|3,c[be+4>>2]=U|1,c[be+U>>2]=U,u=U>>>3,U>>>0<256){v=21688+(u<<1<<2)|0,n=c[5412]|0,u=1<<u,n&u?(n=v+8|0,u=c[n>>2]|0):(c[5412]=n|u,u=v,n=v+8|0),c[n>>2]=be,c[u+12>>2]=be,c[be+8>>2]=u,c[be+12>>2]=v;break}if(u=U>>>8,u?U>>>0>16777215?v=31:(Di=(u+1048320|0)>>>16&8,Mt=u<<Di,Jt=(Mt+520192|0)>>>16&4,Mt=Mt<<Jt,v=(Mt+245760|0)>>>16&2,v=14-(Jt|Di|v)+(Mt<<v>>>15)|0,v=U>>>(v+7|0)&1|v<<1):v=0,u=21952+(v<<2)|0,c[be+28>>2]=v,n=be+16|0,c[n+4>>2]=0,c[n>>2]=0,n=1<<v,!(w&n)){c[5413]=w|n,c[u>>2]=be,c[be+24>>2]=u,c[be+12>>2]=be,c[be+8>>2]=be;break}u=c[u>>2]|0;t:do if((c[u+4>>2]&-8|0)!=(U|0)){for(w=U<<((v|0)==31?0:25-(v>>>1)|0);v=u+16+(w>>>31<<2)|0,n=c[v>>2]|0,!!n;)if((c[n+4>>2]&-8|0)==(U|0)){u=n;break t}else w=w<<1,u=n;c[v>>2]=be,c[be+24>>2]=u,c[be+12>>2]=be,c[be+8>>2]=be;break e}while(!1);Di=u+8|0,Mt=c[Di>>2]|0,c[Mt+12>>2]=be,c[Di>>2]=be,c[be+8>>2]=Mt,c[be+12>>2]=u,c[be+24>>2]=0}while(!1);return Mt=W+8|0,ee=pr,Mt|0}else Se=ne}else Se=ne;else Se=-1;while(!1);if(v=c[5414]|0,v>>>0>=Se>>>0)return u=v-Se|0,n=c[5417]|0,u>>>0>15?(Mt=n+Se|0,c[5417]=Mt,c[5414]=u,c[Mt+4>>2]=u|1,c[n+v>>2]=u,c[n+4>>2]=Se|3):(c[5414]=0,c[5417]=0,c[n+4>>2]=v|3,Mt=n+v+4|0,c[Mt>>2]=c[Mt>>2]|1),Mt=n+8|0,ee=pr,Mt|0;if(U=c[5415]|0,U>>>0>Se>>>0)return Jt=U-Se|0,c[5415]=Jt,Mt=c[5418]|0,Di=Mt+Se|0,c[5418]=Di,c[Di+4>>2]=Jt|1,c[Mt+4>>2]=Se|3,Mt=Mt+8|0,ee=pr,Mt|0;if(c[5530]|0?n=c[5532]|0:(c[5532]=4096,c[5531]=4096,c[5533]=-1,c[5534]=-1,c[5535]=0,c[5523]=0,c[5530]=je&-16^1431655768,n=4096),W=Se+48|0,Q=Se+47|0,N=n+Q|0,R=0-n|0,ne=N&R,ne>>>0<=Se>>>0||(n=c[5522]|0,n|0&&(be=c[5520]|0,je=be+ne|0,je>>>0<=be>>>0|je>>>0>n>>>0)))return Mt=0,ee=pr,Mt|0;e:do if(c[5523]&4)u=0,ot=143;else{v=c[5418]|0;t:do if(v){for(w=22096;je=c[w>>2]|0,!(je>>>0<=v>>>0&&(je+(c[w+4>>2]|0)|0)>>>0>v>>>0);)if(n=c[w+8>>2]|0,n)w=n;else{ot=128;break t}if(u=N-U&R,u>>>0<2147483647)if(n=s_(u)|0,(n|0)==((c[w>>2]|0)+(c[w+4>>2]|0)|0)){if((n|0)!=-1){U=u,N=n,ot=145;break e}}else w=n,ot=136;else u=0}else ot=128;while(!1);do if((ot|0)==128)if(v=s_(0)|0,(v|0)!=-1&&(u=v,ct=c[5531]|0,vt=ct+-1|0,u=((vt&u|0)==0?0:(vt+u&0-ct)-u|0)+ne|0,ct=c[5520]|0,vt=u+ct|0,u>>>0>Se>>>0&u>>>0<2147483647)){if(je=c[5522]|0,je|0&&vt>>>0<=ct>>>0|vt>>>0>je>>>0){u=0;break}if(n=s_(u)|0,(n|0)==(v|0)){U=u,N=v,ot=145;break e}else w=n,ot=136}else u=0;while(!1);do if((ot|0)==136){if(v=0-u|0,!(W>>>0>u>>>0&(u>>>0<2147483647&(w|0)!=-1)))if((w|0)==-1){u=0;break}else{U=u,N=w,ot=145;break e}if(n=c[5532]|0,n=Q-u+n&0-n,n>>>0>=2147483647){U=u,N=w,ot=145;break e}if((s_(n)|0)==-1){s_(v)|0,u=0;break}else{U=n+u|0,N=w,ot=145;break e}}while(!1);c[5523]=c[5523]|4,ot=143}while(!1);if((ot|0)==143&&ne>>>0<2147483647&&(Jt=s_(ne)|0,vt=s_(0)|0,nn=vt-Jt|0,ui=nn>>>0>(Se+40|0)>>>0,!((Jt|0)==-1|ui^1|Jt>>>0<vt>>>0&((Jt|0)!=-1&(vt|0)!=-1)^1))&&(U=ui?nn:u,N=Jt,ot=145),(ot|0)==145){u=(c[5520]|0)+U|0,c[5520]=u,u>>>0>(c[5521]|0)>>>0&&(c[5521]=u),Q=c[5418]|0;e:do if(Q){for(u=22096;;){if(n=c[u>>2]|0,v=c[u+4>>2]|0,(N|0)==(n+v|0)){ot=154;break}if(w=c[u+8>>2]|0,w)u=w;else break}if((ot|0)==154&&(Di=u+4|0,(c[u+12>>2]&8|0)==0)&&N>>>0>Q>>>0&n>>>0<=Q>>>0){c[Di>>2]=v+U,Mt=(c[5415]|0)+U|0,Jt=Q+8|0,Jt=(Jt&7|0)==0?0:0-Jt&7,Di=Q+Jt|0,Jt=Mt-Jt|0,c[5418]=Di,c[5415]=Jt,c[Di+4>>2]=Jt|1,c[Q+Mt+4>>2]=40,c[5419]=c[5534];break}for(N>>>0<(c[5416]|0)>>>0&&(c[5416]=N),v=N+U|0,u=22096;;){if((c[u>>2]|0)==(v|0)){ot=162;break}if(n=c[u+8>>2]|0,n)u=n;else break}if((ot|0)==162&&(c[u+12>>2]&8|0)==0){c[u>>2]=N,be=u+4|0,c[be>>2]=(c[be>>2]|0)+U,be=N+8|0,be=N+((be&7|0)==0?0:0-be&7)|0,u=v+8|0,u=v+((u&7|0)==0?0:0-u&7)|0,ne=be+Se|0,W=u-be-Se|0,c[be+4>>2]=Se|3;t:do if((Q|0)==(u|0))Mt=(c[5415]|0)+W|0,c[5415]=Mt,c[5418]=ne,c[ne+4>>2]=Mt|1;else{if((c[5417]|0)==(u|0)){Mt=(c[5414]|0)+W|0,c[5414]=Mt,c[5417]=ne,c[ne+4>>2]=Mt|1,c[ne+Mt>>2]=Mt;break}if(n=c[u+4>>2]|0,(n&3|0)==1){U=n&-8,w=n>>>3;i:do if(n>>>0<256)if(n=c[u+8>>2]|0,v=c[u+12>>2]|0,(v|0)==(n|0)){c[5412]=c[5412]&~(1<<w);break}else{c[n+12>>2]=v,c[v+8>>2]=n;break}else{N=c[u+24>>2]|0,n=c[u+12>>2]|0;do if((n|0)==(u|0)){if(v=u+16|0,w=v+4|0,n=c[w>>2]|0,n)v=w;else if(n=c[v>>2]|0,!n){n=0;break}for(;;)if(R=n+20|0,w=c[R>>2]|0,w)n=w,v=R;else if(R=n+16|0,w=c[R>>2]|0,w)n=w,v=R;else break;c[v>>2]=0}else Mt=c[u+8>>2]|0,c[Mt+12>>2]=n,c[n+8>>2]=Mt;while(!1);if(!N)break;v=c[u+28>>2]|0,w=21952+(v<<2)|0;do if((c[w>>2]|0)!=(u|0)){if(Mt=N+16|0,c[((c[Mt>>2]|0)==(u|0)?Mt:N+20|0)>>2]=n,!n)break i}else{if(c[w>>2]=n,n|0)break;c[5413]=c[5413]&~(1<<v);break i}while(!1);if(c[n+24>>2]=N,v=u+16|0,w=c[v>>2]|0,w|0&&(c[n+16>>2]=w,c[w+24>>2]=n),v=c[v+4>>2]|0,!v)break;c[n+20>>2]=v,c[v+24>>2]=n}while(!1);u=u+U|0,R=U+W|0}else R=W;if(u=u+4|0,c[u>>2]=c[u>>2]&-2,c[ne+4>>2]=R|1,c[ne+R>>2]=R,u=R>>>3,R>>>0<256){v=21688+(u<<1<<2)|0,n=c[5412]|0,u=1<<u,n&u?(n=v+8|0,u=c[n>>2]|0):(c[5412]=n|u,u=v,n=v+8|0),c[n>>2]=ne,c[u+12>>2]=ne,c[ne+8>>2]=u,c[ne+12>>2]=v;break}u=R>>>8;do if(!u)w=0;else{if(R>>>0>16777215){w=31;break}Di=(u+1048320|0)>>>16&8,Mt=u<<Di,Jt=(Mt+520192|0)>>>16&4,Mt=Mt<<Jt,w=(Mt+245760|0)>>>16&2,w=14-(Jt|Di|w)+(Mt<<w>>>15)|0,w=R>>>(w+7|0)&1|w<<1}while(!1);if(u=21952+(w<<2)|0,c[ne+28>>2]=w,n=ne+16|0,c[n+4>>2]=0,c[n>>2]=0,n=c[5413]|0,v=1<<w,!(n&v)){c[5413]=n|v,c[u>>2]=ne,c[ne+24>>2]=u,c[ne+12>>2]=ne,c[ne+8>>2]=ne;break}u=c[u>>2]|0;i:do if((c[u+4>>2]&-8|0)!=(R|0)){for(w=R<<((w|0)==31?0:25-(w>>>1)|0);v=u+16+(w>>>31<<2)|0,n=c[v>>2]|0,!!n;)if((c[n+4>>2]&-8|0)==(R|0)){u=n;break i}else w=w<<1,u=n;c[v>>2]=ne,c[ne+24>>2]=u,c[ne+12>>2]=ne,c[ne+8>>2]=ne;break t}while(!1);Di=u+8|0,Mt=c[Di>>2]|0,c[Mt+12>>2]=ne,c[Di>>2]=ne,c[ne+8>>2]=Mt,c[ne+12>>2]=u,c[ne+24>>2]=0}while(!1);return Mt=be+8|0,ee=pr,Mt|0}for(u=22096;n=c[u>>2]|0,!(n>>>0<=Q>>>0&&(Mt=n+(c[u+4>>2]|0)|0,Mt>>>0>Q>>>0));)u=c[u+8>>2]|0;R=Mt+-47|0,n=R+8|0,n=R+((n&7|0)==0?0:0-n&7)|0,R=Q+16|0,n=n>>>0<R>>>0?Q:n,u=n+8|0,v=U+-40|0,Jt=N+8|0,Jt=(Jt&7|0)==0?0:0-Jt&7,Di=N+Jt|0,Jt=v-Jt|0,c[5418]=Di,c[5415]=Jt,c[Di+4>>2]=Jt|1,c[N+v+4>>2]=40,c[5419]=c[5534],v=n+4|0,c[v>>2]=27,c[u>>2]=c[5524],c[u+4>>2]=c[5525],c[u+8>>2]=c[5526],c[u+12>>2]=c[5527],c[5524]=N,c[5525]=U,c[5527]=0,c[5526]=u,u=n+24|0;do Di=u,u=u+4|0,c[u>>2]=7;while((Di+8|0)>>>0<Mt>>>0);if((n|0)!=(Q|0)){if(N=n-Q|0,c[v>>2]=c[v>>2]&-2,c[Q+4>>2]=N|1,c[n>>2]=N,u=N>>>3,N>>>0<256){v=21688+(u<<1<<2)|0,n=c[5412]|0,u=1<<u,n&u?(n=v+8|0,u=c[n>>2]|0):(c[5412]=n|u,u=v,n=v+8|0),c[n>>2]=Q,c[u+12>>2]=Q,c[Q+8>>2]=u,c[Q+12>>2]=v;break}if(u=N>>>8,u?N>>>0>16777215?w=31:(Di=(u+1048320|0)>>>16&8,Mt=u<<Di,Jt=(Mt+520192|0)>>>16&4,Mt=Mt<<Jt,w=(Mt+245760|0)>>>16&2,w=14-(Jt|Di|w)+(Mt<<w>>>15)|0,w=N>>>(w+7|0)&1|w<<1):w=0,v=21952+(w<<2)|0,c[Q+28>>2]=w,c[Q+20>>2]=0,c[R>>2]=0,u=c[5413]|0,n=1<<w,!(u&n)){c[5413]=u|n,c[v>>2]=Q,c[Q+24>>2]=v,c[Q+12>>2]=Q,c[Q+8>>2]=Q;break}u=c[v>>2]|0;t:do if((c[u+4>>2]&-8|0)!=(N|0)){for(w=N<<((w|0)==31?0:25-(w>>>1)|0);v=u+16+(w>>>31<<2)|0,n=c[v>>2]|0,!!n;)if((c[n+4>>2]&-8|0)==(N|0)){u=n;break t}else w=w<<1,u=n;c[v>>2]=Q,c[Q+24>>2]=u,c[Q+12>>2]=Q,c[Q+8>>2]=Q;break e}while(!1);Di=u+8|0,Mt=c[Di>>2]|0,c[Mt+12>>2]=Q,c[Di>>2]=Q,c[Q+8>>2]=Mt,c[Q+12>>2]=u,c[Q+24>>2]=0}}else Mt=c[5416]|0,(Mt|0)==0|N>>>0<Mt>>>0&&(c[5416]=N),c[5524]=N,c[5525]=U,c[5527]=0,c[5421]=c[5530],c[5420]=-1,c[5425]=21688,c[5424]=21688,c[5427]=21696,c[5426]=21696,c[5429]=21704,c[5428]=21704,c[5431]=21712,c[5430]=21712,c[5433]=21720,c[5432]=21720,c[5435]=21728,c[5434]=21728,c[5437]=21736,c[5436]=21736,c[5439]=21744,c[5438]=21744,c[5441]=21752,c[5440]=21752,c[5443]=21760,c[5442]=21760,c[5445]=21768,c[5444]=21768,c[5447]=21776,c[5446]=21776,c[5449]=21784,c[5448]=21784,c[5451]=21792,c[5450]=21792,c[5453]=21800,c[5452]=21800,c[5455]=21808,c[5454]=21808,c[5457]=21816,c[5456]=21816,c[5459]=21824,c[5458]=21824,c[5461]=21832,c[5460]=21832,c[5463]=21840,c[5462]=21840,c[5465]=21848,c[5464]=21848,c[5467]=21856,c[5466]=21856,c[5469]=21864,c[5468]=21864,c[5471]=21872,c[5470]=21872,c[5473]=21880,c[5472]=21880,c[5475]=21888,c[5474]=21888,c[5477]=21896,c[5476]=21896,c[5479]=21904,c[5478]=21904,c[5481]=21912,c[5480]=21912,c[5483]=21920,c[5482]=21920,c[5485]=21928,c[5484]=21928,c[5487]=21936,c[5486]=21936,Mt=U+-40|0,Jt=N+8|0,Jt=(Jt&7|0)==0?0:0-Jt&7,Di=N+Jt|0,Jt=Mt-Jt|0,c[5418]=Di,c[5415]=Jt,c[Di+4>>2]=Jt|1,c[N+Mt+4>>2]=40,c[5419]=c[5534];while(!1);if(u=c[5415]|0,u>>>0>Se>>>0)return Jt=u-Se|0,c[5415]=Jt,Mt=c[5418]|0,Di=Mt+Se|0,c[5418]=Di,c[Di+4>>2]=Jt|1,c[Mt+4>>2]=Se|3,Mt=Mt+8|0,ee=pr,Mt|0}return c[(e0()|0)>>2]=48,Mt=0,ee=pr,Mt|0}function rb(n){n=n|0;var u=0,v=0,w=0,R=0,N=0,U=0,W=0,Q=0;if(n){v=n+-8|0,R=c[5416]|0,n=c[n+-4>>2]|0,u=n&-8,Q=v+u|0;do if(n&1)W=v,U=v;else{if(w=c[v>>2]|0,!(n&3)||(U=v+(0-w)|0,N=w+u|0,U>>>0<R>>>0))return;if((c[5417]|0)==(U|0)){if(n=Q+4|0,u=c[n>>2]|0,(u&3|0)!=3){W=U,u=N;break}c[5414]=N,c[n>>2]=u&-2,c[U+4>>2]=N|1,c[U+N>>2]=N;return}if(v=w>>>3,w>>>0<256)if(n=c[U+8>>2]|0,u=c[U+12>>2]|0,(u|0)==(n|0)){c[5412]=c[5412]&~(1<<v),W=U,u=N;break}else{c[n+12>>2]=u,c[u+8>>2]=n,W=U,u=N;break}R=c[U+24>>2]|0,n=c[U+12>>2]|0;do if((n|0)==(U|0)){if(u=U+16|0,v=u+4|0,n=c[v>>2]|0,n)u=v;else if(n=c[u>>2]|0,!n){n=0;break}for(;;)if(w=n+20|0,v=c[w>>2]|0,v)n=v,u=w;else if(w=n+16|0,v=c[w>>2]|0,v)n=v,u=w;else break;c[u>>2]=0}else W=c[U+8>>2]|0,c[W+12>>2]=n,c[n+8>>2]=W;while(!1);if(R){if(u=c[U+28>>2]|0,v=21952+(u<<2)|0,(c[v>>2]|0)==(U|0)){if(c[v>>2]=n,!n){c[5413]=c[5413]&~(1<<u),W=U,u=N;break}}else if(W=R+16|0,c[((c[W>>2]|0)==(U|0)?W:R+20|0)>>2]=n,!n){W=U,u=N;break}c[n+24>>2]=R,u=U+16|0,v=c[u>>2]|0,v|0&&(c[n+16>>2]=v,c[v+24>>2]=n),u=c[u+4>>2]|0,u?(c[n+20>>2]=u,c[u+24>>2]=n,W=U,u=N):(W=U,u=N)}else W=U,u=N}while(!1);if(!(U>>>0>=Q>>>0)&&(n=Q+4|0,w=c[n>>2]|0,!!(w&1))){if(w&2)c[n>>2]=w&-2,c[W+4>>2]=u|1,c[U+u>>2]=u,R=u;else{if((c[5418]|0)==(Q|0)){if(Q=(c[5415]|0)+u|0,c[5415]=Q,c[5418]=W,c[W+4>>2]=Q|1,(W|0)!=(c[5417]|0))return;c[5417]=0,c[5414]=0;return}if((c[5417]|0)==(Q|0)){Q=(c[5414]|0)+u|0,c[5414]=Q,c[5417]=U,c[W+4>>2]=Q|1,c[U+Q>>2]=Q;return}R=(w&-8)+u|0,v=w>>>3;do if(w>>>0<256)if(u=c[Q+8>>2]|0,n=c[Q+12>>2]|0,(n|0)==(u|0)){c[5412]=c[5412]&~(1<<v);break}else{c[u+12>>2]=n,c[n+8>>2]=u;break}else{N=c[Q+24>>2]|0,n=c[Q+12>>2]|0;do if((n|0)==(Q|0)){if(u=Q+16|0,v=u+4|0,n=c[v>>2]|0,n)u=v;else if(n=c[u>>2]|0,!n){v=0;break}for(;;)if(w=n+20|0,v=c[w>>2]|0,v)n=v,u=w;else if(w=n+16|0,v=c[w>>2]|0,v)n=v,u=w;else break;c[u>>2]=0,v=n}else v=c[Q+8>>2]|0,c[v+12>>2]=n,c[n+8>>2]=v,v=n;while(!1);if(N|0){if(n=c[Q+28>>2]|0,u=21952+(n<<2)|0,(c[u>>2]|0)==(Q|0)){if(c[u>>2]=v,!v){c[5413]=c[5413]&~(1<<n);break}}else if(w=N+16|0,c[((c[w>>2]|0)==(Q|0)?w:N+20|0)>>2]=v,!v)break;c[v+24>>2]=N,n=Q+16|0,u=c[n>>2]|0,u|0&&(c[v+16>>2]=u,c[u+24>>2]=v),n=c[n+4>>2]|0,n|0&&(c[v+20>>2]=n,c[n+24>>2]=v)}}while(!1);if(c[W+4>>2]=R|1,c[U+R>>2]=R,(W|0)==(c[5417]|0)){c[5414]=R;return}}if(n=R>>>3,R>>>0<256){v=21688+(n<<1<<2)|0,u=c[5412]|0,n=1<<n,u&n?(u=v+8|0,n=c[u>>2]|0):(c[5412]=u|n,n=v,u=v+8|0),c[u>>2]=W,c[n+12>>2]=W,c[W+8>>2]=n,c[W+12>>2]=v;return}n=R>>>8,n?R>>>0>16777215?w=31:(U=(n+1048320|0)>>>16&8,Q=n<<U,N=(Q+520192|0)>>>16&4,Q=Q<<N,w=(Q+245760|0)>>>16&2,w=14-(N|U|w)+(Q<<w>>>15)|0,w=R>>>(w+7|0)&1|w<<1):w=0,n=21952+(w<<2)|0,c[W+28>>2]=w,c[W+20>>2]=0,c[W+16>>2]=0,u=c[5413]|0,v=1<<w;e:do if(!(u&v))c[5413]=u|v,c[n>>2]=W,c[W+24>>2]=n,c[W+12>>2]=W,c[W+8>>2]=W;else{n=c[n>>2]|0;t:do if((c[n+4>>2]&-8|0)!=(R|0)){for(w=R<<((w|0)==31?0:25-(w>>>1)|0);v=n+16+(w>>>31<<2)|0,u=c[v>>2]|0,!!u;)if((c[u+4>>2]&-8|0)==(R|0)){n=u;break t}else w=w<<1,n=u;c[v>>2]=W,c[W+24>>2]=n,c[W+12>>2]=W,c[W+8>>2]=W;break e}while(!1);U=n+8|0,Q=c[U>>2]|0,c[Q+12>>2]=W,c[U>>2]=W,c[W+8>>2]=Q,c[W+12>>2]=n,c[W+24>>2]=0}while(!1);if(Q=(c[5420]|0)+-1|0,c[5420]=Q,!(Q|0)){for(n=22104;n=c[n>>2]|0,n;)n=n+8|0;c[5420]=-1}}}}function s_(n){n=n|0;var u=0,v=0,w=0;w=n+3&-4,n=V3()|0,u=c[n>>2]|0,v=u+w|0;do if((w|0)<1|v>>>0>u>>>0){if(v>>>0>(xf()|0)>>>0&&(ud(v|0)|0)==0)break;return c[n>>2]=v,w=u,w|0}while(!1);return c[(e0()|0)>>2]=48,w=-1,w|0}function PI(n){n=n|0;var u=0;return u=ee,ee=ee+n|0,ee=ee+15&-16,u|0}function II(n){n=n|0,ee=n}function kI(){return ee|0}function DI(n,u){n=n|0,u=u|0;var v=0,w=0,R=0,N=0;return N=n&65535,R=u&65535,v=pn(R,N)|0,w=n>>>16,n=(v>>>16)+(pn(R,w)|0)|0,R=u>>>16,u=pn(R,N)|0,Ln((n>>>16)+(pn(R,w)|0)+(((n&65535)+u|0)>>>16)|0),n+u<<16|v&65535|0|0}function sb(n,u,v,w){n=n|0,u=u|0,v=v|0,w=w|0;var R=0,N=0;return R=n,N=v,v=DI(R,N)|0,n=Dn()|0,Ln((pn(u,N)|0)+(pn(w,R)|0)+n|n&0|0),v|0|0|0}function nf(n,u,v,w){return n=n|0,u=u|0,v=v|0,w=w|0,v=n+v>>>0,Ln(u+w+(v>>>0<n>>>0|0)>>>0|0),v|0|0}function Ay(n,u,v,w){return n=n|0,u=u|0,v=v|0,w=w|0,w=u-w-(v>>>0>n>>>0|0)>>>0,Ln(w|0),n-v>>>0|0|0}function L3(n){return n=n|0,(n?31-(No(n^n-1)|0)|0:32)|0}function OI(n,u,v,w,R){n=n|0,u=u|0,v=v|0,w=w|0,R=R|0;var N=0,U=0,W=0,Q=0,ne=0,be=0,Se=0,je=0,ct=0,vt=0;if(be=n,Q=u,ne=Q,U=v,je=w,W=je,!ne)return N=(R|0)!=0,W?N?(c[R>>2]=n|0,c[R+4>>2]=u&0,je=0,R=0,Ln(je|0),R|0):(je=0,R=0,Ln(je|0),R|0):(N&&(c[R>>2]=(be>>>0)%(U>>>0),c[R+4>>2]=0),je=0,R=(be>>>0)/(U>>>0)>>>0,Ln(je|0),R|0);N=(W|0)==0;do if(U){if(!N){if(N=(No(W|0)|0)-(No(ne|0)|0)|0,N>>>0<=31){Se=N+1|0,W=31-N|0,u=N-31>>31,U=Se,n=be>>>(Se>>>0)&u|ne<<W,u=ne>>>(Se>>>0)&u,N=0,W=be<<W;break}return R?(c[R>>2]=n|0,c[R+4>>2]=Q|u&0,je=0,R=0,Ln(je|0),R|0):(je=0,R=0,Ln(je|0),R|0)}if(N=U-1|0,N&U|0){W=(No(U|0)|0)+33-(No(ne|0)|0)|0,vt=64-W|0,Se=32-W|0,Q=Se>>31,ct=W-32|0,u=ct>>31,U=W,n=Se-1>>31&ne>>>(ct>>>0)|(ne<<Se|be>>>(W>>>0))&u,u=u&ne>>>(W>>>0),N=be<<vt&Q,W=(ne<<vt|be>>>(ct>>>0))&Q|be<<Se&W-33>>31;break}return R|0&&(c[R>>2]=N&be,c[R+4>>2]=0),(U|0)==1?(ct=Q|u&0,vt=n|0|0,Ln(ct|0),vt|0):(vt=L3(U|0)|0,ct=ne>>>(vt>>>0)|0,vt=ne<<32-vt|be>>>(vt>>>0)|0,Ln(ct|0),vt|0)}else{if(N)return R|0&&(c[R>>2]=(ne>>>0)%(U>>>0),c[R+4>>2]=0),ct=0,vt=(ne>>>0)/(U>>>0)>>>0,Ln(ct|0),vt|0;if(!be)return R|0&&(c[R>>2]=0,c[R+4>>2]=(ne>>>0)%(W>>>0)),ct=0,vt=(ne>>>0)/(W>>>0)>>>0,Ln(ct|0),vt|0;if(N=W-1|0,!(N&W))return R|0&&(c[R>>2]=n|0,c[R+4>>2]=N&ne|u&0),ct=0,vt=ne>>>((L3(W|0)|0)>>>0),Ln(ct|0),vt|0;if(N=(No(W|0)|0)-(No(ne|0)|0)|0,N>>>0<=30){u=N+1|0,W=31-N|0,U=u,n=ne<<W|be>>>(u>>>0),u=ne>>>(u>>>0),N=0,W=be<<W;break}return R?(c[R>>2]=n|0,c[R+4>>2]=Q|u&0,ct=0,vt=0,Ln(ct|0),vt|0):(ct=0,vt=0,Ln(ct|0),vt|0)}while(!1);if(!U)ne=W,Q=0,W=0;else{Se=v|0|0,be=je|w&0,ne=nf(Se|0,be|0,-1,-1)|0,v=Dn()|0,Q=W,W=0;do w=Q,Q=N>>>31|Q<<1,N=W|N<<1,w=n<<1|w>>>31|0,je=n>>>31|u<<1|0,Ay(ne|0,v|0,w|0,je|0)|0,vt=Dn()|0,ct=vt>>31|((vt|0)<0?-1:0)<<1,W=ct&1,n=Ay(w|0,je|0,ct&Se|0,(((vt|0)<0?-1:0)>>31|((vt|0)<0?-1:0)<<1)&be|0)|0,u=Dn()|0,U=U-1|0;while((U|0)!=0);ne=Q,Q=0}return U=0,R|0&&(c[R>>2]=n,c[R+4>>2]=u),ct=(N|0)>>>31|(ne|U)<<1|(U<<1|N>>>31)&0|Q,vt=(N<<1|0)&-2|W,Ln(ct|0),vt|0}function ab(n,u,v,w){return n=n|0,u=u|0,v=v|0,w=w|0,OI(n,u,v,w,0)|0}function Y1(n,u,v){return n=n|0,u=u|0,v=v|0,(v|0)<32?(Ln(u>>>v|0),n>>>v|(u&(1<<v)-1)<<32-v):(Ln(0),u>>>v-32|0)}function U3(n,u,v){return n=n|0,u=u|0,v=v|0,(v|0)<32?(Ln(u<<v|(n&(1<<v)-1<<32-v)>>>32-v|0),n<<v):(Ln(n<<v-32|0),0)}function V3(){return 22176}function j3(n){return n=n|0,(n&255)<<24|(n>>8&255)<<16|(n>>16&255)<<8|n>>>24|0}function rh(n,u,v){n=n|0,u=u|0,v=v|0;var w=0,R=0,N=0;if((v|0)>=512)return bf(n|0,u|0,v|0)|0,n|0;if(N=n|0,R=n+v|0,(n&3)==(u&3)){for(;n&3;){if(!v)return N|0;Z[n>>0]=Z[u>>0]|0,n=n+1|0,u=u+1|0,v=v-1|0}for(v=R&-4|0,w=v-64|0;(n|0)<=(w|0);)c[n>>2]=c[u>>2],c[n+4>>2]=c[u+4>>2],c[n+8>>2]=c[u+8>>2],c[n+12>>2]=c[u+12>>2],c[n+16>>2]=c[u+16>>2],c[n+20>>2]=c[u+20>>2],c[n+24>>2]=c[u+24>>2],c[n+28>>2]=c[u+28>>2],c[n+32>>2]=c[u+32>>2],c[n+36>>2]=c[u+36>>2],c[n+40>>2]=c[u+40>>2],c[n+44>>2]=c[u+44>>2],c[n+48>>2]=c[u+48>>2],c[n+52>>2]=c[u+52>>2],c[n+56>>2]=c[u+56>>2],c[n+60>>2]=c[u+60>>2],n=n+64|0,u=u+64|0;for(;(n|0)<(v|0);)c[n>>2]=c[u>>2],n=n+4|0,u=u+4|0}else for(v=R-4|0;(n|0)<(v|0);)Z[n>>0]=Z[u>>0]|0,Z[n+1>>0]=Z[u+1>>0]|0,Z[n+2>>0]=Z[u+2>>0]|0,Z[n+3>>0]=Z[u+3>>0]|0,n=n+4|0,u=u+4|0;for(;(n|0)<(R|0);)Z[n>>0]=Z[u>>0]|0,n=n+1|0,u=u+1|0;return N|0}function rf(n,u,v){n=n|0,u=u|0,v=v|0;var w=0;if((u|0)<(n|0)&(n|0)<(u+v|0)){for(w=n,u=u+v|0,n=n+v|0;(v|0)>0;)n=n-1|0,u=u-1|0,v=v-1|0,Z[n>>0]=Z[u>>0]|0;n=w}else rh(n,u,v)|0;return n|0}function a_(n,u,v){n=n|0,u=u|0,v=v|0;var w=0,R=0,N=0,U=0;if(N=n+v|0,u=u&255,(v|0)>=67){for(;n&3;)Z[n>>0]=u,n=n+1|0;for(w=N&-4|0,U=u|u<<8|u<<16|u<<24,R=w-64|0;(n|0)<=(R|0);)c[n>>2]=U,c[n+4>>2]=U,c[n+8>>2]=U,c[n+12>>2]=U,c[n+16>>2]=U,c[n+20>>2]=U,c[n+24>>2]=U,c[n+28>>2]=U,c[n+32>>2]=U,c[n+36>>2]=U,c[n+40>>2]=U,c[n+44>>2]=U,c[n+48>>2]=U,c[n+52>>2]=U,c[n+56>>2]=U,c[n+60>>2]=U,n=n+64|0;for(;(n|0)<(w|0);)c[n>>2]=U,n=n+4|0}for(;(n|0)<(N|0);)Z[n>>0]=u,n=n+1|0;return N-v|0}function FI(n){return n=n|0,cb[n&3]()|0}function NI(n,u){return n=n|0,u=u|0,J1[n&15](u|0)|0}function BI(n,u,v,w,R,N,U){return n=n|0,u=u|0,v=+v,w=w|0,R=R|0,N=N|0,U=U|0,X3[n&1](u|0,+v,w|0,R|0,N|0,U|0)|0}function zI(n,u,v){return n=n|0,u=u|0,v=v|0,R2[n&63](u|0,v|0)|0}function LI(n,u,v,w){return n=n|0,u=u|0,v=v|0,w=w|0,wy[n&7](u|0,v|0,w|0)|0}function UI(n){n=n|0,ub[n&3]()}function VI(n,u){n=n|0,u=u|0,Jr[n&255](u|0)}function jI(n,u,v){n=n|0,u=u|0,v=v|0,Ng[n&15](u|0,v|0)}function GI(n,u,v,w){n=n|0,u=u|0,v=v|0,w=w|0,C2[n&15](u|0,v|0,w|0)}function WI(n,u,v,w,R){n=n|0,u=u|0,v=v|0,w=w|0,R=R|0,P2[n&7](u|0,v|0,w|0,R|0)}function ZI(n,u,v,w,R,N){n=n|0,u=u|0,v=v|0,w=w|0,R=R|0,N=N|0,Q1[n&3](u|0,v|0,w|0,R|0,N|0)}function XI(n,u,v,w,R,N,U){n=n|0,u=u|0,v=v|0,w=w|0,R=R|0,N=N|0,U=U|0,I2[n&3](u|0,v|0,w|0,R|0,N|0,U|0)}function G3(){return ds(0),0}function ob(n){return n=n|0,ds(1),0}function HI(n,u,v,w,R,N){return n=n|0,u=+u,v=v|0,w=w|0,R=R|0,N=N|0,ds(2),0}function ia(n,u){return n=n|0,u=u|0,ds(3),0}function W3(n,u,v){return n=n|0,u=u|0,v=v|0,ds(4),0}function Z3(){ds(5)}function Yt(n){n=n|0,ds(6)}function Fg(n,u){n=n|0,u=u|0,ds(7)}function o_(n,u,v){n=n|0,u=u|0,v=v|0,ds(8)}function lb(n,u,v,w){n=n|0,u=u|0,v=v|0,w=w|0,ds(9)}function $I(n,u,v,w,R){n=n|0,u=u|0,v=v|0,w=w|0,R=R|0,ds(10)}function qI(n,u,v,w,R,N){n=n|0,u=u|0,v=v|0,w=w|0,R=R|0,N=N|0,ds(11)}var cb=[G3,It,K,G3],J1=[ob,EP,dc,A0,xP,AP,tI,dI,bI,Pg,Tu,f,Fi,oe,ob,ob],X3=[HI,VC],R2=[ia,Bo,gd,Wp,hl,ti,zr,xo,Go,ar,qp,I0,Kp,Xs,Wo,Ao,Xo,Nd,$o,$0,ag,Ud,Z_,Q0,Wu,gg,In,nu,km,ip,Yh,rp,ny,Lm,sp,Zm,sy,$m,Kh,p2,ef,V1,ia,ia,ia,ia,ia,ia,ia,ia,ia,ia,ia,ia,ia,ia,ia,ia,ia,ia,ia,ia,ia,ia],wy=[W3,JC,lP,IP,DP,gI,mI,W3],ub=[Z3,CP,rP,Z3],Jr=[Yt,ma,Sf,Wc,y0,fo,Gp,Zc,nh,Dl,rs,bh,Ef,yd,Pu,la,Wa,yi,T0,mc,$c,Vn,Nu,kh,C,At,ii,Wt,ri,Ji,yr,qn,vr,jo,Xa,$r,Xn,nm,rm,Yp,Ac,P0,dl,Qp,Nh,cm,zu,os,Fn,fm,kd,bo,zf,W0,_m,pl,ym,Ho,B_,Bs,q0,zd,Y0,sg,Ld,J0,V_,W_,og,wm,cg,h2,hg,Sm,Ec,pg,jd,mg,$_,q_,Pm,Uf,ep,Q_,tp,Jn,Zd,Dm,ha,Rc,$a,qa,qs,ru,iy,Jh,qu,bg,Gm,Ju,Ag,op,lp,f2,Hm,ay,Yd,cy,Qh,ql,gp,qm,mp,Cg,fy,Ym,by,sP,aP,oP,fP,yP,vP,X1,bP,SP,MP,RP,PP,kP,NP,O3,eI,hI,fI,xI,z3,SI,Ig,y,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt,Yt],Ng=[Fg,ps,b0,hd,vh,uo,_0,fd,jC,Fg,Fg,Fg,Fg,Fg,Fg,Fg],C2=[o_,pI,_I,AI,wI,wf,Tf,z1,Qt,gi,o_,o_,o_,o_,o_,o_],P2=[lb,hP,gP,LP,Zi,Ne,lb,lb],Q1=[$I,uP,pP,zP],I2=[qI,cP,dP,BP];return{__ZSt18uncaught_exceptionv:QP,___cxa_can_catch:qP,___cxa_is_pointer_type:YP,___embind_register_native_and_builtin_types:Hn,___errno_location:e0,___getTypeName:kC,___muldi3:sb,___udivdi3:ab,_bitshift64Lshr:Y1,_bitshift64Shl:U3,_emscripten_get_sbrk_ptr:V3,_free:rb,_i64Add:nf,_i64Subtract:Ay,_llvm_bswap_i32:j3,_malloc:q1,_memcpy:rh,_memmove:rf,_memset:a_,dynCall_i:FI,dynCall_ii:NI,dynCall_iidiiii:BI,dynCall_iii:zI,dynCall_iiii:LI,dynCall_v:UI,dynCall_vi:VI,dynCall_vii:jI,dynCall_viii:GI,dynCall_viiii:WI,dynCall_viiiii:ZI,dynCall_viiiiii:XI,globalCtors:On,stackAlloc:PI,stackRestore:II,stackSave:kI}})(Np,mf,li),_f=i.__ZSt18uncaught_exceptionv=xn.__ZSt18uncaught_exceptionv;i.___cxa_can_catch=xn.___cxa_can_catch,i.___cxa_is_pointer_type=xn.___cxa_is_pointer_type,i.___embind_register_native_and_builtin_types=xn.___embind_register_native_and_builtin_types,i.___errno_location=xn.___errno_location;var h0=i.___getTypeName=xn.___getTypeName;i.___muldi3=xn.___muldi3,i.___udivdi3=xn.___udivdi3,i._bitshift64Lshr=xn._bitshift64Lshr,i._bitshift64Shl=xn._bitshift64Shl,i._emscripten_get_sbrk_ptr=xn._emscripten_get_sbrk_ptr;var is=i._free=xn._free;i._i64Add=xn._i64Add,i._i64Subtract=xn._i64Subtract,i._llvm_bswap_i32=xn._llvm_bswap_i32;var Fo=i._malloc=xn._malloc;i._memcpy=xn._memcpy,i._memmove=xn._memmove,i._memset=xn._memset;var Sr=i.globalCtors=xn.globalCtors;if(i.stackAlloc=xn.stackAlloc,i.stackRestore=xn.stackRestore,i.stackSave=xn.stackSave,i.dynCall_i=xn.dynCall_i,i.dynCall_ii=xn.dynCall_ii,i.dynCall_iidiiii=xn.dynCall_iidiiii,i.dynCall_iii=xn.dynCall_iii,i.dynCall_iiii=xn.dynCall_iiii,i.dynCall_v=xn.dynCall_v,i.dynCall_vi=xn.dynCall_vi,i.dynCall_vii=xn.dynCall_vii,i.dynCall_viii=xn.dynCall_viii,i.dynCall_viiii=xn.dynCall_viiii,i.dynCall_viiiii=xn.dynCall_viiiii,i.dynCall_viiiiii=xn.dynCall_viiiiii,i.asm=xn,Ls)if(fe(Ls)||(Ls=M(Ls)),p||_){var vu=j(Ls);Ye.set(vu,Be)}else{ao();var xu=function(ye){ye.byteLength&&(ye=new Uint8Array(ye)),Ye.set(ye,Be),i.memoryInitializerRequest&&delete i.memoryInitializerRequest.response,nc()},_h=function(){B(Ls,xu,function(){var ye=new Error("could not load memory initializer "+Ls);throw ye})},Dr=Ma(Ls);if(Dr)xu(Dr.buffer);else if(i.memoryInitializerRequest){var f0=function(){var ye=i.memoryInitializerRequest,me=ye.response;if(ye.status!==200&&ye.status!==0){var Ve=Ma(i.memoryInitializerRequestURL);if(Ve)me=Ve.buffer;else{console.warn("a problem seems to have happened with Module.memoryInitializerRequest, status: "+ye.status+", retrying "+Ls),_h();return}}xu(me)};i.memoryInitializerRequest.response?setTimeout(f0,0):i.memoryInitializerRequest.addEventListener("load",f0)}else _h()}var bu;function Bp(ye){this.name="ExitStatus",this.message="Program terminated with exit("+ye+")",this.status=ye}Qr=function ye(){bu||d0(),bu||(Qr=ye)};function d0(ye){if(so>0||(Ir(),so>0))return;function me(){bu||(bu=!0,i.calledRun=!0,!Je&&(xl(),Fc(),i.onRuntimeInitialized&&i.onRuntimeInitialized(),Nc()))}i.setStatus?(i.setStatus("Running..."),setTimeout(function(){setTimeout(function(){i.setStatus("")},1),me()},1)):me()}if(i.run=d0,i.preInit)for(typeof i.preInit=="function"&&(i.preInit=[i.preInit]);i.preInit.length>0;)i.preInit.pop()();return d0(),i}let Sp=null;const aE={0:i=>({position:[i.getInt32(0,!0),i.getInt32(4,!0),i.getInt32(8,!0)],intensity:i.getUint16(12,!0),classification:i.getUint8(15)}),1:i=>({position:[i.getInt32(0,!0),i.getInt32(4,!0),i.getInt32(8,!0)],intensity:i.getUint16(12,!0),classification:i.getUint8(15)}),2:i=>({position:[i.getInt32(0,!0),i.getInt32(4,!0),i.getInt32(8,!0)],intensity:i.getUint16(12,!0),classification:i.getUint8(15),color:[i.getUint16(20,!0),i.getUint16(22,!0),i.getUint16(24,!0)]}),3:i=>({position:[i.getInt32(0,!0),i.getInt32(4,!0),i.getInt32(8,!0)],intensity:i.getUint16(12,!0),classification:i.getUint8(15),color:[i.getUint16(28,!0),i.getUint16(30,!0),i.getUint16(32,!0)]})};function Ug(i,e={},t,r){r=r===void 0||r===0?1:r;const o=i.slice(t,t+e.BYTES_PER_ELEMENT*r),p=new e(o);if(r===1)return p[0];const _=[];for(let l=0;l<r;l++)_.push(p[l]);return _}function oE(i){let e=131;const t={pointsOffset:Ug(i,Uint32Array,96),pointsFormatId:Ug(i,Uint8Array,104),pointsStructSize:Ug(i,Uint16Array,105),pointsCount:Ug(i,Uint32Array,107),scale:Ug(i,Float64Array,e,3)};e+=24,t.offset=Ug(i,Float64Array,e,3),e+=24;const r=Ug(i,Float64Array,e,6);return e+=48,t.maxs=[r[0],r[2],r[4]],t.mins=[r[1],r[3],r[5]],t}let n5=class{constructor(e){pe(this,"arraybuffer");pe(this,"readOffset",0);pe(this,"header",{pointsOffset:0,pointsFormatId:0,pointsStructSize:0,pointsCount:0,scale:[0,0,0],offset:[0,0,0],maxs:[0],mins:[0],totalToRead:0,totalRead:0,versionAsString:"",isCompressed:!0});this.arraybuffer=e}open(){return!0}getHeader(){return this.header=oE(this.arraybuffer),this.header}readData(e,t){const{header:r,arraybuffer:o}=this;if(!r)throw new Error("Cannot start reading data till a header request is issued");let{readOffset:p}=this,_;if(t<=1){e=Math.min(e,r.pointsCount-p),_=r.pointsOffset+p*r.pointsStructSize;const j=_+e*r.pointsStructSize;return p+=e,this.readOffset=p,{buffer:o.slice(_,j),count:e,hasMoreData:p<r.pointsCount}}const l=Math.min(e*t,r.pointsCount-p),M=Math.ceil(l/t);let D=0;const B=new Uint8Array(M*r.pointsStructSize);for(let j=0;j<l;j++){if(j%t===0){_=r.pointsOffset+p*r.pointsStructSize;const $=new Uint8Array(o,_,r.pointsStructSize);B.set($,D*r.pointsStructSize),D++}p++}return this.readOffset=p,{buffer:B.buffer,count:D,hasMoreData:p<r.pointsCount}}close(){return this.arraybuffer=null,!0}};class r5{constructor(e){pe(this,"arraybuffer");pe(this,"instance",null);pe(this,"header",null);this.arraybuffer=e,Sp||(Sp=i5())}open(){try{const{arraybuffer:e}=this;this.instance=new Sp.LASZip;const t=new Uint8Array(e),r=Sp._malloc(e.byteLength);return this.instance.arraybuffer=e,this.instance.buf=r,Sp.HEAPU8.set(t,r),this.instance.open(r,e.byteLength),this.instance.readOffset=0,!0}catch(e){throw new Error(`Failed to open file: ${e.message}`)}}getHeader(){if(!this.instance)throw new Error("You need to open the file before trying to read header");try{const e=oE(this.instance.arraybuffer);return e.pointsFormatId&=63,this.header=e,e}catch(e){throw new Error(`Failed to get header: ${e.message}`)}}readData(e,t,r){if(!this.instance)throw new Error("You need to open the file before trying to read stuff");const{header:o,instance:p}=this;if(!o)throw new Error("You need to query header before reading, I maintain state that way, sorry :(");try{const _=Math.min(e*r,o.pointsCount-p.readOffset),l=Math.ceil(_/r);let M=0;const D=new Uint8Array(l*o.pointsStructSize),B=Sp._malloc(o.pointsStructSize);for(let j=0;j<_;j++){if(p.getPoint(B),j%r===0){const $=new Uint8Array(Sp.HEAPU8.buffer,B,o.pointsStructSize);D.set($,M*o.pointsStructSize),M++}p.readOffset++}return Sp._free(B),{buffer:D.buffer,count:M,hasMoreData:p.readOffset<o.pointsCount}}catch(_){throw new Error(`Failed to read data: ${_.message}`)}}close(){try{return this.instance!==null&&(Sp._free(this.instance.buf),this.instance.delete(),this.instance=null),!0}catch(e){throw new Error(`Failed to close file: ${e.message}`)}}}class s5{constructor(e,t,r){pe(this,"arrayb");pe(this,"decoder");pe(this,"pointsCount");pe(this,"pointSize");pe(this,"scale");pe(this,"offset");pe(this,"mins");pe(this,"maxs");this.arrayb=e,this.decoder=aE[r.pointsFormatId],this.pointsCount=t,this.pointSize=r.pointsStructSize,this.scale=r.scale,this.offset=r.offset,this.mins=r.mins,this.maxs=r.maxs}getPoint(e){if(e<0||e>=this.pointsCount)throw new Error("Point index out of range");const t=new DataView(this.arrayb,e*this.pointSize,this.pointSize);return this.decoder(t)}}class a5{constructor(e){pe(this,"arraybuffer");pe(this,"formatId",0);pe(this,"loader");pe(this,"isCompressed",!0);pe(this,"isOpen",!1);pe(this,"version",0);pe(this,"versionAsString","");if(this.arraybuffer=e,this.determineVersion()>13)throw new Error("Only file versions <= 1.3 are supported at this time");if(this.determineFormat(),aE[this.formatId]===void 0)throw new Error("The point format ID is not supported");this.loader=this.isCompressed?new r5(this.arraybuffer):new n5(this.arraybuffer)}determineFormat(){const e=Ug(this.arraybuffer,Uint8Array,104),t=(e&128)>>7,r=(e&64)>>6;if(t===1&&r===1)throw new Error("Old style compression not supported");this.formatId=e&63,this.isCompressed=t===1||r===1}determineVersion(){const e=new Int8Array(this.arraybuffer,24,2);return this.version=e[0]*10+e[1],this.versionAsString=`${e[0]}.${e[1]}`,this.version}open(){this.loader.open()&&(this.isOpen=!0)}getHeader(){return this.loader.getHeader()}readData(e,t,r){return this.loader.readData(e,t,r)}close(){this.loader.close()&&(this.isOpen=!1)}getUnpacker(){return s5}}function o5(i,e){const t=l5(i);return Y8(e,t)}function l5(i){const e={};return e.las_pointsOffset=i.pointsOffset.toString(10),e.las_pointsFormatId=i.pointsFormatId.toString(10),e.las_pointsStructSize=i.pointsStructSize.toString(10),e.las_pointsCount=i.pointsCount.toString(10),e.las_scale=JSON.stringify(i.scale),e.las_offset=JSON.stringify(i.offset),i.maxs!==void 0&&(e.las_maxs=JSON.stringify(i.maxs)),i.mins!==void 0&&(e.las_mins=JSON.stringify(i.mins)),e.las_totalToRead=i.totalToRead.toString(10),e.las_pointsFortotalReadmatId=i.totalRead.toString(10),i.versionAsString!==void 0&&(e.las_versionAsString=i.versionAsString),i.isCompressed!==void 0&&(e.las_isCompressed=i.isCompressed.toString()),e}function wT(i,e){return c5(i,e)}function c5(i,e={}){var D;let t=0,r,o,p,_,l;const M={loader:"las",loaderData:{},schema:{fields:[],metadata:{}},header:{vertexCount:0,boundingBox:[[0,0,0],[0,0,0]]},attributes:{},topology:"point-list",mode:0};return u5(i,(D=e.las)==null?void 0:D.skip,(B={},j)=>{var Rt,Et,kt;if(!l){l=j;const Ht=j.totalToRead,Xt=(Rt=e.las)!=null&&Rt.fp64?Float64Array:Float32Array;r=new Xt(Ht*3),o=j.pointsFormatId>=2?new Uint8Array(Ht*4):null,p=new Uint16Array(Ht),_=new Uint8Array(Ht),M.loaderData=j,M.attributes={POSITION:{value:r,size:3},intensity:{value:p,size:1},classification:{value:_,size:1}},o&&(M.attributes.COLOR_0={value:o,size:4})}const $=B.pointsCount,{scale:[se,de,Ae],offset:[he,Le,$e]}=j,Be=h5(B,$,(Et=e.las)==null?void 0:Et.colorDepth);for(let Ht=0;Ht<$;Ht++){const{position:Xt,color:hi,intensity:di,classification:Ei}=B.getPoint(Ht);r[t*3]=Xt[0]*se+he,r[t*3+1]=Xt[1]*de+Le,r[t*3+2]=Xt[2]*Ae+$e,hi&&o&&(Be?(o[t*4]=hi[0]/256,o[t*4+1]=hi[1]/256,o[t*4+2]=hi[2]/256):(o[t*4]=hi[0],o[t*4+1]=hi[1],o[t*4+2]=hi[2]),o[t*4+3]=255),p[t]=di,_[t]=Ei,t++}const Je={...M,header:{vertexCount:j.totalRead},progress:j.totalRead/j.totalToRead};(kt=e==null?void 0:e.onProgress)==null||kt.call(e,Je)}),M.header={vertexCount:l.totalToRead,boundingBox:q8((M==null?void 0:M.attributes)||{})},M&&(M.schema=o5(M.loaderData,M.attributes)),M}function u5(i,e,t={}){const r=new a5(i);try{r.open();const o=r.getHeader(),p=r.getUnpacker(),_=Math.ceil(o.pointsCount/Math.max(1,e));o.totalToRead=_;let l=0;for(;;){const M=r.readData(1e5,0,e);l+=M.count,o.totalRead=l,o.versionAsString=M.versionAsString,o.isCompressed=M.isCompressed;const D=new p(M.buffer,M.count,o);if(t(D,o),!M.hasMoreData||l>=_)break}}catch(o){throw o}finally{r.close()}}function h5(i={},e,t){let r=!1;switch(t){case 8:r=!1;break;case 16:r=!0;break;case"auto":if(i.getPoint(0).color)for(let o=0;o<e;o++){const{color:p}=i.getPoint(o);(p[0]>255||p[1]>255||p[2]>255)&&(r=!0)}break;default:console.warn("las: illegal value for options.las.colorDepth");break}return r}const f5={...t5,parse:async(i,e)=>wT(i,e),parseSync:(i,e)=>wT(i,e)};function d5(i){i("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),i("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),i("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs");for(var e=1;e<=60;++e)i("EPSG:"+(32600+e),"+proj=utm +zone="+e+" +datum=WGS84 +units=m"),i("EPSG:"+(32700+e),"+proj=utm +zone="+e+" +south +datum=WGS84 +units=m");i("EPSG:5041","+title=WGS 84 / UPS North (E,N) +proj=stere +lat_0=90 +lon_0=0 +k=0.994 +x_0=2000000 +y_0=2000000 +datum=WGS84 +units=m"),i("EPSG:5042","+title=WGS 84 / UPS South (E,N) +proj=stere +lat_0=-90 +lon_0=0 +k=0.994 +x_0=2000000 +y_0=2000000 +datum=WGS84 +units=m"),i.WGS84=i["EPSG:4326"],i["EPSG:3785"]=i["EPSG:3857"],i.GOOGLE=i["EPSG:3857"],i["EPSG:900913"]=i["EPSG:3857"],i["EPSG:102113"]=i["EPSG:3857"]}var A_=1,w_=2,Wy=3,p5=4,uA=5,TT=6378137,g5=6356752314e-3,ST=.0066943799901413165,$2=484813681109536e-20,oi=Math.PI/2,m5=.16666666666666666,_5=.04722222222222222,y5=.022156084656084655,wi=1e-10,ya=.017453292519943295,lu=57.29577951308232,jr=Math.PI/4,u1=Math.PI*2,Da=3.14159265359,uu={};uu.greenwich=0;uu.lisbon=-9.131906111111;uu.paris=2.337229166667;uu.bogota=-74.080916666667;uu.madrid=-3.687938888889;uu.rome=12.452333333333;uu.bern=7.439583333333;uu.jakarta=106.807719444444;uu.ferro=-17.666666666667;uu.brussels=4.367975;uu.stockholm=18.058277777778;uu.athens=23.7163375;uu.oslo=10.722916666667;const v5={mm:{to_meter:.001},cm:{to_meter:.01},ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937},fath:{to_meter:1.8288},kmi:{to_meter:1852},"us-ch":{to_meter:20.1168402336805},"us-mi":{to_meter:1609.34721869444},km:{to_meter:1e3},"ind-ft":{to_meter:.30479841},"ind-yd":{to_meter:.91439523},mi:{to_meter:1609.344},yd:{to_meter:.9144},ch:{to_meter:20.1168},link:{to_meter:.201168},dm:{to_meter:.1},in:{to_meter:.0254},"ind-ch":{to_meter:20.11669506},"us-in":{to_meter:.025400050800101},"us-yd":{to_meter:.914401828803658}};var ET=/[\s_\-\/\(\)]/g;function qg(i,e){if(i[e])return i[e];for(var t=Object.keys(i),r=e.toLowerCase().replace(ET,""),o=-1,p,_;++o<t.length;)if(p=t[o],_=p.toLowerCase().replace(ET,""),_===r)return i[p]}function hA(i){var e={},t=i.split("+").map(function(l){return l.trim()}).filter(function(l){return l}).reduce(function(l,M){var D=M.split("=");return D.push(!0),l[D[0].toLowerCase()]=D[1],l},{}),r,o,p,_={proj:"projName",datum:"datumCode",rf:function(l){e.rf=parseFloat(l)},lat_0:function(l){e.lat0=l*ya},lat_1:function(l){e.lat1=l*ya},lat_2:function(l){e.lat2=l*ya},lat_ts:function(l){e.lat_ts=l*ya},lon_0:function(l){e.long0=l*ya},lon_1:function(l){e.long1=l*ya},lon_2:function(l){e.long2=l*ya},alpha:function(l){e.alpha=parseFloat(l)*ya},gamma:function(l){e.rectified_grid_angle=parseFloat(l)*ya},lonc:function(l){e.longc=l*ya},x_0:function(l){e.x0=parseFloat(l)},y_0:function(l){e.y0=parseFloat(l)},k_0:function(l){e.k0=parseFloat(l)},k:function(l){e.k0=parseFloat(l)},a:function(l){e.a=parseFloat(l)},b:function(l){e.b=parseFloat(l)},r:function(l){e.a=e.b=parseFloat(l)},r_a:function(){e.R_A=!0},zone:function(l){e.zone=parseInt(l,10)},south:function(){e.utmSouth=!0},towgs84:function(l){e.datum_params=l.split(",").map(function(M){return parseFloat(M)})},to_meter:function(l){e.to_meter=parseFloat(l)},units:function(l){e.units=l;var M=qg(v5,l);M&&(e.to_meter=M.to_meter)},from_greenwich:function(l){e.from_greenwich=l*ya},pm:function(l){var M=qg(uu,l);e.from_greenwich=(M||parseFloat(l))*ya},nadgrids:function(l){l==="@null"?e.datumCode="none":e.nadgrids=l},axis:function(l){var M="ewnsud";l.length===3&&M.indexOf(l.substr(0,1))!==-1&&M.indexOf(l.substr(1,1))!==-1&&M.indexOf(l.substr(2,1))!==-1&&(e.axis=l)},approx:function(){e.approx=!0},over:function(){e.over=!0}};for(r in t)o=t[r],r in _?(p=_[r],typeof p=="function"?p(o):e[p]=o):e[r]=o;return typeof e.datumCode=="string"&&e.datumCode!=="WGS84"&&(e.datumCode=e.datumCode.toLowerCase()),e.projStr=i,e}class lE{static getId(e){const t=e.find(r=>Array.isArray(r)&&r[0]==="ID");return t&&t.length>=3?{authority:t[1],code:parseInt(t[2],10)}:null}static convertUnit(e,t="unit"){if(!e||e.length<3)return{type:t,name:"unknown",conversion_factor:null};const r=e[1],o=parseFloat(e[2])||null,p=e.find(l=>Array.isArray(l)&&l[0]==="ID"),_=p?{authority:p[1],code:parseInt(p[2],10)}:null;return{type:t,name:r,conversion_factor:o,id:_}}static convertAxis(e){const t=e[1]||"Unknown";let r;const o=t.match(/^\((.)\)$/);if(o){const D=o[1].toUpperCase();if(D==="E")r="east";else if(D==="N")r="north";else if(D==="U")r="up";else throw new Error(`Unknown axis abbreviation: ${D}`)}else r=e[2]?e[2].toLowerCase():"unknown";const p=e.find(D=>Array.isArray(D)&&D[0]==="ORDER"),_=p?parseInt(p[1],10):null,l=e.find(D=>Array.isArray(D)&&(D[0]==="LENGTHUNIT"||D[0]==="ANGLEUNIT"||D[0]==="SCALEUNIT")),M=this.convertUnit(l);return{name:t,direction:r,unit:M,order:_}}static extractAxes(e){return e.filter(t=>Array.isArray(t)&&t[0]==="AXIS").map(t=>this.convertAxis(t)).sort((t,r)=>(t.order||0)-(r.order||0))}static convert(e,t={}){switch(e[0]){case"PROJCRS":t.type="ProjectedCRS",t.name=e[1],t.base_crs=e.find($=>Array.isArray($)&&$[0]==="BASEGEOGCRS")?this.convert(e.find($=>Array.isArray($)&&$[0]==="BASEGEOGCRS")):null,t.conversion=e.find($=>Array.isArray($)&&$[0]==="CONVERSION")?this.convert(e.find($=>Array.isArray($)&&$[0]==="CONVERSION")):null;const r=e.find($=>Array.isArray($)&&$[0]==="CS");r&&(t.coordinate_system={type:r[1],axis:this.extractAxes(e)});const o=e.find($=>Array.isArray($)&&$[0]==="LENGTHUNIT");if(o){const $=this.convertUnit(o);t.coordinate_system.unit=$}t.id=this.getId(e);break;case"BASEGEOGCRS":case"GEOGCRS":t.type="GeographicCRS",t.name=e[1];const p=e.find($=>Array.isArray($)&&($[0]==="DATUM"||$[0]==="ENSEMBLE"));if(p){const $=this.convert(p);p[0]==="ENSEMBLE"?t.datum_ensemble=$:t.datum=$;const se=e.find(de=>Array.isArray(de)&&de[0]==="PRIMEM");se&&se[1]!=="Greenwich"&&($.prime_meridian={name:se[1],longitude:parseFloat(se[2])})}t.coordinate_system={type:"ellipsoidal",axis:this.extractAxes(e)},t.id=this.getId(e);break;case"DATUM":t.type="GeodeticReferenceFrame",t.name=e[1],t.ellipsoid=e.find($=>Array.isArray($)&&$[0]==="ELLIPSOID")?this.convert(e.find($=>Array.isArray($)&&$[0]==="ELLIPSOID")):null;break;case"ENSEMBLE":t.type="DatumEnsemble",t.name=e[1],t.members=e.filter($=>Array.isArray($)&&$[0]==="MEMBER").map($=>({type:"DatumEnsembleMember",name:$[1],id:this.getId($)}));const _=e.find($=>Array.isArray($)&&$[0]==="ENSEMBLEACCURACY");_&&(t.accuracy=parseFloat(_[1]));const l=e.find($=>Array.isArray($)&&$[0]==="ELLIPSOID");l&&(t.ellipsoid=this.convert(l)),t.id=this.getId(e);break;case"ELLIPSOID":t.type="Ellipsoid",t.name=e[1],t.semi_major_axis=parseFloat(e[2]),t.inverse_flattening=parseFloat(e[3]),e.find($=>Array.isArray($)&&$[0]==="LENGTHUNIT")&&this.convert(e.find($=>Array.isArray($)&&$[0]==="LENGTHUNIT"),t);break;case"CONVERSION":t.type="Conversion",t.name=e[1],t.method=e.find($=>Array.isArray($)&&$[0]==="METHOD")?this.convert(e.find($=>Array.isArray($)&&$[0]==="METHOD")):null,t.parameters=e.filter($=>Array.isArray($)&&$[0]==="PARAMETER").map($=>this.convert($));break;case"METHOD":t.type="Method",t.name=e[1],t.id=this.getId(e);break;case"PARAMETER":t.type="Parameter",t.name=e[1],t.value=parseFloat(e[2]),t.unit=this.convertUnit(e.find($=>Array.isArray($)&&($[0]==="LENGTHUNIT"||$[0]==="ANGLEUNIT"||$[0]==="SCALEUNIT"))),t.id=this.getId(e);break;case"BOUNDCRS":t.type="BoundCRS";const M=e.find($=>Array.isArray($)&&$[0]==="SOURCECRS");if(M){const $=M.find(se=>Array.isArray(se));t.source_crs=$?this.convert($):null}const D=e.find($=>Array.isArray($)&&$[0]==="TARGETCRS");if(D){const $=D.find(se=>Array.isArray(se));t.target_crs=$?this.convert($):null}const B=e.find($=>Array.isArray($)&&$[0]==="ABRIDGEDTRANSFORMATION");B?t.transformation=this.convert(B):t.transformation=null;break;case"ABRIDGEDTRANSFORMATION":if(t.type="Transformation",t.name=e[1],t.method=e.find($=>Array.isArray($)&&$[0]==="METHOD")?this.convert(e.find($=>Array.isArray($)&&$[0]==="METHOD")):null,t.parameters=e.filter($=>Array.isArray($)&&($[0]==="PARAMETER"||$[0]==="PARAMETERFILE")).map($=>{if($[0]==="PARAMETER")return this.convert($);if($[0]==="PARAMETERFILE")return{name:$[1],value:$[2],id:{authority:"EPSG",code:8656}}}),t.parameters.length===7){const $=t.parameters[6];$.name==="Scale difference"&&($.value=Math.round(($.value-1)*1e12)/1e6)}t.id=this.getId(e);break;case"AXIS":t.coordinate_system||(t.coordinate_system={type:"unspecified",axis:[]}),t.coordinate_system.axis.push(this.convertAxis(e));break;case"LENGTHUNIT":const j=this.convertUnit(e,"LinearUnit");t.coordinate_system&&t.coordinate_system.axis&&t.coordinate_system.axis.forEach($=>{$.unit||($.unit=j)}),j.conversion_factor&&j.conversion_factor!==1&&t.semi_major_axis&&(t.semi_major_axis={value:t.semi_major_axis,unit:j});break;default:t.keyword=e[0];break}return t}}class x5 extends lE{static convert(e,t={}){return super.convert(e,t),t.coordinate_system&&t.coordinate_system.subtype==="Cartesian"&&delete t.coordinate_system,t.usage&&delete t.usage,t}}class b5 extends lE{static convert(e,t={}){super.convert(e,t);const r=e.find(p=>Array.isArray(p)&&p[0]==="CS");r&&(t.coordinate_system={subtype:r[1],axis:this.extractAxes(e)});const o=e.find(p=>Array.isArray(p)&&p[0]==="USAGE");if(o){const p=o.find(M=>Array.isArray(M)&&M[0]==="SCOPE"),_=o.find(M=>Array.isArray(M)&&M[0]==="AREA"),l=o.find(M=>Array.isArray(M)&&M[0]==="BBOX");t.usage={},p&&(t.usage.scope=p[1]),_&&(t.usage.area=_[1]),l&&(t.usage.bbox=l.slice(1))}return t}}function A5(i){return i.find(e=>Array.isArray(e)&&e[0]==="USAGE")?"2019":(i.find(e=>Array.isArray(e)&&e[0]==="CS")||i[0]==="BOUNDCRS"||i[0]==="PROJCRS"||i[0]==="GEOGCRS","2015")}function w5(i){return(A5(i)==="2019"?b5:x5).convert(i)}function T5(i){const e=i.toUpperCase();return e.includes("PROJCRS")||e.includes("GEOGCRS")||e.includes("BOUNDCRS")||e.includes("VERTCRS")||e.includes("LENGTHUNIT")||e.includes("ANGLEUNIT")||e.includes("SCALEUNIT")?"WKT2":(e.includes("PROJCS")||e.includes("GEOGCS")||e.includes("LOCAL_CS")||e.includes("VERT_CS")||e.includes("UNIT"),"WKT1")}var h1=1,cE=2,uE=3,Vv=4,hE=5,fw=-1,S5=/\s/,E5=/[A-Za-z]/,M5=/[A-Za-z84_]/,Ox=/[,\]]/,fE=/[\d\.E\-\+]/;function Ip(i){if(typeof i!="string")throw new Error("not a string");this.text=i.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=h1}Ip.prototype.readCharicter=function(){var i=this.text[this.place++];if(this.state!==Vv)for(;S5.test(i);){if(this.place>=this.text.length)return;i=this.text[this.place++]}switch(this.state){case h1:return this.neutral(i);case cE:return this.keyword(i);case Vv:return this.quoted(i);case hE:return this.afterquote(i);case uE:return this.number(i);case fw:return}};Ip.prototype.afterquote=function(i){if(i==='"'){this.word+='"',this.state=Vv;return}if(Ox.test(i)){this.word=this.word.trim(),this.afterItem(i);return}throw new Error(`havn't handled "`+i+'" in afterquote yet, index '+this.place)};Ip.prototype.afterItem=function(i){if(i===","){this.word!==null&&this.currentObject.push(this.word),this.word=null,this.state=h1;return}if(i==="]"){this.level--,this.word!==null&&(this.currentObject.push(this.word),this.word=null),this.state=h1,this.currentObject=this.stack.pop(),this.currentObject||(this.state=fw);return}};Ip.prototype.number=function(i){if(fE.test(i)){this.word+=i;return}if(Ox.test(i)){this.word=parseFloat(this.word),this.afterItem(i);return}throw new Error(`havn't handled "`+i+'" in number yet, index '+this.place)};Ip.prototype.quoted=function(i){if(i==='"'){this.state=hE;return}this.word+=i};Ip.prototype.keyword=function(i){if(M5.test(i)){this.word+=i;return}if(i==="["){var e=[];e.push(this.word),this.level++,this.root===null?this.root=e:this.currentObject.push(e),this.stack.push(this.currentObject),this.currentObject=e,this.state=h1;return}if(Ox.test(i)){this.afterItem(i);return}throw new Error(`havn't handled "`+i+'" in keyword yet, index '+this.place)};Ip.prototype.neutral=function(i){if(E5.test(i)){this.word=i,this.state=cE;return}if(i==='"'){this.word="",this.state=Vv;return}if(fE.test(i)){this.word=i,this.state=uE;return}if(Ox.test(i)){this.afterItem(i);return}throw new Error(`havn't handled "`+i+'" in neutral yet, index '+this.place)};Ip.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(this.state===fw)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};function R5(i){var e=new Ip(i);return e.output()}function Ab(i,e,t){Array.isArray(e)&&(t.unshift(e),e=null);var r=e?{}:i,o=t.reduce(function(p,_){return Dy(_,p),p},r);e&&(i[e]=o)}function Dy(i,e){if(!Array.isArray(i)){e[i]=!0;return}var t=i.shift();if(t==="PARAMETER"&&(t=i.shift()),i.length===1){if(Array.isArray(i[0])){e[t]={},Dy(i[0],e[t]);return}e[t]=i[0];return}if(!i.length){e[t]=!0;return}if(t==="TOWGS84"){e[t]=i;return}if(t==="AXIS"){t in e||(e[t]=[]),e[t].push(i);return}Array.isArray(t)||(e[t]={});var r;switch(t){case"UNIT":case"PRIMEM":case"VERT_DATUM":e[t]={name:i[0].toLowerCase(),convert:i[1]},i.length===3&&Dy(i[2],e[t]);return;case"SPHEROID":case"ELLIPSOID":e[t]={name:i[0],a:i[1],rf:i[2]},i.length===4&&Dy(i[3],e[t]);return;case"EDATUM":case"ENGINEERINGDATUM":case"LOCAL_DATUM":case"DATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":i[0]=["name",i[0]],Ab(e,t,i);return;case"COMPD_CS":case"COMPOUNDCRS":case"FITTED_CS":case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"ENGCRS":case"ENGINEERINGCRS":i[0]=["name",i[0]],Ab(e,t,i),e[t].type=t;return;default:for(r=-1;++r<i.length;)if(!Array.isArray(i[r]))return Dy(i,e[t]);return Ab(e,t,i)}}var C5=.017453292519943295;function Yf(i){return i*C5}function dE(i){const e=(i.projName||"").toLowerCase().replace(/_/g," ");!i.long0&&i.longc&&(e==="albers conic equal area"||e==="lambert azimuthal equal area")&&(i.long0=i.longc),!i.lat_ts&&i.lat1&&(e==="stereographic south pole"||e==="polar stereographic (variant b)")?(i.lat0=Yf(i.lat1>0?90:-90),i.lat_ts=i.lat1,delete i.lat1):!i.lat_ts&&i.lat0&&(e==="polar stereographic"||e==="polar stereographic (variant a)")&&(i.lat_ts=i.lat0,i.lat0=Yf(i.lat0>0?90:-90),delete i.lat1)}function MT(i){let e={units:null,to_meter:void 0};return typeof i=="string"?(e.units=i.toLowerCase(),e.units==="metre"&&(e.units="meter"),e.units==="meter"&&(e.to_meter=1)):i&&i.name&&(e.units=i.name.toLowerCase(),e.units==="metre"&&(e.units="meter"),e.to_meter=i.conversion_factor),e}function RT(i){return typeof i=="object"?i.value*i.unit.conversion_factor:i}function CT(i,e){i.ellipsoid.radius?(e.a=i.ellipsoid.radius,e.rf=0):(e.a=RT(i.ellipsoid.semi_major_axis),i.ellipsoid.inverse_flattening!==void 0?e.rf=i.ellipsoid.inverse_flattening:i.ellipsoid.semi_major_axis!==void 0&&i.ellipsoid.semi_minor_axis!==void 0&&(e.rf=e.a/(e.a-RT(i.ellipsoid.semi_minor_axis))))}function jv(i,e={}){return!i||typeof i!="object"?i:i.type==="BoundCRS"?(jv(i.source_crs,e),i.transformation&&(i.transformation.method&&i.transformation.method.name==="NTv2"?e.nadgrids=i.transformation.parameters[0].value:e.datum_params=i.transformation.parameters.map(t=>t.value)),e):(Object.keys(i).forEach(t=>{const r=i[t];if(r!==null)switch(t){case"name":if(e.srsCode)break;e.name=r,e.srsCode=r;break;case"type":r==="GeographicCRS"?e.projName="longlat":r==="ProjectedCRS"&&i.conversion&&i.conversion.method&&(e.projName=i.conversion.method.name);break;case"datum":case"datum_ensemble":r.ellipsoid&&(e.ellps=r.ellipsoid.name,CT(r,e)),r.prime_meridian&&(e.from_greenwich=r.prime_meridian.longitude*Math.PI/180);break;case"ellipsoid":e.ellps=r.name,CT(r,e);break;case"prime_meridian":e.long0=(r.longitude||0)*Math.PI/180;break;case"coordinate_system":if(r.axis){if(e.axis=r.axis.map(o=>{const p=o.direction;if(p==="east")return"e";if(p==="north")return"n";if(p==="west")return"w";if(p==="south")return"s";throw new Error(`Unknown axis direction: ${p}`)}).join("")+"u",r.unit){const{units:o,to_meter:p}=MT(r.unit);e.units=o,e.to_meter=p}else if(r.axis[0]&&r.axis[0].unit){const{units:o,to_meter:p}=MT(r.axis[0].unit);e.units=o,e.to_meter=p}}break;case"id":r.authority&&r.code&&(e.title=r.authority+":"+r.code);break;case"conversion":r.method&&r.method.name&&(e.projName=r.method.name),r.parameters&&r.parameters.forEach(o=>{const p=o.name.toLowerCase().replace(/\s+/g,"_"),_=o.value;o.unit&&o.unit.conversion_factor?e[p]=_*o.unit.conversion_factor:o.unit==="degree"?e[p]=_*Math.PI/180:e[p]=_});break;case"unit":r.name&&(e.units=r.name.toLowerCase(),e.units==="metre"&&(e.units="meter")),r.conversion_factor&&(e.to_meter=r.conversion_factor);break;case"base_crs":jv(r,e),e.datumCode=r.id?r.id.authority+"_"+r.id.code:r.name;break}}),e.latitude_of_false_origin!==void 0&&(e.lat0=e.latitude_of_false_origin),e.longitude_of_false_origin!==void 0&&(e.long0=e.longitude_of_false_origin),e.latitude_of_standard_parallel!==void 0&&(e.lat0=e.latitude_of_standard_parallel,e.lat1=e.latitude_of_standard_parallel),e.latitude_of_1st_standard_parallel!==void 0&&(e.lat1=e.latitude_of_1st_standard_parallel),e.latitude_of_2nd_standard_parallel!==void 0&&(e.lat2=e.latitude_of_2nd_standard_parallel),e.latitude_of_projection_centre!==void 0&&(e.lat0=e.latitude_of_projection_centre),e.longitude_of_projection_centre!==void 0&&(e.longc=e.longitude_of_projection_centre),e.easting_at_false_origin!==void 0&&(e.x0=e.easting_at_false_origin),e.northing_at_false_origin!==void 0&&(e.y0=e.northing_at_false_origin),e.latitude_of_natural_origin!==void 0&&(e.lat0=e.latitude_of_natural_origin),e.longitude_of_natural_origin!==void 0&&(e.long0=e.longitude_of_natural_origin),e.longitude_of_origin!==void 0&&(e.long0=e.longitude_of_origin),e.false_easting!==void 0&&(e.x0=e.false_easting),e.easting_at_projection_centre&&(e.x0=e.easting_at_projection_centre),e.false_northing!==void 0&&(e.y0=e.false_northing),e.northing_at_projection_centre&&(e.y0=e.northing_at_projection_centre),e.standard_parallel_1!==void 0&&(e.lat1=e.standard_parallel_1),e.standard_parallel_2!==void 0&&(e.lat2=e.standard_parallel_2),e.scale_factor_at_natural_origin!==void 0&&(e.k0=e.scale_factor_at_natural_origin),e.scale_factor_at_projection_centre!==void 0&&(e.k0=e.scale_factor_at_projection_centre),e.scale_factor_on_pseudo_standard_parallel!==void 0&&(e.k0=e.scale_factor_on_pseudo_standard_parallel),e.azimuth!==void 0&&(e.alpha=e.azimuth),e.azimuth_at_projection_centre!==void 0&&(e.alpha=e.azimuth_at_projection_centre),e.angle_from_rectified_to_skew_grid&&(e.rectified_grid_angle=e.angle_from_rectified_to_skew_grid),dE(e),e)}var P5=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];function I5(i,e){var t=e[0],r=e[1];!(t in i)&&r in i&&(i[t]=i[r],e.length===3&&(i[t]=e[2](i[t])))}function pE(i){for(var e=Object.keys(i),t=0,r=e.length;t<r;++t){var o=e[t];P5.indexOf(o)!==-1&&k5(i[o]),typeof i[o]=="object"&&pE(i[o])}}function k5(i){if(i.AUTHORITY){var e=Object.keys(i.AUTHORITY)[0];e&&e in i.AUTHORITY&&(i.title=e+":"+i.AUTHORITY[e])}if(i.type==="GEOGCS"?i.projName="longlat":i.type==="LOCAL_CS"?(i.projName="identity",i.local=!0):typeof i.PROJECTION=="object"?i.projName=Object.keys(i.PROJECTION)[0]:i.projName=i.PROJECTION,i.AXIS){for(var t="",r=0,o=i.AXIS.length;r<o;++r){var p=[i.AXIS[r][0].toLowerCase(),i.AXIS[r][1].toLowerCase()];p[0].indexOf("north")!==-1||(p[0]==="y"||p[0]==="lat")&&p[1]==="north"?t+="n":p[0].indexOf("south")!==-1||(p[0]==="y"||p[0]==="lat")&&p[1]==="south"?t+="s":p[0].indexOf("east")!==-1||(p[0]==="x"||p[0]==="lon")&&p[1]==="east"?t+="e":(p[0].indexOf("west")!==-1||(p[0]==="x"||p[0]==="lon")&&p[1]==="west")&&(t+="w")}t.length===2&&(t+="u"),t.length===3&&(i.axis=t)}i.UNIT&&(i.units=i.UNIT.name.toLowerCase(),i.units==="metre"&&(i.units="meter"),i.UNIT.convert&&(i.type==="GEOGCS"?i.DATUM&&i.DATUM.SPHEROID&&(i.to_meter=i.UNIT.convert*i.DATUM.SPHEROID.a):i.to_meter=i.UNIT.convert));var _=i.GEOGCS;i.type==="GEOGCS"&&(_=i),_&&(_.DATUM?i.datumCode=_.DATUM.name.toLowerCase():i.datumCode=_.name.toLowerCase(),i.datumCode.slice(0,2)==="d_"&&(i.datumCode=i.datumCode.slice(2)),i.datumCode==="new_zealand_1949"&&(i.datumCode="nzgd49"),(i.datumCode==="wgs_1984"||i.datumCode==="world_geodetic_system_1984")&&(i.PROJECTION==="Mercator_Auxiliary_Sphere"&&(i.sphere=!0),i.datumCode="wgs84"),i.datumCode==="belge_1972"&&(i.datumCode="rnb72"),_.DATUM&&_.DATUM.SPHEROID&&(i.ellps=_.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),i.ellps.toLowerCase().slice(0,13)==="international"&&(i.ellps="intl"),i.a=_.DATUM.SPHEROID.a,i.rf=parseFloat(_.DATUM.SPHEROID.rf,10)),_.DATUM&&_.DATUM.TOWGS84&&(i.datum_params=_.DATUM.TOWGS84),~i.datumCode.indexOf("osgb_1936")&&(i.datumCode="osgb36"),~i.datumCode.indexOf("osni_1952")&&(i.datumCode="osni52"),(~i.datumCode.indexOf("tm65")||~i.datumCode.indexOf("geodetic_datum_of_1965"))&&(i.datumCode="ire65"),i.datumCode==="ch1903+"&&(i.datumCode="ch1903"),~i.datumCode.indexOf("israel")&&(i.datumCode="isr93")),i.b&&!isFinite(i.b)&&(i.b=i.a),i.rectified_grid_angle&&(i.rectified_grid_angle=Yf(i.rectified_grid_angle));function l(B){var j=i.to_meter||1;return B*j}var M=function(B){return I5(i,B)},D=[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",Yf],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",Yf],["x0","false_easting",l],["y0","false_northing",l],["long0","central_meridian",Yf],["lat0","latitude_of_origin",Yf],["lat0","standard_parallel_1",Yf],["lat1","standard_parallel_1",Yf],["lat2","standard_parallel_2",Yf],["azimuth","Azimuth"],["alpha","azimuth",Yf],["srsCode","name"]];D.forEach(M),dE(i)}function Gv(i){if(typeof i=="object")return jv(i);const e=T5(i);var t=R5(i);if(e==="WKT2"){const p=w5(t);return jv(p)}var r=t[0],o={};return Dy(t,o),pE(o),o[r]}function vl(i){var e=this;if(arguments.length===2){var t=arguments[1];typeof t=="string"?t.charAt(0)==="+"?vl[i]=hA(arguments[1]):vl[i]=Gv(arguments[1]):t&&typeof t=="object"&&!("projName"in t)?vl[i]=Gv(arguments[1]):(vl[i]=t,t||delete vl[i])}else if(arguments.length===1){if(Array.isArray(i))return i.map(function(r){return Array.isArray(r)?vl.apply(e,r):vl(r)});if(typeof i=="string"){if(i in vl)return vl[i]}else"EPSG"in i?vl["EPSG:"+i.EPSG]=i:"ESRI"in i?vl["ESRI:"+i.ESRI]=i:"IAU2000"in i?vl["IAU2000:"+i.IAU2000]=i:console.log(i);return}}d5(vl);function D5(i){return typeof i=="string"}function O5(i){return i in vl}function F5(i){return i.indexOf("+")!==0&&i.indexOf("[")!==-1||typeof i=="object"&&!("srsCode"in i)}var N5=["3857","900913","3785","102113"];function B5(i){var e=qg(i,"authority");if(e){var t=qg(e,"epsg");return t&&N5.indexOf(t)>-1}}function z5(i){var e=qg(i,"extension");if(e)return qg(e,"proj4")}function L5(i){return i[0]==="+"}function U5(i){if(D5(i)){if(O5(i))return vl[i];if(F5(i)){var e=Gv(i);if(B5(e))return vl["EPSG:3857"];var t=z5(e);return t?hA(t):e}if(L5(i))return hA(i)}else return"projName"in i?i:Gv(i)}function PT(i,e){i=i||{};var t,r;if(!e)return i;for(r in e)t=e[r],t!==void 0&&(i[r]=t);return i}function l0(i,e,t){var r=i*e;return t/Math.sqrt(1-r*r)}function M1(i){return i<0?-1:1}function Ci(i,e){return e||Math.abs(i)<=Da?i:i-M1(i)*u1}function Kf(i,e,t){var r=i*t,o=.5*i;return r=Math.pow((1-r)/(1+r),o),Math.tan(.5*(oi-e))/r}function f1(i,e){for(var t=.5*i,r,o,p=oi-2*Math.atan(e),_=0;_<=15;_++)if(r=i*Math.sin(p),o=oi-2*Math.atan(e*Math.pow((1-r)/(1+r),t))-p,p+=o,Math.abs(o)<=1e-10)return p;return-9999}function V5(){var i=this.b/this.a;this.es=1-i*i,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=l0(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)}function j5(i){var e=i.x,t=i.y;if(t*lu>90&&t*lu<-90&&e*lu>180&&e*lu<-180)return null;var r,o;if(Math.abs(Math.abs(t)-oi)<=wi)return null;if(this.sphere)r=this.x0+this.a*this.k0*Ci(e-this.long0,this.over),o=this.y0+this.a*this.k0*Math.log(Math.tan(jr+.5*t));else{var p=Math.sin(t),_=Kf(this.e,t,p);r=this.x0+this.a*this.k0*Ci(e-this.long0,this.over),o=this.y0-this.a*this.k0*Math.log(_)}return i.x=r,i.y=o,i}function G5(i){var e=i.x-this.x0,t=i.y-this.y0,r,o;if(this.sphere)o=oi-2*Math.atan(Math.exp(-t/(this.a*this.k0)));else{var p=Math.exp(-t/(this.a*this.k0));if(o=f1(this.e,p),o===-9999)return null}return r=Ci(this.long0+e/(this.a*this.k0),this.over),i.x=r,i.y=o,i}var W5=["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","Mercator_Variant_A","merc"];const Z5={init:V5,forward:j5,inverse:G5,names:W5};function X5(){}function IT(i){return i}var gE=["longlat","identity"];const H5={init:X5,forward:IT,inverse:IT,names:gE};var $5=[Z5,H5],f_={},Oy=[];function mE(i,e){var t=Oy.length;return i.names?(Oy[t]=i,i.names.forEach(function(r){f_[r.toLowerCase()]=t}),this):(console.log(e),!0)}function _E(i){return i.replace(/[-\(\)\s]+/g," ").trim().replace(/ /g,"_")}function q5(i){if(!i)return!1;var e=i.toLowerCase();if(typeof f_[e]<"u"&&Oy[f_[e]]||(e=_E(e),e in f_&&Oy[f_[e]]))return Oy[f_[e]]}function Y5(){$5.forEach(mE)}const J5={start:Y5,add:mE,get:q5};var yE={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563396e-3,b:635625691e-2,ellipseName:"Airy 1830"},APL4:{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340189e-3,b:6356034446e-3,ellipseName:"Modified Airy"},andrae:{a:637710443e-2,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397155e-3,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483865e-3,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:63782064e-1,b:63565838e-1,ellipseName:"Clarke 1866"},clrk80:{a:6378249145e-3,rf:293.4663,ellipseName:"Clarke 1880 mod."},clrk80ign:{a:63782492e-1,b:6356515,rf:293.4660213,ellipseName:"Clarke 1880 (IGN)"},clrk58:{a:6378293645208759e-9,rf:294.2606763692654,ellipseName:"Clarke 1858"},CPM:{a:63757387e-1,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:637813605e-2,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276345e-3,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304063e-3,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301243e-3,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295664e-3,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298556e-3,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"},new_intl:{a:63781575e-1,b:63567722e-1,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},SEasia:{a:6378155,b:63567733205e-4,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:63558348467e-4,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS7:{a:6378135,rf:298.26,ellipseName:"WGS 72"},WGS84:{a:6378137,rf:298.257223563,ellipseName:"WGS 84"},sphere:{a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"}};const Q5=yE.WGS84;function K5(i,e,t,r){var o=i*i,p=e*e,_=(o-p)/o,l=0;r?(i*=1-_*(m5+_*(_5+_*y5)),o=i*i,_=0):l=Math.sqrt(_);var M=(o-p)/p;return{es:_,e:l,ep2:M}}function ek(i,e,t,r,o){if(!i){var p=qg(yE,r);p||(p=Q5),i=p.a,e=p.b,t=p.rf}return t&&!e&&(e=(1-1/t)*i),(t===0||Math.abs(i-e)<wi)&&(o=!0,e=i),{a:i,b:e,rf:t,sphere:o}}var xv={wgs84:{towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},ch1903:{towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},ggrs87:{towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},nad83:{towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},nad27:{nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},potsdam:{towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},carthage:{towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},hermannskogel:{towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"},mgi:{towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Militar-Geographische Institut"},osni52:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"},ire65:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},rassadiran:{towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},nzgd49:{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},osgb36:{towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Ordnance Survey of Great Britain 1936"},s_jtsk:{towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},beduaram:{towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},gunung_segara:{towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},rnb72:{towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"},EPSG_5451:{towgs84:"6.41,-49.05,-11.28,1.5657,0.5242,6.9718,-5.7649"},IGNF_LURESG:{towgs84:"-192.986,13.673,-39.309,-0.4099,-2.9332,2.6881,0.43"},EPSG_4614:{towgs84:"-119.4248,-303.65872,-11.00061,1.164298,0.174458,1.096259,3.657065"},EPSG_4615:{towgs84:"-494.088,-312.129,279.877,-1.423,-1.013,1.59,-0.748"},ESRI_37241:{towgs84:"-76.822,257.457,-12.817,2.136,-0.033,-2.392,-0.031"},ESRI_37249:{towgs84:"-440.296,58.548,296.265,1.128,10.202,4.559,-0.438"},ESRI_37245:{towgs84:"-511.151,-181.269,139.609,1.05,2.703,1.798,3.071"},EPSG_4178:{towgs84:"24.9,-126.4,-93.2,-0.063,-0.247,-0.041,1.01"},EPSG_4622:{towgs84:"-472.29,-5.63,-304.12,0.4362,-0.8374,0.2563,1.8984"},EPSG_4625:{towgs84:"126.93,547.94,130.41,-2.7867,5.1612,-0.8584,13.8227"},EPSG_5252:{towgs84:"0.023,0.036,-0.068,0.00176,0.00912,-0.01136,0.00439"},EPSG_4314:{towgs84:"597.1,71.4,412.1,0.894,0.068,-1.563,7.58"},EPSG_4282:{towgs84:"-178.3,-316.7,-131.5,5.278,6.077,10.979,19.166"},EPSG_4231:{towgs84:"-83.11,-97.38,-117.22,0.0276,-0.2167,0.2147,0.1218"},EPSG_4274:{towgs84:"-230.994,102.591,25.199,0.633,-0.239,0.9,1.95"},EPSG_4134:{towgs84:"-180.624,-225.516,173.919,-0.81,-1.898,8.336,16.71006"},EPSG_4254:{towgs84:"18.38,192.45,96.82,0.056,-0.142,-0.2,-0.0013"},EPSG_4159:{towgs84:"-194.513,-63.978,-25.759,-3.4027,3.756,-3.352,-0.9175"},EPSG_4687:{towgs84:"0.072,-0.507,-0.245,0.0183,-0.0003,0.007,-0.0093"},EPSG_4227:{towgs84:"-83.58,-397.54,458.78,-17.595,-2.847,4.256,3.225"},EPSG_4746:{towgs84:"599.4,72.4,419.2,-0.062,-0.022,-2.723,6.46"},EPSG_4745:{towgs84:"612.4,77,440.2,-0.054,0.057,-2.797,2.55"},EPSG_6311:{towgs84:"8.846,-4.394,-1.122,-0.00237,-0.146528,0.130428,0.783926"},EPSG_4289:{towgs84:"565.7381,50.4018,465.2904,-1.91514,1.60363,-9.09546,4.07244"},EPSG_4230:{towgs84:"-68.863,-134.888,-111.49,-0.53,-0.14,0.57,-3.4"},EPSG_4154:{towgs84:"-123.02,-158.95,-168.47"},EPSG_4156:{towgs84:"570.8,85.7,462.8,4.998,1.587,5.261,3.56"},EPSG_4299:{towgs84:"482.5,-130.6,564.6,-1.042,-0.214,-0.631,8.15"},EPSG_4179:{towgs84:"33.4,-146.6,-76.3,-0.359,-0.053,0.844,-0.84"},EPSG_4313:{towgs84:"-106.8686,52.2978,-103.7239,0.3366,-0.457,1.8422,-1.2747"},EPSG_4194:{towgs84:"163.511,127.533,-159.789"},EPSG_4195:{towgs84:"105,326,-102.5"},EPSG_4196:{towgs84:"-45,417,-3.5"},EPSG_4611:{towgs84:"-162.619,-276.959,-161.764,0.067753,-2.243649,-1.158827,-1.094246"},EPSG_4633:{towgs84:"137.092,131.66,91.475,-1.9436,-11.5993,-4.3321,-7.4824"},EPSG_4641:{towgs84:"-408.809,366.856,-412.987,1.8842,-0.5308,2.1655,-121.0993"},EPSG_4643:{towgs84:"-480.26,-438.32,-643.429,16.3119,20.1721,-4.0349,-111.7002"},EPSG_4300:{towgs84:"482.5,-130.6,564.6,-1.042,-0.214,-0.631,8.15"},EPSG_4188:{towgs84:"482.5,-130.6,564.6,-1.042,-0.214,-0.631,8.15"},EPSG_4660:{towgs84:"982.6087,552.753,-540.873,32.39344,-153.25684,-96.2266,16.805"},EPSG_4662:{towgs84:"97.295,-263.247,310.882,-1.5999,0.8386,3.1409,13.3259"},EPSG_3906:{towgs84:"577.88891,165.22205,391.18289,4.9145,-0.94729,-13.05098,7.78664"},EPSG_4307:{towgs84:"-209.3622,-87.8162,404.6198,0.0046,3.4784,0.5805,-1.4547"},EPSG_6892:{towgs84:"-76.269,-16.683,68.562,-6.275,10.536,-4.286,-13.686"},EPSG_4690:{towgs84:"221.597,152.441,176.523,2.403,1.3893,0.884,11.4648"},EPSG_4691:{towgs84:"218.769,150.75,176.75,3.5231,2.0037,1.288,10.9817"},EPSG_4629:{towgs84:"72.51,345.411,79.241,-1.5862,-0.8826,-0.5495,1.3653"},EPSG_4630:{towgs84:"165.804,216.213,180.26,-0.6251,-0.4515,-0.0721,7.4111"},EPSG_4692:{towgs84:"217.109,86.452,23.711,0.0183,-0.0003,0.007,-0.0093"},EPSG_9333:{towgs84:"0,0,0,-8.393,0.749,-10.276,0"},EPSG_9059:{towgs84:"0,0,0"},EPSG_4312:{towgs84:"601.705,84.263,485.227,4.7354,1.3145,5.393,-2.3887"},EPSG_4123:{towgs84:"-96.062,-82.428,-121.753,4.801,0.345,-1.376,1.496"},EPSG_4309:{towgs84:"-124.45,183.74,44.64,-0.4384,0.5446,-0.9706,-2.1365"},ESRI_104106:{towgs84:"-283.088,-70.693,117.445,-1.157,0.059,-0.652,-4.058"},EPSG_4281:{towgs84:"-219.247,-73.802,269.529"},EPSG_4322:{towgs84:"0,0,4.5"},EPSG_4324:{towgs84:"0,0,1.9"},EPSG_4284:{towgs84:"43.822,-108.842,-119.585,1.455,-0.761,0.737,0.549"},EPSG_4277:{towgs84:"446.448,-125.157,542.06,0.15,0.247,0.842,-20.489"},EPSG_4207:{towgs84:"-282.1,-72.2,120,-1.529,0.145,-0.89,-4.46"},EPSG_4688:{towgs84:"347.175,1077.618,2623.677,33.9058,-70.6776,9.4013,186.0647"},EPSG_4689:{towgs84:"410.793,54.542,80.501,-2.5596,-2.3517,-0.6594,17.3218"},EPSG_4720:{towgs84:"0,0,4.5"},EPSG_4273:{towgs84:"278.3,93,474.5,7.889,0.05,-6.61,6.21"},EPSG_4240:{towgs84:"204.64,834.74,293.8"},EPSG_4817:{towgs84:"278.3,93,474.5,7.889,0.05,-6.61,6.21"},ESRI_104131:{towgs84:"426.62,142.62,460.09,4.98,4.49,-12.42,-17.1"},EPSG_4265:{towgs84:"-104.1,-49.1,-9.9,0.971,-2.917,0.714,-11.68"},EPSG_4263:{towgs84:"-111.92,-87.85,114.5,1.875,0.202,0.219,0.032"},EPSG_4298:{towgs84:"-689.5937,623.84046,-65.93566,-0.02331,1.17094,-0.80054,5.88536"},EPSG_4270:{towgs84:"-253.4392,-148.452,386.5267,0.15605,0.43,-0.1013,-0.0424"},EPSG_4229:{towgs84:"-121.8,98.1,-10.7"},EPSG_4220:{towgs84:"-55.5,-348,-229.2"},EPSG_4214:{towgs84:"12.646,-155.176,-80.863"},EPSG_4232:{towgs84:"-345,3,223"},EPSG_4238:{towgs84:"-1.977,-13.06,-9.993,0.364,0.254,0.689,-1.037"},EPSG_4168:{towgs84:"-170,33,326"},EPSG_4131:{towgs84:"199,931,318.9"},EPSG_4152:{towgs84:"-0.9102,2.0141,0.5602,0.029039,0.010065,0.010101,0"},EPSG_5228:{towgs84:"572.213,85.334,461.94,4.9732,1.529,5.2484,3.5378"},EPSG_8351:{towgs84:"485.021,169.465,483.839,7.786342,4.397554,4.102655,0"},EPSG_4683:{towgs84:"-127.62,-67.24,-47.04,-3.068,4.903,1.578,-1.06"},EPSG_4133:{towgs84:"0,0,0"},EPSG_7373:{towgs84:"0.819,-0.5762,-1.6446,-0.00378,-0.03317,0.00318,0.0693"},EPSG_9075:{towgs84:"-0.9102,2.0141,0.5602,0.029039,0.010065,0.010101,0"},EPSG_9072:{towgs84:"-0.9102,2.0141,0.5602,0.029039,0.010065,0.010101,0"},EPSG_9294:{towgs84:"1.16835,-1.42001,-2.24431,-0.00822,-0.05508,0.01818,0.23388"},EPSG_4212:{towgs84:"-267.434,173.496,181.814,-13.4704,8.7154,7.3926,14.7492"},EPSG_4191:{towgs84:"-44.183,-0.58,-38.489,2.3867,2.7072,-3.5196,-8.2703"},EPSG_4237:{towgs84:"52.684,-71.194,-13.975,-0.312,-0.1063,-0.3729,1.0191"},EPSG_4740:{towgs84:"-1.08,-0.27,-0.9"},EPSG_4124:{towgs84:"419.3836,99.3335,591.3451,0.850389,1.817277,-7.862238,-0.99496"},EPSG_5681:{towgs84:"584.9636,107.7175,413.8067,1.1155,0.2824,-3.1384,7.9922"},EPSG_4141:{towgs84:"23.772,17.49,17.859,-0.3132,-1.85274,1.67299,-5.4262"},EPSG_4204:{towgs84:"-85.645,-273.077,-79.708,2.289,-1.421,2.532,3.194"},EPSG_4319:{towgs84:"226.702,-193.337,-35.371,-2.229,-4.391,9.238,0.9798"},EPSG_4200:{towgs84:"24.82,-131.21,-82.66"},EPSG_4130:{towgs84:"0,0,0"},EPSG_4127:{towgs84:"-82.875,-57.097,-156.768,-2.158,1.524,-0.982,-0.359"},EPSG_4149:{towgs84:"674.374,15.056,405.346"},EPSG_4617:{towgs84:"-0.991,1.9072,0.5129,1.25033e-7,4.6785e-8,5.6529e-8,0"},EPSG_4663:{towgs84:"-210.502,-66.902,-48.476,2.094,-15.067,-5.817,0.485"},EPSG_4664:{towgs84:"-211.939,137.626,58.3,-0.089,0.251,0.079,0.384"},EPSG_4665:{towgs84:"-105.854,165.589,-38.312,-0.003,-0.026,0.024,-0.048"},EPSG_4666:{towgs84:"631.392,-66.551,481.442,1.09,-4.445,-4.487,-4.43"},EPSG_4756:{towgs84:"-192.873,-39.382,-111.202,-0.00205,-0.0005,0.00335,0.0188"},EPSG_4723:{towgs84:"-179.483,-69.379,-27.584,-7.862,8.163,6.042,-13.925"},EPSG_4726:{towgs84:"8.853,-52.644,180.304,-0.393,-2.323,2.96,-24.081"},EPSG_4267:{towgs84:"-8.0,160.0,176.0"},EPSG_5365:{towgs84:"-0.16959,0.35312,0.51846,0.03385,-0.16325,0.03446,0.03693"},EPSG_4218:{towgs84:"304.5,306.5,-318.1"},EPSG_4242:{towgs84:"-33.722,153.789,94.959,-8.581,-4.478,4.54,8.95"},EPSG_4216:{towgs84:"-292.295,248.758,429.447,4.9971,2.99,6.6906,1.0289"},ESRI_104105:{towgs84:"631.392,-66.551,481.442,1.09,-4.445,-4.487,-4.43"},ESRI_104129:{towgs84:"0,0,0"},EPSG_4673:{towgs84:"174.05,-25.49,112.57"},EPSG_4202:{towgs84:"-124,-60,154"},EPSG_4203:{towgs84:"-117.763,-51.51,139.061,0.292,0.443,0.277,-0.191"},EPSG_3819:{towgs84:"595.48,121.69,515.35,4.115,-2.9383,0.853,-3.408"},EPSG_8694:{towgs84:"-93.799,-132.737,-219.073,-1.844,0.648,-6.37,-0.169"},EPSG_4145:{towgs84:"275.57,676.78,229.6"},EPSG_4283:{towgs84:"61.55,-10.87,-40.19,39.4924,32.7221,32.8979,-9.994"},EPSG_4317:{towgs84:"2.3287,-147.0425,-92.0802,-0.3092483,0.32482185,0.49729934,5.68906266"},EPSG_4272:{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993"},EPSG_4248:{towgs84:"-307.7,265.3,-363.5"},EPSG_5561:{towgs84:"24,-121,-76"},EPSG_5233:{towgs84:"-0.293,766.95,87.713,0.195704,1.695068,3.473016,-0.039338"},ESRI_104130:{towgs84:"-86,-98,-119"},ESRI_104102:{towgs84:"682,-203,480"},ESRI_37207:{towgs84:"7,-10,-26"},EPSG_4675:{towgs84:"59.935,118.4,-10.871"},ESRI_104109:{towgs84:"-89.121,-348.182,260.871"},ESRI_104112:{towgs84:"-185.583,-230.096,281.361"},ESRI_104113:{towgs84:"25.1,-275.6,222.6"},IGNF_WGS72G:{towgs84:"0,12,6"},IGNF_NTFG:{towgs84:"-168,-60,320"},IGNF_EFATE57G:{towgs84:"-127,-769,472"},IGNF_PGP50G:{towgs84:"324.8,153.6,172.1"},IGNF_REUN47G:{towgs84:"94,-948,-1262"},IGNF_CSG67G:{towgs84:"-186,230,110"},IGNF_GUAD48G:{towgs84:"-467,-16,-300"},IGNF_TAHI51G:{towgs84:"162,117,154"},IGNF_TAHAAG:{towgs84:"65,342,77"},IGNF_NUKU72G:{towgs84:"84,274,65"},IGNF_PETRELS72G:{towgs84:"365,194,166"},IGNF_WALL78G:{towgs84:"253,-133,-127"},IGNF_MAYO50G:{towgs84:"-382,-59,-262"},IGNF_TANNAG:{towgs84:"-139,-967,436"},IGNF_IGN72G:{towgs84:"-13,-348,292"},IGNF_ATIGG:{towgs84:"1118,23,66"},IGNF_FANGA84G:{towgs84:"150.57,158.33,118.32"},IGNF_RUSAT84G:{towgs84:"202.13,174.6,-15.74"},IGNF_KAUE70G:{towgs84:"126.74,300.1,-75.49"},IGNF_MOP90G:{towgs84:"-10.8,-1.8,12.77"},IGNF_MHPF67G:{towgs84:"338.08,212.58,-296.17"},IGNF_TAHI79G:{towgs84:"160.61,116.05,153.69"},IGNF_ANAA92G:{towgs84:"1.5,3.84,4.81"},IGNF_MARQUI72G:{towgs84:"330.91,-13.92,58.56"},IGNF_APAT86G:{towgs84:"143.6,197.82,74.05"},IGNF_TUBU69G:{towgs84:"237.17,171.61,-77.84"},IGNF_STPM50G:{towgs84:"11.363,424.148,373.13"},EPSG_4150:{towgs84:"674.374,15.056,405.346"},EPSG_4754:{towgs84:"-208.4058,-109.8777,-2.5764"},ESRI_104101:{towgs84:"374,150,588"},EPSG_4693:{towgs84:"0,-0.15,0.68"},EPSG_6207:{towgs84:"293.17,726.18,245.36"},EPSG_4153:{towgs84:"-133.63,-157.5,-158.62"},EPSG_4132:{towgs84:"-241.54,-163.64,396.06"},EPSG_4221:{towgs84:"-154.5,150.7,100.4"},EPSG_4266:{towgs84:"-80.7,-132.5,41.1"},EPSG_4193:{towgs84:"-70.9,-151.8,-41.4"},EPSG_5340:{towgs84:"-0.41,0.46,-0.35"},EPSG_4246:{towgs84:"-294.7,-200.1,525.5"},EPSG_4318:{towgs84:"-3.2,-5.7,2.8"},EPSG_4121:{towgs84:"-199.87,74.79,246.62"},EPSG_4223:{towgs84:"-260.1,5.5,432.2"},EPSG_4158:{towgs84:"-0.465,372.095,171.736"},EPSG_4285:{towgs84:"-128.16,-282.42,21.93"},EPSG_4613:{towgs84:"-404.78,685.68,45.47"},EPSG_4607:{towgs84:"195.671,332.517,274.607"},EPSG_4475:{towgs84:"-381.788,-57.501,-256.673"},EPSG_4208:{towgs84:"-157.84,308.54,-146.6"},EPSG_4743:{towgs84:"70.995,-335.916,262.898"},EPSG_4710:{towgs84:"-323.65,551.39,-491.22"},EPSG_7881:{towgs84:"-0.077,0.079,0.086"},EPSG_4682:{towgs84:"283.729,735.942,261.143"},EPSG_4739:{towgs84:"-156,-271,-189"},EPSG_4679:{towgs84:"-80.01,253.26,291.19"},EPSG_4750:{towgs84:"-56.263,16.136,-22.856"},EPSG_4644:{towgs84:"-10.18,-350.43,291.37"},EPSG_4695:{towgs84:"-103.746,-9.614,-255.95"},EPSG_4292:{towgs84:"-355,21,72"},EPSG_4302:{towgs84:"-61.702,284.488,472.052"},EPSG_4143:{towgs84:"-124.76,53,466.79"},EPSG_4606:{towgs84:"-153,153,307"},EPSG_4699:{towgs84:"-770.1,158.4,-498.2"},EPSG_4247:{towgs84:"-273.5,110.6,-357.9"},EPSG_4160:{towgs84:"8.88,184.86,106.69"},EPSG_4161:{towgs84:"-233.43,6.65,173.64"},EPSG_9251:{towgs84:"-9.5,122.9,138.2"},EPSG_9253:{towgs84:"-78.1,101.6,133.3"},EPSG_4297:{towgs84:"-198.383,-240.517,-107.909"},EPSG_4269:{towgs84:"0,0,0"},EPSG_4301:{towgs84:"-147,506,687"},EPSG_4618:{towgs84:"-59,-11,-52"},EPSG_4612:{towgs84:"0,0,0"},EPSG_4678:{towgs84:"44.585,-131.212,-39.544"},EPSG_4250:{towgs84:"-130,29,364"},EPSG_4144:{towgs84:"214,804,268"},EPSG_4147:{towgs84:"-17.51,-108.32,-62.39"},EPSG_4259:{towgs84:"-254.1,-5.36,-100.29"},EPSG_4164:{towgs84:"-76,-138,67"},EPSG_4211:{towgs84:"-378.873,676.002,-46.255"},EPSG_4182:{towgs84:"-422.651,-172.995,84.02"},EPSG_4224:{towgs84:"-143.87,243.37,-33.52"},EPSG_4225:{towgs84:"-205.57,168.77,-4.12"},EPSG_5527:{towgs84:"-67.35,3.88,-38.22"},EPSG_4752:{towgs84:"98,390,-22"},EPSG_4310:{towgs84:"-30,190,89"},EPSG_9248:{towgs84:"-192.26,65.72,132.08"},EPSG_4680:{towgs84:"124.5,-63.5,-281"},EPSG_4701:{towgs84:"-79.9,-158,-168.9"},EPSG_4706:{towgs84:"-146.21,112.63,4.05"},EPSG_4805:{towgs84:"682,-203,480"},EPSG_4201:{towgs84:"-165,-11,206"},EPSG_4210:{towgs84:"-157,-2,-299"},EPSG_4183:{towgs84:"-104,167,-38"},EPSG_4139:{towgs84:"11,72,-101"},EPSG_4668:{towgs84:"-86,-98,-119"},EPSG_4717:{towgs84:"-2,151,181"},EPSG_4732:{towgs84:"102,52,-38"},EPSG_4280:{towgs84:"-377,681,-50"},EPSG_4209:{towgs84:"-138,-105,-289"},EPSG_4261:{towgs84:"31,146,47"},EPSG_4658:{towgs84:"-73,46,-86"},EPSG_4721:{towgs84:"265.025,384.929,-194.046"},EPSG_4222:{towgs84:"-136,-108,-292"},EPSG_4601:{towgs84:"-255,-15,71"},EPSG_4602:{towgs84:"725,685,536"},EPSG_4603:{towgs84:"72,213.7,93"},EPSG_4605:{towgs84:"9,183,236"},EPSG_4621:{towgs84:"137,248,-430"},EPSG_4657:{towgs84:"-28,199,5"},EPSG_4316:{towgs84:"103.25,-100.4,-307.19"},EPSG_4642:{towgs84:"-13,-348,292"},EPSG_4698:{towgs84:"145,-187,103"},EPSG_4192:{towgs84:"-206.1,-174.7,-87.7"},EPSG_4311:{towgs84:"-265,120,-358"},EPSG_4135:{towgs84:"58,-283,-182"},ESRI_104138:{towgs84:"198,-226,-347"},EPSG_4245:{towgs84:"-11,851,5"},EPSG_4142:{towgs84:"-125,53,467"},EPSG_4213:{towgs84:"-106,-87,188"},EPSG_4253:{towgs84:"-133,-77,-51"},EPSG_4129:{towgs84:"-132,-110,-335"},EPSG_4713:{towgs84:"-77,-128,142"},EPSG_4239:{towgs84:"217,823,299"},EPSG_4146:{towgs84:"295,736,257"},EPSG_4155:{towgs84:"-83,37,124"},EPSG_4165:{towgs84:"-173,253,27"},EPSG_4672:{towgs84:"175,-38,113"},EPSG_4236:{towgs84:"-637,-549,-203"},EPSG_4251:{towgs84:"-90,40,88"},EPSG_4271:{towgs84:"-2,374,172"},EPSG_4175:{towgs84:"-88,4,101"},EPSG_4716:{towgs84:"298,-304,-375"},EPSG_4315:{towgs84:"-23,259,-9"},EPSG_4744:{towgs84:"-242.2,-144.9,370.3"},EPSG_4244:{towgs84:"-97,787,86"},EPSG_4293:{towgs84:"616,97,-251"},EPSG_4714:{towgs84:"-127,-769,472"},EPSG_4736:{towgs84:"260,12,-147"},EPSG_6883:{towgs84:"-235,-110,393"},EPSG_6894:{towgs84:"-63,176,185"},EPSG_4205:{towgs84:"-43,-163,45"},EPSG_4256:{towgs84:"41,-220,-134"},EPSG_4262:{towgs84:"639,405,60"},EPSG_4604:{towgs84:"174,359,365"},EPSG_4169:{towgs84:"-115,118,426"},EPSG_4620:{towgs84:"-106,-129,165"},EPSG_4184:{towgs84:"-203,141,53"},EPSG_4616:{towgs84:"-289,-124,60"},EPSG_9403:{towgs84:"-307,-92,127"},EPSG_4684:{towgs84:"-133,-321,50"},EPSG_4708:{towgs84:"-491,-22,435"},EPSG_4707:{towgs84:"114,-116,-333"},EPSG_4709:{towgs84:"145,75,-272"},EPSG_4712:{towgs84:"-205,107,53"},EPSG_4711:{towgs84:"124,-234,-25"},EPSG_4718:{towgs84:"230,-199,-752"},EPSG_4719:{towgs84:"211,147,111"},EPSG_4724:{towgs84:"208,-435,-229"},EPSG_4725:{towgs84:"189,-79,-202"},EPSG_4735:{towgs84:"647,1777,-1124"},EPSG_4722:{towgs84:"-794,119,-298"},EPSG_4728:{towgs84:"-307,-92,127"},EPSG_4734:{towgs84:"-632,438,-609"},EPSG_4727:{towgs84:"912,-58,1227"},EPSG_4729:{towgs84:"185,165,42"},EPSG_4730:{towgs84:"170,42,84"},EPSG_4733:{towgs84:"276,-57,149"},ESRI_37218:{towgs84:"230,-199,-752"},ESRI_37240:{towgs84:"-7,215,225"},ESRI_37221:{towgs84:"252,-209,-751"},ESRI_4305:{towgs84:"-123,-206,219"},ESRI_104139:{towgs84:"-73,-247,227"},EPSG_4748:{towgs84:"51,391,-36"},EPSG_4219:{towgs84:"-384,664,-48"},EPSG_4255:{towgs84:"-333,-222,114"},EPSG_4257:{towgs84:"-587.8,519.75,145.76"},EPSG_4646:{towgs84:"-963,510,-359"},EPSG_6881:{towgs84:"-24,-203,268"},EPSG_6882:{towgs84:"-183,-15,273"},EPSG_4715:{towgs84:"-104,-129,239"},IGNF_RGF93GDD:{towgs84:"0,0,0"},IGNF_RGM04GDD:{towgs84:"0,0,0"},IGNF_RGSPM06GDD:{towgs84:"0,0,0"},IGNF_RGTAAF07GDD:{towgs84:"0,0,0"},IGNF_RGFG95GDD:{towgs84:"0,0,0"},IGNF_RGNCG:{towgs84:"0,0,0"},IGNF_RGPFGDD:{towgs84:"0,0,0"},IGNF_ETRS89G:{towgs84:"0,0,0"},IGNF_RGR92GDD:{towgs84:"0,0,0"},EPSG_4173:{towgs84:"0,0,0"},EPSG_4180:{towgs84:"0,0,0"},EPSG_4619:{towgs84:"0,0,0"},EPSG_4667:{towgs84:"0,0,0"},EPSG_4075:{towgs84:"0,0,0"},EPSG_6706:{towgs84:"0,0,0"},EPSG_7798:{towgs84:"0,0,0"},EPSG_4661:{towgs84:"0,0,0"},EPSG_4669:{towgs84:"0,0,0"},EPSG_8685:{towgs84:"0,0,0"},EPSG_4151:{towgs84:"0,0,0"},EPSG_9702:{towgs84:"0,0,0"},EPSG_4758:{towgs84:"0,0,0"},EPSG_4761:{towgs84:"0,0,0"},EPSG_4765:{towgs84:"0,0,0"},EPSG_8997:{towgs84:"0,0,0"},EPSG_4023:{towgs84:"0,0,0"},EPSG_4670:{towgs84:"0,0,0"},EPSG_4694:{towgs84:"0,0,0"},EPSG_4148:{towgs84:"0,0,0"},EPSG_4163:{towgs84:"0,0,0"},EPSG_4167:{towgs84:"0,0,0"},EPSG_4189:{towgs84:"0,0,0"},EPSG_4190:{towgs84:"0,0,0"},EPSG_4176:{towgs84:"0,0,0"},EPSG_4659:{towgs84:"0,0,0"},EPSG_3824:{towgs84:"0,0,0"},EPSG_3889:{towgs84:"0,0,0"},EPSG_4046:{towgs84:"0,0,0"},EPSG_4081:{towgs84:"0,0,0"},EPSG_4558:{towgs84:"0,0,0"},EPSG_4483:{towgs84:"0,0,0"},EPSG_5013:{towgs84:"0,0,0"},EPSG_5264:{towgs84:"0,0,0"},EPSG_5324:{towgs84:"0,0,0"},EPSG_5354:{towgs84:"0,0,0"},EPSG_5371:{towgs84:"0,0,0"},EPSG_5373:{towgs84:"0,0,0"},EPSG_5381:{towgs84:"0,0,0"},EPSG_5393:{towgs84:"0,0,0"},EPSG_5489:{towgs84:"0,0,0"},EPSG_5593:{towgs84:"0,0,0"},EPSG_6135:{towgs84:"0,0,0"},EPSG_6365:{towgs84:"0,0,0"},EPSG_5246:{towgs84:"0,0,0"},EPSG_7886:{towgs84:"0,0,0"},EPSG_8431:{towgs84:"0,0,0"},EPSG_8427:{towgs84:"0,0,0"},EPSG_8699:{towgs84:"0,0,0"},EPSG_8818:{towgs84:"0,0,0"},EPSG_4757:{towgs84:"0,0,0"},EPSG_9140:{towgs84:"0,0,0"},EPSG_8086:{towgs84:"0,0,0"},EPSG_4686:{towgs84:"0,0,0"},EPSG_4737:{towgs84:"0,0,0"},EPSG_4702:{towgs84:"0,0,0"},EPSG_4747:{towgs84:"0,0,0"},EPSG_4749:{towgs84:"0,0,0"},EPSG_4674:{towgs84:"0,0,0"},EPSG_4755:{towgs84:"0,0,0"},EPSG_4759:{towgs84:"0,0,0"},EPSG_4762:{towgs84:"0,0,0"},EPSG_4763:{towgs84:"0,0,0"},EPSG_4764:{towgs84:"0,0,0"},EPSG_4166:{towgs84:"0,0,0"},EPSG_4170:{towgs84:"0,0,0"},EPSG_5546:{towgs84:"0,0,0"},EPSG_7844:{towgs84:"0,0,0"},EPSG_4818:{towgs84:"589,76,480"}};for(var tk in xv){var wb=xv[tk];wb.datumName&&(xv[wb.datumName]=wb)}function ik(i,e,t,r,o,p,_){var l={};return i===void 0||i==="none"?l.datum_type=uA:l.datum_type=p5,e&&(l.datum_params=e.map(parseFloat),(l.datum_params[0]!==0||l.datum_params[1]!==0||l.datum_params[2]!==0)&&(l.datum_type=A_),l.datum_params.length>3&&(l.datum_params[3]!==0||l.datum_params[4]!==0||l.datum_params[5]!==0||l.datum_params[6]!==0)&&(l.datum_type=w_,l.datum_params[3]*=$2,l.datum_params[4]*=$2,l.datum_params[5]*=$2,l.datum_params[6]=l.datum_params[6]/1e6+1)),_&&(l.datum_type=Wy,l.grids=_),l.a=t,l.b=r,l.es=o,l.ep2=p,l}var dw={};function nk(i,e,t){return e instanceof ArrayBuffer?rk(i,e,t):{ready:sk(i,e)}}function rk(i,e,t){var r=!0;t!==void 0&&t.includeErrorFields===!1&&(r=!1);var o=new DataView(e),p=lk(o),_=ck(o,p),l=uk(o,_,p,r),M={header:_,subgrids:l};return dw[i]=M,M}async function sk(i,e){for(var t=[],r=await e.getImageCount(),o=r-1;o>=0;o--){var p=await e.getImage(o),_=await p.readRasters(),l=_,M=[p.getWidth(),p.getHeight()],D=p.getBoundingBox().map(kT),B=[p.fileDirectory.ModelPixelScale[0],p.fileDirectory.ModelPixelScale[1]].map(kT),j=D[0]+(M[0]-1)*B[0],$=D[3]-(M[1]-1)*B[1],se=l[0],de=l[1],Ae=[];for(let $e=M[1]-1;$e>=0;$e--)for(let Be=M[0]-1;Be>=0;Be--){var he=$e*M[0]+Be;Ae.push([-Gg(de[he]),Gg(se[he])])}t.push({del:B,lim:M,ll:[-j,$],cvs:Ae})}var Le={header:{nSubgrids:r},subgrids:t};return dw[i]=Le,Le}function ak(i){if(i===void 0)return null;var e=i.split(",");return e.map(ok)}function ok(i){if(i.length===0)return null;var e=i[0]==="@";return e&&(i=i.slice(1)),i==="null"?{name:"null",mandatory:!e,grid:null,isNull:!0}:{name:i,mandatory:!e,grid:dw[i]||null,isNull:!1}}function kT(i){return i*Math.PI/180}function Gg(i){return i/3600*Math.PI/180}function lk(i){var e=i.getInt32(8,!1);return e===11?!1:(e=i.getInt32(8,!0),e!==11&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian"),!0)}function ck(i,e){return{nFields:i.getInt32(8,e),nSubgridFields:i.getInt32(24,e),nSubgrids:i.getInt32(40,e),shiftType:fA(i,56,64).trim(),fromSemiMajorAxis:i.getFloat64(120,e),fromSemiMinorAxis:i.getFloat64(136,e),toSemiMajorAxis:i.getFloat64(152,e),toSemiMinorAxis:i.getFloat64(168,e)}}function fA(i,e,t){return String.fromCharCode.apply(null,new Uint8Array(i.buffer.slice(e,t)))}function uk(i,e,t,r){for(var o=176,p=[],_=0;_<e.nSubgrids;_++){var l=fk(i,o,t),M=dk(i,o,l,t,r),D=Math.round(1+(l.upperLongitude-l.lowerLongitude)/l.longitudeInterval),B=Math.round(1+(l.upperLatitude-l.lowerLatitude)/l.latitudeInterval);p.push({ll:[Gg(l.lowerLongitude),Gg(l.lowerLatitude)],del:[Gg(l.longitudeInterval),Gg(l.latitudeInterval)],lim:[D,B],count:l.gridNodeCount,cvs:hk(M)});var j=16;r===!1&&(j=8),o+=176+l.gridNodeCount*j}return p}function hk(i){return i.map(function(e){return[Gg(e.longitudeShift),Gg(e.latitudeShift)]})}function fk(i,e,t){return{name:fA(i,e+8,e+16).trim(),parent:fA(i,e+24,e+24+8).trim(),lowerLatitude:i.getFloat64(e+72,t),upperLatitude:i.getFloat64(e+88,t),lowerLongitude:i.getFloat64(e+104,t),upperLongitude:i.getFloat64(e+120,t),latitudeInterval:i.getFloat64(e+136,t),longitudeInterval:i.getFloat64(e+152,t),gridNodeCount:i.getInt32(e+168,t)}}function dk(i,e,t,r,o){var p=e+176,_=16;o===!1&&(_=8);for(var l=[],M=0;M<t.gridNodeCount;M++){var D={latitudeShift:i.getFloat32(p+M*_,r),longitudeShift:i.getFloat32(p+M*_+4,r)};o!==!1&&(D.latitudeAccuracy=i.getFloat32(p+M*_+8,r),D.longitudeAccuracy=i.getFloat32(p+M*_+12,r)),l.push(D)}return l}function of(i,e){if(!(this instanceof of))return new of(i);this.forward=null,this.inverse=null,this.init=null,this.name,this.names=null,this.title,e=e||function(D){if(D)throw D};var t=U5(i);if(typeof t!="object"){e("Could not parse to valid json: "+i);return}var r=of.projections.get(t.projName);if(!r){e("Could not get projection name from: "+i);return}if(t.datumCode&&t.datumCode!=="none"){var o=qg(xv,t.datumCode);o&&(t.datum_params=t.datum_params||(o.towgs84?o.towgs84.split(","):null),t.ellps=o.ellipse,t.datumName=o.datumName?o.datumName:t.datumCode)}t.k0=t.k0||1,t.axis=t.axis||"enu",t.ellps=t.ellps||"wgs84",t.lat1=t.lat1||t.lat0;var p=ek(t.a,t.b,t.rf,t.ellps,t.sphere),_=K5(p.a,p.b,p.rf,t.R_A),l=ak(t.nadgrids),M=t.datum||ik(t.datumCode,t.datum_params,p.a,p.b,_.es,_.ep2,l);PT(this,t),PT(this,r),this.a=p.a,this.b=p.b,this.rf=p.rf,this.sphere=p.sphere,this.es=_.es,this.e=_.e,this.ep2=_.ep2,this.datum=M,"init"in this&&typeof this.init=="function"&&this.init(),e(null,this)}of.projections=J5;of.projections.start();function pk(i,e){return i.datum_type!==e.datum_type||i.a!==e.a||Math.abs(i.es-e.es)>5e-11?!1:i.datum_type===A_?i.datum_params[0]===e.datum_params[0]&&i.datum_params[1]===e.datum_params[1]&&i.datum_params[2]===e.datum_params[2]:i.datum_type===w_?i.datum_params[0]===e.datum_params[0]&&i.datum_params[1]===e.datum_params[1]&&i.datum_params[2]===e.datum_params[2]&&i.datum_params[3]===e.datum_params[3]&&i.datum_params[4]===e.datum_params[4]&&i.datum_params[5]===e.datum_params[5]&&i.datum_params[6]===e.datum_params[6]:!0}function vE(i,e,t){var r=i.x,o=i.y,p=i.z?i.z:0,_,l,M,D;if(o<-oi&&o>-1.001*oi)o=-oi;else if(o>oi&&o<1.001*oi)o=oi;else{if(o<-oi)return{x:-1/0,y:-1/0,z:i.z};if(o>oi)return{x:1/0,y:1/0,z:i.z}}return r>Math.PI&&(r-=2*Math.PI),l=Math.sin(o),D=Math.cos(o),M=l*l,_=t/Math.sqrt(1-e*M),{x:(_+p)*D*Math.cos(r),y:(_+p)*D*Math.sin(r),z:(_*(1-e)+p)*l}}function xE(i,e,t,r){var o=1e-12,p=o*o,_=30,l,M,D,B,j,$,se,de,Ae,he,Le,$e,Be,Je=i.x,Rt=i.y,Et=i.z?i.z:0,kt,Ht,Xt;if(l=Math.sqrt(Je*Je+Rt*Rt),M=Math.sqrt(Je*Je+Rt*Rt+Et*Et),l/t<o){if(kt=0,M/t<o)return Ht=oi,Xt=-r,{x:i.x,y:i.y,z:i.z}}else kt=Math.atan2(Rt,Je);D=Et/M,B=l/M,j=1/Math.sqrt(1-e*(2-e)*B*B),de=B*(1-e)*j,Ae=D*j,Be=0;do Be++,se=t/Math.sqrt(1-e*Ae*Ae),Xt=l*de+Et*Ae-se*(1-e*Ae*Ae),$=e*se/(se+Xt),j=1/Math.sqrt(1-$*(2-$)*B*B),he=B*(1-$)*j,Le=D*j,$e=Le*de-he*Ae,de=he,Ae=Le;while($e*$e>p&&Be<_);return Ht=Math.atan(Le/Math.abs(he)),{x:kt,y:Ht,z:Xt}}function gk(i,e,t){if(e===A_)return{x:i.x+t[0],y:i.y+t[1],z:i.z+t[2]};if(e===w_){var r=t[0],o=t[1],p=t[2],_=t[3],l=t[4],M=t[5],D=t[6];return{x:D*(i.x-M*i.y+l*i.z)+r,y:D*(M*i.x+i.y-_*i.z)+o,z:D*(-l*i.x+_*i.y+i.z)+p}}}function mk(i,e,t){if(e===A_)return{x:i.x-t[0],y:i.y-t[1],z:i.z-t[2]};if(e===w_){var r=t[0],o=t[1],p=t[2],_=t[3],l=t[4],M=t[5],D=t[6],B=(i.x-r)/D,j=(i.y-o)/D,$=(i.z-p)/D;return{x:B+M*j-l*$,y:-M*B+j+_*$,z:l*B-_*j+$}}}function ev(i){return i===A_||i===w_}function _k(i,e,t){if(pk(i,e)||i.datum_type===uA||e.datum_type===uA)return t;var r=i.a,o=i.es;if(i.datum_type===Wy){var p=DT(i,!1,t);if(p!==0)return;r=TT,o=ST}var _=e.a,l=e.b,M=e.es;if(e.datum_type===Wy&&(_=TT,l=g5,M=ST),o===M&&r===_&&!ev(i.datum_type)&&!ev(e.datum_type))return t;if(t=vE(t,o,r),ev(i.datum_type)&&(t=gk(t,i.datum_type,i.datum_params)),ev(e.datum_type)&&(t=mk(t,e.datum_type,e.datum_params)),t=xE(t,M,_,l),e.datum_type===Wy){var D=DT(e,!0,t);if(D!==0)return}return t}function DT(i,e,t){if(i.grids===null||i.grids.length===0)return console.log("Grid shift grids not found"),-1;var r={x:-t.x,y:t.y},o={x:Number.NaN,y:Number.NaN},p=[];e:for(var _=0;_<i.grids.length;_++){var l=i.grids[_];if(p.push(l.name),l.isNull){o=r;break}if(l.grid===null){if(l.mandatory)return console.log("Unable to find mandatory grid '"+l.name+"'"),-1;continue}for(var M=l.grid.subgrids,D=0,B=M.length;D<B;D++){var j=M[D],$=(Math.abs(j.del[1])+Math.abs(j.del[0]))/1e4,se=j.ll[0]-$,de=j.ll[1]-$,Ae=j.ll[0]+(j.lim[0]-1)*j.del[0]+$,he=j.ll[1]+(j.lim[1]-1)*j.del[1]+$;if(!(de>r.y||se>r.x||he<r.y||Ae<r.x)&&(o=yk(r,e,j),!isNaN(o.x)))break e}}return isNaN(o.x)?(console.log("Failed to find a grid shift table for location '"+-r.x*lu+" "+r.y*lu+" tried: '"+p+"'"),-1):(t.x=-o.x,t.y=o.y,0)}function yk(i,e,t){var r={x:Number.NaN,y:Number.NaN};if(isNaN(i.x))return r;var o={x:i.x,y:i.y};o.x-=t.ll[0],o.y-=t.ll[1],o.x=Ci(o.x-Math.PI)+Math.PI;var p=OT(o,t);if(e){if(isNaN(p.x))return r;p.x=o.x-p.x,p.y=o.y-p.y;var _=9,l=1e-12,M,D;do{if(D=OT(p,t),isNaN(D.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}M={x:o.x-(D.x+p.x),y:o.y-(D.y+p.y)},p.x+=M.x,p.y+=M.y}while(_--&&Math.abs(M.x)>l&&Math.abs(M.y)>l);if(_<0)return console.log("Inverse grid shift iterator failed to converge."),r;r.x=Ci(p.x+t.ll[0]),r.y=p.y+t.ll[1]}else isNaN(p.x)||(r.x=i.x+p.x,r.y=i.y+p.y);return r}function OT(i,e){var t={x:i.x/e.del[0],y:i.y/e.del[1]},r={x:Math.floor(t.x),y:Math.floor(t.y)},o={x:t.x-1*r.x,y:t.y-1*r.y},p={x:Number.NaN,y:Number.NaN},_;if(r.x<0||r.x>=e.lim[0]||r.y<0||r.y>=e.lim[1])return p;_=r.y*e.lim[0]+r.x;var l={x:e.cvs[_][0],y:e.cvs[_][1]};_++;var M={x:e.cvs[_][0],y:e.cvs[_][1]};_+=e.lim[0];var D={x:e.cvs[_][0],y:e.cvs[_][1]};_--;var B={x:e.cvs[_][0],y:e.cvs[_][1]},j=o.x*o.y,$=o.x*(1-o.y),se=(1-o.x)*(1-o.y),de=(1-o.x)*o.y;return p.x=se*l.x+$*M.x+de*B.x+j*D.x,p.y=se*l.y+$*M.y+de*B.y+j*D.y,p}function FT(i,e,t){var r=t.x,o=t.y,p=t.z||0,_,l,M,D={};for(M=0;M<3;M++)if(!(e&&M===2&&t.z===void 0))switch(M===0?(_=r,"ew".indexOf(i.axis[M])!==-1?l="x":l="y"):M===1?(_=o,"ns".indexOf(i.axis[M])!==-1?l="y":l="x"):(_=p,l="z"),i.axis[M]){case"e":D[l]=_;break;case"w":D[l]=-_;break;case"n":D[l]=_;break;case"s":D[l]=-_;break;case"u":t[l]!==void 0&&(D.z=_);break;case"d":t[l]!==void 0&&(D.z=-_);break;default:return null}return D}function bE(i){var e={x:i[0],y:i[1]};return i.length>2&&(e.z=i[2]),i.length>3&&(e.m=i[3]),e}function vk(i){NT(i.x),NT(i.y)}function NT(i){if(typeof Number.isFinite=="function"){if(Number.isFinite(i))return;throw new TypeError("coordinates must be finite numbers")}if(typeof i!="number"||i!==i||!isFinite(i))throw new TypeError("coordinates must be finite numbers")}function xk(i,e){return(i.datum.datum_type===A_||i.datum.datum_type===w_||i.datum.datum_type===Wy)&&e.datumCode!=="WGS84"||(e.datum.datum_type===A_||e.datum.datum_type===w_||e.datum.datum_type===Wy)&&i.datumCode!=="WGS84"}function Wv(i,e,t,r){var o;Array.isArray(t)?t=bE(t):t={x:t.x,y:t.y,z:t.z,m:t.m};var p=t.z!==void 0;if(vk(t),i.datum&&e.datum&&xk(i,e)&&(o=new of("WGS84"),t=Wv(i,o,t,r),i=o),r&&i.axis!=="enu"&&(t=FT(i,!1,t)),i.projName==="longlat")t={x:t.x*ya,y:t.y*ya,z:t.z||0};else if(i.to_meter&&(t={x:t.x*i.to_meter,y:t.y*i.to_meter,z:t.z||0}),t=i.inverse(t),!t)return;if(i.from_greenwich&&(t.x+=i.from_greenwich),t=_k(i.datum,e.datum,t),!!t)return t=t,e.from_greenwich&&(t={x:t.x-e.from_greenwich,y:t.y,z:t.z||0}),e.projName==="longlat"?t={x:t.x*lu,y:t.y*lu,z:t.z||0}:(t=e.forward(t),e.to_meter&&(t={x:t.x/e.to_meter,y:t.y/e.to_meter,z:t.z||0})),r&&e.axis!=="enu"?FT(e,!0,t):(t&&!p&&delete t.z,t)}var BT=of("WGS84");function Tb(i,e,t,r){var o,p,_;return Array.isArray(t)?(o=Wv(i,e,t,r)||{x:NaN,y:NaN},t.length>2?typeof i.name<"u"&&i.name==="geocent"||typeof e.name<"u"&&e.name==="geocent"?typeof o.z=="number"?[o.x,o.y,o.z].concat(t.slice(3)):[o.x,o.y,t[2]].concat(t.slice(3)):[o.x,o.y].concat(t.slice(2)):[o.x,o.y]):(p=Wv(i,e,t,r),_=Object.keys(t),_.length===2||_.forEach(function(l){if(typeof i.name<"u"&&i.name==="geocent"||typeof e.name<"u"&&e.name==="geocent"){if(l==="x"||l==="y"||l==="z")return}else if(l==="x"||l==="y")return;p[l]=t[l]}),p)}function tv(i){return i instanceof of?i:typeof i=="object"&&"oProj"in i?i.oProj:of(i)}function bk(i,e,t){var r,o,p=!1,_;return typeof e>"u"?(o=tv(i),r=BT,p=!0):(typeof e.x<"u"||Array.isArray(e))&&(t=e,o=tv(i),r=BT,p=!0),r||(r=tv(i)),o||(o=tv(e)),t?Tb(r,o,t):(_={forward:function(l,M){return Tb(r,o,l,M)},inverse:function(l,M){return Tb(o,r,l,M)}},p&&(_.oProj=o),_)}var zT=6,AE="AJSAJS",wE="AFAFAF",Fy=65,au=73,af=79,L2=86,U2=90;const Ak={forward:TE,inverse:wk,toPoint:SE};function TE(i,e){return e=e||5,Ek(Tk({lat:i[1],lon:i[0]}),e)}function wk(i){var e=pw(ME(i.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat,e.lon,e.lat]:[e.left,e.bottom,e.right,e.top]}function SE(i){var e=pw(ME(i.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat]:[(e.left+e.right)/2,(e.top+e.bottom)/2]}function Sb(i){return i*(Math.PI/180)}function LT(i){return 180*(i/Math.PI)}function Tk(i){var e=i.lat,t=i.lon,r=6378137,o=.00669438,p=.9996,_,l,M,D,B,j,$,se=Sb(e),de=Sb(t),Ae,he;he=Math.floor((t+180)/6)+1,t===180&&(he=60),e>=56&&e<64&&t>=3&&t<12&&(he=32),e>=72&&e<84&&(t>=0&&t<9?he=31:t>=9&&t<21?he=33:t>=21&&t<33?he=35:t>=33&&t<42&&(he=37)),_=(he-1)*6-180+3,Ae=Sb(_),l=o/(1-o),M=r/Math.sqrt(1-o*Math.sin(se)*Math.sin(se)),D=Math.tan(se)*Math.tan(se),B=l*Math.cos(se)*Math.cos(se),j=Math.cos(se)*(de-Ae),$=r*((1-o/4-3*o*o/64-5*o*o*o/256)*se-(3*o/8+3*o*o/32+45*o*o*o/1024)*Math.sin(2*se)+(15*o*o/256+45*o*o*o/1024)*Math.sin(4*se)-35*o*o*o/3072*Math.sin(6*se));var Le=p*M*(j+(1-D+B)*j*j*j/6+(5-18*D+D*D+72*B-58*l)*j*j*j*j*j/120)+5e5,$e=p*($+M*Math.tan(se)*(j*j/2+(5-D+9*B+4*B*B)*j*j*j*j/24+(61-58*D+D*D+600*B-330*l)*j*j*j*j*j*j/720));return e<0&&($e+=1e7),{northing:Math.round($e),easting:Math.round(Le),zoneNumber:he,zoneLetter:Sk(e)}}function pw(i){var e=i.northing,t=i.easting,r=i.zoneLetter,o=i.zoneNumber;if(o<0||o>60)return null;var p=.9996,_=6378137,l=.00669438,M,D=(1-Math.sqrt(1-l))/(1+Math.sqrt(1-l)),B,j,$,se,de,Ae,he,Le,$e,Be=t-5e5,Je=e;r<"N"&&(Je-=1e7),he=(o-1)*6-180+3,M=l/(1-l),Ae=Je/p,Le=Ae/(_*(1-l/4-3*l*l/64-5*l*l*l/256)),$e=Le+(3*D/2-27*D*D*D/32)*Math.sin(2*Le)+(21*D*D/16-55*D*D*D*D/32)*Math.sin(4*Le)+151*D*D*D/96*Math.sin(6*Le),B=_/Math.sqrt(1-l*Math.sin($e)*Math.sin($e)),j=Math.tan($e)*Math.tan($e),$=M*Math.cos($e)*Math.cos($e),se=_*(1-l)/Math.pow(1-l*Math.sin($e)*Math.sin($e),1.5),de=Be/(B*p);var Rt=$e-B*Math.tan($e)/se*(de*de/2-(5+3*j+10*$-4*$*$-9*M)*de*de*de*de/24+(61+90*j+298*$+45*j*j-252*M-3*$*$)*de*de*de*de*de*de/720);Rt=LT(Rt);var Et=(de-(1+2*j+$)*de*de*de/6+(5-2*$+28*j-3*$*$+8*M+24*j*j)*de*de*de*de*de/120)/Math.cos($e);Et=he+LT(Et);var kt;if(i.accuracy){var Ht=pw({northing:i.northing+i.accuracy,easting:i.easting+i.accuracy,zoneLetter:i.zoneLetter,zoneNumber:i.zoneNumber});kt={top:Ht.lat,right:Ht.lon,bottom:Rt,left:Et}}else kt={lat:Rt,lon:Et};return kt}function Sk(i){var e="Z";return 84>=i&&i>=72?e="X":72>i&&i>=64?e="W":64>i&&i>=56?e="V":56>i&&i>=48?e="U":48>i&&i>=40?e="T":40>i&&i>=32?e="S":32>i&&i>=24?e="R":24>i&&i>=16?e="Q":16>i&&i>=8?e="P":8>i&&i>=0?e="N":0>i&&i>=-8?e="M":-8>i&&i>=-16?e="L":-16>i&&i>=-24?e="K":-24>i&&i>=-32?e="J":-32>i&&i>=-40?e="H":-40>i&&i>=-48?e="G":-48>i&&i>=-56?e="F":-56>i&&i>=-64?e="E":-64>i&&i>=-72?e="D":-72>i&&i>=-80&&(e="C"),e}function Ek(i,e){var t="00000"+i.easting,r="00000"+i.northing;return i.zoneNumber+i.zoneLetter+Mk(i.easting,i.northing,i.zoneNumber)+t.substr(t.length-5,e)+r.substr(r.length-5,e)}function Mk(i,e,t){var r=EE(t),o=Math.floor(i/1e5),p=Math.floor(e/1e5)%20;return Rk(o,p,r)}function EE(i){var e=i%zT;return e===0&&(e=zT),e}function Rk(i,e,t){var r=t-1,o=AE.charCodeAt(r),p=wE.charCodeAt(r),_=o+i-1,l=p+e,M=!1;_>U2&&(_=_-U2+Fy-1,M=!0),(_===au||o<au&&_>au||(_>au||o<au)&&M)&&_++,(_===af||o<af&&_>af||(_>af||o<af)&&M)&&(_++,_===au&&_++),_>U2&&(_=_-U2+Fy-1),l>L2?(l=l-L2+Fy-1,M=!0):M=!1,(l===au||p<au&&l>au||(l>au||p<au)&&M)&&l++,(l===af||p<af&&l>af||(l>af||p<af)&&M)&&(l++,l===au&&l++),l>L2&&(l=l-L2+Fy-1);var D=String.fromCharCode(_)+String.fromCharCode(l);return D}function ME(i){if(i&&i.length===0)throw"MGRSPoint coverting from nothing";for(var e=i.length,t=null,r="",o,p=0;!/[A-Z]/.test(o=i.charAt(p));){if(p>=2)throw"MGRSPoint bad conversion from: "+i;r+=o,p++}var _=parseInt(r,10);if(p===0||p+3>e)throw"MGRSPoint bad conversion from: "+i;var l=i.charAt(p++);if(l<="A"||l==="B"||l==="Y"||l>="Z"||l==="I"||l==="O")throw"MGRSPoint zone letter "+l+" not handled: "+i;t=i.substring(p,p+=2);for(var M=EE(_),D=Ck(t.charAt(0),M),B=Pk(t.charAt(1),M);B<Ik(l);)B+=2e6;var j=e-p;if(j%2!==0)throw`MGRSPoint has to have an even number 
of digits after the zone letter and two 100km letters - front 
half for easting meters, second half for 
northing meters`+i;var $=j/2,se=0,de=0,Ae,he,Le,$e,Be;return $>0&&(Ae=1e5/Math.pow(10,$),he=i.substring(p,p+$),se=parseFloat(he)*Ae,Le=i.substring(p+$),de=parseFloat(Le)*Ae),$e=se+D,Be=de+B,{easting:$e,northing:Be,zoneLetter:l,zoneNumber:_,accuracy:Ae}}function Ck(i,e){for(var t=AE.charCodeAt(e-1),r=1e5,o=!1;t!==i.charCodeAt(0);){if(t++,t===au&&t++,t===af&&t++,t>U2){if(o)throw"Bad character: "+i;t=Fy,o=!0}r+=1e5}return r}function Pk(i,e){if(i>"V")throw"MGRSPoint given invalid Northing "+i;for(var t=wE.charCodeAt(e-1),r=0,o=!1;t!==i.charCodeAt(0);){if(t++,t===au&&t++,t===af&&t++,t>L2){if(o)throw"Bad character: "+i;t=Fy,o=!0}r+=1e5}return r}function Ik(i){var e;switch(i){case"C":e=11e5;break;case"D":e=2e6;break;case"E":e=28e5;break;case"F":e=37e5;break;case"G":e=46e5;break;case"H":e=55e5;break;case"J":e=64e5;break;case"K":e=73e5;break;case"L":e=82e5;break;case"M":e=91e5;break;case"N":e=0;break;case"P":e=8e5;break;case"Q":e=17e5;break;case"R":e=26e5;break;case"S":e=35e5;break;case"T":e=44e5;break;case"U":e=53e5;break;case"V":e=62e5;break;case"W":e=7e6;break;case"X":e=79e5;break;default:e=-1}if(e>=0)return e;throw"Invalid zone letter: "+i}function qy(i,e,t){if(!(this instanceof qy))return new qy(i,e,t);if(Array.isArray(i))this.x=i[0],this.y=i[1],this.z=i[2]||0;else if(typeof i=="object")this.x=i.x,this.y=i.y,this.z=i.z||0;else if(typeof i=="string"&&typeof e>"u"){var r=i.split(",");this.x=parseFloat(r[0]),this.y=parseFloat(r[1]),this.z=parseFloat(r[2])||0}else this.x=i,this.y=e,this.z=t||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}qy.fromMGRS=function(i){return new qy(SE(i))};qy.prototype.toMGRS=function(i){return TE([this.x,this.y],i)};var kk=1,Dk=.25,UT=.046875,VT=.01953125,jT=.01068115234375,Ok=.75,Fk=.46875,Nk=.013020833333333334,Bk=.007120768229166667,zk=.3645833333333333,Lk=.005696614583333333,Uk=.3076171875;function gw(i){var e=[];e[0]=kk-i*(Dk+i*(UT+i*(VT+i*jT))),e[1]=i*(Ok-i*(UT+i*(VT+i*jT)));var t=i*i;return e[2]=t*(Fk-i*(Nk+i*Bk)),t*=i,e[3]=t*(zk-i*Lk),e[4]=t*i*Uk,e}function n2(i,e,t,r){return t*=e,e*=e,r[0]*i-t*(r[1]+e*(r[2]+e*(r[3]+e*r[4])))}var Vk=20;function mw(i,e,t){for(var r=1/(1-e),o=i,p=Vk;p;--p){var _=Math.sin(o),l=1-e*_*_;if(l=(n2(o,_,Math.cos(o),t)-i)*(l*Math.sqrt(l))*r,o-=l,Math.abs(l)<wi)return o}return o}function jk(){this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.es&&(this.en=gw(this.es),this.ml0=n2(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))}function Gk(i){var e=i.x,t=i.y,r=Ci(e-this.long0,this.over),o,p,_,l=Math.sin(t),M=Math.cos(t);if(this.es){var B=M*r,j=Math.pow(B,2),$=this.ep2*Math.pow(M,2),se=Math.pow($,2),de=Math.abs(M)>wi?Math.tan(t):0,Ae=Math.pow(de,2),he=Math.pow(Ae,2);o=1-this.es*Math.pow(l,2),B=B/Math.sqrt(o);var Le=n2(t,l,M,this.en);p=this.a*(this.k0*B*(1+j/6*(1-Ae+$+j/20*(5-18*Ae+he+14*$-58*Ae*$+j/42*(61+179*he-he*Ae-479*Ae)))))+this.x0,_=this.a*(this.k0*(Le-this.ml0+l*r*B/2*(1+j/12*(5-Ae+9*$+4*se+j/30*(61+he-58*Ae+270*$-330*Ae*$+j/56*(1385+543*he-he*Ae-3111*Ae))))))+this.y0}else{var D=M*Math.sin(r);if(Math.abs(Math.abs(D)-1)<wi)return 93;if(p=.5*this.a*this.k0*Math.log((1+D)/(1-D))+this.x0,_=M*Math.cos(r)/Math.sqrt(1-Math.pow(D,2)),D=Math.abs(_),D>=1){if(D-1>wi)return 93;_=0}else _=Math.acos(_);t<0&&(_=-_),_=this.a*this.k0*(_-this.lat0)+this.y0}return i.x=p,i.y=_,i}function Wk(i){var e,t,r,o,p=(i.x-this.x0)*(1/this.a),_=(i.y-this.y0)*(1/this.a);if(this.es)if(e=this.ml0+_/this.k0,t=mw(e,this.es,this.en),Math.abs(t)<oi){var j=Math.sin(t),$=Math.cos(t),se=Math.abs($)>wi?Math.tan(t):0,de=this.ep2*Math.pow($,2),Ae=Math.pow(de,2),he=Math.pow(se,2),Le=Math.pow(he,2);e=1-this.es*Math.pow(j,2);var $e=p*Math.sqrt(e)/this.k0,Be=Math.pow($e,2);e=e*se,r=t-e*Be/(1-this.es)*.5*(1-Be/12*(5+3*he-9*de*he+de-4*Ae-Be/30*(61+90*he-252*de*he+45*Le+46*de-Be/56*(1385+3633*he+4095*Le+1574*Le*he)))),o=Ci(this.long0+$e*(1-Be/6*(1+2*he+de-Be/20*(5+28*he+24*Le+8*de*he+6*de-Be/42*(61+662*he+1320*Le+720*Le*he))))/$,this.over)}else r=oi*M1(_),o=0;else{var l=Math.exp(p/this.k0),M=.5*(l-1/l),D=this.lat0+_/this.k0,B=Math.cos(D);e=Math.sqrt((1-Math.pow(B,2))/(1+Math.pow(M,2))),r=Math.asin(e),_<0&&(r=-r),M===0&&B===0?o=0:o=Ci(Math.atan2(M,B)+this.long0,this.over)}return i.x=o,i.y=r,i}var Zk=["Fast_Transverse_Mercator","Fast Transverse Mercator"];const bv={init:jk,forward:Gk,inverse:Wk,names:Zk};function RE(i){var e=Math.exp(i);return e=(e-1/e)/2,e}function ou(i,e){i=Math.abs(i),e=Math.abs(e);var t=Math.max(i,e),r=Math.min(i,e)/(t||1);return t*Math.sqrt(1+Math.pow(r,2))}function Xk(i){var e=1+i,t=e-1;return t===0?i:i*Math.log(e)/t}function Hk(i){var e=Math.abs(i);return e=Xk(e*(1+e/(ou(1,e)+1))),i<0?-e:e}function _w(i,e){for(var t=2*Math.cos(2*e),r=i.length-1,o=i[r],p=0,_;--r>=0;)_=-p+t*o+i[r],p=o,o=_;return e+_*Math.sin(2*e)}function $k(i,e){for(var t=2*Math.cos(e),r=i.length-1,o=i[r],p=0,_;--r>=0;)_=-p+t*o+i[r],p=o,o=_;return Math.sin(e)*_}function qk(i){var e=Math.exp(i);return e=(e+1/e)/2,e}function CE(i,e,t){for(var r=Math.sin(e),o=Math.cos(e),p=RE(t),_=qk(t),l=2*o*_,M=-2*r*p,D=i.length-1,B=i[D],j=0,$=0,se=0,de,Ae;--D>=0;)de=$,Ae=j,$=B,j=se,B=-de+l*$-M*j+i[D],se=-Ae+M*$+l*j;return l=r*_,M=o*p,[l*B-M*se,l*se+M*B]}function Yk(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(bv.init.apply(this),this.forward=bv.forward,this.inverse=bv.inverse),this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var i=this.es/(1+Math.sqrt(1-this.es)),e=i/(2-i),t=e;this.cgb[0]=e*(2+e*(-2/3+e*(-2+e*(116/45+e*(26/45+e*(-2854/675)))))),this.cbg[0]=e*(-2+e*(2/3+e*(4/3+e*(-82/45+e*(32/45+e*(4642/4725)))))),t=t*e,this.cgb[1]=t*(7/3+e*(-8/5+e*(-227/45+e*(2704/315+e*(2323/945))))),this.cbg[1]=t*(5/3+e*(-16/15+e*(-13/9+e*(904/315+e*(-1522/945))))),t=t*e,this.cgb[2]=t*(56/15+e*(-136/35+e*(-1262/105+e*(73814/2835)))),this.cbg[2]=t*(-26/15+e*(34/21+e*(8/5+e*(-12686/2835)))),t=t*e,this.cgb[3]=t*(4279/630+e*(-332/35+e*(-399572/14175))),this.cbg[3]=t*(1237/630+e*(-12/5+e*(-24832/14175))),t=t*e,this.cgb[4]=t*(4174/315+e*(-144838/6237)),this.cbg[4]=t*(-734/315+e*(109598/31185)),t=t*e,this.cgb[5]=t*(601676/22275),this.cbg[5]=t*(444337/155925),t=Math.pow(e,2),this.Qn=this.k0/(1+e)*(1+t*(1/4+t*(1/64+t/256))),this.utg[0]=e*(-.5+e*(2/3+e*(-37/96+e*(1/360+e*(81/512+e*(-96199/604800)))))),this.gtu[0]=e*(.5+e*(-2/3+e*(5/16+e*(41/180+e*(-127/288+e*(7891/37800)))))),this.utg[1]=t*(-1/48+e*(-1/15+e*(437/1440+e*(-46/105+e*(1118711/3870720))))),this.gtu[1]=t*(13/48+e*(-3/5+e*(557/1440+e*(281/630+e*(-1983433/1935360))))),t=t*e,this.utg[2]=t*(-17/480+e*(37/840+e*(209/4480+e*(-5569/90720)))),this.gtu[2]=t*(61/240+e*(-103/140+e*(15061/26880+e*(167603/181440)))),t=t*e,this.utg[3]=t*(-4397/161280+e*(11/504+e*(830251/7257600))),this.gtu[3]=t*(49561/161280+e*(-179/168+e*(6601661/7257600))),t=t*e,this.utg[4]=t*(-4583/161280+e*(108847/3991680)),this.gtu[4]=t*(34729/80640+e*(-3418889/1995840)),t=t*e,this.utg[5]=t*(-20648693/638668800),this.gtu[5]=t*(212378941/319334400);var r=_w(this.cbg,this.lat0);this.Zb=-this.Qn*(r+$k(this.gtu,2*r))}function Jk(i){var e=Ci(i.x-this.long0,this.over),t=i.y;t=_w(this.cbg,t);var r=Math.sin(t),o=Math.cos(t),p=Math.sin(e),_=Math.cos(e);t=Math.atan2(r,_*o),e=Math.atan2(p*o,ou(r,o*_)),e=Hk(Math.tan(e));var l=CE(this.gtu,2*t,2*e);t=t+l[0],e=e+l[1];var M,D;return Math.abs(e)<=2.623395162778?(M=this.a*(this.Qn*e)+this.x0,D=this.a*(this.Qn*t+this.Zb)+this.y0):(M=1/0,D=1/0),i.x=M,i.y=D,i}function Qk(i){var e=(i.x-this.x0)*(1/this.a),t=(i.y-this.y0)*(1/this.a);t=(t-this.Zb)/this.Qn,e=e/this.Qn;var r,o;if(Math.abs(e)<=2.623395162778){var p=CE(this.utg,2*t,2*e);t=t+p[0],e=e+p[1],e=Math.atan(RE(e));var _=Math.sin(t),l=Math.cos(t),M=Math.sin(e),D=Math.cos(e);t=Math.atan2(_*D,ou(M,D*l)),e=Math.atan2(M,D*l),r=Ci(e+this.long0,this.over),o=_w(this.cgb,t)}else r=1/0,o=1/0;return i.x=r,i.y=o,i}var Kk=["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","Gauss Kruger","Gauss_Kruger","tmerc"];const Av={init:Yk,forward:Jk,inverse:Qk,names:Kk};function eD(i,e){if(i===void 0){if(i=Math.floor((Ci(e)+Math.PI)*30/Math.PI)+1,i<0)return 0;if(i>60)return 60}return i}var tD="etmerc";function iD(){var i=eD(this.zone,this.long0);if(i===void 0)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(i)-183)*ya,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,Av.init.apply(this),this.forward=Av.forward,this.inverse=Av.inverse}var nD=["Universal Transverse Mercator System","utm"];const rD={init:iD,names:nD,dependsOn:tD};function yw(i,e){return Math.pow((1-i)/(1+i),e)}var sD=20;function aD(){var i=Math.sin(this.lat0),e=Math.cos(this.lat0);e*=e,this.rc=Math.sqrt(1-this.es)/(1-this.es*i*i),this.C=Math.sqrt(1+this.es*e*e/(1-this.es)),this.phic0=Math.asin(i/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+jr)/(Math.pow(Math.tan(.5*this.lat0+jr),this.C)*yw(this.e*i,this.ratexp))}function oD(i){var e=i.x,t=i.y;return i.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*t+jr),this.C)*yw(this.e*Math.sin(t),this.ratexp))-oi,i.x=this.C*e,i}function lD(i){for(var e=1e-14,t=i.x/this.C,r=i.y,o=Math.pow(Math.tan(.5*r+jr)/this.K,1/this.C),p=sD;p>0&&(r=2*Math.atan(o*yw(this.e*Math.sin(i.y),-.5*this.e))-oi,!(Math.abs(r-i.y)<e));--p)i.y=r;return p?(i.x=t,i.y=r,i):null}const vw={init:aD,forward:oD,inverse:lD};function cD(){vw.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))}function uD(i){var e,t,r,o;return i.x=Ci(i.x-this.long0,this.over),vw.forward.apply(this,[i]),e=Math.sin(i.y),t=Math.cos(i.y),r=Math.cos(i.x),o=this.k0*this.R2/(1+this.sinc0*e+this.cosc0*t*r),i.x=o*t*Math.sin(i.x),i.y=o*(this.cosc0*e-this.sinc0*t*r),i.x=this.a*i.x+this.x0,i.y=this.a*i.y+this.y0,i}function hD(i){var e,t,r,o,p;if(i.x=(i.x-this.x0)/this.a,i.y=(i.y-this.y0)/this.a,i.x/=this.k0,i.y/=this.k0,p=ou(i.x,i.y)){var _=2*Math.atan2(p,this.R2);e=Math.sin(_),t=Math.cos(_),o=Math.asin(t*this.sinc0+i.y*e*this.cosc0/p),r=Math.atan2(i.x*e,p*this.cosc0*t-i.y*this.sinc0*e)}else o=this.phic0,r=0;return i.x=r,i.y=o,vw.inverse.apply(this,[i]),i.x=Ci(i.x+this.long0,this.over),i}var fD=["Stereographic_North_Pole","Oblique_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"];const dD={init:cD,forward:uD,inverse:hD,names:fD};function xw(i,e,t){return e*=t,Math.tan(.5*(oi+i))*Math.pow((1-e)/(1+e),.5*t)}function pD(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=wi&&(this.k0=.5*(1+M1(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=wi&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=wi&&Math.abs(Math.cos(this.lat_ts))>wi&&(this.k0=.5*this.cons*l0(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/Kf(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=l0(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(xw(this.lat0,this.sinlat0,this.e))-oi,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))}function gD(i){var e=i.x,t=i.y,r=Math.sin(t),o=Math.cos(t),p,_,l,M,D,B,j=Ci(e-this.long0,this.over);return Math.abs(Math.abs(e-this.long0)-Math.PI)<=wi&&Math.abs(t+this.lat0)<=wi?(i.x=NaN,i.y=NaN,i):this.sphere?(p=2*this.k0/(1+this.sinlat0*r+this.coslat0*o*Math.cos(j)),i.x=this.a*p*o*Math.sin(j)+this.x0,i.y=this.a*p*(this.coslat0*r-this.sinlat0*o*Math.cos(j))+this.y0,i):(_=2*Math.atan(xw(t,r,this.e))-oi,M=Math.cos(_),l=Math.sin(_),Math.abs(this.coslat0)<=wi?(D=Kf(this.e,t*this.con,this.con*r),B=2*this.a*this.k0*D/this.cons,i.x=this.x0+B*Math.sin(e-this.long0),i.y=this.y0-this.con*B*Math.cos(e-this.long0),i):(Math.abs(this.sinlat0)<wi?(p=2*this.a*this.k0/(1+M*Math.cos(j)),i.y=p*l):(p=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*l+this.cosX0*M*Math.cos(j))),i.y=p*(this.cosX0*l-this.sinX0*M*Math.cos(j))+this.y0),i.x=p*M*Math.sin(j)+this.x0,i))}function mD(i){i.x-=this.x0,i.y-=this.y0;var e,t,r,o,p,_=Math.sqrt(i.x*i.x+i.y*i.y);if(this.sphere){var l=2*Math.atan(_/(2*this.a*this.k0));return e=this.long0,t=this.lat0,_<=wi?(i.x=e,i.y=t,i):(t=Math.asin(Math.cos(l)*this.sinlat0+i.y*Math.sin(l)*this.coslat0/_),Math.abs(this.coslat0)<wi?this.lat0>0?e=Ci(this.long0+Math.atan2(i.x,-1*i.y),this.over):e=Ci(this.long0+Math.atan2(i.x,i.y),this.over):e=Ci(this.long0+Math.atan2(i.x*Math.sin(l),_*this.coslat0*Math.cos(l)-i.y*this.sinlat0*Math.sin(l)),this.over),i.x=e,i.y=t,i)}else if(Math.abs(this.coslat0)<=wi){if(_<=wi)return t=this.lat0,e=this.long0,i.x=e,i.y=t,i;i.x*=this.con,i.y*=this.con,r=_*this.cons/(2*this.a*this.k0),t=this.con*f1(this.e,r),e=this.con*Ci(this.con*this.long0+Math.atan2(i.x,-1*i.y),this.over)}else o=2*Math.atan(_*this.cosX0/(2*this.a*this.k0*this.ms1)),e=this.long0,_<=wi?p=this.X0:(p=Math.asin(Math.cos(o)*this.sinX0+i.y*Math.sin(o)*this.cosX0/_),e=Ci(this.long0+Math.atan2(i.x*Math.sin(o),_*this.cosX0*Math.cos(o)-i.y*this.sinX0*Math.sin(o)),this.over)),t=-1*f1(this.e,Math.tan(.5*(oi+p)));return i.x=e,i.y=t,i}var _D=["stere","Stereographic_South_Pole","Polar_Stereographic_variant_A","Polar_Stereographic_variant_B","Polar_Stereographic"];const yD={init:pD,forward:gD,inverse:mD,names:_D,ssfn_:xw};function vD(){var i=this.lat0;this.lambda0=this.long0;var e=Math.sin(i),t=this.a,r=this.rf,o=1/r,p=2*o-Math.pow(o,2),_=this.e=Math.sqrt(p);this.R=this.k0*t*Math.sqrt(1-p)/(1-p*Math.pow(e,2)),this.alpha=Math.sqrt(1+p/(1-p)*Math.pow(Math.cos(i),4)),this.b0=Math.asin(e/this.alpha);var l=Math.log(Math.tan(Math.PI/4+this.b0/2)),M=Math.log(Math.tan(Math.PI/4+i/2)),D=Math.log((1+_*e)/(1-_*e));this.K=l-this.alpha*M+this.alpha*_/2*D}function xD(i){var e=Math.log(Math.tan(Math.PI/4-i.y/2)),t=this.e/2*Math.log((1+this.e*Math.sin(i.y))/(1-this.e*Math.sin(i.y))),r=-this.alpha*(e+t)+this.K,o=2*(Math.atan(Math.exp(r))-Math.PI/4),p=this.alpha*(i.x-this.lambda0),_=Math.atan(Math.sin(p)/(Math.sin(this.b0)*Math.tan(o)+Math.cos(this.b0)*Math.cos(p))),l=Math.asin(Math.cos(this.b0)*Math.sin(o)-Math.sin(this.b0)*Math.cos(o)*Math.cos(p));return i.y=this.R/2*Math.log((1+Math.sin(l))/(1-Math.sin(l)))+this.y0,i.x=this.R*_+this.x0,i}function bD(i){for(var e=i.x-this.x0,t=i.y-this.y0,r=e/this.R,o=2*(Math.atan(Math.exp(t/this.R))-Math.PI/4),p=Math.asin(Math.cos(this.b0)*Math.sin(o)+Math.sin(this.b0)*Math.cos(o)*Math.cos(r)),_=Math.atan(Math.sin(r)/(Math.cos(this.b0)*Math.cos(r)-Math.sin(this.b0)*Math.tan(o))),l=this.lambda0+_/this.alpha,M=0,D=p,B=-1e3,j=0;Math.abs(D-B)>1e-7;){if(++j>20)return;M=1/this.alpha*(Math.log(Math.tan(Math.PI/4+p/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(D))/2)),B=D,D=2*Math.atan(Math.exp(M))-Math.PI/2}return i.x=l,i.y=D,i}var AD=["somerc"];const wD={init:vD,forward:xD,inverse:bD,names:AD};var Iy=1e-7;function TD(i){var e=["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_variant_A","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"],t=typeof i.projName=="object"?Object.keys(i.projName)[0]:i.projName;return"no_uoff"in i||"no_off"in i||e.indexOf(t)!==-1||e.indexOf(_E(t))!==-1}function SD(){var i,e,t,r,o,p,_,l,M,D,B=0,j,$=0,se=0,de=0,Ae=0,he=0,Le=0;this.no_off=TD(this),this.no_rot="no_rot"in this;var $e=!1;"alpha"in this&&($e=!0);var Be=!1;if("rectified_grid_angle"in this&&(Be=!0),$e&&(Le=this.alpha),Be&&(B=this.rectified_grid_angle),$e||Be)$=this.longc;else if(se=this.long1,Ae=this.lat1,de=this.long2,he=this.lat2,Math.abs(Ae-he)<=Iy||(i=Math.abs(Ae))<=Iy||Math.abs(i-oi)<=Iy||Math.abs(Math.abs(this.lat0)-oi)<=Iy||Math.abs(Math.abs(he)-oi)<=Iy)throw new Error;var Je=1-this.es;e=Math.sqrt(Je),Math.abs(this.lat0)>wi?(l=Math.sin(this.lat0),t=Math.cos(this.lat0),i=1-this.es*l*l,this.B=t*t,this.B=Math.sqrt(1+this.es*this.B*this.B/Je),this.A=this.B*this.k0*e/i,r=this.B*e/(t*Math.sqrt(i)),o=r*r-1,o<=0?o=0:(o=Math.sqrt(o),this.lat0<0&&(o=-o)),this.E=o+=r,this.E*=Math.pow(Kf(this.e,this.lat0,l),this.B)):(this.B=1/e,this.A=this.k0,this.E=r=o=1),$e||Be?($e?(j=Math.asin(Math.sin(Le)/r),Be||(B=Le)):(j=B,Le=Math.asin(r*Math.sin(j))),this.lam0=$-Math.asin(.5*(o-1/o)*Math.tan(j))/this.B):(p=Math.pow(Kf(this.e,Ae,Math.sin(Ae)),this.B),_=Math.pow(Kf(this.e,he,Math.sin(he)),this.B),o=this.E/p,M=(_-p)/(_+p),D=this.E*this.E,D=(D-_*p)/(D+_*p),i=se-de,i<-Math.PI?de-=u1:i>Math.PI&&(de+=u1),this.lam0=Ci(.5*(se+de)-Math.atan(D*Math.tan(.5*this.B*(se-de))/M)/this.B,this.over),j=Math.atan(2*Math.sin(this.B*Ci(se-this.lam0,this.over))/(o-1/o)),B=Le=Math.asin(r*Math.sin(j))),this.singam=Math.sin(j),this.cosgam=Math.cos(j),this.sinrot=Math.sin(B),this.cosrot=Math.cos(B),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(r*r-1)/Math.cos(Le))),this.lat0<0&&(this.u_0=-this.u_0)),o=.5*j,this.v_pole_n=this.ArB*Math.log(Math.tan(jr-o)),this.v_pole_s=this.ArB*Math.log(Math.tan(jr+o))}function ED(i){var e={},t,r,o,p,_,l,M,D;if(i.x=i.x-this.lam0,Math.abs(Math.abs(i.y)-oi)>wi){if(_=this.E/Math.pow(Kf(this.e,i.y,Math.sin(i.y)),this.B),l=1/_,t=.5*(_-l),r=.5*(_+l),p=Math.sin(this.B*i.x),o=(t*this.singam-p*this.cosgam)/r,Math.abs(Math.abs(o)-1)<wi)throw new Error;D=.5*this.ArB*Math.log((1-o)/(1+o)),l=Math.cos(this.B*i.x),Math.abs(l)<Iy?M=this.A*i.x:M=this.ArB*Math.atan2(t*this.cosgam+p*this.singam,l)}else D=i.y>0?this.v_pole_n:this.v_pole_s,M=this.ArB*i.y;return this.no_rot?(e.x=M,e.y=D):(M-=this.u_0,e.x=D*this.cosrot+M*this.sinrot,e.y=M*this.cosrot-D*this.sinrot),e.x=this.a*e.x+this.x0,e.y=this.a*e.y+this.y0,e}function MD(i){var e,t,r,o,p,_,l,M={};if(i.x=(i.x-this.x0)*(1/this.a),i.y=(i.y-this.y0)*(1/this.a),this.no_rot?(t=i.y,e=i.x):(t=i.x*this.cosrot-i.y*this.sinrot,e=i.y*this.cosrot+i.x*this.sinrot+this.u_0),r=Math.exp(-this.BrA*t),o=.5*(r-1/r),p=.5*(r+1/r),_=Math.sin(this.BrA*e),l=(_*this.cosgam+o*this.singam)/p,Math.abs(Math.abs(l)-1)<wi)M.x=0,M.y=l<0?-oi:oi;else{if(M.y=this.E/Math.sqrt((1+l)/(1-l)),M.y=f1(this.e,Math.pow(M.y,1/this.B)),M.y===1/0)throw new Error;M.x=-this.rB*Math.atan2(o*this.cosgam-_*this.singam,Math.cos(this.BrA*e))}return M.x+=this.lam0,M}var RD=["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_variant_A","Hotine_Oblique_Mercator_Variant_B","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"];const CD={init:SD,forward:ED,inverse:MD,names:RD};function PD(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<wi)){var i=this.b/this.a;this.e=Math.sqrt(1-i*i);var e=Math.sin(this.lat1),t=Math.cos(this.lat1),r=l0(this.e,e,t),o=Kf(this.e,this.lat1,e),p=Math.sin(this.lat2),_=Math.cos(this.lat2),l=l0(this.e,p,_),M=Kf(this.e,this.lat2,p),D=Math.abs(Math.abs(this.lat0)-oi)<wi?0:Kf(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>wi?this.ns=Math.log(r/l)/Math.log(o/M):this.ns=e,isNaN(this.ns)&&(this.ns=e),this.f0=r/(this.ns*Math.pow(o,this.ns)),this.rh=this.a*this.f0*Math.pow(D,this.ns),this.title||(this.title="Lambert Conformal Conic")}}function ID(i){var e=i.x,t=i.y;Math.abs(2*Math.abs(t)-Math.PI)<=wi&&(t=M1(t)*(oi-2*wi));var r=Math.abs(Math.abs(t)-oi),o,p;if(r>wi)o=Kf(this.e,t,Math.sin(t)),p=this.a*this.f0*Math.pow(o,this.ns);else{if(r=t*this.ns,r<=0)return null;p=0}var _=this.ns*Ci(e-this.long0,this.over);return i.x=this.k0*(p*Math.sin(_))+this.x0,i.y=this.k0*(this.rh-p*Math.cos(_))+this.y0,i}function kD(i){var e,t,r,o,p,_=(i.x-this.x0)/this.k0,l=this.rh-(i.y-this.y0)/this.k0;this.ns>0?(e=Math.sqrt(_*_+l*l),t=1):(e=-Math.sqrt(_*_+l*l),t=-1);var M=0;if(e!==0&&(M=Math.atan2(t*_,t*l)),e!==0||this.ns>0){if(t=1/this.ns,r=Math.pow(e/(this.a*this.f0),t),o=f1(this.e,r),o===-9999)return null}else o=-oi;return p=Ci(M/this.ns+this.long0,this.over),i.x=p,i.y=o,i}var DD=["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"];const OD={init:PD,forward:ID,inverse:kD,names:DD};function FD(){this.a=6377397155e-3,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.7417649320975901-.308341501185665),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq}function ND(i){var e,t,r,o,p,_,l,M=i.x,D=i.y,B=Ci(M-this.long0,this.over);return e=Math.pow((1+this.e*Math.sin(D))/(1-this.e*Math.sin(D)),this.alfa*this.e/2),t=2*(Math.atan(this.k*Math.pow(Math.tan(D/2+this.s45),this.alfa)/e)-this.s45),r=-B*this.alfa,o=Math.asin(Math.cos(this.ad)*Math.sin(t)+Math.sin(this.ad)*Math.cos(t)*Math.cos(r)),p=Math.asin(Math.cos(t)*Math.sin(r)/Math.cos(o)),_=this.n*p,l=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(o/2+this.s45),this.n),i.y=l*Math.cos(_)/1,i.x=l*Math.sin(_)/1,this.czech||(i.y*=-1,i.x*=-1),i}function BD(i){var e,t,r,o,p,_,l,M,D=i.x;i.x=i.y,i.y=D,this.czech||(i.y*=-1,i.x*=-1),_=Math.sqrt(i.x*i.x+i.y*i.y),p=Math.atan2(i.y,i.x),o=p/Math.sin(this.s0),r=2*(Math.atan(Math.pow(this.ro0/_,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),e=Math.asin(Math.cos(this.ad)*Math.sin(r)-Math.sin(this.ad)*Math.cos(r)*Math.cos(o)),t=Math.asin(Math.cos(r)*Math.sin(o)/Math.cos(e)),i.x=this.long0-t/this.alfa,l=e,M=0;var B=0;do i.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(e/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(l))/(1-this.e*Math.sin(l)),this.e/2))-this.s45),Math.abs(l-i.y)<1e-10&&(M=1),l=i.y,B+=1;while(M===0&&B<15);return B>=15?null:i}var zD=["Krovak","krovak"];const LD={init:FD,forward:ND,inverse:BD,names:zD};function Oc(i,e,t,r,o){return i*o-e*Math.sin(2*o)+t*Math.sin(4*o)-r*Math.sin(6*o)}function R1(i){return 1-.25*i*(1+i/16*(3+1.25*i))}function C1(i){return .375*i*(1+.25*i*(1+.46875*i))}function P1(i){return .05859375*i*i*(1+.75*i)}function I1(i){return i*i*i*(35/3072)}function bw(i,e,t){var r=e*t;return i/Math.sqrt(1-r*r)}function em(i){return Math.abs(i)<oi?i:i-M1(i)*Math.PI}function Zv(i,e,t,r,o){var p,_;p=i/e;for(var l=0;l<15;l++)if(_=(i-(e*p-t*Math.sin(2*p)+r*Math.sin(4*p)-o*Math.sin(6*p)))/(e-2*t*Math.cos(2*p)+4*r*Math.cos(4*p)-6*o*Math.cos(6*p)),p+=_,Math.abs(_)<=1e-10)return p;return NaN}function UD(){this.sphere||(this.e0=R1(this.es),this.e1=C1(this.es),this.e2=P1(this.es),this.e3=I1(this.es),this.ml0=this.a*Oc(this.e0,this.e1,this.e2,this.e3,this.lat0))}function VD(i){var e,t,r=i.x,o=i.y;if(r=Ci(r-this.long0,this.over),this.sphere)e=this.a*Math.asin(Math.cos(o)*Math.sin(r)),t=this.a*(Math.atan2(Math.tan(o),Math.cos(r))-this.lat0);else{var p=Math.sin(o),_=Math.cos(o),l=bw(this.a,this.e,p),M=Math.tan(o)*Math.tan(o),D=r*Math.cos(o),B=D*D,j=this.es*_*_/(1-this.es),$=this.a*Oc(this.e0,this.e1,this.e2,this.e3,o);e=l*D*(1-B*M*(1/6-(8-M+8*j)*B/120)),t=$-this.ml0+l*p/_*B*(.5+(5-M+6*j)*B/24)}return i.x=e+this.x0,i.y=t+this.y0,i}function jD(i){i.x-=this.x0,i.y-=this.y0;var e=i.x/this.a,t=i.y/this.a,r,o;if(this.sphere){var p=t+this.lat0;r=Math.asin(Math.sin(p)*Math.cos(e)),o=Math.atan2(Math.tan(e),Math.cos(p))}else{var _=this.ml0/this.a+t,l=Zv(_,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(l)-oi)<=wi)return i.x=this.long0,i.y=oi,t<0&&(i.y*=-1),i;var M=bw(this.a,this.e,Math.sin(l)),D=M*M*M/this.a/this.a*(1-this.es),B=Math.pow(Math.tan(l),2),j=e*this.a/M,$=j*j;r=l-M*Math.tan(l)/D*j*j*(.5-(1+3*B)*j*j/24),o=j*(1-$*(B/3+(1+3*B)*B*$/15))/Math.cos(l)}return i.x=Ci(o+this.long0,this.over),i.y=em(r),i}var GD=["Cassini","Cassini_Soldner","cass"];const WD={init:UD,forward:VD,inverse:jD,names:GD};function Xg(i,e){var t;return i>1e-7?(t=i*e,(1-i*i)*(e/(1-t*t)-.5/i*Math.log((1-t)/(1+t)))):2*e}var dA=1,pA=2,gA=3,wv=4;function ZD(){var i=Math.abs(this.lat0);if(Math.abs(i-oi)<wi?this.mode=this.lat0<0?dA:pA:Math.abs(i)<wi?this.mode=gA:this.mode=wv,this.es>0){var e;switch(this.qp=Xg(this.e,1),this.mmf=.5/(1-this.es),this.apa=eO(this.es),this.mode){case pA:this.dd=1;break;case dA:this.dd=1;break;case gA:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case wv:this.rq=Math.sqrt(.5*this.qp),e=Math.sin(this.lat0),this.sinb1=Xg(this.e,e)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*e*e)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd;break}}else this.mode===wv&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))}function XD(i){var e,t,r,o,p,_,l,M,D,B,j=i.x,$=i.y;if(j=Ci(j-this.long0,this.over),this.sphere){if(p=Math.sin($),B=Math.cos($),r=Math.cos(j),this.mode===this.OBLIQ||this.mode===this.EQUIT){if(t=this.mode===this.EQUIT?1+B*r:1+this.sinph0*p+this.cosph0*B*r,t<=wi)return null;t=Math.sqrt(2/t),e=t*B*Math.sin(j),t*=this.mode===this.EQUIT?p:this.cosph0*p-this.sinph0*B*r}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(r=-r),Math.abs($+this.lat0)<wi)return null;t=jr-$*.5,t=2*(this.mode===this.S_POLE?Math.cos(t):Math.sin(t)),e=t*Math.sin(j),t*=r}}else{switch(l=0,M=0,D=0,r=Math.cos(j),o=Math.sin(j),p=Math.sin($),_=Xg(this.e,p),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(l=_/this.qp,M=Math.sqrt(1-l*l)),this.mode){case this.OBLIQ:D=1+this.sinb1*l+this.cosb1*M*r;break;case this.EQUIT:D=1+M*r;break;case this.N_POLE:D=oi+$,_=this.qp-_;break;case this.S_POLE:D=$-oi,_=this.qp+_;break}if(Math.abs(D)<wi)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:D=Math.sqrt(2/D),this.mode===this.OBLIQ?t=this.ymf*D*(this.cosb1*l-this.sinb1*M*r):t=(D=Math.sqrt(2/(1+M*r)))*l*this.ymf,e=this.xmf*D*M*o;break;case this.N_POLE:case this.S_POLE:_>=0?(e=(D=Math.sqrt(_))*o,t=r*(this.mode===this.S_POLE?D:-D)):e=t=0;break}}return i.x=this.a*e+this.x0,i.y=this.a*t+this.y0,i}function HD(i){i.x-=this.x0,i.y-=this.y0;var e=i.x/this.a,t=i.y/this.a,r,o,p,_,l,M,D;if(this.sphere){var B=0,j,$=0;if(j=Math.sqrt(e*e+t*t),o=j*.5,o>1)return null;switch(o=2*Math.asin(o),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&($=Math.sin(o),B=Math.cos(o)),this.mode){case this.EQUIT:o=Math.abs(j)<=wi?0:Math.asin(t*$/j),e*=$,t=B*j;break;case this.OBLIQ:o=Math.abs(j)<=wi?this.lat0:Math.asin(B*this.sinph0+t*$*this.cosph0/j),e*=$*this.cosph0,t=(B-Math.sin(o)*this.sinph0)*j;break;case this.N_POLE:t=-t,o=oi-o;break;case this.S_POLE:o-=oi;break}r=t===0&&(this.mode===this.EQUIT||this.mode===this.OBLIQ)?0:Math.atan2(e,t)}else{if(D=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(e/=this.dd,t*=this.dd,M=Math.sqrt(e*e+t*t),M<wi)return i.x=this.long0,i.y=this.lat0,i;_=2*Math.asin(.5*M/this.rq),p=Math.cos(_),e*=_=Math.sin(_),this.mode===this.OBLIQ?(D=p*this.sinb1+t*_*this.cosb1/M,l=this.qp*D,t=M*this.cosb1*p-t*this.sinb1*_):(D=t*_/M,l=this.qp*D,t=M*p)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(t=-t),l=e*e+t*t,!l)return i.x=this.long0,i.y=this.lat0,i;D=1-l/this.qp,this.mode===this.S_POLE&&(D=-D)}r=Math.atan2(e,t),o=tO(Math.asin(D),this.apa)}return i.x=Ci(this.long0+r,this.over),i.y=o,i}var $D=.3333333333333333,qD=.17222222222222222,YD=.10257936507936508,JD=.06388888888888888,QD=.0664021164021164,KD=.016415012942191543;function eO(i){var e,t=[];return t[0]=i*$D,e=i*i,t[0]+=e*qD,t[1]=e*JD,e*=i,t[0]+=e*YD,t[1]+=e*QD,t[2]=e*KD,t}function tO(i,e){var t=i+i;return i+e[0]*Math.sin(t)+e[1]*Math.sin(t+t)+e[2]*Math.sin(t+t+t)}var iO=["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"];const nO={init:ZD,forward:XD,inverse:HD,names:iO,S_POLE:dA,N_POLE:pA,EQUIT:gA,OBLIQ:wv};function Yg(i){return Math.abs(i)>1&&(i=i>1?1:-1),Math.asin(i)}function rO(){Math.abs(this.lat1+this.lat2)<wi||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=l0(this.e3,this.sin_po,this.cos_po),this.qs1=Xg(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=l0(this.e3,this.sin_po,this.cos_po),this.qs2=Xg(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=Xg(this.e3,this.sin_po),Math.abs(this.lat1-this.lat2)>wi?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)}function sO(i){var e=i.x,t=i.y;this.sin_phi=Math.sin(t),this.cos_phi=Math.cos(t);var r=Xg(this.e3,this.sin_phi),o=this.a*Math.sqrt(this.c-this.ns0*r)/this.ns0,p=this.ns0*Ci(e-this.long0,this.over),_=o*Math.sin(p)+this.x0,l=this.rh-o*Math.cos(p)+this.y0;return i.x=_,i.y=l,i}function aO(i){var e,t,r,o,p,_;return i.x-=this.x0,i.y=this.rh-i.y+this.y0,this.ns0>=0?(e=Math.sqrt(i.x*i.x+i.y*i.y),r=1):(e=-Math.sqrt(i.x*i.x+i.y*i.y),r=-1),o=0,e!==0&&(o=Math.atan2(r*i.x,r*i.y)),r=e*this.ns0/this.a,this.sphere?_=Math.asin((this.c-r*r)/(2*this.ns0)):(t=(this.c-r*r)/this.ns0,_=this.phi1z(this.e3,t)),p=Ci(o/this.ns0+this.long0,this.over),i.x=p,i.y=_,i}function oO(i,e){var t,r,o,p,_,l=Yg(.5*e);if(i<wi)return l;for(var M=i*i,D=1;D<=25;D++)if(t=Math.sin(l),r=Math.cos(l),o=i*t,p=1-o*o,_=.5*p*p/r*(e/(1-M)-t/p+.5/i*Math.log((1-o)/(1+o))),l=l+_,Math.abs(_)<=1e-7)return l;return null}var lO=["Albers_Conic_Equal_Area","Albers_Equal_Area","Albers","aea"];const cO={init:rO,forward:sO,inverse:aO,names:lO,phi1z:oO};function uO(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1}function hO(i){var e,t,r,o,p,_,l,M,D=i.x,B=i.y;return r=Ci(D-this.long0,this.over),e=Math.sin(B),t=Math.cos(B),o=Math.cos(r),_=this.sin_p14*e+this.cos_p14*t*o,p=1,_>0||Math.abs(_)<=wi?(l=this.x0+this.a*p*t*Math.sin(r)/_,M=this.y0+this.a*p*(this.cos_p14*e-this.sin_p14*t*o)/_):(l=this.x0+this.infinity_dist*t*Math.sin(r),M=this.y0+this.infinity_dist*(this.cos_p14*e-this.sin_p14*t*o)),i.x=l,i.y=M,i}function fO(i){var e,t,r,o,p,_;return i.x=(i.x-this.x0)/this.a,i.y=(i.y-this.y0)/this.a,i.x/=this.k0,i.y/=this.k0,(e=Math.sqrt(i.x*i.x+i.y*i.y))?(o=Math.atan2(e,this.rc),t=Math.sin(o),r=Math.cos(o),_=Yg(r*this.sin_p14+i.y*t*this.cos_p14/e),p=Math.atan2(i.x*t,e*this.cos_p14*r-i.y*this.sin_p14*t),p=Ci(this.long0+p,this.over)):(_=this.phic0,p=0),i.x=p,i.y=_,i}var dO=["gnom"];const pO={init:uO,forward:hO,inverse:fO,names:dO};function gO(i,e){var t=1-(1-i*i)/(2*i)*Math.log((1-i)/(1+i));if(Math.abs(Math.abs(e)-t)<1e-6)return e<0?-1*oi:oi;for(var r=Math.asin(.5*e),o,p,_,l,M=0;M<30;M++)if(p=Math.sin(r),_=Math.cos(r),l=i*p,o=Math.pow(1-l*l,2)/(2*_)*(e/(1-i*i)-p/(1-l*l)+.5/i*Math.log((1-l)/(1+l))),r+=o,Math.abs(o)<=1e-10)return r;return NaN}function mO(){this.sphere||(this.k0=l0(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))}function _O(i){var e=i.x,t=i.y,r,o,p=Ci(e-this.long0,this.over);if(this.sphere)r=this.x0+this.a*p*Math.cos(this.lat_ts),o=this.y0+this.a*Math.sin(t)/Math.cos(this.lat_ts);else{var _=Xg(this.e,Math.sin(t));r=this.x0+this.a*this.k0*p,o=this.y0+this.a*_*.5/this.k0}return i.x=r,i.y=o,i}function yO(i){i.x-=this.x0,i.y-=this.y0;var e,t;return this.sphere?(e=Ci(this.long0+i.x/this.a/Math.cos(this.lat_ts),this.over),t=Math.asin(i.y/this.a*Math.cos(this.lat_ts))):(t=gO(this.e,2*i.y*this.k0/this.a),e=Ci(this.long0+i.x/(this.a*this.k0),this.over)),i.x=e,i.y=t,i}var vO=["cea"];const xO={init:mO,forward:_O,inverse:yO,names:vO};function bO(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)}function AO(i){var e=i.x,t=i.y,r=Ci(e-this.long0,this.over),o=em(t-this.lat0);return i.x=this.x0+this.a*r*this.rc,i.y=this.y0+this.a*o,i}function wO(i){var e=i.x,t=i.y;return i.x=Ci(this.long0+(e-this.x0)/(this.a*this.rc),this.over),i.y=em(this.lat0+(t-this.y0)/this.a),i}var TO=["Equirectangular","Equidistant_Cylindrical","Equidistant_Cylindrical_Spherical","eqc"];const SO={init:bO,forward:AO,inverse:wO,names:TO};var GT=20;function EO(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=R1(this.es),this.e1=C1(this.es),this.e2=P1(this.es),this.e3=I1(this.es),this.ml0=this.a*Oc(this.e0,this.e1,this.e2,this.e3,this.lat0)}function MO(i){var e=i.x,t=i.y,r,o,p,_=Ci(e-this.long0,this.over);if(p=_*Math.sin(t),this.sphere)Math.abs(t)<=wi?(r=this.a*_,o=-1*this.a*this.lat0):(r=this.a*Math.sin(p)/Math.tan(t),o=this.a*(em(t-this.lat0)+(1-Math.cos(p))/Math.tan(t)));else if(Math.abs(t)<=wi)r=this.a*_,o=-1*this.ml0;else{var l=bw(this.a,this.e,Math.sin(t))/Math.tan(t);r=l*Math.sin(p),o=this.a*Oc(this.e0,this.e1,this.e2,this.e3,t)-this.ml0+l*(1-Math.cos(p))}return i.x=r+this.x0,i.y=o+this.y0,i}function RO(i){var e,t,r,o,p,_,l,M,D;if(r=i.x-this.x0,o=i.y-this.y0,this.sphere)if(Math.abs(o+this.a*this.lat0)<=wi)e=Ci(r/this.a+this.long0,this.over),t=0;else{_=this.lat0+o/this.a,l=r*r/this.a/this.a+_*_,M=_;var B;for(p=GT;p;--p)if(B=Math.tan(M),D=-1*(_*(M*B+1)-M-.5*(M*M+l)*B)/((M-_)/B-1),M+=D,Math.abs(D)<=wi){t=M;break}e=Ci(this.long0+Math.asin(r*Math.tan(M)/this.a)/Math.sin(t),this.over)}else if(Math.abs(o+this.ml0)<=wi)t=0,e=Ci(this.long0+r/this.a,this.over);else{_=(this.ml0+o)/this.a,l=r*r/this.a/this.a+_*_,M=_;var j,$,se,de,Ae;for(p=GT;p;--p)if(Ae=this.e*Math.sin(M),j=Math.sqrt(1-Ae*Ae)*Math.tan(M),$=this.a*Oc(this.e0,this.e1,this.e2,this.e3,M),se=this.e0-2*this.e1*Math.cos(2*M)+4*this.e2*Math.cos(4*M)-6*this.e3*Math.cos(6*M),de=$/this.a,D=(_*(j*de+1)-de-.5*j*(de*de+l))/(this.es*Math.sin(2*M)*(de*de+l-2*_*de)/(4*j)+(_-de)*(j*se-2/Math.sin(2*M))-se),M-=D,Math.abs(D)<=wi){t=M;break}j=Math.sqrt(1-this.es*Math.pow(Math.sin(t),2))*Math.tan(t),e=Ci(this.long0+Math.asin(r*j/this.a)/Math.sin(t),this.over)}return i.x=e,i.y=t,i}var CO=["Polyconic","American_Polyconic","poly"];const PO={init:EO,forward:MO,inverse:RO,names:CO};function IO(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013}function kO(i){var e,t=i.x,r=i.y,o=r-this.lat0,p=t-this.long0,_=o/$2*1e-5,l=p,M=1,D=0;for(e=1;e<=10;e++)M=M*_,D=D+this.A[e]*M;var B=D,j=l,$=1,se=0,de,Ae,he=0,Le=0;for(e=1;e<=6;e++)de=$*B-se*j,Ae=se*B+$*j,$=de,se=Ae,he=he+this.B_re[e]*$-this.B_im[e]*se,Le=Le+this.B_im[e]*$+this.B_re[e]*se;return i.x=Le*this.a+this.x0,i.y=he*this.a+this.y0,i}function DO(i){var e,t=i.x,r=i.y,o=t-this.x0,p=r-this.y0,_=p/this.a,l=o/this.a,M=1,D=0,B,j,$=0,se=0;for(e=1;e<=6;e++)B=M*_-D*l,j=D*_+M*l,M=B,D=j,$=$+this.C_re[e]*M-this.C_im[e]*D,se=se+this.C_im[e]*M+this.C_re[e]*D;for(var de=0;de<this.iterations;de++){var Ae=$,he=se,Le,$e,Be=_,Je=l;for(e=2;e<=6;e++)Le=Ae*$-he*se,$e=he*$+Ae*se,Ae=Le,he=$e,Be=Be+(e-1)*(this.B_re[e]*Ae-this.B_im[e]*he),Je=Je+(e-1)*(this.B_im[e]*Ae+this.B_re[e]*he);Ae=1,he=0;var Rt=this.B_re[1],Et=this.B_im[1];for(e=2;e<=6;e++)Le=Ae*$-he*se,$e=he*$+Ae*se,Ae=Le,he=$e,Rt=Rt+e*(this.B_re[e]*Ae-this.B_im[e]*he),Et=Et+e*(this.B_im[e]*Ae+this.B_re[e]*he);var kt=Rt*Rt+Et*Et;$=(Be*Rt+Je*Et)/kt,se=(Je*Rt-Be*Et)/kt}var Ht=$,Xt=se,hi=1,di=0;for(e=1;e<=9;e++)hi=hi*Ht,di=di+this.D[e]*hi;var Ei=this.lat0+di*$2*1e5,Ii=this.long0+Xt;return i.x=Ii,i.y=Ei,i}var OO=["New_Zealand_Map_Grid","nzmg"];const FO={init:IO,forward:kO,inverse:DO,names:OO};function NO(){}function BO(i){var e=i.x,t=i.y,r=Ci(e-this.long0,this.over),o=this.x0+this.a*r,p=this.y0+this.a*Math.log(Math.tan(Math.PI/4+t/2.5))*1.25;return i.x=o,i.y=p,i}function zO(i){i.x-=this.x0,i.y-=this.y0;var e=Ci(this.long0+i.x/this.a,this.over),t=2.5*(Math.atan(Math.exp(.8*i.y/this.a))-Math.PI/4);return i.x=e,i.y=t,i}var LO=["Miller_Cylindrical","mill"];const UO={init:NO,forward:BO,inverse:zO,names:LO};var VO=20;function jO(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=gw(this.es)}function GO(i){var e,t,r=i.x,o=i.y;if(r=Ci(r-this.long0,this.over),this.sphere){if(!this.m)o=this.n!==1?Math.asin(this.n*Math.sin(o)):o;else for(var p=this.n*Math.sin(o),_=VO;_;--_){var l=(this.m*o+Math.sin(o)-p)/(this.m+Math.cos(o));if(o-=l,Math.abs(l)<wi)break}e=this.a*this.C_x*r*(this.m+Math.cos(o)),t=this.a*this.C_y*o}else{var M=Math.sin(o),D=Math.cos(o);t=this.a*n2(o,M,D,this.en),e=this.a*r*D/Math.sqrt(1-this.es*M*M)}return i.x=e,i.y=t,i}function WO(i){var e,t,r,o;return i.x-=this.x0,r=i.x/this.a,i.y-=this.y0,e=i.y/this.a,this.sphere?(e/=this.C_y,r=r/(this.C_x*(this.m+Math.cos(e))),this.m?e=Yg((this.m*e+Math.sin(e))/this.n):this.n!==1&&(e=Yg(Math.sin(e)/this.n)),r=Ci(r+this.long0,this.over),e=em(e)):(e=mw(i.y/this.a,this.es,this.en),o=Math.abs(e),o<oi?(o=Math.sin(e),t=this.long0+i.x*Math.sqrt(1-this.es*o*o)/(this.a*Math.cos(e)),r=Ci(t,this.over)):o-wi<oi&&(r=this.long0)),i.x=r,i.y=e,i}var ZO=["Sinusoidal","sinu"];const XO={init:jO,forward:GO,inverse:WO,names:ZO};function HO(){this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0}function $O(i){for(var e=i.x,t=i.y,r=Ci(e-this.long0,this.over),o=t,p=Math.PI*Math.sin(t);;){var _=-(o+Math.sin(o)-p)/(1+Math.cos(o));if(o+=_,Math.abs(_)<wi)break}o/=2,Math.PI/2-Math.abs(t)<wi&&(r=0);var l=.900316316158*this.a*r*Math.cos(o)+this.x0,M=1.4142135623731*this.a*Math.sin(o)+this.y0;return i.x=l,i.y=M,i}function qO(i){var e,t;i.x-=this.x0,i.y-=this.y0,t=i.y/(1.4142135623731*this.a),Math.abs(t)>.999999999999&&(t=.999999999999),e=Math.asin(t);var r=Ci(this.long0+i.x/(.900316316158*this.a*Math.cos(e)),this.over);r<-Math.PI&&(r=-Math.PI),r>Math.PI&&(r=Math.PI),t=(2*e+Math.sin(2*e))/Math.PI,Math.abs(t)>1&&(t=1);var o=Math.asin(t);return i.x=r,i.y=o,i}var YO=["Mollweide","moll"];const JO={init:HO,forward:$O,inverse:qO,names:YO};function QO(){Math.abs(this.lat1+this.lat2)<wi||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=R1(this.es),this.e1=C1(this.es),this.e2=P1(this.es),this.e3=I1(this.es),this.sin_phi=Math.sin(this.lat1),this.cos_phi=Math.cos(this.lat1),this.ms1=l0(this.e,this.sin_phi,this.cos_phi),this.ml1=Oc(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<wi?this.ns=this.sin_phi:(this.sin_phi=Math.sin(this.lat2),this.cos_phi=Math.cos(this.lat2),this.ms2=l0(this.e,this.sin_phi,this.cos_phi),this.ml2=Oc(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=Oc(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))}function KO(i){var e=i.x,t=i.y,r;if(this.sphere)r=this.a*(this.g-t);else{var o=Oc(this.e0,this.e1,this.e2,this.e3,t);r=this.a*(this.g-o)}var p=this.ns*Ci(e-this.long0,this.over),_=this.x0+r*Math.sin(p),l=this.y0+this.rh-r*Math.cos(p);return i.x=_,i.y=l,i}function eF(i){i.x-=this.x0,i.y=this.rh-i.y+this.y0;var e,t,r,o;this.ns>=0?(t=Math.sqrt(i.x*i.x+i.y*i.y),e=1):(t=-Math.sqrt(i.x*i.x+i.y*i.y),e=-1);var p=0;if(t!==0&&(p=Math.atan2(e*i.x,e*i.y)),this.sphere)return o=Ci(this.long0+p/this.ns,this.over),r=em(this.g-t/this.a),i.x=o,i.y=r,i;var _=this.g-t/this.a;return r=Zv(_,this.e0,this.e1,this.e2,this.e3),o=Ci(this.long0+p/this.ns,this.over),i.x=o,i.y=r,i}var tF=["Equidistant_Conic","eqdc"];const iF={init:QO,forward:KO,inverse:eF,names:tF};function nF(){this.R=this.a}function rF(i){var e=i.x,t=i.y,r=Ci(e-this.long0,this.over),o,p;Math.abs(t)<=wi&&(o=this.x0+this.R*r,p=this.y0);var _=Yg(2*Math.abs(t/Math.PI));(Math.abs(r)<=wi||Math.abs(Math.abs(t)-oi)<=wi)&&(o=this.x0,t>=0?p=this.y0+Math.PI*this.R*Math.tan(.5*_):p=this.y0+Math.PI*this.R*-Math.tan(.5*_));var l=.5*Math.abs(Math.PI/r-r/Math.PI),M=l*l,D=Math.sin(_),B=Math.cos(_),j=B/(D+B-1),$=j*j,se=j*(2/D-1),de=se*se,Ae=Math.PI*this.R*(l*(j-de)+Math.sqrt(M*(j-de)*(j-de)-(de+M)*($-de)))/(de+M);r<0&&(Ae=-Ae),o=this.x0+Ae;var he=M+j;return Ae=Math.PI*this.R*(se*he-l*Math.sqrt((de+M)*(M+1)-he*he))/(de+M),t>=0?p=this.y0+Ae:p=this.y0-Ae,i.x=o,i.y=p,i}function sF(i){var e,t,r,o,p,_,l,M,D,B,j,$,se;return i.x-=this.x0,i.y-=this.y0,j=Math.PI*this.R,r=i.x/j,o=i.y/j,p=r*r+o*o,_=-Math.abs(o)*(1+p),l=_-2*o*o+r*r,M=-2*_+1+2*o*o+p*p,se=o*o/M+(2*l*l*l/M/M/M-9*_*l/M/M)/27,D=(_-l*l/3/M)/M,B=2*Math.sqrt(-D/3),j=3*se/D/B,Math.abs(j)>1&&(j>=0?j=1:j=-1),$=Math.acos(j)/3,i.y>=0?t=(-B*Math.cos($+Math.PI/3)-l/3/M)*Math.PI:t=-(-B*Math.cos($+Math.PI/3)-l/3/M)*Math.PI,Math.abs(r)<wi?e=this.long0:e=Ci(this.long0+Math.PI*(p-1+Math.sqrt(1+2*(r*r-o*o)+p*p))/2/r,this.over),i.x=e,i.y=t,i}var aF=["Van_der_Grinten_I","VanDerGrinten","Van_der_Grinten","vandg"];const oF={init:nF,forward:rF,inverse:sF,names:aF};function lF(i,e,t,r,o,p){const _=r-e,l=Math.atan((1-p)*Math.tan(i)),M=Math.atan((1-p)*Math.tan(t)),D=Math.sin(l),B=Math.cos(l),j=Math.sin(M),$=Math.cos(M);let se=_,de,Ae=100,he,Le,$e,Be,Je,Rt,Et,kt,Ht,Xt,hi,di,Ei,Ii;do{if(he=Math.sin(se),Le=Math.cos(se),$e=Math.sqrt($*he*($*he)+(B*j-D*$*Le)*(B*j-D*$*Le)),$e===0)return{azi1:0,s12:0};Be=D*j+B*$*Le,Je=Math.atan2($e,Be),Rt=B*$*he/$e,Et=1-Rt*Rt,kt=Et!==0?Be-2*D*j/Et:0,Ht=p/16*Et*(4+p*(4-3*Et)),de=se,se=_+(1-Ht)*p*Rt*(Je+Ht*$e*(kt+Ht*Be*(-1+2*kt*kt)))}while(Math.abs(se-de)>1e-12&&--Ae>0);return Ae===0?{azi1:NaN,s12:NaN}:(Xt=Et*(o*o-o*(1-p)*(o*(1-p)))/(o*(1-p)*(o*(1-p))),hi=1+Xt/16384*(4096+Xt*(-768+Xt*(320-175*Xt))),di=Xt/1024*(256+Xt*(-128+Xt*(74-47*Xt))),Ei=di*$e*(kt+di/4*(Be*(-1+2*kt*kt)-di/6*kt*(-3+4*$e*$e)*(-3+4*kt*kt))),Ii=o*(1-p)*hi*(Je-Ei),{azi1:Math.atan2($*he,B*j-D*$*Le),s12:Ii})}function cF(i,e,t,r,o,p){const _=Math.atan((1-p)*Math.tan(i)),l=Math.sin(_),M=Math.cos(_),D=Math.sin(t),B=Math.cos(t),j=Math.atan2(l,M*B),$=M*D,se=1-$*$,de=se*(o*o-o*(1-p)*(o*(1-p)))/(o*(1-p)*(o*(1-p))),Ae=1+de/16384*(4096+de*(-768+de*(320-175*de))),he=de/1024*(256+de*(-128+de*(74-47*de)));let Le=r/(o*(1-p)*Ae),$e,Be=100,Je,Rt,Et,kt;do Je=Math.cos(2*j+Le),Rt=Math.sin(Le),Et=Math.cos(Le),kt=he*Rt*(Je+he/4*(Et*(-1+2*Je*Je)-he/6*Je*(-3+4*Rt*Rt)*(-3+4*Je*Je))),$e=Le,Le=r/(o*(1-p)*Ae)+kt;while(Math.abs(Le-$e)>1e-12&&--Be>0);if(Be===0)return{lat2:NaN,lon2:NaN};const Ht=l*Rt-M*Et*B,Xt=Math.atan2(l*Et+M*Rt*B,(1-p)*Math.sqrt($*$+Ht*Ht)),hi=Math.atan2(Rt*D,M*Et-l*Rt*B),di=p/16*se*(4+p*(4-3*se)),Ei=hi-(1-di)*p*$*(Le+di*Rt*(Je+di*Et*(-1+2*Je*Je))),Ii=e+Ei;return{lat2:Xt,lon2:Ii}}function uF(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0),this.f=this.es/(1+Math.sqrt(1-this.es))}function hF(i){var e=i.x,t=i.y,r=Math.sin(i.y),o=Math.cos(i.y),p=Ci(e-this.long0,this.over),_,l,M,D,B,j,$,se,de,Ae,he;return this.sphere?Math.abs(this.sin_p12-1)<=wi?(i.x=this.x0+this.a*(oi-t)*Math.sin(p),i.y=this.y0-this.a*(oi-t)*Math.cos(p),i):Math.abs(this.sin_p12+1)<=wi?(i.x=this.x0+this.a*(oi+t)*Math.sin(p),i.y=this.y0+this.a*(oi+t)*Math.cos(p),i):(de=this.sin_p12*r+this.cos_p12*o*Math.cos(p),$=Math.acos(de),se=$?$/Math.sin($):1,i.x=this.x0+this.a*se*o*Math.sin(p),i.y=this.y0+this.a*se*(this.cos_p12*r-this.sin_p12*o*Math.cos(p)),i):(_=R1(this.es),l=C1(this.es),M=P1(this.es),D=I1(this.es),Math.abs(this.sin_p12-1)<=wi?(B=this.a*Oc(_,l,M,D,oi),j=this.a*Oc(_,l,M,D,t),i.x=this.x0+(B-j)*Math.sin(p),i.y=this.y0-(B-j)*Math.cos(p),i):Math.abs(this.sin_p12+1)<=wi?(B=this.a*Oc(_,l,M,D,oi),j=this.a*Oc(_,l,M,D,t),i.x=this.x0+(B+j)*Math.sin(p),i.y=this.y0+(B+j)*Math.cos(p),i):Math.abs(e)<wi&&Math.abs(t-this.lat0)<wi?(i.x=i.y=0,i):(Ae=lF(this.lat0,this.long0,t,e,this.a,this.f),he=Ae.azi1,i.x=Ae.s12*Math.sin(he),i.y=Ae.s12*Math.cos(he),i))}function fF(i){i.x-=this.x0,i.y-=this.y0;var e,t,r,o,p,_,l,M,D,B,j,$,se,de,Ae,he;return this.sphere?(e=Math.sqrt(i.x*i.x+i.y*i.y),e>2*oi*this.a?void 0:(t=e/this.a,r=Math.sin(t),o=Math.cos(t),p=this.long0,Math.abs(e)<=wi?_=this.lat0:(_=Yg(o*this.sin_p12+i.y*r*this.cos_p12/e),l=Math.abs(this.lat0)-oi,Math.abs(l)<=wi?this.lat0>=0?p=Ci(this.long0+Math.atan2(i.x,-i.y),this.over):p=Ci(this.long0-Math.atan2(-i.x,i.y),this.over):p=Ci(this.long0+Math.atan2(i.x*r,e*this.cos_p12*o-i.y*this.sin_p12*r),this.over)),i.x=p,i.y=_,i)):(M=R1(this.es),D=C1(this.es),B=P1(this.es),j=I1(this.es),Math.abs(this.sin_p12-1)<=wi?($=this.a*Oc(M,D,B,j,oi),e=Math.sqrt(i.x*i.x+i.y*i.y),se=$-e,_=Zv(se/this.a,M,D,B,j),p=Ci(this.long0+Math.atan2(i.x,-1*i.y),this.over),i.x=p,i.y=_,i):Math.abs(this.sin_p12+1)<=wi?($=this.a*Oc(M,D,B,j,oi),e=Math.sqrt(i.x*i.x+i.y*i.y),se=e-$,_=Zv(se/this.a,M,D,B,j),p=Ci(this.long0+Math.atan2(i.x,i.y),this.over),i.x=p,i.y=_,i):(de=Math.atan2(i.x,i.y),Ae=Math.sqrt(i.x*i.x+i.y*i.y),he=cF(this.lat0,this.long0,de,Ae,this.a,this.f),i.x=he.lon2,i.y=he.lat2,i))}var dF=["Azimuthal_Equidistant","aeqd"];const pF={init:uF,forward:hF,inverse:fF,names:dF};function gF(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)}function mF(i){var e,t,r,o,p,_,l,M,D=i.x,B=i.y;return r=Ci(D-this.long0,this.over),e=Math.sin(B),t=Math.cos(B),o=Math.cos(r),_=this.sin_p14*e+this.cos_p14*t*o,p=1,(_>0||Math.abs(_)<=wi)&&(l=this.a*p*t*Math.sin(r),M=this.y0+this.a*p*(this.cos_p14*e-this.sin_p14*t*o)),i.x=l,i.y=M,i}function _F(i){var e,t,r,o,p,_,l;return i.x-=this.x0,i.y-=this.y0,e=Math.sqrt(i.x*i.x+i.y*i.y),t=Yg(e/this.a),r=Math.sin(t),o=Math.cos(t),_=this.long0,Math.abs(e)<=wi?(l=this.lat0,i.x=_,i.y=l,i):(l=Yg(o*this.sin_p14+i.y*r*this.cos_p14/e),p=Math.abs(this.lat0)-oi,Math.abs(p)<=wi?(this.lat0>=0?_=Ci(this.long0+Math.atan2(i.x,-i.y),this.over):_=Ci(this.long0-Math.atan2(-i.x,i.y),this.over),i.x=_,i.y=l,i):(_=Ci(this.long0+Math.atan2(i.x*r,e*this.cos_p14*o-i.y*this.sin_p14*r),this.over),i.x=_,i.y=l,i))}var yF=["ortho"];const vF={init:gF,forward:mF,inverse:_F,names:yF};var na={FRONT:1,RIGHT:2,BACK:3,LEFT:4,TOP:5,BOTTOM:6},Gr={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4};function xF(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=oi-jr/2?this.face=na.TOP:this.lat0<=-(oi-jr/2)?this.face=na.BOTTOM:Math.abs(this.long0)<=jr?this.face=na.FRONT:Math.abs(this.long0)<=oi+jr?this.face=this.long0>0?na.RIGHT:na.LEFT:this.face=na.BACK,this.es!==0&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)}function bF(i){var e={x:0,y:0},t,r,o,p,_,l,M={value:0};if(i.x-=this.long0,this.es!==0?t=Math.atan(this.one_minus_f_squared*Math.tan(i.y)):t=i.y,r=i.x,this.face===na.TOP)p=oi-t,r>=jr&&r<=oi+jr?(M.value=Gr.AREA_0,o=r-oi):r>oi+jr||r<=-(oi+jr)?(M.value=Gr.AREA_1,o=r>0?r-Da:r+Da):r>-(oi+jr)&&r<=-jr?(M.value=Gr.AREA_2,o=r+oi):(M.value=Gr.AREA_3,o=r);else if(this.face===na.BOTTOM)p=oi+t,r>=jr&&r<=oi+jr?(M.value=Gr.AREA_0,o=-r+oi):r<jr&&r>=-jr?(M.value=Gr.AREA_1,o=-r):r<-jr&&r>=-(oi+jr)?(M.value=Gr.AREA_2,o=-r-oi):(M.value=Gr.AREA_3,o=r>0?-r+Da:-r-Da);else{var D,B,j,$,se,de,Ae;this.face===na.RIGHT?r=Zy(r,+oi):this.face===na.BACK?r=Zy(r,+Da):this.face===na.LEFT&&(r=Zy(r,-oi)),$=Math.sin(t),se=Math.cos(t),de=Math.sin(r),Ae=Math.cos(r),D=se*Ae,B=se*de,j=$,this.face===na.FRONT?(p=Math.acos(D),o=iv(p,j,B,M)):this.face===na.RIGHT?(p=Math.acos(B),o=iv(p,j,-D,M)):this.face===na.BACK?(p=Math.acos(-D),o=iv(p,j,-B,M)):this.face===na.LEFT?(p=Math.acos(-B),o=iv(p,j,D,M)):(p=o=0,M.value=Gr.AREA_0)}return l=Math.atan(12/Da*(o+Math.acos(Math.sin(o)*Math.cos(jr))-oi)),_=Math.sqrt((1-Math.cos(p))/(Math.cos(l)*Math.cos(l))/(1-Math.cos(Math.atan(1/Math.cos(o))))),M.value===Gr.AREA_1?l+=oi:M.value===Gr.AREA_2?l+=Da:M.value===Gr.AREA_3&&(l+=1.5*Da),e.x=_*Math.cos(l),e.y=_*Math.sin(l),e.x=e.x*this.a+this.x0,e.y=e.y*this.a+this.y0,i.x=e.x,i.y=e.y,i}function AF(i){var e={lam:0,phi:0},t,r,o,p,_,l,M,D,B,j={value:0};if(i.x=(i.x-this.x0)/this.a,i.y=(i.y-this.y0)/this.a,r=Math.atan(Math.sqrt(i.x*i.x+i.y*i.y)),t=Math.atan2(i.y,i.x),i.x>=0&&i.x>=Math.abs(i.y)?j.value=Gr.AREA_0:i.y>=0&&i.y>=Math.abs(i.x)?(j.value=Gr.AREA_1,t-=oi):i.x<0&&-i.x>=Math.abs(i.y)?(j.value=Gr.AREA_2,t=t<0?t+Da:t-Da):(j.value=Gr.AREA_3,t+=oi),B=Da/12*Math.tan(t),_=Math.sin(B)/(Math.cos(B)-1/Math.sqrt(2)),l=Math.atan(_),o=Math.cos(t),p=Math.tan(r),M=1-o*o*p*p*(1-Math.cos(Math.atan(1/Math.cos(l)))),M<-1?M=-1:M>1&&(M=1),this.face===na.TOP)D=Math.acos(M),e.phi=oi-D,j.value===Gr.AREA_0?e.lam=l+oi:j.value===Gr.AREA_1?e.lam=l<0?l+Da:l-Da:j.value===Gr.AREA_2?e.lam=l-oi:e.lam=l;else if(this.face===na.BOTTOM)D=Math.acos(M),e.phi=D-oi,j.value===Gr.AREA_0?e.lam=-l+oi:j.value===Gr.AREA_1?e.lam=-l:j.value===Gr.AREA_2?e.lam=-l-oi:e.lam=l<0?-l-Da:-l+Da;else{var $,se,de;$=M,B=$*$,B>=1?de=0:de=Math.sqrt(1-B)*Math.sin(l),B+=de*de,B>=1?se=0:se=Math.sqrt(1-B),j.value===Gr.AREA_1?(B=se,se=-de,de=B):j.value===Gr.AREA_2?(se=-se,de=-de):j.value===Gr.AREA_3&&(B=se,se=de,de=-B),this.face===na.RIGHT?(B=$,$=-se,se=B):this.face===na.BACK?($=-$,se=-se):this.face===na.LEFT&&(B=$,$=se,se=-B),e.phi=Math.acos(-de)-oi,e.lam=Math.atan2(se,$),this.face===na.RIGHT?e.lam=Zy(e.lam,-oi):this.face===na.BACK?e.lam=Zy(e.lam,-Da):this.face===na.LEFT&&(e.lam=Zy(e.lam,+oi))}if(this.es!==0){var Ae,he,Le;Ae=e.phi<0?1:0,he=Math.tan(e.phi),Le=this.b/Math.sqrt(he*he+this.one_minus_f_squared),e.phi=Math.atan(Math.sqrt(this.a*this.a-Le*Le)/(this.one_minus_f*Le)),Ae&&(e.phi=-e.phi)}return e.lam+=this.long0,i.x=e.lam,i.y=e.phi,i}function iv(i,e,t,r){var o;return i<wi?(r.value=Gr.AREA_0,o=0):(o=Math.atan2(e,t),Math.abs(o)<=jr?r.value=Gr.AREA_0:o>jr&&o<=oi+jr?(r.value=Gr.AREA_1,o-=oi):o>oi+jr||o<=-(oi+jr)?(r.value=Gr.AREA_2,o=o>=0?o-Da:o+Da):(r.value=Gr.AREA_3,o+=oi)),o}function Zy(i,e){var t=i+e;return t<-Da?t+=u1:t>+Da&&(t-=u1),t}var wF=["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"];const TF={init:xF,forward:bF,inverse:AF,names:wF};var mA=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-986701e-12],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,18736e-12],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,934959e-12],[.7986,-.00755338,-500009e-10,935324e-12],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],V2=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-126793e-14,422642e-15],[.124,.0124,507171e-14,-160604e-14],[.186,.0123999,-190189e-13,600152e-14],[.248,.0124002,710039e-13,-224e-10],[.31,.0123992,-264997e-12,835986e-13],[.372,.0124029,988983e-12,-311994e-12],[.434,.0123893,-369093e-11,-435621e-12],[.4958,.0123198,-102252e-10,-345523e-12],[.5571,.0121916,-154081e-10,-582288e-12],[.6176,.0119938,-241424e-10,-525327e-12],[.6769,.011713,-320223e-10,-516405e-12],[.7346,.0113541,-397684e-10,-609052e-12],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-140374e-14],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],PE=.8487,IE=1.3523,kE=lu/5,SF=1/kE,Ny=18,Xv=function(i,e){return i[0]+e*(i[1]+e*(i[2]+e*i[3]))},EF=function(i,e){return i[1]+e*(2*i[2]+e*3*i[3])};function MF(i,e,t,r){for(var o=e;r;--r){var p=i(o);if(o-=p,Math.abs(p)<t)break}return o}function RF(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"}function CF(i){var e=Ci(i.x-this.long0,this.over),t=Math.abs(i.y),r=Math.floor(t*kE);r<0?r=0:r>=Ny&&(r=Ny-1),t=lu*(t-SF*r);var o={x:Xv(mA[r],t)*e,y:Xv(V2[r],t)};return i.y<0&&(o.y=-o.y),o.x=o.x*this.a*PE+this.x0,o.y=o.y*this.a*IE+this.y0,o}function PF(i){var e={x:(i.x-this.x0)/(this.a*PE),y:Math.abs(i.y-this.y0)/(this.a*IE)};if(e.y>=1)e.x/=mA[Ny][0],e.y=i.y<0?-oi:oi;else{var t=Math.floor(e.y*Ny);for(t<0?t=0:t>=Ny&&(t=Ny-1);;)if(V2[t][0]>e.y)--t;else if(V2[t+1][0]<=e.y)++t;else break;var r=V2[t],o=5*(e.y-r[0])/(V2[t+1][0]-r[0]);o=MF(function(p){return(Xv(r,p)-e.y)/EF(r,p)},o,wi,100),e.x/=Xv(mA[t],o),e.y=(5*t+o)*ya,i.y<0&&(e.y=-e.y)}return e.x=Ci(e.x+this.long0,this.over),e}var IF=["Robinson","robin"];const kF={init:RF,forward:CF,inverse:PF,names:IF};function DF(){this.name="geocent"}function OF(i){var e=vE(i,this.es,this.a);return e}function FF(i){var e=xE(i,this.es,this.a,this.b);return e}var NF=["Geocentric","geocentric","geocent","Geocent"];const BF={init:DF,forward:OF,inverse:FF,names:NF};var tc={N_POLE:0,S_POLE:1,EQUIT:2,OBLIQ:3},O2={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};function zF(){if(Object.keys(O2).forEach((function(t){if(typeof this[t]>"u")this[t]=O2[t].def;else{if(O2[t].num&&isNaN(this[t]))throw new Error("Invalid parameter value, must be numeric "+t+" = "+this[t]);O2[t].num&&(this[t]=parseFloat(this[t]))}O2[t].degrees&&(this[t]=this[t]*ya)}).bind(this)),Math.abs(Math.abs(this.lat0)-oi)<wi?this.mode=this.lat0<0?tc.S_POLE:tc.N_POLE:Math.abs(this.lat0)<wi?this.mode=tc.EQUIT:(this.mode=tc.OBLIQ,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var i=this.tilt,e=this.azi;this.cg=Math.cos(e),this.sg=Math.sin(e),this.cw=Math.cos(i),this.sw=Math.sin(i)}function LF(i){i.x-=this.long0;var e=Math.sin(i.y),t=Math.cos(i.y),r=Math.cos(i.x),o,p;switch(this.mode){case tc.OBLIQ:p=this.sinph0*e+this.cosph0*t*r;break;case tc.EQUIT:p=t*r;break;case tc.S_POLE:p=-e;break;case tc.N_POLE:p=e;break}switch(p=this.pn1/(this.p-p),o=p*t*Math.sin(i.x),this.mode){case tc.OBLIQ:p*=this.cosph0*e-this.sinph0*t*r;break;case tc.EQUIT:p*=e;break;case tc.N_POLE:p*=-(t*r);break;case tc.S_POLE:p*=t*r;break}var _,l;return _=p*this.cg+o*this.sg,l=1/(_*this.sw*this.h1+this.cw),o=(o*this.cg-p*this.sg)*this.cw*l,p=_*l,i.x=o*this.a,i.y=p*this.a,i}function UF(i){i.x/=this.a,i.y/=this.a;var e={x:i.x,y:i.y},t,r,o;o=1/(this.pn1-i.y*this.sw),t=this.pn1*i.x*o,r=this.pn1*i.y*this.cw*o,i.x=t*this.cg+r*this.sg,i.y=r*this.cg-t*this.sg;var p=ou(i.x,i.y);if(Math.abs(p)<wi)e.x=0,e.y=i.y;else{var _,l;switch(l=1-p*p*this.pfact,l=(this.p-Math.sqrt(l))/(this.pn1/p+p/this.pn1),_=Math.sqrt(1-l*l),this.mode){case tc.OBLIQ:e.y=Math.asin(_*this.sinph0+i.y*l*this.cosph0/p),i.y=(_-this.sinph0*Math.sin(e.y))*p,i.x*=l*this.cosph0;break;case tc.EQUIT:e.y=Math.asin(i.y*l/p),i.y=_*p,i.x*=l;break;case tc.N_POLE:e.y=Math.asin(_),i.y=-i.y;break;case tc.S_POLE:e.y=-Math.asin(_);break}e.x=Math.atan2(i.x,i.y)}return i.x=e.x+this.long0,i.y=e.y,i}var VF=["Tilted_Perspective","tpers"];const jF={init:zF,forward:LF,inverse:UF,names:VF};function GF(){if(this.flip_axis=this.sweep==="x"?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||this.radius_g_1>1e10)throw new Error;if(this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,this.es!==0){var i=1-this.es,e=1/i;this.radius_p=Math.sqrt(i),this.radius_p2=i,this.radius_p_inv2=e,this.shape="ellipse"}else this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere";this.title||(this.title="Geostationary Satellite View")}function WF(i){var e=i.x,t=i.y,r,o,p,_;if(e=e-this.long0,this.shape==="ellipse"){t=Math.atan(this.radius_p2*Math.tan(t));var l=this.radius_p/ou(this.radius_p*Math.cos(t),Math.sin(t));if(o=l*Math.cos(e)*Math.cos(t),p=l*Math.sin(e)*Math.cos(t),_=l*Math.sin(t),(this.radius_g-o)*o-p*p-_*_*this.radius_p_inv2<0)return i.x=Number.NaN,i.y=Number.NaN,i;r=this.radius_g-o,this.flip_axis?(i.x=this.radius_g_1*Math.atan(p/ou(_,r)),i.y=this.radius_g_1*Math.atan(_/r)):(i.x=this.radius_g_1*Math.atan(p/r),i.y=this.radius_g_1*Math.atan(_/ou(p,r)))}else this.shape==="sphere"&&(r=Math.cos(t),o=Math.cos(e)*r,p=Math.sin(e)*r,_=Math.sin(t),r=this.radius_g-o,this.flip_axis?(i.x=this.radius_g_1*Math.atan(p/ou(_,r)),i.y=this.radius_g_1*Math.atan(_/r)):(i.x=this.radius_g_1*Math.atan(p/r),i.y=this.radius_g_1*Math.atan(_/ou(p,r))));return i.x=i.x*this.a,i.y=i.y*this.a,i}function ZF(i){var e=-1,t=0,r=0,o,p,_,l;if(i.x=i.x/this.a,i.y=i.y/this.a,this.shape==="ellipse"){this.flip_axis?(r=Math.tan(i.y/this.radius_g_1),t=Math.tan(i.x/this.radius_g_1)*ou(1,r)):(t=Math.tan(i.x/this.radius_g_1),r=Math.tan(i.y/this.radius_g_1)*ou(1,t));var M=r/this.radius_p;if(o=t*t+M*M+e*e,p=2*this.radius_g*e,_=p*p-4*o*this.C,_<0)return i.x=Number.NaN,i.y=Number.NaN,i;l=(-p-Math.sqrt(_))/(2*o),e=this.radius_g+l*e,t*=l,r*=l,i.x=Math.atan2(t,e),i.y=Math.atan(r*Math.cos(i.x)/e),i.y=Math.atan(this.radius_p_inv2*Math.tan(i.y))}else if(this.shape==="sphere"){if(this.flip_axis?(r=Math.tan(i.y/this.radius_g_1),t=Math.tan(i.x/this.radius_g_1)*Math.sqrt(1+r*r)):(t=Math.tan(i.x/this.radius_g_1),r=Math.tan(i.y/this.radius_g_1)*Math.sqrt(1+t*t)),o=t*t+r*r+e*e,p=2*this.radius_g*e,_=p*p-4*o*this.C,_<0)return i.x=Number.NaN,i.y=Number.NaN,i;l=(-p-Math.sqrt(_))/(2*o),e=this.radius_g+l*e,t*=l,r*=l,i.x=Math.atan2(t,e),i.y=Math.atan(r*Math.cos(i.x)/e)}return i.x=i.x+this.long0,i}var XF=["Geostationary Satellite View","Geostationary_Satellite","geos"];const HF={init:GF,forward:WF,inverse:ZF,names:XF};var q2=1.340264,Y2=-.081106,J2=893e-6,Q2=.003796,Hv=Math.sqrt(3)/2;function $F(){this.es=0,this.long0=this.long0!==void 0?this.long0:0,this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0}function qF(i){var e=Ci(i.x-this.long0,this.over),t=i.y,r=Math.asin(Hv*Math.sin(t)),o=r*r,p=o*o*o;return i.x=e*Math.cos(r)/(Hv*(q2+3*Y2*o+p*(7*J2+9*Q2*o))),i.y=r*(q2+Y2*o+p*(J2+Q2*o)),i.x=this.a*i.x+this.x0,i.y=this.a*i.y+this.y0,i}function YF(i){i.x=(i.x-this.x0)/this.a,i.y=(i.y-this.y0)/this.a;var e=1e-9,t=12,r=i.y,o,p,_,l,M,D;for(D=0;D<t&&(o=r*r,p=o*o*o,_=r*(q2+Y2*o+p*(J2+Q2*o))-i.y,l=q2+3*Y2*o+p*(7*J2+9*Q2*o),r-=M=_/l,!(Math.abs(M)<e));++D);return o=r*r,p=o*o*o,i.x=Hv*i.x*(q2+3*Y2*o+p*(7*J2+9*Q2*o))/Math.cos(r),i.y=Math.asin(Math.sin(r)/Hv),i.x=Ci(i.x+this.long0,this.over),i}var JF=["eqearth","Equal Earth","Equal_Earth"];const QF={init:$F,forward:qF,inverse:YF,names:JF};var d1=1e-10;function KF(){var i;if(this.phi1=this.lat1,Math.abs(this.phi1)<d1)throw new Error;this.es?(this.en=gw(this.es),this.m1=n2(this.phi1,this.am1=Math.sin(this.phi1),i=Math.cos(this.phi1),this.en),this.am1=i/(Math.sqrt(1-this.es*this.am1*this.am1)*this.am1),this.inverse=tN,this.forward=eN):(Math.abs(this.phi1)+d1>=oi?this.cphi1=0:this.cphi1=1/Math.tan(this.phi1),this.inverse=nN,this.forward=iN)}function eN(i){var e=Ci(i.x-(this.long0||0),this.over),t=i.y,r,o,p;return r=this.am1+this.m1-n2(t,o=Math.sin(t),p=Math.cos(t),this.en),o=p*e/(r*Math.sqrt(1-this.es*o*o)),i.x=r*Math.sin(o),i.y=this.am1-r*Math.cos(o),i.x=this.a*i.x+(this.x0||0),i.y=this.a*i.y+(this.y0||0),i}function tN(i){i.x=(i.x-(this.x0||0))/this.a,i.y=(i.y-(this.y0||0))/this.a;var e,t,r,o;if(t=ou(i.x,i.y=this.am1-i.y),o=mw(this.am1+this.m1-t,this.es,this.en),(e=Math.abs(o))<oi)e=Math.sin(o),r=t*Math.atan2(i.x,i.y)*Math.sqrt(1-this.es*e*e)/Math.cos(o);else if(Math.abs(e-oi)<=d1)r=0;else throw new Error;return i.x=Ci(r+(this.long0||0),this.over),i.y=em(o),i}function iN(i){var e=Ci(i.x-(this.long0||0),this.over),t=i.y,r,o;return o=this.cphi1+this.phi1-t,Math.abs(o)>d1?(i.x=o*Math.sin(r=e*Math.cos(t)/o),i.y=this.cphi1-o*Math.cos(r)):i.x=i.y=0,i.x=this.a*i.x+(this.x0||0),i.y=this.a*i.y+(this.y0||0),i}function nN(i){i.x=(i.x-(this.x0||0))/this.a,i.y=(i.y-(this.y0||0))/this.a;var e,t,r=ou(i.x,i.y=this.cphi1-i.y);if(t=this.cphi1+this.phi1-r,Math.abs(t)>oi)throw new Error;return Math.abs(Math.abs(t)-oi)<=d1?e=0:e=r*Math.atan2(i.x,i.y)/Math.cos(t),i.x=Ci(e+(this.long0||0),this.over),i.y=em(t),i}var rN=["bonne","Bonne (Werner lat_1=90)"];const sN={init:KF,names:rN},WT={OBLIQUE:{forward:uN,inverse:fN},TRANSVERSE:{forward:hN,inverse:dN}},$v={ROTATE:{o_alpha:"oAlpha",o_lon_c:"oLongC",o_lat_c:"oLatC"},NEW_POLE:{o_lat_p:"oLatP",o_lon_p:"oLongP"},NEW_EQUATOR:{o_lon_1:"oLong1",o_lat_1:"oLat1",o_lon_2:"oLong2",o_lat_2:"oLat2"}};function aN(){if(this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.title=this.title||"General Oblique Transformation",this.isIdentity=gE.includes(this.o_proj),!this.o_proj)throw new Error("Missing parameter: o_proj");if(this.o_proj==="ob_tran")throw new Error("Invalid value for o_proj: "+this.o_proj);const i=this.projStr.replace("+proj=ob_tran","").replace("+o_proj=","+proj=").trim(),e=of(i);if(!e)throw new Error("Invalid parameter: o_proj. Unknown projection "+this.o_proj);e.long0=0,this.obliqueProjection=e;let t;const r=Object.keys($v),o=l=>{if(typeof this[l]>"u")return;const M=parseFloat(this[l])*ya;if(isNaN(M))throw new Error("Invalid value for "+l+": "+this[l]);return M};for(let l=0;l<r.length;l++){const M=r[l],D=$v[M],B=Object.entries(D);if(B.some(([$])=>typeof this[$]<"u")){t=D;for(let $=0;$<B.length;$++){const[se,de]=B[$],Ae=o(se);if(typeof Ae>"u")throw new Error("Missing parameter: "+se+".");this[de]=Ae}break}}if(!t)throw new Error("No valid parameters provided for ob_tran projection.");const{lamp:p,phip:_}=cN(this,t);this.lamp=p,Math.abs(_)>wi?(this.cphip=Math.cos(_),this.sphip=Math.sin(_),this.projectionType=WT.OBLIQUE):this.projectionType=WT.TRANSVERSE}function oN(i){return this.projectionType.forward(this,i)}function lN(i){return this.projectionType.inverse(this,i)}function cN(i,e){let t,r;if(e===$v.ROTATE){let o=i.oLongC,p=i.oLatC,_=i.oAlpha;if(Math.abs(Math.abs(p)-oi)<=wi)throw new Error("Invalid value for o_lat_c: "+i.o_lat_c+" should be < 90");r=o+Math.atan2(-1*Math.cos(_),-1*Math.sin(_)*Math.sin(p)),t=Math.asin(Math.cos(p)*Math.sin(_))}else if(e===$v.NEW_POLE)r=i.oLongP,t=i.oLatP;else{let o=i.oLong1,p=i.oLat1,_=i.oLong2,l=i.oLat2,M=Math.abs(p);if(Math.abs(p)>oi-wi)throw new Error("Invalid value for o_lat_1: "+i.o_lat_1+" should be < 90");if(Math.abs(l)>oi-wi)throw new Error("Invalid value for o_lat_2: "+i.o_lat_2+" should be < 90");if(Math.abs(p-l)<wi)throw new Error("Invalid value for o_lat_1 and o_lat_2: o_lat_1 should be different from o_lat_2");if(M<wi)throw new Error("Invalid value for o_lat_1: o_lat_1 should be different from zero");r=Math.atan2(Math.cos(p)*Math.sin(l)*Math.cos(o)-Math.sin(p)*Math.cos(l)*Math.cos(_),Math.sin(p)*Math.cos(l)*Math.sin(_)-Math.cos(p)*Math.sin(l)*Math.sin(o)),t=Math.atan(-1*Math.cos(r-o)/Math.tan(p))}return{lamp:r,phip:t}}function uN(i,e){let{x:t,y:r}=e;t+=i.long0;const o=Math.cos(t),p=Math.sin(r),_=Math.cos(r);e.x=Ci(Math.atan2(_*Math.sin(t),i.sphip*_*o+i.cphip*p)+i.lamp),e.y=Math.asin(i.sphip*p-i.cphip*_*o);const l=i.obliqueProjection.forward(e);return i.isIdentity&&(l.x*=lu,l.y*=lu),l}function hN(i,e){let{x:t,y:r}=e;t+=i.long0;const o=Math.cos(r),p=Math.cos(t);e.x=Ci(Math.atan2(o*Math.sin(t),Math.sin(r))+i.lamp),e.y=Math.asin(-1*o*p);const _=i.obliqueProjection.forward(e);return i.isIdentity&&(_.x*=lu,_.y*=lu),_}function fN(i,e){i.isIdentity&&(e.x*=ya,e.y*=ya);const t=i.obliqueProjection.inverse(e);let{x:r,y:o}=t;if(r<Number.MAX_VALUE){r-=i.lamp;const p=Math.cos(r),_=Math.sin(o),l=Math.cos(o);e.x=Math.atan2(l*Math.sin(r),i.sphip*l*p-i.cphip*_),e.y=Math.asin(i.sphip*_+i.cphip*l*p)}return e.x=Ci(e.x+i.long0),e}function dN(i,e){i.isIdentity&&(e.x*=ya,e.y*=ya);const t=i.obliqueProjection.inverse(e);let{x:r,y:o}=t;if(r<Number.MAX_VALUE){const p=Math.cos(o);r-=i.lamp,e.x=Math.atan2(p*Math.sin(r),-1*Math.sin(o)),e.y=Math.asin(p*Math.cos(r))}return e.x=Ci(e.x+i.long0),e}var pN=["General Oblique Transformation","General_Oblique_Transformation","ob_tran"];const gN={init:aN,forward:oN,inverse:lN,names:pN};function mN(i){i.Proj.projections.add(bv),i.Proj.projections.add(Av),i.Proj.projections.add(rD),i.Proj.projections.add(dD),i.Proj.projections.add(yD),i.Proj.projections.add(wD),i.Proj.projections.add(CD),i.Proj.projections.add(OD),i.Proj.projections.add(LD),i.Proj.projections.add(WD),i.Proj.projections.add(nO),i.Proj.projections.add(cO),i.Proj.projections.add(pO),i.Proj.projections.add(xO),i.Proj.projections.add(SO),i.Proj.projections.add(PO),i.Proj.projections.add(FO),i.Proj.projections.add(UO),i.Proj.projections.add(XO),i.Proj.projections.add(JO),i.Proj.projections.add(iF),i.Proj.projections.add(oF),i.Proj.projections.add(pF),i.Proj.projections.add(vF),i.Proj.projections.add(TF),i.Proj.projections.add(kF),i.Proj.projections.add(BF),i.Proj.projections.add(jF),i.Proj.projections.add(HF),i.Proj.projections.add(QF),i.Proj.projections.add(sN),i.Proj.projections.add(gN)}const DE=Object.assign(bk,{defaultDatum:"WGS84",Proj:of,WGS84:new of("WGS84"),Point:qy,toPoint:bE,defs:vl,nadgrid:nk,transform:Wv,mgrs:Ak,version:"__VERSION__"});mN(DE);const _N="+proj=utm +zone=32 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs +type=crs",yN="EPSG:4326",vN=DE(_N,yN);function nv(){return new Promise(i=>setTimeout(i,0))}const ZT=5e5;async function xN(i,e){var di,Ei,Ii;e==null||e(.05);let t;try{console.log(`Starting load for source: ${typeof i=="string"?i:"File object"}`);let fi;if(typeof i=="string"){console.log(`[Loader] Fetching URL: ${i}`);try{const li=await fetch(i);if(!li.ok)throw console.error(`[Loader] HTTP Error: ${li.status} ${li.statusText} for ${i}`),new Error(`HTTP ${li.status} ${li.statusText}`);fi=await li.arrayBuffer(),console.log(`[Loader] Download complete: ${fi.byteLength} bytes`)}catch(li){throw console.error(`[Loader] Network error fetching ${i}:`,li),new Error(`Failed to fetch ${i}. Check network, CORS, or file existence.`)}}else fi=await i.arrayBuffer();const Ui=new DataView(fi),nt=Ui.getUint8(24),Ut=Ui.getUint8(25),mi=Ui.getUint8(104)&63;if(console.log(`LAS Version: ${nt}.${Ut}, Point Format: ${mi}`),nt===1&&Ut===4){if(mi>3)throw new Error(`LAS 1.4 with Point Format ${mi} is not supported. Only formats 0-3 are supported.`);console.warn("Patching LAS header version 1.4 -> 1.3 for compatibility."),Ui.setUint8(25,3)}t=await Uv(fi,f5,{worker:!1,las:{shape:"mesh",fp64:!0}}),console.log("Successfully loaded mesh:",t)}catch(fi){throw console.error("Error loading point cloud:",fi),fi}e==null||e(.4),await nv();const{attributes:r,header:o}=t,p=o.vertexCount,_=r.POSITION.value,l=p>ZT?Math.ceil(p/ZT):1,M=Math.ceil(p/l);console.log(`Point cloud: ${p.toLocaleString()} total  sampling every ${l}th  ${M.toLocaleString()} points`);const D=((di=r.COLOR_0)==null?void 0:di.value)??null,B=((Ei=r.intensity)==null?void 0:Ei.value)??null,j=((Ii=r.classification)==null?void 0:Ii.value)??null;e==null||e(.5),await nv();const $=new Float64Array(M*3),se=B?new Float32Array(M):null,de=j?new Uint8Array(M):null;let Ae=1/0,he=-1/0,Le=1/0,$e=-1/0,Be=1/0,Je=-1/0;const Rt=25e4;for(let fi=0;fi<M;fi++){const Ui=fi*l,nt=_[Ui*3],Ut=_[Ui*3+1],mi=_[Ui*3+2],[li,Wi]=vN.forward([nt,Ut]);$[fi*3]=li,$[fi*3+1]=Wi,$[fi*3+2]=mi,se&&B&&(se[fi]=B[Ui]/65535),de&&j&&(de[fi]=j[Ui]),li<Ae&&(Ae=li),li>he&&(he=li),Wi<Le&&(Le=Wi),Wi>$e&&($e=Wi),mi<Be&&(Be=mi),mi>Je&&(Je=mi),fi>0&&fi%Rt===0&&(e==null||e(.5+.4*(fi/M)),await nv())}e==null||e(.9),await nv();const Et=(Ae+he)/2,kt=(Le+$e)/2,Ht=[Et,kt,0],Xt=new Float32Array(M*3);for(let fi=0;fi<M;fi++)Xt[fi*3]=$[fi*3]-Et,Xt[fi*3+1]=$[fi*3+1]-kt,Xt[fi*3+2]=$[fi*3+2];let hi=null;if(D){const fi=r.COLOR_0.size;hi=new Uint8Array(M*4);for(let Ui=0;Ui<M;Ui++){const nt=Ui*l;fi>=3&&(hi[Ui*4]=D[nt*fi],hi[Ui*4+1]=D[nt*fi+1],hi[Ui*4+2]=D[nt*fi+2]),hi[Ui*4+3]=255}}return e==null||e(1),{positions:Xt,coordinateOrigin:Ht,colors:hi,intensities:se,classifications:de,pointCount:M,bounds:{minX:Ae,maxX:he,minY:Le,maxY:$e,minZ:Be,maxZ:Je}}}function bN(i,e,t,r=2){const{positions:o,pointCount:p,coordinateOrigin:_,colors:l,intensities:M,classifications:D}=i,[B,j]=_,$=Math.cos(j*Math.PI/180),se=111320,de=111320*$,Ae=(e[0]-B)*de,he=(e[1]-j)*se,Le=(t[0]-B)*de,$e=(t[1]-j)*se,Be=Le-Ae,Je=$e-he,Rt=Be*Be+Je*Je,Et=Math.sqrt(Rt);if(Et===0)return[];const kt=Be/Et,Ht=Je/Et,Xt=-Ht,hi=kt,di=r/2,Ei=[];for(let Ii=0;Ii<p;Ii++){const fi=o[Ii*3]*de,Ui=o[Ii*3+1]*se,nt=o[Ii*3+2],Ut=fi-Ae,mi=Ui-he,li=Ut*kt+mi*Ht,Wi=Ut*Xt+mi*hi;if(li>=0&&li<=Et&&Math.abs(Wi)<=di){let Ye=[255,255,255];l&&(Ye=[l[Ii*4],l[Ii*4+1],l[Ii*4+2]]),Ei.push({distance:li,elevation:nt,color:Ye,intensity:M?M[Ii]:0,classification:D?D[Ii]:0})}}return Ei.sort((Ii,fi)=>Ii.distance-fi.distance),Ei}var Tv={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.17.0/LICENSE.txt
 */var AN=Tv.exports,XT;function wN(){return XT||(XT=1,(function(i,e){(function(t,r){i.exports=r()})(AN,(function(){var t={},r={};function o(_,l,M){if(r[_]=M,_==="index"){var D="var sharedModule = {}; ("+r.shared+")(sharedModule); ("+r.worker+")(sharedModule);",B={};return r.shared(B),r.index(t,B),typeof window<"u"&&t.setWorkerUrl(window.URL.createObjectURL(new Blob([D],{type:"text/javascript"}))),t}}o("shared",["exports"],(function(_){function l(f,a,h,y){return new(h||(h=Promise))((function(b,S){function E(V){try{F(y.next(V))}catch(H){S(H)}}function k(V){try{F(y.throw(V))}catch(H){S(H)}}function F(V){var H;V.done?b(V.value):(H=V.value,H instanceof h?H:new h((function(Y){Y(H)}))).then(E,k)}F((y=y.apply(f,a||[])).next())}))}function M(f,a){this.x=f,this.y=a}function D(f){return f&&f.__esModule&&Object.prototype.hasOwnProperty.call(f,"default")?f.default:f}var B,j;typeof SuppressedError=="function"&&SuppressedError,M.prototype={clone(){return new M(this.x,this.y)},add(f){return this.clone()._add(f)},sub(f){return this.clone()._sub(f)},multByPoint(f){return this.clone()._multByPoint(f)},divByPoint(f){return this.clone()._divByPoint(f)},mult(f){return this.clone()._mult(f)},div(f){return this.clone()._div(f)},rotate(f){return this.clone()._rotate(f)},rotateAround(f,a){return this.clone()._rotateAround(f,a)},matMult(f){return this.clone()._matMult(f)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(f){return this.x===f.x&&this.y===f.y},dist(f){return Math.sqrt(this.distSqr(f))},distSqr(f){const a=f.x-this.x,h=f.y-this.y;return a*a+h*h},angle(){return Math.atan2(this.y,this.x)},angleTo(f){return Math.atan2(this.y-f.y,this.x-f.x)},angleWith(f){return this.angleWithSep(f.x,f.y)},angleWithSep(f,a){return Math.atan2(this.x*a-this.y*f,this.x*f+this.y*a)},_matMult(f){const a=f[2]*this.x+f[3]*this.y;return this.x=f[0]*this.x+f[1]*this.y,this.y=a,this},_add(f){return this.x+=f.x,this.y+=f.y,this},_sub(f){return this.x-=f.x,this.y-=f.y,this},_mult(f){return this.x*=f,this.y*=f,this},_div(f){return this.x/=f,this.y/=f,this},_multByPoint(f){return this.x*=f.x,this.y*=f.y,this},_divByPoint(f){return this.x/=f.x,this.y/=f.y,this},_unit(){return this._div(this.mag()),this},_perp(){const f=this.y;return this.y=this.x,this.x=-f,this},_rotate(f){const a=Math.cos(f),h=Math.sin(f),y=h*this.x+a*this.y;return this.x=a*this.x-h*this.y,this.y=y,this},_rotateAround(f,a){const h=Math.cos(f),y=Math.sin(f),b=a.y+y*(this.x-a.x)+h*(this.y-a.y);return this.x=a.x+h*(this.x-a.x)-y*(this.y-a.y),this.y=b,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:M},M.convert=function(f){if(f instanceof M)return f;if(Array.isArray(f))return new M(+f[0],+f[1]);if(f.x!==void 0&&f.y!==void 0)return new M(+f.x,+f.y);throw new Error("Expected [x, y] or {x, y} point format")};var $=(function(){if(j)return B;function f(a,h,y,b){this.cx=3*a,this.bx=3*(y-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*h,this.by=3*(b-h)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=h,this.p2x=y,this.p2y=b}return j=1,B=f,f.prototype={sampleCurveX:function(a){return((this.ax*a+this.bx)*a+this.cx)*a},sampleCurveY:function(a){return((this.ay*a+this.by)*a+this.cy)*a},sampleCurveDerivativeX:function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},solveCurveX:function(a,h){if(h===void 0&&(h=1e-6),a<0)return 0;if(a>1)return 1;for(var y=a,b=0;b<8;b++){var S=this.sampleCurveX(y)-a;if(Math.abs(S)<h)return y;var E=this.sampleCurveDerivativeX(y);if(Math.abs(E)<1e-6)break;y-=S/E}var k=0,F=1;for(y=a,b=0;b<20&&(S=this.sampleCurveX(y),!(Math.abs(S-a)<h));b++)a>S?k=y:F=y,y=.5*(F-k)+k;return y},solve:function(a,h){return this.sampleCurveY(this.solveCurveX(a,h))}},B})(),se=D($);let de,Ae;function he(){return de==null&&(de=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),de}function Le(){if(Ae==null&&(Ae=!1,he())){const a=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(a){for(let y=0;y<25;y++){const b=4*y;a.fillStyle=`rgb(${b},${b+1},${b+2})`,a.fillRect(y%5,Math.floor(y/5),1,1)}const h=a.getImageData(0,0,5,5).data;for(let y=0;y<100;y++)if(y%4!=3&&h[y]!==y){Ae=!0;break}}}return Ae||!1}var $e=1e-6,Be=typeof Float32Array<"u"?Float32Array:Array;function Je(){var f=new Be(9);return Be!=Float32Array&&(f[1]=0,f[2]=0,f[3]=0,f[5]=0,f[6]=0,f[7]=0),f[0]=1,f[4]=1,f[8]=1,f}function Rt(f){return f[0]=1,f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=1,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[10]=1,f[11]=0,f[12]=0,f[13]=0,f[14]=0,f[15]=1,f}function Et(){var f=new Be(3);return Be!=Float32Array&&(f[0]=0,f[1]=0,f[2]=0),f}function kt(f){var a=f[0],h=f[1],y=f[2];return Math.sqrt(a*a+h*h+y*y)}function Ht(f,a,h){var y=new Be(3);return y[0]=f,y[1]=a,y[2]=h,y}function Xt(f,a,h){return f[0]=a[0]+h[0],f[1]=a[1]+h[1],f[2]=a[2]+h[2],f}function hi(f,a,h){return f[0]=a[0]*h,f[1]=a[1]*h,f[2]=a[2]*h,f}function di(f,a,h){var y=a[0],b=a[1],S=a[2],E=h[0],k=h[1],F=h[2];return f[0]=b*F-S*k,f[1]=S*E-y*F,f[2]=y*k-b*E,f}var Ei,Ii=kt;function fi(f,a,h){var y=a[0],b=a[1],S=a[2],E=a[3];return f[0]=h[0]*y+h[4]*b+h[8]*S+h[12]*E,f[1]=h[1]*y+h[5]*b+h[9]*S+h[13]*E,f[2]=h[2]*y+h[6]*b+h[10]*S+h[14]*E,f[3]=h[3]*y+h[7]*b+h[11]*S+h[15]*E,f}function Ui(){var f=new Be(4);return Be!=Float32Array&&(f[0]=0,f[1]=0,f[2]=0),f[3]=1,f}function nt(f,a,h,y){var b=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"zyx",S=Math.PI/360;a*=S,y*=S,h*=S;var E=Math.sin(a),k=Math.cos(a),F=Math.sin(h),V=Math.cos(h),H=Math.sin(y),Y=Math.cos(y);switch(b){case"xyz":f[0]=E*V*Y+k*F*H,f[1]=k*F*Y-E*V*H,f[2]=k*V*H+E*F*Y,f[3]=k*V*Y-E*F*H;break;case"xzy":f[0]=E*V*Y-k*F*H,f[1]=k*F*Y-E*V*H,f[2]=k*V*H+E*F*Y,f[3]=k*V*Y+E*F*H;break;case"yxz":f[0]=E*V*Y+k*F*H,f[1]=k*F*Y-E*V*H,f[2]=k*V*H-E*F*Y,f[3]=k*V*Y+E*F*H;break;case"yzx":f[0]=E*V*Y+k*F*H,f[1]=k*F*Y+E*V*H,f[2]=k*V*H-E*F*Y,f[3]=k*V*Y-E*F*H;break;case"zxy":f[0]=E*V*Y-k*F*H,f[1]=k*F*Y+E*V*H,f[2]=k*V*H+E*F*Y,f[3]=k*V*Y-E*F*H;break;case"zyx":f[0]=E*V*Y-k*F*H,f[1]=k*F*Y+E*V*H,f[2]=k*V*H-E*F*Y,f[3]=k*V*Y+E*F*H;break;default:throw new Error("Unknown angle order "+b)}return f}function Ut(){var f=new Be(2);return Be!=Float32Array&&(f[0]=0,f[1]=0),f}function mi(f,a){var h=new Be(2);return h[0]=f,h[1]=a,h}Et(),Ei=new Be(4),Be!=Float32Array&&(Ei[0]=0,Ei[1]=0,Ei[2]=0,Ei[3]=0),Et(),Ht(1,0,0),Ht(0,1,0),Ui(),Ui(),Je(),Ut();const li=8192;function Wi(f,a,h){return a*(li/(f.tileSize*Math.pow(2,h-f.tileID.overscaledZ)))}function Ye(f,a){return(f%a+a)%a}function Gt(f,a,h){return f*(1-h)+a*h}function vi(f){if(f<=0)return 0;if(f>=1)return 1;const a=f*f,h=a*f;return 4*(f<.5?h:3*(f-a)+h-.75)}function Si(f,a,h,y){const b=new se(f,a,h,y);return S=>b.solve(S)}const Li=Si(.25,.1,.25,1);function Vi(f,a,h){return Math.min(h,Math.max(a,f))}function yn(f,a,h){const y=h-a,b=((f-a)%y+y)%y+a;return b===a?h:b}function Kn(f,...a){for(const h of a)for(const y in h)f[y]=h[y];return f}let mr=1;function Co(f,a,h){const y={};for(const b in f)y[b]=a.call(this,f[b],b,f);return y}function Oa(f,a,h){const y={};for(const b in f)a.call(this,f[b],b,f)&&(y[b]=f[b]);return y}function ra(f){return Array.isArray(f)?f.map(ra):typeof f=="object"&&f?Co(f,ra):f}const uh={};function br(f){uh[f]||(typeof console<"u"&&console.warn(f),uh[f]=!0)}function Fa(f,a,h){return(h.y-f.y)*(a.x-f.x)>(a.y-f.y)*(h.x-f.x)}function Na(f){return typeof WorkerGlobalScope<"u"&&f!==void 0&&f instanceof WorkerGlobalScope}let Ir=null;function xl(f){return typeof ImageBitmap<"u"&&f instanceof ImageBitmap}const Fc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Nc(f,a,h,y,b){return l(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const S=new VideoFrame(f,{timestamp:0});try{const E=S==null?void 0:S.format;if(!E||!E.startsWith("BGR")&&!E.startsWith("RGB"))throw new Error(`Unrecognized format ${E}`);const k=E.startsWith("BGR"),F=new Uint8ClampedArray(y*b*4);if(yield S.copyTo(F,(function(V,H,Y,K,te){const oe=4*Math.max(-H,0),le=(Math.max(0,Y)-Y)*K*4+oe,ue=4*K,xe=Math.max(0,H),De=Math.max(0,Y);return{rect:{x:xe,y:De,width:Math.min(V.width,H+K)-xe,height:Math.min(V.height,Y+te)-De},layout:[{offset:le,stride:ue}]}})(f,a,h,y,b)),k)for(let V=0;V<F.length;V+=4){const H=F[V];F[V]=F[V+2],F[V+2]=H}return F}finally{S.close()}}))}let Po,ic;function so(f,a,h,y){return f.addEventListener(a,h,y),{unsubscribe:()=>{f.removeEventListener(a,h,y)}}}function Qr(f){return f*Math.PI/180}function ao(f){return f/Math.PI*180}const nc={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},Qo={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},Ls="AbortError";class hh extends Error{constructor(a=Ls){super(a instanceof Error?a.message:a),this.name=Ls,a instanceof Error&&a.stack&&(this.stack=a.stack)}}function it(f){return f.name===Ls}const fe={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function ge(f){return fe.REGISTERED_PROTOCOLS[f.substring(0,f.indexOf("://"))]}const ve="global-dispatcher";class Fe extends Error{constructor(a,h,y,b){super(`AJAXError: ${h} (${a}): ${y}`),this.status=a,this.statusText=h,this.url=y,this.body=b}}const He=()=>Na(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,st=function(f,a){if(/:\/\//.test(f.url)&&!/^https?:|^file:/.test(f.url)){const y=ge(f.url);if(y)return y(f,a);if(Na(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:f,targetMapId:ve},a)}if(!(/^file:/.test(h=f.url)||/^file:/.test(He())&&!/^\w+:/.test(h))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(y,b){return l(this,void 0,void 0,(function*(){const S=new Request(y.url,{method:y.method||"GET",body:y.body,credentials:y.credentials,headers:y.headers,cache:y.cache,referrer:He(),signal:b.signal});let E,k;y.type!=="json"||S.headers.has("Accept")||S.headers.set("Accept","application/json");try{E=yield fetch(S)}catch(V){throw it(V)?V:new Fe(0,V.message,y.url,new Blob)}if(!E.ok){const V=yield E.blob();throw new Fe(E.status,E.statusText,y.url,V)}k=y.type==="arrayBuffer"||y.type==="image"?E.arrayBuffer():y.type==="json"?E.json():E.text();const F=yield k;return b.signal.throwIfAborted(),{data:F,cacheControl:E.headers.get("Cache-Control"),expires:E.headers.get("Expires")}}))})(f,a);if(Na(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:f,mustQueue:!0,targetMapId:ve},a)}var h;return(function(y,b){return new Promise(((S,E)=>{var k;const F=new XMLHttpRequest;F.open(y.method||"GET",y.url,!0),y.type!=="arrayBuffer"&&y.type!=="image"||(F.responseType="arraybuffer");for(const V in y.headers)F.setRequestHeader(V,y.headers[V]);y.type==="json"&&(F.responseType="text",!((k=y.headers)===null||k===void 0)&&k.Accept||F.setRequestHeader("Accept","application/json")),F.withCredentials=y.credentials==="include",F.onerror=()=>{E(new Error(F.statusText))},F.onload=()=>{if(!b.signal.aborted)if((F.status>=200&&F.status<300||F.status===0)&&F.response!==null){let V=F.response;if(y.type==="json")try{V=JSON.parse(F.response)}catch(H){return void E(H)}S({data:V,cacheControl:F.getResponseHeader("Cache-Control"),expires:F.getResponseHeader("Expires")})}else{const V=new Blob([F.response],{type:F.getResponseHeader("Content-Type")});E(new Fe(F.status,F.statusText,y.url,V))}},b.signal.addEventListener("abort",(()=>{F.abort(),E(new hh(b.signal.reason))})),F.send(y.body)}))})(f,a)};function xt(f){if(!f||f.indexOf("://")<=0||f.indexOf("data:image/")===0||f.indexOf("blob:")===0)return!0;const a=new URL(f),h=window.location;return a.protocol===h.protocol&&a.host===h.host}function Qe(f,a,h){h[f]&&h[f].indexOf(a)!==-1||(h[f]=h[f]||[],h[f].push(a))}function ht(f,a,h){if(h&&h[f]){const y=h[f].indexOf(a);y!==-1&&h[f].splice(y,1)}}class zt{constructor(a,h={}){Kn(this,h),this.type=a}}class Pt extends zt{constructor(a,h={}){super("error",Kn({error:a},h))}}class qt{on(a,h){return this._listeners=this._listeners||{},Qe(a,h,this._listeners),{unsubscribe:()=>{this.off(a,h)}}}off(a,h){return ht(a,h,this._listeners),ht(a,h,this._oneTimeListeners),this}once(a,h){return h?(this._oneTimeListeners=this._oneTimeListeners||{},Qe(a,h,this._oneTimeListeners),this):new Promise((y=>this.once(a,y)))}fire(a,h){typeof a=="string"&&(a=new zt(a,h||{}));const y=a.type;if(this.listens(y)){a.target=this;const b=this._listeners&&this._listeners[y]?this._listeners[y].slice():[];for(const k of b)k.call(this,a);const S=this._oneTimeListeners&&this._oneTimeListeners[y]?this._oneTimeListeners[y].slice():[];for(const k of S)ht(y,k,this._oneTimeListeners),k.call(this,a);const E=this._eventedParent;E&&(Kn(a,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),E.fire(a))}else a instanceof Pt&&console.error(a.error);return this}listens(a){return this._listeners&&this._listeners[a]&&this._listeners[a].length>0||this._oneTimeListeners&&this._oneTimeListeners[a]&&this._oneTimeListeners[a].length>0||this._eventedParent&&this._eventedParent.listens(a)}setEventedParent(a,h){return this._eventedParent=a,this._eventedParentData=h,this}}var Ke={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number",length:2},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},"font-faces":{type:"fontFaces"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},encoding:{type:"enum",values:{mvt:{},mlt:{}},default:"mvt"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"filter"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},filter:{type:"boolean",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"expression_name",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}},interpolation:{type:"array",value:"interpolation_name",minimum:1},interpolation_name:{type:"enum",values:{linear:{syntax:{overloads:[{parameters:[],"output-type":"interpolation"}],parameters:[]}},exponential:{syntax:{overloads:[{parameters:["base"],"output-type":"interpolation"}],parameters:[{name:"base",type:"number literal"}]}},"cubic-bezier":{syntax:{overloads:[{parameters:["x1","y1","x2","y2"],"output-type":"interpolation"}],parameters:[{name:"x1",type:"number literal"},{name:"y1",type:"number literal"},{name:"x2",type:"number literal"},{name:"y2",type:"number literal"}]}}}}};const Oi=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Tn(f,a){const h={};for(const y in f)y!=="ref"&&(h[y]=f[y]);return Oi.forEach((y=>{y in a&&(h[y]=a[y])})),h}function bi(f,a){if(Array.isArray(f)){if(!Array.isArray(a)||f.length!==a.length)return!1;for(let h=0;h<f.length;h++)if(!bi(f[h],a[h]))return!1;return!0}if(typeof f=="object"&&f!==null&&a!==null){if(typeof a!="object"||Object.keys(f).length!==Object.keys(a).length)return!1;for(const h in f)if(!bi(f[h],a[h]))return!1;return!0}return f===a}function ki(f,a){f.push(a)}function qi(f,a,h){ki(h,{command:"addSource",args:[f,a[f]]})}function Bn(f,a,h){ki(a,{command:"removeSource",args:[f]}),h[f]=!0}function er(f,a,h,y){Bn(f,h,y),qi(f,a,h)}function Kr(f,a,h){let y;for(y in f[h])if(Object.prototype.hasOwnProperty.call(f[h],y)&&y!=="data"&&!bi(f[h][y],a[h][y]))return!1;for(y in a[h])if(Object.prototype.hasOwnProperty.call(a[h],y)&&y!=="data"&&!bi(f[h][y],a[h][y]))return!1;return!0}function es(f,a,h,y,b,S){f=f||{},a=a||{};for(const E in f)Object.prototype.hasOwnProperty.call(f,E)&&(bi(f[E],a[E])||h.push({command:S,args:[y,E,a[E],b]}));for(const E in a)Object.prototype.hasOwnProperty.call(a,E)&&!Object.prototype.hasOwnProperty.call(f,E)&&(bi(f[E],a[E])||h.push({command:S,args:[y,E,a[E],b]}))}function tr(f){return f.id}function $i(f,a){return f[a.id]=a,f}class Vt{constructor(a,h,y,b){this.message=(a?`${a}: `:"")+y,b&&(this.identifier=b),h!=null&&h.__line__&&(this.line=h.__line__)}}function Ar(f,...a){for(const h of a)for(const y in h)f[y]=h[y];return f}class Cs extends Error{constructor(a,h){super(h),this.message=h,this.key=a}}class ts{constructor(a,h=[]){this.parent=a,this.bindings={};for(const[y,b]of h)this.bindings[y]=b}concat(a){return new ts(this,a)}get(a){if(this.bindings[a])return this.bindings[a];if(this.parent)return this.parent.get(a);throw new Error(`${a} not found in scope.`)}has(a){return!!this.bindings[a]||!!this.parent&&this.parent.has(a)}}const vn={kind:"null"},ei={kind:"number"},Xi={kind:"string"},en={kind:"boolean"},ba={kind:"color"},df={kind:"projectionDefinition"},bl={kind:"object"},Yi={kind:"value"},Ko={kind:"collator"},Al={kind:"formatted"},rc={kind:"padding"},wl={kind:"colorArray"},Ba={kind:"numberArray"},cr={kind:"resolvedImage"},Bc={kind:"variableAnchorOffsetCollection"};function sa(f,a){return{kind:"array",itemType:f,N:a}}function En(f){if(f.kind==="array"){const a=En(f.itemType);return typeof f.N=="number"?`array<${a}, ${f.N}>`:f.itemType.kind==="value"?"array":`array<${a}>`}return f.kind}const aa=[vn,ei,Xi,en,ba,df,Al,bl,sa(Yi),rc,Ba,wl,cr,Bc];function hu(f,a){if(a.kind==="error")return null;if(f.kind==="array"){if(a.kind==="array"&&(a.N===0&&a.itemType.kind==="value"||!hu(f.itemType,a.itemType))&&(typeof f.N!="number"||f.N===a.N))return null}else{if(f.kind===a.kind)return null;if(f.kind==="value"){for(const h of aa)if(!hu(h,a))return null}}return`Expected ${En(f)} but found ${En(a)} instead.`}function fu(f,a){return a.some((h=>h.kind===f.kind))}function zc(f,a){return a.some((h=>h==="null"?f===null:h==="array"?Array.isArray(f):h==="object"?f&&!Array.isArray(f)&&typeof f=="object":h===typeof f))}function el(f,a){return f.kind==="array"&&a.kind==="array"?f.itemType.kind===a.itemType.kind&&typeof f.N=="number":f.kind===a.kind}const du=.96422,Tl=.82521,Io=4/29,kn=6/29,fh=3*kn*kn,kp=kn*kn*kn,pu=Math.PI/180,u0=180/Math.PI;function dh(f){return(f%=360)<0&&(f+=360),f}function Dp([f,a,h,y]){let b,S;const E=pf((.2225045*(f=Aa(f))+.7168786*(a=Aa(a))+.0606169*(h=Aa(h)))/1);f===a&&a===h?b=S=E:(b=pf((.4360747*f+.3850649*a+.1430804*h)/du),S=pf((.0139322*f+.0971045*a+.7141733*h)/Tl));const k=116*E-16;return[k<0?0:k,500*(b-E),200*(E-S),y]}function Aa(f){return f<=.04045?f/12.92:Math.pow((f+.055)/1.055,2.4)}function pf(f){return f>kp?Math.pow(f,1/3):f/fh+Io}function id([f,a,h,y]){let b=(f+16)/116,S=isNaN(a)?b:b+a/500,E=isNaN(h)?b:b-h/200;return b=1*Lc(b),S=du*Lc(S),E=Tl*Lc(E),[sc(3.1338561*S-1.6168667*b-.4906146*E),sc(-.9787684*S+1.9161415*b+.033454*E),sc(.0719453*S-.2289914*b+1.4052427*E),y]}function sc(f){return(f=f<=.00304?12.92*f:1.055*Math.pow(f,1/2.4)-.055)<0?0:f>1?1:f}function Lc(f){return f>kn?f*f*f:fh*(f-Io)}const Op=Object.hasOwn||function(f,a){return Object.prototype.hasOwnProperty.call(f,a)};function ac(f,a){return Op(f,a)?f[a]:void 0}function oc(f){return parseInt(f.padEnd(2,f),16)/255}function Fp(f,a){return wa(a?f/100:f,0,1)}function wa(f,a,h){return Math.min(Math.max(a,f),h)}function nd(f){return!f.some(Number.isNaN)}const ko={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function lc(f,a,h){return f+h*(a-f)}function ph(f,a,h){return f.map(((y,b)=>lc(y,a[b],h)))}class Qi{constructor(a,h,y,b=1,S=!0){this.r=a,this.g=h,this.b=y,this.a=b,S||(this.r*=b,this.g*=b,this.b*=b,b||this.overwriteGetter("rgb",[a,h,y,b]))}static parse(a){if(a instanceof Qi)return a;if(typeof a!="string")return;const h=(function(y){if((y=y.toLowerCase().trim())==="transparent")return[0,0,0,0];const b=ac(ko,y);if(b){const[E,k,F]=b;return[E/255,k/255,F/255,1]}if(y.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(y)){const E=y.length<6?1:2;let k=1;return[oc(y.slice(k,k+=E)),oc(y.slice(k,k+=E)),oc(y.slice(k,k+=E)),oc(y.slice(k,k+E)||"ff")]}if(y.startsWith("rgb")){const E=y.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(E){const[k,F,V,H,Y,K,te,oe,le,ue,xe,De]=E,we=[H||" ",te||" ",ue].join("");if(we==="  "||we==="  /"||we===",,"||we===",,,"){const Ee=[V,K,le].join(""),Ne=Ee==="%%%"?100:Ee===""?255:0;if(Ne){const Ze=[wa(+F/Ne,0,1),wa(+Y/Ne,0,1),wa(+oe/Ne,0,1),xe?Fp(+xe,De):1];if(nd(Ze))return Ze}}return}}const S=y.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(S){const[E,k,F,V,H,Y,K,te,oe]=S,le=[F||" ",H||" ",K].join("");if(le==="  "||le==="  /"||le===",,"||le===",,,"){const ue=[+k,wa(+V,0,100),wa(+Y,0,100),te?Fp(+te,oe):1];if(nd(ue))return(function([xe,De,we,Ee]){function Ne(Ze){const yt=(Ze+xe/30)%12,Bt=De*Math.min(we,1-we);return we-Bt*Math.max(-1,Math.min(yt-3,9-yt,1))}return xe=dh(xe),De/=100,we/=100,[Ne(0),Ne(8),Ne(4),Ee]})(ue)}}})(a);return h?new Qi(...h,!1):void 0}get rgb(){const{r:a,g:h,b:y,a:b}=this,S=b||1/0;return this.overwriteGetter("rgb",[a/S,h/S,y/S,b])}get hcl(){return this.overwriteGetter("hcl",(function(a){const[h,y,b,S]=Dp(a),E=Math.sqrt(y*y+b*b);return[Math.round(1e4*E)?dh(Math.atan2(b,y)*u0):NaN,E,h,S]})(this.rgb))}get lab(){return this.overwriteGetter("lab",Dp(this.rgb))}overwriteGetter(a,h){return Object.defineProperty(this,a,{value:h}),h}toString(){const[a,h,y,b]=this.rgb;return`rgba(${[a,h,y].map((S=>Math.round(255*S))).join(",")},${b})`}static interpolate(a,h,y,b="rgb"){switch(b){case"rgb":{const[S,E,k,F]=ph(a.rgb,h.rgb,y);return new Qi(S,E,k,F,!1)}case"hcl":{const[S,E,k,F]=a.hcl,[V,H,Y,K]=h.hcl;let te,oe;if(isNaN(S)||isNaN(V))isNaN(S)?isNaN(V)?te=NaN:(te=V,k!==1&&k!==0||(oe=H)):(te=S,Y!==1&&Y!==0||(oe=E));else{let we=V-S;V>S&&we>180?we-=360:V<S&&S-V>180&&(we+=360),te=S+y*we}const[le,ue,xe,De]=(function([we,Ee,Ne,Ze]){return we=isNaN(we)?0:we*pu,id([Ne,Math.cos(we)*Ee,Math.sin(we)*Ee,Ze])})([te,oe??lc(E,H,y),lc(k,Y,y),lc(F,K,y)]);return new Qi(le,ue,xe,De,!1)}case"lab":{const[S,E,k,F]=id(ph(a.lab,h.lab,y));return new Qi(S,E,k,F,!1)}}}}Qi.black=new Qi(0,0,0,1),Qi.white=new Qi(1,1,1,1),Qi.transparent=new Qi(0,0,0,0),Qi.red=new Qi(1,0,0,1);class tl{constructor(a,h,y){this.sensitivity=a?h?"variant":"case":h?"accent":"base",this.locale=y,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(a,h){return this.collator.compare(a,h)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const rd=["bottom","center","top"];class gh{constructor(a,h,y,b,S,E){this.text=a,this.image=h,this.scale=y,this.fontStack=b,this.textColor=S,this.verticalAlign=E}}class Ps{constructor(a){this.sections=a}static fromString(a){return new Ps([new gh(a,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((a=>a.text.length!==0||a.image&&a.image.name.length!==0))}static factory(a){return a instanceof Ps?a:Ps.fromString(a)}toString(){return this.sections.length===0?"":this.sections.map((a=>a.text)).join("")}}class hs{constructor(a){this.values=a.slice()}static parse(a){if(a instanceof hs)return a;if(typeof a=="number")return new hs([a,a,a,a]);if(Array.isArray(a)&&!(a.length<1||a.length>4)){for(const h of a)if(typeof h!="number")return;switch(a.length){case 1:a=[a[0],a[0],a[0],a[0]];break;case 2:a=[a[0],a[1],a[0],a[1]];break;case 3:a=[a[0],a[1],a[2],a[1]]}return new hs(a)}}toString(){return JSON.stringify(this.values)}static interpolate(a,h,y){return new hs(ph(a.values,h.values,y))}}class wr{constructor(a){this.values=a.slice()}static parse(a){if(a instanceof wr)return a;if(typeof a=="number")return new wr([a]);if(Array.isArray(a)){for(const h of a)if(typeof h!="number")return;return new wr(a)}}toString(){return JSON.stringify(this.values)}static interpolate(a,h,y){return new wr(ph(a.values,h.values,y))}}class Gi{constructor(a){this.values=a.slice()}static parse(a){if(a instanceof Gi)return a;if(typeof a=="string"){const y=Qi.parse(a);return y?new Gi([y]):void 0}if(!Array.isArray(a))return;const h=[];for(const y of a){if(typeof y!="string")return;const b=Qi.parse(y);if(!b)return;h.push(b)}return new Gi(h)}toString(){return JSON.stringify(this.values)}static interpolate(a,h,y,b="rgb"){const S=[];if(a.values.length!=h.values.length)throw new Error(`colorArray: Arrays have mismatched length (${a.values.length} vs. ${h.values.length}), cannot interpolate.`);for(let E=0;E<a.values.length;E++)S.push(Qi.interpolate(a.values[E],h.values[E],y,b));return new Gi(S)}}class Wn extends Error{constructor(a){super(a),this.name="RuntimeError"}toJSON(){return this.message}}const fs=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class kr{constructor(a){this.values=a.slice()}static parse(a){if(a instanceof kr)return a;if(Array.isArray(a)&&!(a.length<1)&&a.length%2==0){for(let h=0;h<a.length;h+=2){const y=a[h],b=a[h+1];if(typeof y!="string"||!fs.has(y)||!Array.isArray(b)||b.length!==2||typeof b[0]!="number"||typeof b[1]!="number")return}return new kr(a)}}toString(){return JSON.stringify(this.values)}static interpolate(a,h,y){const b=a.values,S=h.values;if(b.length!==S.length)throw new Wn(`Cannot interpolate values of different length. from: ${a.toString()}, to: ${h.toString()}`);const E=[];for(let k=0;k<b.length;k+=2){if(b[k]!==S[k])throw new Wn(`Cannot interpolate values containing mismatched anchors. from[${k}]: ${b[k]}, to[${k}]: ${S[k]}`);E.push(b[k]);const[F,V]=b[k+1],[H,Y]=S[k+1];E.push([lc(F,H,y),lc(V,Y,y)])}return new kr(E)}}class Ta{constructor(a){this.name=a.name,this.available=a.available}toString(){return this.name}static fromString(a){return a?new Ta({name:a,available:!1}):null}}class Is{constructor(a,h,y){this.from=a,this.to=h,this.transition=y}static interpolate(a,h,y){return new Is(a,h,y)}static parse(a){return a instanceof Is?a:Array.isArray(a)&&a.length===3&&typeof a[0]=="string"&&typeof a[1]=="string"&&typeof a[2]=="number"?new Is(a[0],a[1],a[2]):typeof a=="object"&&typeof a.from=="string"&&typeof a.to=="string"&&typeof a.transition=="number"?new Is(a.from,a.to,a.transition):typeof a=="string"?new Is(a,a,1):void 0}}function oo(f,a,h,y){return typeof f=="number"&&f>=0&&f<=255&&typeof a=="number"&&a>=0&&a<=255&&typeof h=="number"&&h>=0&&h<=255?y===void 0||typeof y=="number"&&y>=0&&y<=1?null:`Invalid rgba value [${[f,a,h,y].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof y=="number"?[f,a,h,y]:[f,a,h]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Do(f){if(f===null||typeof f=="string"||typeof f=="boolean"||typeof f=="number"||f instanceof Is||f instanceof Qi||f instanceof tl||f instanceof Ps||f instanceof hs||f instanceof wr||f instanceof Gi||f instanceof kr||f instanceof Ta)return!0;if(Array.isArray(f)){for(const a of f)if(!Do(a))return!1;return!0}if(typeof f=="object"){for(const a in f)if(!Do(f[a]))return!1;return!0}return!1}function Tr(f){if(f===null)return vn;if(typeof f=="string")return Xi;if(typeof f=="boolean")return en;if(typeof f=="number")return ei;if(f instanceof Qi)return ba;if(f instanceof Is)return df;if(f instanceof tl)return Ko;if(f instanceof Ps)return Al;if(f instanceof hs)return rc;if(f instanceof wr)return Ba;if(f instanceof Gi)return wl;if(f instanceof kr)return Bc;if(f instanceof Ta)return cr;if(Array.isArray(f)){const a=f.length;let h;for(const y of f){const b=Tr(y);if(h){if(h===b)continue;h=Yi;break}h=b}return sa(h||Yi,a)}return bl}function za(f){const a=typeof f;return f===null?"":a==="string"||a==="number"||a==="boolean"?String(f):f instanceof Qi||f instanceof Is||f instanceof Ps||f instanceof hs||f instanceof wr||f instanceof Gi||f instanceof kr||f instanceof Ta?f.toString():JSON.stringify(f)}class lo{constructor(a,h){this.type=a,this.value=h}static parse(a,h){if(a.length!==2)return h.error(`'literal' expression requires exactly one argument, but found ${a.length-1} instead.`);if(!Do(a[1]))return h.error("invalid value");const y=a[1];let b=Tr(y);const S=h.expectedType;return b.kind!=="array"||b.N!==0||!S||S.kind!=="array"||typeof S.N=="number"&&S.N!==0||(b=S),new lo(b,y)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const gu={string:Xi,number:ei,boolean:en,object:bl};class Sa{constructor(a,h){this.type=a,this.args=h}static parse(a,h){if(a.length<2)return h.error("Expected at least one argument.");let y,b=1;const S=a[0];if(S==="array"){let k,F;if(a.length>2){const V=a[1];if(typeof V!="string"||!(V in gu)||V==="object")return h.error('The item type argument of "array" must be one of string, number, boolean',1);k=gu[V],b++}else k=Yi;if(a.length>3){if(a[2]!==null&&(typeof a[2]!="number"||a[2]<0||a[2]!==Math.floor(a[2])))return h.error('The length argument to "array" must be a positive integer literal',2);F=a[2],b++}y=sa(k,F)}else{if(!gu[S])throw new Error(`Types doesn't contain name = ${S}`);y=gu[S]}const E=[];for(;b<a.length;b++){const k=h.parse(a[b],b,Yi);if(!k)return null;E.push(k)}return new Sa(y,E)}evaluate(a){for(let h=0;h<this.args.length;h++){const y=this.args[h].evaluate(a);if(!hu(this.type,Tr(y)))return y;if(h===this.args.length-1)throw new Wn(`Expected value to be of type ${En(this.type)}, but found ${En(Tr(y))} instead.`)}throw new Error}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every((a=>a.outputDefined()))}}const bs={"to-boolean":en,"to-color":ba,"to-number":ei,"to-string":Xi};class Ea{constructor(a,h){this.type=a,this.args=h}static parse(a,h){if(a.length<2)return h.error("Expected at least one argument.");const y=a[0];if(!bs[y])throw new Error(`Can't parse ${y} as it is not part of the known types`);if((y==="to-boolean"||y==="to-string")&&a.length!==2)return h.error("Expected one argument.");const b=bs[y],S=[];for(let E=1;E<a.length;E++){const k=h.parse(a[E],E,Yi);if(!k)return null;S.push(k)}return new Ea(b,S)}evaluate(a){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(a);case"color":{let h,y;for(const b of this.args){if(h=b.evaluate(a),y=null,h instanceof Qi)return h;if(typeof h=="string"){const S=a.parseColor(h);if(S)return S}else if(Array.isArray(h)&&(y=h.length<3||h.length>4?`Invalid rgba value ${JSON.stringify(h)}: expected an array containing either three or four numeric values.`:oo(h[0],h[1],h[2],h[3]),!y))return new Qi(h[0]/255,h[1]/255,h[2]/255,h[3])}throw new Wn(y||`Could not parse color from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}case"padding":{let h;for(const y of this.args){h=y.evaluate(a);const b=hs.parse(h);if(b)return b}throw new Wn(`Could not parse padding from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}case"numberArray":{let h;for(const y of this.args){h=y.evaluate(a);const b=wr.parse(h);if(b)return b}throw new Wn(`Could not parse numberArray from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}case"colorArray":{let h;for(const y of this.args){h=y.evaluate(a);const b=Gi.parse(h);if(b)return b}throw new Wn(`Could not parse colorArray from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}case"variableAnchorOffsetCollection":{let h;for(const y of this.args){h=y.evaluate(a);const b=kr.parse(h);if(b)return b}throw new Wn(`Could not parse variableAnchorOffsetCollection from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}case"number":{let h=null;for(const y of this.args){if(h=y.evaluate(a),h===null)return 0;const b=Number(h);if(!isNaN(b))return b}throw new Wn(`Could not convert ${JSON.stringify(h)} to number.`)}case"formatted":return Ps.fromString(za(this.args[0].evaluate(a)));case"resolvedImage":return Ta.fromString(za(this.args[0].evaluate(a)));case"projectionDefinition":return this.args[0].evaluate(a);default:return za(this.args[0].evaluate(a))}}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every((a=>a.outputDefined()))}}const gf=["Unknown","Point","LineString","Polygon"];class mu{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?gf[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(a){let h=this._parseColorCache.get(a);return h||(h=Qi.parse(a),this._parseColorCache.set(a,h)),h}}class _u{constructor(a,h,y=[],b,S=new ts,E=[]){this.registry=a,this.path=y,this.key=y.map((k=>`[${k}]`)).join(""),this.scope=S,this.errors=E,this.expectedType=b,this._isConstant=h}parse(a,h,y,b,S={}){return h?this.concat(h,y,b)._parse(a,S):this._parse(a,S)}_parse(a,h){function y(b,S,E){return E==="assert"?new Sa(S,[b]):E==="coerce"?new Ea(S,[b]):b}if(a!==null&&typeof a!="string"&&typeof a!="boolean"&&typeof a!="number"||(a=["literal",a]),Array.isArray(a)){if(a.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const b=a[0];if(typeof b!="string")return this.error(`Expression name must be a string, but found ${typeof b} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const S=this.registry[b];if(S){let E=S.parse(a,this);if(!E)return null;if(this.expectedType){const k=this.expectedType,F=E.type;if(k.kind!=="string"&&k.kind!=="number"&&k.kind!=="boolean"&&k.kind!=="object"&&k.kind!=="array"||F.kind!=="value"){if(k.kind==="projectionDefinition"&&["string","array"].includes(F.kind)||["color","formatted","resolvedImage"].includes(k.kind)&&["value","string"].includes(F.kind)||["padding","numberArray"].includes(k.kind)&&["value","number","array"].includes(F.kind)||k.kind==="colorArray"&&["value","string","array"].includes(F.kind)||k.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(F.kind))E=y(E,k,h.typeAnnotation||"coerce");else if(this.checkSubtype(k,F))return null}else E=y(E,k,h.typeAnnotation||"assert")}if(!(E instanceof lo)&&E.type.kind!=="resolvedImage"&&this._isConstant(E)){const k=new mu;try{E=new lo(E.type,E.evaluate(k))}catch(F){return this.error(F.message),null}}return E}return this.error(`Unknown expression "${b}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(a===void 0?"'undefined' value invalid. Use null instead.":typeof a=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof a} instead.`)}concat(a,h,y){const b=typeof a=="number"?this.path.concat(a):this.path,S=y?this.scope.concat(y):this.scope;return new _u(this.registry,this._isConstant,b,h||null,S,this.errors)}error(a,...h){const y=`${this.key}${h.map((b=>`[${b}]`)).join("")}`;this.errors.push(new Cs(y,a))}checkSubtype(a,h){const y=hu(a,h);return y&&this.error(y),y}}class $n{constructor(a,h){this.type=h.type,this.bindings=[].concat(a),this.result=h}evaluate(a){return this.result.evaluate(a)}eachChild(a){for(const h of this.bindings)a(h[1]);a(this.result)}static parse(a,h){if(a.length<4)return h.error(`Expected at least 3 arguments, but found ${a.length-1} instead.`);const y=[];for(let S=1;S<a.length-1;S+=2){const E=a[S];if(typeof E!="string")return h.error(`Expected string, but found ${typeof E} instead.`,S);if(/[^a-zA-Z0-9_]/.test(E))return h.error("Variable names must contain only alphanumeric characters or '_'.",S);const k=h.parse(a[S+1],S+1);if(!k)return null;y.push([E,k])}const b=h.parse(a[a.length-1],a.length-1,h.expectedType,y);return b?new $n(y,b):null}outputDefined(){return this.result.outputDefined()}}class Uc{constructor(a,h){this.type=h.type,this.name=a,this.boundExpression=h}static parse(a,h){if(a.length!==2||typeof a[1]!="string")return h.error("'var' expression requires exactly one string literal argument.");const y=a[1];return h.scope.has(y)?new Uc(y,h.scope.get(y)):h.error(`Unknown variable "${y}". Make sure "${y}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(a){return this.boundExpression.evaluate(a)}eachChild(){}outputDefined(){return!1}}class fn{constructor(a,h,y){this.type=a,this.index=h,this.input=y}static parse(a,h){if(a.length!==3)return h.error(`Expected 2 arguments, but found ${a.length-1} instead.`);const y=h.parse(a[1],1,ei),b=h.parse(a[2],2,sa(h.expectedType||Yi));return y&&b?new fn(b.type.itemType,y,b):null}evaluate(a){const h=this.index.evaluate(a),y=this.input.evaluate(a);if(h<0)throw new Wn(`Array index out of bounds: ${h} < 0.`);if(h>=y.length)throw new Wn(`Array index out of bounds: ${h} > ${y.length-1}.`);if(h!==Math.floor(h))throw new Wn(`Array index must be an integer, but found ${h} instead.`);return y[h]}eachChild(a){a(this.index),a(this.input)}outputDefined(){return!1}}class Ki{constructor(a,h){this.type=en,this.needle=a,this.haystack=h}static parse(a,h){if(a.length!==3)return h.error(`Expected 2 arguments, but found ${a.length-1} instead.`);const y=h.parse(a[1],1,Yi),b=h.parse(a[2],2,Yi);return y&&b?fu(y.type,[en,Xi,ei,vn,Yi])?new Ki(y,b):h.error(`Expected first argument to be of type boolean, string, number or null, but found ${En(y.type)} instead`):null}evaluate(a){const h=this.needle.evaluate(a),y=this.haystack.evaluate(a);if(!y)return!1;if(!zc(h,["boolean","string","number","null"]))throw new Wn(`Expected first argument to be of type boolean, string, number or null, but found ${En(Tr(h))} instead.`);if(!zc(y,["string","array"]))throw new Wn(`Expected second argument to be of type array or string, but found ${En(Tr(y))} instead.`);return y.indexOf(h)>=0}eachChild(a){a(this.needle),a(this.haystack)}outputDefined(){return!0}}class yu{constructor(a,h,y){this.type=ei,this.needle=a,this.haystack=h,this.fromIndex=y}static parse(a,h){if(a.length<=2||a.length>=5)return h.error(`Expected 2 or 3 arguments, but found ${a.length-1} instead.`);const y=h.parse(a[1],1,Yi),b=h.parse(a[2],2,Yi);if(!y||!b)return null;if(!fu(y.type,[en,Xi,ei,vn,Yi]))return h.error(`Expected first argument to be of type boolean, string, number or null, but found ${En(y.type)} instead`);if(a.length===4){const S=h.parse(a[3],3,ei);return S?new yu(y,b,S):null}return new yu(y,b)}evaluate(a){const h=this.needle.evaluate(a),y=this.haystack.evaluate(a);if(!zc(h,["boolean","string","number","null"]))throw new Wn(`Expected first argument to be of type boolean, string, number or null, but found ${En(Tr(h))} instead.`);let b;if(this.fromIndex&&(b=this.fromIndex.evaluate(a)),zc(y,["string"])){const S=y.indexOf(h,b);return S===-1?-1:[...y.slice(0,S)].length}if(zc(y,["array"]))return y.indexOf(h,b);throw new Wn(`Expected second argument to be of type array or string, but found ${En(Tr(y))} instead.`)}eachChild(a){a(this.needle),a(this.haystack),this.fromIndex&&a(this.fromIndex)}outputDefined(){return!1}}class Mn{constructor(a,h,y,b,S,E){this.inputType=a,this.type=h,this.input=y,this.cases=b,this.outputs=S,this.otherwise=E}static parse(a,h){if(a.length<5)return h.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if(a.length%2!=1)return h.error("Expected an even number of arguments.");let y,b;h.expectedType&&h.expectedType.kind!=="value"&&(b=h.expectedType);const S={},E=[];for(let V=2;V<a.length-1;V+=2){let H=a[V];const Y=a[V+1];Array.isArray(H)||(H=[H]);const K=h.concat(V);if(H.length===0)return K.error("Expected at least one branch label.");for(const oe of H){if(typeof oe!="number"&&typeof oe!="string")return K.error("Branch labels must be numbers or strings.");if(typeof oe=="number"&&Math.abs(oe)>Number.MAX_SAFE_INTEGER)return K.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof oe=="number"&&Math.floor(oe)!==oe)return K.error("Numeric branch labels must be integer values.");if(y){if(K.checkSubtype(y,Tr(oe)))return null}else y=Tr(oe);if(S[String(oe)]!==void 0)return K.error("Branch labels must be unique.");S[String(oe)]=E.length}const te=h.parse(Y,V,b);if(!te)return null;b=b||te.type,E.push(te)}const k=h.parse(a[1],1,Yi);if(!k)return null;const F=h.parse(a[a.length-1],a.length-1,b);return F?k.type.kind!=="value"&&h.concat(1).checkSubtype(y,k.type)?null:new Mn(y,b,k,S,E,F):null}evaluate(a){const h=this.input.evaluate(a);return(Tr(h)===this.inputType&&this.outputs[this.cases[h]]||this.otherwise).evaluate(a)}eachChild(a){a(this.input),this.outputs.forEach(a),a(this.otherwise)}outputDefined(){return this.outputs.every((a=>a.outputDefined()))&&this.otherwise.outputDefined()}}class mh{constructor(a,h,y){this.type=a,this.branches=h,this.otherwise=y}static parse(a,h){if(a.length<4)return h.error(`Expected at least 3 arguments, but found only ${a.length-1}.`);if(a.length%2!=0)return h.error("Expected an odd number of arguments.");let y;h.expectedType&&h.expectedType.kind!=="value"&&(y=h.expectedType);const b=[];for(let E=1;E<a.length-1;E+=2){const k=h.parse(a[E],E,en);if(!k)return null;const F=h.parse(a[E+1],E+1,y);if(!F)return null;b.push([k,F]),y=y||F.type}const S=h.parse(a[a.length-1],a.length-1,y);if(!S)return null;if(!y)throw new Error("Can't infer output type");return new mh(y,b,S)}evaluate(a){for(const[h,y]of this.branches)if(h.evaluate(a))return y.evaluate(a);return this.otherwise.evaluate(a)}eachChild(a){for(const[h,y]of this.branches)a(h),a(y);a(this.otherwise)}outputDefined(){return this.branches.every((([a,h])=>h.outputDefined()))&&this.otherwise.outputDefined()}}class Oo{constructor(a,h,y,b){this.type=a,this.input=h,this.beginIndex=y,this.endIndex=b}static parse(a,h){if(a.length<=2||a.length>=5)return h.error(`Expected 2 or 3 arguments, but found ${a.length-1} instead.`);const y=h.parse(a[1],1,Yi),b=h.parse(a[2],2,ei);if(!y||!b)return null;if(!fu(y.type,[sa(Yi),Xi,Yi]))return h.error(`Expected first argument to be of type array or string, but found ${En(y.type)} instead`);if(a.length===4){const S=h.parse(a[3],3,ei);return S?new Oo(y.type,y,b,S):null}return new Oo(y.type,y,b)}evaluate(a){const h=this.input.evaluate(a),y=this.beginIndex.evaluate(a);let b;if(this.endIndex&&(b=this.endIndex.evaluate(a)),zc(h,["string"]))return[...h].slice(y,b).join("");if(zc(h,["array"]))return h.slice(y,b);throw new Wn(`Expected first argument to be of type array or string, but found ${En(Tr(h))} instead.`)}eachChild(a){a(this.input),a(this.beginIndex),this.endIndex&&a(this.endIndex)}outputDefined(){return!1}}function Vc(f,a){const h=f.length-1;let y,b,S=0,E=h,k=0;for(;S<=E;)if(k=Math.floor((S+E)/2),y=f[k],b=f[k+1],y<=a){if(k===h||a<b)return k;S=k+1}else{if(!(y>a))throw new Wn("Input is not a number.");E=k-1}return 0}class Ma{constructor(a,h,y){this.type=a,this.input=h,this.labels=[],this.outputs=[];for(const[b,S]of y)this.labels.push(b),this.outputs.push(S)}static parse(a,h){if(a.length-1<4)return h.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if((a.length-1)%2!=0)return h.error("Expected an even number of arguments.");const y=h.parse(a[1],1,ei);if(!y)return null;const b=[];let S=null;h.expectedType&&h.expectedType.kind!=="value"&&(S=h.expectedType);for(let E=1;E<a.length;E+=2){const k=E===1?-1/0:a[E],F=a[E+1],V=E,H=E+1;if(typeof k!="number")return h.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',V);if(b.length&&b[b.length-1][0]>=k)return h.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',V);const Y=h.parse(F,H,S);if(!Y)return null;S=S||Y.type,b.push([k,Y])}return new Ma(S,y,b)}evaluate(a){const h=this.labels,y=this.outputs;if(h.length===1)return y[0].evaluate(a);const b=this.input.evaluate(a);if(b<=h[0])return y[0].evaluate(a);const S=h.length;return b>=h[S-1]?y[S-1].evaluate(a):y[Vc(h,b)].evaluate(a)}eachChild(a){a(this.input);for(const h of this.outputs)a(h)}outputDefined(){return this.outputs.every((a=>a.outputDefined()))}}function Np(f){return f&&f.__esModule&&Object.prototype.hasOwnProperty.call(f,"default")?f.default:f}var mf,xn,_f=(function(){if(xn)return mf;function f(a,h,y,b){this.cx=3*a,this.bx=3*(y-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*h,this.by=3*(b-h)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=h,this.p2x=y,this.p2y=b}return xn=1,mf=f,f.prototype={sampleCurveX:function(a){return((this.ax*a+this.bx)*a+this.cx)*a},sampleCurveY:function(a){return((this.ay*a+this.by)*a+this.cy)*a},sampleCurveDerivativeX:function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},solveCurveX:function(a,h){if(h===void 0&&(h=1e-6),a<0)return 0;if(a>1)return 1;for(var y=a,b=0;b<8;b++){var S=this.sampleCurveX(y)-a;if(Math.abs(S)<h)return y;var E=this.sampleCurveDerivativeX(y);if(Math.abs(E)<1e-6)break;y-=S/E}var k=0,F=1;for(y=a,b=0;b<20&&(S=this.sampleCurveX(y),!(Math.abs(S-a)<h));b++)a>S?k=y:F=y,y=.5*(F-k)+k;return y},solve:function(a,h){return this.sampleCurveY(this.solveCurveX(a,h))}},mf})(),h0=Np(_f);class is{constructor(a,h,y,b,S){this.type=a,this.operator=h,this.interpolation=y,this.input=b,this.labels=[],this.outputs=[];for(const[E,k]of S)this.labels.push(E),this.outputs.push(k)}static interpolationFactor(a,h,y,b){let S=0;if(a.name==="exponential")S=Fo(h,a.base,y,b);else if(a.name==="linear")S=Fo(h,1,y,b);else if(a.name==="cubic-bezier"){const E=a.controlPoints;S=new h0(E[0],E[1],E[2],E[3]).solve(Fo(h,1,y,b))}return S}static parse(a,h){let[y,b,S,...E]=a;if(!Array.isArray(b)||b.length===0)return h.error("Expected an interpolation type expression.",1);if(b[0]==="linear")b={name:"linear"};else if(b[0]==="exponential"){const V=b[1];if(typeof V!="number")return h.error("Exponential interpolation requires a numeric base.",1,1);b={name:"exponential",base:V}}else{if(b[0]!=="cubic-bezier")return h.error(`Unknown interpolation type ${String(b[0])}`,1,0);{const V=b.slice(1);if(V.length!==4||V.some((H=>typeof H!="number"||H<0||H>1)))return h.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);b={name:"cubic-bezier",controlPoints:V}}}if(a.length-1<4)return h.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if((a.length-1)%2!=0)return h.error("Expected an even number of arguments.");if(S=h.parse(S,2,ei),!S)return null;const k=[];let F=null;y!=="interpolate-hcl"&&y!=="interpolate-lab"||h.expectedType==wl?h.expectedType&&h.expectedType.kind!=="value"&&(F=h.expectedType):F=ba;for(let V=0;V<E.length;V+=2){const H=E[V],Y=E[V+1],K=V+3,te=V+4;if(typeof H!="number")return h.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',K);if(k.length&&k[k.length-1][0]>=H)return h.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',K);const oe=h.parse(Y,te,F);if(!oe)return null;F=F||oe.type,k.push([H,oe])}return el(F,ei)||el(F,df)||el(F,ba)||el(F,rc)||el(F,Ba)||el(F,wl)||el(F,Bc)||el(F,sa(ei))?new is(F,y,b,S,k):h.error(`Type ${En(F)} is not interpolatable.`)}evaluate(a){const h=this.labels,y=this.outputs;if(h.length===1)return y[0].evaluate(a);const b=this.input.evaluate(a);if(b<=h[0])return y[0].evaluate(a);const S=h.length;if(b>=h[S-1])return y[S-1].evaluate(a);const E=Vc(h,b),k=is.interpolationFactor(this.interpolation,b,h[E],h[E+1]),F=y[E].evaluate(a),V=y[E+1].evaluate(a);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return lc(F,V,k);case"color":return Qi.interpolate(F,V,k);case"padding":return hs.interpolate(F,V,k);case"colorArray":return Gi.interpolate(F,V,k);case"numberArray":return wr.interpolate(F,V,k);case"variableAnchorOffsetCollection":return kr.interpolate(F,V,k);case"array":return ph(F,V,k);case"projectionDefinition":return Is.interpolate(F,V,k)}case"interpolate-hcl":switch(this.type.kind){case"color":return Qi.interpolate(F,V,k,"hcl");case"colorArray":return Gi.interpolate(F,V,k,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return Qi.interpolate(F,V,k,"lab");case"colorArray":return Gi.interpolate(F,V,k,"lab")}}}eachChild(a){a(this.input);for(const h of this.outputs)a(h)}outputDefined(){return this.outputs.every((a=>a.outputDefined()))}}function Fo(f,a,h,y){const b=y-h,S=f-h;return b===0?0:a===1?S/b:(Math.pow(a,S)-1)/(Math.pow(a,b)-1)}const Sr={color:Qi.interpolate,number:lc,padding:hs.interpolate,numberArray:wr.interpolate,colorArray:Gi.interpolate,variableAnchorOffsetCollection:kr.interpolate,array:ph};class vu{constructor(a,h){this.type=a,this.args=h}static parse(a,h){if(a.length<2)return h.error("Expected at least one argument.");let y=null;const b=h.expectedType;b&&b.kind!=="value"&&(y=b);const S=[];for(const k of a.slice(1)){const F=h.parse(k,1+S.length,y,void 0,{typeAnnotation:"omit"});if(!F)return null;y=y||F.type,S.push(F)}if(!y)throw new Error("No output type");const E=b&&S.some((k=>hu(b,k.type)));return new vu(E?Yi:y,S)}evaluate(a){let h,y=null,b=0;for(const S of this.args)if(b++,y=S.evaluate(a),y&&y instanceof Ta&&!y.available&&(h||(h=y.name),y=null,b===this.args.length&&(y=h)),y!==null)break;return y}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every((a=>a.outputDefined()))}}function xu(f,a){return f==="=="||f==="!="?a.kind==="boolean"||a.kind==="string"||a.kind==="number"||a.kind==="null"||a.kind==="value":a.kind==="string"||a.kind==="number"||a.kind==="value"}function _h(f,a,h,y){return y.compare(a,h)===0}function Dr(f,a,h){const y=f!=="=="&&f!=="!=";return class OE{constructor(S,E,k){this.type=en,this.lhs=S,this.rhs=E,this.collator=k,this.hasUntypedArgument=S.type.kind==="value"||E.type.kind==="value"}static parse(S,E){if(S.length!==3&&S.length!==4)return E.error("Expected two or three arguments.");const k=S[0];let F=E.parse(S[1],1,Yi);if(!F)return null;if(!xu(k,F.type))return E.concat(1).error(`"${k}" comparisons are not supported for type '${En(F.type)}'.`);let V=E.parse(S[2],2,Yi);if(!V)return null;if(!xu(k,V.type))return E.concat(2).error(`"${k}" comparisons are not supported for type '${En(V.type)}'.`);if(F.type.kind!==V.type.kind&&F.type.kind!=="value"&&V.type.kind!=="value")return E.error(`Cannot compare types '${En(F.type)}' and '${En(V.type)}'.`);y&&(F.type.kind==="value"&&V.type.kind!=="value"?F=new Sa(V.type,[F]):F.type.kind!=="value"&&V.type.kind==="value"&&(V=new Sa(F.type,[V])));let H=null;if(S.length===4){if(F.type.kind!=="string"&&V.type.kind!=="string"&&F.type.kind!=="value"&&V.type.kind!=="value")return E.error("Cannot use collator to compare non-string types.");if(H=E.parse(S[3],3,Ko),!H)return null}return new OE(F,V,H)}evaluate(S){const E=this.lhs.evaluate(S),k=this.rhs.evaluate(S);if(y&&this.hasUntypedArgument){const F=Tr(E),V=Tr(k);if(F.kind!==V.kind||F.kind!=="string"&&F.kind!=="number")throw new Wn(`Expected arguments for "${f}" to be (string, string) or (number, number), but found (${F.kind}, ${V.kind}) instead.`)}if(this.collator&&!y&&this.hasUntypedArgument){const F=Tr(E),V=Tr(k);if(F.kind!=="string"||V.kind!=="string")return a(S,E,k)}return this.collator?h(S,E,k,this.collator.evaluate(S)):a(S,E,k)}eachChild(S){S(this.lhs),S(this.rhs),this.collator&&S(this.collator)}outputDefined(){return!0}}}const f0=Dr("==",(function(f,a,h){return a===h}),_h),bu=Dr("!=",(function(f,a,h){return a!==h}),(function(f,a,h,y){return!_h(0,a,h,y)})),Bp=Dr("<",(function(f,a,h){return a<h}),(function(f,a,h,y){return y.compare(a,h)<0})),d0=Dr(">",(function(f,a,h){return a>h}),(function(f,a,h,y){return y.compare(a,h)>0})),ye=Dr("<=",(function(f,a,h){return a<=h}),(function(f,a,h,y){return y.compare(a,h)<=0})),me=Dr(">=",(function(f,a,h){return a>=h}),(function(f,a,h,y){return y.compare(a,h)>=0}));class Ve{constructor(a,h,y){this.type=Ko,this.locale=y,this.caseSensitive=a,this.diacriticSensitive=h}static parse(a,h){if(a.length!==2)return h.error("Expected one argument.");const y=a[1];if(typeof y!="object"||Array.isArray(y))return h.error("Collator options argument must be an object.");const b=h.parse(y["case-sensitive"]!==void 0&&y["case-sensitive"],1,en);if(!b)return null;const S=h.parse(y["diacritic-sensitive"]!==void 0&&y["diacritic-sensitive"],1,en);if(!S)return null;let E=null;return y.locale&&(E=h.parse(y.locale,1,Xi),!E)?null:new Ve(b,S,E)}evaluate(a){return new tl(this.caseSensitive.evaluate(a),this.diacriticSensitive.evaluate(a),this.locale?this.locale.evaluate(a):null)}eachChild(a){a(this.caseSensitive),a(this.diacriticSensitive),this.locale&&a(this.locale)}outputDefined(){return!1}}class Z{constructor(a,h,y,b,S){this.type=Xi,this.number=a,this.locale=h,this.currency=y,this.minFractionDigits=b,this.maxFractionDigits=S}static parse(a,h){if(a.length!==3)return h.error("Expected two arguments.");const y=h.parse(a[1],1,ei);if(!y)return null;const b=a[2];if(typeof b!="object"||Array.isArray(b))return h.error("NumberFormat options argument must be an object.");let S=null;if(b.locale&&(S=h.parse(b.locale,1,Xi),!S))return null;let E=null;if(b.currency&&(E=h.parse(b.currency,1,Xi),!E))return null;let k=null;if(b["min-fraction-digits"]&&(k=h.parse(b["min-fraction-digits"],1,ei),!k))return null;let F=null;return b["max-fraction-digits"]&&(F=h.parse(b["max-fraction-digits"],1,ei),!F)?null:new Z(y,S,E,k,F)}evaluate(a){return new Intl.NumberFormat(this.locale?this.locale.evaluate(a):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(a):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(a):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(a):void 0}).format(this.number.evaluate(a))}eachChild(a){a(this.number),this.locale&&a(this.locale),this.currency&&a(this.currency),this.minFractionDigits&&a(this.minFractionDigits),this.maxFractionDigits&&a(this.maxFractionDigits)}outputDefined(){return!1}}class mt{constructor(a){this.type=Al,this.sections=a}static parse(a,h){if(a.length<2)return h.error("Expected at least one argument.");const y=a[1];if(!Array.isArray(y)&&typeof y=="object")return h.error("First argument must be an image or text section.");const b=[];let S=!1;for(let E=1;E<=a.length-1;++E){const k=a[E];if(S&&typeof k=="object"&&!Array.isArray(k)){S=!1;let F=null;if(k["font-scale"]&&(F=h.parse(k["font-scale"],1,ei),!F))return null;let V=null;if(k["text-font"]&&(V=h.parse(k["text-font"],1,sa(Xi)),!V))return null;let H=null;if(k["text-color"]&&(H=h.parse(k["text-color"],1,ba),!H))return null;let Y=null;if(k["vertical-align"]){if(typeof k["vertical-align"]=="string"&&!rd.includes(k["vertical-align"]))return h.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${k["vertical-align"]}' instead.`);if(Y=h.parse(k["vertical-align"],1,Xi),!Y)return null}const K=b[b.length-1];K.scale=F,K.font=V,K.textColor=H,K.verticalAlign=Y}else{const F=h.parse(a[E],1,Yi);if(!F)return null;const V=F.type.kind;if(V!=="string"&&V!=="value"&&V!=="null"&&V!=="resolvedImage")return h.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");S=!0,b.push({content:F,scale:null,font:null,textColor:null,verticalAlign:null})}}return new mt(b)}evaluate(a){return new Ps(this.sections.map((h=>{const y=h.content.evaluate(a);return Tr(y)===cr?new gh("",y,null,null,null,h.verticalAlign?h.verticalAlign.evaluate(a):null):new gh(za(y),null,h.scale?h.scale.evaluate(a):null,h.font?h.font.evaluate(a).join(","):null,h.textColor?h.textColor.evaluate(a):null,h.verticalAlign?h.verticalAlign.evaluate(a):null)})))}eachChild(a){for(const h of this.sections)a(h.content),h.scale&&a(h.scale),h.font&&a(h.font),h.textColor&&a(h.textColor),h.verticalAlign&&a(h.verticalAlign)}outputDefined(){return!1}}class c{constructor(a){this.type=cr,this.input=a}static parse(a,h){if(a.length!==2)return h.error("Expected two arguments.");const y=h.parse(a[1],1,Xi);return y?new c(y):h.error("No image name provided.")}evaluate(a){const h=this.input.evaluate(a),y=Ta.fromString(h);return y&&a.availableImages&&(y.available=a.availableImages.indexOf(h)>-1),y}eachChild(a){a(this.input)}outputDefined(){return!1}}class Re{constructor(a){this.type=ei,this.input=a}static parse(a,h){if(a.length!==2)return h.error(`Expected 1 argument, but found ${a.length-1} instead.`);const y=h.parse(a[1],1);return y?y.type.kind!=="array"&&y.type.kind!=="string"&&y.type.kind!=="value"?h.error(`Expected argument of type string or array, but found ${En(y.type)} instead.`):new Re(y):null}evaluate(a){const h=this.input.evaluate(a);if(typeof h=="string")return[...h].length;if(Array.isArray(h))return h.length;throw new Wn(`Expected value to be of type string or array, but found ${En(Tr(h))} instead.`)}eachChild(a){a(this.input)}outputDefined(){return!1}}const Ft=8192;function ci(f,a){const h=(180+f[0])/360,y=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+f[1]*Math.PI/360)))/360,b=Math.pow(2,a.z);return[Math.round(h*b*Ft),Math.round(y*b*Ft)]}function si(f,a){const h=Math.pow(2,a.z);return[(b=(f[0]/Ft+a.x)/h,360*b-180),(y=(f[1]/Ft+a.y)/h,360/Math.PI*Math.atan(Math.exp((180-360*y)*Math.PI/180))-90)];var y,b}function dt(f,a){f[0]=Math.min(f[0],a[0]),f[1]=Math.min(f[1],a[1]),f[2]=Math.max(f[2],a[0]),f[3]=Math.max(f[3],a[1])}function mn(f,a){return!(f[0]<=a[0]||f[2]>=a[2]||f[1]<=a[1]||f[3]>=a[3])}function or(f,a,h){const y=f[0]-a[0],b=f[1]-a[1],S=f[0]-h[0],E=f[1]-h[1];return y*E-S*b==0&&y*S<=0&&b*E<=0}function ur(f,a,h,y){return(b=[y[0]-h[0],y[1]-h[1]])[0]*(S=[a[0]-f[0],a[1]-f[1]])[1]-b[1]*S[0]!=0&&!(!pn(f,a,h,y)||!pn(h,y,f,a));var b,S}function Us(f,a,h){for(const y of h)for(let b=0;b<y.length-1;++b)if(ur(f,a,y[b],y[b+1]))return!0;return!1}function Or(f,a,h=!1){let y=!1;for(const k of a)for(let F=0;F<k.length-1;F++){if(or(f,k[F],k[F+1]))return h;(S=k[F])[1]>(b=f)[1]!=(E=k[F+1])[1]>b[1]&&b[0]<(E[0]-S[0])*(b[1]-S[1])/(E[1]-S[1])+S[0]&&(y=!y)}var b,S,E;return y}function La(f,a){for(const h of a)if(Or(f,h))return!0;return!1}function jc(f,a){for(const h of f)if(!Or(h,a))return!1;for(let h=0;h<f.length-1;++h)if(Us(f[h],f[h+1],a))return!1;return!0}function yf(f,a){for(const h of a)if(jc(f,h))return!0;return!1}function pn(f,a,h,y){const b=y[0]-h[0],S=y[1]-h[1],E=(f[0]-h[0])*S-b*(f[1]-h[1]),k=(a[0]-h[0])*S-b*(a[1]-h[1]);return E>0&&k<0||E<0&&k>0}function No(f,a,h){const y=[];for(let b=0;b<f.length;b++){const S=[];for(let E=0;E<f[b].length;E++){const k=ci(f[b][E],h);dt(a,k),S.push(k)}y.push(S)}return y}function ds(f,a,h){const y=[];for(let b=0;b<f.length;b++){const S=No(f[b],a,h);y.push(S)}return y}function Ln(f,a,h,y){if(f[0]<h[0]||f[0]>h[2]){const b=.5*y;let S=f[0]-h[0]>b?-y:h[0]-f[0]>b?y:0;S===0&&(S=f[0]-h[2]>b?-y:h[2]-f[0]>b?y:0),f[0]+=S}dt(a,f)}function Dn(f,a,h,y){const b=Math.pow(2,y.z)*Ft,S=[y.x*Ft,y.y*Ft],E=[];for(const k of f)for(const F of k){const V=[F.x+S[0],F.y+S[1]];Ln(V,a,h,b),E.push(V)}return E}function Zn(f,a,h,y){const b=Math.pow(2,y.z)*Ft,S=[y.x*Ft,y.y*Ft],E=[];for(const F of f){const V=[];for(const H of F){const Y=[H.x+S[0],H.y+S[1]];dt(a,Y),V.push(Y)}E.push(V)}if(a[2]-a[0]<=b/2){(k=a)[0]=k[1]=1/0,k[2]=k[3]=-1/0;for(const F of E)for(const V of F)Ln(V,a,h,b)}var k;return E}class Gc{constructor(a,h){this.type=en,this.geojson=a,this.geometries=h}static parse(a,h){if(a.length!==2)return h.error(`'within' expression requires exactly one argument, but found ${a.length-1} instead.`);if(Do(a[1])){const y=a[1];if(y.type==="FeatureCollection"){const b=[];for(const S of y.features){const{type:E,coordinates:k}=S.geometry;E==="Polygon"&&b.push(k),E==="MultiPolygon"&&b.push(...k)}if(b.length)return new Gc(y,{type:"MultiPolygon",coordinates:b})}else if(y.type==="Feature"){const b=y.geometry.type;if(b==="Polygon"||b==="MultiPolygon")return new Gc(y,y.geometry)}else if(y.type==="Polygon"||y.type==="MultiPolygon")return new Gc(y,y)}return h.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(a){if(a.geometry()!=null&&a.canonicalID()!=null){if(a.geometryType()==="Point")return(function(h,y){const b=[1/0,1/0,-1/0,-1/0],S=[1/0,1/0,-1/0,-1/0],E=h.canonicalID();if(y.type==="Polygon"){const k=No(y.coordinates,S,E),F=Dn(h.geometry(),b,S,E);if(!mn(b,S))return!1;for(const V of F)if(!Or(V,k))return!1}if(y.type==="MultiPolygon"){const k=ds(y.coordinates,S,E),F=Dn(h.geometry(),b,S,E);if(!mn(b,S))return!1;for(const V of F)if(!La(V,k))return!1}return!0})(a,this.geometries);if(a.geometryType()==="LineString")return(function(h,y){const b=[1/0,1/0,-1/0,-1/0],S=[1/0,1/0,-1/0,-1/0],E=h.canonicalID();if(y.type==="Polygon"){const k=No(y.coordinates,S,E),F=Zn(h.geometry(),b,S,E);if(!mn(b,S))return!1;for(const V of F)if(!jc(V,k))return!1}if(y.type==="MultiPolygon"){const k=ds(y.coordinates,S,E),F=Zn(h.geometry(),b,S,E);if(!mn(b,S))return!1;for(const V of F)if(!yf(V,k))return!1}return!0})(a,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let ir=class{constructor(f=[],a=(h,y)=>h<y?-1:h>y?1:0){if(this.data=f,this.length=this.data.length,this.compare=a,this.length>0)for(let h=(this.length>>1)-1;h>=0;h--)this._down(h)}push(f){this.data.push(f),this._up(this.length++)}pop(){if(this.length===0)return;const f=this.data[0],a=this.data.pop();return--this.length>0&&(this.data[0]=a,this._down(0)),f}peek(){return this.data[0]}_up(f){const{data:a,compare:h}=this,y=a[f];for(;f>0;){const b=f-1>>1,S=a[b];if(h(y,S)>=0)break;a[f]=S,f=b}a[f]=y}_down(f){const{data:a,compare:h}=this,y=this.length>>1,b=a[f];for(;f<y;){let S=1+(f<<1);const E=S+1;if(E<this.length&&h(a[E],a[S])<0&&(S=E),h(a[S],b)>=0)break;a[f]=a[S],f=S}a[f]=b}};function vf(f,a,h=0,y=f.length-1,b=zp){for(;y>h;){if(y-h>600){const F=y-h+1,V=a-h+1,H=Math.log(F),Y=.5*Math.exp(2*H/3),K=.5*Math.sqrt(H*Y*(F-Y)/F)*(V-F/2<0?-1:1);vf(f,a,Math.max(h,Math.floor(a-V*Y/F+K)),Math.min(y,Math.floor(a+(F-V)*Y/F+K)),b)}const S=f[a];let E=h,k=y;for(Au(f,h,a),b(f[y],S)>0&&Au(f,h,y);E<k;){for(Au(f,E,k),E++,k--;b(f[E],S)<0;)E++;for(;b(f[k],S)>0;)k--}b(f[h],S)===0?Au(f,h,k):(k++,Au(f,k,y)),k<=a&&(h=k+1),a<=k&&(y=k-1)}}function Au(f,a,h){const y=f[a];f[a]=f[h],f[h]=y}function zp(f,a){return f<a?-1:f>a?1:0}function sd(f,a){if(f.length<=1)return[f];const h=[];let y,b;for(const S of f){const E=Up(S);E!==0&&(S.area=Math.abs(E),b===void 0&&(b=E<0),b===E<0?(y&&h.push(y),y=[S]):y.push(S))}if(y&&h.push(y),a>1)for(let S=0;S<h.length;S++)h[S].length<=a||(vf(h[S],a,1,h[S].length-1,Lp),h[S]=h[S].slice(0,a));return h}function Lp(f,a){return a.area-f.area}function Up(f){let a=0;for(let h,y,b=0,S=f.length,E=S-1;b<S;E=b++)h=f[b],y=f[E],a+=(y.x-h.x)*(h.y+y.y);return a}const p0=1/298.257223563,Sl=p0*(2-p0),Vp=Math.PI/180;class ad{constructor(a){const h=6378.137*Vp*1e3,y=Math.cos(a*Vp),b=1/(1-Sl*(1-y*y)),S=Math.sqrt(b);this.kx=h*S*y,this.ky=h*S*b*(1-Sl)}distance(a,h){const y=this.wrap(a[0]-h[0])*this.kx,b=(a[1]-h[1])*this.ky;return Math.sqrt(y*y+b*b)}pointOnLine(a,h){let y,b,S,E,k=1/0;for(let F=0;F<a.length-1;F++){let V=a[F][0],H=a[F][1],Y=this.wrap(a[F+1][0]-V)*this.kx,K=(a[F+1][1]-H)*this.ky,te=0;Y===0&&K===0||(te=(this.wrap(h[0]-V)*this.kx*Y+(h[1]-H)*this.ky*K)/(Y*Y+K*K),te>1?(V=a[F+1][0],H=a[F+1][1]):te>0&&(V+=Y/this.kx*te,H+=K/this.ky*te)),Y=this.wrap(h[0]-V)*this.kx,K=(h[1]-H)*this.ky;const oe=Y*Y+K*K;oe<k&&(k=oe,y=V,b=H,S=F,E=te)}return{point:[y,b],index:S,t:Math.max(0,Math.min(1,E))}}wrap(a){for(;a<-180;)a+=360;for(;a>180;)a-=360;return a}}function ns(f,a){return a[0]-f[0]}function ks(f){return f[1]-f[0]+1}function co(f,a){return f[1]>=f[0]&&f[1]<a}function wu(f,a){if(f[0]>f[1])return[null,null];const h=ks(f);if(a){if(h===2)return[f,null];const b=Math.floor(h/2);return[[f[0],f[0]+b],[f[0]+b,f[1]]]}if(h===1)return[f,null];const y=Math.floor(h/2)-1;return[[f[0],f[0]+y],[f[0]+y+1,f[1]]]}function od(f,a){if(!co(a,f.length))return[1/0,1/0,-1/0,-1/0];const h=[1/0,1/0,-1/0,-1/0];for(let y=a[0];y<=a[1];++y)dt(h,f[y]);return h}function g0(f){const a=[1/0,1/0,-1/0,-1/0];for(const h of f)for(const y of h)dt(a,y);return a}function ld(f){return f[0]!==-1/0&&f[1]!==-1/0&&f[2]!==1/0&&f[3]!==1/0}function cd(f,a,h){if(!ld(f)||!ld(a))return NaN;let y=0,b=0;return f[2]<a[0]&&(y=a[0]-f[2]),f[0]>a[2]&&(y=f[0]-a[2]),f[1]>a[3]&&(b=f[1]-a[3]),f[3]<a[1]&&(b=a[1]-f[3]),h.distance([0,0],[y,b])}function il(f,a,h){const y=h.pointOnLine(a,f);return h.distance(f,y.point)}function xf(f,a,h,y,b){const S=Math.min(il(f,[h,y],b),il(a,[h,y],b)),E=Math.min(il(h,[f,a],b),il(y,[f,a],b));return Math.min(S,E)}function bf(f,a,h,y,b){if(!co(a,f.length)||!co(y,h.length))return 1/0;let S=1/0;for(let E=a[0];E<a[1];++E){const k=f[E],F=f[E+1];for(let V=y[0];V<y[1];++V){const H=h[V],Y=h[V+1];if(ur(k,F,H,Y))return 0;S=Math.min(S,xf(k,F,H,Y,b))}}return S}function ud(f,a,h,y,b){if(!co(a,f.length)||!co(y,h.length))return NaN;let S=1/0;for(let E=a[0];E<=a[1];++E)for(let k=y[0];k<=y[1];++k)if(S=Math.min(S,b.distance(f[E],h[k])),S===0)return S;return S}function m0(f,a,h){if(Or(f,a,!0))return 0;let y=1/0;for(const b of a){const S=b[0],E=b[b.length-1];if(S!==E&&(y=Math.min(y,il(f,[E,S],h)),y===0))return y;const k=h.pointOnLine(b,f);if(y=Math.min(y,h.distance(f,k.point)),y===0)return y}return y}function ee(f,a,h,y){if(!co(a,f.length))return NaN;for(let S=a[0];S<=a[1];++S)if(Or(f[S],h,!0))return 0;let b=1/0;for(let S=a[0];S<a[1];++S){const E=f[S],k=f[S+1];for(const F of h)for(let V=0,H=F.length,Y=H-1;V<H;Y=V++){const K=F[Y],te=F[V];if(ur(E,k,K,te))return 0;b=Math.min(b,xf(E,k,K,te,y))}}return b}function yh(f,a){for(const h of f)for(const y of h)if(Or(y,a,!0))return!0;return!1}function jp(f,a,h,y=1/0){const b=g0(f),S=g0(a);if(y!==1/0&&cd(b,S,h)>=y)return y;if(mn(b,S)){if(yh(f,a))return 0}else if(yh(a,f))return 0;let E=1/0;for(const k of f)for(let F=0,V=k.length,H=V-1;F<V;H=F++){const Y=k[H],K=k[F];for(const te of a)for(let oe=0,le=te.length,ue=le-1;oe<le;ue=oe++){const xe=te[ue],De=te[oe];if(ur(Y,K,xe,De))return 0;E=Math.min(E,xf(Y,K,xe,De,h))}}return E}function On(f,a,h,y,b,S){if(!S)return;const E=cd(od(y,S),b,h);E<a&&f.push([E,S,[0,0]])}function El(f,a,h,y,b,S,E){if(!S||!E)return;const k=cd(od(y,S),od(b,E),h);k<a&&f.push([k,S,E])}function Af(f,a,h,y,b=1/0){let S=Math.min(y.distance(f[0],h[0][0]),b);if(S===0)return S;const E=new ir([[0,[0,f.length-1],[0,0]]],ns),k=g0(h);for(;E.length>0;){const F=E.pop();if(F[0]>=S)continue;const V=F[1],H=a?50:100;if(ks(V)<=H){if(!co(V,f.length))return NaN;if(a){const Y=ee(f,V,h,y);if(isNaN(Y)||Y===0)return Y;S=Math.min(S,Y)}else for(let Y=V[0];Y<=V[1];++Y){const K=m0(f[Y],h,y);if(S=Math.min(S,K),S===0)return 0}}else{const Y=wu(V,a);On(E,S,y,f,k,Y[0]),On(E,S,y,f,k,Y[1])}}return S}function wf(f,a,h,y,b,S=1/0){let E=Math.min(S,b.distance(f[0],h[0]));if(E===0)return E;const k=new ir([[0,[0,f.length-1],[0,h.length-1]]],ns);for(;k.length>0;){const F=k.pop();if(F[0]>=E)continue;const V=F[1],H=F[2],Y=a?50:100,K=y?50:100;if(ks(V)<=Y&&ks(H)<=K){if(!co(V,f.length)&&co(H,h.length))return NaN;let te;if(a&&y)te=bf(f,V,h,H,b),E=Math.min(E,te);else if(a&&!y){const oe=f.slice(V[0],V[1]+1);for(let le=H[0];le<=H[1];++le)if(te=il(h[le],oe,b),E=Math.min(E,te),E===0)return E}else if(!a&&y){const oe=h.slice(H[0],H[1]+1);for(let le=V[0];le<=V[1];++le)if(te=il(f[le],oe,b),E=Math.min(E,te),E===0)return E}else te=ud(f,V,h,H,b),E=Math.min(E,te)}else{const te=wu(V,a),oe=wu(H,y);El(k,E,b,f,h,te[0],oe[0]),El(k,E,b,f,h,te[0],oe[1]),El(k,E,b,f,h,te[1],oe[0]),El(k,E,b,f,h,te[1],oe[1])}}return E}function hd(f){return f.type==="MultiPolygon"?f.coordinates.map((a=>({type:"Polygon",coordinates:a}))):f.type==="MultiLineString"?f.coordinates.map((a=>({type:"LineString",coordinates:a}))):f.type==="MultiPoint"?f.coordinates.map((a=>({type:"Point",coordinates:a}))):[f]}class Tu{constructor(a,h){this.type=ei,this.geojson=a,this.geometries=h}static parse(a,h){if(a.length!==2)return h.error(`'distance' expression requires exactly one argument, but found ${a.length-1} instead.`);if(Do(a[1])){const y=a[1];if(y.type==="FeatureCollection")return new Tu(y,y.features.map((b=>hd(b.geometry))).flat());if(y.type==="Feature")return new Tu(y,hd(y.geometry));if("type"in y&&"coordinates"in y)return new Tu(y,hd(y))}return h.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(a){if(a.geometry()!=null&&a.canonicalID()!=null){if(a.geometryType()==="Point")return(function(h,y){const b=h.geometry(),S=b.flat().map((F=>si([F.x,F.y],h.canonical)));if(b.length===0)return NaN;const E=new ad(S[0][1]);let k=1/0;for(const F of y){switch(F.type){case"Point":k=Math.min(k,wf(S,!1,[F.coordinates],!1,E,k));break;case"LineString":k=Math.min(k,wf(S,!1,F.coordinates,!0,E,k));break;case"Polygon":k=Math.min(k,Af(S,!1,F.coordinates,E,k))}if(k===0)return k}return k})(a,this.geometries);if(a.geometryType()==="LineString")return(function(h,y){const b=h.geometry(),S=b.flat().map((F=>si([F.x,F.y],h.canonical)));if(b.length===0)return NaN;const E=new ad(S[0][1]);let k=1/0;for(const F of y){switch(F.type){case"Point":k=Math.min(k,wf(S,!0,[F.coordinates],!1,E,k));break;case"LineString":k=Math.min(k,wf(S,!0,F.coordinates,!0,E,k));break;case"Polygon":k=Math.min(k,Af(S,!0,F.coordinates,E,k))}if(k===0)return k}return k})(a,this.geometries);if(a.geometryType()==="Polygon")return(function(h,y){const b=h.geometry();if(b.length===0||b[0].length===0)return NaN;const S=sd(b,0).map((F=>F.map((V=>V.map((H=>si([H.x,H.y],h.canonical))))))),E=new ad(S[0][0][0][1]);let k=1/0;for(const F of y)for(const V of S){switch(F.type){case"Point":k=Math.min(k,Af([F.coordinates],!1,V,E,k));break;case"LineString":k=Math.min(k,Af(F.coordinates,!0,V,E,k));break;case"Polygon":k=Math.min(k,jp(V,F.coordinates,E,k))}if(k===0)return k}return k})(a,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class Tf{constructor(a){this.type=Yi,this.key=a}static parse(a,h){if(a.length!==2)return h.error(`Expected 1 argument, but found ${a.length-1} instead.`);const y=a[1];return y==null?h.error("Global state property must be defined."):typeof y!="string"?h.error(`Global state property must be string, but found ${typeof a[1]} instead.`):new Tf(y)}evaluate(a){var h;const y=(h=a.globals)===null||h===void 0?void 0:h.globalState;return y&&Object.keys(y).length!==0?ac(y,this.key):null}eachChild(){}outputDefined(){return!1}}const vh={"==":f0,"!=":bu,">":d0,"<":Bp,">=":me,"<=":ye,array:Sa,at:fn,boolean:Sa,case:mh,coalesce:vu,collator:Ve,format:mt,image:c,in:Ki,"index-of":yu,interpolate:is,"interpolate-hcl":is,"interpolate-lab":is,length:Re,let:$n,literal:lo,match:Mn,number:Sa,"number-format":Z,object:Sa,slice:Oo,step:Ma,string:Sa,"to-boolean":Ea,"to-color":Ea,"to-number":Ea,"to-string":Ea,var:Uc,within:Gc,distance:Tu,"global-state":Tf};class uo{constructor(a,h,y,b){this.name=a,this.type=h,this._evaluate=y,this.args=b}evaluate(a){return this._evaluate(a,this.args)}eachChild(a){this.args.forEach(a)}outputDefined(){return!1}static parse(a,h){const y=a[0],b=uo.definitions[y];if(!b)return h.error(`Unknown expression "${y}". If you wanted a literal array, use ["literal", [...]].`,0);const S=Array.isArray(b)?b[0]:b.type,E=Array.isArray(b)?[[b[1],b[2]]]:b.overloads,k=E.filter((([V])=>!Array.isArray(V)||V.length===a.length-1));let F=null;for(const[V,H]of k){F=new _u(h.registry,Ra,h.path,null,h.scope);const Y=[];let K=!1;for(let te=1;te<a.length;te++){const oe=a[te],le=Array.isArray(V)?V[te-1]:V.type,ue=F.parse(oe,1+Y.length,le);if(!ue){K=!0;break}Y.push(ue)}if(!K)if(Array.isArray(V)&&V.length!==Y.length)F.error(`Expected ${V.length} arguments, but found ${Y.length} instead.`);else{for(let te=0;te<Y.length;te++){const oe=Array.isArray(V)?V[te]:V.type,le=Y[te];F.concat(te+1).checkSubtype(oe,le.type)}if(F.errors.length===0)return new uo(y,S,H,Y)}}if(k.length===1)h.errors.push(...F.errors);else{const V=(k.length?k:E).map((([Y])=>{return K=Y,Array.isArray(K)?`(${K.map(En).join(", ")})`:`(${En(K.type)}...)`;var K})).join(" | "),H=[];for(let Y=1;Y<a.length;Y++){const K=h.parse(a[Y],1+H.length);if(!K)return null;H.push(En(K.type))}h.error(`Expected arguments of type ${V}, but found (${H.join(", ")}) instead.`)}return null}static register(a,h){uo.definitions=h;for(const y in h)a[y]=uo}}function _0(f,[a,h,y,b]){a=a.evaluate(f),h=h.evaluate(f),y=y.evaluate(f);const S=b?b.evaluate(f):1,E=oo(a,h,y,S);if(E)throw new Wn(E);return new Qi(a/255,h/255,y/255,S,!1)}function fd(f,a){return f in a}function ho(f,a){const h=a[f];return h===void 0?null:h}function Ml(f){return{type:f}}function Ra(f){if(f instanceof Uc)return Ra(f.boundExpression);if(f instanceof uo&&f.name==="error"||f instanceof Ve||f instanceof Gc||f instanceof Tu||f instanceof Tf)return!1;const a=f instanceof Ea||f instanceof Sa;let h=!0;return f.eachChild((y=>{h=a?h&&Ra(y):h&&y instanceof lo})),!!h&&nl(f)&&xh(f,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function nl(f){if(f instanceof uo&&(f.name==="get"&&f.args.length===1||f.name==="feature-state"||f.name==="has"&&f.args.length===1||f.name==="properties"||f.name==="geometry-type"||f.name==="id"||/^filter-/.test(f.name))||f instanceof Gc||f instanceof Tu)return!1;let a=!0;return f.eachChild((h=>{a&&!nl(h)&&(a=!1)})),a}function Su(f){if(f instanceof uo&&f.name==="feature-state")return!1;let a=!0;return f.eachChild((h=>{a&&!Su(h)&&(a=!1)})),a}function xh(f,a){if(f instanceof uo&&a.indexOf(f.name)>=0)return!1;let h=!0;return f.eachChild((y=>{h&&!xh(y,a)&&(h=!1)})),h}function Sf(f){return{result:"success",value:f}}function Wc(f){return{result:"error",value:f}}function Bo(f){return f["property-type"]==="data-driven"||f["property-type"]==="cross-faded-data-driven"}function y0(f){return!!f.expression&&f.expression.parameters.indexOf("zoom")>-1}function an(f){return!!f.expression&&f.expression.interpolated}function tn(f){return f instanceof Number?"number":f instanceof String?"string":f instanceof Boolean?"boolean":Array.isArray(f)?"array":f===null?"null":typeof f}function dd(f){return typeof f=="object"&&f!==null&&!Array.isArray(f)&&Tr(f)===bl}function Ca(f){return f}function pd(f,a){const h=f.stops&&typeof f.stops[0][0]=="object",y=h||!(h||f.property!==void 0),b=f.type||(an(a)?"exponential":"interval"),S=(function(H){switch(H.type){case"color":return Qi.parse;case"padding":return hs.parse;case"numberArray":return wr.parse;case"colorArray":return Gi.parse;default:return null}})(a);if(S&&((f=Ar({},f)).stops&&(f.stops=f.stops.map((H=>[H[0],S(H[1])]))),f.default=S(f.default?f.default:a.default)),f.colorSpace&&(E=f.colorSpace)!=="rgb"&&E!=="hcl"&&E!=="lab")throw new Error(`Unknown color space: "${f.colorSpace}"`);var E;const k=(function(H){switch(H){case"exponential":return Zc;case"interval":return gd;case"categorical":return Gp;case"identity":return v0;default:throw new Error(`Unknown function type "${H}"`)}})(b);let F,V;if(b==="categorical"){F=Object.create(null);for(const H of f.stops)F[H[0]]=H[1];V=typeof f.stops[0][0]}if(h){const H={},Y=[];for(let oe=0;oe<f.stops.length;oe++){const le=f.stops[oe],ue=le[0].zoom;H[ue]===void 0&&(H[ue]={zoom:ue,type:f.type,property:f.property,default:f.default,stops:[]},Y.push(ue)),H[ue].stops.push([le[0].value,le[1]])}const K=[];for(const oe of Y)K.push([H[oe].zoom,pd(H[oe],a)]);const te={name:"linear"};return{kind:"composite",interpolationType:te,interpolationFactor:is.interpolationFactor.bind(void 0,te),zoomStops:K.map((oe=>oe[0])),evaluate:({zoom:oe},le)=>Zc({stops:K,base:f.base},a,oe).evaluate(oe,le)}}if(y){const H=b==="exponential"?{name:"exponential",base:f.base!==void 0?f.base:1}:null;return{kind:"camera",interpolationType:H,interpolationFactor:is.interpolationFactor.bind(void 0,H),zoomStops:f.stops.map((Y=>Y[0])),evaluate:({zoom:Y})=>k(f,a,Y,F,V)}}return{kind:"source",evaluate(H,Y){const K=Y&&Y.properties?Y.properties[f.property]:void 0;return K===void 0?fo(f.default,a.default):k(f,a,K,F,V)}}}function fo(f,a,h){return f!==void 0?f:a!==void 0?a:h!==void 0?h:void 0}function Gp(f,a,h,y,b){return fo(typeof h===b?y[h]:void 0,f.default,a.default)}function gd(f,a,h){if(tn(h)!=="number")return fo(f.default,a.default);const y=f.stops.length;if(y===1||h<=f.stops[0][0])return f.stops[0][1];if(h>=f.stops[y-1][0])return f.stops[y-1][1];const b=Vc(f.stops.map((S=>S[0])),h);return f.stops[b][1]}function Zc(f,a,h){const y=f.base!==void 0?f.base:1;if(tn(h)!=="number")return fo(f.default,a.default);const b=f.stops.length;if(b===1||h<=f.stops[0][0])return f.stops[0][1];if(h>=f.stops[b-1][0])return f.stops[b-1][1];const S=Vc(f.stops.map((H=>H[0])),h),E=(function(H,Y,K,te){const oe=te-K,le=H-K;return oe===0?0:Y===1?le/oe:(Math.pow(Y,le)-1)/(Math.pow(Y,oe)-1)})(h,y,f.stops[S][0],f.stops[S+1][0]),k=f.stops[S][1],F=f.stops[S+1][1],V=Sr[a.type]||Ca;return typeof k.evaluate=="function"?{evaluate(...H){const Y=k.evaluate.apply(void 0,H),K=F.evaluate.apply(void 0,H);if(Y!==void 0&&K!==void 0)return V(Y,K,E,f.colorSpace)}}:V(k,F,E,f.colorSpace)}function v0(f,a,h){switch(a.type){case"color":h=Qi.parse(h);break;case"formatted":h=Ps.fromString(h.toString());break;case"resolvedImage":h=Ta.fromString(h.toString());break;case"padding":h=hs.parse(h);break;case"colorArray":h=Gi.parse(h);break;case"numberArray":h=wr.parse(h);break;default:tn(h)===a.type||a.type==="enum"&&a.values[h]||(h=void 0)}return fo(h,f.default,a.default)}uo.register(vh,{error:[{kind:"error"},[Xi],(f,[a])=>{throw new Wn(a.evaluate(f))}],typeof:[Xi,[Yi],(f,[a])=>En(Tr(a.evaluate(f)))],"to-rgba":[sa(ei,4),[ba],(f,[a])=>{const[h,y,b,S]=a.evaluate(f).rgb;return[255*h,255*y,255*b,S]}],rgb:[ba,[ei,ei,ei],_0],rgba:[ba,[ei,ei,ei,ei],_0],has:{type:en,overloads:[[[Xi],(f,[a])=>fd(a.evaluate(f),f.properties())],[[Xi,bl],(f,[a,h])=>fd(a.evaluate(f),h.evaluate(f))]]},get:{type:Yi,overloads:[[[Xi],(f,[a])=>ho(a.evaluate(f),f.properties())],[[Xi,bl],(f,[a,h])=>ho(a.evaluate(f),h.evaluate(f))]]},"feature-state":[Yi,[Xi],(f,[a])=>ho(a.evaluate(f),f.featureState||{})],properties:[bl,[],f=>f.properties()],"geometry-type":[Xi,[],f=>f.geometryType()],id:[Yi,[],f=>f.id()],zoom:[ei,[],f=>f.globals.zoom],"heatmap-density":[ei,[],f=>f.globals.heatmapDensity||0],elevation:[ei,[],f=>f.globals.elevation||0],"line-progress":[ei,[],f=>f.globals.lineProgress||0],accumulated:[Yi,[],f=>f.globals.accumulated===void 0?null:f.globals.accumulated],"+":[ei,Ml(ei),(f,a)=>{let h=0;for(const y of a)h+=y.evaluate(f);return h}],"*":[ei,Ml(ei),(f,a)=>{let h=1;for(const y of a)h*=y.evaluate(f);return h}],"-":{type:ei,overloads:[[[ei,ei],(f,[a,h])=>a.evaluate(f)-h.evaluate(f)],[[ei],(f,[a])=>-a.evaluate(f)]]},"/":[ei,[ei,ei],(f,[a,h])=>a.evaluate(f)/h.evaluate(f)],"%":[ei,[ei,ei],(f,[a,h])=>a.evaluate(f)%h.evaluate(f)],ln2:[ei,[],()=>Math.LN2],pi:[ei,[],()=>Math.PI],e:[ei,[],()=>Math.E],"^":[ei,[ei,ei],(f,[a,h])=>Math.pow(a.evaluate(f),h.evaluate(f))],sqrt:[ei,[ei],(f,[a])=>Math.sqrt(a.evaluate(f))],log10:[ei,[ei],(f,[a])=>Math.log(a.evaluate(f))/Math.LN10],ln:[ei,[ei],(f,[a])=>Math.log(a.evaluate(f))],log2:[ei,[ei],(f,[a])=>Math.log(a.evaluate(f))/Math.LN2],sin:[ei,[ei],(f,[a])=>Math.sin(a.evaluate(f))],cos:[ei,[ei],(f,[a])=>Math.cos(a.evaluate(f))],tan:[ei,[ei],(f,[a])=>Math.tan(a.evaluate(f))],asin:[ei,[ei],(f,[a])=>Math.asin(a.evaluate(f))],acos:[ei,[ei],(f,[a])=>Math.acos(a.evaluate(f))],atan:[ei,[ei],(f,[a])=>Math.atan(a.evaluate(f))],min:[ei,Ml(ei),(f,a)=>Math.min(...a.map((h=>h.evaluate(f))))],max:[ei,Ml(ei),(f,a)=>Math.max(...a.map((h=>h.evaluate(f))))],abs:[ei,[ei],(f,[a])=>Math.abs(a.evaluate(f))],round:[ei,[ei],(f,[a])=>{const h=a.evaluate(f);return h<0?-Math.round(-h):Math.round(h)}],floor:[ei,[ei],(f,[a])=>Math.floor(a.evaluate(f))],ceil:[ei,[ei],(f,[a])=>Math.ceil(a.evaluate(f))],"filter-==":[en,[Xi,Yi],(f,[a,h])=>f.properties()[a.value]===h.value],"filter-id-==":[en,[Yi],(f,[a])=>f.id()===a.value],"filter-type-==":[en,[Xi],(f,[a])=>f.geometryType()===a.value],"filter-<":[en,[Xi,Yi],(f,[a,h])=>{const y=f.properties()[a.value],b=h.value;return typeof y==typeof b&&y<b}],"filter-id-<":[en,[Yi],(f,[a])=>{const h=f.id(),y=a.value;return typeof h==typeof y&&h<y}],"filter->":[en,[Xi,Yi],(f,[a,h])=>{const y=f.properties()[a.value],b=h.value;return typeof y==typeof b&&y>b}],"filter-id->":[en,[Yi],(f,[a])=>{const h=f.id(),y=a.value;return typeof h==typeof y&&h>y}],"filter-<=":[en,[Xi,Yi],(f,[a,h])=>{const y=f.properties()[a.value],b=h.value;return typeof y==typeof b&&y<=b}],"filter-id-<=":[en,[Yi],(f,[a])=>{const h=f.id(),y=a.value;return typeof h==typeof y&&h<=y}],"filter->=":[en,[Xi,Yi],(f,[a,h])=>{const y=f.properties()[a.value],b=h.value;return typeof y==typeof b&&y>=b}],"filter-id->=":[en,[Yi],(f,[a])=>{const h=f.id(),y=a.value;return typeof h==typeof y&&h>=y}],"filter-has":[en,[Yi],(f,[a])=>a.value in f.properties()],"filter-has-id":[en,[],f=>f.id()!==null&&f.id()!==void 0],"filter-type-in":[en,[sa(Xi)],(f,[a])=>a.value.indexOf(f.geometryType())>=0],"filter-id-in":[en,[sa(Yi)],(f,[a])=>a.value.indexOf(f.id())>=0],"filter-in-small":[en,[Xi,sa(Yi)],(f,[a,h])=>h.value.indexOf(f.properties()[a.value])>=0],"filter-in-large":[en,[Xi,sa(Yi)],(f,[a,h])=>(function(y,b,S,E){for(;S<=E;){const k=S+E>>1;if(b[k]===y)return!0;b[k]>y?E=k-1:S=k+1}return!1})(f.properties()[a.value],h.value,0,h.value.length-1)],all:{type:en,overloads:[[[en,en],(f,[a,h])=>a.evaluate(f)&&h.evaluate(f)],[Ml(en),(f,a)=>{for(const h of a)if(!h.evaluate(f))return!1;return!0}]]},any:{type:en,overloads:[[[en,en],(f,[a,h])=>a.evaluate(f)||h.evaluate(f)],[Ml(en),(f,a)=>{for(const h of a)if(h.evaluate(f))return!0;return!1}]]},"!":[en,[en],(f,[a])=>!a.evaluate(f)],"is-supported-script":[en,[Xi],(f,[a])=>{const h=f.globals&&f.globals.isSupportedScript;return!h||h(a.evaluate(f))}],upcase:[Xi,[Xi],(f,[a])=>a.evaluate(f).toUpperCase()],downcase:[Xi,[Xi],(f,[a])=>a.evaluate(f).toLowerCase()],concat:[Xi,Ml(Yi),(f,a)=>a.map((h=>za(h.evaluate(f)))).join("")],"resolved-locale":[Xi,[Ko],(f,[a])=>a.evaluate(f).resolvedLocale()]});class Eu{constructor(a,h,y){this.expression=a,this._warningHistory={},this._evaluator=new mu,this._defaultValue=h?(function(b){if(b.type==="color"&&dd(b.default))return new Qi(0,0,0,0);switch(b.type){case"color":return Qi.parse(b.default)||null;case"padding":return hs.parse(b.default)||null;case"numberArray":return wr.parse(b.default)||null;case"colorArray":return Gi.parse(b.default)||null;case"variableAnchorOffsetCollection":return kr.parse(b.default)||null;case"projectionDefinition":return Is.parse(b.default)||null;default:return b.default===void 0?null:b.default}})(h):null,this._enumValues=h&&h.type==="enum"?h.values:null,this._globalState=y}evaluateWithoutErrorHandling(a,h,y,b,S,E){return this._globalState&&(a=Vs(a,this._globalState)),this._evaluator.globals=a,this._evaluator.feature=h,this._evaluator.featureState=y,this._evaluator.canonical=b,this._evaluator.availableImages=S||null,this._evaluator.formattedSection=E,this.expression.evaluate(this._evaluator)}evaluate(a,h,y,b,S,E){this._globalState&&(a=Vs(a,this._globalState)),this._evaluator.globals=a,this._evaluator.feature=h||null,this._evaluator.featureState=y||null,this._evaluator.canonical=b,this._evaluator.availableImages=S||null,this._evaluator.formattedSection=E||null;try{const k=this.expression.evaluate(this._evaluator);if(k==null||typeof k=="number"&&k!=k)return this._defaultValue;if(this._enumValues&&!(k in this._enumValues))throw new Wn(`Expected value to be one of ${Object.keys(this._enumValues).map((F=>JSON.stringify(F))).join(", ")}, but found ${JSON.stringify(k)} instead.`);return k}catch(k){return this._warningHistory[k.message]||(this._warningHistory[k.message]=!0,typeof console<"u"&&console.warn(k.message)),this._defaultValue}}}function Rl(f){return Array.isArray(f)&&f.length>0&&typeof f[0]=="string"&&f[0]in vh}function Mu(f,a,h){const y=new _u(vh,Ra,[],a?(function(S){const E={color:ba,string:Xi,number:ei,enum:Xi,boolean:en,formatted:Al,padding:rc,numberArray:Ba,colorArray:wl,projectionDefinition:df,resolvedImage:cr,variableAnchorOffsetCollection:Bc};return S.type==="array"?sa(E[S.value]||Yi,S.length):E[S.type]})(a):void 0),b=y.parse(f,void 0,void 0,void 0,a&&a.type==="string"?{typeAnnotation:"coerce"}:void 0);return b?Sf(new Eu(b,a,h)):Wc(y.errors)}class Pa{constructor(a,h,y){this.kind=a,this._styleExpression=h,this.isStateDependent=a!=="constant"&&!Su(h.expression),this.globalStateRefs=As(h.expression),this._globalState=y}evaluateWithoutErrorHandling(a,h,y,b,S,E){return this._globalState&&(a=Vs(a,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(a,h,y,b,S,E)}evaluate(a,h,y,b,S,E){return this._globalState&&(a=Vs(a,this._globalState)),this._styleExpression.evaluate(a,h,y,b,S,E)}}class cc{constructor(a,h,y,b,S){this.kind=a,this.zoomStops=y,this._styleExpression=h,this.isStateDependent=a!=="camera"&&!Su(h.expression),this.globalStateRefs=As(h.expression),this.interpolationType=b,this._globalState=S}evaluateWithoutErrorHandling(a,h,y,b,S,E){return this._globalState&&(a=Vs(a,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(a,h,y,b,S,E)}evaluate(a,h,y,b,S,E){return this._globalState&&(a=Vs(a,this._globalState)),this._styleExpression.evaluate(a,h,y,b,S,E)}interpolationFactor(a,h,y){return this.interpolationType?is.interpolationFactor(this.interpolationType,a,h,y):0}}function Xc(f,a,h){const y=Mu(f,a,h);if(y.result==="error")return y;const b=y.value.expression,S=nl(b);if(!S&&!Bo(a))return Wc([new Cs("","data expressions not supported")]);const E=xh(b,["zoom"]);if(!E&&!y0(a))return Wc([new Cs("","zoom expressions not supported")]);const k=rl(b);return k||E?k instanceof Cs?Wc([k]):k instanceof is&&!an(a)?Wc([new Cs("",'"interpolate" expressions cannot be used with this property')]):Sf(k?new cc(S?"camera":"composite",y.value,k.labels,k instanceof is?k.interpolation:void 0,h):new Pa(S?"constant":"source",y.value,h)):Wc([new Cs("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ru{constructor(a,h){this._parameters=a,this._specification=h,Ar(this,pd(this._parameters,this._specification))}static deserialize(a){return new Ru(a._parameters,a._specification)}static serialize(a){return{_parameters:a._parameters,_specification:a._specification}}}function rl(f){let a=null;if(f instanceof $n)a=rl(f.result);else if(f instanceof vu){for(const h of f.args)if(a=rl(h),a)break}else(f instanceof Ma||f instanceof is)&&f.input instanceof uo&&f.input.name==="zoom"&&(a=f);return a instanceof Cs||f.eachChild((h=>{const y=rl(h);y instanceof Cs?a=y:!a&&y?a=new Cs("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):a&&y&&a!==y&&(a=new Cs("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),a}function As(f,a=new Set){return f instanceof Tf&&a.add(f.key),f.eachChild((h=>{As(h,a)})),a}function Vs(f,a){const{zoom:h,heatmapDensity:y,elevation:b,lineProgress:S,isSupportedScript:E,accumulated:k}=f??{};return{zoom:h,heatmapDensity:y,elevation:b,lineProgress:S,isSupportedScript:E,accumulated:k,globalState:a}}function sl(f){if(f===!0||f===!1)return!0;if(!Array.isArray(f)||f.length===0)return!1;switch(f[0]){case"has":return f.length>=2&&f[1]!=="$id"&&f[1]!=="$type";case"in":return f.length>=3&&(typeof f[1]!="string"||Array.isArray(f[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return f.length!==3||Array.isArray(f[1])||Array.isArray(f[2]);case"any":case"all":for(const a of f.slice(1))if(!sl(a)&&typeof a!="boolean")return!1;return!0;default:return!0}}const Cl={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Ua(f,a){if(f==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};sl(f)||(f=Cu(f));const h=Mu(f,Cl,a);if(h.result==="error")throw new Error(h.value.map((y=>`${y.key}: ${y.message}`)).join(", "));return{filter:(y,b,S)=>h.value.evaluate(y,b,{},S),needGeometry:uc(f),getGlobalStateRefs:()=>As(h.value.expression)}}function Ia(f,a){return f<a?-1:f>a?1:0}function uc(f){if(!Array.isArray(f))return!1;if(f[0]==="within"||f[0]==="distance")return!0;for(let a=1;a<f.length;a++)if(uc(f[a]))return!0;return!1}function Cu(f){if(!f)return!0;const a=f[0];return f.length<=1?a!=="any":a==="=="?Pl(f[1],f[2],"=="):a==="!="?nr(Pl(f[1],f[2],"==")):a==="<"||a===">"||a==="<="||a===">="?Pl(f[1],f[2],a):a==="any"?(h=f.slice(1),["any"].concat(h.map(Cu))):a==="all"?["all"].concat(f.slice(1).map(Cu)):a==="none"?["all"].concat(f.slice(1).map(Cu).map(nr)):a==="in"?x0(f[1],f.slice(2)):a==="!in"?nr(x0(f[1],f.slice(2))):a==="has"?js(f[1]):a!=="!has"||nr(js(f[1]));var h}function Pl(f,a,h){switch(f){case"$type":return[`filter-type-${h}`,a];case"$id":return[`filter-id-${h}`,a];default:return[`filter-${h}`,f,a]}}function x0(f,a){if(a.length===0)return!1;switch(f){case"$type":return["filter-type-in",["literal",a]];case"$id":return["filter-id-in",["literal",a]];default:return a.length>200&&!a.some((h=>typeof h!=typeof a[0]))?["filter-in-large",f,["literal",a.sort(Ia)]]:["filter-in-small",f,["literal",a]]}}function js(f){switch(f){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",f]}}function nr(f){return["!",f]}function bn(f){const a=typeof f;if(a==="number"||a==="boolean"||a==="string"||f==null)return JSON.stringify(f);if(Array.isArray(f)){let b="[";for(const S of f)b+=`${bn(S)},`;return`${b}]`}const h=Object.keys(f).sort();let y="{";for(let b=0;b<h.length;b++)y+=`${JSON.stringify(h[b])}:${bn(f[h[b]])},`;return`${y}}`}function al(f){let a="";for(const h of Oi)a+=`/${bn(f[h])}`;return a}function po(f){const a=f.value;return a?[new Vt(f.key,a,"constants have been deprecated as of v8")]:[]}function Fr(f){return f instanceof Number||f instanceof String||f instanceof Boolean?f.valueOf():f}function Va(f){if(Array.isArray(f))return f.map(Va);if(f instanceof Object&&!(f instanceof Number||f instanceof String||f instanceof Boolean)){const a={};for(const h in f)a[h]=Va(f[h]);return a}return Fr(f)}function ja(f){const a=f.key,h=f.value,y=f.valueSpec||{},b=f.objectElementValidators||{},S=f.style,E=f.styleSpec,k=f.validateSpec;let F=[];const V=tn(h);if(V!=="object")return[new Vt(a,h,`object expected, ${V} found`)];for(const H in h){const Y=H.split(".")[0],K=ac(y,Y)||y["*"];let te;if(ac(b,Y))te=b[Y];else if(ac(y,Y)){if(h[H]===void 0)continue;te=k}else if(b["*"])te=b["*"];else{if(!y["*"]){F.push(new Vt(a,h[H],`unknown property "${H}"`));continue}te=k}F=F.concat(te({key:(a&&`${a}.`)+H,value:h[H],valueSpec:K,style:S,styleSpec:E,object:h,objectKey:H,validateSpec:k},h))}for(const H in y)b[H]||y[H].required&&y[H].default===void 0&&h[H]===void 0&&F.push(new Vt(a,h,`missing required property "${H}"`));return F}function Il(f){const a=f.value,h=f.valueSpec,y=f.style,b=f.styleSpec,S=f.key,E=f.arrayElementValidator||f.validateSpec;if(tn(a)!=="array")return[new Vt(S,a,`array expected, ${tn(a)} found`)];if(h.length&&a.length!==h.length)return[new Vt(S,a,`array length ${h.length} expected, length ${a.length} found`)];let k={type:h.value,values:h.values};b.$version<7&&(k.function=h.function),tn(h.value)==="object"&&(k=h.value);let F=[];for(let V=0;V<a.length;V++)F=F.concat(E({array:a,arrayIndex:V,value:a[V],valueSpec:k,validateSpec:f.validateSpec,style:y,styleSpec:b,key:`${S}[${V}]`}));return F}function kl(f){const a=f.key,h=f.value,y=f.valueSpec;let b=tn(h);return b==="number"&&h!=h&&(b="NaN"),b!=="number"?[new Vt(a,h,`number expected, ${b} found`)]:"minimum"in y&&h<y.minimum?[new Vt(a,h,`${h} is less than the minimum value ${y.minimum}`)]:"maximum"in y&&h>y.maximum?[new Vt(a,h,`${h} is greater than the maximum value ${y.maximum}`)]:[]}function Ga(f){const a=f.valueSpec,h=Fr(f.value.type);let y,b,S,E={};const k=h!=="categorical"&&f.value.property===void 0,F=!k,V=tn(f.value.stops)==="array"&&tn(f.value.stops[0])==="array"&&tn(f.value.stops[0][0])==="object",H=ja({key:f.key,value:f.value,valueSpec:f.styleSpec.function,validateSpec:f.validateSpec,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{stops:function(te){if(h==="identity")return[new Vt(te.key,te.value,'identity function may not have a "stops" property')];let oe=[];const le=te.value;return oe=oe.concat(Il({key:te.key,value:le,valueSpec:te.valueSpec,validateSpec:te.validateSpec,style:te.style,styleSpec:te.styleSpec,arrayElementValidator:Y})),tn(le)==="array"&&le.length===0&&oe.push(new Vt(te.key,le,"array must have at least one stop")),oe},default:function(te){return te.validateSpec({key:te.key,value:te.value,valueSpec:a,validateSpec:te.validateSpec,style:te.style,styleSpec:te.styleSpec})}}});return h==="identity"&&k&&H.push(new Vt(f.key,f.value,'missing required property "property"')),h==="identity"||f.value.stops||H.push(new Vt(f.key,f.value,'missing required property "stops"')),h==="exponential"&&f.valueSpec.expression&&!an(f.valueSpec)&&H.push(new Vt(f.key,f.value,"exponential functions not supported")),f.styleSpec.$version>=8&&(F&&!Bo(f.valueSpec)?H.push(new Vt(f.key,f.value,"property functions not supported")):k&&!y0(f.valueSpec)&&H.push(new Vt(f.key,f.value,"zoom functions not supported"))),h!=="categorical"&&!V||f.value.property!==void 0||H.push(new Vt(f.key,f.value,'"property" property is required')),H;function Y(te){let oe=[];const le=te.value,ue=te.key;if(tn(le)!=="array")return[new Vt(ue,le,`array expected, ${tn(le)} found`)];if(le.length!==2)return[new Vt(ue,le,`array length 2 expected, length ${le.length} found`)];if(V){if(tn(le[0])!=="object")return[new Vt(ue,le,`object expected, ${tn(le[0])} found`)];if(le[0].zoom===void 0)return[new Vt(ue,le,"object stop key must have zoom")];if(le[0].value===void 0)return[new Vt(ue,le,"object stop key must have value")];if(S&&S>Fr(le[0].zoom))return[new Vt(ue,le[0].zoom,"stop zoom values must appear in ascending order")];Fr(le[0].zoom)!==S&&(S=Fr(le[0].zoom),b=void 0,E={}),oe=oe.concat(ja({key:`${ue}[0]`,value:le[0],valueSpec:{zoom:{}},validateSpec:te.validateSpec,style:te.style,styleSpec:te.styleSpec,objectElementValidators:{zoom:kl,value:K}}))}else oe=oe.concat(K({key:`${ue}[0]`,value:le[0],validateSpec:te.validateSpec,style:te.style,styleSpec:te.styleSpec},le));return Rl(Va(le[1]))?oe.concat([new Vt(`${ue}[1]`,le[1],"expressions are not allowed in function stops.")]):oe.concat(te.validateSpec({key:`${ue}[1]`,value:le[1],valueSpec:a,validateSpec:te.validateSpec,style:te.style,styleSpec:te.styleSpec}))}function K(te,oe){const le=tn(te.value),ue=Fr(te.value),xe=te.value!==null?te.value:oe;if(y){if(le!==y)return[new Vt(te.key,xe,`${le} stop domain type must match previous stop domain type ${y}`)]}else y=le;if(le!=="number"&&le!=="string"&&le!=="boolean")return[new Vt(te.key,xe,"stop domain value must be a number, string, or boolean")];if(le!=="number"&&h!=="categorical"){let De=`number expected, ${le} found`;return Bo(a)&&h===void 0&&(De+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Vt(te.key,xe,De)]}return h!=="categorical"||le!=="number"||isFinite(ue)&&Math.floor(ue)===ue?h!=="categorical"&&le==="number"&&b!==void 0&&ue<b?[new Vt(te.key,xe,"stop domain values must appear in ascending order")]:(b=ue,h==="categorical"&&ue in E?[new Vt(te.key,xe,"stop domain values must be unique")]:(E[ue]=!0,[])):[new Vt(te.key,xe,`integer expected, found ${ue}`)]}}function Dl(f){const a=(f.expressionContext==="property"?Xc:Mu)(Va(f.value),f.valueSpec);if(a.result==="error")return a.value.map((y=>new Vt(`${f.key}${y.key}`,f.value,y.message)));const h=a.value.expression||a.value._styleExpression.expression;if(f.expressionContext==="property"&&f.propertyKey==="text-font"&&!h.outputDefined())return[new Vt(f.key,f.value,`Invalid data expression for "${f.propertyKey}". Output values must be contained as literals within the expression.`)];if(f.expressionContext==="property"&&f.propertyType==="layout"&&!Su(h))return[new Vt(f.key,f.value,'"feature-state" data expressions are not supported with layout properties.')];if(f.expressionContext==="filter"&&!Su(h))return[new Vt(f.key,f.value,'"feature-state" data expressions are not supported with filters.')];if(f.expressionContext&&f.expressionContext.indexOf("cluster")===0){if(!xh(h,["zoom","feature-state"]))return[new Vt(f.key,f.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(f.expressionContext==="cluster-initial"&&!nl(h))return[new Vt(f.key,f.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function hc(f){const a=f.key,h=f.value,y=tn(h);return y!=="string"?[new Vt(a,h,`color expected, ${y} found`)]:Qi.parse(String(h))?[]:[new Vt(a,h,`color expected, "${h}" found`)]}function fc(f){const a=f.key,h=f.value,y=f.valueSpec,b=[];return Array.isArray(y.values)?y.values.indexOf(Fr(h))===-1&&b.push(new Vt(a,h,`expected one of [${y.values.join(", ")}], ${JSON.stringify(h)} found`)):Object.keys(y.values).indexOf(Fr(h))===-1&&b.push(new Vt(a,h,`expected one of [${Object.keys(y.values).join(", ")}], ${JSON.stringify(h)} found`)),b}function zo(f){return sl(Va(f.value))?Dl(Ar({},f,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Lo(f)}function Lo(f){const a=f.value,h=f.key;if(tn(a)!=="array")return[new Vt(h,a,`array expected, ${tn(a)} found`)];const y=f.styleSpec;let b,S=[];if(a.length<1)return[new Vt(h,a,"filter array must have at least 1 element")];switch(S=S.concat(fc({key:`${h}[0]`,value:a[0],valueSpec:y.filter_operator,style:f.style,styleSpec:f.styleSpec})),Fr(a[0])){case"<":case"<=":case">":case">=":a.length>=2&&Fr(a[1])==="$type"&&S.push(new Vt(h,a,`"$type" cannot be use with operator "${a[0]}"`));case"==":case"!=":a.length!==3&&S.push(new Vt(h,a,`filter array for operator "${a[0]}" must have 3 elements`));case"in":case"!in":a.length>=2&&(b=tn(a[1]),b!=="string"&&S.push(new Vt(`${h}[1]`,a[1],`string expected, ${b} found`)));for(let E=2;E<a.length;E++)b=tn(a[E]),Fr(a[1])==="$type"?S=S.concat(fc({key:`${h}[${E}]`,value:a[E],valueSpec:y.geometry_type,style:f.style,styleSpec:f.styleSpec})):b!=="string"&&b!=="number"&&b!=="boolean"&&S.push(new Vt(`${h}[${E}]`,a[E],`string, number, or boolean expected, ${b} found`));break;case"any":case"all":case"none":for(let E=1;E<a.length;E++)S=S.concat(Lo({key:`${h}[${E}]`,value:a[E],style:f.style,styleSpec:f.styleSpec}));break;case"has":case"!has":b=tn(a[1]),a.length!==2?S.push(new Vt(h,a,`filter array for "${a[0]}" operator must have 2 elements`)):b!=="string"&&S.push(new Vt(`${h}[1]`,a[1],`string expected, ${b} found`))}return S}function Ol(f,a){const h=f.key,y=f.validateSpec,b=f.style,S=f.styleSpec,E=f.value,k=f.objectKey,F=S[`${a}_${f.layerType}`];if(!F)return[];const V=k.match(/^(.*)-transition$/);if(a==="paint"&&V&&F[V[1]]&&F[V[1]].transition)return y({key:h,value:E,valueSpec:S.transition,style:b,styleSpec:S});const H=f.valueSpec||F[k];if(!H)return[new Vt(h,E,`unknown property "${k}"`)];let Y;if(tn(E)==="string"&&Bo(H)&&!H.tokens&&(Y=/^{([^}]+)}$/.exec(E)))return[new Vt(h,E,`"${k}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(Y[1])} }\`.`)];const K=[];return f.layerType==="symbol"&&k==="text-font"&&dd(Va(E))&&Fr(E.type)==="identity"&&K.push(new Vt(h,E,'"text-font" does not support identity functions')),K.concat(y({key:f.key,value:E,valueSpec:H,style:b,styleSpec:S,expressionContext:"property",propertyType:a,propertyKey:k}))}function Fl(f){return Ol(f,"paint")}function md(f){return Ol(f,"layout")}function _d(f){let a=[];const h=f.value,y=f.key,b=f.style,S=f.styleSpec;if(tn(h)!=="object")return[new Vt(y,h,`object expected, ${tn(h)} found`)];h.type||h.ref||a.push(new Vt(y,h,'either "type" or "ref" is required'));let E=Fr(h.type);const k=Fr(h.ref);if(h.id){const F=Fr(h.id);for(let V=0;V<f.arrayIndex;V++){const H=b.layers[V];Fr(H.id)===F&&a.push(new Vt(y,h.id,`duplicate layer id "${h.id}", previously used at line ${H.id.__line__}`))}}if("ref"in h){let F;["type","source","source-layer","filter","layout"].forEach((V=>{V in h&&a.push(new Vt(y,h[V],`"${V}" is prohibited for ref layers`))})),b.layers.forEach((V=>{Fr(V.id)===k&&(F=V)})),F?F.ref?a.push(new Vt(y,h.ref,"ref cannot reference another ref layer")):E=Fr(F.type):a.push(new Vt(y,h.ref,`ref layer "${k}" not found`))}else if(E!=="background")if(h.source){const F=b.sources&&b.sources[h.source],V=F&&Fr(F.type);F?V==="vector"&&E==="raster"?a.push(new Vt(y,h.source,`layer "${h.id}" requires a raster source`)):V!=="raster-dem"&&E==="hillshade"||V!=="raster-dem"&&E==="color-relief"?a.push(new Vt(y,h.source,`layer "${h.id}" requires a raster-dem source`)):V==="raster"&&E!=="raster"?a.push(new Vt(y,h.source,`layer "${h.id}" requires a vector source`)):V!=="vector"||h["source-layer"]?V==="raster-dem"&&E!=="hillshade"&&E!=="color-relief"?a.push(new Vt(y,h.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):E!=="line"||!h.paint||!h.paint["line-gradient"]||V==="geojson"&&F.lineMetrics||a.push(new Vt(y,h,`layer "${h.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):a.push(new Vt(y,h,`layer "${h.id}" must specify a "source-layer"`)):a.push(new Vt(y,h.source,`source "${h.source}" not found`))}else a.push(new Vt(y,h,'missing required property "source"'));return a=a.concat(ja({key:y,value:h,valueSpec:S.layer,style:f.style,styleSpec:f.styleSpec,validateSpec:f.validateSpec,objectElementValidators:{"*":()=>[],type:()=>f.validateSpec({key:`${y}.type`,value:h.type,valueSpec:S.layer.type,style:f.style,styleSpec:f.styleSpec,validateSpec:f.validateSpec,object:h,objectKey:"type"}),filter:zo,layout:F=>ja({layer:h,key:F.key,value:F.value,style:F.style,styleSpec:F.styleSpec,validateSpec:F.validateSpec,objectElementValidators:{"*":V=>md(Ar({layerType:E},V))}}),paint:F=>ja({layer:h,key:F.key,value:F.value,style:F.style,styleSpec:F.styleSpec,validateSpec:F.validateSpec,objectElementValidators:{"*":V=>Fl(Ar({layerType:E},V))}})}})),a}function go(f){const a=f.value,h=f.key,y=tn(a);return y!=="string"?[new Vt(h,a,`string expected, ${y} found`)]:[]}const bh={promoteId:function({key:f,value:a}){if(tn(a)==="string")return go({key:f,value:a});{const h=[];for(const y in a)h.push(...go({key:`${f}.${y}`,value:a[y]}));return h}}};function dc(f){const a=f.value,h=f.key,y=f.styleSpec,b=f.style,S=f.validateSpec;if(!a.type)return[new Vt(h,a,'"type" is required')];const E=Fr(a.type);let k;switch(E){case"vector":case"raster":return k=ja({key:h,value:a,valueSpec:y[`source_${E.replace("-","_")}`],style:f.style,styleSpec:y,objectElementValidators:bh,validateSpec:S}),k;case"raster-dem":return k=(function(F){var V;const H=(V=F.sourceName)!==null&&V!==void 0?V:"",Y=F.value,K=F.styleSpec,te=K.source_raster_dem,oe=F.style;let le=[];const ue=tn(Y);if(Y===void 0)return le;if(ue!=="object")return le.push(new Vt("source_raster_dem",Y,`object expected, ${ue} found`)),le;const xe=Fr(Y.encoding)==="custom",De=["redFactor","greenFactor","blueFactor","baseShift"],we=F.value.encoding?`"${F.value.encoding}"`:"Default";for(const Ee in Y)!xe&&De.includes(Ee)?le.push(new Vt(Ee,Y[Ee],`In "${H}": "${Ee}" is only valid when "encoding" is set to "custom". ${we} encoding found`)):te[Ee]?le=le.concat(F.validateSpec({key:Ee,value:Y[Ee],valueSpec:te[Ee],validateSpec:F.validateSpec,style:oe,styleSpec:K})):le.push(new Vt(Ee,Y[Ee],`unknown property "${Ee}"`));return le})({sourceName:h,value:a,style:f.style,styleSpec:y,validateSpec:S}),k;case"geojson":if(k=ja({key:h,value:a,valueSpec:y.source_geojson,style:b,styleSpec:y,validateSpec:S,objectElementValidators:bh}),a.cluster)for(const F in a.clusterProperties){const[V,H]=a.clusterProperties[F],Y=typeof V=="string"?[V,["accumulated"],["get",F]]:V;k.push(...Dl({key:`${h}.${F}.map`,value:H,expressionContext:"cluster-map"})),k.push(...Dl({key:`${h}.${F}.reduce`,value:Y,expressionContext:"cluster-reduce"}))}return k;case"video":return ja({key:h,value:a,valueSpec:y.source_video,style:b,validateSpec:S,styleSpec:y});case"image":return ja({key:h,value:a,valueSpec:y.source_image,style:b,validateSpec:S,styleSpec:y});case"canvas":return[new Vt(h,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return fc({key:`${h}.type`,value:a.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function ps(f){const a=f.value,h=f.styleSpec,y=h.light,b=f.style;let S=[];const E=tn(a);if(a===void 0)return S;if(E!=="object")return S=S.concat([new Vt("light",a,`object expected, ${E} found`)]),S;for(const k in a){const F=k.match(/^(.*)-transition$/);S=S.concat(F&&y[F[1]]&&y[F[1]].transition?f.validateSpec({key:k,value:a[k],valueSpec:h.transition,validateSpec:f.validateSpec,style:b,styleSpec:h}):y[k]?f.validateSpec({key:k,value:a[k],valueSpec:y[k],validateSpec:f.validateSpec,style:b,styleSpec:h}):[new Vt(k,a[k],`unknown property "${k}"`)])}return S}function Ef(f){const a=f.value,h=f.styleSpec,y=h.sky,b=f.style,S=tn(a);if(a===void 0)return[];if(S!=="object")return[new Vt("sky",a,`object expected, ${S} found`)];let E=[];for(const k in a)E=E.concat(y[k]?f.validateSpec({key:k,value:a[k],valueSpec:y[k],style:b,styleSpec:h}):[new Vt(k,a[k],`unknown property "${k}"`)]);return E}function yd(f){const a=f.value,h=f.styleSpec,y=h.terrain,b=f.style;let S=[];const E=tn(a);if(a===void 0)return S;if(E!=="object")return S=S.concat([new Vt("terrain",a,`object expected, ${E} found`)]),S;for(const k in a)S=S.concat(y[k]?f.validateSpec({key:k,value:a[k],valueSpec:y[k],validateSpec:f.validateSpec,style:b,styleSpec:h}):[new Vt(k,a[k],`unknown property "${k}"`)]);return S}function b0(f){let a=[];const h=f.value,y=f.key;if(Array.isArray(h)){const b=[],S=[];for(const E in h)h[E].id&&b.includes(h[E].id)&&a.push(new Vt(y,h,`all the sprites' ids must be unique, but ${h[E].id} is duplicated`)),b.push(h[E].id),h[E].url&&S.includes(h[E].url)&&a.push(new Vt(y,h,`all the sprites' URLs must be unique, but ${h[E].url} is duplicated`)),S.push(h[E].url),a=a.concat(ja({key:`${y}[${E}]`,value:h[E],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:f.validateSpec}));return a}return go({key:y,value:h})}function Wp(f){return!!f&&f.constructor===Object}function A0(f){return Wp(f.value)?[]:[new Vt(f.key,f.value,`object expected, ${tn(f.value)} found`)]}const rs={"*":()=>[],array:Il,boolean:function(f){const a=f.value,h=f.key,y=tn(a);return y!=="boolean"?[new Vt(h,a,`boolean expected, ${y} found`)]:[]},number:kl,color:hc,constants:po,enum:fc,filter:zo,function:Ga,layer:_d,object:ja,source:dc,light:ps,sky:Ef,terrain:yd,projection:function(f){const a=f.value,h=f.styleSpec,y=h.projection,b=f.style,S=tn(a);if(a===void 0)return[];if(S!=="object")return[new Vt("projection",a,`object expected, ${S} found`)];let E=[];for(const k in a)E=E.concat(y[k]?f.validateSpec({key:k,value:a[k],valueSpec:y[k],style:b,styleSpec:h}):[new Vt(k,a[k],`unknown property "${k}"`)]);return E},projectionDefinition:function(f){const a=f.key;let h=f.value;h=h instanceof String?h.valueOf():h;const y=tn(h);return y!=="array"||(function(b){return Array.isArray(b)&&b.length===3&&typeof b[0]=="string"&&typeof b[1]=="string"&&typeof b[2]=="number"})(h)||(function(b){return!!["interpolate","step","literal"].includes(b[0])})(h)?["array","string"].includes(y)?[]:[new Vt(a,h,`projection expected, invalid type "${y}" found`)]:[new Vt(a,h,`projection expected, invalid array ${JSON.stringify(h)} found`)]},string:go,formatted:function(f){return go(f).length===0?[]:Dl(f)},resolvedImage:function(f){return go(f).length===0?[]:Dl(f)},padding:function(f){const a=f.key,h=f.value;if(tn(h)==="array"){if(h.length<1||h.length>4)return[new Vt(a,h,`padding requires 1 to 4 values; ${h.length} values found`)];const y={type:"number"};let b=[];for(let S=0;S<h.length;S++)b=b.concat(f.validateSpec({key:`${a}[${S}]`,value:h[S],validateSpec:f.validateSpec,valueSpec:y}));return b}return kl({key:a,value:h,valueSpec:{}})},numberArray:function(f){const a=f.key,h=f.value;if(tn(h)==="array"){const y={type:"number"};if(h.length<1)return[new Vt(a,h,"array length at least 1 expected, length 0 found")];let b=[];for(let S=0;S<h.length;S++)b=b.concat(f.validateSpec({key:`${a}[${S}]`,value:h[S],validateSpec:f.validateSpec,valueSpec:y}));return b}return kl({key:a,value:h,valueSpec:{}})},colorArray:function(f){const a=f.key,h=f.value;if(tn(h)==="array"){if(h.length<1)return[new Vt(a,h,"array length at least 1 expected, length 0 found")];let y=[];for(let b=0;b<h.length;b++)y=y.concat(hc({key:`${a}[${b}]`,value:h[b]}));return y}return hc({key:a,value:h})},variableAnchorOffsetCollection:function(f){const a=f.key,h=f.value,y=tn(h),b=f.styleSpec;if(y!=="array"||h.length<1||h.length%2!=0)return[new Vt(a,h,"variableAnchorOffsetCollection requires a non-empty array of even length")];let S=[];for(let E=0;E<h.length;E+=2)S=S.concat(fc({key:`${a}[${E}]`,value:h[E],valueSpec:b.layout_symbol["text-anchor"]})),S=S.concat(Il({key:`${a}[${E+1}]`,value:h[E+1],valueSpec:{length:2,value:"number"},validateSpec:f.validateSpec,style:f.style,styleSpec:b}));return S},sprite:b0,state:A0,fontFaces:function(f){const a=f.key,h=f.value,y=f.validateSpec,b=f.styleSpec,S=f.style;if(!Wp(h))return[new Vt(a,h,`object expected, ${tn(h)} found`)];const E=[];for(const k in h){const F=h[k],V=tn(F);if(V==="string")E.push(...go({key:`${a}.${k}`,value:F}));else if(V==="array"){const H={url:{type:"string",required:!0},"unicode-range":{type:"array",value:"string"}};for(const[Y,K]of F.entries())E.push(...ja({key:`${a}.${k}[${Y}]`,value:K,valueSpec:H,styleSpec:b,style:S,validateSpec:y}))}else E.push(new Vt(`${a}.${k}`,F,`string or array expected, ${V} found`))}return E}};function Nl(f){const a=f.value,h=f.valueSpec,y=f.styleSpec;return f.validateSpec=Nl,h.expression&&dd(Fr(a))?Ga(f):h.expression&&Rl(Va(a))?Dl(f):h.type&&rs[h.type]?rs[h.type](f):ja(Ar({},f,{valueSpec:h.type?y[h.type]:h}))}function Ah(f){const a=f.value,h=f.key,y=go(f);return y.length||(a.indexOf("{fontstack}")===-1&&y.push(new Vt(h,a,'"glyphs" url must include a "{fontstack}" token')),a.indexOf("{range}")===-1&&y.push(new Vt(h,a,'"glyphs" url must include a "{range}" token'))),y}function oa(f,a=Ke){let h=[];return h=h.concat(Nl({key:"",value:f,valueSpec:a.$root,styleSpec:a,style:f,validateSpec:Nl,objectElementValidators:{glyphs:Ah,"*":()=>[]}})),f.constants&&(h=h.concat(po({key:"constants",value:f.constants}))),Pu(h)}function mo(f){return function(a){return f(Object.assign({},a,{validateSpec:Nl}))}}function Pu(f){return[].concat(f).sort(((a,h)=>a.line-h.line))}function la(f){return function(...a){return Pu(f.apply(this,a))}}oa.source=la(mo(dc)),oa.sprite=la(mo(b0)),oa.glyphs=la(mo(Ah)),oa.light=la(mo(ps)),oa.sky=la(mo(Ef)),oa.terrain=la(mo(yd)),oa.state=la(mo(A0)),oa.layer=la(mo(_d)),oa.filter=la(mo(zo)),oa.paintProperty=la(mo(Fl)),oa.layoutProperty=la(mo(md));const tm={type:"enum","property-type":"data-constant",expression:{interpolated:!1,parameters:["global-state"]},values:{visible:{},none:{}},transition:!1,default:"visible"};class pc{constructor(a,h){this._globalState=h,this.setValue(a)}evaluate(){var a;return(a=this._literalValue)!==null&&a!==void 0?a:this._compiledValue.evaluate({})}setValue(a){if(a==null||a==="visible"||a==="none")return this._literalValue=a==="none"?"none":"visible",this._compiledValue=void 0,void(this._globalStateRefs=new Set);const h=Mu(a,tm,this._globalState);if(h.result==="error")throw this._literalValue="visible",this._compiledValue=void 0,new Error(h.value.map((y=>`${y.key}: ${y.message}`)).join(", "));this._literalValue=void 0,this._compiledValue=h.value,this._globalStateRefs=As(h.value.expression)}getGlobalStateRefs(){return this._globalStateRefs}}const Mf=Ke,Ds=oa,ol=Ds.light,vd=Ds.sky,xd=Ds.paintProperty,Zp=Ds.layoutProperty;function ll(f,a){let h=!1;if(a&&a.length)for(const y of a)f.fire(new Pt(new Error(y.message))),h=!0;return h}class gc{constructor(a,h,y){const b=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;const E=new Int32Array(this.arrayBuffer);a=E[0],this.d=(h=E[1])+2*(y=E[2]);for(let F=0;F<this.d*this.d;F++){const V=E[3+F],H=E[3+F+1];b.push(V===H?null:E.subarray(V,H))}const k=E[3+b.length+1];this.keys=E.subarray(E[3+b.length],k),this.bboxes=E.subarray(k),this.insert=this._insertReadonly}else{this.d=h+2*y;for(let E=0;E<this.d*this.d;E++)b.push([]);this.keys=[],this.bboxes=[]}this.n=h,this.extent=a,this.padding=y,this.scale=h/a,this.uid=0;const S=y/h*a;this.min=-S,this.max=a+S}insert(a,h,y,b,S){this._forEachCell(h,y,b,S,this._insertCell,this.uid++,void 0,void 0),this.keys.push(a),this.bboxes.push(h),this.bboxes.push(y),this.bboxes.push(b),this.bboxes.push(S)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(a,h,y,b,S,E){this.cells[S].push(E)}query(a,h,y,b,S){const E=this.min,k=this.max;if(a<=E&&h<=E&&k<=y&&k<=b&&!S)return Array.prototype.slice.call(this.keys);{const F=[];return this._forEachCell(a,h,y,b,this._queryCell,F,{},S),F}}_queryCell(a,h,y,b,S,E,k,F){const V=this.cells[S];if(V!==null){const H=this.keys,Y=this.bboxes;for(let K=0;K<V.length;K++){const te=V[K];if(k[te]===void 0){const oe=4*te;(F?F(Y[oe+0],Y[oe+1],Y[oe+2],Y[oe+3]):a<=Y[oe+2]&&h<=Y[oe+3]&&y>=Y[oe+0]&&b>=Y[oe+1])?(k[te]=!0,E.push(H[te])):k[te]=!1}}}}_forEachCell(a,h,y,b,S,E,k,F){const V=this._convertToCellCoord(a),H=this._convertToCellCoord(h),Y=this._convertToCellCoord(y),K=this._convertToCellCoord(b);for(let te=V;te<=Y;te++)for(let oe=H;oe<=K;oe++){const le=this.d*oe+te;if((!F||F(this._convertFromCellCoord(te),this._convertFromCellCoord(oe),this._convertFromCellCoord(te+1),this._convertFromCellCoord(oe+1)))&&S.call(this,a,h,y,b,le,E,k,F))return}}_convertFromCellCoord(a){return(a-this.padding)/this.scale}_convertToCellCoord(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const a=this.cells,h=3+this.cells.length+1+1;let y=0;for(let E=0;E<this.cells.length;E++)y+=this.cells[E].length;const b=new Int32Array(h+y+this.keys.length+this.bboxes.length);b[0]=this.extent,b[1]=this.n,b[2]=this.padding;let S=h;for(let E=0;E<a.length;E++){const k=a[E];b[3+E]=S,b.set(k,S),S+=k.length}return b[3+a.length]=S,b.set(this.keys,S),S+=this.keys.length,b[3+a.length+1]=S,b.set(this.bboxes,S),S+=this.bboxes.length,b.buffer}static serialize(a,h){const y=a.toArrayBuffer();return h&&h.push(y),{buffer:y}}static deserialize(a){return new gc(a.buffer)}}const Wa={};function yi(f,a,h={}){if(Wa[f])throw new Error(`${f} is already registered.`);Object.defineProperty(a,"_classRegistryKey",{value:f,writeable:!1}),Wa[f]={klass:a,omit:h.omit||[],shallow:h.shallow||[]}}yi("Object",Object),yi("Set",Set),yi("TransferableGridIndex",gc),yi("Color",Qi),yi("Error",Error),yi("AJAXError",Fe),yi("ResolvedImage",Ta),yi("StylePropertyFunction",Ru),yi("StyleExpression",Eu,{omit:["_evaluator"]}),yi("ZoomDependentExpression",cc),yi("ZoomConstantExpression",Pa),yi("CompoundExpression",uo,{omit:["_evaluate"]});for(const f in vh)vh[f]._classRegistryKey||yi(`Expression_${f}`,vh[f]);function wh(f){return f&&typeof ArrayBuffer<"u"&&(f instanceof ArrayBuffer||f.constructor&&f.constructor.name==="ArrayBuffer")}function Hc(f){return f.$name||f.constructor._classRegistryKey}function Uo(f){return!(function(a){if(a===null||typeof a!="object")return!1;const h=Hc(a);return!(!h||h==="Object")})(f)&&(f==null||typeof f=="boolean"||typeof f=="number"||typeof f=="string"||f instanceof Boolean||f instanceof Number||f instanceof String||f instanceof Date||f instanceof RegExp||f instanceof Blob||f instanceof Error||wh(f)||xl(f)||ArrayBuffer.isView(f)||f instanceof ImageData)}function cl(f,a){if(Uo(f))return(wh(f)||xl(f))&&a&&a.push(f),ArrayBuffer.isView(f)&&a&&a.push(f.buffer),f instanceof ImageData&&a&&a.push(f.data.buffer),f;if(Array.isArray(f)){const S=[];for(const E of f)S.push(cl(E,a));return S}if(typeof f!="object")throw new Error("can't serialize object of type "+typeof f);const h=Hc(f);if(!h)throw new Error(`can't serialize object of unregistered class ${f.constructor.name}`);if(!Wa[h])throw new Error(`${h} is not registered.`);const{klass:y}=Wa[h],b=y.serialize?y.serialize(f,a):{};if(y.serialize){if(a&&b===a[a.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const S in f){if(!f.hasOwnProperty(S)||Wa[h].omit.indexOf(S)>=0)continue;const E=f[S];b[S]=Wa[h].shallow.indexOf(S)>=0?E:cl(E,a)}f instanceof Error&&(b.message=f.message)}if(b.$name)throw new Error("$name property is reserved for worker serialization logic.");return h!=="Object"&&(b.$name=h),b}function Th(f){if(Uo(f))return f;if(Array.isArray(f))return f.map(Th);if(typeof f!="object")throw new Error("can't deserialize object of type "+typeof f);const a=Hc(f)||"Object";if(!Wa[a])throw new Error(`can't deserialize unregistered class ${a}`);const{klass:h}=Wa[a];if(!h)throw new Error(`can't deserialize unregistered class ${a}`);if(h.deserialize)return h.deserialize(f);const y=Object.create(h.prototype);for(const b of Object.keys(f)){if(b==="$name")continue;const S=f[b];y[b]=Wa[a].shallow.indexOf(b)>=0?S:Th(S)}return y}class bd{constructor(){this.first=!0}update(a,h){const y=Math.floor(a);return this.first?(this.first=!1,this.lastIntegerZoom=y,this.lastIntegerZoomTime=0,this.lastZoom=a,this.lastFloorZoom=y,!0):(this.lastFloorZoom>y?(this.lastIntegerZoom=y+1,this.lastIntegerZoomTime=h):this.lastFloorZoom<y&&(this.lastIntegerZoom=y,this.lastIntegerZoomTime=h),a!==this.lastZoom&&(this.lastZoom=a,this.lastFloorZoom=y,!0))}}function Bl(f){return/[\u02EA\u02EB\u2E80-\u2FDF\u2FF0-\u303F\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FD-\u30FF\u3105-\u312F\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(f))}function Iu(f){return/[\u02EA\u02EB\u1100-\u11FF\u1400-\u167F\u18B0-\u18F5\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u3007\u3012\u3013\u3020-\u302F\u3031-\u303F\u3041-\u3096\u309D-\u30FB\u30FD-\u30FF\u3105-\u312F\u3131-\u318E\u3190-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE48\uFE50-\uFE57\uFE5F-\uFE62\uFE67-\uFE6F\uFF00-\uFF07\uFF0A-\uFF0C\uFF0E-\uFF19\uFF1F-\uFF3A\uFF3C\uFF3E\uFF40-\uFF5A\uFFE0-\uFFE2\uFFE4-\uFFE7]|\uD802[\uDD80-\uDD9F]|\uD805[\uDD80-\uDDFF]|\uD806[\uDE00-\uDEBF]|\uD811[\uDC00-\uDE7F]|\uD81B[\uDFE0-\uDFE4\uDFF0-\uDFF6]|[\uD81C-\uD822\uD83D\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD30-\uDEFB]|\uD833[\uDEC0-\uDFCF]|\uD834[\uDC00-\uDDFF\uDEE0-\uDF7F]|\uD836[\uDC00-\uDEAF]|\uD83C[\uDC00-\uDE00\uDF00-\uDFFF]|\uD83E[\uDD00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(f))}function Rf(f){return/\s/u.test(String.fromCodePoint(f))}function zl(f){for(const a of f)if(Iu(a.codePointAt(0)))return!0;return!1}function Sh(f){for(const a of f)if(!w0(a.codePointAt(0)))return!1;return!0}function Eh(f){const a=f.map((h=>{try{return new RegExp(`\\p{sc=${h}}`,"u").source}catch{return null}})).filter((h=>h));return new RegExp(a.join("|"),"u")}const Ll=Eh(["Arab","Dupl","Mong","Ougr","Syrc"]);function w0(f){return!Ll.test(String.fromCodePoint(f))}function ul(f){return!(Iu(f)||(a=f,/[\xA7\xA9\xAE\xB1\xBC-\xBE\xD7\xF7\u2016\u2020\u2021\u2030\u2031\u203B\u203C\u2042\u2047-\u2049\u2051\u2100-\u218F\u221E\u2234\u2235\u2300-\u2307\u230C-\u231F\u2324-\u2328\u232B\u237D-\u239A\u23BE-\u23CD\u23CF\u23D1-\u23DB\u23E2-\u2422\u2424-\u24FF\u25A0-\u2619\u2620-\u2767\u2776-\u2793\u2B12-\u2B2F\u2B50-\u2B59\u2BB8-\u2BEB\u3000-\u303F\u30A0-\u30FF\uE000-\uF8FF\uFE30-\uFE6F\uFF00-\uFFEF\uFFFC\uFFFD]|[\uDB80-\uDBFF][\uDC00-\uDFFF]/gim.test(String.fromCodePoint(a))));var a}const ca=Eh(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function ku(f){return ca.test(String.fromCodePoint(f))}function ss(f,a){return!(!a&&ku(f)||/[\u0900-\u0DFF\u0F00-\u109F\u1780-\u17FF]/gim.test(String.fromCodePoint(f)))}function Nr(f){for(const a of f)if(ku(a.codePointAt(0)))return!0;return!1}const Br=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(f){this.pluginStatus=f.pluginStatus,this.pluginURL=f.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(f){if(Br.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=f.applyArabicShaping,this.processBidirectionalText=f.processBidirectionalText,this.processStyledBidirectionalText=f.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(f,a){return l(this,void 0,void 0,(function*(){if(this.isParsed())return this.getState();if(f.pluginStatus!=="loading")return this.setState(f),f;const h=f.pluginURL,y=new Promise((S=>{this.loadScriptResolve=S}));a(h);const b=new Promise((S=>setTimeout((()=>S()),this.TIMEOUT)));if(yield Promise.race([y,b]),this.isParsed()){const S={pluginStatus:"loaded",pluginURL:h};return this.setState(S),S}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${h}`)}))}};class Un{constructor(a,h){this.isSupportedScript=T0,this.zoom=a,h?(this.now=h.now||0,this.fadeDuration=h.fadeDuration||0,this.zoomHistory=h.zoomHistory||new bd,this.transition=h.transition||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new bd,this.transition={})}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const a=this.zoom,h=a-Math.floor(a),y=this.crossFadingFactor();return a>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:h+(1-h)*y}:{fromScale:.5,toScale:1,t:1-(1-y)*h}}}function T0(f){return(function(a,h){for(const y of a)if(!ss(y.codePointAt(0),h))return!1;return!0})(f,Br.getRTLTextPluginStatus()==="loaded")}const mc="-transition";class $c{constructor(a,h,y){this.property=a,this.value=h,this.expression=(function(b,S,E){if(dd(b))return new Ru(b,S);if(Rl(b)){const k=Xc(b,S,E);if(k.result==="error")throw new Error(k.value.map((F=>`${F.key}: ${F.message}`)).join(", "));return k.value}{let k=b;return S.type==="color"&&typeof b=="string"?k=Qi.parse(b):S.type!=="padding"||typeof b!="number"&&!Array.isArray(b)?S.type!=="numberArray"||typeof b!="number"&&!Array.isArray(b)?S.type!=="colorArray"||typeof b!="string"&&!Array.isArray(b)?S.type==="variableAnchorOffsetCollection"&&Array.isArray(b)?k=kr.parse(b):S.type==="projectionDefinition"&&typeof b=="string"&&(k=Is.parse(b)):k=Gi.parse(b):k=wr.parse(b):k=hs.parse(b),{globalStateRefs:new Set,_globalState:null,kind:"constant",evaluate:()=>k}}})(h===void 0?a.specification.default:h,a.specification,y)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(a,h,y){return this.property.possiblyEvaluate(this,a,h,y)}}class Cf{constructor(a,h){this.property=a,this.value=new $c(a,void 0,h)}transitioned(a,h){return new Du(this.property,this.value,h,Kn({},a.transition,this.transition),a.now)}untransitioned(){return new Du(this.property,this.value,null,{},0)}}class Ad{constructor(a,h){this._properties=a,this._values=Object.create(a.defaultTransitionablePropertyValues),this._globalState=h}getValue(a){return ra(this._values[a].value.value)}setValue(a,h){Object.prototype.hasOwnProperty.call(this._values,a)||(this._values[a]=new Cf(this._values[a].property,this._globalState)),this._values[a].value=new $c(this._values[a].property,h===null?void 0:ra(h),this._globalState)}getTransition(a){return ra(this._values[a].transition)}setTransition(a,h){Object.prototype.hasOwnProperty.call(this._values,a)||(this._values[a]=new Cf(this._values[a].property,this._globalState)),this._values[a].transition=ra(h)||void 0}serialize(){const a={};for(const h of Object.keys(this._values)){const y=this.getValue(h);y!==void 0&&(a[h]=y);const b=this.getTransition(h);b!==void 0&&(a[`${h}${mc}`]=b)}return a}transitioned(a,h){const y=new Pf(this._properties);for(const b of Object.keys(this._values))y._values[b]=this._values[b].transitioned(a,h._values[b]);return y}untransitioned(){const a=new Pf(this._properties);for(const h of Object.keys(this._values))a._values[h]=this._values[h].untransitioned();return a}}class Du{constructor(a,h,y,b,S){this.property=a,this.value=h,this.begin=S+b.delay||0,this.end=this.begin+b.duration||0,a.specification.transition&&(b.delay||b.duration)&&(this.prior=y)}possiblyEvaluate(a,h,y){const b=a.now||0,S=this.value.possiblyEvaluate(a,h,y),E=this.prior;if(E){if(b>this.end)return this.prior=null,S;if(this.value.isDataDriven())return this.prior=null,S;if(b<this.begin)return E.possiblyEvaluate(a,h,y);{const k=(b-this.begin)/(this.end-this.begin);return this.property.interpolate(E.possiblyEvaluate(a,h,y),S,vi(k))}}return S}}class Pf{constructor(a){this._properties=a,this._values=Object.create(a.defaultTransitioningPropertyValues)}possiblyEvaluate(a,h,y){const b=new Ou(this._properties);for(const S of Object.keys(this._values))b._values[S]=this._values[S].possiblyEvaluate(a,h,y);return b}hasTransition(){for(const a of Object.keys(this._values))if(this._values[a].prior)return!0;return!1}}class S0{constructor(a,h){this._properties=a,this._values=Object.create(a.defaultPropertyValues),this._globalState=h}hasValue(a){return this._values[a].value!==void 0}getValue(a){return ra(this._values[a].value)}setValue(a,h){this._values[a]=new $c(this._values[a].property,h===null?void 0:ra(h),this._globalState)}serialize(){const a={};for(const h of Object.keys(this._values)){const y=this.getValue(h);y!==void 0&&(a[h]=y)}return a}possiblyEvaluate(a,h,y){const b=new Ou(this._properties);for(const S of Object.keys(this._values))b._values[S]=this._values[S].possiblyEvaluate(a,h,y);return b}}class _o{constructor(a,h,y){this.property=a,this.value=h,this.parameters=y}isConstant(){return this.value.kind==="constant"}constantOr(a){return this.value.kind==="constant"?this.value.value:a}evaluate(a,h,y,b){return this.property.evaluate(this.value,this.parameters,a,h,y,b)}}class Ou{constructor(a){this._properties=a,this._values=Object.create(a.defaultPossiblyEvaluatedValues)}get(a){return this._values[a]}}class xi{constructor(a){this.specification=a}possiblyEvaluate(a,h){if(a.isDataDriven())throw new Error("Value should not be data driven");return a.expression.evaluate(h)}interpolate(a,h,y){const b=Sr[this.specification.type];return b?b(a,h,y):a}}class Mi{constructor(a,h){this.specification=a,this.overrides=h}possiblyEvaluate(a,h,y,b){return new _o(this,a.expression.kind==="constant"||a.expression.kind==="camera"?{kind:"constant",value:a.expression.evaluate(h,null,{},y,b)}:a.expression,h)}interpolate(a,h,y){if(a.value.kind!=="constant"||h.value.kind!=="constant")return a;if(a.value.value===void 0||h.value.value===void 0)return new _o(this,{kind:"constant",value:void 0},a.parameters);const b=Sr[this.specification.type];if(b){const S=b(a.value.value,h.value.value,y);return new _o(this,{kind:"constant",value:S},a.parameters)}return a}evaluate(a,h,y,b,S,E){return a.kind==="constant"?a.value:a.evaluate(h,y,b,S,E)}}class Vo extends Mi{possiblyEvaluate(a,h,y,b){if(a.value===void 0)return new _o(this,{kind:"constant",value:void 0},h);if(a.expression.kind==="constant"){const S=a.expression.evaluate(h,null,{},y,b),E=a.property.specification.type==="resolvedImage"&&typeof S!="string"?S.name:S,k=this._calculate(E,E,E,h);return new _o(this,{kind:"constant",value:k},h)}if(a.expression.kind==="camera"){const S=this._calculate(a.expression.evaluate({zoom:h.zoom-1}),a.expression.evaluate({zoom:h.zoom}),a.expression.evaluate({zoom:h.zoom+1}),h);return new _o(this,{kind:"constant",value:S},h)}return new _o(this,a.expression,h)}evaluate(a,h,y,b,S,E){if(a.kind==="source"){const k=a.evaluate(h,y,b,S,E);return this._calculate(k,k,k,h)}return a.kind==="composite"?this._calculate(a.evaluate({zoom:Math.floor(h.zoom)-1},y,b),a.evaluate({zoom:Math.floor(h.zoom)},y,b),a.evaluate({zoom:Math.floor(h.zoom)+1},y,b),h):a.value}_calculate(a,h,y,b){return b.zoom>b.zoomHistory.lastIntegerZoom?{from:a,to:h}:{from:y,to:h}}interpolate(a){return a}}class Mh{constructor(a){this.specification=a}possiblyEvaluate(a,h,y,b){if(a.value!==void 0){if(a.expression.kind==="constant"){const S=a.expression.evaluate(h,null,{},y,b);return this._calculate(S,S,S,h)}return this._calculate(a.expression.evaluate(new Un(Math.floor(h.zoom-1),h)),a.expression.evaluate(new Un(Math.floor(h.zoom),h)),a.expression.evaluate(new Un(Math.floor(h.zoom+1),h)),h)}}_calculate(a,h,y,b){return b.zoom>b.zoomHistory.lastIntegerZoom?{from:a,to:h}:{from:y,to:h}}interpolate(a){return a}}class Rh{constructor(a){this.specification=a}possiblyEvaluate(a,h,y,b){return!!a.expression.evaluate(h,null,{},y,b)}interpolate(){return!1}}class Er{constructor(a){this.properties=a,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const h in a){const y=a[h];y.specification.overridable&&this.overridableProperties.push(h);const b=this.defaultPropertyValues[h]=new $c(y,void 0,void 0),S=this.defaultTransitionablePropertyValues[h]=new Cf(y,void 0);this.defaultTransitioningPropertyValues[h]=S.untransitioned(),this.defaultPossiblyEvaluatedValues[h]=b.possiblyEvaluate({})}}}yi("DataDrivenProperty",Mi),yi("DataConstantProperty",xi),yi("CrossFadedDataDrivenProperty",Vo),yi("CrossFadedProperty",Mh),yi("ColorRampProperty",Rh);class rn extends qt{constructor(a,h,y){if(super(),this.id=a.id,this.type=a.type,this._globalState=y,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},this._visibilityExpression=(function(b,S){return new pc(b,S)})(this.visibility,y),a.type!=="custom"&&(this.metadata=a.metadata,this.minzoom=a.minzoom,this.maxzoom=a.maxzoom,a.type!=="background"&&(this.source=a.source,this.sourceLayer=a["source-layer"],this.filter=a.filter,this._featureFilter=Ua(a.filter,y)),h.layout&&(this._unevaluatedLayout=new S0(h.layout,y)),h.paint)){this._transitionablePaint=new Ad(h.paint,y);for(const b in a.paint)this.setPaintProperty(b,a.paint[b],{validate:!1});for(const b in a.layout)this.setLayoutProperty(b,a.layout[b],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ou(h.paint)}}setFilter(a){this.filter=a,this._featureFilter=Ua(a,this._globalState)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(a){return a==="visibility"?this.visibility:this._unevaluatedLayout.getValue(a)}getLayoutAffectingGlobalStateRefs(){const a=new Set;for(const h of this._visibilityExpression.getGlobalStateRefs())a.add(h);if(this._unevaluatedLayout)for(const h in this._unevaluatedLayout._values){const y=this._unevaluatedLayout._values[h];for(const b of y.getGlobalStateRefs())a.add(b)}for(const h of this._featureFilter.getGlobalStateRefs())a.add(h);return a}getPaintAffectingGlobalStateRefs(){var a;const h=new globalThis.Map;if(this._transitionablePaint)for(const y in this._transitionablePaint._values){const b=this._transitionablePaint._values[y].value;for(const S of b.getGlobalStateRefs()){const E=(a=h.get(S))!==null&&a!==void 0?a:[];E.push({name:y,value:b.value}),h.set(S,E)}}return h}getVisibilityAffectingGlobalStateRefs(){return this._visibilityExpression.getGlobalStateRefs()}setLayoutProperty(a,h,y={}){if(h==null||!this._validate(Zp,`layers.${this.id}.layout.${a}`,a,h,y))return a==="visibility"?(this.visibility=h,this._visibilityExpression.setValue(h),void this.recalculateVisibility()):void this._unevaluatedLayout.setValue(a,h)}getPaintProperty(a){return a.endsWith(mc)?this._transitionablePaint.getTransition(a.slice(0,-11)):this._transitionablePaint.getValue(a)}setPaintProperty(a,h,y={}){if(h!=null&&this._validate(xd,`layers.${this.id}.paint.${a}`,a,h,y))return!1;if(a.endsWith(mc))return this._transitionablePaint.setTransition(a.slice(0,-11),h||void 0),!1;{const b=this._transitionablePaint._values[a],S=b.property.specification["property-type"]==="cross-faded-data-driven",E=b.value.isDataDriven(),k=b.value;this._transitionablePaint.setValue(a,h),this._handleSpecialPaintPropertyUpdate(a);const F=this._transitionablePaint._values[a].value;return F.isDataDriven()||E||S||this._handleOverridablePaintPropertyUpdate(a,k,F)}}_handleSpecialPaintPropertyUpdate(a){}_handleOverridablePaintPropertyUpdate(a,h,y){return!1}isHidden(a=this.minzoom,h=!1){return!!(this.minzoom&&a<(h?Math.floor(this.minzoom):this.minzoom))||!!(this.maxzoom&&a>=this.maxzoom)||this._evaluatedVisibility==="none"}updateTransitions(a){this._transitioningPaint=this._transitionablePaint.transitioned(a,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculateVisibility(){this._evaluatedVisibility=this._visibilityExpression.evaluate()}recalculate(a,h){a.getCrossfadeParameters&&(this._crossfadeParameters=a.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(a,void 0,h)),this.paint=this._transitioningPaint.possiblyEvaluate(a,void 0,h)}serialize(){const a={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(a.layout=a.layout||{},a.layout.visibility=this.visibility),Oa(a,((h,y)=>!(h===void 0||y==="layout"&&!Object.keys(h).length||y==="paint"&&!Object.keys(h).length)))}_validate(a,h,y,b,S={}){return(!S||S.validate!==!1)&&ll(this,a.call(Ds,{key:h,layerType:this.type,objectKey:y,value:b,styleSpec:Ke,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const a in this.paint._values){const h=this.paint.get(a);if(h instanceof _o&&Bo(h.property.specification)&&(h.value.kind==="source"||h.value.kind==="composite")&&h.value.isStateDependent)return!0}return!1}}let hr;var Ch={get paint(){return hr=hr||new Er({"raster-opacity":new xi(Ke.paint_raster["raster-opacity"]),"raster-hue-rotate":new xi(Ke.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new xi(Ke.paint_raster["raster-brightness-min"]),"raster-brightness-max":new xi(Ke.paint_raster["raster-brightness-max"]),"raster-saturation":new xi(Ke.paint_raster["raster-saturation"]),"raster-contrast":new xi(Ke.paint_raster["raster-contrast"]),"raster-resampling":new xi(Ke.paint_raster["raster-resampling"]),"raster-fade-duration":new xi(Ke.paint_raster["raster-fade-duration"])})}};class _c extends rn{constructor(a,h){super(a,Ch,h)}}const un={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Vn{constructor(a,h){this._structArray=a,this._pos1=h*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class zi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(a,h){return a._trim(),h&&(a.isTransferred=!0,h.push(a.arrayBuffer)),{length:a.length,arrayBuffer:a.arrayBuffer}}static deserialize(a){const h=Object.create(this.prototype);return h.arrayBuffer=a.arrayBuffer,h.length=a.length,h.capacity=a.arrayBuffer.byteLength/h.bytesPerElement,h._refreshViews(),h}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(a){this.reserve(a),this.length=a}reserve(a){if(a>this.capacity){this.capacity=Math.max(a,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const h=this.uint8;this._refreshViews(),h&&this.uint8.set(h)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function _r(f,a=1){let h=0,y=0;return{members:f.map((b=>{const S=un[b.type].BYTES_PER_ELEMENT,E=h=yo(h,Math.max(a,S)),k=b.components||1;return y=Math.max(y,S),h+=S*k,{name:b.name,type:b.type,components:k,offset:E}})),size:yo(h,Math.max(y,a)),alignment:a}}function yo(f,a){return Math.ceil(f/a)*a}class Za extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,h){const y=this.length;return this.resize(y+1),this.emplace(y,a,h)}emplace(a,h,y){const b=2*a;return this.int16[b+0]=h,this.int16[b+1]=y,a}}Za.prototype.bytesPerElement=4,yi("StructArrayLayout2i4",Za);class qc extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,h,y){const b=this.length;return this.resize(b+1),this.emplace(b,a,h,y)}emplace(a,h,y,b){const S=3*a;return this.int16[S+0]=h,this.int16[S+1]=y,this.int16[S+2]=b,a}}qc.prototype.bytesPerElement=6,yi("StructArrayLayout3i6",qc);class Yc extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,h,y,b){const S=this.length;return this.resize(S+1),this.emplace(S,a,h,y,b)}emplace(a,h,y,b,S){const E=4*a;return this.int16[E+0]=h,this.int16[E+1]=y,this.int16[E+2]=b,this.int16[E+3]=S,a}}Yc.prototype.bytesPerElement=8,yi("StructArrayLayout4i8",Yc);class Ul extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,h,y,b,S,E){const k=this.length;return this.resize(k+1),this.emplace(k,a,h,y,b,S,E)}emplace(a,h,y,b,S,E,k){const F=6*a;return this.int16[F+0]=h,this.int16[F+1]=y,this.int16[F+2]=b,this.int16[F+3]=S,this.int16[F+4]=E,this.int16[F+5]=k,a}}Ul.prototype.bytesPerElement=12,yi("StructArrayLayout2i4i12",Ul);class wd extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,h,y,b,S,E){const k=this.length;return this.resize(k+1),this.emplace(k,a,h,y,b,S,E)}emplace(a,h,y,b,S,E,k){const F=4*a,V=8*a;return this.int16[F+0]=h,this.int16[F+1]=y,this.uint8[V+4]=b,this.uint8[V+5]=S,this.uint8[V+6]=E,this.uint8[V+7]=k,a}}wd.prototype.bytesPerElement=8,yi("StructArrayLayout2i4ub8",wd);class lr extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,h){const y=this.length;return this.resize(y+1),this.emplace(y,a,h)}emplace(a,h,y){const b=2*a;return this.float32[b+0]=h,this.float32[b+1]=y,a}}lr.prototype.bytesPerElement=8,yi("StructArrayLayout2f8",lr);class vo extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,h,y,b,S,E,k,F,V,H){const Y=this.length;return this.resize(Y+1),this.emplace(Y,a,h,y,b,S,E,k,F,V,H)}emplace(a,h,y,b,S,E,k,F,V,H,Y){const K=10*a;return this.uint16[K+0]=h,this.uint16[K+1]=y,this.uint16[K+2]=b,this.uint16[K+3]=S,this.uint16[K+4]=E,this.uint16[K+5]=k,this.uint16[K+6]=F,this.uint16[K+7]=V,this.uint16[K+8]=H,this.uint16[K+9]=Y,a}}vo.prototype.bytesPerElement=20,yi("StructArrayLayout10ui20",vo);class Ph extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,h,y,b,S,E,k,F){const V=this.length;return this.resize(V+1),this.emplace(V,a,h,y,b,S,E,k,F)}emplace(a,h,y,b,S,E,k,F,V){const H=8*a;return this.uint16[H+0]=h,this.uint16[H+1]=y,this.uint16[H+2]=b,this.uint16[H+3]=S,this.uint16[H+4]=E,this.uint16[H+5]=k,this.uint16[H+6]=F,this.uint16[H+7]=V,a}}Ph.prototype.bytesPerElement=16,yi("StructArrayLayout8ui16",Ph);class Zr extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,h,y,b,S,E,k,F,V,H,Y,K){const te=this.length;return this.resize(te+1),this.emplace(te,a,h,y,b,S,E,k,F,V,H,Y,K)}emplace(a,h,y,b,S,E,k,F,V,H,Y,K,te){const oe=12*a;return this.int16[oe+0]=h,this.int16[oe+1]=y,this.int16[oe+2]=b,this.int16[oe+3]=S,this.uint16[oe+4]=E,this.uint16[oe+5]=k,this.uint16[oe+6]=F,this.uint16[oe+7]=V,this.int16[oe+8]=H,this.int16[oe+9]=Y,this.int16[oe+10]=K,this.int16[oe+11]=te,a}}Zr.prototype.bytesPerElement=24,yi("StructArrayLayout4i4ui4i24",Zr);class Ih extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,h,y){const b=this.length;return this.resize(b+1),this.emplace(b,a,h,y)}emplace(a,h,y,b){const S=3*a;return this.float32[S+0]=h,this.float32[S+1]=y,this.float32[S+2]=b,a}}Ih.prototype.bytesPerElement=12,yi("StructArrayLayout3f12",Ih);class If extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(a){const h=this.length;return this.resize(h+1),this.emplace(h,a)}emplace(a,h){return this.uint32[1*a+0]=h,a}}If.prototype.bytesPerElement=4,yi("StructArrayLayout1ul4",If);class Jc extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,h,y,b,S,E,k,F,V){const H=this.length;return this.resize(H+1),this.emplace(H,a,h,y,b,S,E,k,F,V)}emplace(a,h,y,b,S,E,k,F,V,H){const Y=10*a,K=5*a;return this.int16[Y+0]=h,this.int16[Y+1]=y,this.int16[Y+2]=b,this.int16[Y+3]=S,this.int16[Y+4]=E,this.int16[Y+5]=k,this.uint32[K+3]=F,this.uint16[Y+8]=V,this.uint16[Y+9]=H,a}}Jc.prototype.bytesPerElement=20,yi("StructArrayLayout6i1ul2ui20",Jc);class Vl extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,h,y,b,S,E){const k=this.length;return this.resize(k+1),this.emplace(k,a,h,y,b,S,E)}emplace(a,h,y,b,S,E,k){const F=6*a;return this.int16[F+0]=h,this.int16[F+1]=y,this.int16[F+2]=b,this.int16[F+3]=S,this.int16[F+4]=E,this.int16[F+5]=k,a}}Vl.prototype.bytesPerElement=12,yi("StructArrayLayout2i2i2i12",Vl);class jl extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,h,y,b,S){const E=this.length;return this.resize(E+1),this.emplace(E,a,h,y,b,S)}emplace(a,h,y,b,S,E){const k=4*a,F=8*a;return this.float32[k+0]=h,this.float32[k+1]=y,this.float32[k+2]=b,this.int16[F+6]=S,this.int16[F+7]=E,a}}jl.prototype.bytesPerElement=16,yi("StructArrayLayout2f1f2i16",jl);class ea extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,h,y,b,S,E){const k=this.length;return this.resize(k+1),this.emplace(k,a,h,y,b,S,E)}emplace(a,h,y,b,S,E,k){const F=16*a,V=4*a,H=8*a;return this.uint8[F+0]=h,this.uint8[F+1]=y,this.float32[V+1]=b,this.float32[V+2]=S,this.int16[H+6]=E,this.int16[H+7]=k,a}}ea.prototype.bytesPerElement=16,yi("StructArrayLayout2ub2f2i16",ea);class Mr extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,h,y){const b=this.length;return this.resize(b+1),this.emplace(b,a,h,y)}emplace(a,h,y,b){const S=3*a;return this.uint16[S+0]=h,this.uint16[S+1]=y,this.uint16[S+2]=b,a}}Mr.prototype.bytesPerElement=6,yi("StructArrayLayout3ui6",Mr);class Gl extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,h,y,b,S,E,k,F,V,H,Y,K,te,oe,le,ue,xe){const De=this.length;return this.resize(De+1),this.emplace(De,a,h,y,b,S,E,k,F,V,H,Y,K,te,oe,le,ue,xe)}emplace(a,h,y,b,S,E,k,F,V,H,Y,K,te,oe,le,ue,xe,De){const we=24*a,Ee=12*a,Ne=48*a;return this.int16[we+0]=h,this.int16[we+1]=y,this.uint16[we+2]=b,this.uint16[we+3]=S,this.uint32[Ee+2]=E,this.uint32[Ee+3]=k,this.uint32[Ee+4]=F,this.uint16[we+10]=V,this.uint16[we+11]=H,this.uint16[we+12]=Y,this.float32[Ee+7]=K,this.float32[Ee+8]=te,this.uint8[Ne+36]=oe,this.uint8[Ne+37]=le,this.uint8[Ne+38]=ue,this.uint32[Ee+10]=xe,this.int16[we+22]=De,a}}Gl.prototype.bytesPerElement=48,yi("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Gl);class Fu extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,h,y,b,S,E,k,F,V,H,Y,K,te,oe,le,ue,xe,De,we,Ee,Ne,Ze,yt,Bt,Dt,jt,ai,Qt){const Ot=this.length;return this.resize(Ot+1),this.emplace(Ot,a,h,y,b,S,E,k,F,V,H,Y,K,te,oe,le,ue,xe,De,we,Ee,Ne,Ze,yt,Bt,Dt,jt,ai,Qt)}emplace(a,h,y,b,S,E,k,F,V,H,Y,K,te,oe,le,ue,xe,De,we,Ee,Ne,Ze,yt,Bt,Dt,jt,ai,Qt,Ot){const Ct=32*a,_i=16*a;return this.int16[Ct+0]=h,this.int16[Ct+1]=y,this.int16[Ct+2]=b,this.int16[Ct+3]=S,this.int16[Ct+4]=E,this.int16[Ct+5]=k,this.int16[Ct+6]=F,this.int16[Ct+7]=V,this.uint16[Ct+8]=H,this.uint16[Ct+9]=Y,this.uint16[Ct+10]=K,this.uint16[Ct+11]=te,this.uint16[Ct+12]=oe,this.uint16[Ct+13]=le,this.uint16[Ct+14]=ue,this.uint16[Ct+15]=xe,this.uint16[Ct+16]=De,this.uint16[Ct+17]=we,this.uint16[Ct+18]=Ee,this.uint16[Ct+19]=Ne,this.uint16[Ct+20]=Ze,this.uint16[Ct+21]=yt,this.uint16[Ct+22]=Bt,this.uint32[_i+12]=Dt,this.float32[_i+13]=jt,this.float32[_i+14]=ai,this.uint16[Ct+30]=Qt,this.uint16[Ct+31]=Ot,a}}Fu.prototype.bytesPerElement=64,yi("StructArrayLayout8i15ui1ul2f2ui64",Fu);class Nu extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a){const h=this.length;return this.resize(h+1),this.emplace(h,a)}emplace(a,h){return this.float32[1*a+0]=h,a}}Nu.prototype.bytesPerElement=4,yi("StructArrayLayout1f4",Nu);class kh extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,h,y){const b=this.length;return this.resize(b+1),this.emplace(b,a,h,y)}emplace(a,h,y,b){const S=3*a;return this.uint16[6*a+0]=h,this.float32[S+1]=y,this.float32[S+2]=b,a}}kh.prototype.bytesPerElement=12,yi("StructArrayLayout1ui2f12",kh);class hl extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,h,y){const b=this.length;return this.resize(b+1),this.emplace(b,a,h,y)}emplace(a,h,y,b){const S=4*a;return this.uint32[2*a+0]=h,this.uint16[S+2]=y,this.uint16[S+3]=b,a}}hl.prototype.bytesPerElement=8,yi("StructArrayLayout1ul2ui8",hl);class C extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,h){const y=this.length;return this.resize(y+1),this.emplace(y,a,h)}emplace(a,h,y){const b=2*a;return this.uint16[b+0]=h,this.uint16[b+1]=y,a}}C.prototype.bytesPerElement=4,yi("StructArrayLayout2ui4",C);class s extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a){const h=this.length;return this.resize(h+1),this.emplace(h,a)}emplace(a,h){return this.uint16[1*a+0]=h,a}}s.prototype.bytesPerElement=2,yi("StructArrayLayout1ui2",s);class g extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,h,y,b){const S=this.length;return this.resize(S+1),this.emplace(S,a,h,y,b)}emplace(a,h,y,b,S){const E=4*a;return this.float32[E+0]=h,this.float32[E+1]=y,this.float32[E+2]=b,this.float32[E+3]=S,a}}g.prototype.bytesPerElement=16,yi("StructArrayLayout4f16",g);class x extends Vn{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new M(this.anchorPointX,this.anchorPointY)}}x.prototype.size=20;class T extends Jc{get(a){return new x(this,a)}}yi("CollisionBoxArray",T);class I extends Vn{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(a){this._structArray.uint8[this._pos1+37]=a}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(a){this._structArray.uint8[this._pos1+38]=a}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(a){this._structArray.uint32[this._pos4+10]=a}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}I.prototype.size=48;class O extends Gl{get(a){return new I(this,a)}}yi("PlacedSymbolArray",O);class z extends Vn{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(a){this._structArray.uint32[this._pos4+12]=a}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}z.prototype.size=64;class G extends Fu{get(a){return new z(this,a)}}yi("SymbolInstanceArray",G);class q extends Nu{getoffsetX(a){return this.float32[1*a+0]}}yi("GlyphOffsetArray",q);class J extends qc{getx(a){return this.int16[3*a+0]}gety(a){return this.int16[3*a+1]}gettileUnitDistanceFromAnchor(a){return this.int16[3*a+2]}}yi("SymbolLineVertexArray",J);class re extends Vn{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}re.prototype.size=12;class ie extends kh{get(a){return new re(this,a)}}yi("TextAnchorOffsetArray",ie);class ce extends Vn{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}ce.prototype.size=8;class _e extends hl{get(a){return new ce(this,a)}}yi("FeatureIndexArray",_e);class Me extends Za{}class Pe extends Za{}class Ce extends Za{}class Oe extends Ul{}class We extends wd{}class ke extends lr{}class Ge extends vo{}class Xe extends Ph{}class Ue extends Zr{}class et extends Ih{}class At extends If{}class pt extends Vl{}class bt extends ea{}class _t extends Mr{}class ti extends C{}const ii=_r([{name:"a_pos",components:2,type:"Int16"}],4),{members:Wt}=ii;class ri{constructor(a=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=a}prepareSegment(a,h,y,b){const S=this.segments[this.segments.length-1];return a>ri.MAX_VERTEX_ARRAY_LENGTH&&br(`Max vertices per segment is ${ri.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${a}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${ri.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!S||S.vertexLength+a>ri.MAX_VERTEX_ARRAY_LENGTH||S.sortKey!==b?this.createNewSegment(h,y,b):S}createNewSegment(a,h,y){const b={vertexOffset:a.length,primitiveOffset:h.length,vertexLength:0,primitiveLength:0,vaos:{}};return y!==void 0&&(b.sortKey=y),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(b),b}getOrCreateLatestSegment(a,h,y){return this.prepareSegment(0,a,h,y)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const a of this.segments)for(const h in a.vaos)a.vaos[h].destroy()}static simpleSegment(a,h,y,b){return new ri([{vertexOffset:a,primitiveOffset:h,vertexLength:y,primitiveLength:b,vaos:{},sortKey:0}])}}function Ji(f,a){return 256*(f=Vi(Math.floor(f),0,255))+Vi(Math.floor(a),0,255)}ri.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,yi("SegmentVector",ri);const sn=_r([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),rr=_r([{name:"a_dasharray_from",components:4,type:"Uint16"},{name:"a_dasharray_to",components:4,type:"Uint16"}]);var sr,yr,qn,zr={exports:{}},vr={exports:{}},Gs={exports:{}},Xr=(function(){if(qn)return zr.exports;qn=1;var f=(sr||(sr=1,vr.exports=function(h,y){var b,S,E,k,F,V,H,Y;for(S=h.length-(b=3&h.length),E=y,F=3432918353,V=461845907,Y=0;Y<S;)H=255&h.charCodeAt(Y)|(255&h.charCodeAt(++Y))<<8|(255&h.charCodeAt(++Y))<<16|(255&h.charCodeAt(++Y))<<24,++Y,E=27492+(65535&(k=5*(65535&(E=(E^=H=(65535&(H=(H=(65535&H)*F+(((H>>>16)*F&65535)<<16)&4294967295)<<15|H>>>17))*V+(((H>>>16)*V&65535)<<16)&4294967295)<<13|E>>>19))+((5*(E>>>16)&65535)<<16)&4294967295))+((58964+(k>>>16)&65535)<<16);switch(H=0,b){case 3:H^=(255&h.charCodeAt(Y+2))<<16;case 2:H^=(255&h.charCodeAt(Y+1))<<8;case 1:E^=H=(65535&(H=(H=(65535&(H^=255&h.charCodeAt(Y)))*F+(((H>>>16)*F&65535)<<16)&4294967295)<<15|H>>>17))*V+(((H>>>16)*V&65535)<<16)&4294967295}return E^=h.length,E=2246822507*(65535&(E^=E>>>16))+((2246822507*(E>>>16)&65535)<<16)&4294967295,E=3266489909*(65535&(E^=E>>>13))+((3266489909*(E>>>16)&65535)<<16)&4294967295,(E^=E>>>16)>>>0}),vr.exports),a=(yr||(yr=1,Gs.exports=function(h,y){for(var b,S=h.length,E=y^S,k=0;S>=4;)b=1540483477*(65535&(b=255&h.charCodeAt(k)|(255&h.charCodeAt(++k))<<8|(255&h.charCodeAt(++k))<<16|(255&h.charCodeAt(++k))<<24))+((1540483477*(b>>>16)&65535)<<16),E=1540483477*(65535&E)+((1540483477*(E>>>16)&65535)<<16)^(b=1540483477*(65535&(b^=b>>>24))+((1540483477*(b>>>16)&65535)<<16)),S-=4,++k;switch(S){case 3:E^=(255&h.charCodeAt(k+2))<<16;case 2:E^=(255&h.charCodeAt(k+1))<<8;case 1:E=1540483477*(65535&(E^=255&h.charCodeAt(k)))+((1540483477*(E>>>16)&65535)<<16)}return E=1540483477*(65535&(E^=E>>>13))+((1540483477*(E>>>16)&65535)<<16),(E^=E>>>15)>>>0}),Gs.exports);return zr.exports=f,zr.exports.murmur3=f,zr.exports.murmur2=a,zr.exports})(),jn=D(Xr);class fr{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(a,h,y,b){this.ids.push(Os(a)),this.positions.push(h,y,b)}getPositions(a){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const h=Os(a);let y=0,b=this.ids.length-1;for(;y<b;){const E=y+b>>1;this.ids[E]>=h?b=E:y=E+1}const S=[];for(;this.ids[y]===h;)S.push({index:this.positions[3*y],start:this.positions[3*y+1],end:this.positions[3*y+2]}),y++;return S}static serialize(a,h){const y=new Float64Array(a.ids),b=new Uint32Array(a.positions);return Fs(y,b,0,y.length-1),h&&h.push(y.buffer,b.buffer),{ids:y,positions:b}}static deserialize(a){const h=new fr;return h.ids=a.ids,h.positions=a.positions,h.indexed=!0,h}}function Os(f){const a=+f;return!isNaN(a)&&a<=Number.MAX_SAFE_INTEGER?a:jn(String(f))}function Fs(f,a,h,y){for(;h<y;){const b=f[h+y>>1];let S=h-1,E=y+1;for(;;){do S++;while(f[S]<b);do E--;while(f[E]>b);if(S>=E)break;ws(f,S,E),ws(a,3*S,3*E),ws(a,3*S+1,3*E+1),ws(a,3*S+2,3*E+2)}E-h<y-E?(Fs(f,a,h,E),h=E+1):(Fs(f,a,E+1,y),y=E)}}function ws(f,a,h){const y=f[a];f[a]=f[h],f[h]=y}yi("FeaturePositionMap",fr);class Hr{constructor(a,h){this.gl=a.gl,this.location=h}}class ua extends Hr{constructor(a,h){super(a,h),this.current=0}set(a){this.current!==a&&(this.current=a,this.gl.uniform1f(this.location,a))}}class Wl extends Hr{constructor(a,h){super(a,h),this.current=[0,0,0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]&&a[3]===this.current[3]||(this.current=a,this.gl.uniform4f(this.location,a[0],a[1],a[2],a[3]))}}class jo extends Hr{constructor(a,h){super(a,h),this.current=Qi.transparent}set(a){a.r===this.current.r&&a.g===this.current.g&&a.b===this.current.b&&a.a===this.current.a||(this.current=a,this.gl.uniform4f(this.location,a.r,a.g,a.b,a.a))}}const Xa=new Float32Array(16);function xo(f){return[Ji(255*f.r,255*f.g),Ji(255*f.b,255*f.a)]}class Go{constructor(a,h,y){this.value=a,this.uniformNames=h.map((b=>`u_${b}`)),this.type=y}setUniform(a,h,y){a.set(y.constantOr(this.value))}getBinding(a,h,y){return this.type==="color"?new jo(a,h):new ua(a,h)}}class $r{constructor(a,h){this.uniformNames=h.map((y=>`u_${y}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(a,h){this.pixelRatioFrom=h.pixelRatio,this.pixelRatioTo=a.pixelRatio,this.patternFrom=h.tlbr,this.patternTo=a.tlbr}setConstantDashPositions(a,h){this.dashTo=[0,a.y,a.height,a.width],this.dashFrom=[0,h.y,h.height,h.width]}setUniform(a,h,y,b){let S=null;b==="u_pattern_to"?S=this.patternTo:b==="u_pattern_from"?S=this.patternFrom:b==="u_dasharray_to"?S=this.dashTo:b==="u_dasharray_from"?S=this.dashFrom:b==="u_pixel_ratio_to"?S=this.pixelRatioTo:b==="u_pixel_ratio_from"&&(S=this.pixelRatioFrom),S!==null&&a.set(S)}getBinding(a,h,y){return y.substr(0,9)==="u_pattern"||y.substr(0,12)==="u_dasharray_"?new Wl(a,h):new ua(a,h)}}class Xn{constructor(a,h,y,b){this.expression=a,this.type=y,this.maxValue=0,this.paintVertexAttributes=h.map((S=>({name:`a_${S}`,type:"Float32",components:y==="color"?2:1,offset:0}))),this.paintVertexArray=new b}populatePaintArray(a,h,y){const b=this.paintVertexArray.length,S=this.expression.evaluate(new Un(0,y),h,{},y.canonical,[],y.formattedSection);this.paintVertexArray.resize(a),this._setPaintValue(b,a,S)}updatePaintArray(a,h,y,b,S){const E=this.expression.evaluate(new Un(0,S),y,b);this._setPaintValue(a,h,E)}_setPaintValue(a,h,y){if(this.type==="color"){const b=xo(y);for(let S=a;S<h;S++)this.paintVertexArray.emplace(S,b[0],b[1])}else{for(let b=a;b<h;b++)this.paintVertexArray.emplace(b,y);this.maxValue=Math.max(this.maxValue,Math.abs(y))}}upload(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ar{constructor(a,h,y,b,S,E){this.expression=a,this.uniformNames=h.map((k=>`u_${k}_t`)),this.type=y,this.useIntegerZoom=b,this.zoom=S,this.maxValue=0,this.paintVertexAttributes=h.map((k=>({name:`a_${k}`,type:"Float32",components:y==="color"?4:2,offset:0}))),this.paintVertexArray=new E}populatePaintArray(a,h,y){const b=this.expression.evaluate(new Un(this.zoom,y),h,{},y.canonical,[],y.formattedSection),S=this.expression.evaluate(new Un(this.zoom+1,y),h,{},y.canonical,[],y.formattedSection),E=this.paintVertexArray.length;this.paintVertexArray.resize(a),this._setPaintValue(E,a,b,S)}updatePaintArray(a,h,y,b,S){const E=this.expression.evaluate(new Un(this.zoom,S),y,b),k=this.expression.evaluate(new Un(this.zoom+1,S),y,b);this._setPaintValue(a,h,E,k)}_setPaintValue(a,h,y,b){if(this.type==="color"){const S=xo(y),E=xo(b);for(let k=a;k<h;k++)this.paintVertexArray.emplace(k,S[0],S[1],E[0],E[1])}else{for(let S=a;S<h;S++)this.paintVertexArray.emplace(S,y,b);this.maxValue=Math.max(this.maxValue,Math.abs(y),Math.abs(b))}}upload(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(a,h){const y=this.useIntegerZoom?Math.floor(h.zoom):h.zoom,b=Vi(this.expression.interpolationFactor(y,this.zoom,this.zoom+1),0,1);a.set(b)}getBinding(a,h,y){return new ua(a,h)}}class gs{constructor(a,h,y,b,S,E){this.expression=a,this.type=h,this.useIntegerZoom=y,this.zoom=b,this.layerId=E,this.zoomInPaintVertexArray=new S,this.zoomOutPaintVertexArray=new S}populatePaintArray(a,h,y){const b=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(a),this.zoomOutPaintVertexArray.resize(a),this._setPaintValues(b,a,this.getPositionIds(h),y)}updatePaintArray(a,h,y,b,S){this._setPaintValues(a,h,this.getPositionIds(y),S)}_setPaintValues(a,h,y,b){const S=this.getPositions(b);if(!S||!y)return;const E=S[y.min],k=S[y.mid],F=S[y.max];if(E&&k&&F)for(let V=a;V<h;V++)this.emplace(this.zoomInPaintVertexArray,V,k,E),this.emplace(this.zoomOutPaintVertexArray,V,k,F)}upload(a){if(this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer){const h=this.getVertexAttributes();this.zoomInPaintVertexBuffer=a.createVertexBuffer(this.zoomInPaintVertexArray,h,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=a.createVertexBuffer(this.zoomOutPaintVertexArray,h,this.expression.isStateDependent)}}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Ts extends gs{getPositions(a){return a.imagePositions}getPositionIds(a){return a.patterns&&a.patterns[this.layerId]}getVertexAttributes(){return sn.members}emplace(a,h,y,b){a.emplace(h,y.tlbr[0],y.tlbr[1],y.tlbr[2],y.tlbr[3],b.tlbr[0],b.tlbr[1],b.tlbr[2],b.tlbr[3],y.pixelRatio,b.pixelRatio)}}class Td extends gs{getPositions(a){return a.dashPositions}getPositionIds(a){return a.dashes&&a.dashes[this.layerId]}getVertexAttributes(){return rr.members}emplace(a,h,y,b){a.emplace(h,0,y.y,y.height,y.width,0,b.y,b.height,b.width)}}class Sd{constructor(a,h,y){this.binders={},this._buffers=[];const b=[];for(const S in a.paint._values){if(!y(S))continue;const E=a.paint.get(S);if(!(E instanceof _o&&Bo(E.property.specification)))continue;const k=E0(S,a.type),F=E.value,V=E.property.specification.type,H=E.property.useIntegerZoom,Y=E.property.specification["property-type"],K=Y==="cross-faded"||Y==="cross-faded-data-driven";if(F.kind==="constant")this.binders[S]=K?new $r(F.value,k):new Go(F.value,k,V),b.push(`/u_${S}`);else if(F.kind==="source"||K){const te=yc(S,V,"source");this.binders[S]=K?S==="line-dasharray"?new Td(F,V,H,h,te,a.id):new Ts(F,V,H,h,te,a.id):new Xn(F,k,V,te),b.push(`/a_${S}`)}else{const te=yc(S,V,"composite");this.binders[S]=new ar(F,k,V,H,h,te),b.push(`/z_${S}`)}}this.cacheKey=b.sort().join("")}getMaxValue(a){const h=this.binders[a];return h instanceof Xn||h instanceof ar?h.maxValue:0}populatePaintArrays(a,h,y){for(const b in this.binders){const S=this.binders[b];(S instanceof Xn||S instanceof ar||S instanceof gs)&&S.populatePaintArray(a,h,y)}}setConstantPatternPositions(a,h){for(const y in this.binders){const b=this.binders[y];b instanceof $r&&b.setConstantPatternPositions(a,h)}}setConstantDashPositions(a,h){for(const y in this.binders){const b=this.binders[y];b instanceof $r&&b.setConstantDashPositions(a,h)}}updatePaintArrays(a,h,y,b,S){let E=!1;for(const k in a){const F=h.getPositions(k);for(const V of F){const H=y.feature(V.index);for(const Y in this.binders){const K=this.binders[Y];if((K instanceof Xn||K instanceof ar||K instanceof gs)&&K.expression.isStateDependent===!0){const te=b.paint.get(Y);K.expression=te.value,K.updatePaintArray(V.start,V.end,H,a[k],S),E=!0}}}}return E}defines(){const a=[];for(const h in this.binders){const y=this.binders[h];(y instanceof Go||y instanceof $r)&&a.push(...y.uniformNames.map((b=>`#define HAS_UNIFORM_${b}`)))}return a}getBinderAttributes(){const a=[];for(const h in this.binders){const y=this.binders[h];if(y instanceof Xn||y instanceof ar)for(let b=0;b<y.paintVertexAttributes.length;b++)a.push(y.paintVertexAttributes[b].name);else if(y instanceof gs){const b=y.getVertexAttributes();for(const S of b)a.push(S.name)}}return a}getBinderUniforms(){const a=[];for(const h in this.binders){const y=this.binders[h];if(y instanceof Go||y instanceof $r||y instanceof ar)for(const b of y.uniformNames)a.push(b)}return a}getPaintVertexBuffers(){return this._buffers}getUniforms(a,h){const y=[];for(const b in this.binders){const S=this.binders[b];if(S instanceof Go||S instanceof $r||S instanceof ar){for(const E of S.uniformNames)if(h[E]){const k=S.getBinding(a,h[E],E);y.push({name:E,property:b,binding:k})}}}return y}setUniforms(a,h,y,b){for(const{name:S,property:E,binding:k}of h)this.binders[E].setUniform(k,b,y.get(E),S)}updatePaintBuffers(a){this._buffers=[];for(const h in this.binders){const y=this.binders[h];if(a&&y instanceof gs){const b=a.fromScale===2?y.zoomInPaintVertexBuffer:y.zoomOutPaintVertexBuffer;b&&this._buffers.push(b)}else(y instanceof Xn||y instanceof ar)&&y.paintVertexBuffer&&this._buffers.push(y.paintVertexBuffer)}}upload(a){for(const h in this.binders){const y=this.binders[h];(y instanceof Xn||y instanceof ar||y instanceof gs)&&y.upload(a)}this.updatePaintBuffers()}destroy(){for(const a in this.binders){const h=this.binders[a];(h instanceof Xn||h instanceof ar||h instanceof gs)&&h.destroy()}}}class Qc{constructor(a,h,y=()=>!0){this.programConfigurations={};for(const b of a)this.programConfigurations[b.id]=new Sd(b,h,y);this.needsUpload=!1,this._featureMap=new fr,this._bufferOffset=0}populatePaintArrays(a,h,y,b){for(const S in this.programConfigurations)this.programConfigurations[S].populatePaintArrays(a,h,b);h.id!==void 0&&this._featureMap.add(h.id,y,this._bufferOffset,a),this._bufferOffset=a,this.needsUpload=!0}updatePaintArrays(a,h,y,b){for(const S of y)this.needsUpload=this.programConfigurations[S.id].updatePaintArrays(a,this._featureMap,h,S,b)||this.needsUpload}get(a){return this.programConfigurations[a]}upload(a){if(this.needsUpload){for(const h in this.programConfigurations)this.programConfigurations[h].upload(a);this.needsUpload=!1}}destroy(){for(const a in this.programConfigurations)this.programConfigurations[a].destroy()}}function E0(f,a){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-dasharray":["dasharray_to","dasharray_from"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[f]||[f.replace(`${a}-`,"").replace(/-/g,"_")]}function yc(f,a,h){const y={color:{source:lr,composite:g},number:{source:Nu,composite:lr}},b=(function(S){return{"line-pattern":{source:Ge,composite:Ge},"fill-pattern":{source:Ge,composite:Ge},"fill-extrusion-pattern":{source:Ge,composite:Ge},"line-dasharray":{source:Xe,composite:Xe}}[S]})(f);return b&&b[h]||y[a][h]}yi("ConstantBinder",Go),yi("CrossFadedConstantBinder",$r),yi("SourceExpressionBinder",Xn),yi("CrossFadedPatternBinder",Ts),yi("CrossFadedDasharrayBinder",Td),yi("CompositeExpressionBinder",ar),yi("ProgramConfiguration",Sd,{omit:["_buffers"]}),yi("ProgramConfigurationSet",Qc);const Ed=Math.pow(2,14)-1,vc=-Ed-1;function Ss(f){const a=li/f.extent,h=f.loadGeometry();for(let y=0;y<h.length;y++){const b=h[y];for(let S=0;S<b.length;S++){const E=b[S],k=Math.round(E.x*a),F=Math.round(E.y*a);E.x=Vi(k,vc,Ed),E.y=Vi(F,vc,Ed),(k<E.x||k>E.x+1||F<E.y||F>E.y+1)&&br("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return h}function as(f,a){return{type:f.type,id:f.id,properties:f.properties,geometry:a?Ss(f):[]}}const Kc=-32768;function kf(f,a,h,y,b){f.emplaceBack(Kc+8*a+y,Kc+8*h+b)}class xc{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map((h=>h.id)),this.index=a.index,this.hasDependencies=!1,this.layoutVertexArray=new Pe,this.indexArray=new _t,this.segments=new ri,this.programConfigurations=new Qc(a.layers,a.zoom),this.stateDependentLayerIds=this.layers.filter((h=>h.isStateDependent())).map((h=>h.id))}populate(a,h,y){const b=this.layers[0],S=[];let E=null,k=!1,F=b.type==="heatmap";if(b.type==="circle"){const H=b;E=H.layout.get("circle-sort-key"),k=!E.isConstant(),F=F||H.paint.get("circle-pitch-alignment")==="map"}const V=F?h.subdivisionGranularity.circle:1;for(const{feature:H,id:Y,index:K,sourceLayerIndex:te}of a){const oe=this.layers[0]._featureFilter.needGeometry,le=as(H,oe);if(!this.layers[0]._featureFilter.filter(new Un(this.zoom),le,y))continue;const ue=k?E.evaluate(le,{},y):void 0,xe={id:Y,properties:H.properties,type:H.type,sourceLayerIndex:te,index:K,geometry:oe?le.geometry:Ss(H),patterns:{},sortKey:ue};S.push(xe)}k&&S.sort(((H,Y)=>H.sortKey-Y.sortKey));for(const H of S){const{geometry:Y,index:K,sourceLayerIndex:te}=H,oe=a[K].feature;this.addFeature(H,Y,K,y,V),h.featureIndex.insert(oe,Y,K,te,this.index)}}update(a,h,y){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,h,this.stateDependentLayers,{imagePositions:y})}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Wt),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(a,h,y,b,S=1){let E;switch(S){case 1:E=[0,7];break;case 3:E=[0,2,5,7];break;case 5:E=[0,1,3,4,6,7];break;case 7:E=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${S}; valid values are 1, 3, 5, 7.`)}const k=E.length;for(const F of h)for(const V of F){const H=V.x,Y=V.y;if(H<0||H>=li||Y<0||Y>=li)continue;const K=this.segments.prepareSegment(k*k,this.layoutVertexArray,this.indexArray,a.sortKey),te=K.vertexLength;for(let oe=0;oe<k;oe++)for(let le=0;le<k;le++)kf(this.layoutVertexArray,H,Y,E[le],E[oe]);for(let oe=0;oe<k-1;oe++)for(let le=0;le<k-1;le++){const ue=te+oe*k+le,xe=te+(oe+1)*k+le;this.indexArray.emplaceBack(ue,xe+1,ue+1),this.indexArray.emplaceBack(ue,xe,xe+1)}K.vertexLength+=k*k,K.primitiveLength+=(k-1)*(k-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,y,{imagePositions:{},canonical:b})}}function Df(f,a){for(let h=0;h<f.length;h++)if(Zl(a,f[h]))return!0;for(let h=0;h<a.length;h++)if(Zl(f,a[h]))return!0;return!!Zs(f,a)}function Of(f,a,h){return!!Zl(f,a)||!!eu(a,f,h)}function Ff(f,a){if(f.length===1)return Hp(a,f[0]);for(let h=0;h<a.length;h++){const y=a[h];for(let b=0;b<y.length;b++)if(Zl(f,y[b]))return!0}for(let h=0;h<f.length;h++)if(Hp(a,f[h]))return!0;for(let h=0;h<a.length;h++)if(Zs(f,a[h]))return!0;return!1}function Ws(f,a,h){if(f.length>1){if(Zs(f,a))return!0;for(let y=0;y<a.length;y++)if(eu(a[y],f,h))return!0}for(let y=0;y<f.length;y++)if(eu(f[y],a,h))return!0;return!1}function Zs(f,a){if(f.length===0||a.length===0)return!1;for(let h=0;h<f.length-1;h++){const y=f[h],b=f[h+1];for(let S=0;S<a.length-1;S++)if(im(y,b,a[S],a[S+1]))return!0}return!1}function im(f,a,h,y){return Fa(f,h,y)!==Fa(a,h,y)&&Fa(f,a,h)!==Fa(f,a,y)}function eu(f,a,h){const y=h*h;if(a.length===1)return f.distSqr(a[0])<y;for(let b=1;b<a.length;b++)if(Xp(f,a[b-1],a[b])<y)return!0;return!1}function Xp(f,a,h){const y=a.distSqr(h);if(y===0)return f.distSqr(a);const b=((f.x-a.x)*(h.x-a.x)+(f.y-a.y)*(h.y-a.y))/y;return f.distSqr(b<0?a:b>1?h:h.sub(a)._mult(b)._add(a))}function Hp(f,a){let h,y,b,S=!1;for(let E=0;E<f.length;E++){h=f[E];for(let k=0,F=h.length-1;k<h.length;F=k++)y=h[k],b=h[F],y.y>a.y!=b.y>a.y&&a.x<(b.x-y.x)*(a.y-y.y)/(b.y-y.y)+y.x&&(S=!S)}return S}function Zl(f,a){let h=!1;for(let y=0,b=f.length-1;y<f.length;b=y++){const S=f[y],E=f[b];S.y>a.y!=E.y>a.y&&a.x<(E.x-S.x)*(a.y-S.y)/(E.y-S.y)+S.x&&(h=!h)}return h}function k_(f,a,h){const y=h[0],b=h[2];if(f.x<y.x&&a.x<y.x||f.x>b.x&&a.x>b.x||f.y<y.y&&a.y<y.y||f.y>b.y&&a.y>b.y)return!1;const S=Fa(f,a,h[0]);return S!==Fa(f,a,h[1])||S!==Fa(f,a,h[2])||S!==Fa(f,a,h[3])}function Xl(f,a,h){const y=a.paint.get(f).value;return y.kind==="constant"?y.value:h.programConfigurations.get(a.id).getMaxValue(f)}function bc(f){return Math.sqrt(f[0]*f[0]+f[1]*f[1])}function Md(f,a,h,y,b){if(!a[0]&&!a[1])return f;const S=M.convert(a)._mult(b);h==="viewport"&&S._rotate(-y);const E=[];for(let k=0;k<f.length;k++)E.push(f[k].sub(S));return E}function M0(f){const a=[];for(let h=0;h<f.length;h++){const y=f[h],b=a.at(-1);(h===0||b&&!y.equals(b))&&a.push(y)}return a}function Rd({queryGeometry:f,size:a},h){return Of(f,h,a)}function R0({queryGeometry:f,size:a,transform:h,unwrappedTileID:y,getElevation:b},S){return Of(f,S,a*(h.projectTileCoordinates(S.x,S.y,y,b).signedDistanceFromCamera/h.cameraToCenterDistance))}function Dh({queryGeometry:f,size:a,transform:h,unwrappedTileID:y,getElevation:b},S){const E=h.projectTileCoordinates(S.x,S.y,y,b).signedDistanceFromCamera,k=a*(h.cameraToCenterDistance/E);return Of(f,Oh(S,h,y,b),k)}function $p({queryGeometry:f,size:a,transform:h,unwrappedTileID:y,getElevation:b},S){return Of(f,Oh(S,h,y,b),a)}function C0({queryGeometry:f,size:a,transform:h,unwrappedTileID:y,getElevation:b,pitchAlignment:S="map",pitchScale:E="map"},k){const F=S==="map"?E==="map"?Rd:R0:E==="map"?Dh:$p,V={queryGeometry:f,size:a,transform:h,unwrappedTileID:y,getElevation:b};for(const H of k)for(const Y of H)if(F(V,Y))return!0;return!1}function Oh(f,a,h,y){const b=a.projectTileCoordinates(f.x,f.y,h,y).point;return new M((.5*b.x+.5)*a.width,(.5*-b.y+.5)*a.height)}let fl,nm;yi("CircleBucket",xc,{omit:["layers"]});var rm={get paint(){return nm=nm||new Er({"circle-radius":new Mi(Ke.paint_circle["circle-radius"]),"circle-color":new Mi(Ke.paint_circle["circle-color"]),"circle-blur":new Mi(Ke.paint_circle["circle-blur"]),"circle-opacity":new Mi(Ke.paint_circle["circle-opacity"]),"circle-translate":new xi(Ke.paint_circle["circle-translate"]),"circle-translate-anchor":new xi(Ke.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new xi(Ke.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new xi(Ke.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Mi(Ke.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Mi(Ke.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Mi(Ke.paint_circle["circle-stroke-opacity"])})},get layout(){return fl=fl||new Er({"circle-sort-key":new Mi(Ke.layout_circle["circle-sort-key"])})}};class qp extends rn{constructor(a,h){super(a,rm,h)}createBucket(a){return new xc(a)}queryRadius(a){const h=a;return Xl("circle-radius",this,h)+Xl("circle-stroke-width",this,h)+bc(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:a,feature:h,featureState:y,geometry:b,transform:S,pixelsToTileUnits:E,unwrappedTileID:k,getElevation:F}){const V=Md(a,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-S.bearingInRadians,E),H=this.paint.get("circle-radius").evaluate(h,y)+this.paint.get("circle-stroke-width").evaluate(h,y),Y=this.paint.get("circle-pitch-scale"),K=this.paint.get("circle-pitch-alignment");let te,oe;return K==="map"?(te=V,oe=H*E):(te=(function(le,ue,xe,De){return le.map((we=>Oh(we,ue,xe,De)))})(V,S,k,F),oe=H),C0({queryGeometry:te,size:oe,transform:S,unwrappedTileID:k,getElevation:F,pitchAlignment:K,pitchScale:Y},b)}}class Yp extends xc{}let sm;yi("HeatmapBucket",Yp,{omit:["layers"]});var am={get paint(){return sm=sm||new Er({"heatmap-radius":new Mi(Ke.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Mi(Ke.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new xi(Ke.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Rh(Ke.paint_heatmap["heatmap-color"]),"heatmap-opacity":new xi(Ke.paint_heatmap["heatmap-opacity"])})}};function Cd(f,{width:a,height:h},y,b){if(b){if(b instanceof Uint8ClampedArray)b=new Uint8Array(b.buffer);else if(b.length!==a*h*y)throw new RangeError(`mismatched image size. expected: ${b.length} but got: ${a*h*y}`)}else b=new Uint8Array(a*h*y);return f.width=a,f.height=h,f.data=b,f}function Ac(f,{width:a,height:h},y){if(a===f.width&&h===f.height)return;const b=Cd({},{width:a,height:h},y);P0(f,b,{x:0,y:0},{x:0,y:0},{width:Math.min(f.width,a),height:Math.min(f.height,h)},y),f.width=a,f.height=h,f.data=b.data}function P0(f,a,h,y,b,S){if(b.width===0||b.height===0)return a;if(b.width>f.width||b.height>f.height||h.x>f.width-b.width||h.y>f.height-b.height)throw new RangeError("out of range source coordinates for image copy");if(b.width>a.width||b.height>a.height||y.x>a.width-b.width||y.y>a.height-b.height)throw new RangeError("out of range destination coordinates for image copy");const E=f.data,k=a.data;if(E===k)throw new Error("srcData equals dstData, so image is already copied");for(let F=0;F<b.height;F++){const V=((h.y+F)*f.width+h.x)*S,H=((y.y+F)*a.width+y.x)*S;for(let Y=0;Y<b.width*S;Y++)k[H+Y]=E[V+Y]}return a}class I0{constructor(a,h){Cd(this,a,1,h)}resize(a){Ac(this,a,1)}clone(){return new I0({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(a,h,y,b,S){P0(a,h,y,b,S,1)}}class Ha{constructor(a,h){Cd(this,a,4,h)}resize(a){Ac(this,a,4)}replace(a,h){h?this.data.set(a):this.data=a instanceof Uint8ClampedArray?new Uint8Array(a.buffer):a}clone(){return new Ha({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(a,h,y,b,S){P0(a,h,y,b,S,4)}setPixel(a,h,y){const b=4*(a*this.width+h);this.data[b+0]=Math.round(255*y.r/y.a),this.data[b+1]=Math.round(255*y.g/y.a),this.data[b+2]=Math.round(255*y.b/y.a),this.data[b+3]=Math.round(255*y.a)}}function tu(f){const a={},h=f.resolution||256,y=f.clips?f.clips.length:1,b=f.image||new Ha({width:h,height:y});if(Math.log(h)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${h}`);const S=(E,k,F)=>{a[f.evaluationKey]=F;const V=f.expression.evaluate(a);b.setPixel(E/4/h,k/4,V)};if(f.clips)for(let E=0,k=0;E<y;++E,k+=4*h)for(let F=0,V=0;F<h;F++,V+=4){const H=F/(h-1),{start:Y,end:K}=f.clips[E];S(k,V,Y*(1-H)+K*H)}else for(let E=0,k=0;E<h;E++,k+=4)S(0,k,E/(h-1));return b}yi("AlphaImage",I0),yi("RGBAImage",Ha);const k0="big-fb";class D_ extends rn{createBucket(a){return new Yp(a)}constructor(a,h){super(a,am,h),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){a==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=tu({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(k0)&&this.heatmapFbos.delete(k0)}queryRadius(a){return Xl("heatmap-radius",this,a)}queryIntersectsFeature({queryGeometry:a,feature:h,featureState:y,geometry:b,transform:S,pixelsToTileUnits:E,unwrappedTileID:k,getElevation:F}){return C0({queryGeometry:a,size:this.paint.get("heatmap-radius").evaluate(h,y)*E,transform:S,unwrappedTileID:k,getElevation:F},b)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&!this.isHidden()}}let D0;var O0={get paint(){return D0=D0||new Er({"hillshade-illumination-direction":new xi(Ke.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new xi(Ke.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new xi(Ke.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new xi(Ke.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new xi(Ke.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new xi(Ke.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new xi(Ke.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new xi(Ke.paint_hillshade["hillshade-method"])})}};class Lr extends rn{constructor(a,h){super(a,O0,h),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let a=this.paint.get("hillshade-illumination-direction").values,h=this.paint.get("hillshade-illumination-altitude").values,y=this.paint.get("hillshade-highlight-color").values,b=this.paint.get("hillshade-shadow-color").values;const S=Math.max(a.length,h.length,y.length,b.length);a=a.concat(Array(S-a.length).fill(a.at(-1))),h=h.concat(Array(S-h.length).fill(h.at(-1))),y=y.concat(Array(S-y.length).fill(y.at(-1))),b=b.concat(Array(S-b.length).fill(b.at(-1)));const E=h.map(Qr);return{directionRadians:a.map(Qr),altitudeRadians:E,shadowColor:b,highlightColor:y}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&!this.isHidden()}}let Jp;var o2={get paint(){return Jp=Jp||new Er({"color-relief-opacity":new xi(Ke["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new Rh(Ke["paint_color-relief"]["color-relief-color"])})}};class Fh{constructor(a,h,y,b){this.context=a,this.format=y,this.texture=a.gl.createTexture(),this.update(h,b)}update(a,h,y){const{width:b,height:S}=a,E=!(this.size&&this.size[0]===b&&this.size[1]===S||y),{context:k}=this,{gl:F}=k;if(this.useMipmap=!!(h&&h.useMipmap),F.bindTexture(F.TEXTURE_2D,this.texture),k.pixelStoreUnpackFlipY.set(!1),k.pixelStoreUnpack.set(1),k.pixelStoreUnpackPremultiplyAlpha.set(this.format===F.RGBA&&(!h||h.premultiply!==!1)),E)this.size=[b,S],a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof HTMLVideoElement||a instanceof ImageData||xl(a)?F.texImage2D(F.TEXTURE_2D,0,this.format,this.format,F.UNSIGNED_BYTE,a):F.texImage2D(F.TEXTURE_2D,0,this.format,b,S,0,this.format,F.UNSIGNED_BYTE,a.data);else{const{x:V,y:H}=y||{x:0,y:0};a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof HTMLVideoElement||a instanceof ImageData||xl(a)?F.texSubImage2D(F.TEXTURE_2D,0,V,H,F.RGBA,F.UNSIGNED_BYTE,a):F.texSubImage2D(F.TEXTURE_2D,0,V,H,b,S,F.RGBA,F.UNSIGNED_BYTE,a.data)}this.useMipmap&&this.isSizePowerOfTwo()&&F.generateMipmap(F.TEXTURE_2D),k.pixelStoreUnpackFlipY.setDefault(),k.pixelStoreUnpack.setDefault(),k.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(a,h,y){const{context:b}=this,{gl:S}=b;S.bindTexture(S.TEXTURE_2D,this.texture),y!==S.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(y=S.LINEAR),a!==this.filter&&(S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MAG_FILTER,a),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MIN_FILTER,y||a),this.filter=a),h!==this.wrap&&(S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_S,h),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_T,h),this.wrap=h)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:a}=this.context;a.deleteTexture(this.texture),this.texture=null}}class Pd{constructor(a,h,y,b=1,S=1,E=1,k=0){if(this.uid=a,h.height!==h.width)throw new RangeError("DEM tiles must be square");if(y&&!["mapbox","terrarium","custom"].includes(y))return void br(`"${y}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=h.height;const F=this.dim=h.height-2;switch(this.data=new Uint32Array(h.data.buffer),y){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=b,this.greenFactor=S,this.blueFactor=E,this.baseShift=k;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let V=0;V<F;V++)this.data[this._idx(-1,V)]=this.data[this._idx(0,V)],this.data[this._idx(F,V)]=this.data[this._idx(F-1,V)],this.data[this._idx(V,-1)]=this.data[this._idx(V,0)],this.data[this._idx(V,F)]=this.data[this._idx(V,F-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(F,-1)]=this.data[this._idx(F-1,0)],this.data[this._idx(-1,F)]=this.data[this._idx(0,F-1)],this.data[this._idx(F,F)]=this.data[this._idx(F-1,F-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let V=0;V<F;V++)for(let H=0;H<F;H++){const Y=this.get(V,H);Y>this.max&&(this.max=Y),Y<this.min&&(this.min=Y)}}get(a,h){const y=new Uint8Array(this.data.buffer),b=4*this._idx(a,h);return this.unpack(y[b],y[b+1],y[b+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(a,h){if(a<-1||a>=this.dim+1||h<-1||h>=this.dim+1)throw new RangeError(`Out of range source coordinates for DEM data. x: ${a}, y: ${h}, dim: ${this.dim}`);return(h+1)*this.stride+(a+1)}unpack(a,h,y){return a*this.redFactor+h*this.greenFactor+y*this.blueFactor-this.baseShift}pack(a){return Bu(a,this.getUnpackVector())}getPixels(){return new Ha({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(a,h,y){if(this.dim!==a.dim)throw new Error("dem dimension mismatch");let b=h*this.dim,S=h*this.dim+this.dim,E=y*this.dim,k=y*this.dim+this.dim;switch(h){case-1:b=S-1;break;case 1:S=b+1}switch(y){case-1:E=k-1;break;case 1:k=E+1}const F=-h*this.dim,V=-y*this.dim;for(let H=E;H<k;H++)for(let Y=b;Y<S;Y++)this.data[this._idx(Y,H)]=a.data[this._idx(Y+F,H+V)]}}function Bu(f,a){const h=a[0],y=a[1],b=a[2],S=a[3],E=Math.min(h,y,b),k=Math.round((f+S)/E);return{r:Math.floor(k*E/h)%256,g:Math.floor(k*E/y)%256,b:Math.floor(k*E/b)%256}}yi("DEMData",Pd);class om extends rn{constructor(a,h){super(a,o2,h)}_createColorRamp(a){const h={elevationStops:[],colorStops:[]},y=this._transitionablePaint._values["color-relief-color"].value.expression;if(y instanceof Pa&&y._styleExpression.expression instanceof is){this.colorRampExpression=y;const E=y._styleExpression.expression;h.elevationStops=E.labels,h.colorStops=[];for(const k of h.elevationStops)h.colorStops.push(E.evaluate({globals:{elevation:k}}))}if(h.elevationStops.length<1&&(h.elevationStops=[0],h.colorStops=[Qi.transparent]),h.elevationStops.length<2&&(h.elevationStops.push(h.elevationStops[0]+1),h.colorStops.push(h.colorStops[0])),h.elevationStops.length<=a)return h;const b={elevationStops:[],colorStops:[]},S=(h.elevationStops.length-1)/(a-1);for(let E=0;E<h.elevationStops.length-.5;E+=S)b.elevationStops.push(h.elevationStops[Math.round(E)]),b.colorStops.push(h.colorStops[Math.round(E)]);return br(`Too many colors in specification of ${this.id} color-relief layer, may not render properly. Max possible colors: ${a}, provided: ${h.elevationStops.length}`),b}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(a,h,y){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const b=this._createColorRamp(h),S=new Ha({width:b.colorStops.length,height:1}),E=new Ha({width:b.colorStops.length,height:1});for(let k=0;k<b.elevationStops.length;k++){const F=Bu(b.elevationStops[k],y);E.setPixel(0,k,new Qi(F.r/255,F.g/255,F.b/255,1)),S.setPixel(0,k,b.colorStops[k])}return this.colorRampTextures={elevationTexture:new Fh(a,E,a.gl.RGBA),colorTexture:new Fh(a,S,a.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return!this.isHidden()&&!!this.colorRampTextures}}const O_=_r([{name:"a_pos",components:2,type:"Int16"}],4),{members:F0}=O_;function dl(f,a,h){const y=h.patternDependencies;let b=!1;for(const S of a){const E=S.paint.get(`${f}-pattern`);E.isConstant()||(b=!0);const k=E.constantOr(null);k&&(b=!0,y[k.to]=!0,y[k.from]=!0)}return b}function Qp(f,a,h,y,b){const{zoom:S}=y,E=b.patternDependencies;for(const k of a){const F=k.paint.get(`${f}-pattern`).value;if(F.kind!=="constant"){let V=F.evaluate({zoom:S-1},h,{},b.availableImages),H=F.evaluate({zoom:S},h,{},b.availableImages),Y=F.evaluate({zoom:S+1},h,{},b.availableImages);V=V&&V.name?V.name:V,H=H&&H.name?H.name:H,Y=Y&&Y.name?Y.name:Y,E[V]=!0,E[H]=!0,E[Y]=!0,h.patterns[k.id]={min:V,mid:H,max:Y}}}return h}function Kp(f,a,h,y,b){let S;if(b===(function(E,k,F,V){let H=0;for(let Y=k,K=F-V;Y<F;Y+=V)H+=(E[K]-E[Y])*(E[Y+1]+E[K+1]),K=Y;return H})(f,a,h,y)>0)for(let E=a;E<h;E+=y)S=bo(E/y|0,f[E],f[E+1],S);else for(let E=h-y;E>=a;E-=y)S=bo(E/y|0,f[E],f[E+1],S);return S&&Wo(S,S.next)&&(Ao(S),S=S.next),S}function Nh(f,a){if(!f)return f;a||(a=f);let h,y=f;do if(h=!1,y.steiner||!Wo(y,y.next)&&Fn(y.prev,y,y.next)!==0)y=y.next;else{if(Ao(y),y=a=y.prev,y===y.next)break;h=!0}while(h||y!==a);return a}function Nf(f,a,h,y,b,S,E){if(!f)return;!E&&S&&(function(F,V,H,Y){let K=F;do K.z===0&&(K.z=Ns(K.x,K.y,V,H,Y)),K.prevZ=K.prev,K.nextZ=K.next,K=K.next;while(K!==F);K.prevZ.nextZ=null,K.prevZ=null,(function(te){let oe,le=1;do{let ue,xe=te;te=null;let De=null;for(oe=0;xe;){oe++;let we=xe,Ee=0;for(let Ze=0;Ze<le&&(Ee++,we=we.nextZ,we);Ze++);let Ne=le;for(;Ee>0||Ne>0&&we;)Ee!==0&&(Ne===0||!we||xe.z<=we.z)?(ue=xe,xe=xe.nextZ,Ee--):(ue=we,we=we.nextZ,Ne--),De?De.nextZ=ue:te=ue,ue.prevZ=De,De=ue;xe=we}De.nextZ=null,le*=2}while(oe>1)})(K)})(f,y,b,S);let k=f;for(;f.prev!==f.next;){const F=f.prev,V=f.next;if(S?N0(f,y,b,S):lm(f))a.push(F.i,f.i,V.i),Ao(f),f=V.next,k=V.next;else if((f=V)===k){E?E===1?Nf(f=cm(Nh(f),a),a,h,y,b,S,2):E===2&&zu(f,a,h,y,b,S):Nf(Nh(f),a,h,y,b,S,1);break}}}function lm(f){const a=f.prev,h=f,y=f.next;if(Fn(a,h,y)>=0)return!1;const b=a.x,S=h.x,E=y.x,k=a.y,F=h.y,V=y.y,H=Math.min(b,S,E),Y=Math.min(k,F,V),K=Math.max(b,S,E),te=Math.max(k,F,V);let oe=y.next;for(;oe!==a;){if(oe.x>=H&&oe.x<=K&&oe.y>=Y&&oe.y<=te&&Id(b,k,S,F,E,V,oe.x,oe.y)&&Fn(oe.prev,oe,oe.next)>=0)return!1;oe=oe.next}return!0}function N0(f,a,h,y){const b=f.prev,S=f,E=f.next;if(Fn(b,S,E)>=0)return!1;const k=b.x,F=S.x,V=E.x,H=b.y,Y=S.y,K=E.y,te=Math.min(k,F,V),oe=Math.min(H,Y,K),le=Math.max(k,F,V),ue=Math.max(H,Y,K),xe=Ns(te,oe,a,h,y),De=Ns(le,ue,a,h,y);let we=f.prevZ,Ee=f.nextZ;for(;we&&we.z>=xe&&Ee&&Ee.z<=De;){if(we.x>=te&&we.x<=le&&we.y>=oe&&we.y<=ue&&we!==b&&we!==E&&Id(k,H,F,Y,V,K,we.x,we.y)&&Fn(we.prev,we,we.next)>=0||(we=we.prevZ,Ee.x>=te&&Ee.x<=le&&Ee.y>=oe&&Ee.y<=ue&&Ee!==b&&Ee!==E&&Id(k,H,F,Y,V,K,Ee.x,Ee.y)&&Fn(Ee.prev,Ee,Ee.next)>=0))return!1;Ee=Ee.nextZ}for(;we&&we.z>=xe;){if(we.x>=te&&we.x<=le&&we.y>=oe&&we.y<=ue&&we!==b&&we!==E&&Id(k,H,F,Y,V,K,we.x,we.y)&&Fn(we.prev,we,we.next)>=0)return!1;we=we.prevZ}for(;Ee&&Ee.z<=De;){if(Ee.x>=te&&Ee.x<=le&&Ee.y>=oe&&Ee.y<=ue&&Ee!==b&&Ee!==E&&Id(k,H,F,Y,V,K,Ee.x,Ee.y)&&Fn(Ee.prev,Ee,Ee.next)>=0)return!1;Ee=Ee.nextZ}return!0}function cm(f,a){let h=f;do{const y=h.prev,b=h.next.next;!Wo(y,b)&&fm(y,h,h.next,b)&&L0(y,b)&&L0(b,y)&&(a.push(y.i,h.i,b.i),Ao(h),Ao(h.next),h=f=b),h=h.next}while(h!==f);return Nh(h)}function zu(f,a,h,y,b,S){let E=f;do{let k=E.next.next;for(;k!==E.prev;){if(E.i!==k.i&&os(E,k)){let F=kd(E,k);return E=Nh(E,E.next),F=Nh(F,F.next),Nf(E,a,h,y,b,S,0),void Nf(F,a,h,y,b,S,0)}k=k.next}E=E.next}while(E!==f)}function Xs(f,a){let h=f.x-a.x;return h===0&&(h=f.y-a.y,h===0)&&(h=(f.next.y-f.y)/(f.next.x-f.x)-(a.next.y-a.y)/(a.next.x-a.x)),h}function eg(f,a){const h=(function(b,S){let E=S;const k=b.x,F=b.y;let V,H=-1/0;if(Wo(b,E))return E;do{if(Wo(b,E.next))return E.next;if(F<=E.y&&F>=E.next.y&&E.next.y!==E.y){const le=E.x+(F-E.y)*(E.next.x-E.x)/(E.next.y-E.y);if(le<=k&&le>H&&(H=le,V=E.x<E.next.x?E:E.next,le===k))return V}E=E.next}while(E!==S);if(!V)return null;const Y=V,K=V.x,te=V.y;let oe=1/0;E=V;do{if(k>=E.x&&E.x>=K&&k!==E.x&&hm(F<te?k:H,F,K,te,F<te?H:k,F,E.x,E.y)){const le=Math.abs(F-E.y)/(k-E.x);L0(E,b)&&(le<oe||le===oe&&(E.x>V.x||E.x===V.x&&um(V,E)))&&(V=E,oe=le)}E=E.next}while(E!==Y);return V})(f,a);if(!h)return a;const y=kd(h,f);return Nh(y,y.next),Nh(h,h.next)}function um(f,a){return Fn(f.prev,f,a.prev)<0&&Fn(a.next,f,f.next)<0}function Ns(f,a,h,y,b){return(f=1431655765&((f=858993459&((f=252645135&((f=16711935&((f=(f-h)*b|0)|f<<8))|f<<4))|f<<2))|f<<1))|(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-y)*b|0)|a<<8))|a<<4))|a<<2))|a<<1))<<1}function l2(f){let a=f,h=f;do(a.x<h.x||a.x===h.x&&a.y<h.y)&&(h=a),a=a.next;while(a!==f);return h}function hm(f,a,h,y,b,S,E,k){return(b-E)*(a-k)>=(f-E)*(S-k)&&(f-E)*(y-k)>=(h-E)*(a-k)&&(h-E)*(S-k)>=(b-E)*(y-k)}function Id(f,a,h,y,b,S,E,k){return!(f===E&&a===k)&&hm(f,a,h,y,b,S,E,k)}function os(f,a){return f.next.i!==a.i&&f.prev.i!==a.i&&!(function(h,y){let b=h;do{if(b.i!==h.i&&b.next.i!==h.i&&b.i!==y.i&&b.next.i!==y.i&&fm(b,b.next,h,y))return!0;b=b.next}while(b!==h);return!1})(f,a)&&(L0(f,a)&&L0(a,f)&&(function(h,y){let b=h,S=!1;const E=(h.x+y.x)/2,k=(h.y+y.y)/2;do b.y>k!=b.next.y>k&&b.next.y!==b.y&&E<(b.next.x-b.x)*(k-b.y)/(b.next.y-b.y)+b.x&&(S=!S),b=b.next;while(b!==h);return S})(f,a)&&(Fn(f.prev,f,a.prev)||Fn(f,a.prev,a))||Wo(f,a)&&Fn(f.prev,f,f.next)>0&&Fn(a.prev,a,a.next)>0)}function Fn(f,a,h){return(a.y-f.y)*(h.x-a.x)-(a.x-f.x)*(h.y-a.y)}function Wo(f,a){return f.x===a.x&&f.y===a.y}function fm(f,a,h,y){const b=z0(Fn(f,a,h)),S=z0(Fn(f,a,y)),E=z0(Fn(h,y,f)),k=z0(Fn(h,y,a));return b!==S&&E!==k||!(b!==0||!B0(f,h,a))||!(S!==0||!B0(f,y,a))||!(E!==0||!B0(h,f,y))||!(k!==0||!B0(h,a,y))}function B0(f,a,h){return a.x<=Math.max(f.x,h.x)&&a.x>=Math.min(f.x,h.x)&&a.y<=Math.max(f.y,h.y)&&a.y>=Math.min(f.y,h.y)}function z0(f){return f>0?1:f<0?-1:0}function L0(f,a){return Fn(f.prev,f,f.next)<0?Fn(f,a,f.next)>=0&&Fn(f,f.prev,a)>=0:Fn(f,a,f.prev)<0||Fn(f,f.next,a)<0}function kd(f,a){const h=U0(f.i,f.x,f.y),y=U0(a.i,a.x,a.y),b=f.next,S=a.prev;return f.next=a,a.prev=f,h.next=b,b.prev=h,y.next=h,h.prev=y,S.next=y,y.prev=S,y}function bo(f,a,h,y){const b=U0(f,a,h);return y?(b.next=y.next,b.prev=y,y.next.prev=b,y.next=b):(b.prev=b,b.next=b),b}function Ao(f){f.next.prev=f.prev,f.prev.next=f.next,f.prevZ&&(f.prevZ.nextZ=f.nextZ),f.nextZ&&(f.nextZ.prevZ=f.prevZ)}function U0(f,a,h){return{i:f,x:a,y:h,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class ta{constructor(a,h){if(h>a)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=a,this._minGranularity=h}getGranularityForZoomLevel(a){return Math.max(Math.floor(this._baseZoomGranularity/(1<<a)),this._minGranularity,1)}}class Dd{constructor(a){this.fill=a.fill,this.line=a.line,this.tile=a.tile,this.stencil=a.stencil,this.circle=a.circle}}Dd.noSubdivision=new Dd({fill:new ta(0,0),line:new ta(0,0),tile:new ta(0,0),stencil:new ta(0,0),circle:1}),yi("SubdivisionGranularityExpression",ta),yi("SubdivisionGranularitySetting",Dd);const Zo=-32768,Hl=32767;class Lu{constructor(a,h){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=a,this._granularityCellSize=li/a,this._canonical=h}_getKey(a,h){return(a+=32768)<<16|h+32768}_vertexToIndex(a,h){if(a<-32768||h<-32768||a>32767||h>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const y=0|Math.round(a),b=0|Math.round(h),S=this._getKey(y,b);if(this._vertexDictionary.has(S))return this._vertexDictionary.get(S);const E=this._vertexBuffer.length/2;return this._vertexDictionary.set(S,E),this._vertexBuffer.push(y,b),E}_subdivideTrianglesScanline(a){if(this._granularity<2)return(function(b,S){const E=[];for(let k=0;k<S.length;k+=3){const F=S[k],V=S[k+1],H=S[k+2],Y=b[2*F],K=b[2*F+1];(b[2*V]-Y)*(b[2*H+1]-K)-(b[2*V+1]-K)*(b[2*H]-Y)>0?(E.push(F),E.push(H),E.push(V)):(E.push(F),E.push(V),E.push(H))}return E})(this._vertexBuffer,a);const h=[],y=a.length;for(let b=0;b<y;b+=3){const S=[a[b+0],a[b+1],a[b+2]],E=[this._vertexBuffer[2*a[b+0]+0],this._vertexBuffer[2*a[b+0]+1],this._vertexBuffer[2*a[b+1]+0],this._vertexBuffer[2*a[b+1]+1],this._vertexBuffer[2*a[b+2]+0],this._vertexBuffer[2*a[b+2]+1]];let k=1/0,F=1/0,V=-1/0,H=-1/0;for(let le=0;le<3;le++){const ue=E[2*le],xe=E[2*le+1];k=Math.min(k,ue),V=Math.max(V,ue),F=Math.min(F,xe),H=Math.max(H,xe)}if(k===V||F===H)continue;const Y=Math.floor(k/this._granularityCellSize),K=Math.ceil(V/this._granularityCellSize),te=Math.floor(F/this._granularityCellSize),oe=Math.ceil(H/this._granularityCellSize);if(Y!==K||te!==oe)for(let le=te;le<oe;le++){const ue=this._scanlineGenerateVertexRingForCellRow(le,E,S);wc(this._vertexBuffer,ue,h)}else h.push(...S)}return h}_scanlineGenerateVertexRingForCellRow(a,h,y){const b=a*this._granularityCellSize,S=b+this._granularityCellSize,E=[];for(let k=0;k<3;k++){const F=h[2*k],V=h[2*k+1],H=h[2*(k+1)%6],Y=h[(2*(k+1)+1)%6],K=h[2*(k+2)%6],te=h[(2*(k+2)+1)%6],oe=H-F,le=Y-V,ue=oe===0,xe=le===0,De=(b-V)/le,we=(S-V)/le,Ee=Math.min(De,we),Ne=Math.max(De,we);if(!xe&&(Ee>=1||Ne<=0)||xe&&(V<b||V>S)){Y>=b&&Y<=S&&E.push(y[(k+1)%3]);continue}!xe&&Ee>0&&E.push(this._vertexToIndex(F+oe*Ee,V+le*Ee));const Ze=F+oe*Math.max(Ee,0),yt=F+oe*Math.min(Ne,1);ue||this._generateIntraEdgeVertices(E,F,V,H,Y,Ze,yt),!xe&&Ne<1&&E.push(this._vertexToIndex(F+oe*Ne,V+le*Ne)),(xe||Y>=b&&Y<=S)&&E.push(y[(k+1)%3]),!xe&&(Y<=b||Y>=S)&&this._generateInterEdgeVertices(E,F,V,H,Y,K,te,yt,b,S)}return E}_generateIntraEdgeVertices(a,h,y,b,S,E,k){const F=b-h,V=S-y,H=V===0,Y=H?Math.min(h,b):Math.min(E,k),K=H?Math.max(h,b):Math.max(E,k),te=Math.floor(Y/this._granularityCellSize)+1,oe=Math.ceil(K/this._granularityCellSize)-1;if(H?h<b:E<k)for(let le=te;le<=oe;le++){const ue=le*this._granularityCellSize;a.push(this._vertexToIndex(ue,y+V*(ue-h)/F))}else for(let le=oe;le>=te;le--){const ue=le*this._granularityCellSize;a.push(this._vertexToIndex(ue,y+V*(ue-h)/F))}}_generateInterEdgeVertices(a,h,y,b,S,E,k,F,V,H){const Y=S-y,K=E-b,te=k-S,oe=(V-S)/te,le=(H-S)/te,ue=Math.min(oe,le),xe=Math.max(oe,le),De=b+K*ue;let we=Math.floor(Math.min(De,F)/this._granularityCellSize)+1,Ee=Math.ceil(Math.max(De,F)/this._granularityCellSize)-1,Ne=F<De;const Ze=te===0;if(Ze&&(k===V||k===H))return;if(Ze||ue>=1||xe<=0){const Bt=y-k,Dt=E+(h-E)*Math.min((V-k)/Bt,(H-k)/Bt);we=Math.floor(Math.min(Dt,F)/this._granularityCellSize)+1,Ee=Math.ceil(Math.max(Dt,F)/this._granularityCellSize)-1,Ne=F<Dt}const yt=Y>0?H:V;if(Ne)for(let Bt=we;Bt<=Ee;Bt++)a.push(this._vertexToIndex(Bt*this._granularityCellSize,yt));else for(let Bt=Ee;Bt>=we;Bt--)a.push(this._vertexToIndex(Bt*this._granularityCellSize,yt))}_generateOutline(a){const h=[];for(const y of a){const b=iu(y,this._granularity,!0),S=this._pointArrayToIndices(b),E=[];for(let k=1;k<S.length;k++)E.push(S[k-1]),E.push(S[k]);h.push(E)}return h}_handlePoles(a){let h=!1,y=!1;this._canonical&&(this._canonical.y===0&&(h=!0),this._canonical.y===(1<<this._canonical.z)-1&&(y=!0)),(h||y)&&this._fillPoles(a,h,y)}_ensureNoPoleVertices(){const a=this._vertexBuffer;for(let h=0;h<a.length;h+=2){const y=a[h+1];y===Zo&&(a[h+1]=-32767),y===Hl&&(a[h+1]=32766)}}_generatePoleQuad(a,h,y,b,S,E){b>S!=(E===Zo)?(a.push(h),a.push(y),a.push(this._vertexToIndex(b,E)),a.push(y),a.push(this._vertexToIndex(S,E)),a.push(this._vertexToIndex(b,E))):(a.push(y),a.push(h),a.push(this._vertexToIndex(b,E)),a.push(this._vertexToIndex(S,E)),a.push(y),a.push(this._vertexToIndex(b,E)))}_fillPoles(a,h,y){const b=this._vertexBuffer,S=li,E=a.length;for(let k=2;k<E;k+=3){const F=a[k-2],V=a[k-1],H=a[k],Y=b[2*F],K=b[2*F+1],te=b[2*V],oe=b[2*V+1],le=b[2*H],ue=b[2*H+1];h&&(K===0&&oe===0&&this._generatePoleQuad(a,F,V,Y,te,Zo),oe===0&&ue===0&&this._generatePoleQuad(a,V,H,te,le,Zo),ue===0&&K===0&&this._generatePoleQuad(a,H,F,le,Y,Zo)),y&&(K===S&&oe===S&&this._generatePoleQuad(a,F,V,Y,te,Hl),oe===S&&ue===S&&this._generatePoleQuad(a,V,H,te,le,Hl),ue===S&&K===S&&this._generatePoleQuad(a,H,F,le,Y,Hl))}}_initializeVertices(a){for(let h=0;h<a.length;h+=2)this._vertexToIndex(a[h],a[h+1])}subdividePolygonInternal(a,h){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:y,holeIndices:b}=(function(k){const F=[],V=[];for(const H of k)if(H.length!==0){H!==k[0]&&F.push(V.length/2);for(let Y=0;Y<H.length;Y++)V.push(H[Y].x),V.push(H[Y].y)}return{flattened:V,holeIndices:F}})(a);let S;this._initializeVertices(y);try{const k=(function(V,H,Y=2){const K=H&&H.length,te=K?H[0]*Y:V.length;let oe=Kp(V,0,te,Y,!0);const le=[];if(!oe||oe.next===oe.prev)return le;let ue,xe,De;if(K&&(oe=(function(we,Ee,Ne,Ze){const yt=[];for(let Bt=0,Dt=Ee.length;Bt<Dt;Bt++){const jt=Kp(we,Ee[Bt]*Ze,Bt<Dt-1?Ee[Bt+1]*Ze:we.length,Ze,!1);jt===jt.next&&(jt.steiner=!0),yt.push(l2(jt))}yt.sort(Xs);for(let Bt=0;Bt<yt.length;Bt++)Ne=eg(yt[Bt],Ne);return Ne})(V,H,oe,Y)),V.length>80*Y){ue=V[0],xe=V[1];let we=ue,Ee=xe;for(let Ne=Y;Ne<te;Ne+=Y){const Ze=V[Ne],yt=V[Ne+1];Ze<ue&&(ue=Ze),yt<xe&&(xe=yt),Ze>we&&(we=Ze),yt>Ee&&(Ee=yt)}De=Math.max(we-ue,Ee-xe),De=De!==0?32767/De:0}return Nf(oe,le,Y,ue,xe,De,0),le})(y,b),F=this._convertIndices(y,k);S=this._subdivideTrianglesScanline(F)}catch(k){console.error(k)}let E=[];return h&&(E=this._generateOutline(a)),this._ensureNoPoleVertices(),this._handlePoles(S),{verticesFlattened:this._vertexBuffer,indicesTriangles:S,indicesLineList:E}}_convertIndices(a,h){const y=[];for(let b=0;b<h.length;b++)y.push(this._vertexToIndex(a[2*h[b]],a[2*h[b]+1]));return y}_pointArrayToIndices(a){const h=[];for(let y=0;y<a.length;y++){const b=a[y];h.push(this._vertexToIndex(b.x,b.y))}return h}}function V0(f,a,h,y=!0){return new Lu(h,a).subdividePolygonInternal(f,y)}function iu(f,a,h=!1){if(!f||f.length<1)return[];if(f.length<2)return[];const y=f[0],b=f[f.length-1],S=h&&(y.x!==b.x||y.y!==b.y);if(a<2)return S?[...f,f[0]]:[...f];const E=Math.floor(li/a),k=[];k.push(new M(f[0].x,f[0].y));const F=f.length,V=S?F:F-1;for(let H=0;H<V;H++){const Y=f[H],K=H<F-1?f[H+1]:f[0],te=Y.x,oe=Y.y,le=K.x,ue=K.y,xe=te!==le,De=oe!==ue;if(!xe&&!De)continue;const we=le-te,Ee=ue-oe,Ne=Math.abs(we),Ze=Math.abs(Ee);let yt=te,Bt=oe;for(;;){const jt=we>0?(Math.floor(yt/E)+1)*E:(Math.ceil(yt/E)-1)*E,ai=Ee>0?(Math.floor(Bt/E)+1)*E:(Math.ceil(Bt/E)-1)*E,Qt=Math.abs(yt-jt),Ot=Math.abs(Bt-ai),Ct=Math.abs(yt-le),_i=Math.abs(Bt-ue),pi=xe?Qt/Ne:Number.POSITIVE_INFINITY,Ti=De?Ot/Ze:Number.POSITIVE_INFINITY;if((Ct<=Qt||!xe)&&(_i<=Ot||!De))break;if(pi<Ti&&xe||!De){yt=jt,Bt+=Ee*pi;const gi=new M(yt,Math.round(Bt));k[k.length-1].x===gi.x&&k[k.length-1].y===gi.y||k.push(gi)}else{yt+=we*Ti,Bt=ai;const gi=new M(Math.round(yt),Bt);k[k.length-1].x===gi.x&&k[k.length-1].y===gi.y||k.push(gi)}}const Dt=new M(le,ue);k[k.length-1].x===Dt.x&&k[k.length-1].y===Dt.y||k.push(Dt)}return k}function wc(f,a,h){if(a.length===0)throw new Error("Subdivision vertex ring is empty.");let y=0,b=f[2*a[0]];for(let F=1;F<a.length;F++){const V=f[2*a[F]];V<b&&(b=V,y=F)}const S=a.length;let E=y,k=(E+1)%S;for(;;){const F=E-1>=0?E-1:S-1,V=(k+1)%S,H=f[2*a[F]],Y=f[2*a[V]],K=f[2*a[E]],te=f[2*a[E]+1],oe=f[2*a[k]+1];let le=!1;if(H<Y)le=!0;else if(H>Y)le=!1;else{const ue=oe-te,xe=-(f[2*a[k]]-K),De=te<oe?1:-1;((H-K)*ue+(f[2*a[F]+1]-te)*xe)*De>((Y-K)*ue+(f[2*a[V]+1]-te)*xe)*De&&(le=!0)}if(le){const ue=a[F],xe=a[E],De=a[k];ue!==xe&&ue!==De&&xe!==De&&h.push(De,xe,ue),E--,E<0&&(E=S-1)}else{const ue=a[V],xe=a[E],De=a[k];ue!==xe&&ue!==De&&xe!==De&&h.push(De,xe,ue),k++,k>=S&&(k=0)}if(F===V)break}}function dm(f,a,h,y,b,S,E,k,F){const V=b.length/2,H=E&&k&&F;if(V<ri.MAX_VERTEX_ARRAY_LENGTH){const Y=a.prepareSegment(V,h,y),K=Y.vertexLength;for(let le=0;le<S.length;le+=3)y.emplaceBack(K+S[le],K+S[le+1],K+S[le+2]);let te,oe;Y.vertexLength+=V,Y.primitiveLength+=S.length/3,H&&(oe=E.prepareSegment(V,h,k),te=oe.vertexLength,oe.vertexLength+=V);for(let le=0;le<b.length;le+=2)f(b[le],b[le+1]);if(H)for(let le=0;le<F.length;le++){const ue=F[le];for(let xe=1;xe<ue.length;xe+=2)k.emplaceBack(te+ue[xe-1],te+ue[xe]);oe.primitiveLength+=ue.length/2}}else(function(Y,K,te,oe,le,ue){const xe=[];for(let Ze=0;Ze<oe.length/2;Ze++)xe.push(-1);const De={count:0};let we=0,Ee=Y.getOrCreateLatestSegment(K,te),Ne=Ee.vertexLength;for(let Ze=2;Ze<le.length;Ze+=3){const yt=le[Ze-2],Bt=le[Ze-1],Dt=le[Ze];let jt=xe[yt]<we,ai=xe[Bt]<we,Qt=xe[Dt]<we;Ee.vertexLength+((jt?1:0)+(ai?1:0)+(Qt?1:0))>ri.MAX_VERTEX_ARRAY_LENGTH&&(Ee=Y.createNewSegment(K,te),we=De.count,jt=!0,ai=!0,Qt=!0,Ne=0);const Ot=Tc(xe,oe,ue,De,yt,jt,Ee),Ct=Tc(xe,oe,ue,De,Bt,ai,Ee),_i=Tc(xe,oe,ue,De,Dt,Qt,Ee);te.emplaceBack(Ne+Ot-we,Ne+Ct-we,Ne+_i-we),Ee.primitiveLength++}})(a,h,y,b,S,f),H&&(function(Y,K,te,oe,le,ue){const xe=[];for(let Ze=0;Ze<oe.length/2;Ze++)xe.push(-1);const De={count:0};let we=0,Ee=Y.getOrCreateLatestSegment(K,te),Ne=Ee.vertexLength;for(let Ze=0;Ze<le.length;Ze++){const yt=le[Ze];for(let Bt=1;Bt<le[Ze].length;Bt+=2){const Dt=yt[Bt-1],jt=yt[Bt];let ai=xe[Dt]<we,Qt=xe[jt]<we;Ee.vertexLength+((ai?1:0)+(Qt?1:0))>ri.MAX_VERTEX_ARRAY_LENGTH&&(Ee=Y.createNewSegment(K,te),we=De.count,ai=!0,Qt=!0,Ne=0);const Ot=Tc(xe,oe,ue,De,Dt,ai,Ee),Ct=Tc(xe,oe,ue,De,jt,Qt,Ee);te.emplaceBack(Ne+Ot-we,Ne+Ct-we),Ee.primitiveLength++}}})(E,h,k,b,F,f),a.forceNewSegmentOnNextPrepare(),E==null||E.forceNewSegmentOnNextPrepare()}function Tc(f,a,h,y,b,S,E){if(S){const k=y.count;return h(a[2*b],a[2*b+1]),f[b]=y.count,y.count++,E.vertexLength++,k}return f[b]}class Sc{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map((h=>h.id)),this.index=a.index,this.hasDependencies=!1,this.patternFeatures=[],this.layoutVertexArray=new Ce,this.indexArray=new _t,this.indexArray2=new ti,this.programConfigurations=new Qc(a.layers,a.zoom),this.segments=new ri,this.segments2=new ri,this.stateDependentLayerIds=this.layers.filter((h=>h.isStateDependent())).map((h=>h.id))}populate(a,h,y){this.hasDependencies=dl("fill",this.layers,h);const b=this.layers[0].layout.get("fill-sort-key"),S=!b.isConstant(),E=[];for(const{feature:k,id:F,index:V,sourceLayerIndex:H}of a){const Y=this.layers[0]._featureFilter.needGeometry,K=as(k,Y);if(!this.layers[0]._featureFilter.filter(new Un(this.zoom),K,y))continue;const te=S?b.evaluate(K,{},y,h.availableImages):void 0,oe={id:F,properties:k.properties,type:k.type,sourceLayerIndex:H,index:V,geometry:Y?K.geometry:Ss(k),patterns:{},sortKey:te};E.push(oe)}S&&E.sort(((k,F)=>k.sortKey-F.sortKey));for(const k of E){const{geometry:F,index:V,sourceLayerIndex:H}=k;if(this.hasDependencies){const Y=Qp("fill",this.layers,k,{zoom:this.zoom},h);this.patternFeatures.push(Y)}else this.addFeature(k,F,V,y,{},h.subdivisionGranularity);h.featureIndex.insert(a[V].feature,F,V,H,this.index)}}update(a,h,y){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,h,this.stateDependentLayers,{imagePositions:y})}addFeatures(a,h,y){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,h,y,a.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,F0),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.indexBuffer2=a.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(a,h,y,b,S,E){for(const k of sd(h,500)){const F=V0(k,b,E.fill.getGranularityForZoomLevel(b.z)),V=this.layoutVertexArray;dm(((H,Y)=>{V.emplaceBack(H,Y)}),this.segments,this.layoutVertexArray,this.indexArray,F.verticesFlattened,F.indicesTriangles,this.segments2,this.indexArray2,F.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,y,{imagePositions:S,canonical:b})}}let Bh,zh;yi("FillBucket",Sc,{omit:["layers","patternFeatures"]});var pm={get paint(){return zh=zh||new Er({"fill-antialias":new xi(Ke.paint_fill["fill-antialias"]),"fill-opacity":new Mi(Ke.paint_fill["fill-opacity"]),"fill-color":new Mi(Ke.paint_fill["fill-color"]),"fill-outline-color":new Mi(Ke.paint_fill["fill-outline-color"]),"fill-translate":new xi(Ke.paint_fill["fill-translate"]),"fill-translate-anchor":new xi(Ke.paint_fill["fill-translate-anchor"]),"fill-pattern":new Vo(Ke.paint_fill["fill-pattern"])})},get layout(){return Bh=Bh||new Er({"fill-sort-key":new Mi(Ke.layout_fill["fill-sort-key"])})}};class j0 extends rn{constructor(a,h){super(a,pm,h)}recalculate(a,h){super.recalculate(a,h);const y=this.paint._values["fill-outline-color"];y.value.kind==="constant"&&y.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(a){return new Sc(a)}queryRadius(){return bc(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:a,geometry:h,transform:y,pixelsToTileUnits:b}){return Ff(Md(a,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-y.bearingInRadians,b),h)}isTileClipped(){return!0}}const Od=_r([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),gm=_r([{name:"a_centroid",components:2,type:"Int16"}],4),{members:G0}=Od;class Bf{constructor(a,h,y,b,S){this.properties={},this.extent=y,this.type=0,this.id=void 0,this._pbf=a,this._geometry=-1,this._keys=b,this._values=S,a.readFields(c2,this,h)}loadGeometry(){const a=this._pbf;a.pos=this._geometry;const h=a.readVarint()+a.pos,y=[];let b,S=1,E=0,k=0,F=0;for(;a.pos<h;){if(E<=0){const V=a.readVarint();S=7&V,E=V>>3}if(E--,S===1||S===2)k+=a.readSVarint(),F+=a.readSVarint(),S===1&&(b&&y.push(b),b=[]),b&&b.push(new M(k,F));else{if(S!==7)throw new Error(`unknown command ${S}`);b&&b.push(b[0].clone())}}return b&&y.push(b),y}bbox(){const a=this._pbf;a.pos=this._geometry;const h=a.readVarint()+a.pos;let y=1,b=0,S=0,E=0,k=1/0,F=-1/0,V=1/0,H=-1/0;for(;a.pos<h;){if(b<=0){const Y=a.readVarint();y=7&Y,b=Y>>3}if(b--,y===1||y===2)S+=a.readSVarint(),E+=a.readSVarint(),S<k&&(k=S),S>F&&(F=S),E<V&&(V=E),E>H&&(H=E);else if(y!==7)throw new Error(`unknown command ${y}`)}return[k,V,F,H]}toGeoJSON(a,h,y){const b=this.extent*Math.pow(2,y),S=this.extent*a,E=this.extent*h,k=this.loadGeometry();function F(K){return[360*(K.x+S)/b-180,360/Math.PI*Math.atan(Math.exp((1-2*(K.y+E)/b)*Math.PI))-90]}function V(K){return K.map(F)}let H;if(this.type===1){const K=[];for(const oe of k)K.push(oe[0]);const te=V(K);H=K.length===1?{type:"Point",coordinates:te[0]}:{type:"MultiPoint",coordinates:te}}else if(this.type===2){const K=k.map(V);H=K.length===1?{type:"LineString",coordinates:K[0]}:{type:"MultiLineString",coordinates:K}}else{if(this.type!==3)throw new Error("unknown feature type");{const K=F_(k),te=[];for(const oe of K)te.push(oe.map(V));H=te.length===1?{type:"Polygon",coordinates:te[0]}:{type:"MultiPolygon",coordinates:te}}}const Y={type:"Feature",geometry:H,properties:this.properties};return this.id!=null&&(Y.id=this.id),Y}}function c2(f,a,h){f===1?a.id=h.readVarint():f===2?(function(y,b){const S=y.readVarint()+y.pos;for(;y.pos<S;){const E=b._keys[y.readVarint()],k=b._values[y.readVarint()];b.properties[E]=k}})(h,a):f===3?a.type=h.readVarint():f===4&&(a._geometry=h.pos)}function F_(f){const a=f.length;if(a<=1)return[f];const h=[];let y,b;for(let S=0;S<a;S++){const E=Rn(f[S]);E!==0&&(b===void 0&&(b=E<0),b===E<0?(y&&h.push(y),y=[f[S]]):y&&y.push(f[S]))}return y&&h.push(y),h}function Rn(f){let a=0;for(let h,y,b=0,S=f.length,E=S-1;b<S;E=b++)h=f[b],y=f[E],a+=(y.x-h.x)*(h.y+y.y);return a}Bf.types=["Unknown","Point","LineString","Polygon"];class Rr{constructor(a,h){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(Pn,this,h),this.length=this._features.length}feature(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];const h=this._pbf.readVarint()+this._pbf.pos;return new Bf(this._pbf,h,this.extent,this._keys,this._values)}}function Pn(f,a,h){f===15?a.version=h.readVarint():f===1?a.name=h.readString():f===5?a.extent=h.readVarint():f===2?a._features.push(h.pos):f===3?a._keys.push(h.readString()):f===4&&a._values.push((function(y){let b=null;const S=y.readVarint()+y.pos;for(;y.pos<S;){const E=y.readVarint()>>3;b=E===1?y.readString():E===2?y.readFloat():E===3?y.readDouble():E===4?y.readVarint64():E===5?y.readVarint():E===6?y.readSVarint():E===7?y.readBoolean():null}if(b==null)throw new Error("unknown feature value");return b})(h))}class hn{constructor(a,h){this.layers=a.readFields(zn,{},h)}}function zn(f,a,h){if(f===3){const y=new Rr(h,h.readVarint()+h.pos);y.length&&(a[y.name]=y)}}const wo=Math.pow(2,13);function $l(f,a,h,y,b,S,E,k){f.emplaceBack(a,h,2*Math.floor(y*wo)+E,b*wo*2,S*wo*2,Math.round(k))}class Lh{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map((h=>h.id)),this.index=a.index,this.hasDependencies=!1,this.layoutVertexArray=new Oe,this.centroidVertexArray=new Me,this.indexArray=new _t,this.programConfigurations=new Qc(a.layers,a.zoom),this.segments=new ri,this.stateDependentLayerIds=this.layers.filter((h=>h.isStateDependent())).map((h=>h.id))}populate(a,h,y){this.features=[],this.hasDependencies=dl("fill-extrusion",this.layers,h);for(const{feature:b,id:S,index:E,sourceLayerIndex:k}of a){const F=this.layers[0]._featureFilter.needGeometry,V=as(b,F);if(!this.layers[0]._featureFilter.filter(new Un(this.zoom),V,y))continue;const H={id:S,sourceLayerIndex:k,index:E,geometry:F?V.geometry:Ss(b),properties:b.properties,type:b.type,patterns:{}};this.hasDependencies?this.features.push(Qp("fill-extrusion",this.layers,H,{zoom:this.zoom},h)):this.addFeature(H,H.geometry,E,y,{},h.subdivisionGranularity),h.featureIndex.insert(b,H.geometry,E,k,this.index,!0)}}addFeatures(a,h,y){for(const b of this.features){const{geometry:S}=b;this.addFeature(b,S,b.index,h,y,a.subdivisionGranularity)}}update(a,h,y){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,h,this.stateDependentLayers,{imagePositions:y})}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,G0),this.centroidVertexBuffer=a.createVertexBuffer(this.centroidVertexArray,gm.members,!0),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(a,h,y,b,S,E){for(const k of sd(h,500)){const F={x:0,y:0,sampleCount:0},V=this.layoutVertexArray.length;this.processPolygon(F,b,a,k,E);const H=this.layoutVertexArray.length-V,Y=Math.floor(F.x/F.sampleCount),K=Math.floor(F.y/F.sampleCount);for(let te=0;te<H;te++)this.centroidVertexArray.emplaceBack(Y,K)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,y,{imagePositions:S,canonical:b})}processPolygon(a,h,y,b,S){if(b.length<1||ms(b[0]))return;for(const Y of b)Y.length!==0&&tg(a,Y);const E={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},k=S.fill.getGranularityForZoomLevel(h.z),F=Bf.types[y.type]==="Polygon";for(const Y of b){if(Y.length===0||ms(Y))continue;const K=iu(Y,k,F);this._generateSideFaces(K,E)}if(!F)return;const V=V0(b,h,k,!1),H=this.layoutVertexArray;dm(((Y,K)=>{$l(H,Y,K,0,0,1,1,0)}),this.segments,this.layoutVertexArray,this.indexArray,V.verticesFlattened,V.indicesTriangles)}_generateSideFaces(a,h){let y=0;for(let b=1;b<a.length;b++){const S=a[b],E=a[b-1];if(Uu(S,E))continue;h.segment.vertexLength+4>ri.MAX_VERTEX_ARRAY_LENGTH&&(h.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const k=S.sub(E)._perp()._unit(),F=E.dist(S);y+F>32768&&(y=0),$l(this.layoutVertexArray,S.x,S.y,k.x,k.y,0,0,y),$l(this.layoutVertexArray,S.x,S.y,k.x,k.y,0,1,y),y+=F,$l(this.layoutVertexArray,E.x,E.y,k.x,k.y,0,0,y),$l(this.layoutVertexArray,E.x,E.y,k.x,k.y,0,1,y);const V=h.segment.vertexLength;this.indexArray.emplaceBack(V,V+2,V+1),this.indexArray.emplaceBack(V+1,V+2,V+3),h.segment.vertexLength+=4,h.segment.primitiveLength+=2}}}function tg(f,a){for(let h=0;h<a.length;h++){const y=a[h];h===a.length-1&&a[0].x===y.x&&a[0].y===y.y||(f.x+=y.x,f.y+=y.y,f.sampleCount++)}}function Uu(f,a){return f.x===a.x&&(f.x<0||f.x>li)||f.y===a.y&&(f.y<0||f.y>li)}function ms(f){return f.every((a=>a.x<0))||f.every((a=>a.x>li))||f.every((a=>a.y<0))||f.every((a=>a.y>li))}let Vu;yi("FillExtrusionBucket",Lh,{omit:["layers","features"]});var Uh={get paint(){return Vu=Vu||new Er({"fill-extrusion-opacity":new xi(Ke["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Mi(Ke["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new xi(Ke["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new xi(Ke["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Vo(Ke["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Mi(Ke["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Mi(Ke["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new xi(Ke["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class mm extends rn{constructor(a,h){super(a,Uh,h)}createBucket(a){return new Lh(a)}queryRadius(){return bc(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:a,feature:h,featureState:y,geometry:b,transform:S,pixelsToTileUnits:E,pixelPosMatrix:k}){const F=Md(a,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-S.bearingInRadians,E),V=this.paint.get("fill-extrusion-height").evaluate(h,y),H=this.paint.get("fill-extrusion-base").evaluate(h,y),Y=(function(te,oe){const le=[];for(const ue of te){const xe=[ue.x,ue.y,0,1];fi(xe,xe,oe),le.push(new M(xe[0]/xe[3],xe[1]/xe[3]))}return le})(F,k),K=(function(te,oe,le,ue){const xe=[],De=[],we=ue[8]*oe,Ee=ue[9]*oe,Ne=ue[10]*oe,Ze=ue[11]*oe,yt=ue[8]*le,Bt=ue[9]*le,Dt=ue[10]*le,jt=ue[11]*le;for(const ai of te){const Qt=[],Ot=[];for(const Ct of ai){const _i=Ct.x,pi=Ct.y,Ti=ue[0]*_i+ue[4]*pi+ue[12],gi=ue[1]*_i+ue[5]*pi+ue[13],Bi=ue[2]*_i+ue[6]*pi+ue[14],Nn=ue[3]*_i+ue[7]*pi+ue[15],_n=Bi+Ne,qr=Nn+Ze,Qa=Ti+yt,Ys=gi+Bt,Yr=Bi+Dt,Ur=Nn+jt,Hn=new M((Ti+we)/qr,(gi+Ee)/qr);Hn.z=_n/qr,Qt.push(Hn);const _s=new M(Qa/Ur,Ys/Ur);_s.z=Yr/Ur,Ot.push(_s)}xe.push(Qt),De.push(Ot)}return[xe,De]})(b,H,V,k);return(function(te,oe,le){let ue=1/0;Ff(le,oe)&&(ue=zf(le,oe[0]));for(let xe=0;xe<oe.length;xe++){const De=oe[xe],we=te[xe];for(let Ee=0;Ee<De.length-1;Ee++){const Ne=De[Ee],Ze=[Ne,De[Ee+1],we[Ee+1],we[Ee],Ne];Df(le,Ze)&&(ue=Math.min(ue,zf(le,Ze)))}}return ue!==1/0&&ue})(K[0],K[1],Y)}}function ka(f,a){return f.x*a.x+f.y*a.y}function zf(f,a){if(f.length===1){let h=0;const y=a[h++];let b;for(;!b||y.equals(b);)if(b=a[h++],!b)return 1/0;for(;h<a.length;h++){const S=a[h],E=f[0],k=b.sub(y),F=S.sub(y),V=E.sub(y),H=ka(k,k),Y=ka(k,F),K=ka(F,F),te=ka(V,k),oe=ka(V,F),le=H*K-Y*Y,ue=(K*te-Y*oe)/le,xe=(H*oe-Y*te)/le,De=y.z*(1-ue-xe)+b.z*ue+S.z*xe;if(isFinite(De))return De}return 1/0}{let h=1/0;for(const y of a)h=Math.min(h,y.z);return h}}const W0=_r([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Xo}=W0,_m=_r([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Z0}=_m,N_=Math.cos(Math.PI/180*37.5),X0=Math.pow(2,14)/.5;class Fd{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map((h=>h.id)),this.index=a.index,this.hasDependencies=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((h=>{this.gradients[h.id]={}})),this.layoutVertexArray=new We,this.layoutVertexArray2=new ke,this.indexArray=new _t,this.programConfigurations=new Qc(a.layers,a.zoom),this.segments=new ri,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((h=>h.isStateDependent())).map((h=>h.id))}populate(a,h,y){this.hasDependencies=dl("line",this.layers,h)||this.hasLineDasharray(this.layers);const b=this.layers[0].layout.get("line-sort-key"),S=!b.isConstant(),E=[];for(const{feature:k,id:F,index:V,sourceLayerIndex:H}of a){const Y=this.layers[0]._featureFilter.needGeometry,K=as(k,Y);if(!this.layers[0]._featureFilter.filter(new Un(this.zoom),K,y))continue;const te=S?b.evaluate(K,{},y):void 0,oe={id:F,properties:k.properties,type:k.type,sourceLayerIndex:H,index:V,geometry:Y?K.geometry:Ss(k),patterns:{},dashes:{},sortKey:te};E.push(oe)}S&&E.sort(((k,F)=>k.sortKey-F.sortKey));for(const k of E){const{geometry:F,index:V,sourceLayerIndex:H}=k;this.hasDependencies?(dl("line",this.layers,h)?Qp("line",this.layers,k,{zoom:this.zoom},h):this.hasLineDasharray(this.layers)&&this.addLineDashDependencies(this.layers,k,this.zoom,h),this.patternFeatures.push(k)):this.addFeature(k,F,V,y,{},{},h.subdivisionGranularity),h.featureIndex.insert(a[V].feature,F,V,H,this.index)}}update(a,h,y,b){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,h,this.stateDependentLayers,{imagePositions:y,dashPositions:b})}addFeatures(a,h,y,b){for(const S of this.patternFeatures)this.addFeature(S,S.geometry,S.index,h,y,b,a.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=a.createVertexBuffer(this.layoutVertexArray2,Z0)),this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Xo),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(a){if(a.properties&&Object.prototype.hasOwnProperty.call(a.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(a.properties,"mapbox_clip_end"))return{start:+a.properties.mapbox_clip_start,end:+a.properties.mapbox_clip_end}}addFeature(a,h,y,b,S,E,k){const F=this.layers[0].layout,V=F.get("line-join").evaluate(a,{}),H=F.get("line-cap"),Y=F.get("line-miter-limit"),K=F.get("line-round-limit");this.lineClips=this.lineFeatureClips(a);for(const te of h)this.addLine(te,a,V,H,Y,K,b,k);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,y,{imagePositions:S,dashPositions:E,canonical:b})}addLine(a,h,y,b,S,E,k,F){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,a=iu(a,k?F.line.getGranularityForZoomLevel(k.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let we=0;we<a.length-1;we++)this.totalDistance+=a[we].dist(a[we+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const V=Bf.types[h.type]==="Polygon";let H=a.length;for(;H>=2&&a[H-1].equals(a[H-2]);)H--;let Y=0;for(;Y<H-1&&a[Y].equals(a[Y+1]);)Y++;if(H<(V?3:2))return;y==="bevel"&&(S=1.05);const K=this.overscaling<=16?122880/(512*this.overscaling):0,te=this.segments.prepareSegment(10*H,this.layoutVertexArray,this.indexArray);let oe,le,ue,xe,De;this.e1=this.e2=-1,V&&(oe=a[H-2],De=a[Y].sub(oe)._unit()._perp());for(let we=Y;we<H;we++){if(ue=we===H-1?V?a[Y+1]:void 0:a[we+1],ue&&a[we].equals(ue))continue;De&&(xe=De),oe&&(le=oe),oe=a[we],De=ue?ue.sub(oe)._unit()._perp():xe,xe=xe||De;let Ee=xe.add(De);Ee.x===0&&Ee.y===0||Ee._unit();const Ne=xe.x*De.x+xe.y*De.y,Ze=Ee.x*De.x+Ee.y*De.y,yt=Ze!==0?1/Ze:1/0,Bt=2*Math.sqrt(2-2*Ze),Dt=Ze<N_&&le&&ue,jt=xe.x*De.y-xe.y*De.x>0;if(Dt&&we>Y){const Ot=oe.dist(le);if(Ot>2*K){const Ct=oe.sub(oe.sub(le)._mult(K/Ot)._round());this.updateDistance(le,Ct),this.addCurrentVertex(Ct,xe,0,0,te),le=Ct}}const ai=le&&ue;let Qt=ai?y:V?"butt":b;if(ai&&Qt==="round"&&(yt<E?Qt="miter":yt<=2&&(Qt="fakeround")),Qt==="miter"&&yt>S&&(Qt="bevel"),Qt==="bevel"&&(yt>2&&(Qt="flipbevel"),yt<S&&(Qt="miter")),le&&this.updateDistance(le,oe),Qt==="miter")Ee._mult(yt),this.addCurrentVertex(oe,Ee,0,0,te);else if(Qt==="flipbevel"){if(yt>100)Ee=De.mult(-1);else{const Ot=yt*xe.add(De).mag()/xe.sub(De).mag();Ee._perp()._mult(Ot*(jt?-1:1))}this.addCurrentVertex(oe,Ee,0,0,te),this.addCurrentVertex(oe,Ee.mult(-1),0,0,te)}else if(Qt==="bevel"||Qt==="fakeround"){const Ot=-Math.sqrt(yt*yt-1),Ct=jt?Ot:0,_i=jt?0:Ot;if(le&&this.addCurrentVertex(oe,xe,Ct,_i,te),Qt==="fakeround"){const pi=Math.round(180*Bt/Math.PI/20);for(let Ti=1;Ti<pi;Ti++){let gi=Ti/pi;if(gi!==.5){const Nn=gi-.5;gi+=gi*Nn*(gi-1)*((1.0904+Ne*(Ne*(3.55645-1.43519*Ne)-3.2452))*Nn*Nn+(.848013+Ne*(.215638*Ne-1.06021)))}const Bi=De.sub(xe)._mult(gi)._add(xe)._unit()._mult(jt?-1:1);this.addHalfVertex(oe,Bi.x,Bi.y,!1,jt,0,te)}}ue&&this.addCurrentVertex(oe,De,-Ct,-_i,te)}else if(Qt==="butt")this.addCurrentVertex(oe,Ee,0,0,te);else if(Qt==="square"){const Ot=le?1:-1;this.addCurrentVertex(oe,Ee,Ot,Ot,te)}else Qt==="round"&&(le&&(this.addCurrentVertex(oe,xe,0,0,te),this.addCurrentVertex(oe,xe,1,1,te,!0)),ue&&(this.addCurrentVertex(oe,De,-1,-1,te,!0),this.addCurrentVertex(oe,De,0,0,te)));if(Dt&&we<H-1){const Ot=oe.dist(ue);if(Ot>2*K){const Ct=oe.add(ue.sub(oe)._mult(K/Ot)._round());this.updateDistance(oe,Ct),this.addCurrentVertex(Ct,De,0,0,te),oe=Ct}}}}addCurrentVertex(a,h,y,b,S,E=!1){const k=h.y*b-h.x,F=-h.y-h.x*b;this.addHalfVertex(a,h.x+h.y*y,h.y-h.x*y,E,!1,y,S),this.addHalfVertex(a,k,F,E,!0,-b,S),this.distance>X0/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(a,h,y,b,S,E))}addHalfVertex({x:a,y:h},y,b,S,E,k,F){const V=.5*(this.lineClips?this.scaledDistance*(X0-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((a<<1)+(S?1:0),(h<<1)+(E?1:0),Math.round(63*y)+128,Math.round(63*b)+128,1+(k===0?0:k<0?-1:1)|(63&V)<<2,V>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const H=F.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,H,this.e2),F.primitiveLength++),E?this.e2=H:this.e1=H}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(a,h){this.distance+=a.dist(h),this.updateScaledDistance()}hasLineDasharray(a){for(const h of a){const y=h.paint.get("line-dasharray");if(y&&!y.isConstant())return!0}return!1}addLineDashDependencies(a,h,y,b){for(const S of a){const E=S.paint.get("line-dasharray");if(!E||E.value.kind==="constant")continue;const k=S.layout.get("line-cap")==="round",F={dasharray:E.value.evaluate({zoom:y-1},h,{}),round:k},V={dasharray:E.value.evaluate({zoom:y},h,{}),round:k},H={dasharray:E.value.evaluate({zoom:y+1},h,{}),round:k},Y=`${F.dasharray.join(",")},${F.round}`,K=`${V.dasharray.join(",")},${V.round}`,te=`${H.dasharray.join(",")},${H.round}`;b.dashDependencies[Y]=F,b.dashDependencies[K]=V,b.dashDependencies[te]=H,h.dashes[S.id]={min:Y,mid:K,max:te}}}}let ju,Hs;yi("LineBucket",Fd,{omit:["layers","patternFeatures"]});var Gu={get paint(){return Hs=Hs||new Er({"line-opacity":new Mi(Ke.paint_line["line-opacity"]),"line-color":new Mi(Ke.paint_line["line-color"]),"line-translate":new xi(Ke.paint_line["line-translate"]),"line-translate-anchor":new xi(Ke.paint_line["line-translate-anchor"]),"line-width":new Mi(Ke.paint_line["line-width"]),"line-gap-width":new Mi(Ke.paint_line["line-gap-width"]),"line-offset":new Mi(Ke.paint_line["line-offset"]),"line-blur":new Mi(Ke.paint_line["line-blur"]),"line-dasharray":new Vo(Ke.paint_line["line-dasharray"]),"line-pattern":new Vo(Ke.paint_line["line-pattern"]),"line-gradient":new Rh(Ke.paint_line["line-gradient"])})},get layout(){return ju=ju||new Er({"line-cap":new xi(Ke.layout_line["line-cap"]),"line-join":new Mi(Ke.layout_line["line-join"]),"line-miter-limit":new xi(Ke.layout_line["line-miter-limit"]),"line-round-limit":new xi(Ke.layout_line["line-round-limit"]),"line-sort-key":new Mi(Ke.layout_line["line-sort-key"])})}};class Nd extends Mi{possiblyEvaluate(a,h){return h=new Un(Math.floor(h.zoom),{now:h.now,fadeDuration:h.fadeDuration,zoomHistory:h.zoomHistory,transition:h.transition}),super.possiblyEvaluate(a,h)}evaluate(a,h,y,b){return h=Kn({},h,{zoom:Math.floor(h.zoom)}),super.evaluate(a,h,y,b)}}let pl;class ym extends rn{constructor(a,h){super(a,Gu,h),this.gradientVersion=0,pl||(pl=new Nd(Gu.paint.properties["line-width"].specification),pl.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(a){if(a==="line-gradient"){const h=this.gradientExpression();this.stepInterpolant=!!(function(y){return y._styleExpression!==void 0})(h)&&h._styleExpression.expression instanceof Ma,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(a,h){super.recalculate(a,h),this.paint._values["line-floorwidth"]=pl.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)}createBucket(a){return new Fd(a)}queryRadius(a){const h=a,y=ig(Xl("line-width",this,h),Xl("line-gap-width",this,h)),b=Xl("line-offset",this,h);return y/2+Math.abs(b)+bc(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:a,feature:h,featureState:y,geometry:b,transform:S,pixelsToTileUnits:E}){const k=Md(a,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-S.bearingInRadians,E),F=E/2*ig(this.paint.get("line-width").evaluate(h,y),this.paint.get("line-gap-width").evaluate(h,y)),V=this.paint.get("line-offset").evaluate(h,y);return V&&(b=(function(H,Y){const K=[];for(let te=0;te<H.length;te++){const oe=M0(H[te]),le=[];for(let ue=0;ue<oe.length;ue++){const xe=oe[ue],De=oe[ue-1],we=oe[ue+1],Ee=ue===0?new M(0,0):xe.sub(De)._unit()._perp(),Ne=ue===oe.length-1?new M(0,0):we.sub(xe)._unit()._perp(),Ze=Ee._add(Ne)._unit(),yt=Ze.x*Ne.x+Ze.y*Ne.y;yt!==0&&Ze._mult(1/yt),le.push(Ze._mult(Y)._add(xe))}K.push(le)}return K})(b,V*E)),(function(H,Y,K){for(let te=0;te<Y.length;te++){const oe=Y[te];if(H.length>=3){for(let le=0;le<oe.length;le++)if(Zl(H,oe[le]))return!0}if(Ws(H,oe,K))return!0}return!1})(k,b,F)}isTileClipped(){return!0}}function ig(f,a){return a>0?a+2*f:f}const ng=_r([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),H0=_r([{name:"a_projected_pos",components:3,type:"Float32"}],4);_r([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Bd=_r([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);_r([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Ho=_r([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),B_=_r([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function $o(f,a,h){return f.sections.forEach((y=>{y.text=(function(b,S,E){const k=S.layout.get("text-transform").evaluate(E,{});return k==="uppercase"?b=b.toLocaleUpperCase():k==="lowercase"&&(b=b.toLocaleLowerCase()),Br.applyArabicShaping&&(b=Br.applyArabicShaping(b)),b})(y.text,a,h)})),f}_r([{name:"triangle",components:3,type:"Uint16"}]),_r([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),_r([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),_r([{type:"Float32",name:"offsetX"}]),_r([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),_r([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);var Bs=24;const Vh={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""},u2={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},jh={40:!0};function $0(f,a,h,y,b,S){if("fontStack"in a){const E=h[a.fontStack],k=E&&E[f];return k?k.metrics.advance*a.scale+b:0}{const E=y[a.imageName];return E?E.displaySize[0]*a.scale*Bs/S+b:0}}function q0(f,a,h,y){const b=Math.pow(f-a,2);return y?f<a?b/2:2*b:b+Math.abs(h)*h}function zd(f,a,h){let y=0;return f===10&&(y-=1e4),h&&(y+=150),f!==40&&f!==65288||(y+=50),a!==41&&a!==65289||(y+=50),y}function vm(f,a,h,y,b,S){let E=null,k=q0(a,h,b,S);for(const F of y){const V=q0(a-F.x,h,b,S)+F.badness;V<=k&&(E=F,k=V)}return{index:f,x:a,priorBreak:E,badness:k}}function xm(f){return f?xm(f.priorBreak).concat(f.index):[]}class Lf{constructor(a="",h=[],y=[]){this.text=a,this.sections=h,this.sectionIndex=y,this.imageSectionID=null}static fromFeature(a,h){const y=new Lf;for(let b=0;b<a.sections.length;b++){const S=a.sections[b];S.image?y.addImageSection(S):y.addTextSection(S,h)}return y}length(){return[...this.text].length}getSection(a){return this.sections[this.sectionIndex[a]]}getSectionIndex(a){return this.sectionIndex[a]}verticalizePunctuation(){this.text=(function(a){let h="",y={premature:!0,value:void 0};const b=a[Symbol.iterator]();let S=b.next();const E=a[Symbol.iterator]();E.next();let k=E.next();for(;!S.done;)h+=!k.done&&ul(k.value.codePointAt(0))&&!Vh[k.value]||!y.premature&&ul(y.value.codePointAt(0))&&!Vh[y.value]||!Vh[S.value]?S.value:Vh[S.value],y={value:S.value,premature:!1},S=b.next(),k=E.next();return h})(this.text)}hasZeroWidthSpaces(){return this.text.includes("")}trim(){const a=this.text.match(/^\s*/),h=a?a[0].length:0,y=this.text.match(/\S\s*$/),b=y?y[0].length-1:0;this.text=this.text.substring(h,this.text.length-b),this.sectionIndex=this.sectionIndex.slice(h,this.sectionIndex.length-b)}substring(a,h){const y=[...this.text].slice(a,h).join(""),b=this.sectionIndex.slice(a,h);return new Lf(y,this.sections,b)}toCodeUnitIndex(a){return[...this.text].slice(0,a).join("").length}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((a,h)=>Math.max(a,this.sections[h].scale)),0)}getMaxImageSize(a){let h=0,y=0;for(let b=0;b<this.length();b++){const S=this.getSection(b);if("imageName"in S){const E=a[S.imageName];if(!E)continue;const k=E.displaySize;h=Math.max(h,k[0]),y=Math.max(y,k[1])}}return{maxImageWidth:h,maxImageHeight:y}}addTextSection(a,h){this.text+=a.text,this.sections.push({scale:a.scale||1,verticalAlign:a.verticalAlign||"bottom",fontStack:a.fontStack||h});const y=this.sections.length-1;this.sectionIndex.push(...[...a.text].map((()=>y)))}addImageSection(a){const h=a.image?a.image.name:"";if(h.length===0)return void br("Can't add FormattedSection with an empty image.");const y=this.getNextImageSectionCharCode();y?(this.text+=String.fromCharCode(y),this.sections.push({scale:1,verticalAlign:a.verticalAlign||"bottom",imageName:h}),this.sectionIndex.push(this.sections.length-1)):br("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}determineLineBreaks(a,h,y,b,S){const E=[],k=this.determineAverageLineWidth(a,h,y,b,S),F=this.hasZeroWidthSpaces();let V=0,H=0;const Y=this.text[Symbol.iterator]();let K=Y.next();const te=this.text[Symbol.iterator]();te.next();let oe=te.next();const le=this.text[Symbol.iterator]();le.next(),le.next();let ue=le.next();for(;!K.done;){const xe=this.getSection(H),De=K.value.codePointAt(0);if(Rf(De)||(V+=$0(De,xe,y,b,a,S)),!oe.done){const we=Bl(De),Ee=oe.value.codePointAt(0);(u2[De]||we||"imageName"in xe||!ue.done&&jh[Ee])&&E.push(vm(H+1,V,k,E,zd(De,Ee,we&&F),!1))}H++,K=Y.next(),oe=te.next(),ue=le.next()}return xm(vm(this.length(),V,k,E,0,!0))}determineAverageLineWidth(a,h,y,b,S){let E=0,k=0;for(const F of this.text){const V=this.getSection(k);E+=$0(F.codePointAt(0),V,y,b,a,S),k++}return E/Math.max(1,Math.ceil(E/h))}}const rg=4294967296,Y0=1/rg,sg=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class ag{constructor(a=new Uint8Array(16)){this.buf=ArrayBuffer.isView(a)?a:new Uint8Array(a),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(a,h,y=this.length){for(;this.pos<y;){const b=this.readVarint(),S=b>>3,E=this.pos;this.type=7&b,a(S,h,this),this.pos===E&&this.skip(b)}return h}readMessage(a,h){return this.readFields(a,h,this.readVarint()+this.pos)}readFixed32(){const a=this.dataView.getUint32(this.pos,!0);return this.pos+=4,a}readSFixed32(){const a=this.dataView.getInt32(this.pos,!0);return this.pos+=4,a}readFixed64(){const a=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*rg;return this.pos+=8,a}readSFixed64(){const a=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*rg;return this.pos+=8,a}readFloat(){const a=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,a}readDouble(){const a=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,a}readVarint(a){const h=this.buf;let y,b;return b=h[this.pos++],y=127&b,b<128?y:(b=h[this.pos++],y|=(127&b)<<7,b<128?y:(b=h[this.pos++],y|=(127&b)<<14,b<128?y:(b=h[this.pos++],y|=(127&b)<<21,b<128?y:(b=h[this.pos],y|=(15&b)<<28,(function(S,E,k){const F=k.buf;let V,H;if(H=F[k.pos++],V=(112&H)>>4,H<128||(H=F[k.pos++],V|=(127&H)<<3,H<128)||(H=F[k.pos++],V|=(127&H)<<10,H<128)||(H=F[k.pos++],V|=(127&H)<<17,H<128)||(H=F[k.pos++],V|=(127&H)<<24,H<128)||(H=F[k.pos++],V|=(1&H)<<31,H<128))return Ld(S,V,E);throw new Error("Expected varint not more than 10 bytes")})(y,a,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const a=this.readVarint();return a%2==1?(a+1)/-2:a/2}readBoolean(){return!!this.readVarint()}readString(){const a=this.readVarint()+this.pos,h=this.pos;return this.pos=a,a-h>=12&&sg?sg.decode(this.buf.subarray(h,a)):(function(y,b,S){let E="",k=b;for(;k<S;){const F=y[k];let V,H,Y,K=null,te=F>239?4:F>223?3:F>191?2:1;if(k+te>S)break;te===1?F<128&&(K=F):te===2?(V=y[k+1],(192&V)==128&&(K=(31&F)<<6|63&V,K<=127&&(K=null))):te===3?(V=y[k+1],H=y[k+2],(192&V)==128&&(192&H)==128&&(K=(15&F)<<12|(63&V)<<6|63&H,(K<=2047||K>=55296&&K<=57343)&&(K=null))):te===4&&(V=y[k+1],H=y[k+2],Y=y[k+3],(192&V)==128&&(192&H)==128&&(192&Y)==128&&(K=(15&F)<<18|(63&V)<<12|(63&H)<<6|63&Y,(K<=65535||K>=1114112)&&(K=null))),K===null?(K=65533,te=1):K>65535&&(K-=65536,E+=String.fromCharCode(K>>>10&1023|55296),K=56320|1023&K),E+=String.fromCharCode(K),k+=te}return E})(this.buf,h,a)}readBytes(){const a=this.readVarint()+this.pos,h=this.buf.subarray(this.pos,a);return this.pos=a,h}readPackedVarint(a=[],h){const y=this.readPackedEnd();for(;this.pos<y;)a.push(this.readVarint(h));return a}readPackedSVarint(a=[]){const h=this.readPackedEnd();for(;this.pos<h;)a.push(this.readSVarint());return a}readPackedBoolean(a=[]){const h=this.readPackedEnd();for(;this.pos<h;)a.push(this.readBoolean());return a}readPackedFloat(a=[]){const h=this.readPackedEnd();for(;this.pos<h;)a.push(this.readFloat());return a}readPackedDouble(a=[]){const h=this.readPackedEnd();for(;this.pos<h;)a.push(this.readDouble());return a}readPackedFixed32(a=[]){const h=this.readPackedEnd();for(;this.pos<h;)a.push(this.readFixed32());return a}readPackedSFixed32(a=[]){const h=this.readPackedEnd();for(;this.pos<h;)a.push(this.readSFixed32());return a}readPackedFixed64(a=[]){const h=this.readPackedEnd();for(;this.pos<h;)a.push(this.readFixed64());return a}readPackedSFixed64(a=[]){const h=this.readPackedEnd();for(;this.pos<h;)a.push(this.readSFixed64());return a}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(a){const h=7&a;if(h===0)for(;this.buf[this.pos++]>127;);else if(h===2)this.pos=this.readVarint()+this.pos;else if(h===5)this.pos+=4;else{if(h!==1)throw new Error(`Unimplemented type: ${h}`);this.pos+=8}}writeTag(a,h){this.writeVarint(a<<3|h)}realloc(a){let h=this.length||16;for(;h<this.pos+a;)h*=2;if(h!==this.length){const y=new Uint8Array(h);y.set(this.buf),this.buf=y,this.dataView=new DataView(y.buffer),this.length=h}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(a){this.realloc(4),this.dataView.setInt32(this.pos,a,!0),this.pos+=4}writeSFixed32(a){this.realloc(4),this.dataView.setInt32(this.pos,a,!0),this.pos+=4}writeFixed64(a){this.realloc(8),this.dataView.setInt32(this.pos,-1&a,!0),this.dataView.setInt32(this.pos+4,Math.floor(a*Y0),!0),this.pos+=8}writeSFixed64(a){this.realloc(8),this.dataView.setInt32(this.pos,-1&a,!0),this.dataView.setInt32(this.pos+4,Math.floor(a*Y0),!0),this.pos+=8}writeVarint(a){(a=+a||0)>268435455||a<0?(function(h,y){let b,S;if(h>=0?(b=h%4294967296|0,S=h/4294967296|0):(b=~(-h%4294967296),S=~(-h/4294967296),4294967295^b?b=b+1|0:(b=0,S=S+1|0)),h>=18446744073709552e3||h<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");y.realloc(10),(function(E,k,F){F.buf[F.pos++]=127&E|128,E>>>=7,F.buf[F.pos++]=127&E|128,E>>>=7,F.buf[F.pos++]=127&E|128,E>>>=7,F.buf[F.pos++]=127&E|128,F.buf[F.pos]=127&(E>>>=7)})(b,0,y),(function(E,k){const F=(7&E)<<4;k.buf[k.pos++]|=F|((E>>>=3)?128:0),E&&(k.buf[k.pos++]=127&E|((E>>>=7)?128:0),E&&(k.buf[k.pos++]=127&E|((E>>>=7)?128:0),E&&(k.buf[k.pos++]=127&E|((E>>>=7)?128:0),E&&(k.buf[k.pos++]=127&E|((E>>>=7)?128:0),E&&(k.buf[k.pos++]=127&E)))))})(S,y)})(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))}writeSVarint(a){this.writeVarint(a<0?2*-a-1:2*a)}writeBoolean(a){this.writeVarint(+a)}writeString(a){a=String(a),this.realloc(4*a.length),this.pos++;const h=this.pos;this.pos=(function(b,S,E){for(let k,F,V=0;V<S.length;V++){if(k=S.charCodeAt(V),k>55295&&k<57344){if(!F){k>56319||V+1===S.length?(b[E++]=239,b[E++]=191,b[E++]=189):F=k;continue}if(k<56320){b[E++]=239,b[E++]=191,b[E++]=189,F=k;continue}k=F-55296<<10|k-56320|65536,F=null}else F&&(b[E++]=239,b[E++]=191,b[E++]=189,F=null);k<128?b[E++]=k:(k<2048?b[E++]=k>>6|192:(k<65536?b[E++]=k>>12|224:(b[E++]=k>>18|240,b[E++]=k>>12&63|128),b[E++]=k>>6&63|128),b[E++]=63&k|128)}return E})(this.buf,a,this.pos);const y=this.pos-h;y>=128&&z_(h,y,this),this.pos=h-1,this.writeVarint(y),this.pos+=y}writeFloat(a){this.realloc(4),this.dataView.setFloat32(this.pos,a,!0),this.pos+=4}writeDouble(a){this.realloc(8),this.dataView.setFloat64(this.pos,a,!0),this.pos+=8}writeBytes(a){const h=a.length;this.writeVarint(h),this.realloc(h);for(let y=0;y<h;y++)this.buf[this.pos++]=a[y]}writeRawMessage(a,h){this.pos++;const y=this.pos;a(h,this);const b=this.pos-y;b>=128&&z_(y,b,this),this.pos=y-1,this.writeVarint(b),this.pos+=b}writeMessage(a,h,y){this.writeTag(a,2),this.writeRawMessage(h,y)}writePackedVarint(a,h){h.length&&this.writeMessage(a,L_,h)}writePackedSVarint(a,h){h.length&&this.writeMessage(a,U_,h)}writePackedBoolean(a,h){h.length&&this.writeMessage(a,V_,h)}writePackedFloat(a,h){h.length&&this.writeMessage(a,Ud,h)}writePackedDouble(a,h){h.length&&this.writeMessage(a,J0,h)}writePackedFixed32(a,h){h.length&&this.writeMessage(a,j_,h)}writePackedSFixed32(a,h){h.length&&this.writeMessage(a,bm,h)}writePackedFixed64(a,h){h.length&&this.writeMessage(a,G_,h)}writePackedSFixed64(a,h){h.length&&this.writeMessage(a,Am,h)}writeBytesField(a,h){this.writeTag(a,2),this.writeBytes(h)}writeFixed32Field(a,h){this.writeTag(a,5),this.writeFixed32(h)}writeSFixed32Field(a,h){this.writeTag(a,5),this.writeSFixed32(h)}writeFixed64Field(a,h){this.writeTag(a,1),this.writeFixed64(h)}writeSFixed64Field(a,h){this.writeTag(a,1),this.writeSFixed64(h)}writeVarintField(a,h){this.writeTag(a,0),this.writeVarint(h)}writeSVarintField(a,h){this.writeTag(a,0),this.writeSVarint(h)}writeStringField(a,h){this.writeTag(a,2),this.writeString(h)}writeFloatField(a,h){this.writeTag(a,5),this.writeFloat(h)}writeDoubleField(a,h){this.writeTag(a,1),this.writeDouble(h)}writeBooleanField(a,h){this.writeVarintField(a,+h)}}function Ld(f,a,h){return h?4294967296*a+(f>>>0):4294967296*(a>>>0)+(f>>>0)}function z_(f,a,h){const y=a<=16383?1:a<=2097151?2:a<=268435455?3:Math.floor(Math.log(a)/(7*Math.LN2));h.realloc(y);for(let b=h.pos-1;b>=f;b--)h.buf[b+y]=h.buf[b]}function L_(f,a){for(let h=0;h<f.length;h++)a.writeVarint(f[h])}function U_(f,a){for(let h=0;h<f.length;h++)a.writeSVarint(f[h])}function Ud(f,a){for(let h=0;h<f.length;h++)a.writeFloat(f[h])}function J0(f,a){for(let h=0;h<f.length;h++)a.writeDouble(f[h])}function V_(f,a){for(let h=0;h<f.length;h++)a.writeBoolean(f[h])}function j_(f,a){for(let h=0;h<f.length;h++)a.writeFixed32(f[h])}function bm(f,a){for(let h=0;h<f.length;h++)a.writeSFixed32(f[h])}function G_(f,a){for(let h=0;h<f.length;h++)a.writeFixed64(f[h])}function Am(f,a){for(let h=0;h<f.length;h++)a.writeSFixed64(f[h])}function W_(f,a,h){f===1&&h.readMessage(og,a)}function og(f,a,h){if(f===3){const{id:y,bitmap:b,width:S,height:E,left:k,top:F,advance:V}=h.readMessage(Z_,{});a.push({id:y,bitmap:new I0({width:S+6,height:E+6},b),metrics:{width:S,height:E,left:k,top:F,advance:V}})}}function Z_(f,a,h){f===1?a.id=h.readVarint():f===2?a.bitmap=h.readBytes():f===3?a.width=h.readVarint():f===4?a.height=h.readVarint():f===5?a.left=h.readSVarint():f===6?a.top=h.readSVarint():f===7&&(a.advance=h.readVarint())}function wm(f){let a=0,h=0;for(const E of f)a+=E.w*E.h,h=Math.max(h,E.w);f.sort(((E,k)=>k.h-E.h));const y=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(a/.95)),h),h:1/0}];let b=0,S=0;for(const E of f)for(let k=y.length-1;k>=0;k--){const F=y[k];if(!(E.w>F.w||E.h>F.h)){if(E.x=F.x,E.y=F.y,S=Math.max(S,E.y+E.h),b=Math.max(b,E.x+E.w),E.w===F.w&&E.h===F.h){const V=y.pop();V&&k<y.length&&(y[k]=V)}else E.h===F.h?(F.x+=E.w,F.w-=E.w):E.w===F.w?(F.y+=E.h,F.h-=E.h):(y.push({x:F.x+E.w,y:F.y,w:F.w-E.w,h:E.h}),F.y+=E.h,F.h-=E.h);break}}return{w:b,h:S,fill:a/(b*S)||0}}class Yn{constructor(a,{pixelRatio:h,version:y,stretchX:b,stretchY:S,content:E,textFitWidth:k,textFitHeight:F}){this.paddedRect=a,this.pixelRatio=h,this.stretchX=b,this.stretchY=S,this.content=E,this.version=y,this.textFitWidth=k,this.textFitHeight=F}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class lg{constructor(a,h){const y={},b={};this.haveRenderCallbacks=[];const S=[];this.addImages(a,y,S),this.addImages(h,b,S);const{w:E,h:k}=wm(S),F=new Ha({width:E||1,height:k||1});for(const V in a){const H=a[V],Y=y[V].paddedRect;Ha.copy(H.data,F,{x:0,y:0},{x:Y.x+1,y:Y.y+1},H.data)}for(const V in h){const H=h[V],Y=b[V].paddedRect,K=Y.x+1,te=Y.y+1,oe=H.data.width,le=H.data.height;Ha.copy(H.data,F,{x:0,y:0},{x:K,y:te},H.data),Ha.copy(H.data,F,{x:0,y:le-1},{x:K,y:te-1},{width:oe,height:1}),Ha.copy(H.data,F,{x:0,y:0},{x:K,y:te+le},{width:oe,height:1}),Ha.copy(H.data,F,{x:oe-1,y:0},{x:K-1,y:te},{width:1,height:le}),Ha.copy(H.data,F,{x:0,y:0},{x:K+oe,y:te},{width:1,height:le})}this.image=F,this.iconPositions=y,this.patternPositions=b}addImages(a,h,y){for(const b in a){const S=a[b],E={x:0,y:0,w:S.data.width+2,h:S.data.height+2};y.push(E),h[b]=new Yn(E,S),S.hasRenderCallback&&this.haveRenderCallbacks.push(b)}}patchUpdatedImages(a,h){a.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const y in a.updatedImages)this.patchUpdatedImage(this.iconPositions[y],a.getImage(y),h),this.patchUpdatedImage(this.patternPositions[y],a.getImage(y),h)}patchUpdatedImage(a,h,y){if(!a||!h||a.version===h.version)return;a.version=h.version;const[b,S]=a.tl;y.update(h.data,void 0,{x:b,y:S})}}var Gh;function Q0(f,a,h,y,b,S,E,k,F,V,H,Y,K,te,oe){const le=Lf.fromFeature(f,b);let ue;Y===_.az.vertical&&le.verticalizePunctuation();let xe=le.determineLineBreaks(V,S,a,y,te);const{processBidirectionalText:De,processStyledBidirectionalText:we}=Br;if(De&&le.sections.length===1){ue=[],xe=xe.map((yt=>le.toCodeUnitIndex(yt)));const Ze=De(le.toString(),xe);for(const yt of Ze){const Bt=[...yt].map((()=>0));ue.push(new Lf(yt,le.sections,Bt))}}else if(we){ue=[],xe=xe.map((Dt=>le.toCodeUnitIndex(Dt)));let Ze=0;const yt=[];for(const Dt of le.text)yt.push(...Array(Dt.length).fill(le.sectionIndex[Ze])),Ze++;const Bt=we(le.text,yt,xe);for(const Dt of Bt){const jt=[];let ai="";for(const Qt of Dt[0])jt.push(Dt[1][ai.length]),ai+=Qt;ue.push(new Lf(Dt[0],le.sections,jt))}}else ue=(function(Ze,yt){const Bt=[];let Dt=0;for(const jt of yt)Bt.push(Ze.substring(Dt,jt)),Dt=jt;return Dt<Ze.length()&&Bt.push(Ze.substring(Dt,Ze.length())),Bt})(le,xe);const Ee=[],Ne={positionedLines:Ee,text:le.toString(),top:H[1],bottom:H[1],left:H[0],right:H[0],writingMode:Y,iconsInText:!1,verticalizable:!1};return(function(Ze,yt,Bt,Dt,jt,ai,Qt,Ot,Ct,_i,pi,Ti){let gi=0,Bi=0,Nn=0,_n=0;const qr=Ot==="right"?1:Ot==="left"?0:.5,Qa=Bs/Ti;let Ys=0;for(const Hn of jt){Hn.trim();const _s=Hn.getMaxScale(),Rs={positionedGlyphs:[],lineOffset:0};Ze.positionedLines[Ys]=Rs;const Cr=Rs.positionedGlyphs;let _l=0;if(!Hn.length()){Bi+=ai,++Ys;continue}const Ka=h2(Dt,Hn,Qa);let yl=0;for(const da of Hn.text){const ls=Hn.getSection(yl),Js=da.codePointAt(0),ys=ug(Ct,pi,Js),pa={glyph:Js,imageName:null,x:gi,y:Bi+-17,vertical:ys,scale:1,fontStack:"",sectionIndex:Hn.getSectionIndex(yl),metrics:null,rect:null};let Wf;if("fontStack"in ls){if(Wf=Vd(ls,Js,ys,Ka,yt,Bt),!Wf)continue;pa.fontStack=ls.fontStack}else{if(Ze.iconsInText=!0,ls.scale*=Qa,Wf=Tm(ls,ys,_s,Ka,Dt),!Wf)continue;_l=Math.max(_l,Wf.imageOffset),pa.imageName=ls.imageName}const{rect:Ku,metrics:e_,baselineOffset:Kd}=Wf;pa.y+=Kd,pa.scale=ls.scale,pa.metrics=e_,pa.rect=Ku,Cr.push(pa),ys?(Ze.verticalizable=!0,gi+=("imageName"in ls?e_.advance:Bs)*ls.scale+_i):gi+=e_.advance*ls.scale+_i,yl++}Cr.length!==0&&(Nn=Math.max(gi-_i,Nn),hg(Cr,0,Cr.length-1,qr)),gi=0,Rs.lineOffset=Math.max(_l,(_s-1)*Bs);const su=ai*_s+_l;Bi+=su,_n=Math.max(su,_n),++Ys}const{horizontalAlign:Yr,verticalAlign:Ur}=cg(Qt);(function(Hn,_s,Rs,Cr,_l,Ka,yl,su,da){const ls=(_s-Rs)*_l;let Js=0;Js=Ka!==yl?-su*Cr- -17:-Cr*da*yl+.5*yl;for(const ys of Hn)for(const pa of ys.positionedGlyphs)pa.x+=ls,pa.y+=Js})(Ze.positionedLines,qr,Yr,Ur,Nn,_n,ai,Bi,jt.length),Ze.top+=-Ur*Bi,Ze.bottom=Ze.top+Bi,Ze.left+=-Yr*Nn,Ze.right=Ze.left+Nn})(Ne,a,h,y,ue,E,k,F,Y,V,K,oe),!(function(Ze){for(const yt of Ze)if(yt.positionedGlyphs.length!==0)return!1;return!0})(Ee)&&Ne}function cg(f){let a=.5,h=.5;switch(f){case"right":case"top-right":case"bottom-right":a=1;break;case"left":case"top-left":case"bottom-left":a=0}switch(f){case"bottom":case"bottom-right":case"bottom-left":h=1;break;case"top":case"top-right":case"top-left":h=0}return{horizontalAlign:a,verticalAlign:h}}function h2(f,a,h){const y=a.getMaxScale()*Bs,{maxImageWidth:b,maxImageHeight:S}=a.getMaxImageSize(f),E=Math.max(y,S*h);return{verticalLineContentWidth:Math.max(y,b*h),horizontalLineContentHeight:E}}function X_(f){switch(f){case"top":return 0;case"center":return .5;default:return 1}}function ug(f,a,h){return!(f===_.az.horizontal||!a&&!Iu(h)||a&&(Rf(h)||(y=h,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(y)))));var y}function Vd(f,a,h,y,b,S){const E=S[f.fontStack],k=(function(V,H,Y,K){if(V&&V.rect)return V;const te=H[Y.fontStack],oe=te&&te[K];return oe?{rect:null,metrics:oe.metrics}:null})(E&&E[a],b,f,a);if(k===null)return null;let F;if(h)F=y.verticalLineContentWidth-f.scale*Bs;else{const V=X_(f.verticalAlign);F=(y.horizontalLineContentHeight-f.scale*Bs)*V}return{rect:k.rect,metrics:k.metrics,baselineOffset:F}}function Tm(f,a,h,y,b){const S=b[f.imageName];if(!S)return null;const E=S.paddedRect,k=S.displaySize,F={width:k[0],height:k[1],left:1,top:-3,advance:a?k[1]:k[0]};let V;if(a)V=y.verticalLineContentWidth-k[1]*f.scale;else{const H=X_(f.verticalAlign);V=(y.horizontalLineContentHeight-k[1]*f.scale)*H}return{rect:E,metrics:F,baselineOffset:V,imageOffset:(a?k[0]:k[1])*f.scale-Bs*h}}function hg(f,a,h,y){if(y===0)return;const b=f[h],S=(f[h].x+b.metrics.advance*b.scale)*y;for(let E=a;E<=h;E++)f[E].x-=S}function Sm(f,a,h){const{horizontalAlign:y,verticalAlign:b}=cg(h),S=a[0]-f.displaySize[0]*y,E=a[1]-f.displaySize[1]*b;return{image:f,top:E,bottom:E+f.displaySize[1],left:S,right:S+f.displaySize[0]}}function Wu(f){var a,h;let y=f.left,b=f.top,S=f.right-y,E=f.bottom-b;const k=(a=f.image.textFitWidth)!==null&&a!==void 0?a:"stretchOrShrink",F=(h=f.image.textFitHeight)!==null&&h!==void 0?h:"stretchOrShrink",V=(f.image.content[2]-f.image.content[0])/(f.image.content[3]-f.image.content[1]);if(F==="proportional"){if(k==="stretchOnly"&&S/E<V||k==="proportional"){const H=Math.ceil(E*V);y*=H/S,S=H}}else if(k==="proportional"&&F==="stretchOnly"&&V!==0&&S/E>V){const H=Math.ceil(S/V);b*=H/E,E=H}return{x1:y,y1:b,x2:y+S,y2:b+E}}function Ec(f,a,h,y,b,S){const E=f.image;let k;if(E.content){const ue=E.content,xe=E.pixelRatio||1;k=[ue[0]/xe,ue[1]/xe,E.displaySize[0]-ue[2]/xe,E.displaySize[1]-ue[3]/xe]}const F=a.left*S,V=a.right*S;let H,Y,K,te;h==="width"||h==="both"?(te=b[0]+F-y[3],Y=b[0]+V+y[1]):(te=b[0]+(F+V-E.displaySize[0])/2,Y=te+E.displaySize[0]);const oe=a.top*S,le=a.bottom*S;return h==="height"||h==="both"?(H=b[1]+oe-y[0],K=b[1]+le+y[2]):(H=b[1]+(oe+le-E.displaySize[1])/2,K=H+E.displaySize[1]),{image:E,top:H,right:Y,bottom:K,left:te,collisionPadding:k}}yi("ImagePosition",Yn),yi("ImageAtlas",lg),_.az=void 0,(Gh=_.az||(_.az={}))[Gh.none=0]="none",Gh[Gh.horizontal=1]="horizontal",Gh[Gh.vertical=2]="vertical",Gh[Gh.horizontalOnly=3]="horizontalOnly";const gl=128,Wh=32640;function Em(f,a){const{expression:h}=a;if(h.kind==="constant")return{kind:"constant",layoutSize:h.evaluate(new Un(f+1))};if(h.kind==="source")return{kind:"source"};{const{zoomStops:y,interpolationType:b}=h;let S=0;for(;S<y.length&&y[S]<=f;)S++;S=Math.max(0,S-1);let E=S;for(;E<y.length&&y[E]<f+1;)E++;E=Math.min(y.length-1,E);const k=y[S],F=y[E];return h.kind==="composite"?{kind:"composite",minZoom:k,maxZoom:F,interpolationType:b}:{kind:"camera",minZoom:k,maxZoom:F,minSize:h.evaluate(new Un(k)),maxSize:h.evaluate(new Un(F)),interpolationType:b}}}function fg(f,a,h){let y="never";const b=f.get(a);return b?y=b:f.get(h)&&(y="always"),y}const H_=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Zu(f,a,h,y,b,S,E,k,F,V,H,Y,K){const te=k?Math.min(Wh,Math.round(k[0])):0,oe=k?Math.min(Wh,Math.round(k[1])):0;f.emplaceBack(a,h,Math.round(32*y),Math.round(32*b),S,E,(te<<1)+(F?1:0),oe,16*V,16*H,256*Y,256*K)}function Mm(f,a,h){f.emplaceBack(a.x,a.y,h),f.emplaceBack(a.x,a.y,h),f.emplaceBack(a.x,a.y,h),f.emplaceBack(a.x,a.y,h)}function K0(f){for(const a of f.sections)if(Nr(a.text))return!0;return!1}class dg{constructor(a){this.layoutVertexArray=new Ue,this.indexArray=new _t,this.programConfigurations=a,this.segments=new ri,this.dynamicLayoutVertexArray=new et,this.opacityVertexArray=new At,this.hasVisibleVertices=!1,this.placedSymbolArray=new O}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(a,h,y,b){this.isEmpty()||(y&&(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,ng.members),this.indexBuffer=a.createIndexBuffer(this.indexArray,h),this.dynamicLayoutVertexBuffer=a.createVertexBuffer(this.dynamicLayoutVertexArray,H0.members,!0),this.opacityVertexBuffer=a.createVertexBuffer(this.opacityVertexArray,H_,!0),this.opacityVertexBuffer.itemSize=1),(y||b)&&this.programConfigurations.upload(a))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}yi("SymbolBuffers",dg);class pg{constructor(a,h,y){this.layoutVertexArray=new a,this.layoutAttributes=h,this.indexArray=new y,this.segments=new ri,this.collisionVertexArray=new bt}upload(a){this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=a.createVertexBuffer(this.collisionVertexArray,Bd.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}yi("CollisionBuffers",pg);class jd{constructor(a){this.collisionBoxArray=a.collisionBoxArray,this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map((E=>E.id)),this.index=a.index,this.pixelRatio=a.pixelRatio,this.sourceLayerIndex=a.sourceLayerIndex,this.hasDependencies=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const h=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Em(this.zoom,h["text-size"]),this.iconSizeData=Em(this.zoom,h["icon-size"]);const y=this.layers[0].layout,b=y.get("symbol-sort-key"),S=y.get("symbol-z-order");this.canOverlap=fg(y,"text-overlap","text-allow-overlap")!=="never"||fg(y,"icon-overlap","icon-allow-overlap")!=="never"||y.get("text-ignore-placement")||y.get("icon-ignore-placement"),this.sortFeaturesByKey=S!=="viewport-y"&&!b.isConstant(),this.sortFeaturesByY=(S==="viewport-y"||S==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,y.get("symbol-placement")==="point"&&(this.writingModes=y.get("text-writing-mode").map((E=>_.az[E]))),this.stateDependentLayerIds=this.layers.filter((E=>E.isStateDependent())).map((E=>E.id)),this.sourceID=a.sourceID}createArrays(){this.text=new dg(new Qc(this.layers,this.zoom,(a=>/^text/.test(a)))),this.icon=new dg(new Qc(this.layers,this.zoom,(a=>/^icon/.test(a)))),this.glyphOffsetArray=new q,this.lineVertexArray=new J,this.symbolInstances=new G,this.textAnchorOffsets=new ie}calculateGlyphDependencies(a,h,y,b,S){for(const E of a)if(h[E.codePointAt(0)]=!0,(y||b)&&S){const k=Vh[E];k&&(h[k.codePointAt(0)]=!0)}}populate(a,h,y){const b=this.layers[0],S=b.layout,E=S.get("text-font"),k=S.get("text-field"),F=S.get("icon-image"),V=(k.value.kind!=="constant"||k.value.value instanceof Ps&&!k.value.value.isEmpty()||k.value.value.toString().length>0)&&(E.value.kind!=="constant"||E.value.value.length>0),H=F.value.kind!=="constant"||!!F.value.value||Object.keys(F.parameters).length>0,Y=S.get("symbol-sort-key");if(this.features=[],!V&&!H)return;const K=h.iconDependencies,te=h.glyphDependencies,oe=h.availableImages,le=new Un(this.zoom);for(const{feature:ue,id:xe,index:De,sourceLayerIndex:we}of a){const Ee=b._featureFilter.needGeometry,Ne=as(ue,Ee);if(!b._featureFilter.filter(le,Ne,y))continue;let Ze,yt;if(Ee||(Ne.geometry=Ss(ue)),V){const Dt=b.getValueAndResolveTokens("text-field",Ne,y,oe),jt=Ps.factory(Dt),ai=this.hasRTLText=this.hasRTLText||K0(jt);(!ai||Br.getRTLTextPluginStatus()==="unavailable"||ai&&Br.isParsed())&&(Ze=$o(jt,b,Ne))}if(H){const Dt=b.getValueAndResolveTokens("icon-image",Ne,y,oe);yt=Dt instanceof Ta?Dt:Ta.fromString(Dt)}if(!Ze&&!yt)continue;const Bt=this.sortFeaturesByKey?Y.evaluate(Ne,{},y):void 0;if(this.features.push({id:xe,text:Ze,icon:yt,index:De,sourceLayerIndex:we,geometry:Ne.geometry,properties:ue.properties,type:Bf.types[ue.type],sortKey:Bt}),yt&&(K[yt.name]=!0),Ze){const Dt=E.evaluate(Ne,{},y).join(","),jt=S.get("text-rotation-alignment")!=="viewport"&&S.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(_.az.vertical)>=0;for(const ai of Ze.sections)if(ai.image)K[ai.image.name]=!0;else{const Qt=zl(Ze.toString()),Ot=ai.fontStack||Dt,Ct=te[Ot]=te[Ot]||{};this.calculateGlyphDependencies(ai.text,Ct,jt,this.allowVerticalPlacement,Qt)}}}S.get("symbol-placement")==="line"&&(this.features=(function(ue){const xe={},De={},we=[];let Ee=0;function Ne(Dt){we.push(ue[Dt]),Ee++}function Ze(Dt,jt,ai){const Qt=De[Dt];return delete De[Dt],De[jt]=Qt,we[Qt].geometry[0].pop(),we[Qt].geometry[0]=we[Qt].geometry[0].concat(ai[0]),Qt}function yt(Dt,jt,ai){const Qt=xe[jt];return delete xe[jt],xe[Dt]=Qt,we[Qt].geometry[0].shift(),we[Qt].geometry[0]=ai[0].concat(we[Qt].geometry[0]),Qt}function Bt(Dt,jt,ai){const Qt=ai?jt[0][jt[0].length-1]:jt[0][0];return`${Dt}:${Qt.x}:${Qt.y}`}for(let Dt=0;Dt<ue.length;Dt++){const jt=ue[Dt],ai=jt.geometry,Qt=jt.text?jt.text.toString():null;if(!Qt){Ne(Dt);continue}const Ot=Bt(Qt,ai),Ct=Bt(Qt,ai,!0);if(Ot in De&&Ct in xe&&De[Ot]!==xe[Ct]){const _i=yt(Ot,Ct,ai),pi=Ze(Ot,Ct,we[_i].geometry);delete xe[Ot],delete De[Ct],De[Bt(Qt,we[pi].geometry,!0)]=pi,we[_i].geometry=null}else Ot in De?Ze(Ot,Ct,ai):Ct in xe?yt(Ot,Ct,ai):(Ne(Dt),xe[Ot]=Ee-1,De[Ct]=Ee-1)}return we.filter((Dt=>Dt.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((ue,xe)=>ue.sortKey-xe.sortKey))}update(a,h,y){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(a,h,this.layers,{imagePositions:y}),this.icon.programConfigurations.updatePaintArrays(a,h,this.layers,{imagePositions:y}))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(a){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(a),this.iconCollisionBox.upload(a)),this.text.upload(a,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(a,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(a,h){const y=this.lineVertexArray.length;if(a.segment!==void 0){let b=a.dist(h[a.segment+1]),S=a.dist(h[a.segment]);const E={};for(let k=a.segment+1;k<h.length;k++)E[k]={x:h[k].x,y:h[k].y,tileUnitDistanceFromAnchor:b},k<h.length-1&&(b+=h[k+1].dist(h[k]));for(let k=a.segment||0;k>=0;k--)E[k]={x:h[k].x,y:h[k].y,tileUnitDistanceFromAnchor:S},k>0&&(S+=h[k-1].dist(h[k]));for(let k=0;k<h.length;k++){const F=E[k];this.lineVertexArray.emplaceBack(F.x,F.y,F.tileUnitDistanceFromAnchor)}}return{lineStartIndex:y,lineLength:this.lineVertexArray.length-y}}addSymbols(a,h,y,b,S,E,k,F,V,H,Y,K){const te=a.indexArray,oe=a.layoutVertexArray,le=a.segments.prepareSegment(4*h.length,oe,te,this.canOverlap?E.sortKey:void 0),ue=this.glyphOffsetArray.length,xe=le.vertexLength,De=this.allowVerticalPlacement&&k===_.az.vertical?Math.PI/2:0,we=E.text&&E.text.sections;for(let Ee=0;Ee<h.length;Ee++){const{tl:Ne,tr:Ze,bl:yt,br:Bt,tex:Dt,pixelOffsetTL:jt,pixelOffsetBR:ai,minFontScaleX:Qt,minFontScaleY:Ot,glyphOffset:Ct,isSDF:_i,sectionIndex:pi}=h[Ee],Ti=le.vertexLength,gi=Ct[1];Zu(oe,F.x,F.y,Ne.x,gi+Ne.y,Dt.x,Dt.y,y,_i,jt.x,jt.y,Qt,Ot),Zu(oe,F.x,F.y,Ze.x,gi+Ze.y,Dt.x+Dt.w,Dt.y,y,_i,ai.x,jt.y,Qt,Ot),Zu(oe,F.x,F.y,yt.x,gi+yt.y,Dt.x,Dt.y+Dt.h,y,_i,jt.x,ai.y,Qt,Ot),Zu(oe,F.x,F.y,Bt.x,gi+Bt.y,Dt.x+Dt.w,Dt.y+Dt.h,y,_i,ai.x,ai.y,Qt,Ot),Mm(a.dynamicLayoutVertexArray,F,De),te.emplaceBack(Ti,Ti+2,Ti+1),te.emplaceBack(Ti+1,Ti+2,Ti+3),le.vertexLength+=4,le.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ct[0]),Ee!==h.length-1&&pi===h[Ee+1].sectionIndex||a.programConfigurations.populatePaintArrays(oe.length,E,E.index,{imagePositions:{},canonical:K,formattedSection:we&&we[pi]})}a.placedSymbolArray.emplaceBack(F.x,F.y,ue,this.glyphOffsetArray.length-ue,xe,V,H,F.segment,y?y[0]:0,y?y[1]:0,b[0],b[1],k,0,!1,0,Y)}_addCollisionDebugVertex(a,h,y,b,S,E){return h.emplaceBack(0,0),a.emplaceBack(y.x,y.y,b,S,Math.round(E.x),Math.round(E.y))}addCollisionDebugVertices(a,h,y,b,S,E,k){const F=S.segments.prepareSegment(4,S.layoutVertexArray,S.indexArray),V=F.vertexLength,H=S.layoutVertexArray,Y=S.collisionVertexArray,K=k.anchorX,te=k.anchorY;this._addCollisionDebugVertex(H,Y,E,K,te,new M(a,h)),this._addCollisionDebugVertex(H,Y,E,K,te,new M(y,h)),this._addCollisionDebugVertex(H,Y,E,K,te,new M(y,b)),this._addCollisionDebugVertex(H,Y,E,K,te,new M(a,b)),F.vertexLength+=4;const oe=S.indexArray;oe.emplaceBack(V,V+1),oe.emplaceBack(V+1,V+2),oe.emplaceBack(V+2,V+3),oe.emplaceBack(V+3,V),F.primitiveLength+=4}addDebugCollisionBoxes(a,h,y,b){for(let S=a;S<h;S++){const E=this.collisionBoxArray.get(S);this.addCollisionDebugVertices(E.x1,E.y1,E.x2,E.y2,b?this.textCollisionBox:this.iconCollisionBox,E.anchorPoint,y)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new pg(pt,Ho.members,ti),this.iconCollisionBox=new pg(pt,Ho.members,ti);for(let a=0;a<this.symbolInstances.length;a++){const h=this.symbolInstances.get(a);this.addDebugCollisionBoxes(h.textBoxStartIndex,h.textBoxEndIndex,h,!0),this.addDebugCollisionBoxes(h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h,!0),this.addDebugCollisionBoxes(h.iconBoxStartIndex,h.iconBoxEndIndex,h,!1),this.addDebugCollisionBoxes(h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex,h,!1)}}_deserializeCollisionBoxesForSymbol(a,h,y,b,S,E,k,F,V){const H={};for(let Y=h;Y<y;Y++){const K=a.get(Y);H.textBox={x1:K.x1,y1:K.y1,x2:K.x2,y2:K.y2,anchorPointX:K.anchorPointX,anchorPointY:K.anchorPointY},H.textFeatureIndex=K.featureIndex;break}for(let Y=b;Y<S;Y++){const K=a.get(Y);H.verticalTextBox={x1:K.x1,y1:K.y1,x2:K.x2,y2:K.y2,anchorPointX:K.anchorPointX,anchorPointY:K.anchorPointY},H.verticalTextFeatureIndex=K.featureIndex;break}for(let Y=E;Y<k;Y++){const K=a.get(Y);H.iconBox={x1:K.x1,y1:K.y1,x2:K.x2,y2:K.y2,anchorPointX:K.anchorPointX,anchorPointY:K.anchorPointY},H.iconFeatureIndex=K.featureIndex;break}for(let Y=F;Y<V;Y++){const K=a.get(Y);H.verticalIconBox={x1:K.x1,y1:K.y1,x2:K.x2,y2:K.y2,anchorPointX:K.anchorPointX,anchorPointY:K.anchorPointY},H.verticalIconFeatureIndex=K.featureIndex;break}return H}deserializeCollisionBoxes(a){this.collisionArrays=[];for(let h=0;h<this.symbolInstances.length;h++){const y=this.symbolInstances.get(h);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(a,y.textBoxStartIndex,y.textBoxEndIndex,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y.iconBoxStartIndex,y.iconBoxEndIndex,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(a,h){const y=a.placedSymbolArray.get(h),b=y.vertexStartIndex+4*y.numGlyphs;for(let S=y.vertexStartIndex;S<b;S+=4)a.indexArray.emplaceBack(S,S+2,S+1),a.indexArray.emplaceBack(S+1,S+2,S+3)}getSortedSymbolIndexes(a){if(this.sortedAngle===a&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const h=Math.sin(a),y=Math.cos(a),b=[],S=[],E=[];for(let k=0;k<this.symbolInstances.length;++k){E.push(k);const F=this.symbolInstances.get(k);b.push(0|Math.round(h*F.anchorX+y*F.anchorY)),S.push(F.featureIndex)}return E.sort(((k,F)=>b[k]-b[F]||S[F]-S[k])),E}addToSortKeyRanges(a,h){const y=this.sortKeyRanges[this.sortKeyRanges.length-1];y&&y.sortKey===h?y.symbolInstanceEnd=a+1:this.sortKeyRanges.push({sortKey:h,symbolInstanceStart:a,symbolInstanceEnd:a+1})}sortFeatures(a){if(this.sortFeaturesByY&&this.sortedAngle!==a&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(a),this.sortedAngle=a,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const h of this.symbolInstanceIndexes){const y=this.symbolInstances.get(h);this.featureSortOrder.push(y.featureIndex),[y.rightJustifiedTextSymbolIndex,y.centerJustifiedTextSymbolIndex,y.leftJustifiedTextSymbolIndex].forEach(((b,S,E)=>{b>=0&&E.indexOf(b)===S&&this.addIndicesForPlacedSymbol(this.text,b)})),y.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,y.verticalPlacedTextSymbolIndex),y.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,y.placedIconSymbolIndex),y.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,y.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let gg,mg;yi("SymbolBucket",jd,{omit:["layers","collisionBoxArray","features","compareText"]}),jd.MAX_GLYPHS=65535,jd.addDynamicAttributes=Mm;var Rm={get paint(){return mg=mg||new Er({"icon-opacity":new Mi(Ke.paint_symbol["icon-opacity"]),"icon-color":new Mi(Ke.paint_symbol["icon-color"]),"icon-halo-color":new Mi(Ke.paint_symbol["icon-halo-color"]),"icon-halo-width":new Mi(Ke.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Mi(Ke.paint_symbol["icon-halo-blur"]),"icon-translate":new xi(Ke.paint_symbol["icon-translate"]),"icon-translate-anchor":new xi(Ke.paint_symbol["icon-translate-anchor"]),"text-opacity":new Mi(Ke.paint_symbol["text-opacity"]),"text-color":new Mi(Ke.paint_symbol["text-color"],{runtimeType:ba,getOverride:f=>f.textColor,hasOverride:f=>!!f.textColor}),"text-halo-color":new Mi(Ke.paint_symbol["text-halo-color"]),"text-halo-width":new Mi(Ke.paint_symbol["text-halo-width"]),"text-halo-blur":new Mi(Ke.paint_symbol["text-halo-blur"]),"text-translate":new xi(Ke.paint_symbol["text-translate"]),"text-translate-anchor":new xi(Ke.paint_symbol["text-translate-anchor"])})},get layout(){return gg=gg||new Er({"symbol-placement":new xi(Ke.layout_symbol["symbol-placement"]),"symbol-spacing":new xi(Ke.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new xi(Ke.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Mi(Ke.layout_symbol["symbol-sort-key"]),"symbol-z-order":new xi(Ke.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new xi(Ke.layout_symbol["icon-allow-overlap"]),"icon-overlap":new xi(Ke.layout_symbol["icon-overlap"]),"icon-ignore-placement":new xi(Ke.layout_symbol["icon-ignore-placement"]),"icon-optional":new xi(Ke.layout_symbol["icon-optional"]),"icon-rotation-alignment":new xi(Ke.layout_symbol["icon-rotation-alignment"]),"icon-size":new Mi(Ke.layout_symbol["icon-size"]),"icon-text-fit":new xi(Ke.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new xi(Ke.layout_symbol["icon-text-fit-padding"]),"icon-image":new Mi(Ke.layout_symbol["icon-image"]),"icon-rotate":new Mi(Ke.layout_symbol["icon-rotate"]),"icon-padding":new Mi(Ke.layout_symbol["icon-padding"]),"icon-keep-upright":new xi(Ke.layout_symbol["icon-keep-upright"]),"icon-offset":new Mi(Ke.layout_symbol["icon-offset"]),"icon-anchor":new Mi(Ke.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new xi(Ke.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new xi(Ke.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new xi(Ke.layout_symbol["text-rotation-alignment"]),"text-field":new Mi(Ke.layout_symbol["text-field"]),"text-font":new Mi(Ke.layout_symbol["text-font"]),"text-size":new Mi(Ke.layout_symbol["text-size"]),"text-max-width":new Mi(Ke.layout_symbol["text-max-width"]),"text-line-height":new xi(Ke.layout_symbol["text-line-height"]),"text-letter-spacing":new Mi(Ke.layout_symbol["text-letter-spacing"]),"text-justify":new Mi(Ke.layout_symbol["text-justify"]),"text-radial-offset":new Mi(Ke.layout_symbol["text-radial-offset"]),"text-variable-anchor":new xi(Ke.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Mi(Ke.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Mi(Ke.layout_symbol["text-anchor"]),"text-max-angle":new xi(Ke.layout_symbol["text-max-angle"]),"text-writing-mode":new xi(Ke.layout_symbol["text-writing-mode"]),"text-rotate":new Mi(Ke.layout_symbol["text-rotate"]),"text-padding":new xi(Ke.layout_symbol["text-padding"]),"text-keep-upright":new xi(Ke.layout_symbol["text-keep-upright"]),"text-transform":new Mi(Ke.layout_symbol["text-transform"]),"text-offset":new Mi(Ke.layout_symbol["text-offset"]),"text-allow-overlap":new xi(Ke.layout_symbol["text-allow-overlap"]),"text-overlap":new xi(Ke.layout_symbol["text-overlap"]),"text-ignore-placement":new xi(Ke.layout_symbol["text-ignore-placement"]),"text-optional":new xi(Ke.layout_symbol["text-optional"])})}};class Cm{constructor(a){if(a.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=a.property.overrides?a.property.overrides.runtimeType:vn,this.defaultValue=a}evaluate(a){if(a.formattedSection){const h=this.defaultValue.property.overrides;if(h&&h.hasOverride(a.formattedSection))return h.getOverride(a.formattedSection)}return a.feature&&a.featureState?this.defaultValue.evaluate(a.feature,a.featureState):this.defaultValue.property.specification.default}eachChild(a){this.defaultValue.isConstant()||a(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}yi("FormatSectionOverride",Cm,{omit:["defaultValue"]});class Zh extends rn{constructor(a,h){super(a,Rm,h)}recalculate(a,h){if(super.recalculate(a,h),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const y=this.layout.get("text-writing-mode");if(y){const b=[];for(const S of y)b.indexOf(S)<0&&b.push(S);this.layout._values["text-writing-mode"]=b}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(a,h,y,b){const S=this.layout.get(a).evaluate(h,{},y,b),E=this._unevaluatedLayout._values[a];return E.isDataDriven()||Rl(E.value)||!S?S:(function(k,F){return F.replace(/{([^{}]+)}/g,((V,H)=>k&&H in k?String(k[H]):""))})(h.properties,S)}createBucket(a){return new jd(a)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const a of Rm.paint.overridableProperties){if(!Zh.hasPaintOverride(this.layout,a))continue;const h=this.paint.get(a),y=new Cm(h),b=new Eu(y,h.property.specification);let S=null;S=h.value.kind==="constant"||h.value.kind==="source"?new Pa("source",b):new cc("composite",b,h.value.zoomStops),this.paint._values[a]=new _o(h.property,S,h.parameters)}}_handleOverridablePaintPropertyUpdate(a,h,y){return!(!this.layout||h.isDataDriven()||y.isDataDriven())&&Zh.hasPaintOverride(this.layout,a)}static hasPaintOverride(a,h){const y=a.get("text-field"),b=Rm.paint.properties[h];let S=!1;const E=k=>{for(const F of k)if(b.overrides&&b.overrides.hasOverride(F))return void(S=!0)};if(y.value.kind==="constant"&&y.value.value instanceof Ps)E(y.value.value.sections);else if(y.value.kind==="source"||y.value.kind==="composite"){const k=V=>{S||(V instanceof lo&&Tr(V.value)===Al?E(V.value.sections):V instanceof mt?E(V.sections):V.eachChild(k))},F=y.value;F._styleExpression&&k(F._styleExpression.expression)}return S}}let $_;var q_={get paint(){return $_=$_||new Er({"background-color":new xi(Ke.paint_background["background-color"]),"background-pattern":new Mh(Ke.paint_background["background-pattern"]),"background-opacity":new xi(Ke.paint_background["background-opacity"])})}};class In extends rn{constructor(a,h){super(a,q_,h)}}class Pm extends rn{constructor(a,h){super(a,{},h),this.onAdd=y=>{this.implementation.onAdd&&this.implementation.onAdd(y,y.painter.context.gl)},this.onRemove=y=>{this.implementation.onRemove&&this.implementation.onRemove(y,y.painter.context.gl)},this.implementation=a}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class _g{constructor(a){this._methodToThrottle=a,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Im={once:!0},yg=63710088e-1;class nu{constructor(a,h){if(isNaN(a)||isNaN(h))throw new Error(`Invalid LngLat object: (${a}, ${h})`);if(this.lng=+a,this.lat=+h,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new nu(yn(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(a){const h=Math.PI/180,y=this.lat*h,b=a.lat*h,S=Math.sin(y)*Math.sin(b)+Math.cos(y)*Math.cos(b)*Math.cos((a.lng-this.lng)*h);return yg*Math.acos(Math.min(S,1))}static convert(a){if(a instanceof nu)return a;if(Array.isArray(a)&&(a.length===2||a.length===3))return new nu(Number(a[0]),Number(a[1]));if(!Array.isArray(a)&&typeof a=="object"&&a!==null)return new nu(Number("lng"in a?a.lng:a.lon),Number(a.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Uf=2*Math.PI*yg;function ep(f){return Uf*Math.cos(f*Math.PI/180)}function Y_(f){return(180+f)/360}function Xh(f){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+f*Math.PI/360)))/360}function J_(f,a){return f/ep(a)}function Q_(f){return 360*f-180}function tp(f){return 360/Math.PI*Math.atan(Math.exp((180-360*f)*Math.PI/180))-90}function km(f,a){return f*ep(tp(a))}class Jn{constructor(a,h,y=0){this.x=+a,this.y=+h,this.z=+y}static fromLngLat(a,h=0){const y=nu.convert(a);return new Jn(Y_(y.lng),Xh(y.lat),J_(h,y.lat))}toLngLat(){return new nu(Q_(this.x),tp(this.y))}toAltitude(){return km(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Uf*(a=tp(this.y),1/Math.cos(a*Math.PI/180));var a}}function Gd(f,a,h){var y=2*Math.PI*6378137/256/Math.pow(2,h);return[f*y-2*Math.PI*6378137/2,a*y-2*Math.PI*6378137/2]}class Es{constructor(a,h,y){if(!(function(b,S,E){return!(b<0||b>25||E<0||E>=Math.pow(2,b)||S<0||S>=Math.pow(2,b))})(a,h,y))throw new Error(`x=${h}, y=${y}, z=${a} outside of bounds. 0<=x<${Math.pow(2,a)}, 0<=y<${Math.pow(2,a)} 0<=z<=25 `);this.z=a,this.x=h,this.y=y,this.key=Wd(0,a,a,h,y)}equals(a){return this.z===a.z&&this.x===a.x&&this.y===a.y}url(a,h,y){const b=(E=this.y,k=this.z,F=Gd(256*(S=this.x),256*(E=Math.pow(2,k)-E-1),k),V=Gd(256*(S+1),256*(E+1),k),F[0]+","+F[1]+","+V[0]+","+V[1]);var S,E,k,F,V;const H=(function(Y,K,te){let oe,le="";for(let ue=Y;ue>0;ue--)oe=1<<ue-1,le+=(K&oe?1:0)+(te&oe?2:0);return le})(this.z,this.x,this.y);return a[(this.x+this.y)%a.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(y==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,h>1?"@2x":"").replace(/{quadkey}/g,H).replace(/{bbox-epsg-3857}/g,b)}isChildOf(a){const h=this.z-a.z;return h>0&&a.x===this.x>>h&&a.y===this.y>>h}getTilePoint(a){const h=Math.pow(2,this.z);return new M((a.x*h-this.x)*li,(a.y*h-this.y)*li)}toString(){return`${this.z}/${this.x}/${this.y}`}}class K_{constructor(a,h){this.wrap=a,this.canonical=h,this.key=Wd(a,h.z,h.z,h.x,h.y)}}class qo{constructor(a,h,y,b,S){if(this.terrainRttPosMatrix32f=null,a<y)throw new Error(`overscaledZ should be >= z; overscaledZ = ${a}; z = ${y}`);this.overscaledZ=a,this.wrap=h,this.canonical=new Es(y,+b,+S),this.key=Wd(h,a,y,b,S)}clone(){return new qo(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(a){return this.overscaledZ===a.overscaledZ&&this.wrap===a.wrap&&this.canonical.equals(a.canonical)}scaledTo(a){if(a>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${a}; overscaledZ = ${this.overscaledZ}`);const h=this.canonical.z-a;return a>this.canonical.z?new qo(a,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new qo(a,this.wrap,a,this.canonical.x>>h,this.canonical.y>>h)}isOverscaled(){return this.overscaledZ>this.canonical.z}calculateScaledKey(a,h){if(a>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${a}; overscaledZ = ${this.overscaledZ}`);const y=this.canonical.z-a;return a>this.canonical.z?Wd(this.wrap*+h,a,this.canonical.z,this.canonical.x,this.canonical.y):Wd(this.wrap*+h,a,a,this.canonical.x>>y,this.canonical.y>>y)}isChildOf(a){if(a.wrap!==this.wrap||this.overscaledZ-a.overscaledZ<=0)return!1;if(a.overscaledZ===0)return this.overscaledZ>0;const h=this.canonical.z-a.canonical.z;return!(h<0)&&a.canonical.x===this.canonical.x>>h&&a.canonical.y===this.canonical.y>>h}children(a){if(this.overscaledZ>=a)return[new qo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const h=this.canonical.z+1,y=2*this.canonical.x,b=2*this.canonical.y;return[new qo(h,this.wrap,h,y,b),new qo(h,this.wrap,h,y+1,b),new qo(h,this.wrap,h,y,b+1),new qo(h,this.wrap,h,y+1,b+1)]}isLessThan(a){return this.wrap<a.wrap||!(this.wrap>a.wrap)&&(this.overscaledZ<a.overscaledZ||!(this.overscaledZ>a.overscaledZ)&&(this.canonical.x<a.canonical.x||!(this.canonical.x>a.canonical.x)&&this.canonical.y<a.canonical.y))}wrapped(){return new qo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(a){return new qo(this.overscaledZ,a,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new K_(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(a){return this.canonical.getTilePoint(new Jn(a.x-this.wrap,a.y))}}function Wd(f,a,h,y,b){(f*=2)<0&&(f=-1*f-1);const S=1<<h;return(S*S*f+S*b+y).toString(36)+h.toString(36)+a.toString(36)}function Zd(f,a){return a?f.properties[a]:f.id}function Dm(f,a){const h={id:f.id};if(a.removeAllProperties&&(delete f.removeProperties,delete f.addOrUpdateProperties,delete a.removeProperties),a.removeProperties)for(const y of a.removeProperties){const b=f.addOrUpdateProperties.findIndex((S=>S.key===y));b>-1&&f.addOrUpdateProperties.splice(b,1)}return(f.removeAllProperties||a.removeAllProperties)&&(h.removeAllProperties=!0),(f.removeProperties||a.removeProperties)&&(h.removeProperties=[...f.removeProperties||[],...a.removeProperties||[]]),(f.addOrUpdateProperties||a.addOrUpdateProperties)&&(h.addOrUpdateProperties=[...f.addOrUpdateProperties||[],...a.addOrUpdateProperties||[]]),(f.newGeometry||a.newGeometry)&&(h.newGeometry=a.newGeometry||f.newGeometry),h}function ip(f){var a,h;if(!f)return{};const y={};return y.removeAll=f.removeAll,y.remove=new Set(f.remove||[]),y.add=new Map((a=f.add)===null||a===void 0?void 0:a.map((b=>[b.id,b]))),y.update=new Map((h=f.update)===null||h===void 0?void 0:h.map((b=>[b.id,b]))),y}yi("CanonicalTileID",Es),yi("OverscaledTileID",qo,{omit:["terrainRttPosMatrix32f"]});class Hh{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(a){return this.minX=Math.min(this.minX,a.x),this.minY=Math.min(this.minY,a.y),this.maxX=Math.max(this.maxX,a.x),this.maxY=Math.max(this.maxY,a.y),this}expandBy(a){return this.minX-=a,this.minY-=a,this.maxX+=a,this.maxY+=a,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(a){return this.expandBy(-a)}map(a){const h=new Hh;return h.extend(a(new M(this.minX,this.minY))),h.extend(a(new M(this.maxX,this.minY))),h.extend(a(new M(this.minX,this.maxY))),h.extend(a(new M(this.maxX,this.maxY))),h}static fromPoints(a){const h=new Hh;for(const y of a)h.extend(y);return h}contains(a){return a.x>=this.minX&&a.x<=this.maxX&&a.y>=this.minY&&a.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(a){return!this.empty()&&!a.empty()&&a.minX>=this.minX&&a.maxX<=this.maxX&&a.minY>=this.minY&&a.maxY<=this.maxY}intersects(a){return!this.empty()&&!a.empty()&&a.minX<=this.maxX&&a.maxX>=this.minX&&a.minY<=this.maxY&&a.maxY>=this.minY}}class Om{constructor(a){this._stringToNumber={},this._numberToString=[];for(let h=0;h<a.length;h++){const y=a[h];this._stringToNumber[y]=h,this._numberToString[h]=y}}encode(a){return this._stringToNumber[a]}decode(a){if(a>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${a} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[a]}}class vg{constructor(a,h,y,b,S){this.type="Feature",this._vectorTileFeature=a,this._x=y,this._y=b,this._z=h,this.properties=a.properties,this.id=S}projectPoint(a,h,y,b){return[360*(a.x+h)/b-180,360/Math.PI*Math.atan(Math.exp((1-2*(a.y+y)/b)*Math.PI))-90]}projectLine(a,h,y,b){return a.map((S=>this.projectPoint(S,h,y,b)))}get geometry(){if(this._geometry)return this._geometry;const a=this._vectorTileFeature,h=a.extent*Math.pow(2,this._z),y=a.extent*this._x,b=a.extent*this._y,S=a.loadGeometry();switch(a.type){case 1:{const E=[];for(const F of S)E.push(F[0]);const k=this.projectLine(E,y,b,h);this._geometry=E.length===1?{type:"Point",coordinates:k[0]}:{type:"MultiPoint",coordinates:k};break}case 2:{const E=S.map((k=>this.projectLine(k,y,b,h)));this._geometry=E.length===1?{type:"LineString",coordinates:E[0]}:{type:"MultiLineString",coordinates:E};break}case 3:{const E=F_(S),k=[];for(const F of E)k.push(F.map((V=>this.projectLine(V,y,b,h))));this._geometry=k.length===1?{type:"Polygon",coordinates:k[0]}:{type:"MultiPolygon",coordinates:k};break}default:throw new Error(`unknown feature type: ${a.type}`)}return this._geometry}set geometry(a){this._geometry=a}toJSON(){const a={geometry:this.geometry};for(const h in this)h!=="_geometry"&&h!=="_vectorTileFeature"&&h!=="_x"&&h!=="_y"&&h!=="_z"&&(a[h]=this[h]);return a}}class $h{constructor(a,h,y){pe(this,"_name");pe(this,"dataBuffer");pe(this,"nullabilityBuffer");pe(this,"_size");this._name=a,this.dataBuffer=h,typeof y=="number"?this._size=y:(this.nullabilityBuffer=y,this._size=y.size())}getValue(a){return this.nullabilityBuffer&&!this.nullabilityBuffer.get(a)?null:this.getValueFromBuffer(a)}has(a){return this.nullabilityBuffer&&this.nullabilityBuffer.get(a)||!this.nullabilityBuffer}get name(){return this._name}get size(){return this._size}}class Xu extends $h{}class Hu extends Xu{getValueFromBuffer(a){return this.dataBuffer[a]}}class qh extends Xu{getValueFromBuffer(a){return this.dataBuffer[a]}}class Fm extends $h{constructor(h,y,b,S){super(h,y,S);pe(this,"delta");this.delta=b}}class Nm extends Fm{constructor(a,h,y,b){super(a,Int32Array.of(h),y,b)}getValueFromBuffer(a){return this.dataBuffer[0]+a*this.delta}}class np extends $h{constructor(a,h,y){super(a,Int32Array.of(h),y)}getValueFromBuffer(a){return this.dataBuffer[0]}}class $u{constructor(a,h,y,b,S=4096){pe(this,"_name");pe(this,"_geometryVector");pe(this,"_idVector");pe(this,"_propertyVectors");pe(this,"_extent");pe(this,"propertyVectorsMap");this._name=a,this._geometryVector=h,this._idVector=y,this._propertyVectors=b,this._extent=S}get name(){return this._name}get idVector(){return this._idVector}get geometryVector(){return this._geometryVector}get propertyVectors(){return this._propertyVectors}getPropertyVector(a){return this.propertyVectorsMap||(this.propertyVectorsMap=new Map(this._propertyVectors.map((h=>[h.name,h])))),this.propertyVectorsMap.get(a)}*[Symbol.iterator](){const a=this.geometryVector[Symbol.iterator]();let h=0;for(;h<this.numFeatures;){let y;this.idVector&&(y=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(h)):this.idVector.getValue(h));const b=a==null?void 0:a.next().value,S={};for(const E of this.propertyVectors){if(!E)continue;const k=E.name,F=E.getValue(h);F!==null&&(S[k]=F)}h++,yield{id:y,geometry:b,properties:S}}}get numFeatures(){return this.geometryVector.numGeometries}get extent(){return this._extent}getFeatures(){const a=[],h=this.geometryVector.getGeometries();for(let y=0;y<this.numFeatures;y++){let b;this.idVector&&(b=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(y)):this.idVector.getValue(y));const S={coordinates:h[y],type:this.geometryVector.geometryType(y)},E={};for(const k of this.propertyVectors){if(!k)continue;const F=k.name,V=k.getValue(y);V!==null&&(E[F]=V)}a.push({id:b,geometry:S,properties:E})}return a}containsMaxSaveIntegerValues(a){return a instanceof Hu||a instanceof np&&a instanceof Nm||a instanceof qh}}class ey{constructor(a){pe(this,"value");this.value=a}get(){return this.value}set(a){this.value=a}increment(){return this.value++}add(a){this.value+=a}}var on,Mc,ha,Rc,Yh,$a,Ms,$s,ml,qa;function qs(f,a,h){const y=new Int32Array(h);let b=0,S=a.get();for(let E=0;E<y.length;E++){let k=f[S++],F=127&k;k<128||(k=f[S++],F|=(127&k)<<7,k<128||(k=f[S++],F|=(127&k)<<14,k<128||(k=f[S++],F|=(127&k)<<21,k<128||(k=f[S++],F|=(15&k)<<28)))),y[b++]=F}return a.set(S),y}function rp(f,a,h){const y=new BigInt64Array(h);for(let b=0;b<y.length;b++)y[b]=xg(f,a);return y}function ty(f,a){let h,y;return y=f[a.get()],a.increment(),h=127&y,y<128?h:(y=f[a.get()],a.increment(),h|=(127&y)<<7,y<128?h:(y=f[a.get()],a.increment(),h|=(127&y)<<14,y<128?h:(y=f[a.get()],a.increment(),h|=(127&y)<<21,y<128?h:(y=f[a.get()],h|=(15&y)<<28,(function(b,S,E){let k,F;if(F=S[E.get()],E.increment(),k=(112&F)>>4,F<128||(F=S[E.get()],E.increment(),k|=(127&F)<<3,F<128)||(F=S[E.get()],E.increment(),k|=(127&F)<<10,F<128)||(F=S[E.get()],E.increment(),k|=(127&F)<<17,F<128)||(F=S[E.get()],E.increment(),k|=(127&F)<<24,F<128)||(F=S[E.get()],E.increment(),k|=(1&F)<<31,F<128))return 4294967296*k+(b>>>0);throw new Error("Expected varint not more than 10 bytes")})(h,f,a)))))}function Xd(f,a,h,y){throw new Error("FastPFor is not implemented yet.")}function fa(f){return f>>>1^-(1&f)}function Vf(f){return f>>1n^-(1n&f)}function xg(f,a){let h=0n,y=0,b=a.get();for(;b<f.length;){const S=f[b++];if(h|=BigInt(127&S)<<BigInt(y),!(128&S))break;if(y+=7,y>=64)throw new Error("Varint too long")}return a.set(b),h}function ru(f,a,h){const y=new Int32Array(h);let b=0;for(let S=0;S<a;S++){const E=f[S];y.fill(f[S+a],b,b+E),b+=E}return y}function iy(f,a,h){const y=new BigInt64Array(h);let b=0;for(let S=0;S<a;S++){const E=Number(f[S]);y.fill(f[S+a],b,b+E),b+=E}return y}function ny(f,a,h){const y=new Float64Array(h);let b=0;for(let S=0;S<a;S++){const E=f[S];y.fill(f[S+a],b,b+E),b+=E}return y}function Jh(f){const a=f.length/4*4;let h=1;if(a>=4)for(let y=f[0];h<a-4;h+=4)y=f[h]+=y,y=f[h+1]+=y,y=f[h+2]+=y,y=f[h+3]+=y;for(;h!=f.length;)f[h]+=f[h-1],++h}function Bm(f){f[0]=f[0]>>>1^-(1&f[0]),f[1]=f[1]>>>1^-(1&f[1]);const a=f.length/4*4;let h=2;if(a>=4)for(;h<a-4;h+=4){const y=f[h],b=f[h+1],S=f[h+2],E=f[h+3];f[h]=(y>>>1^-(1&y))+f[h-2],f[h+1]=(b>>>1^-(1&b))+f[h-1],f[h+2]=(S>>>1^-(1&S))+f[h],f[h+3]=(E>>>1^-(1&E))+f[h+1]}for(;h!=f.length;h+=2)f[h]=(f[h]>>>1^-(1&f[h]))+f[h-2],f[h+1]=(f[h+1]>>>1^-(1&f[h+1]))+f[h-1]}(function(f){f.NONE="NONE",f.DELTA="DELTA",f.COMPONENTWISE_DELTA="COMPONENTWISE_DELTA",f.RLE="RLE",f.MORTON="MORTON",f.PDE="PDE"})(on||(on={})),(function(f){f.NONE="NONE",f.FAST_PFOR="FAST_PFOR",f.VARINT="VARINT",f.ALP="ALP"})(Mc||(Mc={})),(function(f){f.PRESENT="PRESENT",f.DATA="DATA",f.OFFSET="OFFSET",f.LENGTH="LENGTH"})(ha||(ha={}));class zm{constructor(a,h,y){pe(this,"_dictionaryType");pe(this,"_offsetType");pe(this,"_lengthType");this._dictionaryType=a,this._offsetType=h,this._lengthType=y}get dictionaryType(){return this._dictionaryType}get offsetType(){return this._offsetType}get lengthType(){return this._lengthType}}function Ya(f,a){const h=(function(y,b){const S=y[b.get()],E=Object.values(ha)[S>>4];let k=null;switch(E){case ha.DATA:k=new zm(Object.values(Rc)[15&S]);break;case ha.OFFSET:k=new zm(null,Object.values(Yh)[15&S]);break;case ha.LENGTH:k=new zm(null,null,Object.values($a)[15&S])}b.increment();const F=y[b.get()],V=Object.values(on)[F>>5],H=Object.values(on)[F>>2&7],Y=Object.values(Mc)[3&F];b.increment();const K=qs(y,b,2),te=K[0];return{physicalStreamType:E,logicalStreamType:k,logicalLevelTechnique1:V,logicalLevelTechnique2:H,physicalLevelTechnique:Y,numValues:te,byteLength:K[1],decompressedCount:te}})(f,a);return h.logicalLevelTechnique1===on.MORTON?(function(y,b,S){const E=qs(b,S,2);return{physicalStreamType:y.physicalStreamType,logicalStreamType:y.logicalStreamType,logicalLevelTechnique1:y.logicalLevelTechnique1,logicalLevelTechnique2:y.logicalLevelTechnique2,physicalLevelTechnique:y.physicalLevelTechnique,numValues:y.numValues,byteLength:y.byteLength,decompressedCount:y.decompressedCount,numBits:E[0],coordinateShift:E[1]}})(h,f,a):on.RLE!==h.logicalLevelTechnique1&&on.RLE!==h.logicalLevelTechnique2||Mc.NONE===h.physicalLevelTechnique?h:(function(y,b,S){const E=qs(b,S,2);return{physicalStreamType:y.physicalStreamType,logicalStreamType:y.logicalStreamType,logicalLevelTechnique1:y.logicalLevelTechnique1,logicalLevelTechnique2:y.logicalLevelTechnique2,physicalLevelTechnique:y.physicalLevelTechnique,numValues:y.numValues,byteLength:y.byteLength,decompressedCount:E[1],runs:E[0],numRleValues:E[1]}})(h,f,a)}(function(f){f.NONE="NONE",f.SINGLE="SINGLE",f.SHARED="SHARED",f.VERTEX="VERTEX",f.MORTON="MORTON",f.FSST="FSST"})(Rc||(Rc={})),(function(f){f.VERTEX="VERTEX",f.INDEX="INDEX",f.STRING="STRING",f.KEY="KEY"})(Yh||(Yh={})),(function(f){f.VAR_BINARY="VAR_BINARY",f.GEOMETRIES="GEOMETRIES",f.PARTS="PARTS",f.RINGS="RINGS",f.TRIANGLES="TRIANGLES",f.SYMBOL="SYMBOL",f.DICTIONARY="DICTIONARY"})($a||($a={})),(function(f){f[f.FLAT=0]="FLAT",f[f.CONST=1]="CONST",f[f.SEQUENCE=2]="SEQUENCE",f[f.DICTIONARY=3]="DICTIONARY",f[f.FSST_DICTIONARY=4]="FSST_DICTIONARY"})(Ms||(Ms={}));class Cc{constructor(a,h){pe(this,"values");pe(this,"_size");this.values=a,this._size=h}get(a){const h=Math.floor(a/8);return(this.values[h]>>a%8&1)==1}set(a,h){const y=Math.floor(a/8);this.values[y]=this.values[y]|(h?1:0)<<a%8}getInt(a){const h=Math.floor(a/8);return this.values[h]>>a%8&1}size(){return this._size}getBuffer(){return this.values}}function Ja(f,a,h,y,b){return(function(S,E,k){switch(E.logicalLevelTechnique1){case on.DELTA:return E.logicalLevelTechnique2===on.RLE?(function(F,V,H){const Y=new Int32Array(H);let K=0,te=0;for(let oe=0;oe<V;oe++){const le=F[oe],ue=fa(F[oe+V]);for(let xe=0;xe<le;xe++)te+=ue,Y[K++]=te}return Y})(S,E.runs,E.numRleValues):((function(F){F[0]=F[0]>>>1^-(1&F[0]);const V=F.length/4*4;let H=1;if(V>=4)for(;H<V-4;H+=4){const Y=F[H],K=F[H+1],te=F[H+2],oe=F[H+3];F[H]=(Y>>>1^-(1&Y))+F[H-1],F[H+1]=(K>>>1^-(1&K))+F[H],F[H+2]=(te>>>1^-(1&te))+F[H+1],F[H+3]=(oe>>>1^-(1&oe))+F[H+2]}for(;H!=F.length;++H)F[H]=(F[H]>>>1^-(1&F[H]))+F[H-1]})(S),S);case on.RLE:return(function(F,V,H){return H?(function(Y,K,te){const oe=new Int32Array(te);let le=0;for(let ue=0;ue<K;ue++){const xe=Y[ue];let De=Y[ue+K];De=De>>>1^-(1&De),oe.fill(De,le,le+xe),le+=xe}return oe})(F,V.runs,V.numRleValues):ru(F,V.runs,V.numRleValues)})(S,E,k);case on.MORTON:return Jh(S),S;case on.COMPONENTWISE_DELTA:return Bm(S),S;case on.NONE:return k&&(function(F){for(let V=0;V<F.length;V++){const H=F[V];F[V]=H>>>1^-(1&H)}})(S),S;default:throw new Error(`The specified Logical level technique is not supported: ${E.logicalLevelTechnique1}`)}})(bg(f,a,h),h,y)}function qu(f,a,h){return(function(y,b){if(b.logicalLevelTechnique1===on.DELTA&&b.logicalLevelTechnique2===on.NONE)return(function(E){const k=new Int32Array(E.length+1);k[0]=0,k[1]=fa(E[0]);let F=k[1],V=2;for(;V!=k.length;++V){const H=E[V-1];F+=H>>>1^-(1&H),k[V]=k[V-1]+F}return k})(y);if(b.logicalLevelTechnique1===on.RLE&&b.logicalLevelTechnique2===on.NONE)return(function(E,k,F){const V=new Int32Array(F+1);V[0]=0;let H=1,Y=V[0];for(let K=0;K<k;K++){const te=E[K],oe=E[K+k];for(let le=H;le<H+te;le++)V[le]=oe+Y,Y=V[le];H+=te}return V})(y,b.runs,b.numRleValues);if(b.logicalLevelTechnique1===on.NONE&&b.logicalLevelTechnique2===on.NONE){(function(E){let k=0;for(let F=0;F<E.length;F++)E[F]+=k,k=E[F]})(y);const S=new Int32Array(b.numValues+1);return S[0]=0,S.set(y,1),S}if(b.logicalLevelTechnique1===on.DELTA&&b.logicalLevelTechnique2===on.RLE){const S=(function(E,k,F){const V=new Int32Array(F+1);V[0]=0;let H=1,Y=V[0];for(let K=0;K<k;K++){const te=E[K];let oe=E[K+k];oe=oe>>>1^-(1&oe);for(let le=H;le<H+te;le++)V[le]=oe+Y,Y=V[le];H+=te}return V})(y,b.runs,b.numRleValues);return Jh(S),S}throw new Error("Only delta encoding is supported for transforming length to offset streams yet.")})(bg(f,a,h),h)}function bg(f,a,h){const y=h.physicalLevelTechnique;if(y===Mc.FAST_PFOR)return Xd();if(y===Mc.VARINT)return qs(f,a,h.numValues);if(y===Mc.NONE){const b=a.get();a.add(h.byteLength);const S=f.subarray(b,a.get());return new Int32Array(S)}throw new Error("Specified physicalLevelTechnique is not supported (yet).")}function Lm(f,a,h,y){const b=bg(f,a,h);if(b.length===1){const S=b[0];return y?fa(S):S}return y?(function(S){return fa(S[1])})(b):(function(S){return S[1]})(b)}function Um(f,a,h){return(function(y){if(y.length==2){const b=fa(y[1]);return[b,b]}return[fa(y[2]),fa(y[3])]})(bg(f,a,h))}function jf(f,a,h){return(function(y){if(y.length==2){const b=Vf(y[1]);return[b,b]}return[Vf(y[2]),Vf(y[3])]})(rp(f,a,h.numValues))}function Hd(f,a,h,y){return(function(b,S,E){switch(S.logicalLevelTechnique1){case on.DELTA:return S.logicalLevelTechnique2===on.RLE?(function(k,F,V){const H=new BigInt64Array(V);let Y=0,K=0n;for(let te=0;te<F;te++){const oe=Number(k[te]),le=Vf(k[te+F]);for(let ue=0;ue<oe;ue++)K+=le,H[Y++]=K}return H})(b,S.runs,S.numRleValues):((function(k){k[0]=k[0]>>1n^-(1n&k[0]);const F=k.length/4*4;let V=1;if(F>=4)for(;V<F-4;V+=4){const H=k[V],Y=k[V+1],K=k[V+2],te=k[V+3];k[V]=(H>>1n^-(1n&H))+k[V-1],k[V+1]=(Y>>1n^-(1n&Y))+k[V],k[V+2]=(K>>1n^-(1n&K))+k[V+1],k[V+3]=(te>>1n^-(1n&te))+k[V+2]}for(;V!=k.length;++V)k[V]=(k[V]>>1n^-(1n&k[V]))+k[V-1]})(b),b);case on.RLE:return(function(k,F,V){return V?(function(H,Y,K){const te=new BigInt64Array(K);let oe=0;for(let le=0;le<Y;le++){const ue=Number(H[le]);let xe=H[le+Y];xe=xe>>1n^-(1n&xe),te.fill(xe,oe,oe+ue),oe+=ue}return te})(k,F.runs,F.numRleValues):iy(k,F.runs,F.numRleValues)})(b,S,E);case on.NONE:return E&&(function(k){for(let F=0;F<k.length;F++){const V=k[F];k[F]=V>>1n^-(1n&V)}})(b),b;default:throw new Error(`The specified Logical level technique is not supported: ${S.logicalLevelTechnique1}`)}})(rp(f,a,h.numValues),h,y)}function Vm(f,a,h,y){const b=rp(f,a,h.numValues);if(b.length===1){const S=b[0];return y?Vf(S):S}return y?(function(S){return Vf(S[1])})(b):(function(S){return S[1]})(b)}function jm(f,a,h,y,b){return(function(S,E,k,F){switch(E.logicalLevelTechnique1){case on.DELTA:return E.logicalLevelTechnique2===on.RLE&&(S=ru(S,E.runs,E.numRleValues)),(function(V,H){const Y=new Int32Array(V.size());let K=0;V.get(0)?(Y[0]=V.get(0)?H[0]>>>1^-(1&H[0]):0,K=1):Y[0]=0;let te=1;for(;te!=Y.length;++te)Y[te]=V.get(te)?Y[te-1]+(H[K]>>>1^-(1&H[K++])):Y[te-1];return Y})(F,S);case on.RLE:return(function(V,H,Y,K){const te=H;return Y?(function(oe,le,ue){const xe=new Int32Array(oe.size());let De=0;for(let we=0;we<ue;we++){const Ee=le[we];let Ne=le[we+ue];Ne=Ne>>>1^-(1&Ne);for(let Ze=De;Ze<De+Ee;Ze++)oe.get(Ze)?xe[Ze]=Ne:(xe[Ze]=0,De++);De+=Ee}return xe})(K,V,te.runs):(function(oe,le,ue){const xe=new Int32Array(oe.size());let De=0;for(let we=0;we<ue;we++){const Ee=le[we],Ne=le[we+ue];for(let Ze=De;Ze<De+Ee;Ze++)oe.get(Ze)?xe[Ze]=Ne:(xe[Ze]=0,De++);De+=Ee}return xe})(K,V,te.runs)})(S,E,k,F);case on.MORTON:return Jh(S),S;case on.COMPONENTWISE_DELTA:return Bm(S),S;case on.NONE:return S=k?(function(V,H){const Y=new Int32Array(V.size());let K=0,te=0;for(;te!=Y.length;++te)if(V.get(te)){const oe=H[K++];Y[te]=oe>>>1^-(1&oe)}else Y[te]=0;return Y})(F,S):(function(V,H){const Y=new Int32Array(V.size());let K=0,te=0;for(;te!=Y.length;++te)Y[te]=V.get(te)?H[K++]:0;return Y})(F,S),S;default:throw new Error("The specified Logical level technique is not supported")}})(h.physicalLevelTechnique===Mc.FAST_PFOR?Xd():qs(f,a,h.numValues),h,y,b)}function Yu(f,a,h,y){const b=f.logicalLevelTechnique1;if(b===on.RLE)return f.runs===1?Ms.CONST:Ms.FLAT;const S=a instanceof Cc?a.size():a;if(b===on.DELTA&&f.logicalLevelTechnique2===on.RLE){const E=f.runs,k=2;if(f.numRleValues!==S)return Ms.FLAT;if(E===1)return Ms.SEQUENCE;if(E===2){const F=y.get();let V;if(f.physicalLevelTechnique===Mc.VARINT)V=qs(h,y,4);else{const H=y.get();V=new Int32Array(h.buffer,h.byteOffset+H,4)}if(y.set(F),V[2]===k&&V[3]===k)return Ms.SEQUENCE}}return f.numValues===1?Ms.CONST:Ms.FLAT}class $d extends Xu{getValueFromBuffer(a){return this.dataBuffer[a]}}class Gm extends Fm{constructor(a,h,y,b){super(a,BigInt64Array.of(h),y,b)}getValueFromBuffer(a){return this.dataBuffer[0]+BigInt(a)*this.delta}}class Ju{constructor(a,h,y){pe(this,"_geometryOffsets");pe(this,"_partOffsets");pe(this,"_ringOffsets");this._geometryOffsets=a,this._partOffsets=h,this._ringOffsets=y}get geometryOffsets(){return this._geometryOffsets}get partOffsets(){return this._partOffsets}get ringOffsets(){return this._ringOffsets}}function sp(f,a,h){return{x:Ag(f,a)-h,y:Ag(f>>1,a)-h}}function Ag(f,a){let h=0;for(let y=0;y<a;y++)h|=(f&1<<2*y)>>y;return h}(function(f){f[f.POINT=0]="POINT",f[f.LINESTRING=1]="LINESTRING",f[f.POLYGON=2]="POLYGON",f[f.MULTIPOINT=3]="MULTIPOINT",f[f.MULTILINESTRING=4]="MULTILINESTRING",f[f.MULTIPOLYGON=5]="MULTIPOLYGON"})($s||($s={})),(function(f){f[f.POINT=0]="POINT",f[f.LINESTRING=1]="LINESTRING",f[f.POLYGON=2]="POLYGON"})(ml||(ml={})),(function(f){f[f.MORTON=0]="MORTON",f[f.VEC_2=1]="VEC_2",f[f.VEC_3=2]="VEC_3"})(qa||(qa={}));class wg{createPoint(a){return[[a]]}createMultiPoint(a){return a.map((h=>[h]))}createLineString(a){return[a]}createMultiLineString(a){return a}createPolygon(a,h){return[a].concat(h)}createMultiPolygon(a){return a.flat()}}function Wm(f){const a=new Array(f.numGeometries);let h=1,y=1,b=1,S=0;const E=new wg;let k=0,F=0;const V=f.mortonSettings,H=f.topologyVector,Y=H.geometryOffsets,K=H.partOffsets,te=H.ringOffsets,oe=f.vertexOffsets,le=f.containsPolygonGeometry(),ue=f.vertexBuffer;for(let xe=0;xe<f.numGeometries;xe++){const De=f.geometryType(xe);if(De===$s.POINT){if(oe&&oe.length!==0)if(f.vertexBufferType===qa.VEC_2){const we=2*oe[F++],Ee=new M(ue[we],ue[we+1]);a[S++]=E.createPoint(Ee)}else{const we=sp(ue[oe[F++]],V.numBits,V.coordinateShift),Ee=new M(we.x,we.y);a[S++]=E.createPoint(Ee)}else{const we=new M(ue[k++],ue[k++]);a[S++]=E.createPoint(we)}Y&&b++,K&&h++,te&&y++}else if(De===$s.MULTIPOINT){const we=Y[b]-Y[b-1];b++;const Ee=new Array(we);if(oe&&oe.length!==0){for(let Ne=0;Ne<we;Ne++){const Ze=2*oe[F++];Ee[Ne]=new M(ue[Ze],ue[Ze+1])}a[S++]=E.createMultiPoint(Ee)}else{for(let Ne=0;Ne<we;Ne++){const Ze=ue[k++],yt=ue[k++];Ee[Ne]=new M(Ze,yt)}a[S++]=E.createMultiPoint(Ee)}}else if(De===$s.LINESTRING){let we,Ee=0;le?(Ee=te[y]-te[y-1],y++):Ee=K[h]-K[h-1],h++,oe&&oe.length!==0?(we=f.vertexBufferType===qa.VEC_2?cp(ue,oe,F,Ee,!1):Xm(ue,oe,F,Ee,!1,V),F+=Ee):(we=Zm(ue,k,Ee,!1),k+=2*Ee),a[S++]=E.createLineString(we),Y&&b++}else if(De===$s.POLYGON){const we=K[h]-K[h-1];h++;const Ee=new Array(we-1);let Ne=te[y]-te[y-1];if(y++,oe&&oe.length!==0){const Ze=f.vertexBufferType===qa.VEC_2?op(ue,oe,F,Ne):lp(ue,oe,F,Ne,0,V);F+=Ne;for(let yt=0;yt<Ee.length;yt++)Ne=te[y]-te[y-1],y++,Ee[yt]=f.vertexBufferType===qa.VEC_2?op(ue,oe,F,Ne):lp(ue,oe,F,Ne,0,V),F+=Ne;a[S++]=E.createPolygon(Ze,Ee)}else{const Ze=ap(ue,k,Ne);k+=2*Ne;for(let yt=0;yt<Ee.length;yt++)Ne=te[y]-te[y-1],y++,Ee[yt]=ap(ue,k,Ne),k+=2*Ne;a[S++]=E.createPolygon(Ze,Ee)}Y&&b++}else if(De===$s.MULTILINESTRING){const we=Y[b]-Y[b-1];b++;const Ee=new Array(we);if(oe&&oe.length!==0){for(let Ne=0;Ne<we;Ne++){let Ze=0;le?(Ze=te[y]-te[y-1],y++):Ze=K[h]-K[h-1],h++;const yt=f.vertexBufferType===qa.VEC_2?cp(ue,oe,F,Ze,!1):Xm(ue,oe,F,Ze,!1,V);Ee[Ne]=yt,F+=Ze}a[S++]=E.createMultiLineString(Ee)}else{for(let Ne=0;Ne<we;Ne++){let Ze=0;le?(Ze=te[y]-te[y-1],y++):Ze=K[h]-K[h-1],h++,Ee[Ne]=Zm(ue,k,Ze,!1),k+=2*Ze}a[S++]=E.createMultiLineString(Ee)}}else{if(De!==$s.MULTIPOLYGON)throw new Error("The specified geometry type is currently not supported.");{const we=Y[b]-Y[b-1];b++;const Ee=new Array(we);let Ne=0;if(oe&&oe.length!==0){for(let Ze=0;Ze<we;Ze++){const yt=K[h]-K[h-1];h++;const Bt=new Array(yt-1);Ne=te[y]-te[y-1],y++;const Dt=f.vertexBufferType===qa.VEC_2?op(ue,oe,F,Ne):lp(ue,oe,F,Ne,0,V);F+=Ne;for(let jt=0;jt<Bt.length;jt++)Ne=te[y]-te[y-1],y++,Bt[jt]=f.vertexBufferType===qa.VEC_2?op(ue,oe,F,Ne):lp(ue,oe,F,Ne,0,V),F+=Ne;Ee[Ze]=E.createPolygon(Dt,Bt)}a[S++]=E.createMultiPolygon(Ee)}else{for(let Ze=0;Ze<we;Ze++){const yt=K[h]-K[h-1];h++;const Bt=new Array(yt-1);Ne=te[y]-te[y-1],y++;const Dt=ap(ue,k,Ne);k+=2*Ne;for(let jt=0;jt<Bt.length;jt++){const ai=te[y]-te[y-1];y++,Bt[jt]=ap(ue,k,ai),k+=2*ai}Ee[Ze]=E.createPolygon(Dt,Bt)}a[S++]=E.createMultiPolygon(Ee)}}}}return a}function ap(f,a,h){return Zm(f,a,h,!0)}function op(f,a,h,y){return cp(f,a,h,y,!0)}function lp(f,a,h,y,b,S){return Xm(f,a,h,y,!0,S)}function Zm(f,a,h,y){const b=new Array(y?h+1:h);for(let S=0;S<2*h;S+=2)b[S/2]=new M(f[a+S],f[a+S+1]);return y&&(b[b.length-1]=b[0]),b}function cp(f,a,h,y,b){const S=new Array(b?y+1:y);for(let E=0;E<2*y;E+=2){const k=2*a[h+E/2];S[E/2]=new M(f[k],f[k+1])}return b&&(S[S.length-1]=S[0]),S}function Xm(f,a,h,y,b,S){const E=new Array(b?y+1:y);for(let k=0;k<y;k++){const F=sp(f[a[h+k]],S.numBits,S.coordinateShift);E[k]=new M(F.x,F.y)}return b&&(E[E.length-1]=E[0]),E}class up{constructor(a,h,y,b,S){pe(this,"_vertexBufferType");pe(this,"_topologyVector");pe(this,"_vertexOffsets");pe(this,"_vertexBuffer");pe(this,"_mortonSettings");this._vertexBufferType=a,this._topologyVector=h,this._vertexOffsets=y,this._vertexBuffer=b,this._mortonSettings=S}get vertexBufferType(){return this._vertexBufferType}get topologyVector(){return this._topologyVector}get vertexOffsets(){return this._vertexOffsets}get vertexBuffer(){return this._vertexBuffer}*[Symbol.iterator](){const a=Wm(this);let h=0;for(;h<this.numGeometries;)yield{coordinates:a[h],type:this.geometryType(h)},h++}getSimpleEncodedVertex(a){const h=this.vertexOffsets?2*this.vertexOffsets[a]:2*a;return[this.vertexBuffer[h],this.vertexBuffer[h+1]]}getVertex(a){if(this.vertexOffsets&&this.mortonSettings){const y=sp(this.vertexBuffer[this.vertexOffsets[a]],this.mortonSettings.numBits,this.mortonSettings.coordinateShift);return[y.x,y.y]}const h=this.vertexOffsets?2*this.vertexOffsets[a]:2*a;return[this.vertexBuffer[h],this.vertexBuffer[h+1]]}getGeometries(){return Wm(this)}get mortonSettings(){return this._mortonSettings}}class hp extends up{constructor(h,y,b,S,E,k,F){super(b,S,E,k,F);pe(this,"_numGeometries");pe(this,"_geometryType");this._numGeometries=h,this._geometryType=y}geometryType(h){return this._geometryType}get numGeometries(){return this._numGeometries}containsPolygonGeometry(){return this._geometryType===$s.POLYGON||this._geometryType===$s.MULTIPOLYGON}containsSingleGeometryType(){return!0}}class fp extends up{constructor(h,y,b,S,E,k){super(h,b,S,E,k);pe(this,"_geometryTypes");this._geometryTypes=y}geometryType(h){return this._geometryTypes[h]}get numGeometries(){return this._geometryTypes.length}containsPolygonGeometry(){for(let h=0;h<this.numGeometries;h++)if(this.geometryType(h)===$s.POLYGON||this.geometryType(h)===$s.MULTIPOLYGON)return!0;return!1}containsSingleGeometryType(){return!1}}class ry{constructor(a,h,y,b){pe(this,"_triangleOffsets");pe(this,"_indexBuffer");pe(this,"_vertexBuffer");pe(this,"_topologyVector");this._triangleOffsets=a,this._indexBuffer=h,this._vertexBuffer=y,this._topologyVector=b}get triangleOffsets(){return this._triangleOffsets}get indexBuffer(){return this._indexBuffer}get vertexBuffer(){return this._vertexBuffer}get topologyVector(){return this._topologyVector}getGeometries(){if(!this._topologyVector)throw new Error("Cannot convert GpuVector to coordinates without topology information");const a=new Array(this.numGeometries),h=this._topologyVector,y=h.partOffsets,b=h.ringOffsets,S=h.geometryOffsets;let E=0,k=1,F=1,V=1;for(let H=0;H<this.numGeometries;H++)switch(this.geometryType(H)){case $s.POLYGON:{const Y=y[k]-y[k-1];k++;const K=[];for(let te=0;te<Y;te++){const oe=b[F]-b[F-1];F++;const le=[];for(let ue=0;ue<oe;ue++){const xe=this._vertexBuffer[E++],De=this._vertexBuffer[E++];le.push(new M(xe,De))}le.length>0&&le.push(le[0]),K.push(le)}a[H]=K,S&&V++}break;case $s.MULTIPOLYGON:{const Y=S[V]-S[V-1];V++;const K=[];for(let te=0;te<Y;te++){const oe=y[k]-y[k-1];k++;for(let le=0;le<oe;le++){const ue=b[F]-b[F-1];F++;const xe=[];for(let De=0;De<ue;De++){const we=this._vertexBuffer[E++],Ee=this._vertexBuffer[E++];xe.push(new M(we,Ee))}xe.length>0&&xe.push(xe[0]),K.push(xe)}}a[H]=K}}return a}[Symbol.iterator](){return null}}function qd(f,a,h,y,b,S){return new f2(f,a,h,y,b,S)}class f2 extends ry{constructor(h,y,b,S,E,k){super(b,S,E,k);pe(this,"_numGeometries");pe(this,"_geometryType");this._numGeometries=h,this._geometryType=y}geometryType(h){return this._geometryType}get numGeometries(){return this._numGeometries}containsSingleGeometryType(){return!0}}function Hm(f,a,h,y,b){return new sy(f,a,h,y,b)}class sy extends ry{constructor(h,y,b,S,E){super(y,b,S,E);pe(this,"_geometryTypes");this._geometryTypes=h}geometryType(h){return this._geometryTypes[h]}get numGeometries(){return this._geometryTypes.length}containsSingleGeometryType(){return!1}}function ay(f,a,h,y,b){const S=Ya(f,h);let E=null,k=null,F=null,V=null,H=null,Y=null,K=null,te=null;if(Yu(S,y,f,h)===Ms.CONST){const le=Lm(f,h,S,!1);for(let ue=0;ue<a-1;ue++){const xe=Ya(f,h);switch(xe.physicalStreamType){case ha.LENGTH:switch(xe.logicalStreamType.lengthType){case $a.GEOMETRIES:E=qu(f,h,xe);break;case $a.PARTS:k=qu(f,h,xe);break;case $a.RINGS:F=qu(f,h,xe);break;case $a.TRIANGLES:K=qu(f,h,xe)}break;case ha.OFFSET:switch(xe.logicalStreamType.offsetType){case Yh.VERTEX:V=Ja(f,h,xe,!1);break;case Yh.INDEX:te=Ja(f,h,xe,!1)}break;case ha.DATA:Rc.VERTEX===xe.logicalStreamType.dictionaryType?H=Ja(f,h,xe,!0):(Y={numBits:xe.numBits,coordinateShift:xe.coordinateShift},H=Ja(f,h,xe,!1))}}return te!==null?E!=null||k!=null?qd(y,le,K,te,H,new Ju(E,k,F)):qd(y,le,K,te,H):Y===null?(function(ue,xe,De,we,Ee){return new hp(ue,xe,qa.VEC_2,De,we,Ee)})(y,le,new Ju(E,k,F),V,H):(function(ue,xe,De,we,Ee,Ne){return new hp(ue,xe,qa.MORTON,De,we,Ee,Ne)})(y,le,new Ju(E,k,F),V,H,Y)}const oe=Ja(f,h,S,!1);for(let le=0;le<a-1;le++){const ue=Ya(f,h);switch(ue.physicalStreamType){case ha.LENGTH:switch(ue.logicalStreamType.lengthType){case $a.GEOMETRIES:E=Ja(f,h,ue,!1);break;case $a.PARTS:k=Ja(f,h,ue,!1);break;case $a.RINGS:F=Ja(f,h,ue,!1);break;case $a.TRIANGLES:K=qu(f,h,ue)}break;case ha.OFFSET:switch(ue.logicalStreamType.offsetType){case Yh.VERTEX:V=Ja(f,h,ue,!1);break;case Yh.INDEX:te=Ja(f,h,ue,!1)}break;case ha.DATA:Rc.VERTEX===ue.logicalStreamType.dictionaryType?H=Ja(f,h,ue,!0):(Y={numBits:ue.numBits,coordinateShift:ue.coordinateShift},H=Ja(f,h,ue,!1))}}return te!==null&&k===null?Hm(oe,K,te,H):(E!==null?(E=Tg(oe,E,2),k!==null&&F!==null?(k=Sg(oe,E,k,!1),F=(function(le,ue,xe,De){const we=new Int32Array(xe[xe.length-1]+1);let Ee=0;we[0]=Ee;let Ne=1,Ze=1,yt=0;for(let Bt=0;Bt<le.length;Bt++){const Dt=le[Bt],jt=ue[Bt+1]-ue[Bt];if(Dt!==0&&Dt!==3)for(let ai=0;ai<jt;ai++){const Qt=xe[Ne]-xe[Ne-1];Ne++;for(let Ot=0;Ot<Qt;Ot++)Ee=we[Ze++]=Ee+De[yt++]}else for(let ai=0;ai<jt;ai++)we[Ze++]=++Ee,Ne++}return we})(oe,E,k,F)):k!==null&&(k=(function(le,ue,xe){const De=new Int32Array(ue[ue.length-1]+1);let we=0;De[0]=we;let Ee=1,Ne=0;for(let Ze=0;Ze<le.length;Ze++){const yt=le[Ze],Bt=ue[Ze+1]-ue[Ze];if(yt===4||yt===1)for(let Dt=0;Dt<Bt;Dt++)we=De[Ee++]=we+xe[Ne++];else for(let Dt=0;Dt<Bt;Dt++)De[Ee++]=++we}return De})(oe,E,k))):k!==null&&F!==null?(k=Tg(oe,k,1),F=Sg(oe,k,F,!0)):k!==null&&(k=Tg(oe,k,0)),te!==null?Hm(oe,K,te,H,new Ju(E,k,F)):Y===null?(function(le,ue,xe,De){return new fp(qa.VEC_2,le,ue,xe,De)})(oe,new Ju(E,k,F),V,H):(function(le,ue,xe,De,we){return new fp(qa.MORTON,le,ue,xe,De,we)})(oe,new Ju(E,k,F),V,H,Y))}function Tg(f,a,h){const y=new Int32Array(f.length+1);let b=0;y[0]=b;let S=0;for(let E=0;E<f.length;E++)b=y[E+1]=b+(f[E]>h?a[S++]:1);return y}function Sg(f,a,h,y){const b=new Int32Array(a[a.length-1]+1);let S=0;b[0]=S;let E=1,k=0;for(let F=0;F<f.length;F++){const V=f[F],H=a[F+1]-a[F];if(V===5||V===2||y&&(V===4||V===1))for(let Y=0;Y<H;Y++)S=b[E++]=S+h[k++];else for(let Y=0;Y<H;Y++)b[E++]=++S}return b}class oy extends $h{constructor(h,y,b){super(h,y.getBuffer(),b);pe(this,"dataVector");this.dataVector=y}getValueFromBuffer(h){return this.dataVector.get(h)}}class ly extends Xu{getValueFromBuffer(a){return this.dataBuffer[a]}}class dp extends $h{constructor(a,h,y){super(a,BigInt64Array.of(h),y)}getValueFromBuffer(a){return this.dataBuffer[0]}}function Yd(f,a,h){return cy(f,Math.ceil(a/8),h)}function cy(f,a,h){const y=new Uint8Array(a);let b=0;for(;b<a;){const S=f[h.increment()];if(S<=127){const E=S+3,k=f[h.increment()],F=b+E;y.fill(k,b,F),b=F}else{const E=256-S;for(let k=0;k<E;k++)y[b++]=f[h.increment()]}}return y}const $m=new TextDecoder;function pp(f,a,h){return h-a>=12?$m.decode(f.subarray(a,h)):(function(y,b,S){let E="",k=b;for(;k<S;){const F=y[k];let V,H,Y,K=null,te=F>239?4:F>223?3:F>191?2:1;if(k+te>S)break;te===1?F<128&&(K=F):te===2?(V=y[k+1],(192&V)==128&&(K=(31&F)<<6|63&V,K<=127&&(K=null))):te===3?(V=y[k+1],H=y[k+2],(192&V)==128&&(192&H)==128&&(K=(15&F)<<12|(63&V)<<6|63&H,(K<=2047||K>=55296&&K<=57343)&&(K=null))):te===4&&(V=y[k+1],H=y[k+2],Y=y[k+3],(192&V)==128&&(192&H)==128&&(192&Y)==128&&(K=(15&F)<<18|(63&V)<<12|(63&H)<<6|63&Y,(K<=65535||K>=1114112)&&(K=null))),K===null?(K=65533,te=1):K>65535&&(K-=65536,E+=String.fromCharCode(K>>>10&1023|55296),K=56320|1023&K),E+=String.fromCharCode(K),k+=te}return E})(f,a,h)}class Jd extends $h{constructor(h,y,b,S){super(h,b,S);pe(this,"offsetBuffer");this.offsetBuffer=y}}class Eg extends Jd{constructor(h,y,b,S){super(h,y,b,S??y.length-1);pe(this,"textEncoder");this.textEncoder=new TextEncoder}getValueFromBuffer(h){return pp(this.dataBuffer,this.offsetBuffer[h],this.offsetBuffer[h+1])}}class Gf extends Jd{constructor(h,y,b,S,E){super(h,b,S,E??y.length);pe(this,"indexBuffer");pe(this,"textEncoder");this.indexBuffer=y,this.indexBuffer=y,this.textEncoder=new TextEncoder}getValueFromBuffer(h){const y=this.indexBuffer[h];return pp(this.dataBuffer,this.offsetBuffer[y],this.offsetBuffer[y+1])}}class Mg extends Jd{constructor(h,y,b,S,E,k,F){super(h,b,S,F);pe(this,"indexBuffer");pe(this,"symbolOffsetBuffer");pe(this,"symbolTableBuffer");pe(this,"textEncoder");pe(this,"symbolLengthBuffer");pe(this,"lengthBuffer");pe(this,"decodedDictionary");this.indexBuffer=y,this.symbolOffsetBuffer=E,this.symbolTableBuffer=k,this.textEncoder=new TextEncoder}getValueFromBuffer(h){this.decodedDictionary==null&&(this.symbolLengthBuffer==null&&(this.symbolLengthBuffer=this.offsetToLengthBuffer(this.symbolOffsetBuffer),this.lengthBuffer=this.offsetToLengthBuffer(this.offsetBuffer)),this.decodedDictionary=(function(b,S,E){const k=[],F=new Array(S.length).fill(0);for(let V=1;V<S.length;V++)F[V]=F[V-1]+S[V-1];for(let V=0;V<E.length;V++)if(E[V]===255)k.push(E[++V]);else{const H=S[E[V]],Y=F[E[V]];for(let K=0;K<H;K++)k.push(b[Y+K])}return new Uint8Array(k)})(this.symbolTableBuffer,this.symbolLengthBuffer,this.dataBuffer));const y=this.indexBuffer[h];return pp(this.decodedDictionary,this.offsetBuffer[y],this.offsetBuffer[y+1])}offsetToLengthBuffer(h){const y=new Uint32Array(h.length-1);let b=h[0];for(let S=1;S<h.length;S++){const E=h[S];y[S-1]=E-b,b=E}return y}}function Qh(f,a,h,y,b,S){return h.type==="scalarType"?(function(E,k,F,V,H,Y){let K=null,te=0;if(E===0)return null;if(Y.nullable){const le=Ya(k,F);te=le.numValues;const ue=F.get(),xe=Yd(k,te,F);F.set(ue+le.byteLength),K=new Cc(xe,le.numValues)}const oe=K??V;switch(H.physicalType){case 4:case 3:return(function(le,ue,xe,De,we){const Ee=Ya(le,ue),Ne=Yu(Ee,we,le,ue),Ze=De.physicalType===3;if(Ne===Ms.FLAT){const yt=ql(we)?jm(le,ue,Ee,Ze,we):Ja(le,ue,Ee,Ze);return new Hu(xe.name,yt,we)}if(Ne===Ms.SEQUENCE){const yt=Um(le,ue,Ee);return new Nm(xe.name,yt[0],yt[1],Ee.numRleValues)}{const yt=Lm(le,ue,Ee,Ze);return new np(xe.name,yt,we)}})(k,F,Y,H,oe);case 9:return(function(le,ue,xe,De,we){let Ee=null,Ne=null,Ze=null,yt=null,Bt=null,Dt=null,jt=null,ai=null;for(let Qt=0;Qt<De;Qt++){const Ot=Ya(ue,xe);if(Ot.byteLength!==0)switch(Ot.physicalStreamType){case ha.PRESENT:{const Ct=Yd(ue,Ot.numValues,xe);Dt=new Cc(Ct,Ot.numValues);break}case ha.OFFSET:Ne=we!=null||Dt!=null?jm(ue,xe,Ot,!1,we??Dt):Ja(ue,xe,Ot,!1);break;case ha.LENGTH:{const Ct=qu(ue,xe,Ot);$a.DICTIONARY===Ot.logicalStreamType.lengthType?Ee=Ct:$a.SYMBOL===Ot.logicalStreamType.lengthType?yt=Ct:jt=Ct;break}case ha.DATA:{const Ct=ue.subarray(xe.get(),xe.get()+Ot.byteLength);xe.add(Ot.byteLength);const _i=Ot.logicalStreamType.dictionaryType;Rc.FSST===_i?Bt=Ct:Rc.SINGLE===_i||Rc.SHARED===_i?Ze=Ct:Rc.NONE===_i&&(ai=Ct);break}}}return(function(Qt,Ot,Ct,_i,pi,Ti,gi){return Ot?new Mg(Qt,Ct,_i,pi,Ti,Ot,gi):null})(le,Bt,Ne,Ee,Ze,yt,we??Dt)??(function(Qt,Ot,Ct,_i,pi){return Ot?pi?new Gf(Qt,Ct,_i,Ot,pi):new Gf(Qt,Ct,_i,Ot):null})(le,Ze,Ne,Ee,we??Dt)??(function(Qt,Ot,Ct,_i,pi){if(!Ot||!Ct)return null;if(_i)return pi?new Gf(Qt,_i,Ot,Ct,pi):new Gf(Qt,_i,Ot,Ct);if(pi&&pi.size()!==Ot.length-1){const Ti=new Int32Array(pi.size());let gi=0;for(let Bi=0;Bi<pi.size();Bi++)Ti[Bi]=pi.get(Bi)?gi++:0;return new Gf(Qt,Ti,Ot,Ct,pi)}return pi?new Eg(Qt,Ot,Ct,pi):new Eg(Qt,Ot,Ct)})(le,jt,ai,Ne,we??Dt)})(Y.name,k,F,Y.nullable?E-1:E,K);case 0:return(function(le,ue,xe,De,we){const Ee=Ya(le,ue),Ne=Ee.numValues,Ze=ue.get(),yt=ql(we)?(function(Dt,jt,ai,Qt){const Ot=cy(Dt,Math.ceil(jt/8),ai),Ct=new Cc(Ot,jt),_i=Qt.size(),pi=new Cc(new Uint8Array(_i),_i);let Ti=0;for(let gi=0;gi<Qt.size();gi++){const Bi=!!Qt.get(gi)&&Ct.get(Ti++);pi.set(gi,Bi)}return pi.getBuffer()})(le,Ne,ue,we):Yd(le,Ne,ue);ue.set(Ze+Ee.byteLength);const Bt=new Cc(yt,Ne);return new oy(xe.name,Bt,we)})(k,F,Y,0,oe);case 6:case 5:return(function(le,ue,xe,De,we){const Ee=Ya(le,ue),Ne=Yu(Ee,De,le,ue),Ze=we.physicalType===5;if(Ne===Ms.FLAT){const yt=ql(De)?(function(Bt,Dt,jt,ai,Qt){return(function(Ot,Ct,_i,pi){switch(Ct.logicalLevelTechnique1){case on.DELTA:return Ct.logicalLevelTechnique2===on.RLE&&(Ot=iy(Ot,Ct.runs,Ct.numRleValues)),(function(Ti,gi){const Bi=new BigInt64Array(Ti.size());let Nn=0;Ti.get(0)?(Bi[0]=Ti.get(0)?gi[0]>>1n^-(1n&gi[0]):0n,Nn=1):Bi[0]=0n;let _n=1;for(;_n!=Bi.length;++_n)Bi[_n]=Ti.get(_n)?Bi[_n-1]+(gi[Nn]>>1n^-(1n&gi[Nn++])):Bi[_n-1];return Bi})(pi,Ot);case on.RLE:return(function(Ti,gi,Bi,Nn){const _n=gi;return Bi?(function(qr,Qa,Ys){const Yr=new BigInt64Array(qr.size());let Ur=0;for(let Hn=0;Hn<Ys;Hn++){const _s=Number(Qa[Hn]);let Rs=Qa[Hn+Ys];Rs=Rs>>1n^-(1n&Rs);for(let Cr=Ur;Cr<Ur+_s;Cr++)qr.get(Cr)?Yr[Cr]=Rs:(Yr[Cr]=0n,Ur++);Ur+=_s}return Yr})(Nn,Ti,_n.runs):(function(qr,Qa,Ys){const Yr=new BigInt64Array(qr.size());let Ur=0;for(let Hn=0;Hn<Ys;Hn++){const _s=Number(Qa[Hn]),Rs=Qa[Hn+Ys];for(let Cr=Ur;Cr<Ur+_s;Cr++)qr.get(Cr)?Yr[Cr]=Rs:(Yr[Cr]=0n,Ur++);Ur+=_s}return Yr})(Nn,Ti,_n.runs)})(Ot,Ct,_i,pi);case on.NONE:return Ot=_i?(function(Ti,gi){const Bi=new BigInt64Array(Ti.size());let Nn=0,_n=0;for(;_n!=Bi.length;++_n)if(Ti.get(_n)){const qr=gi[Nn++];Bi[_n]=qr>>1n^-(1n&qr)}else Bi[_n]=0n;return Bi})(pi,Ot):(function(Ti,gi){const Bi=new BigInt64Array(Ti.size());let Nn=0,_n=0;for(;_n!=Bi.length;++_n)Bi[_n]=Ti.get(_n)?gi[Nn++]:0n;return Bi})(pi,Ot),Ot;default:throw new Error("The specified Logical level technique is not supported")}})(rp(Bt,Dt,jt.numValues),jt,ai,Qt)})(le,ue,Ee,Ze,De):Hd(le,ue,Ee,Ze);return new $d(xe.name,yt,De)}if(Ne===Ms.SEQUENCE){const yt=jf(le,ue,Ee);return new Gm(xe.name,yt[0],yt[1],Ee.numRleValues)}{const yt=Vm(le,ue,Ee,Ze);return new dp(xe.name,yt,De)}})(k,F,Y,oe,H);case 7:return(function(le,ue,xe,De){const we=Ya(le,ue),Ee=ql(De)?(function(Ne,Ze,yt,Bt){const Dt=Ze.get(),jt=Dt+Bt*Float32Array.BYTES_PER_ELEMENT,ai=new Uint8Array(Ne.subarray(Dt,jt)).buffer,Qt=new Float32Array(ai);Ze.set(jt);const Ot=yt.size(),Ct=new Float32Array(Ot);let _i=0;for(let pi=0;pi<Ot;pi++)Ct[pi]=yt.get(pi)?Qt[_i++]:0;return Ct})(le,ue,De,we.numValues):(function(Ne,Ze,yt){const Bt=Ze.get(),Dt=Bt+yt*Float32Array.BYTES_PER_ELEMENT,jt=new Uint8Array(Ne.subarray(Bt,Dt)).buffer,ai=new Float32Array(jt);return Ze.set(Dt),ai})(le,ue,we.numValues);return new ly(xe.name,Ee,De)})(k,F,Y,oe);case 8:return(function(le,ue,xe,De){const we=Ya(le,ue),Ee=ql(De)?(function(Ne,Ze,yt,Bt){const Dt=Ze.get(),jt=Dt+Bt*Float64Array.BYTES_PER_ELEMENT,ai=new Uint8Array(Ne.subarray(Dt,jt)).buffer,Qt=new Float64Array(ai);Ze.set(jt);const Ot=yt.size(),Ct=new Float64Array(Ot);let _i=0;for(let pi=0;pi<Ot;pi++)Ct[pi]=yt.get(pi)?Qt[_i++]:0;return Ct})(le,ue,De,we.numValues):(function(Ne,Ze,yt){const Bt=Ze.get(),Dt=Bt+yt*Float64Array.BYTES_PER_ELEMENT,jt=new Uint8Array(Ne.subarray(Bt,Dt)).buffer,ai=new Float64Array(jt);return Ze.set(Dt),ai})(le,ue,we.numValues);return new qh(xe.name,Ee,De)})(k,F,Y,oe);default:throw new Error(`The specified data type for the field is currently not supported: ${H}`)}})(y,f,a,b,h.scalarType,h):y!=1?null:(function(E,k,F,V){let H=null,Y=null,K=null,te=null,oe=!1;for(;!oe;){const De=Ya(E,k);switch(De.physicalStreamType){case ha.LENGTH:$a.DICTIONARY===De.logicalStreamType.lengthType?H=qu(E,k,De):K=qu(E,k,De);break;case ha.DATA:Rc.SINGLE===De.logicalStreamType.dictionaryType||Rc.SHARED===De.logicalStreamType.dictionaryType?(Y=E.subarray(k.get(),k.get()+De.byteLength),oe=!0):te=E.subarray(k.get(),k.get()+De.byteLength),k.add(De.byteLength)}}const le=F.complexType.children,ue=[];let xe=0;for(const De of le){const we=qs(E,k,1)[0];if(we==0)continue;const Ee=`${F.name}${De.name==="default"?"":":"+De.name}`;if(we!==2||De.type!=="scalarField"||De.scalarField.physicalType!==9)throw new Error("Currently only optional string fields are implemented for a struct.");const Ne=Ya(E,k),Ze=Yd(E,Ne.numValues,k),yt=Ya(E,k),Bt=yt.decompressedCount!==V?jm(E,k,yt,!1,new Cc(Ze,Ne.numValues)):Ja(E,k,yt,!1);ue[xe++]=te?new Mg(Ee,Bt,H,Y,K,te,new Cc(Ze,Ne.numValues)):new Gf(Ee,Bt,H,Y,new Cc(Ze,Ne.numValues))}return ue})(f,a,h,b)}function ql(f){return f instanceof Cc}function Kh(f){if(f.name==="id")return!1;if(f.type==="scalarType"){const a=f.scalarType;if(a.type==="physicalType")switch(a.physicalType){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:default:return!1;case 9:return!0}else if(a.type==="logicalType")return!1}else if(f.type==="complexType"){const a=f.complexType;if(a.type==="physicalType")switch(a.physicalType){case 0:case 1:return!0;default:return!1}}return console.warn("Unexpected column type in hasStreamCount",f),!1}const gp=new TextDecoder;function Qd(f,a){const h=qs(f,a,1)[0];if(h===0)return"";const y=a.get(),b=f.subarray(y,y+h);return a.add(h),gp.decode(b)}function Qu(f,a){const h=qs(f,a,1)[0]>>>0,y=!!(4&h),b=!!(2&h),S=qs(f,a,1)[0]>>>0,E={};if(1&h&&(E.nullable=!0),b){const k={};if(y?(k.type="logicalType",k.logicalType=S):(k.type="physicalType",k.physicalType=S),8&h){const F=qs(f,a,1)[0]>>>0;k.children=new Array(F);for(let V=0;V<F;V++)k.children[V]=Qu(f,a)}E.type="complexField",E.complexField=k}else{const k={};y?(k.type="logicalType",k.logicalType=S):(k.type="physicalType",k.physicalType=S),E.type="scalarField",E.scalarField=k}return E}function d2(f,a){const h=qs(f,a,1)[0]>>>0,y=(function(b){switch(b){case 0:case 1:case 2:case 3:{const S={};S.nullable=!!(1&b),S.columnScope=0;const E={};return E.physicalType=b>1?6:4,E.type="physicalType",S.scalarType=E,S.type="scalarType",S}case 4:{const S={nullable:!1,columnScope:0},E={type:"physicalType",physicalType:0};return S.type="complexType",S.complexType=E,S}case 30:{const S={nullable:!1,columnScope:0},E={type:"physicalType",physicalType:1};return S.type="complexType",S.complexType=E,S}default:return(function(S){let E=null;switch(S){case 10:case 11:E=0;break;case 12:case 13:E=1;break;case 14:case 15:E=2;break;case 16:case 17:E=3;break;case 18:case 19:E=4;break;case 20:case 21:E=5;break;case 22:case 23:E=6;break;case 24:case 25:E=7;break;case 26:case 27:E=8;break;case 28:case 29:E=9;break;default:return null}const k={};k.nullable=!!(1&S),k.columnScope=0;const F={type:"physicalType"};return F.physicalType=E,k.type="scalarType",k.scalarType=F,k})(b)}})(h);if(!y)throw new Error(`Unsupported column type code: ${h}`);if((function(b){return b>=10})(h)?y.name=Qd(f,a):h>=0&&h<=3?y.name="id":h===4&&(y.name="geometry"),(function(b){return b===30})(h)){const b=qs(f,a,1)[0]>>>0,S=y.complexType;S.children=new Array(b);for(let E=0;E<b;E++)S.children[E]=Qu(f,a)}return y}function qm(f,a){const h={featureTables:[]},y={};y.name=Qd(f,a);const b=qs(f,a,1)[0]>>>0,S=qs(f,a,1)[0]>>>0;y.columns=new Array(S);for(let E=0;E<S;E++)y.columns[E]=d2(f,a);return h.featureTables.push(y),[h,b]}function mp(f,a,h,y,b,S,E=!1){const k=a.scalarType.physicalType,F=Yu(b,S,f,h);if(k===4)switch(F){case Ms.FLAT:{const V=Ja(f,h,b,!1);return new Hu(y,V,S)}case Ms.SEQUENCE:{const V=Um(f,h,b);return new Nm(y,V[0],V[1],b.numRleValues)}case Ms.CONST:{const V=Lm(f,h,b,!1);return new np(y,V,S)}}else switch(F){case Ms.FLAT:{if(E){const H=(function(Y,K,te,oe){const le=(function(ue,xe,De){const we=new Float64Array(xe);for(let Ee=0;Ee<xe;Ee++)we[Ee]=ty(ue,De);return we})(Y,te.numValues,K);return(function(ue,xe,De){switch(xe.logicalLevelTechnique1){case on.DELTA:return xe.logicalLevelTechnique2===on.RLE&&(ue=ny(ue,xe.runs,xe.numRleValues)),(function(we){we[0]=we[0]%2==1?(we[0]+1)/-2:we[0]/2;const Ee=we.length/4*4;let Ne=1;if(Ee>=4)for(;Ne<Ee-4;Ne+=4){const Ze=we[Ne],yt=we[Ne+1],Bt=we[Ne+2],Dt=we[Ne+3];we[Ne]=(Ze%2==1?(Ze+1)/-2:Ze/2)+we[Ne-1],we[Ne+1]=(yt%2==1?(yt+1)/-2:yt/2)+we[Ne],we[Ne+2]=(Bt%2==1?(Bt+1)/-2:Bt/2)+we[Ne+1],we[Ne+3]=(Dt%2==1?(Dt+1)/-2:Dt/2)+we[Ne+2]}for(;Ne!=we.length;++Ne)we[Ne]=(we[Ne]%2==1?(we[Ne]+1)/-2:we[Ne]/2)+we[Ne-1]})(ue),ue;case on.RLE:return(function(we,Ee,Ne){return ny(we,Ee.runs,Ee.numRleValues)})(ue,xe);case on.NONE:return ue;default:throw new Error(`The specified Logical level technique is not supported: ${xe.logicalLevelTechnique1}`)}})(le,te)})(f,h,b);return new qh(y,H,S)}const V=Hd(f,h,b,!1);return new $d(y,V,S)}case Ms.SEQUENCE:{const V=jf(f,h,b);return new Gm(y,V[0],V[1],b.numRleValues)}case Ms.CONST:{const V=Vm(f,h,b,!1);return new dp(y,V,S)}}throw new Error("Vector type not supported for id column.")}class p2{constructor(a,h){var y;switch(this._featureData=a,this.properties=this._featureData.properties||{},(y=this._featureData.geometry)===null||y===void 0?void 0:y.type){case $s.POINT:case $s.MULTIPOINT:this.type=1;break;case $s.LINESTRING:case $s.MULTILINESTRING:this.type=2;break;case $s.POLYGON:case $s.MULTIPOLYGON:this.type=3;break;default:this.type=0}this.extent=h,this.id=Number(this._featureData.id)}loadGeometry(){const a=[];for(const h of this._featureData.geometry.coordinates){const y=[];for(const b of h)y.push(new M(b.x,b.y));a.push(y)}return a}}class uy{constructor(a){this.features=[],this.featureTable=a,this.name=a.name,this.extent=a.extent,this.version=2,this.features=a.getFeatures(),this.length=this.features.length}feature(a){return new p2(this.features[a],this.extent)}}class _p{constructor(a){this.layers={};const h=(function(y,b,S=!0){const E=new ey(0),k=[];for(;E.get()<y.length;){const F=qs(y,E,1)[0]>>>0,V=E.get()+F;if(V>y.length)throw new Error(`Block overruns tile: ${V} > ${y.length}`);if(qs(y,E,1)[0]>>>0!=1){E.set(V);continue}const H=qm(y,E),Y=H[1],K=H[0].featureTables[0];let te=null,oe=null;const le=[];let ue=0;for(const De of K.columns){const we=De.name;if(we==="id"){let Ee=null;if(De.nullable){const Ze=Ya(y,E),yt=E.get(),Bt=Yd(y,Ze.numValues,E);E.set(yt+Ze.byteLength),Ee=new Cc(Bt,Ze.numValues)}const Ne=Ya(y,E);ue=Ne.decompressedCount,te=mp(y,De,E,we,Ne,Ee??ue,S)}else if(we==="geometry"){const Ee=qs(y,E,1)[0];if(ue===0){const Ne=E.get();ue=Ya(y,E).decompressedCount,E.set(Ne)}oe=ay(y,Ee,E,ue)}else{const Ee=Kh(De)?qs(y,E,1)[0]:1;if(Ee===0&&De.type==="scalarType")continue;const Ne=Qh(y,E,De,Ee,ue);if(Ne)if(Array.isArray(Ne))for(const Ze of Ne)le.push(Ze);else le.push(Ne)}}const xe=new $u(K.name,oe,te,le,Y);k.push(xe),E.set(V)}return k})(new Uint8Array(a));this.layers=h.reduce(((y,b)=>Object.assign(Object.assign({},y),{[b.name]:new uy(b)})),{})}}class hy{constructor(a,h){this.feature=a,this.type=a.type,this.properties=a.tags?a.tags:{},this.extent=h,"id"in a&&(typeof a.id=="string"?this.id=parseInt(a.id,10):typeof a.id!="number"||isNaN(a.id)||(this.id=a.id))}loadGeometry(){const a=[],h=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const y of h){const b=[];for(const S of y)b.push(new M(S[0],S[1]));a.push(b)}return a}}const yp="_geojsonTileLayer";function Rg(f,a){a.writeVarintField(15,f.version||1),a.writeStringField(1,f.name||""),a.writeVarintField(5,f.extent||4096);const h={keys:[],values:[],keycache:{},valuecache:{}};for(let S=0;S<f.length;S++)h.feature=f.feature(S),a.writeMessage(2,Cg,h);const y=h.keys;for(const S of y)a.writeStringField(3,S);const b=h.values;for(const S of b)a.writeMessage(4,Pg,S)}function Cg(f,a){if(!f.feature)return;const h=f.feature;h.id!==void 0&&a.writeVarintField(1,h.id),a.writeMessage(2,fy,f),a.writeVarintField(3,h.type),a.writeMessage(4,dy,h)}function fy(f,a){var h;for(const y in(h=f.feature)==null?void 0:h.properties){let b=f.feature.properties[y],S=f.keycache[y];if(b==null)continue;S===void 0&&(f.keys.push(y),S=f.keys.length-1,f.keycache[y]=S),a.writeVarint(S),typeof b!="string"&&typeof b!="boolean"&&typeof b!="number"&&(b=JSON.stringify(b));const E=typeof b+":"+b;let k=f.valuecache[E];k===void 0&&(f.values.push(b),k=f.values.length-1,f.valuecache[E]=k),a.writeVarint(k)}}function ef(f,a){return(a<<3)+(7&f)}function Ym(f){return f<<1^f>>31}function dy(f,a){const h=f.loadGeometry(),y=f.type;let b=0,S=0;for(const E of h){let k=1;y===1&&(k=E.length),a.writeVarint(ef(1,k));const F=y===3?E.length-1:E.length;for(let V=0;V<F;V++){V===1&&y!==1&&a.writeVarint(ef(2,F-1));const H=E[V].x-b,Y=E[V].y-S;a.writeVarint(Ym(H)),a.writeVarint(Ym(Y)),b+=H,S+=Y}f.type===3&&a.writeVarint(ef(7,1))}}function Pg(f,a){const h=typeof f;h==="string"?a.writeStringField(1,f):h==="boolean"?a.writeBooleanField(7,f):h==="number"&&(f%1!=0?a.writeDoubleField(3,f):f<0?a.writeSVarintField(6,f):a.writeVarintField(5,f))}class Jm{constructor(a,h){this.tileID=a,this.x=a.canonical.x,this.y=a.canonical.y,this.z=a.canonical.z,this.grid=new gc(li,16,0),this.grid3D=new gc(li,16,0),this.featureIndexArray=new _e,this.promoteId=h}insert(a,h,y,b,S,E){const k=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(y,b,S);const F=E?this.grid3D:this.grid;for(let V=0;V<h.length;V++){const H=h[V],Y=[1/0,1/0,-1/0,-1/0];for(let K=0;K<H.length;K++){const te=H[K];Y[0]=Math.min(Y[0],te.x),Y[1]=Math.min(Y[1],te.y),Y[2]=Math.max(Y[2],te.x),Y[3]=Math.max(Y[3],te.y)}Y[0]<li&&Y[1]<li&&Y[2]>=0&&Y[3]>=0&&F.insert(k,Y[0],Y[1],Y[2],Y[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=this.encoding!=="mlt"?new hn(new ag(this.rawTileData)).layers:new _p(this.rawTileData).layers,this.sourceLayerCoder=new Om(this.vtLayers?Object.keys(this.vtLayers).sort():[yp])),this.vtLayers}query(a,h,y,b){this.loadVTLayers();const S=a.params,E=li/a.tileSize/a.scale,k=Ua(S.filter,S.globalState),F=a.queryGeometry,V=a.queryPadding*E,H=Hh.fromPoints(F),Y=this.grid.query(H.minX-V,H.minY-V,H.maxX+V,H.maxY+V),K=Hh.fromPoints(a.cameraQueryGeometry).expandBy(V),te=this.grid3D.query(K.minX,K.minY,K.maxX,K.maxY,((ue,xe,De,we)=>(function(Ee,Ne,Ze,yt,Bt){for(const jt of Ee)if(Ne<=jt.x&&Ze<=jt.y&&yt>=jt.x&&Bt>=jt.y)return!0;const Dt=[new M(Ne,Ze),new M(Ne,Bt),new M(yt,Bt),new M(yt,Ze)];if(Ee.length>2){for(const jt of Dt)if(Zl(Ee,jt))return!0}for(let jt=0;jt<Ee.length-1;jt++)if(k_(Ee[jt],Ee[jt+1],Dt))return!0;return!1})(a.cameraQueryGeometry,ue-V,xe-V,De+V,we+V)));for(const ue of te)Y.push(ue);Y.sort(Ig);const oe={};let le;for(let ue=0;ue<Y.length;ue++){const xe=Y[ue];if(xe===le)continue;le=xe;const De=this.featureIndexArray.get(xe);let we=null;this.loadMatchingFeature(oe,De.bucketIndex,De.sourceLayerIndex,De.featureIndex,k,S.layers,S.availableImages,h,y,b,((Ee,Ne,Ze)=>(we||(we=Ss(Ee)),Ne.queryIntersectsFeature({queryGeometry:F,feature:Ee,featureState:Ze,geometry:we,zoom:this.z,transform:a.transform,pixelsToTileUnits:E,pixelPosMatrix:a.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:a.getElevation}))))}return oe}loadMatchingFeature(a,h,y,b,S,E,k,F,V,H,Y){const K=this.bucketLayerIDs[h];if(E&&!K.some((ue=>E.has(ue))))return;const te=this.sourceLayerCoder.decode(y),oe=this.vtLayers[te].feature(b);if(S.needGeometry){const ue=as(oe,!0);if(!S.filter(new Un(this.tileID.overscaledZ),ue,this.tileID.canonical))return}else if(!S.filter(new Un(this.tileID.overscaledZ),oe))return;const le=this.getId(oe,te);for(let ue=0;ue<K.length;ue++){const xe=K[ue];if(E&&!E.has(xe))continue;const De=F[xe];if(!De)continue;let we={};le&&H&&(we=H.getState(De.sourceLayer||yp,le));const Ee=Kn({},V[xe]);Ee.paint=py(Ee.paint,De.paint,oe,we,k),Ee.layout=py(Ee.layout,De.layout,oe,we,k);const Ne=!Y||Y(oe,De,we);if(!Ne)continue;const Ze=new vg(oe,this.z,this.x,this.y,le);Ze.layer=Ee;let yt=a[xe];yt===void 0&&(yt=a[xe]=[]),yt.push({featureIndex:b,feature:Ze,intersectionZ:Ne})}}lookupSymbolFeatures(a,h,y,b,S,E,k,F){const V={};this.loadVTLayers();const H=Ua(S.filterSpec,S.globalState);for(const Y of a)this.loadMatchingFeature(V,y,b,Y,H,E,k,F,h);return V}hasLayer(a){for(const h of this.bucketLayerIDs)for(const y of h)if(a===y)return!0;return!1}getId(a,h){var y;let b=a.id;return this.promoteId&&(b=a.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[h]],typeof b=="boolean"&&(b=Number(b)),b===void 0&&(!((y=a.properties)===null||y===void 0)&&y.cluster)&&this.promoteId&&(b=Number(a.properties.cluster_id))),b}}function py(f,a,h,y,b){return Co(f,((S,E)=>{const k=a instanceof Ou?a.get(E):null;return k&&k.evaluate?k.evaluate(h,y,b):k}))}function Ig(f,a){return a-f}function d(f,a,h,y,b){const S=[];for(let E=0;E<f.length;E++){const k=f[E];let F;for(let V=0;V<k.length-1;V++){let H=k[V],Y=k[V+1];H.x<a&&Y.x<a||(H.x<a?H=new M(a,H.y+(a-H.x)/(Y.x-H.x)*(Y.y-H.y))._round():Y.x<a&&(Y=new M(a,H.y+(a-H.x)/(Y.x-H.x)*(Y.y-H.y))._round()),H.y<h&&Y.y<h||(H.y<h?H=new M(H.x+(h-H.y)/(Y.y-H.y)*(Y.x-H.x),h)._round():Y.y<h&&(Y=new M(H.x+(h-H.y)/(Y.y-H.y)*(Y.x-H.x),h)._round()),H.x>=y&&Y.x>=y||(H.x>=y?H=new M(y,H.y+(y-H.x)/(Y.x-H.x)*(Y.y-H.y))._round():Y.x>=y&&(Y=new M(y,H.y+(y-H.x)/(Y.x-H.x)*(Y.y-H.y))._round()),H.y>=b&&Y.y>=b||(H.y>=b?H=new M(H.x+(b-H.y)/(Y.y-H.y)*(Y.x-H.x),b)._round():Y.y>=b&&(Y=new M(H.x+(b-H.y)/(Y.y-H.y)*(Y.x-H.x),b)._round()),F&&H.equals(F[F.length-1])||(F=[H],S.push(F)),F.push(Y)))))}}return S}function m(f,a,h,y,b){switch(a){case 1:return(function(S,E,k,F){const V=[];for(const H of S)for(const Y of H){const K=F===0?Y.x:Y.y;K>=E&&K<=k&&V.push([Y])}return V})(f,h,y,b);case 2:return P(f,h,y,b,!1);case 3:return P(f,h,y,b,!0)}return[]}function A(f,a,h,y,b){const S=y===0?L:X;let E=[];const k=[];for(let H=0;H<f.length-1;H++){const Y=f[H],K=f[H+1],te=y===0?Y.x:Y.y,oe=y===0?K.x:K.y;let le=!1;te<a?oe>a&&E.push(S(Y,K,a)):te>h?oe<h&&E.push(S(Y,K,h)):E.push(Y),oe<a&&te>=a&&(E.push(S(Y,K,a)),le=!0),oe>h&&te<=h&&(E.push(S(Y,K,h)),le=!0),!b&&le&&(k.push(E),E=[])}const F=f.length-1,V=y===0?f[F].x:f[F].y;return V>=a&&V<=h&&E.push(f[F]),b&&E.length>0&&!E[0].equals(E[E.length-1])&&E.push(new M(E[0].x,E[0].y)),E.length>0&&k.push(E),k}function P(f,a,h,y,b){const S=[];for(const E of f){const k=A(E,a,h,y,b);k.length>0&&S.push(...k)}return S}function L(f,a,h){return new M(h,f.y+(h-f.x)/(a.x-f.x)*(a.y-f.y))}function X(f,a,h){return new M(f.x+(h-f.y)/(a.y-f.y)*(a.x-f.x),h)}yi("FeatureIndex",Jm,{omit:["rawTileData","sourceLayerCoder"]});class ae extends M{constructor(a,h,y,b){super(a,h),this.angle=y,b!==void 0&&(this.segment=b)}clone(){return new ae(this.x,this.y,this.angle,this.segment)}}function Te(f,a,h,y,b){if(a.segment===void 0||h===0)return!0;let S=a,E=a.segment+1,k=0;for(;k>-h/2;){if(E--,E<0)return!1;k-=f[E].dist(S),S=f[E]}k+=f[E].dist(f[E+1]),E++;const F=[];let V=0;for(;k<h/2;){const H=f[E],Y=f[E+1];if(!Y)return!1;let K=f[E-1].angleTo(H)-H.angleTo(Y);for(K=Math.abs((K+3*Math.PI)%(2*Math.PI)-Math.PI),F.push({distance:k,angleDelta:K}),V+=K;k-F[0].distance>y;)V-=F.shift().angleDelta;if(V>b)return!1;E++,k+=H.dist(Y)}return!0}function qe(f){let a=0;for(let h=0;h<f.length-1;h++)a+=f[h].dist(f[h+1]);return a}function wt(f,a,h){return f?.6*a*h:0}function Lt(f,a){return Math.max(f?f.right-f.left:0,a?a.right-a.left:0)}function $t(f,a,h,y,b,S){const E=wt(h,b,S),k=Lt(h,y)*S;let F=0;const V=qe(f)/2;for(let H=0;H<f.length-1;H++){const Y=f[H],K=f[H+1],te=Y.dist(K);if(F+te>V){const oe=(V-F)/te,le=Sr.number(Y.x,K.x,oe),ue=Sr.number(Y.y,K.y,oe),xe=new ae(le,ue,K.angleTo(Y),H);return xe._round(),!E||Te(f,xe,k,E,a)?xe:void 0}F+=te}}function It(f,a,h,y,b,S,E,k,F){const V=wt(y,S,E),H=Lt(y,b),Y=H*E,K=f[0].x===0||f[0].x===F||f[0].y===0||f[0].y===F;return a-Y<a/4&&(a=Y+a/4),Nt(f,K?a/2*k%a:(H/2+2*S)*E*k%a,a,V,h,Y,K,!1,F)}function Nt(f,a,h,y,b,S,E,k,F){const V=S/2,H=qe(f);let Y=0,K=a-h,te=[];for(let oe=0;oe<f.length-1;oe++){const le=f[oe],ue=f[oe+1],xe=le.dist(ue),De=ue.angleTo(le);for(;K+h<Y+xe;){K+=h;const we=(K-Y)/xe,Ee=Sr.number(le.x,ue.x,we),Ne=Sr.number(le.y,ue.y,we);if(Ee>=0&&Ee<F&&Ne>=0&&Ne<F&&K-V>=0&&K+V<=H){const Ze=new ae(Ee,Ne,De,oe);Ze._round(),y&&!Te(f,Ze,S,y,b)||te.push(Ze)}}Y+=xe}return k||te.length||E||(te=Nt(f,Y/2,h,y,b,S,E,!0,F)),te}function Fi(f,a,h,y){const b=[],S=f.image,E=S.pixelRatio,k=S.paddedRect.w-2,F=S.paddedRect.h-2;let V={x1:f.left,y1:f.top,x2:f.right,y2:f.bottom};const H=S.stretchX||[[0,k]],Y=S.stretchY||[[0,F]],K=(Ct,_i)=>Ct+_i[1]-_i[0],te=H.reduce(K,0),oe=Y.reduce(K,0),le=k-te,ue=F-oe;let xe=0,De=te,we=0,Ee=oe,Ne=0,Ze=le,yt=0,Bt=ue;if(S.content&&y){const Ct=S.content,_i=Ct[2]-Ct[0],pi=Ct[3]-Ct[1];(S.textFitWidth||S.textFitHeight)&&(V=Wu(f)),xe=Hi(H,0,Ct[0]),we=Hi(Y,0,Ct[1]),De=Hi(H,Ct[0],Ct[2]),Ee=Hi(Y,Ct[1],Ct[3]),Ne=Ct[0]-xe,yt=Ct[1]-we,Ze=_i-De,Bt=pi-Ee}const Dt=V.x1,jt=V.y1,ai=V.x2-Dt,Qt=V.y2-jt,Ot=(Ct,_i,pi,Ti)=>{const gi=ft(Ct.stretch-xe,De,ai,Dt),Bi=tt(Ct.fixed-Ne,Ze,Ct.stretch,te),Nn=ft(_i.stretch-we,Ee,Qt,jt),_n=tt(_i.fixed-yt,Bt,_i.stretch,oe),qr=ft(pi.stretch-xe,De,ai,Dt),Qa=tt(pi.fixed-Ne,Ze,pi.stretch,te),Ys=ft(Ti.stretch-we,Ee,Qt,jt),Yr=tt(Ti.fixed-yt,Bt,Ti.stretch,oe),Ur=new M(gi,Nn),Hn=new M(qr,Nn),_s=new M(qr,Ys),Rs=new M(gi,Ys),Cr=new M(Bi/E,_n/E),_l=new M(Qa/E,Yr/E),Ka=a*Math.PI/180;if(Ka){const da=Math.sin(Ka),ls=Math.cos(Ka),Js=[ls,-da,da,ls];Ur._matMult(Js),Hn._matMult(Js),Rs._matMult(Js),_s._matMult(Js)}const yl=Ct.stretch+Ct.fixed,su=_i.stretch+_i.fixed;return{tl:Ur,tr:Hn,bl:Rs,br:_s,tex:{x:S.paddedRect.x+1+yl,y:S.paddedRect.y+1+su,w:pi.stretch+pi.fixed-yl,h:Ti.stretch+Ti.fixed-su},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Cr,pixelOffsetBR:_l,minFontScaleX:Ze/E/ai,minFontScaleY:Bt/E/Qt,isSDF:h}};if(y&&(S.stretchX||S.stretchY)){const Ct=dr(H,le,te),_i=dr(Y,ue,oe);for(let pi=0;pi<Ct.length-1;pi++){const Ti=Ct[pi],gi=Ct[pi+1];for(let Bi=0;Bi<_i.length-1;Bi++)b.push(Ot(Ti,_i[Bi],gi,_i[Bi+1]))}}else b.push(Ot({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:k+1},{fixed:0,stretch:F+1}));return b}function Hi(f,a,h){let y=0;for(const b of f)y+=Math.max(a,Math.min(h,b[1]))-Math.max(a,Math.min(h,b[0]));return y}function dr(f,a,h){const y=[{fixed:-1,stretch:0}];for(const[b,S]of f){const E=y[y.length-1];y.push({fixed:b-E.stretch,stretch:E.stretch}),y.push({fixed:b-E.stretch,stretch:E.stretch+(S-b)})}return y.push({fixed:a+1,stretch:h}),y}function ft(f,a,h,y){return f/a*h+y}function tt(f,a,h,y){return f-a*h/y}yi("Anchor",ae);class Tt{constructor(a,h,y,b,S,E,k,F,V,H){var Y;if(this.boxStartIndex=a.length,V){let K=E.top,te=E.bottom;const oe=E.collisionPadding;oe&&(K-=oe[1],te+=oe[3]);let le=te-K;le>0&&(le=Math.max(10,le),this.circleDiameter=le)}else{const K=!((Y=E.image)===null||Y===void 0)&&Y.content&&(E.image.textFitWidth||E.image.textFitHeight)?Wu(E):{x1:E.left,y1:E.top,x2:E.right,y2:E.bottom};K.y1=K.y1*k-F[0],K.y2=K.y2*k+F[2],K.x1=K.x1*k-F[3],K.x2=K.x2*k+F[1];const te=E.collisionPadding;if(te&&(K.x1-=te[0]*k,K.y1-=te[1]*k,K.x2+=te[2]*k,K.y2+=te[3]*k),H){const oe=new M(K.x1,K.y1),le=new M(K.x2,K.y1),ue=new M(K.x1,K.y2),xe=new M(K.x2,K.y2),De=H*Math.PI/180;oe._rotate(De),le._rotate(De),ue._rotate(De),xe._rotate(De),K.x1=Math.min(oe.x,le.x,ue.x,xe.x),K.x2=Math.max(oe.x,le.x,ue.x,xe.x),K.y1=Math.min(oe.y,le.y,ue.y,xe.y),K.y2=Math.max(oe.y,le.y,ue.y,xe.y)}a.emplaceBack(h.x,h.y,K.x1,K.y1,K.x2,K.y2,y,b,S)}this.boxEndIndex=a.length}}class Zt{constructor(a=[],h=(y,b)=>y<b?-1:y>b?1:0){if(this.data=a,this.length=this.data.length,this.compare=h,this.length>0)for(let y=(this.length>>1)-1;y>=0;y--)this._down(y)}push(a){this.data.push(a),this._up(this.length++)}pop(){if(this.length===0)return;const a=this.data[0],h=this.data.pop();return--this.length>0&&(this.data[0]=h,this._down(0)),a}peek(){return this.data[0]}_up(a){const{data:h,compare:y}=this,b=h[a];for(;a>0;){const S=a-1>>1,E=h[S];if(y(b,E)>=0)break;h[a]=E,a=S}h[a]=b}_down(a){const{data:h,compare:y}=this,b=this.length>>1,S=h[a];for(;a<b;){let E=1+(a<<1);const k=E+1;if(k<this.length&&y(h[k],h[E])<0&&(E=k),y(h[E],S)>=0)break;h[a]=h[E],a=E}h[a]=S}}function Zi(f,a=1,h=!1){const y=Hh.fromPoints(f[0]),b=Math.min(y.width(),y.height());let S=b/2;const E=new Zt([],Qn),{minX:k,minY:F,maxX:V,maxY:H}=y;if(b===0)return new M(k,F);for(let te=k;te<V;te+=b)for(let oe=F;oe<H;oe+=b)E.push(new Ni(te+S,oe+S,S,f));let Y=(function(te){let oe=0,le=0,ue=0;const xe=te[0];for(let De=0,we=xe.length,Ee=we-1;De<we;Ee=De++){const Ne=xe[De],Ze=xe[Ee],yt=Ne.x*Ze.y-Ze.x*Ne.y;le+=(Ne.x+Ze.x)*yt,ue+=(Ne.y+Ze.y)*yt,oe+=3*yt}return new Ni(le/oe,ue/oe,0,te)})(f),K=E.length;for(;E.length;){const te=E.pop();(te.d>Y.d||!Y.d)&&(Y=te,h&&console.log("found best %d after %d probes",Math.round(1e4*te.d)/1e4,K)),te.max-Y.d<=a||(S=te.h/2,E.push(new Ni(te.p.x-S,te.p.y-S,S,f)),E.push(new Ni(te.p.x+S,te.p.y-S,S,f)),E.push(new Ni(te.p.x-S,te.p.y+S,S,f)),E.push(new Ni(te.p.x+S,te.p.y+S,S,f)),K+=4)}return h&&(console.log(`num probes: ${K}`),console.log(`best distance: ${Y.d}`)),Y.p}function Qn(f,a){return a.max-f.max}function Ni(f,a,h,y){this.p=new M(f,a),this.h=h,this.d=(function(b,S){let E=!1,k=1/0;for(let F=0;F<S.length;F++){const V=S[F];for(let H=0,Y=V.length,K=Y-1;H<Y;K=H++){const te=V[H],oe=V[K];te.y>b.y!=oe.y>b.y&&b.x<(oe.x-te.x)*(b.y-te.y)/(oe.y-te.y)+te.x&&(E=!E),k=Math.min(k,Xp(b,te,oe))}}return(E?1:-1)*Math.sqrt(k)})(this.p,y),this.max=this.d+this.h*Math.SQRT2}var ji;_.aP=void 0,(ji=_.aP||(_.aP={}))[ji.center=1]="center",ji[ji.left=2]="left",ji[ji.right=3]="right",ji[ji.top=4]="top",ji[ji.bottom=5]="bottom",ji[ji["top-left"]=6]="top-left",ji[ji["top-right"]=7]="top-right",ji[ji["bottom-left"]=8]="bottom-left",ji[ji["bottom-right"]=9]="bottom-right";const An=Number.POSITIVE_INFINITY;function Gn(f,a){return a[1]!==An?(function(h,y,b){let S=0,E=0;switch(y=Math.abs(y),b=Math.abs(b),h){case"top-right":case"top-left":case"top":E=b-7;break;case"bottom-right":case"bottom-left":case"bottom":E=7-b}switch(h){case"top-right":case"bottom-right":case"right":S=-y;break;case"top-left":case"bottom-left":case"left":S=y}return[S,E]})(f,a[0],a[1]):(function(h,y){let b=0,S=0;y<0&&(y=0);const E=y/Math.SQRT2;switch(h){case"top-right":case"top-left":S=E-7;break;case"bottom-right":case"bottom-left":S=7-E;break;case"bottom":S=7-y;break;case"top":S=y-7}switch(h){case"top-right":case"bottom-right":b=-E;break;case"top-left":case"bottom-left":b=E;break;case"left":b=y;break;case"right":b=-y}return[b,S]})(f,a[0])}function Pc(f,a,h){var y;const b=f.layout,S=(y=b.get("text-variable-anchor-offset"))===null||y===void 0?void 0:y.evaluate(a,{},h);if(S){const k=S.values,F=[];for(let V=0;V<k.length;V+=2){const H=F[V]=k[V],Y=k[V+1].map((K=>K*Bs));H.startsWith("top")?Y[1]-=7:H.startsWith("bottom")&&(Y[1]+=7),F[V+1]=Y}return new kr(F)}const E=b.get("text-variable-anchor");if(E){let k;k=f._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[b.get("text-radial-offset").evaluate(a,{},h)*Bs,An]:b.get("text-offset").evaluate(a,{},h).map((V=>V*Bs));const F=[];for(const V of E)F.push(V,Gn(V,k));return new kr(F)}return null}function Qm(f){switch(f){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function N1(f,a,h,y,b,S,E,k,F,V,H,Y){let K=S.textMaxSize.evaluate(a,{});K===void 0&&(K=E);const te=f.layers[0].layout,oe=te.get("icon-offset").evaluate(a,{},H),le=z1(h.horizontal),ue=E/24,xe=f.tilePixelRatio*ue,De=f.tilePixelRatio*K/24,we=f.tilePixelRatio*k,Ee=f.tilePixelRatio*te.get("symbol-spacing"),Ne=te.get("text-padding")*f.tilePixelRatio,Ze=(function(pi,Ti,gi,Bi=1){const Nn=pi.get("icon-padding").evaluate(Ti,{},gi),_n=Nn&&Nn.values;return[_n[0]*Bi,_n[1]*Bi,_n[2]*Bi,_n[3]*Bi]})(te,a,H,f.tilePixelRatio),yt=te.get("text-max-angle")/180*Math.PI,Bt=te.get("text-rotation-alignment")!=="viewport"&&te.get("symbol-placement")!=="point",Dt=te.get("icon-rotation-alignment")==="map"&&te.get("symbol-placement")!=="point",jt=te.get("symbol-placement"),ai=Ee/2,Qt=te.get("icon-text-fit");let Ot;y&&Qt!=="none"&&(f.allowVerticalPlacement&&h.vertical&&(Ot=Ec(y,h.vertical,Qt,te.get("icon-text-fit-padding"),oe,ue)),le&&(y=Ec(y,le,Qt,te.get("icon-text-fit-padding"),oe,ue)));const Ct=H?Y.line.getGranularityForZoomLevel(H.z):1,_i=(pi,Ti)=>{Ti.x<0||Ti.x>=li||Ti.y<0||Ti.y>=li||(function(gi,Bi,Nn,_n,qr,Qa,Ys,Yr,Ur,Hn,_s,Rs,Cr,_l,Ka,yl,su,da,ls,Js,ys,pa,Wf,Ku,e_){const Kd=gi.addToLineVertexArray(Bi,Nn);let xp,kg,Dg,Og,b2=0,A2=0,w2=0,T2=0,_y=-1,yy=-1;const Zf={};let j1=jn("");if(gi.allowVerticalPlacement&&_n.vertical){const To=Yr.layout.get("text-rotate").evaluate(ys,{},Ku)+90;Dg=new Tt(Ur,Bi,Hn,_s,Rs,_n.vertical,Cr,_l,Ka,To),Ys&&(Og=new Tt(Ur,Bi,Hn,_s,Rs,Ys,su,da,Ka,To))}if(qr){const To=Yr.layout.get("icon-rotate").evaluate(ys,{}),Ic=Yr.layout.get("icon-text-fit")!=="none",bp=Fi(qr,To,Wf,Ic),th=Ys?Fi(Ys,To,Wf,Ic):void 0;kg=new Tt(Ur,Bi,Hn,_s,Rs,qr,su,da,!1,To),b2=4*bp.length;const Ap=gi.iconSizeData;let tf=null;Ap.kind==="source"?(tf=[gl*Yr.layout.get("icon-size").evaluate(ys,{})],tf[0]>Wh&&br(`${gi.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Ap.kind==="composite"&&(tf=[gl*pa.compositeIconSizes[0].evaluate(ys,{},Ku),gl*pa.compositeIconSizes[1].evaluate(ys,{},Ku)],(tf[0]>Wh||tf[1]>Wh)&&br(`${gi.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),gi.addSymbols(gi.icon,bp,tf,Js,ls,ys,_.az.none,Bi,Kd.lineStartIndex,Kd.lineLength,-1,Ku),_y=gi.icon.placedSymbolArray.length-1,th&&(A2=4*th.length,gi.addSymbols(gi.icon,th,tf,Js,ls,ys,_.az.vertical,Bi,Kd.lineStartIndex,Kd.lineLength,-1,Ku),yy=gi.icon.placedSymbolArray.length-1)}const G1=Object.keys(_n.horizontal);for(const To of G1){const Ic=_n.horizontal[To];if(!xp){j1=jn(Ic.text);const th=Yr.layout.get("text-rotate").evaluate(ys,{},Ku);xp=new Tt(Ur,Bi,Hn,_s,Rs,Ic,Cr,_l,Ka,th)}const bp=Ic.positionedLines.length===1;if(w2+=B1(gi,Bi,Ic,Qa,Yr,Ka,ys,yl,Kd,_n.vertical?_.az.horizontal:_.az.horizontalOnly,bp?G1:[To],Zf,_y,pa,Ku),bp)break}_n.vertical&&(T2+=B1(gi,Bi,_n.vertical,Qa,Yr,Ka,ys,yl,Kd,_.az.vertical,["vertical"],Zf,yy,pa,Ku));const Ux=xp?xp.boxStartIndex:gi.collisionBoxArray.length,Vx=xp?xp.boxEndIndex:gi.collisionBoxArray.length,jx=Dg?Dg.boxStartIndex:gi.collisionBoxArray.length,Gx=Dg?Dg.boxEndIndex:gi.collisionBoxArray.length,Wx=kg?kg.boxStartIndex:gi.collisionBoxArray.length,Zx=kg?kg.boxEndIndex:gi.collisionBoxArray.length,Xx=Og?Og.boxStartIndex:gi.collisionBoxArray.length,Hx=Og?Og.boxEndIndex:gi.collisionBoxArray.length;let eh=-1;const vy=(To,Ic)=>To&&To.circleDiameter?Math.max(To.circleDiameter,Ic):Ic;eh=vy(xp,eh),eh=vy(Dg,eh),eh=vy(kg,eh),eh=vy(Og,eh);const W1=eh>-1?1:0;W1&&(eh*=e_/Bs),gi.glyphOffsetArray.length>=jd.MAX_GLYPHS&&br("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),ys.sortKey!==void 0&&gi.addToSortKeyRanges(gi.symbolInstances.length,ys.sortKey);const $x=Pc(Yr,ys,Ku),[qx,Yx]=(function(To,Ic){const bp=To.length,th=Ic==null?void 0:Ic.values;if((th==null?void 0:th.length)>0)for(let Ap=0;Ap<th.length;Ap+=2){const tf=th[Ap+1];To.emplaceBack(_.aP[th[Ap]],tf[0],tf[1])}return[bp,To.length]})(gi.textAnchorOffsets,$x);gi.symbolInstances.emplaceBack(Bi.x,Bi.y,Zf.right>=0?Zf.right:-1,Zf.center>=0?Zf.center:-1,Zf.left>=0?Zf.left:-1,Zf.vertical||-1,_y,yy,j1,Ux,Vx,jx,Gx,Wx,Zx,Xx,Hx,Hn,w2,T2,b2,A2,W1,0,Cr,eh,qx,Yx)})(f,Ti,pi,h,y,b,Ot,f.layers[0],f.collisionBoxArray,a.index,a.sourceLayerIndex,f.index,xe,[Ne,Ne,Ne,Ne],Bt,F,we,Ze,Dt,oe,a,S,V,H,E)};if(jt==="line")for(const pi of d(a.geometry,0,0,li,li)){const Ti=iu(pi,Ct),gi=It(Ti,Ee,yt,h.vertical||le,y,24,De,f.overscaling,li);for(const Bi of gi)le&&Lx(f,le.text,ai,Bi)||_i(Ti,Bi)}else if(jt==="line-center"){for(const pi of a.geometry)if(pi.length>1){const Ti=iu(pi,Ct),gi=$t(Ti,yt,h.vertical||le,y,24,De);gi&&_i(Ti,gi)}}else if(a.type==="Polygon")for(const pi of sd(a.geometry,0)){const Ti=Zi(pi,16);_i(iu(pi[0],Ct,!0),new ae(Ti.x,Ti.y,0))}else if(a.type==="LineString")for(const pi of a.geometry){const Ti=iu(pi,Ct);_i(Ti,new ae(Ti[0].x,Ti[0].y,0))}else if(a.type==="Point")for(const pi of a.geometry)for(const Ti of pi)_i([Ti],new ae(Ti.x,Ti.y,0))}function B1(f,a,h,y,b,S,E,k,F,V,H,Y,K,te,oe){const le=(function(De,we,Ee,Ne,Ze,yt,Bt,Dt){const jt=Ne.layout.get("text-rotate").evaluate(yt,{})*Math.PI/180,ai=[];for(const Qt of we.positionedLines)for(const Ot of Qt.positionedGlyphs){if(!Ot.rect)continue;const Ct=Ot.rect||{};let _i=4,pi=!0,Ti=1,gi=0;const Bi=(Ze||Dt)&&Ot.vertical,Nn=Ot.metrics.advance*Ot.scale/2;if(Dt&&we.verticalizable&&(gi=Qt.lineOffset/2-(Ot.imageName?-(Bs-Ot.metrics.width*Ot.scale)/2:(Ot.scale-1)*Bs)),Ot.imageName){const da=Bt[Ot.imageName];pi=da.sdf,Ti=da.pixelRatio,_i=1/Ti}const _n=Ze?[Ot.x+Nn,Ot.y]:[0,0];let qr=Ze?[0,0]:[Ot.x+Nn+Ee[0],Ot.y+Ee[1]-gi],Qa=[0,0];Bi&&(Qa=qr,qr=[0,0]);const Ys=Ot.metrics.isDoubleResolution?2:1,Yr=(Ot.metrics.left-_i)*Ot.scale-Nn+qr[0],Ur=(-Ot.metrics.top-_i)*Ot.scale+qr[1],Hn=Yr+Ct.w/Ys*Ot.scale/Ti,_s=Ur+Ct.h/Ys*Ot.scale/Ti,Rs=new M(Yr,Ur),Cr=new M(Hn,Ur),_l=new M(Yr,_s),Ka=new M(Hn,_s);if(Bi){const da=new M(-Nn,Nn- -17),ls=-Math.PI/2,Js=12-Nn,ys=new M(22-Js,-(Ot.imageName?Js:0)),pa=new M(...Qa);Rs._rotateAround(ls,da)._add(ys)._add(pa),Cr._rotateAround(ls,da)._add(ys)._add(pa),_l._rotateAround(ls,da)._add(ys)._add(pa),Ka._rotateAround(ls,da)._add(ys)._add(pa)}if(jt){const da=Math.sin(jt),ls=Math.cos(jt),Js=[ls,-da,da,ls];Rs._matMult(Js),Cr._matMult(Js),_l._matMult(Js),Ka._matMult(Js)}const yl=new M(0,0),su=new M(0,0);ai.push({tl:Rs,tr:Cr,bl:_l,br:Ka,tex:Ct,writingMode:we.writingMode,glyphOffset:_n,sectionIndex:Ot.sectionIndex,isSDF:pi,pixelOffsetTL:yl,pixelOffsetBR:su,minFontScaleX:0,minFontScaleY:0})}return ai})(0,h,k,b,S,E,y,f.allowVerticalPlacement),ue=f.textSizeData;let xe=null;ue.kind==="source"?(xe=[gl*b.layout.get("text-size").evaluate(E,{})],xe[0]>Wh&&br(`${f.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):ue.kind==="composite"&&(xe=[gl*te.compositeTextSizes[0].evaluate(E,{},oe),gl*te.compositeTextSizes[1].evaluate(E,{},oe)],(xe[0]>Wh||xe[1]>Wh)&&br(`${f.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),f.addSymbols(f.text,le,xe,k,S,E,V,a,F.lineStartIndex,F.lineLength,K,oe);for(const De of H)Y[De]=f.text.placedSymbolArray.length-1;return 4*le.length}function z1(f){for(const a in f)return f[a];return null}function Lx(f,a,h,y){const b=f.compareText;if(a in b){const S=b[a];for(let E=S.length-1;E>=0;E--)if(y.dist(S[E])<h)return!0}else b[a]=[];return b[a].push(y),!1}const L1=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class g2{static from(a){if(!(a instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[h,y]=new Uint8Array(a,0,2);if(h!==219)throw new Error("Data does not appear to be in a KDBush format.");const b=y>>4;if(b!==1)throw new Error(`Got v${b} data when expected v1.`);const S=L1[15&y];if(!S)throw new Error("Unrecognized array type.");const[E]=new Uint16Array(a,2,1),[k]=new Uint32Array(a,4,1);return new g2(k,E,S,a)}constructor(a,h=64,y=Float64Array,b){if(isNaN(a)||a<0)throw new Error(`Unpexpected numItems value: ${a}.`);this.numItems=+a,this.nodeSize=Math.min(Math.max(+h,2),65535),this.ArrayType=y,this.IndexArrayType=a<65536?Uint16Array:Uint32Array;const S=L1.indexOf(this.ArrayType),E=2*a*this.ArrayType.BYTES_PER_ELEMENT,k=a*this.IndexArrayType.BYTES_PER_ELEMENT,F=(8-k%8)%8;if(S<0)throw new Error(`Unexpected typed array class: ${y}.`);b&&b instanceof ArrayBuffer?(this.data=b,this.ids=new this.IndexArrayType(this.data,8,a),this.coords=new this.ArrayType(this.data,8+k+F,2*a),this._pos=2*a,this._finished=!0):(this.data=new ArrayBuffer(8+E+k+F),this.ids=new this.IndexArrayType(this.data,8,a),this.coords=new this.ArrayType(this.data,8+k+F,2*a),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+S]),new Uint16Array(this.data,2,1)[0]=h,new Uint32Array(this.data,4,1)[0]=a)}add(a,h){const y=this._pos>>1;return this.ids[y]=y,this.coords[this._pos++]=a,this.coords[this._pos++]=h,y}finish(){const a=this._pos>>1;if(a!==this.numItems)throw new Error(`Added ${a} items when expected ${this.numItems}.`);return gy(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(a,h,y,b){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:S,coords:E,nodeSize:k}=this,F=[0,S.length-1,0],V=[];for(;F.length;){const H=F.pop()||0,Y=F.pop()||0,K=F.pop()||0;if(Y-K<=k){for(let ue=K;ue<=Y;ue++){const xe=E[2*ue],De=E[2*ue+1];xe>=a&&xe<=y&&De>=h&&De<=b&&V.push(S[ue])}continue}const te=K+Y>>1,oe=E[2*te],le=E[2*te+1];oe>=a&&oe<=y&&le>=h&&le<=b&&V.push(S[te]),(H===0?a<=oe:h<=le)&&(F.push(K),F.push(te-1),F.push(1-H)),(H===0?y>=oe:b>=le)&&(F.push(te+1),F.push(Y),F.push(1-H))}return V}within(a,h,y){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:b,coords:S,nodeSize:E}=this,k=[0,b.length-1,0],F=[],V=y*y;for(;k.length;){const H=k.pop()||0,Y=k.pop()||0,K=k.pop()||0;if(Y-K<=E){for(let ue=K;ue<=Y;ue++)V1(S[2*ue],S[2*ue+1],a,h)<=V&&F.push(b[ue]);continue}const te=K+Y>>1,oe=S[2*te],le=S[2*te+1];V1(oe,le,a,h)<=V&&F.push(b[te]),(H===0?a-y<=oe:h-y<=le)&&(k.push(K),k.push(te-1),k.push(1-H)),(H===0?a+y>=oe:h+y>=le)&&(k.push(te+1),k.push(Y),k.push(1-H))}return F}}function gy(f,a,h,y,b,S){if(b-y<=h)return;const E=y+b>>1;U1(f,a,E,y,b,S),gy(f,a,h,y,E-1,1-S),gy(f,a,h,E+1,b,1-S)}function U1(f,a,h,y,b,S){for(;b>y;){if(b-y>600){const V=b-y+1,H=h-y+1,Y=Math.log(V),K=.5*Math.exp(2*Y/3),te=.5*Math.sqrt(Y*K*(V-K)/V)*(H-V/2<0?-1:1);U1(f,a,h,Math.max(y,Math.floor(h-H*K/V+te)),Math.min(b,Math.floor(h+(V-H)*K/V+te)),S)}const E=a[2*h+S];let k=y,F=b;for(vp(f,a,y,h),a[2*b+S]>E&&vp(f,a,y,b);k<F;){for(vp(f,a,k,F),k++,F--;a[2*k+S]<E;)k++;for(;a[2*F+S]>E;)F--}a[2*y+S]===E?vp(f,a,y,F):(F++,vp(f,a,F,b)),F<=h&&(y=F+1),h<=F&&(b=F-1)}}function vp(f,a,h,y){m2(f,h,y),m2(a,2*h,2*y),m2(a,2*h+1,2*y+1)}function m2(f,a,h){const y=f[a];f[a]=f[h],f[h]=y}function V1(f,a,h,y){const b=f-h,S=a-y;return b*b+S*S}var _2;_.cI=void 0,(_2=_.cI||(_.cI={})).create="create",_2.load="load",_2.fullLoad="fullLoad";let my=null,Km=[];const y2=1e3/60,v2="loadTime",x2="fullLoadTime",d3={mark(f){performance.mark(f)},frame(f){const a=f;my!=null&&Km.push(a-my),my=a},clearMetrics(){my=null,Km=[],performance.clearMeasures(v2),performance.clearMeasures(x2);for(const f in _.cI)performance.clearMarks(_.cI[f])},getPerformanceMetrics(){performance.measure(v2,_.cI.create,_.cI.load),performance.measure(x2,_.cI.create,_.cI.fullLoad);const f=performance.getEntriesByName(v2)[0].duration,a=performance.getEntriesByName(x2)[0].duration,h=Km.length,y=1/(Km.reduce(((S,E)=>S+E),0)/h/1e3),b=Km.filter((S=>S>y2)).reduce(((S,E)=>S+(E-y2)/y2),0);return{loadTime:f,fullLoadTime:a,fps:y,percentDroppedFrames:b/(h+b)*100,totalFrames:h}}};_.$=he,_.A=Be,_.B=ll,_.C=Ds,_.D=xi,_.E=qt,_.F=function([f,a,h]){return a+=90,a*=Math.PI/180,h*=Math.PI/180,{x:f*Math.cos(a)*Math.sin(h),y:f*Math.sin(a)*Math.sin(h),z:f*Math.cos(h)}},_.G=Sr,_.H=Un,_.I=Yn,_.J=vd,_.K=function(f){if(Ir==null){const a=f.navigator?f.navigator.userAgent:null;Ir=!!f.safari||!(!a||!(/\b(iPad|iPhone|iPod)\b/.test(a)||a.match("Safari")&&!a.match("Chrome")))}return Ir},_.L=class{constructor(f,a){this.target=f,this.mapId=a,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new _g((()=>this.process())),this.subscription=so(this.target,"message",(h=>this.receive(h)),!1),this.globalScope=Na(self)?f:window}registerMessageHandler(f,a){this.messageHandlers[f]=a}unregisterMessageHandler(f){delete this.messageHandlers[f]}sendAsync(f,a){return new Promise(((h,y)=>{const b=Math.round(1e18*Math.random()).toString(36).substring(0,10),S=a?so(a.signal,"abort",(()=>{S==null||S.unsubscribe(),delete this.resolveRejects[b];const F={id:b,type:"<cancel>",origin:location.origin,targetMapId:f.targetMapId,sourceMapId:this.mapId};this.target.postMessage(F)}),Im):null;this.resolveRejects[b]={resolve:F=>{S==null||S.unsubscribe(),h(F)},reject:F=>{S==null||S.unsubscribe(),y(F)}};const E=[],k=Object.assign(Object.assign({},f),{id:b,sourceMapId:this.mapId,origin:location.origin,data:cl(f.data,E)});this.target.postMessage(k,{transfer:E})}))}receive(f){const a=f.data,h=a.id;if(!(a.origin!=="file://"&&location.origin!=="file://"&&a.origin!=="resource://android"&&location.origin!=="resource://android"&&a.origin!==location.origin||a.targetMapId&&this.mapId!==a.targetMapId)){if(a.type==="<cancel>"){delete this.tasks[h];const y=this.abortControllers[h];return delete this.abortControllers[h],void(y&&y.abort())}if(Na(self)||a.mustQueue)return this.tasks[h]=a,this.taskQueue.push(h),void this.invoker.trigger();this.processTask(h,a)}}process(){if(this.taskQueue.length===0)return;const f=this.taskQueue.shift(),a=this.tasks[f];delete this.tasks[f],this.taskQueue.length>0&&this.invoker.trigger(),a&&this.processTask(f,a)}processTask(f,a){return l(this,void 0,void 0,(function*(){if(a.type==="<response>"){const b=this.resolveRejects[f];return delete this.resolveRejects[f],b?void(a.error?b.reject(Th(a.error)):b.resolve(Th(a.data))):void 0}if(!this.messageHandlers[a.type])return void this.completeTask(f,new Error(`Could not find a registered handler for ${a.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const h=Th(a.data),y=new AbortController;this.abortControllers[f]=y;try{const b=yield this.messageHandlers[a.type](a.sourceMapId,h,y);this.completeTask(f,null,b)}catch(b){this.completeTask(f,b)}}))}completeTask(f,a,h){const y=[];delete this.abortControllers[f];const b={id:f,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:a?cl(a):null,data:cl(h,y)};this.target.postMessage(b,{transfer:y})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},_.M=ve,_.N=function(){var f=new Be(16);return Be!=Float32Array&&(f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[11]=0,f[12]=0,f[13]=0,f[14]=0),f[0]=1,f[5]=1,f[10]=1,f[15]=1,f},_.O=function(f,a,h){var y,b,S,E,k,F,V,H,Y,K,te,oe,le=h[0],ue=h[1],xe=h[2];return a===f?(f[12]=a[0]*le+a[4]*ue+a[8]*xe+a[12],f[13]=a[1]*le+a[5]*ue+a[9]*xe+a[13],f[14]=a[2]*le+a[6]*ue+a[10]*xe+a[14],f[15]=a[3]*le+a[7]*ue+a[11]*xe+a[15]):(b=a[1],S=a[2],E=a[3],k=a[4],F=a[5],V=a[6],H=a[7],Y=a[8],K=a[9],te=a[10],oe=a[11],f[0]=y=a[0],f[1]=b,f[2]=S,f[3]=E,f[4]=k,f[5]=F,f[6]=V,f[7]=H,f[8]=Y,f[9]=K,f[10]=te,f[11]=oe,f[12]=y*le+k*ue+Y*xe+a[12],f[13]=b*le+F*ue+K*xe+a[13],f[14]=S*le+V*ue+te*xe+a[14],f[15]=E*le+H*ue+oe*xe+a[15]),f},_.P=M,_.Q=function(f,a,h){var y=h[0],b=h[1],S=h[2];return f[0]=a[0]*y,f[1]=a[1]*y,f[2]=a[2]*y,f[3]=a[3]*y,f[4]=a[4]*b,f[5]=a[5]*b,f[6]=a[6]*b,f[7]=a[7]*b,f[8]=a[8]*S,f[9]=a[9]*S,f[10]=a[10]*S,f[11]=a[11]*S,f[12]=a[12],f[13]=a[13],f[14]=a[14],f[15]=a[15],f},_.R=Ha,_.S=function(f,a,h){var y=a[0],b=a[1],S=a[2],E=a[3],k=a[4],F=a[5],V=a[6],H=a[7],Y=a[8],K=a[9],te=a[10],oe=a[11],le=a[12],ue=a[13],xe=a[14],De=a[15],we=h[0],Ee=h[1],Ne=h[2],Ze=h[3];return f[0]=we*y+Ee*k+Ne*Y+Ze*le,f[1]=we*b+Ee*F+Ne*K+Ze*ue,f[2]=we*S+Ee*V+Ne*te+Ze*xe,f[3]=we*E+Ee*H+Ne*oe+Ze*De,f[4]=(we=h[4])*y+(Ee=h[5])*k+(Ne=h[6])*Y+(Ze=h[7])*le,f[5]=we*b+Ee*F+Ne*K+Ze*ue,f[6]=we*S+Ee*V+Ne*te+Ze*xe,f[7]=we*E+Ee*H+Ne*oe+Ze*De,f[8]=(we=h[8])*y+(Ee=h[9])*k+(Ne=h[10])*Y+(Ze=h[11])*le,f[9]=we*b+Ee*F+Ne*K+Ze*ue,f[10]=we*S+Ee*V+Ne*te+Ze*xe,f[11]=we*E+Ee*H+Ne*oe+Ze*De,f[12]=(we=h[12])*y+(Ee=h[13])*k+(Ne=h[14])*Y+(Ze=h[15])*le,f[13]=we*b+Ee*F+Ne*K+Ze*ue,f[14]=we*S+Ee*V+Ne*te+Ze*xe,f[15]=we*E+Ee*H+Ne*oe+Ze*De,f},_.T=Fh,_.U=function(f,a){const h={};for(let y=0;y<a.length;y++){const b=a[y];b in f&&(h[b]=f[b])}return h},_.V=nu,_.W=yn,_.X=Xh,_.Y=Y_,_.Z=it,_._=l,_.a=hh,_.a$=hi,_.a0=Le,_.a1=Nc,_.a2=qo,_.a3=Q_,_.a4=tp,_.a5=li,_.a6=function(f,a,h){if(!f)return a||{};if(!a)return f||{};const y=ip(f),b=ip(a);(function(E,k){k.removeAll&&(E.add.clear(),E.update.clear(),E.remove.clear(),k.remove.clear());for(const F of k.remove)E.add.delete(F),E.update.delete(F);for(const[F,V]of k.update){const H=E.update.get(F);H&&(k.update.set(F,Dm(H,V)),E.update.delete(F))}})(y,b);const S={};if((y.removeAll||b.removeAll)&&(S.removeAll=!0),S.remove=new Set([...y.remove,...b.remove]),S.add=new Map([...y.add,...b.add]),S.update=new Map([...y.update,...b.update]),S.remove.size&&S.add.size)for(const E of S.add.keys())S.remove.delete(E);return(function(E){const k={};return E.removeAll&&(k.removeAll=E.removeAll),E.remove&&(k.remove=Array.from(E.remove)),E.add&&(k.add=Array.from(E.add.values())),E.update&&(k.update=Array.from(E.update.values())),k})(S)},_.a7=function(f,a){const h=new Map;if(f==null||f.type==null)return h;if(f.type==="Feature"){const y=Zd(f,a);return y==null?void 0:(h.set(y,f),h)}if(f.type==="FeatureCollection"){const y=new Set;for(const b of f.features){const S=Zd(b,a);if(S==null||y.has(S))return;y.add(S),h.set(S,b)}return h}},_.a8=function(f,a,h){var y,b;const S=[];if(a.removeAll)f.clear();else if(a.remove)for(const E of a.remove){const k=f.get(E);k&&(S.push(k.geometry),f.delete(E))}if(a.add)for(const E of a.add){const k=Zd(E,h);if(k==null)continue;const F=f.get(k);F&&S.push(F.geometry),S.push(E.geometry),f.set(k,E)}if(a.update)for(const E of a.update){const k=f.get(E.id);if(!k)continue;const F=!!E.newGeometry,V=E.removeAllProperties||((y=E.removeProperties)===null||y===void 0?void 0:y.length)>0||((b=E.addOrUpdateProperties)===null||b===void 0?void 0:b.length)>0;if(!F&&!V)continue;S.push(k.geometry);const H=Object.assign({},k);if(f.set(E.id,H),F&&(S.push(E.newGeometry),H.geometry=E.newGeometry),V){if(H.properties=E.removeAllProperties?{}:Object.assign({},H.properties||{}),E.removeProperties)for(const Y of E.removeProperties)delete H.properties[Y];if(E.addOrUpdateProperties)for(const{key:Y,value:K}of E.addOrUpdateProperties)H.properties[Y]=K}}return S},_.a9=Jn,_.aA=function(f,{uSize:a,uSizeT:h},{lowerSize:y,upperSize:b}){return f.kind==="source"?y/gl:f.kind==="composite"?Sr.number(y/gl,b/gl,h):a},_.aB=function(f,a){var h=a[0],y=a[1],b=a[2],S=a[3],E=a[4],k=a[5],F=a[6],V=a[7],H=a[8],Y=a[9],K=a[10],te=a[11],oe=a[12],le=a[13],ue=a[14],xe=a[15],De=h*k-y*E,we=h*F-b*E,Ee=h*V-S*E,Ne=y*F-b*k,Ze=y*V-S*k,yt=b*V-S*F,Bt=H*le-Y*oe,Dt=H*ue-K*oe,jt=H*xe-te*oe,ai=Y*ue-K*le,Qt=Y*xe-te*le,Ot=K*xe-te*ue,Ct=De*Ot-we*Qt+Ee*ai+Ne*jt-Ze*Dt+yt*Bt;return Ct?(f[0]=(k*Ot-F*Qt+V*ai)*(Ct=1/Ct),f[1]=(b*Qt-y*Ot-S*ai)*Ct,f[2]=(le*yt-ue*Ze+xe*Ne)*Ct,f[3]=(K*Ze-Y*yt-te*Ne)*Ct,f[4]=(F*jt-E*Ot-V*Dt)*Ct,f[5]=(h*Ot-b*jt+S*Dt)*Ct,f[6]=(ue*Ee-oe*yt-xe*we)*Ct,f[7]=(H*yt-K*Ee+te*we)*Ct,f[8]=(E*Qt-k*jt+V*Bt)*Ct,f[9]=(y*jt-h*Qt-S*Bt)*Ct,f[10]=(oe*Ze-le*Ee+xe*De)*Ct,f[11]=(Y*Ee-H*Ze-te*De)*Ct,f[12]=(k*Dt-E*ai-F*Bt)*Ct,f[13]=(h*ai-y*Dt+b*Bt)*Ct,f[14]=(le*we-oe*Ne-ue*De)*Ct,f[15]=(H*Ne-Y*we+K*De)*Ct,f):null},_.aC=Ut,_.aD=function(f){var a=f[0],h=f[1];return Math.sqrt(a*a+h*h)},_.aE=function(f){return f[0]=0,f[1]=0,f},_.aF=function(f,a,h){return f[0]=a[0]*h,f[1]=a[1]*h,f},_.aG=Mm,_.aH=fi,_.aI=function(f,a,h,y){const b=a.y-f.y,S=a.x-f.x,E=y.y-h.y,k=y.x-h.x,F=E*S-k*b;if(F===0)return null;const V=(k*(f.y-h.y)-E*(f.x-h.x))/F;return new M(f.x+V*S,f.y+V*b)},_.aJ=d,_.aK=Df,_.aL=function(f){let a=1/0,h=1/0,y=-1/0,b=-1/0;for(const S of f)a=Math.min(a,S.x),h=Math.min(h,S.y),y=Math.max(y,S.x),b=Math.max(b,S.y);return[a,h,y,b]},_.aM=Bs,_.aN=Wi,_.aO=function(f,a,h,y,b=!1){if(!h[0]&&!h[1])return[0,0];const S=b?y==="map"?-f.bearingInRadians:0:y==="viewport"?f.bearingInRadians:0;if(S){const E=Math.sin(S),k=Math.cos(S);h=[h[0]*k-h[1]*E,h[0]*E+h[1]*k]}return[b?h[0]:Wi(a,h[0],f.zoom),b?h[1]:Wi(a,h[1],f.zoom)]},_.aQ=fg,_.aR=Qm,_.aS=cg,_.aT=g2,_.aU=_r,_.aV=Dd,_.aW=Me,_.aX=ri,_.aY=_t,_.aZ=ao,_.a_=km,_.aa=Hh,_.ab=25,_.ac=Es,_.ad=f=>{const a=window.document.createElement("video");return a.muted=!0,new Promise((h=>{a.onloadstart=()=>{h(a)};for(const y of f){const b=window.document.createElement("source");xt(y)||(a.crossOrigin="Anonymous"),b.src=y,a.appendChild(b)}}))},_.ae=Vt,_.af=function(){return mr++},_.ag=T,_.ah=jd,_.ai=yp,_.aj=Ua,_.ak=as,_.al=vg,_.am=function(f){const a={};if(f.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((h,y,b,S)=>{const E=b||S;return a[y]=!E||E.toLowerCase(),""})),a["max-age"]){const h=parseInt(a["max-age"],10);isNaN(h)?delete a["max-age"]:a["max-age"]=h}return a},_.an=Vi,_.ao=85.051129,_.ap=Qr,_.aq=function(f){return Math.pow(2,f)},_.ar=Rt,_.as=J_,_.at=function(f){return Math.log(f)/Math.LN2},_.au=function(f){var a=f[0],h=f[1];return a*a+h*h},_.av=function(f){if(!f.length)return new Set;const a=Math.max(...f.map((F=>F.canonical.z)));let h=1/0,y=-1/0,b=1/0,S=-1/0;const E=[];for(const F of f){const{x:V,y:H,z:Y}=F.canonical,K=Math.pow(2,a-Y),te=V*K,oe=H*K;E.push({id:F,x:te,y:oe}),te<h&&(h=te),te>y&&(y=te),oe<b&&(b=oe),oe>S&&(S=oe)}const k=new Set;for(const F of E)F.x!==h&&F.x!==y&&F.y!==b&&F.y!==S||k.add(F.id);return k},_.aw=function(f,a){const h=Math.abs(2*f.wrap)-+(f.wrap<0),y=Math.abs(2*a.wrap)-+(a.wrap<0);return f.overscaledZ-a.overscaledZ||y-h||a.canonical.y-f.canonical.y||a.canonical.x-f.canonical.x},_.ax=class{constructor(f,a){this.max=f,this.onRemove=a,this.reset()}reset(){for(const f in this.data)for(const a of this.data[f])a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);return this.data={},this.order=[],this}add(f,a,h){const y=f.wrapped().key;this.data[y]===void 0&&(this.data[y]=[]);const b={value:a,timeout:void 0};if(h!==void 0&&(b.timeout=setTimeout((()=>{this.remove(f,b)}),h)),this.data[y].push(b),this.order.push(y),this.order.length>this.max){const S=this._getAndRemoveByKey(this.order[0]);S&&this.onRemove(S)}return this}has(f){return f.wrapped().key in this.data}getAndRemove(f){return this.has(f)?this._getAndRemoveByKey(f.wrapped().key):null}_getAndRemoveByKey(f){const a=this.data[f].shift();return a.timeout&&clearTimeout(a.timeout),this.data[f].length===0&&delete this.data[f],this.order.splice(this.order.indexOf(f),1),a.value}getByKey(f){const a=this.data[f];return a?a[0].value:null}get(f){return this.has(f)?this.data[f.wrapped().key][0].value:null}remove(f,a){if(!this.has(f))return this;const h=f.wrapped().key,y=a===void 0?0:this.data[h].indexOf(a),b=this.data[h][y];return this.data[h].splice(y,1),b.timeout&&clearTimeout(b.timeout),this.data[h].length===0&&delete this.data[h],this.onRemove(b.value),this.order.splice(this.order.indexOf(h),1),this}setMaxSize(f){for(this.max=f;this.order.length>this.max;){const a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}filter(f){const a=[];for(const h in this.data)for(const y of this.data[h])f(y.value)||a.push(y);for(const h of a)this.remove(h.value.tileID,h)}},_.ay=function(f,a){let h=0,y=0;if(f.kind==="constant")y=f.layoutSize;else if(f.kind!=="source"){const{interpolationType:b,minZoom:S,maxZoom:E}=f,k=b?Vi(is.interpolationFactor(b,a,S,E),0,1):0;f.kind==="camera"?y=Sr.number(f.minSize,f.maxSize,k):h=k}return{uSizeT:h,uSize:y}},_.b=xl,_.b$=jo,_.b0=Xt,_.b1=function(f){var a=new Be(3);return a[0]=f[0],a[1]=f[1],a[2]=f[2],a},_.b2=function(f,a,h){return f[0]=a[0]-h[0],f[1]=a[1]-h[1],f[2]=a[2]-h[2],f},_.b3=function(f,a){var h=a[0],y=a[1],b=a[2],S=h*h+y*y+b*b;return S>0&&(S=1/Math.sqrt(S)),f[0]=a[0]*S,f[1]=a[1]*S,f[2]=a[2]*S,f},_.b4=di,_.b5=function(f,a){return f[0]*a[0]+f[1]*a[1]+f[2]*a[2]},_.b6=function(f,a,h){return f[0]=a[0]*h[0],f[1]=a[1]*h[1],f[2]=a[2]*h[2],f[3]=a[3]*h[3],f},_.b7=kt,_.b8=function(f,a,h){const y=a[0]*h[0]+a[1]*h[1]+a[2]*h[2];return y===0?null:(-(f[0]*h[0]+f[1]*h[1]+f[2]*h[2])-h[3])/y},_.b9=Ii,_.bA=function(){return new Float64Array(3)},_.bB=nt,_.bC=function(f,a,h){var y=h[0],b=h[1],S=h[2],E=h[3],k=a[0],F=a[1],V=a[2],H=b*V-S*F,Y=S*k-y*V,K=y*F-b*k;return f[0]=k+E*(H+=H)+b*(K+=K)-S*(Y+=Y),f[1]=F+E*Y+S*H-y*K,f[2]=V+E*K+y*Y-b*H,f},_.bD=function(f,a,h){const y=(b=[f[0],f[1],f[2],a[0],a[1],a[2],h[0],h[1],h[2]])[0]*((H=b[8])*(E=b[4])-(k=b[5])*(V=b[7]))+b[1]*(-H*(S=b[3])+k*(F=b[6]))+b[2]*(V*S-E*F);var b,S,E,k,F,V,H;if(y===0)return null;const Y=di([],[a[0],a[1],a[2]],[h[0],h[1],h[2]]),K=di([],[h[0],h[1],h[2]],[f[0],f[1],f[2]]),te=di([],[f[0],f[1],f[2]],[a[0],a[1],a[2]]),oe=hi([],Y,-f[3]);return Xt(oe,oe,hi([],K,-a[3])),Xt(oe,oe,hi([],te,-h[3])),hi(oe,oe,1/y),oe},_.bE=yg,_.bF=function(){return new Float64Array(4)},_.bG=function(f,a,h,y){var b=[],S=[];return b[0]=a[0]-h[0],b[1]=a[1]-h[1],b[2]=a[2]-h[2],S[0]=b[0]*Math.cos(y)-b[1]*Math.sin(y),S[1]=b[0]*Math.sin(y)+b[1]*Math.cos(y),S[2]=b[2],f[0]=S[0]+h[0],f[1]=S[1]+h[1],f[2]=S[2]+h[2],f},_.bH=function(f,a,h,y){var b=[],S=[];return b[0]=a[0]-h[0],b[1]=a[1]-h[1],b[2]=a[2]-h[2],S[0]=b[0],S[1]=b[1]*Math.cos(y)-b[2]*Math.sin(y),S[2]=b[1]*Math.sin(y)+b[2]*Math.cos(y),f[0]=S[0]+h[0],f[1]=S[1]+h[1],f[2]=S[2]+h[2],f},_.bI=function(f,a,h,y){var b=[],S=[];return b[0]=a[0]-h[0],b[1]=a[1]-h[1],b[2]=a[2]-h[2],S[0]=b[2]*Math.sin(y)+b[0]*Math.cos(y),S[1]=b[1],S[2]=b[2]*Math.cos(y)-b[0]*Math.sin(y),f[0]=S[0]+h[0],f[1]=S[1]+h[1],f[2]=S[2]+h[2],f},_.bJ=function(f,a,h){var y=Math.sin(h),b=Math.cos(h),S=a[0],E=a[1],k=a[2],F=a[3],V=a[8],H=a[9],Y=a[10],K=a[11];return a!==f&&(f[4]=a[4],f[5]=a[5],f[6]=a[6],f[7]=a[7],f[12]=a[12],f[13]=a[13],f[14]=a[14],f[15]=a[15]),f[0]=S*b-V*y,f[1]=E*b-H*y,f[2]=k*b-Y*y,f[3]=F*b-K*y,f[8]=S*y+V*b,f[9]=E*y+H*b,f[10]=k*y+Y*b,f[11]=F*y+K*b,f},_.bK=function(f,a){const h=Ye(f,360),y=Ye(a,360),b=y-h,S=y>h?b-360:b+360;return Math.abs(b)<Math.abs(S)?b:S},_.bL=function(f){return f[0]=0,f[1]=0,f[2]=0,f},_.bM=function(f,a,h,y){const b=Math.sqrt(f*f+a*a),S=Math.sqrt(h*h+y*y);f/=b,a/=b,h/=S,y/=S;const E=Math.acos(f*h+a*y);return-a*h+f*y>0?E:-E},_.bN=function(f,a){const h=Ye(f,2*Math.PI),y=Ye(a,2*Math.PI);return Math.min(Math.abs(h-y),Math.abs(h-y+2*Math.PI),Math.abs(h-y-2*Math.PI))},_.bO=function(){const f={},a=Ke.$version;for(const h in Ke.$root){const y=Ke.$root[h];if(y.required){let b=null;b=h==="version"?a:y.type==="array"?[]:{},b!=null&&(f[h]=b)}}return f},_.bP=He,_.bQ=bd,_.bR=function f(a,h){if(Array.isArray(a)){if(!Array.isArray(h)||a.length!==h.length)return!1;for(let y=0;y<a.length;y++)if(!f(a[y],h[y]))return!1;return!0}if(typeof a=="object"&&a!==null&&h!==null){if(typeof h!="object"||Object.keys(a).length!==Object.keys(h).length)return!1;for(const y in a)if(!f(a[y],h[y]))return!1;return!0}return a===h},_.bS=function(f){f=f.slice();const a=Object.create(null);for(let h=0;h<f.length;h++)a[f[h].id]=f[h];for(let h=0;h<f.length;h++)"ref"in f[h]&&(f[h]=Tn(f[h],a[f[h].ref]));return f},_.bT=function(f,a){if(f.type==="custom")return new Pm(f,a);switch(f.type){case"background":return new In(f,a);case"circle":return new qp(f,a);case"color-relief":return new om(f,a);case"fill":return new j0(f,a);case"fill-extrusion":return new mm(f,a);case"heatmap":return new D_(f,a);case"hillshade":return new Lr(f,a);case"line":return new ym(f,a);case"raster":return new _c(f,a);case"symbol":return new Zh(f,a)}},_.bU=f=>f.type==="raster",_.bV=ra,_.bW=function(f,a){if(!f)return[{command:"setStyle",args:[a]}];let h=[];try{if(!bi(f.version,a.version))return[{command:"setStyle",args:[a]}];bi(f.center,a.center)||h.push({command:"setCenter",args:[a.center]}),bi(f.state,a.state)||h.push({command:"setGlobalState",args:[a.state]}),bi(f.centerAltitude,a.centerAltitude)||h.push({command:"setCenterAltitude",args:[a.centerAltitude]}),bi(f.zoom,a.zoom)||h.push({command:"setZoom",args:[a.zoom]}),bi(f.bearing,a.bearing)||h.push({command:"setBearing",args:[a.bearing]}),bi(f.pitch,a.pitch)||h.push({command:"setPitch",args:[a.pitch]}),bi(f.roll,a.roll)||h.push({command:"setRoll",args:[a.roll]}),bi(f.sprite,a.sprite)||h.push({command:"setSprite",args:[a.sprite]}),bi(f.glyphs,a.glyphs)||h.push({command:"setGlyphs",args:[a.glyphs]}),bi(f.transition,a.transition)||h.push({command:"setTransition",args:[a.transition]}),bi(f.light,a.light)||h.push({command:"setLight",args:[a.light]}),bi(f.terrain,a.terrain)||h.push({command:"setTerrain",args:[a.terrain]}),bi(f.sky,a.sky)||h.push({command:"setSky",args:[a.sky]}),bi(f.projection,a.projection)||h.push({command:"setProjection",args:[a.projection]});const y={},b=[];(function(E,k,F,V){let H;for(H in k=k||{},E=E||{})Object.prototype.hasOwnProperty.call(E,H)&&(Object.prototype.hasOwnProperty.call(k,H)||Bn(H,F,V));for(H in k)Object.prototype.hasOwnProperty.call(k,H)&&(Object.prototype.hasOwnProperty.call(E,H)?bi(E[H],k[H])||(E[H].type==="geojson"&&k[H].type==="geojson"&&Kr(E,k,H)?ki(F,{command:"setGeoJSONSourceData",args:[H,k[H].data]}):er(H,k,F,V)):qi(H,k,F))})(f.sources,a.sources,b,y);const S=[];f.layers&&f.layers.forEach((E=>{"source"in E&&y[E.source]?h.push({command:"removeLayer",args:[E.id]}):S.push(E)})),h=h.concat(b),(function(E,k,F){k=k||[];const V=(E=E||[]).map(tr),H=k.map(tr),Y=E.reduce($i,{}),K=k.reduce($i,{}),te=V.slice(),oe=Object.create(null);let le,ue,xe,De,we;for(let Ee=0,Ne=0;Ee<V.length;Ee++)le=V[Ee],Object.prototype.hasOwnProperty.call(K,le)?Ne++:(ki(F,{command:"removeLayer",args:[le]}),te.splice(te.indexOf(le,Ne),1));for(let Ee=0,Ne=0;Ee<H.length;Ee++)le=H[H.length-1-Ee],te[te.length-1-Ee]!==le&&(Object.prototype.hasOwnProperty.call(Y,le)?(ki(F,{command:"removeLayer",args:[le]}),te.splice(te.lastIndexOf(le,te.length-Ne),1)):Ne++,De=te[te.length-Ee],ki(F,{command:"addLayer",args:[K[le],De]}),te.splice(te.length-Ee,0,le),oe[le]=!0);for(let Ee=0;Ee<H.length;Ee++)if(le=H[Ee],ue=Y[le],xe=K[le],!oe[le]&&!bi(ue,xe))if(bi(ue.source,xe.source)&&bi(ue["source-layer"],xe["source-layer"])&&bi(ue.type,xe.type)){for(we in es(ue.layout,xe.layout,F,le,null,"setLayoutProperty"),es(ue.paint,xe.paint,F,le,null,"setPaintProperty"),bi(ue.filter,xe.filter)||ki(F,{command:"setFilter",args:[le,xe.filter]}),bi(ue.minzoom,xe.minzoom)&&bi(ue.maxzoom,xe.maxzoom)||ki(F,{command:"setLayerZoomRange",args:[le,xe.minzoom,xe.maxzoom]}),ue)Object.prototype.hasOwnProperty.call(ue,we)&&we!=="layout"&&we!=="paint"&&we!=="filter"&&we!=="metadata"&&we!=="minzoom"&&we!=="maxzoom"&&(we.indexOf("paint.")===0?es(ue[we],xe[we],F,le,we.slice(6),"setPaintProperty"):bi(ue[we],xe[we])||ki(F,{command:"setLayerProperty",args:[le,we,xe[we]]}));for(we in xe)Object.prototype.hasOwnProperty.call(xe,we)&&!Object.prototype.hasOwnProperty.call(ue,we)&&we!=="layout"&&we!=="paint"&&we!=="filter"&&we!=="metadata"&&we!=="minzoom"&&we!=="maxzoom"&&(we.indexOf("paint.")===0?es(ue[we],xe[we],F,le,we.slice(6),"setPaintProperty"):bi(ue[we],xe[we])||ki(F,{command:"setLayerProperty",args:[le,we,xe[we]]}))}else ki(F,{command:"removeLayer",args:[le]}),De=te[te.lastIndexOf(le)+1],ki(F,{command:"addLayer",args:[xe,De]})})(S,a.layers,h)}catch(y){console.warn("Unable to compute style diff:",y),h=[{command:"setStyle",args:[a]}]}return h},_.bX=function(f){const a=[],h=f.id;return h===void 0&&a.push({message:`layers.${h}: missing required property "id"`}),f.render===void 0&&a.push({message:`layers.${h}: missing required method "render"`}),f.renderingMode&&f.renderingMode!=="2d"&&f.renderingMode!=="3d"&&a.push({message:`layers.${h}: property "renderingMode" must be either "2d" or "3d"`}),a},_.bY=Co,_.bZ=Oa,_.b_=class extends Hr{constructor(f,a){super(f,a),this.current=0}set(f){this.current!==f&&(this.current=f,this.gl.uniform1i(this.location,f))}},_.ba=function(f,a,h){return f[0]=a[0]*h,f[1]=a[1]*h,f[2]=a[2]*h,f[3]=a[3]*h,f},_.bb=function(f,a){return f[0]*a[0]+f[1]*a[1]+f[2]*a[2]+f[3]},_.bc=K_,_.bd=Wd,_.be=function(f,a,h,y,b){var S=1/Math.tan(a/2);if(f[0]=S/h,f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=S,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[11]=-1,f[12]=0,f[13]=0,f[15]=0,b!=null&&b!==1/0){var E=1/(y-b);f[10]=(b+y)*E,f[14]=2*b*y*E}else f[10]=-1,f[14]=-2*y;return f},_.bf=function(f){var a=new Be(16);return a[0]=f[0],a[1]=f[1],a[2]=f[2],a[3]=f[3],a[4]=f[4],a[5]=f[5],a[6]=f[6],a[7]=f[7],a[8]=f[8],a[9]=f[9],a[10]=f[10],a[11]=f[11],a[12]=f[12],a[13]=f[13],a[14]=f[14],a[15]=f[15],a},_.bg=function(f,a,h){var y=Math.sin(h),b=Math.cos(h),S=a[0],E=a[1],k=a[2],F=a[3],V=a[4],H=a[5],Y=a[6],K=a[7];return a!==f&&(f[8]=a[8],f[9]=a[9],f[10]=a[10],f[11]=a[11],f[12]=a[12],f[13]=a[13],f[14]=a[14],f[15]=a[15]),f[0]=S*b+V*y,f[1]=E*b+H*y,f[2]=k*b+Y*y,f[3]=F*b+K*y,f[4]=V*b-S*y,f[5]=H*b-E*y,f[6]=Y*b-k*y,f[7]=K*b-F*y,f},_.bh=function(f,a,h){var y=Math.sin(h),b=Math.cos(h),S=a[4],E=a[5],k=a[6],F=a[7],V=a[8],H=a[9],Y=a[10],K=a[11];return a!==f&&(f[0]=a[0],f[1]=a[1],f[2]=a[2],f[3]=a[3],f[12]=a[12],f[13]=a[13],f[14]=a[14],f[15]=a[15]),f[4]=S*b+V*y,f[5]=E*b+H*y,f[6]=k*b+Y*y,f[7]=F*b+K*y,f[8]=V*b-S*y,f[9]=H*b-E*y,f[10]=Y*b-k*y,f[11]=K*b-F*y,f},_.bi=function(){const f=new Float32Array(16);return Rt(f),f},_.bj=function(){const f=new Float64Array(16);return Rt(f),f},_.bk=function(){return new Float64Array(16)},_.bl=function(f,a,h){const y=new Float64Array(4);return nt(y,f,a-90,h),y},_.bm=function(f,a,h,y){var b,S,E,k,F,V=a[0],H=a[1],Y=a[2],K=a[3],te=h[0],oe=h[1],le=h[2],ue=h[3];return(S=V*te+H*oe+Y*le+K*ue)<0&&(S=-S,te=-te,oe=-oe,le=-le,ue=-ue),1-S>$e?(b=Math.acos(S),E=Math.sin(b),k=Math.sin((1-y)*b)/E,F=Math.sin(y*b)/E):(k=1-y,F=y),f[0]=k*V+F*te,f[1]=k*H+F*oe,f[2]=k*Y+F*le,f[3]=k*K+F*ue,f},_.bn=function(f){const a=new Float64Array(9);var h,y,b,S,E,k,F,V,H,Y,K,te,oe,le,ue,xe,De,we;Y=(b=(y=f)[0])*(F=b+b),K=(S=y[1])*F,oe=(E=y[2])*F,le=E*(V=S+S),xe=(k=y[3])*F,De=k*V,we=k*(H=E+E),(h=a)[0]=1-(te=S*V)-(ue=E*H),h[3]=K-we,h[6]=oe+De,h[1]=K+we,h[4]=1-Y-ue,h[7]=le-xe,h[2]=oe-De,h[5]=le+xe,h[8]=1-Y-te;const Ee=ao(-Math.asin(Vi(a[2],-1,1)));let Ne,Ze;return Math.hypot(a[5],a[8])<.001?(Ne=0,Ze=-ao(Math.atan2(a[3],a[4]))):(Ne=ao(a[5]===0&&a[8]===0?0:Math.atan2(a[5],a[8])),Ze=ao(a[1]===0&&a[0]===0?0:Math.atan2(a[1],a[0]))),{roll:Ne,pitch:Ee+90,bearing:Ze}},_.bo=function(f,a){return f.roll==a.roll&&f.pitch==a.pitch&&f.bearing==a.bearing},_.bp=Qi,_.bq=ua,_.br=Zo,_.bs=Hl,_.bt=ta,_.bu=Gt,_.bv=vi,_.bw=Is,_.bx=function(f,a,h,y,b){return Gt(y,b,Vi((f-a)/(h-a),0,1))},_.by=function(f,a,h,y){return f[0]=a[0]+h[0]*y,f[1]=a[1]+h[1]*y,f[2]=a[2]+h[2]*y,f},_.bz=Ye,_.c=fe,_.c$=class{constructor(f){this._marks={start:[f.url,"start"].join("#"),end:[f.url,"end"].join("#"),measure:f.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let f=performance.getEntriesByName(this._marks.measure);return f.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),f=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),f}},_.c0=class extends Hr{constructor(f,a){super(f,a),this.current=Xa}set(f){if(f[12]!==this.current[12]||f[0]!==this.current[0])return this.current=f,void this.gl.uniformMatrix4fv(this.location,!1,f);for(let a=1;a<16;a++)if(f[a]!==this.current[a]){this.current=f,this.gl.uniformMatrix4fv(this.location,!1,f);break}}},_.c1=Wl,_.c2=class extends Hr{constructor(f,a){super(f,a),this.current=[0,0,0]}set(f){f[0]===this.current[0]&&f[1]===this.current[1]&&f[2]===this.current[2]||(this.current=f,this.gl.uniform3f(this.location,f[0],f[1],f[2]))}},_.c3=class extends Hr{constructor(f,a){super(f,a),this.current=[0,0]}set(f){f[0]===this.current[0]&&f[1]===this.current[1]||(this.current=f,this.gl.uniform2f(this.location,f[0],f[1]))}},_.c4=Je,_.c5=function(f,a){var h=Math.sin(a),y=Math.cos(a);return f[0]=y,f[1]=h,f[2]=0,f[3]=-h,f[4]=y,f[5]=0,f[6]=0,f[7]=0,f[8]=1,f},_.c6=function(f,a,h){var y=a[0],b=a[1],S=a[2];return f[0]=y*h[0]+b*h[3]+S*h[6],f[1]=y*h[1]+b*h[4]+S*h[7],f[2]=y*h[2]+b*h[5]+S*h[8],f},_.c7=function(f,a,h,y,b,S,E){var k=1/(a-h),F=1/(y-b),V=1/(S-E);return f[0]=-2*k,f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=-2*F,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[10]=2*V,f[11]=0,f[12]=(a+h)*k,f[13]=(b+y)*F,f[14]=(E+S)*V,f[15]=1,f},_.c8=class extends Hr{constructor(f,a){super(f,a),this.current=new Array}set(f){if(f!=this.current){this.current=f;const a=new Float32Array(4*f.length);for(let h=0;h<f.length;h++)a[4*h]=f[h].r,a[4*h+1]=f[h].g,a[4*h+2]=f[h].b,a[4*h+3]=f[h].a;this.gl.uniform4fv(this.location,a)}}},_.c9=class extends Hr{constructor(f,a){super(f,a),this.current=new Array}set(f){if(f!=this.current){this.current=f;const a=new Float32Array(f);this.gl.uniform1fv(this.location,a)}}},_.cA=function(f,a){var h;if(!Qo[a])return!1;const y=f==null?void 0:f.target,b=((h=y==null?void 0:y.ownerDocument)===null||h===void 0?void 0:h.defaultView)||window;return f instanceof b.MouseEvent||f instanceof b.WheelEvent},_.cB=function(f,a){return nc[a]&&"touches"in f},_.cC=function(f){return nc[f]||Qo[f]},_.cD=function(f,a,h){var y=a[0],b=a[1];return f[0]=h[0]*y+h[4]*b+h[12],f[1]=h[1]*y+h[5]*b+h[13],f},_.cE=function(f,a){const{x:h,y}=Jn.fromLngLat(a);return!(f<0||f>25||y<0||y>=1||h<0||h>=1)},_.cF=function(f,a){return f[0]=a[0],f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=a[1],f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[10]=a[2],f[11]=0,f[12]=0,f[13]=0,f[14]=0,f[15]=1,f},_.cG=class extends qc{},_.cH=d3,_.cJ=Fe,_.cK=function(f,a){fe.REGISTERED_PROTOCOLS[f]=a},_.cL=function(f){delete fe.REGISTERED_PROTOCOLS[f]},_.cM=function(f,a){const h={};for(let b=0;b<f.length;b++){const S=a&&a[f[b].id]||al(f[b]);a&&(a[f[b].id]=S);let E=h[S];E||(E=h[S]=[]),E.push(f[b])}const y=[];for(const b in h)y.push(h[b]);return y},_.cN=yi,_.cO=Om,_.cP=Jm,_.cQ=lg,_.cR=function(f){var a;f.bucket.createArrays(),f.bucket.tilePixelRatio=li/(512*f.bucket.overscaling),f.bucket.compareText={},f.bucket.iconsNeedLinear=!1;const h=f.bucket.layers[0],y=h.layout,b=h._unevaluatedLayout._values,S={layoutIconSize:b["icon-size"].possiblyEvaluate(new Un(f.bucket.zoom+1),f.canonical),layoutTextSize:b["text-size"].possiblyEvaluate(new Un(f.bucket.zoom+1),f.canonical),textMaxSize:b["text-size"].possiblyEvaluate(new Un(18))};if(f.bucket.textSizeData.kind==="composite"){const{minZoom:H,maxZoom:Y}=f.bucket.textSizeData;S.compositeTextSizes=[b["text-size"].possiblyEvaluate(new Un(H),f.canonical),b["text-size"].possiblyEvaluate(new Un(Y),f.canonical)]}if(f.bucket.iconSizeData.kind==="composite"){const{minZoom:H,maxZoom:Y}=f.bucket.iconSizeData;S.compositeIconSizes=[b["icon-size"].possiblyEvaluate(new Un(H),f.canonical),b["icon-size"].possiblyEvaluate(new Un(Y),f.canonical)]}const E=y.get("text-line-height")*Bs,k=y.get("text-rotation-alignment")!=="viewport"&&y.get("symbol-placement")!=="point",F=y.get("text-keep-upright"),V=y.get("text-size");for(const H of f.bucket.features){const Y=y.get("text-font").evaluate(H,{},f.canonical).join(","),K=V.evaluate(H,{},f.canonical),te=S.layoutTextSize.evaluate(H,{},f.canonical),oe=S.layoutIconSize.evaluate(H,{},f.canonical),le={horizontal:{},vertical:void 0},ue=H.text;let xe,De=[0,0];if(ue){const Ne=ue.toString(),Ze=y.get("text-letter-spacing").evaluate(H,{},f.canonical)*Bs,yt=Sh(Ne)?Ze:0,Bt=y.get("text-anchor").evaluate(H,{},f.canonical),Dt=Pc(h,H,f.canonical);if(!Dt){const Ot=y.get("text-radial-offset").evaluate(H,{},f.canonical);De=Ot?Gn(Bt,[Ot*Bs,An]):y.get("text-offset").evaluate(H,{},f.canonical).map((Ct=>Ct*Bs))}let jt=k?"center":y.get("text-justify").evaluate(H,{},f.canonical);const ai=y.get("symbol-placement")==="point"?y.get("text-max-width").evaluate(H,{},f.canonical)*Bs:1/0,Qt=()=>{f.bucket.allowVerticalPlacement&&zl(Ne)&&(le.vertical=Q0(ue,f.glyphMap,f.glyphPositions,f.imagePositions,Y,ai,E,Bt,"left",yt,De,_.az.vertical,!0,te,K))};if(!k&&Dt){const Ot=new Set;if(jt==="auto")for(let _i=0;_i<Dt.values.length;_i+=2)Ot.add(Qm(Dt.values[_i]));else Ot.add(jt);let Ct=!1;for(const _i of Ot)if(!le.horizontal[_i])if(Ct)le.horizontal[_i]=le.horizontal[0];else{const pi=Q0(ue,f.glyphMap,f.glyphPositions,f.imagePositions,Y,ai,E,"center",_i,yt,De,_.az.horizontal,!1,te,K);pi&&(le.horizontal[_i]=pi,Ct=pi.positionedLines.length===1)}Qt()}else{jt==="auto"&&(jt=Qm(Bt));const Ot=Q0(ue,f.glyphMap,f.glyphPositions,f.imagePositions,Y,ai,E,Bt,jt,yt,De,_.az.horizontal,!1,te,K);Ot&&(le.horizontal[jt]=Ot),Qt(),zl(Ne)&&k&&F&&(le.vertical=Q0(ue,f.glyphMap,f.glyphPositions,f.imagePositions,Y,ai,E,Bt,jt,yt,De,_.az.vertical,!1,te,K))}}let we=!1;if(H.icon&&H.icon.name){const Ne=f.imageMap[H.icon.name];Ne&&(xe=Sm(f.imagePositions[H.icon.name],y.get("icon-offset").evaluate(H,{},f.canonical),y.get("icon-anchor").evaluate(H,{},f.canonical)),we=!!Ne.sdf,f.bucket.sdfIcons===void 0?f.bucket.sdfIcons=we:f.bucket.sdfIcons!==we&&br("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ne.pixelRatio!==f.bucket.pixelRatio||y.get("icon-rotate").constantOr(1)!==0)&&(f.bucket.iconsNeedLinear=!0))}const Ee=z1(le.horizontal)||le.vertical;(a=f.bucket).iconsInText||(a.iconsInText=!!Ee&&Ee.iconsInText),(Ee||xe)&&N1(f.bucket,H,le,xe,f.imageMap,S,te,oe,De,we,f.canonical,f.subdivisionGranularity)}f.showCollisionBoxes&&f.bucket.generateCollisionDebugBuffers()},_.cS=Sc,_.cT=Lh,_.cU=Fd,_.cV=function(f){const a=new ag;return(function(h,y){for(const b in h.layers)y.writeMessage(3,Rg,h.layers[b])})(f,a),a.finish()},_.cW=function(f,a,h,y,b,S){let E=m(f,a,h,b,0);return E=m(E,a,y,S,1),E},_.cX=class{constructor(f){this.maxEntries=f,this.map=new Map}get(f){const a=this.map.get(f);return a!==void 0&&(this.map.delete(f),this.map.set(f,a)),a}set(f,a){if(this.map.has(f))this.map.delete(f);else if(this.map.size>=this.maxEntries){const h=this.map.keys().next().value;this.map.delete(h)}this.map.set(f,a)}clear(){this.map.clear()}},_.cY=hn,_.cZ=ag,_.c_=_p,_.ca=class extends jl{},_.cb=B_,_.cc=class extends Mr{},_.cd=k0,_.ce=function(f){return f<=1?1:Math.pow(2,Math.ceil(Math.log(f)/Math.LN2))},_.cf=tu,_.cg=function(f,a,h){var y=a[0],b=a[1],S=a[2],E=h[3]*y+h[7]*b+h[11]*S+h[15];return f[0]=(h[0]*y+h[4]*b+h[8]*S+h[12])/(E=E||1),f[1]=(h[1]*y+h[5]*b+h[9]*S+h[13])/E,f[2]=(h[2]*y+h[6]*b+h[10]*S+h[14])/E,f},_.ch=class extends Yc{},_.ci=class extends s{},_.cj=function(f,a){return f[0]===a[0]&&f[1]===a[1]&&f[2]===a[2]&&f[3]===a[3]&&f[4]===a[4]&&f[5]===a[5]&&f[6]===a[6]&&f[7]===a[7]&&f[8]===a[8]&&f[9]===a[9]&&f[10]===a[10]&&f[11]===a[11]&&f[12]===a[12]&&f[13]===a[13]&&f[14]===a[14]&&f[15]===a[15]},_.ck=function(f,a){var h=f[0],y=f[1],b=f[2],S=f[3],E=f[4],k=f[5],F=f[6],V=f[7],H=f[8],Y=f[9],K=f[10],te=f[11],oe=f[12],le=f[13],ue=f[14],xe=f[15],De=a[0],we=a[1],Ee=a[2],Ne=a[3],Ze=a[4],yt=a[5],Bt=a[6],Dt=a[7],jt=a[8],ai=a[9],Qt=a[10],Ot=a[11],Ct=a[12],_i=a[13],pi=a[14],Ti=a[15];return Math.abs(h-De)<=$e*Math.max(1,Math.abs(h),Math.abs(De))&&Math.abs(y-we)<=$e*Math.max(1,Math.abs(y),Math.abs(we))&&Math.abs(b-Ee)<=$e*Math.max(1,Math.abs(b),Math.abs(Ee))&&Math.abs(S-Ne)<=$e*Math.max(1,Math.abs(S),Math.abs(Ne))&&Math.abs(E-Ze)<=$e*Math.max(1,Math.abs(E),Math.abs(Ze))&&Math.abs(k-yt)<=$e*Math.max(1,Math.abs(k),Math.abs(yt))&&Math.abs(F-Bt)<=$e*Math.max(1,Math.abs(F),Math.abs(Bt))&&Math.abs(V-Dt)<=$e*Math.max(1,Math.abs(V),Math.abs(Dt))&&Math.abs(H-jt)<=$e*Math.max(1,Math.abs(H),Math.abs(jt))&&Math.abs(Y-ai)<=$e*Math.max(1,Math.abs(Y),Math.abs(ai))&&Math.abs(K-Qt)<=$e*Math.max(1,Math.abs(K),Math.abs(Qt))&&Math.abs(te-Ot)<=$e*Math.max(1,Math.abs(te),Math.abs(Ot))&&Math.abs(oe-Ct)<=$e*Math.max(1,Math.abs(oe),Math.abs(Ct))&&Math.abs(le-_i)<=$e*Math.max(1,Math.abs(le),Math.abs(_i))&&Math.abs(ue-pi)<=$e*Math.max(1,Math.abs(ue),Math.abs(pi))&&Math.abs(xe-Ti)<=$e*Math.max(1,Math.abs(xe),Math.abs(Ti))},_.cl=function(f,a){return f[0]=a[0],f[1]=a[1],f[2]=a[2],f[3]=a[3],f[4]=a[4],f[5]=a[5],f[6]=a[6],f[7]=a[7],f[8]=a[8],f[9]=a[9],f[10]=a[10],f[11]=a[11],f[12]=a[12],f[13]=a[13],f[14]=a[14],f[15]=a[15],f},_.cm=f=>f.type==="symbol",_.cn=f=>f.type==="circle",_.co=f=>f.type==="heatmap",_.cp=f=>f.type==="line",_.cq=f=>f.type==="fill",_.cr=f=>f.type==="fill-extrusion",_.cs=f=>f.type==="hillshade",_.ct=f=>f.type==="color-relief",_.cu=f=>f.type==="background",_.cv=f=>f.type==="custom",_.cw=Si,_.cx=function(f,a,h){if(a<=0)return f;const y=1/a;return h===void 0||Math.abs(h)<1e-10?Math.round(f*y)/y:(h>0?Math.ceil(f*y-1e-9):Math.floor(f*y+1e-10))/y},_.cy=function(f,a,h){const y=mi(a.x-h.x,a.y-h.y),b=mi(f.x-h.x,f.y-h.y);var S,E;return ao(Math.atan2(y[0]*b[1]-y[1]*b[0],(S=y)[0]*(E=b)[0]+S[1]*E[1]))},_.cz=Li,_.d=xt,_.d0=function(f,a,h,y,b){return l(this,void 0,void 0,(function*(){if(Le())try{return yield Nc(f,a,h,y,b)}catch{}return(function(S,E,k,F,V){const H=S.width,Y=S.height;Po&&ic||(Po=new OffscreenCanvas(H,Y),ic=Po.getContext("2d",{willReadFrequently:!0})),Po.width=H,Po.height=Y,ic.drawImage(S,0,0,H,Y);const K=ic.getImageData(E,k,F,V);return ic.clearRect(0,0,H,Y),K.data})(f,a,h,y,b)}))},_.d1=Pd,_.d2=D,_.d3=class{constructor(f,a){this.layers={[yp]:this},this.name=yp,this.version=a?a.version:1,this.extent=a?a.extent:4096,this.length=f.length,this.features=f}feature(f){return new hy(this.features[f],this.extent)}},_.d4=Mu,_.d5=Br,_.e=Kn,_.f=f=>l(void 0,void 0,void 0,(function*(){if(f.byteLength===0)return createImageBitmap(new ImageData(1,1));const a=new Blob([new Uint8Array(f)],{type:"image/png"});try{return createImageBitmap(a)}catch(h){throw new Error(`Could not load image because of ${h.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),_.g=ge,_.h=f=>new Promise(((a,h)=>{const y=new Image;y.onload=()=>{a(y),URL.revokeObjectURL(y.src),y.onload=null,window.requestAnimationFrame((()=>{y.src=Fc}))},y.onerror=()=>h(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const b=new Blob([new Uint8Array(f)],{type:"image/png"});y.src=f.byteLength?URL.createObjectURL(b):Fc})),_.i=Na,_.j=(f,a)=>st(Kn(f,{type:"json"}),a),_.k=Pt,_.l=zt,_.m=st,_.n=(f,a)=>st(Kn(f,{type:"arrayBuffer"}),a),_.o=function(f){return new ag(f).readFields(W_,[])},_.p=wm,_.q=function(f){return/[\u02EA\u02EB\u1100-\u11FF\u2E80-\u2FDF\u3000-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(f))},_.r=I0,_.s=so,_.t=Er,_.u=Ke,_.v=Mf,_.w=br,_.x=Ad,_.y=ol,_.z=mc})),o("worker",["./shared"],(function(_){class l{constructor(fe,ge){this.keyCache={},fe&&this.replace(fe,ge)}replace(fe,ge){this._layerConfigs={},this._layers={},this.update(fe,[],ge)}update(fe,ge,ve){for(const He of fe){this._layerConfigs[He.id]=He;const st=this._layers[He.id]=_.bT(He,ve);st._featureFilter=_.aj(st.filter,ve),this.keyCache[He.id]&&delete this.keyCache[He.id]}for(const He of ge)delete this.keyCache[He],delete this._layerConfigs[He],delete this._layers[He];this.familiesBySource={};const Fe=_.cM(Object.values(this._layerConfigs),this.keyCache);for(const He of Fe){const st=He.map((qt=>this._layers[qt.id])),xt=st[0];if(xt.isHidden())continue;const Qe=xt.source||"";let ht=this.familiesBySource[Qe];ht||(ht=this.familiesBySource[Qe]={});const zt=xt.sourceLayer||_.ai;let Pt=ht[zt];Pt||(Pt=ht[zt]=[]),Pt.push(st)}}}class M{constructor(fe){const ge={},ve=[];for(const xt in fe){const Qe=fe[xt],ht=ge[xt]={};for(const zt in Qe){const Pt=Qe[+zt];if(!Pt||Pt.bitmap.width===0||Pt.bitmap.height===0)continue;const qt={x:0,y:0,w:Pt.bitmap.width+2,h:Pt.bitmap.height+2};ve.push(qt),ht[zt]={rect:qt,metrics:Pt.metrics}}}const{w:Fe,h:He}=_.p(ve),st=new _.r({width:Fe||1,height:He||1});for(const xt in fe){const Qe=fe[xt];for(const ht in Qe){const zt=Qe[+ht];if(!zt||zt.bitmap.width===0||zt.bitmap.height===0)continue;const Pt=ge[xt][ht].rect;_.r.copy(zt.bitmap,st,{x:0,y:0},{x:Pt.x+1,y:Pt.y+1},zt.bitmap)}}this.image=st,this.positions=ge}}_.cN("GlyphAtlas",M);class D{constructor(fe){this.tileID=new _.a2(fe.tileID.overscaledZ,fe.tileID.wrap,fe.tileID.canonical.z,fe.tileID.canonical.x,fe.tileID.canonical.y),this.uid=fe.uid,this.zoom=fe.zoom,this.pixelRatio=fe.pixelRatio,this.tileSize=fe.tileSize,this.source=fe.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=fe.showCollisionBoxes,this.collectResourceTiming=!!fe.collectResourceTiming,this.returnDependencies=!!fe.returnDependencies,this.promoteId=fe.promoteId,this.inFlightDependencies=[]}parse(fe,ge,ve,Fe,He){return _._(this,void 0,void 0,(function*(){this.status="parsing",this.data=fe,this.collisionBoxArray=new _.ag;const st=new _.cO(Object.keys(fe.layers).sort()),xt=new _.cP(this.tileID,this.promoteId);xt.bucketLayerIDs=[];const Qe={},ht={featureIndex:xt,iconDependencies:{},patternDependencies:{},glyphDependencies:{},dashDependencies:{},availableImages:ve,subdivisionGranularity:He},zt=ge.familiesBySource[this.source];for(const Vt in zt){const Ar=fe.layers[Vt];if(!Ar)continue;Ar.version===1&&_.w(`Vector tile source "${this.source}" layer "${Vt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Cs=st.encode(Vt),ts=[];for(let vn=0;vn<Ar.length;vn++){const ei=Ar.feature(vn),Xi=xt.getId(ei,Vt);ts.push({feature:ei,id:Xi,index:vn,sourceLayerIndex:Cs})}for(const vn of zt[Vt]){const ei=vn[0];ei.source!==this.source&&_.w(`layer.source = ${ei.source} does not equal this.source = ${this.source}`),ei.isHidden(this.zoom,!0)||(B(vn,this.zoom,ve),(Qe[ei.id]=ei.createBucket({index:xt.bucketLayerIDs.length,layers:vn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Cs,sourceID:this.source})).populate(ts,ht,this.tileID.canonical),xt.bucketLayerIDs.push(vn.map((Xi=>Xi.id))))}}const Pt=_.bY(ht.glyphDependencies,(Vt=>Object.keys(Vt).map(Number)));this.inFlightDependencies.forEach((Vt=>Vt==null?void 0:Vt.abort())),this.inFlightDependencies=[];let qt=Promise.resolve({});if(Object.keys(Pt).length){const Vt=new AbortController;this.inFlightDependencies.push(Vt),qt=Fe.sendAsync({type:"GG",data:{stacks:Pt,source:this.source,tileID:this.tileID,type:"glyphs"}},Vt)}const Ke=Object.keys(ht.iconDependencies);let Oi=Promise.resolve({});if(Ke.length){const Vt=new AbortController;this.inFlightDependencies.push(Vt),Oi=Fe.sendAsync({type:"GI",data:{icons:Ke,source:this.source,tileID:this.tileID,type:"icons"}},Vt)}const Tn=Object.keys(ht.patternDependencies);let bi=Promise.resolve({});if(Tn.length){const Vt=new AbortController;this.inFlightDependencies.push(Vt),bi=Fe.sendAsync({type:"GI",data:{icons:Tn,source:this.source,tileID:this.tileID,type:"patterns"}},Vt)}const ki=ht.dashDependencies;let qi=Promise.resolve({});if(Object.keys(ki).length){const Vt=new AbortController;this.inFlightDependencies.push(Vt),qi=Fe.sendAsync({type:"GDA",data:{dashes:ki}},Vt)}const[Bn,er,Kr,es]=yield Promise.all([qt,Oi,bi,qi]),tr=new M(Bn),$i=new _.cQ(er,Kr);for(const Vt in Qe){const Ar=Qe[Vt];Ar instanceof _.ah?(B(Ar.layers,this.zoom,ve),_.cR({bucket:Ar,glyphMap:Bn,glyphPositions:tr.positions,imageMap:er,imagePositions:$i.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:ht.subdivisionGranularity})):Ar.hasDependencies&&(Ar instanceof _.cS||Ar instanceof _.cT||Ar instanceof _.cU)&&(B(Ar.layers,this.zoom,ve),Ar.addFeatures(ht,this.tileID.canonical,$i.patternPositions,es))}return this.status="done",{buckets:Object.values(Qe).filter((Vt=>!Vt.isEmpty())),featureIndex:xt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:tr.image,imageAtlas:$i,dashPositions:es,glyphMap:this.returnDependencies?Bn:null,iconMap:this.returnDependencies?er:null,glyphPositions:this.returnDependencies?tr.positions:null}}))}}function B(it,fe,ge){const ve=new _.H(fe);for(const Fe of it)Fe.recalculate(ve,ge)}class j{constructor(fe,ge,ve,Fe,He){this.type=fe,this.properties=ve||{},this.extent=He,this.pointsArray=ge,this.id=Fe}loadGeometry(){return this.pointsArray.map((fe=>fe.map((ge=>new _.P(ge.x,ge.y)))))}}class ${constructor(fe,ge,ve){this.version=2,this._myFeatures=fe,this.name=ge,this.length=fe.length,this.extent=ve}feature(fe){return this._myFeatures[fe]}}class se{constructor(){this.layers={}}addLayer(fe){this.layers[fe.name]=fe}}function de(it){let fe=_.cV(it);return fe.byteOffset===0&&fe.byteLength===fe.buffer.byteLength||(fe=new Uint8Array(fe)),{vectorTile:it,rawData:fe.buffer}}function Ae(it,fe,ge){const{extent:ve}=it,Fe=Math.pow(2,ge.z-fe.z),He=(ge.x-fe.x*Fe)*ve,st=(ge.y-fe.y*Fe)*ve,xt=[];for(let Qe=0;Qe<it.length;Qe++){const ht=it.feature(Qe);let zt=ht.loadGeometry();for(const qt of zt)for(const Ke of qt)Ke.x=Ke.x*Fe-He,Ke.y=Ke.y*Fe-st;const Pt=128;zt=_.cW(zt,ht.type,-Pt,-Pt,ve+Pt,ve+Pt),zt.length!==0&&xt.push(new j(ht.type,zt,ht.properties,ht.id,ve))}return new $(xt,it.name,ve)}class he{constructor(fe,ge,ve){this.actor=fe,this.layerIndex=ge,this.availableImages=ve,this.fetching={},this.loading={},this.loaded={},this.overzoomedTileResultCache=new _.cX(1e3)}loadVectorTile(fe,ge){return _._(this,void 0,void 0,(function*(){const ve=yield _.n(fe.request,ge);try{return{vectorTile:fe.encoding!=="mlt"?new _.cY(new _.cZ(ve.data)):new _.c_(ve.data),rawData:ve.data,cacheControl:ve.cacheControl,expires:ve.expires}}catch(Fe){const He=new Uint8Array(ve.data);let st=`Unable to parse the tile at ${fe.request.url}, `;throw st+=He[0]===31&&He[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${Fe.message}`,new Error(st)}}))}loadTile(fe){return _._(this,void 0,void 0,(function*(){const{uid:ge,overzoomParameters:ve}=fe;ve&&(fe.request=ve.overzoomRequest);const Fe=!!(fe&&fe.request&&fe.request.collectResourceTiming)&&new _.c$(fe.request),He=new D(fe);this.loading[ge]=He;const st=new AbortController;He.abort=st;try{const xt=yield this.loadVectorTile(fe,st);if(delete this.loading[ge],!xt)return null;if(ve){const qt=this._getOverzoomTile(fe,xt.vectorTile);xt.rawData=qt.rawData,xt.vectorTile=qt.vectorTile}const Qe=xt.rawData,ht={};xt.expires&&(ht.expires=xt.expires),xt.cacheControl&&(ht.cacheControl=xt.cacheControl);const zt={};if(Fe){const qt=Fe.finish();qt&&(zt.resourceTiming=JSON.parse(JSON.stringify(qt)))}He.vectorTile=xt.vectorTile;const Pt=He.parse(xt.vectorTile,this.layerIndex,this.availableImages,this.actor,fe.subdivisionGranularity);this.loaded[ge]=He,this.fetching[ge]={rawTileData:Qe,cacheControl:ht,resourceTiming:zt};try{const qt=yield Pt;return _.e({rawTileData:Qe.slice(0),encoding:fe.encoding},qt,ht,zt)}finally{delete this.fetching[ge]}}catch(xt){throw delete this.loading[ge],He.status="done",this.loaded[ge]=He,xt}}))}_getOverzoomTile(fe,ge){const{tileID:ve,source:Fe,overzoomParameters:He}=fe,{maxZoomTileID:st}=He,xt=`${st.key}_${ve.key}`,Qe=this.overzoomedTileResultCache.get(xt);if(Qe)return Qe;const ht=new se,zt=this.layerIndex.familiesBySource[Fe];for(const qt in zt){const Ke=ge.layers[qt];if(!Ke)continue;const Oi=Ae(Ke,st,ve.canonical);Oi.length>0&&ht.addLayer(Oi)}const Pt=de(ht);return this.overzoomedTileResultCache.set(xt,Pt),Pt}reloadTile(fe){return _._(this,void 0,void 0,(function*(){const ge=fe.uid;if(!this.loaded||!this.loaded[ge])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const ve=this.loaded[ge];if(ve.showCollisionBoxes=fe.showCollisionBoxes,ve.status==="parsing"){const Fe=yield ve.parse(ve.vectorTile,this.layerIndex,this.availableImages,this.actor,fe.subdivisionGranularity);let He;if(this.fetching[ge]){const{rawTileData:st,cacheControl:xt,resourceTiming:Qe}=this.fetching[ge];delete this.fetching[ge],He=_.e({rawTileData:st.slice(0),encoding:fe.encoding},Fe,xt,Qe)}else He=Fe;return He}if(ve.status==="done"&&ve.vectorTile)return ve.parse(ve.vectorTile,this.layerIndex,this.availableImages,this.actor,fe.subdivisionGranularity)}))}abortTile(fe){return _._(this,void 0,void 0,(function*(){const ge=this.loading,ve=fe.uid;ge&&ge[ve]&&ge[ve].abort&&(ge[ve].abort.abort(),delete ge[ve])}))}removeTile(fe){return _._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[fe.uid]&&delete this.loaded[fe.uid]}))}}class Le{constructor(){this.loaded={}}loadTile(fe){return _._(this,void 0,void 0,(function*(){const{uid:ge,encoding:ve,rawImageData:Fe,redFactor:He,greenFactor:st,blueFactor:xt,baseShift:Qe}=fe,ht=Fe.width+2,zt=Fe.height+2,Pt=_.b(Fe)?new _.R({width:ht,height:zt},yield _.d0(Fe,-1,-1,ht,zt)):Fe,qt=new _.d1(ge,Pt,ve,He,st,xt,Qe);return this.loaded=this.loaded||{},this.loaded[ge]=qt,qt}))}removeTile(fe){const ge=this.loaded,ve=fe.uid;ge&&ge[ve]&&delete ge[ve]}}var $e,Be,Je=(function(){if(Be)return $e;function it(ge,ve){if(ge.length!==0){fe(ge[0],ve);for(var Fe=1;Fe<ge.length;Fe++)fe(ge[Fe],!ve)}}function fe(ge,ve){for(var Fe=0,He=0,st=0,xt=ge.length,Qe=xt-1;st<xt;Qe=st++){var ht=(ge[st][0]-ge[Qe][0])*(ge[Qe][1]+ge[st][1]),zt=Fe+ht;He+=Math.abs(Fe)>=Math.abs(ht)?Fe-zt+ht:ht-zt+Fe,Fe=zt}Fe+He>=0!=!!ve&&ge.reverse()}return Be=1,$e=function ge(ve,Fe){var He,st=ve&&ve.type;if(st==="FeatureCollection")for(He=0;He<ve.features.length;He++)ge(ve.features[He],Fe);else if(st==="GeometryCollection")for(He=0;He<ve.geometries.length;He++)ge(ve.geometries[He],Fe);else if(st==="Feature")ge(ve.geometry,Fe);else if(st==="Polygon")it(ve.coordinates,Fe);else if(st==="MultiPolygon")for(He=0;He<ve.coordinates.length;He++)it(ve.coordinates[He],Fe);return ve}})(),Rt=_.d2(Je);const Et={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:it=>it},kt=Math.fround||(Ht=new Float32Array(1),it=>(Ht[0]=+it,Ht[0]));var Ht;class Xt{constructor(fe){this.options=Object.assign(Object.create(Et),fe),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(fe){const{log:ge,minZoom:ve,maxZoom:Fe}=this.options;ge&&console.time("total time");const He=`prepare ${fe.length} points`;ge&&console.time(He),this.points=fe;const st=[];for(let Qe=0;Qe<fe.length;Qe++){const ht=fe[Qe];if(!ht.geometry)continue;const[zt,Pt]=ht.geometry.coordinates,qt=kt(Ei(zt)),Ke=kt(Ii(Pt));st.push(qt,Ke,1/0,Qe,-1,1),this.options.reduce&&st.push(0)}let xt=this.trees[Fe+1]=this._createTree(st);ge&&console.timeEnd(He);for(let Qe=Fe;Qe>=ve;Qe--){const ht=+Date.now();xt=this.trees[Qe]=this._createTree(this._cluster(xt,Qe)),ge&&console.log("z%d: %d clusters in %dms",Qe,xt.numItems,+Date.now()-ht)}return ge&&console.timeEnd("total time"),this}getClusters(fe,ge){let ve=((fe[0]+180)%360+360)%360-180;const Fe=Math.max(-90,Math.min(90,fe[1]));let He=fe[2]===180?180:((fe[2]+180)%360+360)%360-180;const st=Math.max(-90,Math.min(90,fe[3]));if(fe[2]-fe[0]>=360)ve=-180,He=180;else if(ve>He){const Pt=this.getClusters([ve,Fe,180,st],ge),qt=this.getClusters([-180,Fe,He,st],ge);return Pt.concat(qt)}const xt=this.trees[this._limitZoom(ge)],Qe=xt.range(Ei(ve),Ii(st),Ei(He),Ii(Fe)),ht=xt.data,zt=[];for(const Pt of Qe){const qt=this.stride*Pt;zt.push(ht[qt+5]>1?hi(ht,qt,this.clusterProps):this.points[ht[qt+3]])}return zt}getChildren(fe){const ge=this._getOriginId(fe),ve=this._getOriginZoom(fe),Fe="No cluster with the specified id.",He=this.trees[ve];if(!He)throw new Error(Fe);const st=He.data;if(ge*this.stride>=st.length)throw new Error(Fe);const xt=this.options.radius/(this.options.extent*Math.pow(2,ve-1)),Qe=He.within(st[ge*this.stride],st[ge*this.stride+1],xt),ht=[];for(const zt of Qe){const Pt=zt*this.stride;st[Pt+4]===fe&&ht.push(st[Pt+5]>1?hi(st,Pt,this.clusterProps):this.points[st[Pt+3]])}if(ht.length===0)throw new Error(Fe);return ht}getLeaves(fe,ge,ve){const Fe=[];return this._appendLeaves(Fe,fe,ge=ge||10,ve=ve||0,0),Fe}getTile(fe,ge,ve){const Fe=this.trees[this._limitZoom(fe)],He=Math.pow(2,fe),{extent:st,radius:xt}=this.options,Qe=xt/st,ht=(ve-Qe)/He,zt=(ve+1+Qe)/He,Pt={features:[]};return this._addTileFeatures(Fe.range((ge-Qe)/He,ht,(ge+1+Qe)/He,zt),Fe.data,ge,ve,He,Pt),ge===0&&this._addTileFeatures(Fe.range(1-Qe/He,ht,1,zt),Fe.data,He,ve,He,Pt),ge===He-1&&this._addTileFeatures(Fe.range(0,ht,Qe/He,zt),Fe.data,-1,ve,He,Pt),Pt.features.length?Pt:null}getClusterExpansionZoom(fe){let ge=this._getOriginZoom(fe)-1;for(;ge<=this.options.maxZoom;){const ve=this.getChildren(fe);if(ge++,ve.length!==1)break;fe=ve[0].properties.cluster_id}return ge}_appendLeaves(fe,ge,ve,Fe,He){const st=this.getChildren(ge);for(const xt of st){const Qe=xt.properties;if(Qe&&Qe.cluster?He+Qe.point_count<=Fe?He+=Qe.point_count:He=this._appendLeaves(fe,Qe.cluster_id,ve,Fe,He):He<Fe?He++:fe.push(xt),fe.length===ve)break}return He}_createTree(fe){const ge=new _.aT(fe.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ve=0;ve<fe.length;ve+=this.stride)ge.add(fe[ve],fe[ve+1]);return ge.finish(),ge.data=fe,ge}_addTileFeatures(fe,ge,ve,Fe,He,st){for(const xt of fe){const Qe=xt*this.stride,ht=ge[Qe+5]>1;let zt,Pt,qt;if(ht)zt=di(ge,Qe,this.clusterProps),Pt=ge[Qe],qt=ge[Qe+1];else{const Tn=this.points[ge[Qe+3]];zt=Tn.properties;const[bi,ki]=Tn.geometry.coordinates;Pt=Ei(bi),qt=Ii(ki)}const Ke={type:1,geometry:[[Math.round(this.options.extent*(Pt*He-ve)),Math.round(this.options.extent*(qt*He-Fe))]],tags:zt};let Oi;Oi=ht||this.options.generateId?ge[Qe+3]:this.points[ge[Qe+3]].id,Oi!==void 0&&(Ke.id=Oi),st.features.push(Ke)}}_limitZoom(fe){return Math.max(this.options.minZoom,Math.min(Math.floor(+fe),this.options.maxZoom+1))}_cluster(fe,ge){const{radius:ve,extent:Fe,reduce:He,minPoints:st}=this.options,xt=ve/(Fe*Math.pow(2,ge)),Qe=fe.data,ht=[],zt=this.stride;for(let Pt=0;Pt<Qe.length;Pt+=zt){if(Qe[Pt+2]<=ge)continue;Qe[Pt+2]=ge;const qt=Qe[Pt],Ke=Qe[Pt+1],Oi=fe.within(Qe[Pt],Qe[Pt+1],xt),Tn=Qe[Pt+5];let bi=Tn;for(const ki of Oi){const qi=ki*zt;Qe[qi+2]>ge&&(bi+=Qe[qi+5])}if(bi>Tn&&bi>=st){let ki,qi=qt*Tn,Bn=Ke*Tn,er=-1;const Kr=(Pt/zt<<5)+(ge+1)+this.points.length;for(const es of Oi){const tr=es*zt;if(Qe[tr+2]<=ge)continue;Qe[tr+2]=ge;const $i=Qe[tr+5];qi+=Qe[tr]*$i,Bn+=Qe[tr+1]*$i,Qe[tr+4]=Kr,He&&(ki||(ki=this._map(Qe,Pt,!0),er=this.clusterProps.length,this.clusterProps.push(ki)),He(ki,this._map(Qe,tr)))}Qe[Pt+4]=Kr,ht.push(qi/bi,Bn/bi,1/0,Kr,-1,bi),He&&ht.push(er)}else{for(let ki=0;ki<zt;ki++)ht.push(Qe[Pt+ki]);if(bi>1)for(const ki of Oi){const qi=ki*zt;if(!(Qe[qi+2]<=ge)){Qe[qi+2]=ge;for(let Bn=0;Bn<zt;Bn++)ht.push(Qe[qi+Bn])}}}}return ht}_getOriginId(fe){return fe-this.points.length>>5}_getOriginZoom(fe){return(fe-this.points.length)%32}_map(fe,ge,ve){if(fe[ge+5]>1){const st=this.clusterProps[fe[ge+6]];return ve?Object.assign({},st):st}const Fe=this.points[fe[ge+3]].properties,He=this.options.map(Fe);return ve&&He===Fe?Object.assign({},He):He}}function hi(it,fe,ge){return{type:"Feature",id:it[fe+3],properties:di(it,fe,ge),geometry:{type:"Point",coordinates:[(ve=it[fe],360*(ve-.5)),fi(it[fe+1])]}};var ve}function di(it,fe,ge){const ve=it[fe+5],Fe=ve>=1e4?`${Math.round(ve/1e3)}k`:ve>=1e3?Math.round(ve/100)/10+"k":ve,He=it[fe+6],st=He===-1?{}:Object.assign({},ge[He]);return Object.assign(st,{cluster:!0,cluster_id:it[fe+3],point_count:ve,point_count_abbreviated:Fe})}function Ei(it){return it/360+.5}function Ii(it){const fe=Math.sin(it*Math.PI/180),ge=.5-.25*Math.log((1+fe)/(1-fe))/Math.PI;return ge<0?0:ge>1?1:ge}function fi(it){const fe=(180-360*it)*Math.PI/180;return 360*Math.atan(Math.exp(fe))/Math.PI-90}function Ui(it,fe,ge,ve){let Fe=ve;const He=fe+(ge-fe>>1);let st,xt=ge-fe;const Qe=it[fe],ht=it[fe+1],zt=it[ge],Pt=it[ge+1];for(let qt=fe+3;qt<ge;qt+=3){const Ke=nt(it[qt],it[qt+1],Qe,ht,zt,Pt);if(Ke>Fe)st=qt,Fe=Ke;else if(Ke===Fe){const Oi=Math.abs(qt-He);Oi<xt&&(st=qt,xt=Oi)}}Fe>ve&&(st-fe>3&&Ui(it,fe,st,ve),it[st+2]=Fe,ge-st>3&&Ui(it,st,ge,ve))}function nt(it,fe,ge,ve,Fe,He){let st=Fe-ge,xt=He-ve;if(st!==0||xt!==0){const Qe=((it-ge)*st+(fe-ve)*xt)/(st*st+xt*xt);Qe>1?(ge=Fe,ve=He):Qe>0&&(ge+=st*Qe,ve+=xt*Qe)}return st=it-ge,xt=fe-ve,st*st+xt*xt}function Ut(it,fe,ge,ve){const Fe={type:fe,geom:ge},He={id:it??null,type:Fe.type,geometry:Fe.geom,tags:ve,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};switch(Fe.type){case"Point":case"MultiPoint":case"LineString":mi(He,Fe.geom);break;case"Polygon":mi(He,Fe.geom[0]);break;case"MultiLineString":for(const st of Fe.geom)mi(He,st);break;case"MultiPolygon":for(const st of Fe.geom)mi(He,st[0])}return He}function mi(it,fe){for(let ge=0;ge<fe.length;ge+=3)it.minX=Math.min(it.minX,fe[ge]),it.minY=Math.min(it.minY,fe[ge+1]),it.maxX=Math.max(it.maxX,fe[ge]),it.maxY=Math.max(it.maxY,fe[ge+1])}function li(it,fe){const ge=[];switch(it.type){case"FeatureCollection":for(let ve=0;ve<it.features.length;ve++)Wi(ge,it.features[ve],fe,ve);break;case"Feature":Wi(ge,it,fe);break;default:Wi(ge,{geometry:it,properties:void 0},fe)}return ge}function Wi(it,fe,ge,ve){var xt;if(!fe.geometry)return;if(fe.geometry.type==="GeometryCollection"){for(const Qe of fe.geometry.geometries)Wi(it,{id:fe.id,geometry:Qe,properties:fe.properties},ge,ve);return}const Fe=fe.geometry.coordinates;if(!(Fe!=null&&Fe.length))return;const He=Math.pow(ge.tolerance/((1<<ge.maxZoom)*ge.extent),2);let st=fe.id;switch(ge.promoteId?st=(xt=fe.properties)==null?void 0:xt[ge.promoteId]:ge.generateId&&(st=ve||0),fe.geometry.type){case"Point":{const Qe=[];return Ye(fe.geometry.coordinates,Qe),void it.push(Ut(st,fe.geometry.type,Qe,fe.properties))}case"MultiPoint":{const Qe=[];for(const ht of fe.geometry.coordinates)Ye(ht,Qe);return void it.push(Ut(st,fe.geometry.type,Qe,fe.properties))}case"LineString":{const Qe=[];return Gt(fe.geometry.coordinates,Qe,He,!1),void it.push(Ut(st,fe.geometry.type,Qe,fe.properties))}case"MultiLineString":{if(ge.lineMetrics){for(const ht of fe.geometry.coordinates){const zt=[];Gt(ht,zt,He,!1),it.push(Ut(st,"LineString",zt,fe.properties))}return}const Qe=[];return vi(fe.geometry.coordinates,Qe,He,!1),void it.push(Ut(st,fe.geometry.type,Qe,fe.properties))}case"Polygon":{const Qe=[];return vi(fe.geometry.coordinates,Qe,He,!0),void it.push(Ut(st,fe.geometry.type,Qe,fe.properties))}case"MultiPolygon":{const Qe=[];for(const ht of fe.geometry.coordinates){const zt=[];vi(ht,zt,He,!0),Qe.push(zt)}return void it.push(Ut(st,fe.geometry.type,Qe,fe.properties))}default:throw new Error("Input data is not a valid GeoJSON object.")}}function Ye(it,fe){fe.push(Si(it[0]),Li(it[1]),0)}function Gt(it,fe,ge,ve){let Fe,He,st=0;for(let Qe=0;Qe<it.length;Qe++){const ht=Si(it[Qe][0]),zt=Li(it[Qe][1]);fe.push(ht,zt,0),Qe>0&&(st+=ve?(Fe*zt-ht*He)/2:Math.sqrt(Math.pow(ht-Fe,2)+Math.pow(zt-He,2))),Fe=ht,He=zt}const xt=fe.length-3;fe[2]=1,ge>0&&Ui(fe,0,xt,ge),fe[xt+2]=1,fe.size=Math.abs(st),fe.start=0,fe.end=fe.size}function vi(it,fe,ge,ve){for(let Fe=0;Fe<it.length;Fe++){const He=[];Gt(it[Fe],He,ge,ve),fe.push(He)}}function Si(it){return it/360+.5}function Li(it){const fe=Math.sin(it*Math.PI/180),ge=.5-.25*Math.log((1+fe)/(1-fe))/Math.PI;return ge<0?0:ge>1?1:ge}function Vi(it,fe,ge,ve,Fe,He,st,xt){if(ve/=fe,He>=(ge/=fe)&&st<ve)return it;if(st<ge||He>=ve)return null;const Qe=[];for(const ht of it){const zt=Fe===0?ht.minX:ht.minY,Pt=Fe===0?ht.maxX:ht.maxY;if(zt>=ge&&Pt<ve)Qe.push(ht);else if(!(Pt<ge||zt>=ve))switch(ht.type){case"Point":case"MultiPoint":{const qt=[];if(yn(ht.geometry,qt,ge,ve,Fe),!qt.length)continue;Qe.push(Ut(ht.id,qt.length===3?"Point":"MultiPoint",qt,ht.tags));continue}case"LineString":{const qt=[];if(Kn(ht.geometry,qt,ge,ve,Fe,!1,xt.lineMetrics),!qt.length)continue;if(xt.lineMetrics){for(const Ke of qt)Qe.push(Ut(ht.id,ht.type,Ke,ht.tags));continue}if(qt.length>1){Qe.push(Ut(ht.id,"MultiLineString",qt,ht.tags));continue}Qe.push(Ut(ht.id,ht.type,qt[0],ht.tags));continue}case"MultiLineString":{const qt=[];if(Co(ht.geometry,qt,ge,ve,Fe,!1),!qt.length)continue;if(qt.length===1){Qe.push(Ut(ht.id,"LineString",qt[0],ht.tags));continue}Qe.push(Ut(ht.id,ht.type,qt,ht.tags));continue}case"Polygon":{const qt=[];if(Co(ht.geometry,qt,ge,ve,Fe,!0),!qt.length)continue;Qe.push(Ut(ht.id,ht.type,qt,ht.tags));continue}case"MultiPolygon":{const qt=[];for(const Ke of ht.geometry){const Oi=[];Co(Ke,Oi,ge,ve,Fe,!0),Oi.length&&qt.push(Oi)}if(!qt.length)continue;Qe.push(Ut(ht.id,ht.type,qt,ht.tags));continue}}}return Qe.length?Qe:null}function yn(it,fe,ge,ve,Fe){for(let He=0;He<it.length;He+=3){const st=it[He+Fe];st>=ge&&st<=ve&&Oa(fe,it[He],it[He+1],it[He+2])}}function Kn(it,fe,ge,ve,Fe,He,st){let xt=mr(it);const Qe=Fe===0?ra:uh;let ht,zt,Pt=it.start;for(let bi=0;bi<it.length-3;bi+=3){const ki=it[bi],qi=it[bi+1],Bn=it[bi+2],er=it[bi+3],Kr=it[bi+4],es=Fe===0?ki:qi,tr=Fe===0?er:Kr;let $i=!1;st&&(ht=Math.sqrt(Math.pow(ki-er,2)+Math.pow(qi-Kr,2))),es<ge?tr>ge&&(zt=Qe(xt,ki,qi,er,Kr,ge),st&&(xt.start=Pt+ht*zt)):es>ve?tr<ve&&(zt=Qe(xt,ki,qi,er,Kr,ve),st&&(xt.start=Pt+ht*zt)):Oa(xt,ki,qi,Bn),tr<ge&&es>=ge&&(zt=Qe(xt,ki,qi,er,Kr,ge),$i=!0),tr>ve&&es<=ve&&(zt=Qe(xt,ki,qi,er,Kr,ve),$i=!0),!He&&$i&&(st&&(xt.end=Pt+ht*zt),fe.push(xt),xt=mr(it)),st&&(Pt+=ht)}let qt=it.length-3;const Ke=it[qt],Oi=it[qt+1],Tn=Fe===0?Ke:Oi;Tn>=ge&&Tn<=ve&&Oa(xt,Ke,Oi,it[qt+2]),qt=xt.length-3,He&&qt>=3&&(xt[qt]!==xt[0]||xt[qt+1]!==xt[1])&&Oa(xt,xt[0],xt[1],xt[2]),xt.length&&fe.push(xt)}function mr(it){const fe=[];return fe.size=it.size,fe.start=it.start,fe.end=it.end,fe}function Co(it,fe,ge,ve,Fe,He){for(const st of it)Kn(st,fe,ge,ve,Fe,He,!1)}function Oa(it,fe,ge,ve){it.push(fe,ge,ve)}function ra(it,fe,ge,ve,Fe,He){const st=(He-fe)/(ve-fe);return Oa(it,He,ge+(Fe-ge)*st,1),st}function uh(it,fe,ge,ve,Fe,He){const st=(He-ge)/(Fe-ge);return Oa(it,fe+(ve-fe)*st,He,1),st}function br(it,fe){const ge=fe.buffer/fe.extent;let ve=it;const Fe=Vi(it,1,-1-ge,ge,0,-1,2,fe),He=Vi(it,1,1-ge,2+ge,0,-1,2,fe);return(Fe||He)&&(ve=Vi(it,1,-ge,1+ge,0,-1,2,fe)||[],Fe&&(ve=Fa(Fe,1).concat(ve)),He&&(ve=ve.concat(Fa(He,-1)))),ve}function Fa(it,fe){const ge=[];for(const ve of it)switch(ve.type){case"Point":case"MultiPoint":case"LineString":{const Fe=Na(ve.geometry,fe);ge.push(Ut(ve.id,ve.type,Fe,ve.tags));continue}case"MultiLineString":case"Polygon":{const Fe=[];for(const He of ve.geometry)Fe.push(Na(He,fe));ge.push(Ut(ve.id,ve.type,Fe,ve.tags));continue}case"MultiPolygon":{const Fe=[];for(const He of ve.geometry){const st=[];for(const xt of He)st.push(Na(xt,fe));Fe.push(st)}ge.push(Ut(ve.id,ve.type,Fe,ve.tags));continue}}return ge}function Na(it,fe){const ge=[];ge.size=it.size,it.start!==void 0&&(ge.start=it.start,ge.end=it.end);for(let ve=0;ve<it.length;ve+=3)ge.push(it[ve]+fe,it[ve+1],it[ve+2]);return ge}function Ir(it,fe){if(it.transformed)return it;const ge=1<<it.z,ve=it.x,Fe=it.y;for(const He of it.features){if(He.type===1){const xt=[];for(let Qe=0;Qe<He.geometry.length;Qe+=2)xt.push(xl(He.geometry[Qe],He.geometry[Qe+1],fe,ge,ve,Fe));He.geometry=xt;continue}const st=[];for(const xt of He.geometry){const Qe=[];for(let ht=0;ht<xt.length;ht+=2)Qe.push(xl(xt[ht],xt[ht+1],fe,ge,ve,Fe));st.push(Qe)}He.geometry=st}return it.transformed=!0,it}function xl(it,fe,ge,ve,Fe,He){return[Math.round(ge*(it*ve-Fe)),Math.round(ge*(fe*ve-He))]}function Fc(it,fe,ge,ve,Fe){const He=fe===Fe.maxZoom?0:Fe.tolerance/((1<<fe)*Fe.extent),st={features:[],numPoints:0,numSimplified:0,numFeatures:it.length,source:null,x:ge,y:ve,z:fe,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const xt of it)Nc(st,xt,He,Fe);return st}function Nc(it,fe,ge,ve){it.minX=Math.min(it.minX,fe.minX),it.minY=Math.min(it.minY,fe.minY),it.maxX=Math.max(it.maxX,fe.maxX),it.maxY=Math.max(it.maxY,fe.maxY);let Fe,He=fe.tags||null;switch(fe.type){case"Point":case"MultiPoint":{const st=[];for(let xt=0;xt<fe.geometry.length;xt+=3)st.push(fe.geometry[xt],fe.geometry[xt+1]),it.numPoints++,it.numSimplified++;if(!st.length)return;Fe={type:1,tags:He,geometry:st};break}case"LineString":{const st=[];if(Po(st,fe.geometry,it,ge,!1,!1),!st.length)return;if(ve.lineMetrics){He={};for(const xt in fe.tags)He[xt]=fe.tags[xt];He.mapbox_clip_start=fe.geometry.start/fe.geometry.size,He.mapbox_clip_end=fe.geometry.end/fe.geometry.size}Fe={type:2,tags:He,geometry:st};break}case"MultiLineString":case"Polygon":{const st=[];for(let xt=0;xt<fe.geometry.length;xt++)Po(st,fe.geometry[xt],it,ge,fe.type==="Polygon",xt===0);if(!st.length)return;Fe={type:fe.type==="Polygon"?3:2,tags:He,geometry:st};break}case"MultiPolygon":{const st=[];for(let xt=0;xt<fe.geometry.length;xt++){const Qe=fe.geometry[xt];for(let ht=0;ht<Qe.length;ht++)Po(st,Qe[ht],it,ge,!0,ht===0)}if(!st.length)return;Fe={type:3,tags:He,geometry:st};break}}fe.id!==null&&(Fe.id=fe.id),it.features.push(Fe)}function Po(it,fe,ge,ve,Fe,He){const st=ve*ve;if(ve>0&&fe.size<(Fe?st:ve))return void(ge.numPoints+=fe.length/3);const xt=[];for(let Qe=0;Qe<fe.length;Qe+=3)(ve===0||fe[Qe+2]>st)&&(ge.numSimplified++,xt.push(fe[Qe],fe[Qe+1])),ge.numPoints++;Fe&&(function(Qe,ht){let zt=0;for(let Pt=0,qt=Qe.length,Ke=qt-2;Pt<qt;Ke=Pt,Pt+=2)zt+=(Qe[Pt]-Qe[Ke])*(Qe[Pt+1]+Qe[Ke+1]);if(zt>0===ht)for(let Pt=0,qt=Qe.length;Pt<qt/2;Pt+=2){const Ke=Qe[Pt],Oi=Qe[Pt+1];Qe[Pt]=Qe[qt-2-Pt],Qe[Pt+1]=Qe[qt-1-Pt],Qe[qt-2-Pt]=Ke,Qe[qt-1-Pt]=Oi}})(xt,He),it.push(xt)}function ic(it,fe,ge){var He,st;const ve=!!fe.newGeometry,Fe=fe.removeAllProperties||((He=fe.removeProperties)==null?void 0:He.length)>0||((st=fe.addOrUpdateProperties)==null?void 0:st.length)>0;if(ve){let xt=li({type:"FeatureCollection",features:[{type:"Feature",id:it.id,geometry:fe.newGeometry,properties:Fe?so(it.tags,fe):it.tags}]},ge);return xt=br(xt,ge),xt[0]}if(Fe){const xt={...it};return xt.tags=so(xt.tags,fe),xt}return null}function so(it,fe){if(fe.removeAllProperties)return{};const ge={...it||{}};if(fe.removeProperties)for(const ve of fe.removeProperties)delete ge[ve];if(fe.addOrUpdateProperties)for(const{key:ve,value:Fe}of fe.addOrUpdateProperties)ge[ve]=Fe;return ge}const Qr={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,updateable:!1,debug:0};class ao{constructor(fe,ge){pe(this,"options");pe(this,"tiles");pe(this,"tileCoords");pe(this,"stats",{});pe(this,"total",0);pe(this,"source");const ve=(ge=this.options=Object.assign({},Qr,ge)).debug;if(ve&&console.time("preprocess data"),ge.maxZoom<0||ge.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ge.promoteId&&ge.generateId)throw new Error("promoteId and generateId cannot be used together.");let Fe=li(fe,ge);this.tiles={},this.tileCoords=[],ve&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ge.indexMaxZoom,ge.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Fe=br(Fe,ge),Fe.length&&this.splitTile(Fe,0,0,0),ge.updateable&&(this.source=Fe),ve&&(Fe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(fe,ge,ve,Fe,He,st,xt){const Qe=[fe,ge,ve,Fe],ht=this.options,zt=ht.debug;for(;Qe.length;){Fe=Qe.pop(),ve=Qe.pop(),ge=Qe.pop(),fe=Qe.pop();const Pt=1<<ge,qt=nc(ge,ve,Fe);let Ke=this.tiles[qt];if(!Ke&&(zt>1&&console.time("creation"),Ke=this.tiles[qt]=Fc(fe,ge,ve,Fe,ht),this.tileCoords.push({z:ge,x:ve,y:Fe,id:qt}),zt)){zt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ge,ve,Fe,Ke.numFeatures,Ke.numPoints,Ke.numSimplified),console.timeEnd("creation"));const $i=`z${ge}`;this.stats[$i]=(this.stats[$i]||0)+1,this.total++}if(Ke.source=fe,He==null){if(ge===ht.indexMaxZoom||Ke.numPoints<=ht.indexMaxPoints)continue}else{if(ge===ht.maxZoom||ge===He)continue;if(He!=null){const $i=He-ge;if(ve!==st>>$i||Fe!==xt>>$i)continue}}if(Ke.source=null,!fe.length)continue;zt>1&&console.time("clipping");const Oi=.5*ht.buffer/ht.extent,Tn=.5-Oi,bi=.5+Oi,ki=1+Oi;let qi=null,Bn=null,er=null,Kr=null;const es=Vi(fe,Pt,ve-Oi,ve+bi,0,Ke.minX,Ke.maxX,ht),tr=Vi(fe,Pt,ve+Tn,ve+ki,0,Ke.minX,Ke.maxX,ht);es&&(qi=Vi(es,Pt,Fe-Oi,Fe+bi,1,Ke.minY,Ke.maxY,ht),Bn=Vi(es,Pt,Fe+Tn,Fe+ki,1,Ke.minY,Ke.maxY,ht)),tr&&(er=Vi(tr,Pt,Fe-Oi,Fe+bi,1,Ke.minY,Ke.maxY,ht),Kr=Vi(tr,Pt,Fe+Tn,Fe+ki,1,Ke.minY,Ke.maxY,ht)),zt>1&&console.timeEnd("clipping"),Qe.push(qi||[],ge+1,2*ve,2*Fe),Qe.push(Bn||[],ge+1,2*ve,2*Fe+1),Qe.push(er||[],ge+1,2*ve+1,2*Fe),Qe.push(Kr||[],ge+1,2*ve+1,2*Fe+1)}}getTile(fe,ge,ve){fe=+fe,ge=+ge,ve=+ve;const Fe=this.options,{extent:He,debug:st}=Fe;if(fe<0||fe>24)return null;const xt=1<<fe,Qe=nc(fe,ge=ge+xt&xt-1,ve);if(this.tiles[Qe])return Ir(this.tiles[Qe],He);st>1&&console.log("drilling down to z%d-%d-%d",fe,ge,ve);let ht,zt=fe,Pt=ge,qt=ve;for(;!ht&&zt>0;)zt--,Pt>>=1,qt>>=1,ht=this.tiles[nc(zt,Pt,qt)];return ht!=null&&ht.source?(st>1&&(console.log("found parent tile z%d-%d-%d",zt,Pt,qt),console.time("drilling down")),this.splitTile(ht.source,zt,Pt,qt,fe,ge,ve),st>1&&console.timeEnd("drilling down"),this.tiles[Qe]?Ir(this.tiles[Qe],He):null):null}invalidateTiles(fe){const ge=this.options,{debug:ve}=ge;let Fe=1/0,He=-1/0,st=1/0,xt=-1/0;for(const zt of fe)Fe=Math.min(Fe,zt.minX),He=Math.max(He,zt.maxX),st=Math.min(st,zt.minY),xt=Math.max(xt,zt.maxY);const Qe=ge.buffer/ge.extent,ht=new Set;for(const zt in this.tiles){const Pt=this.tiles[zt],qt=1<<Pt.z,Ke=(Pt.x-Qe)/qt,Oi=(Pt.x+1+Qe)/qt,Tn=(Pt.y-Qe)/qt,bi=(Pt.y+1+Qe)/qt;if(He<Ke||Fe>=Oi||xt<Tn||st>=bi)continue;let ki=!1;for(const qi of fe)if(qi.maxX>=Ke&&qi.minX<Oi&&qi.maxY>=Tn&&qi.minY<bi){ki=!0;break}if(ki){if(ve){ve>1&&console.log("invalidate tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Pt.z,Pt.x,Pt.y,Pt.numFeatures,Pt.numPoints,Pt.numSimplified);const qi=`z${Pt.z}`;this.stats[qi]=(this.stats[qi]||0)-1,this.total--}delete this.tiles[zt],ht.add(zt)}}ht.size&&(this.tileCoords=this.tileCoords.filter((zt=>!ht.has(zt.id))))}updateData(fe){const ge=this.options,ve=ge.debug;if(!ge.updateable)throw new Error("to update tile geojson `updateable` option must be set to true");const{affected:Fe,source:He}=(function(Pt,qt,Ke){const Oi=(function(bi){var ki,qi;return bi?{removeAll:bi.removeAll,remove:new Set(bi.remove||[]),add:new Map((ki=bi.add)==null?void 0:ki.map((Bn=>[Bn.id,Bn]))),update:new Map((qi=bi.update)==null?void 0:qi.map((Bn=>[Bn.id,Bn])))}:{remove:new Set,add:new Map,update:new Map}})(qt);let Tn=[];if(Oi.removeAll&&(Tn=Pt,Pt=[]),Oi.remove.size||Oi.add.size){const bi=[];for(const ki of Pt){const{id:qi}=ki;(Oi.remove.has(qi)||Oi.add.has(qi))&&bi.push(ki)}if(bi.length){Tn.push(...bi);const ki=new Set(bi.map((qi=>qi.id)));Pt=Pt.filter((qi=>!ki.has(qi.id)))}if(Oi.add.size){let ki=li({type:"FeatureCollection",features:Array.from(Oi.add.values())},Ke);ki=br(ki,Ke),Tn.push(...ki),Pt.push(...ki)}}if(Oi.update.size)for(const[bi,ki]of Oi.update){const qi=Pt.findIndex((Kr=>Kr.id===bi));if(qi===-1)continue;const Bn=Pt[qi],er=ic(Bn,ki,Ke);er&&(Tn.push(Bn,er),Pt[qi]=er)}return{affected:Tn,source:Pt}})(this.source,fe,ge);if(!Fe.length)return;this.source=He,ve>1&&(console.log("invalidating tiles"),console.time("invalidating")),this.invalidateTiles(Fe),ve>1&&console.timeEnd("invalidating");const[st,xt,Qe]=[0,0,0],ht=Fc(this.source,st,xt,Qe,this.options);ht.source=this.source;const zt=nc(st,xt,Qe);if(this.tiles[zt]=ht,this.tileCoords.push({z:st,x:xt,y:Qe,id:zt}),ve){const Pt=`z${st}`;this.stats[Pt]=(this.stats[Pt]||0)+1,this.total++}}}function nc(it,fe,ge){return 32*((1<<it)*ge+fe)+it}class Qo extends he{constructor(fe,ge,ve,Fe=Ls){super(fe,ge,ve),this._dataUpdateable=new Map,this._createGeoJSONIndex=Fe}loadVectorTile(fe,ge){return _._(this,void 0,void 0,(function*(){const ve=fe.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const Fe=this._geoJSONIndex.getTile(ve.z,ve.x,ve.y);return Fe?de(new _.d3(Fe.features,{version:2,extent:_.a5})):null}))}loadData(fe){return _._(this,void 0,void 0,(function*(){var ge;(ge=this._pendingRequest)===null||ge===void 0||ge.abort();const ve=this._startPerformance(fe);this._pendingRequest=new AbortController;try{(!this._pendingData||fe.request||fe.data||fe.dataDiff)&&(this._pendingData=this.loadAndProcessGeoJSON(fe,this._pendingRequest));const Fe=yield this._pendingData;this._geoJSONIndex=this._createGeoJSONIndex(Fe,fe),this.loaded={};const He={};return fe.request&&(He.data=Fe),this._finishPerformance(ve,fe,He),He}catch(Fe){if(delete this._pendingRequest,_.Z(Fe))return{abandoned:!0};throw Fe}}))}_startPerformance(fe){var ge;if(!((ge=fe==null?void 0:fe.request)===null||ge===void 0)&&ge.collectResourceTiming)return new _.c$(fe.request)}_finishPerformance(fe,ge,ve){if(!fe)return;const Fe=fe.finish();Fe&&(ve.resourceTiming={},ve.resourceTiming[ge.source]=JSON.parse(JSON.stringify(Fe)))}getData(){return _._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(fe){const ge=this.loaded;return ge&&ge[fe.uid]?super.reloadTile(fe):this.loadTile(fe)}loadAndProcessGeoJSON(fe,ge){return _._(this,void 0,void 0,(function*(){let ve;if(fe.request?ve=yield this.loadGeoJSONFromUrl(fe.request,fe.promoteId,ge):fe.data?ve=this._loadGeoJSONFromObject(fe.data,fe.promoteId):fe.dataDiff&&(ve=this._loadGeoJSONFromDiff(fe.dataDiff,fe.promoteId,fe.source)),delete this._pendingRequest,typeof ve!="object")throw new Error(`Input data given to '${fe.source}' is not a valid GeoJSON object.`);return Rt(ve,!0),fe.filter&&(ve=this._filterGeoJSON(ve,fe.filter)),ve}))}loadGeoJSONFromUrl(fe,ge,ve){return _._(this,void 0,void 0,(function*(){const Fe=yield _.j(fe,ve);return this._dataUpdateable=_.a7(Fe.data,ge),Fe.data}))}_loadGeoJSONFromObject(fe,ge){return this._dataUpdateable=_.a7(fe,ge),fe}_loadGeoJSONFromDiff(fe,ge,ve){if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${ve}`);_.a8(this._dataUpdateable,fe,ge);const Fe=Array.from(this._dataUpdateable.values());return this._toFeatureCollection(Fe)}_filterGeoJSON(fe,ge){const ve=_.d4(ge,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ve.result==="error")throw new Error(ve.value.map((He=>`${He.key}: ${He.message}`)).join(", "));const Fe=fe.features.filter((He=>ve.value.evaluate({zoom:0},He)));return this._toFeatureCollection(Fe)}_toFeatureCollection(fe){return{type:"FeatureCollection",features:fe}}removeSource(fe){return _._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(fe){return this._geoJSONIndex.getClusterExpansionZoom(fe.clusterId)}getClusterChildren(fe){return this._geoJSONIndex.getChildren(fe.clusterId)}getClusterLeaves(fe){return this._geoJSONIndex.getLeaves(fe.clusterId,fe.limit,fe.offset)}}function Ls(it,fe){return fe.cluster?new Xt((function({superclusterOptions:ge,clusterProperties:ve}){if(!ve||!ge)return ge;const Fe={},He={},st={accumulated:null,zoom:0},xt={properties:null},Qe=Object.keys(ve);for(const ht of Qe){const[zt,Pt]=ve[ht],qt=_.d4(Pt),Ke=_.d4(typeof zt=="string"?[zt,["accumulated"],["get",ht]]:zt);Fe[ht]=qt.value,He[ht]=Ke.value}return ge.map=ht=>{xt.properties=ht;const zt={};for(const Pt of Qe)zt[Pt]=Fe[Pt].evaluate(st,xt);return zt},ge.reduce=(ht,zt)=>{xt.properties=zt;for(const Pt of Qe)st.accumulated=ht[Pt],ht[Pt]=He[Pt].evaluate(st,xt)},ge})(fe)).load(it.features):(function(ge,ve){return new ao(ge,ve)})(it,fe.geojsonVtOptions)}class hh{constructor(fe){this.self=fe,this.actor=new _.L(fe),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.globalStates=new Map,this.self.registerWorkerSource=(ge,ve)=>{if(this.externalWorkerSourceTypes[ge])throw new Error(`Worker source with name "${ge}" already registered.`);this.externalWorkerSourceTypes[ge]=ve},this.self.addProtocol=_.cK,this.self.removeProtocol=_.cL,this.self.registerRTLTextPlugin=ge=>{_.d5.setMethods(ge)},this.actor.registerMessageHandler("LDT",((ge,ve)=>this._getDEMWorkerSource(ge,ve.source).loadTile(ve))),this.actor.registerMessageHandler("RDT",((ge,ve)=>_._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(ge,ve.source).removeTile(ve)})))),this.actor.registerMessageHandler("GCEZ",((ge,ve)=>_._(this,void 0,void 0,(function*(){return this._getWorkerSource(ge,ve.type,ve.source).getClusterExpansionZoom(ve)})))),this.actor.registerMessageHandler("GCC",((ge,ve)=>_._(this,void 0,void 0,(function*(){return this._getWorkerSource(ge,ve.type,ve.source).getClusterChildren(ve)})))),this.actor.registerMessageHandler("GCL",((ge,ve)=>_._(this,void 0,void 0,(function*(){return this._getWorkerSource(ge,ve.type,ve.source).getClusterLeaves(ve)})))),this.actor.registerMessageHandler("LD",((ge,ve)=>this._getWorkerSource(ge,ve.type,ve.source).loadData(ve))),this.actor.registerMessageHandler("GD",((ge,ve)=>this._getWorkerSource(ge,ve.type,ve.source).getData())),this.actor.registerMessageHandler("LT",((ge,ve)=>this._getWorkerSource(ge,ve.type,ve.source).loadTile(ve))),this.actor.registerMessageHandler("RT",((ge,ve)=>this._getWorkerSource(ge,ve.type,ve.source).reloadTile(ve))),this.actor.registerMessageHandler("AT",((ge,ve)=>this._getWorkerSource(ge,ve.type,ve.source).abortTile(ve))),this.actor.registerMessageHandler("RMT",((ge,ve)=>this._getWorkerSource(ge,ve.type,ve.source).removeTile(ve))),this.actor.registerMessageHandler("RS",((ge,ve)=>_._(this,void 0,void 0,(function*(){if(!this.workerSources[ge]||!this.workerSources[ge][ve.type]||!this.workerSources[ge][ve.type][ve.source])return;const Fe=this.workerSources[ge][ve.type][ve.source];delete this.workerSources[ge][ve.type][ve.source],Fe.removeSource!==void 0&&Fe.removeSource(ve)})))),this.actor.registerMessageHandler("RM",(ge=>_._(this,void 0,void 0,(function*(){delete this.layerIndexes[ge],delete this.availableImages[ge],delete this.workerSources[ge],delete this.demWorkerSources[ge],this.globalStates.delete(ge)})))),this.actor.registerMessageHandler("SR",((ge,ve)=>_._(this,void 0,void 0,(function*(){this.referrer=ve})))),this.actor.registerMessageHandler("SRPS",((ge,ve)=>this._syncRTLPluginState(ge,ve))),this.actor.registerMessageHandler("IS",((ge,ve)=>_._(this,void 0,void 0,(function*(){this.self.importScripts(ve)})))),this.actor.registerMessageHandler("SI",((ge,ve)=>this._setImages(ge,ve))),this.actor.registerMessageHandler("UL",((ge,ve)=>_._(this,void 0,void 0,(function*(){this._getLayerIndex(ge).update(ve.layers,ve.removedIds,this._getGlobalState(ge))})))),this.actor.registerMessageHandler("UGS",((ge,ve)=>_._(this,void 0,void 0,(function*(){const Fe=this._getGlobalState(ge);for(const He in ve)Fe[He]=ve[He]})))),this.actor.registerMessageHandler("SL",((ge,ve)=>_._(this,void 0,void 0,(function*(){this._getLayerIndex(ge).replace(ve,this._getGlobalState(ge))}))))}_getGlobalState(fe){let ge=this.globalStates.get(fe);return ge||(ge={},this.globalStates.set(fe,ge)),ge}_setImages(fe,ge){return _._(this,void 0,void 0,(function*(){this.availableImages[fe]=ge;for(const ve in this.workerSources[fe]){const Fe=this.workerSources[fe][ve];for(const He in Fe)Fe[He].availableImages=ge}}))}_syncRTLPluginState(fe,ge){return _._(this,void 0,void 0,(function*(){return yield _.d5.syncState(ge,this.self.importScripts)}))}_getAvailableImages(fe){let ge=this.availableImages[fe];return ge||(ge=[]),ge}_getLayerIndex(fe){let ge=this.layerIndexes[fe];return ge||(ge=this.layerIndexes[fe]=new l),ge}_getWorkerSource(fe,ge,ve){if(this.workerSources[fe]||(this.workerSources[fe]={}),this.workerSources[fe][ge]||(this.workerSources[fe][ge]={}),!this.workerSources[fe][ge][ve]){const Fe={sendAsync:(He,st)=>(He.targetMapId=fe,this.actor.sendAsync(He,st))};switch(ge){case"vector":this.workerSources[fe][ge][ve]=new he(Fe,this._getLayerIndex(fe),this._getAvailableImages(fe));break;case"geojson":this.workerSources[fe][ge][ve]=new Qo(Fe,this._getLayerIndex(fe),this._getAvailableImages(fe));break;default:this.workerSources[fe][ge][ve]=new this.externalWorkerSourceTypes[ge](Fe,this._getLayerIndex(fe),this._getAvailableImages(fe))}}return this.workerSources[fe][ge][ve]}_getDEMWorkerSource(fe,ge){return this.demWorkerSources[fe]||(this.demWorkerSources[fe]={}),this.demWorkerSources[fe][ge]||(this.demWorkerSources[fe][ge]=new Le),this.demWorkerSources[fe][ge]}}return _.i(self)&&(self.worker=new hh(self)),hh})),o("index",["exports","./shared"],(function(_,l){var M="5.17.0";function D(){var C=new l.A(4);return l.A!=Float32Array&&(C[1]=0,C[2]=0),C[0]=1,C[3]=1,C}let B,j,$;const se={frame(C,s,g,x){const T=x||window,I=T.requestAnimationFrame((z=>{O(),s(z)})),{unsubscribe:O}=l.s(C.signal,"abort",(()=>{O(),T.cancelAnimationFrame(I),g(new l.a(C.signal.reason))}),!1)},frameAsync(C,s){return new Promise(((g,x)=>{this.frame(C,g,x,s)}))},getImageData(C,s=0){return this.getImageCanvasContext(C).getImageData(-s,-s,C.width+2*s,C.height+2*s)},getImageCanvasContext(C){const s=window.document.createElement("canvas"),g=s.getContext("2d",{willReadFrequently:!0});if(!g)throw new Error("failed to create canvas 2d context");return s.width=C.width,s.height=C.height,g.drawImage(C,0,0,C.width,C.height),g},resolveURL:C=>(B||(B=document.createElement("a")),B.href=C,B.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return $!==void 0?$:!!matchMedia&&(j==null&&(j=matchMedia("(prefers-reduced-motion: reduce)")),j.matches)},set prefersReducedMotion(C){$=C}},de=new class{constructor(){this._realTime=typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),this._frozenAt=null}getCurrentTime(){return this._frozenAt!==null?this._frozenAt:this._realTime()}setNow(C){this._frozenAt=C}restoreNow(){this._frozenAt=null}isFrozen(){return this._frozenAt!==null}};function Ae(){return de.getCurrentTime()}class he{static testProp(s){if(!he.docStyle)return s[0];for(let g=0;g<s.length;g++)if(s[g]in he.docStyle)return s[g];return s[0]}static create(s,g,x){const T=window.document.createElement(s);return g!==void 0&&(T.className=g),x&&x.appendChild(T),T}static createNS(s,g){return window.document.createElementNS(s,g)}static disableDrag(){he.docStyle&&he.selectProp&&(he.userSelect=he.docStyle[he.selectProp],he.docStyle[he.selectProp]="none")}static enableDrag(){he.docStyle&&he.selectProp&&(he.docStyle[he.selectProp]=he.userSelect)}static setTransform(s,g){s.style[he.transformProp]=g}static addEventListener(s,g,x,T={}){s.addEventListener(g,x,"passive"in T?T:T.capture)}static removeEventListener(s,g,x,T={}){s.removeEventListener(g,x,"passive"in T?T:T.capture)}static suppressClickInternal(s){s.preventDefault(),s.stopPropagation(),window.removeEventListener("click",he.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",he.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",he.suppressClickInternal,!0)}),0)}static getScale(s){const g=s.getBoundingClientRect();return{x:g.width/s.offsetWidth||1,y:g.height/s.offsetHeight||1,boundingClientRect:g}}static getPoint(s,g,x){const T=g.boundingClientRect;return new l.P((x.clientX-T.left)/g.x-s.clientLeft,(x.clientY-T.top)/g.y-s.clientTop)}static mousePos(s,g){const x=he.getScale(s);return he.getPoint(s,x,g)}static touchPos(s,g){const x=[],T=he.getScale(s);for(let I=0;I<g.length;I++)x.push(he.getPoint(s,T,g[I]));return x}static mouseButton(s){return s.button}static remove(s){s.parentNode&&s.parentNode.removeChild(s)}static sanitize(s){const g=new DOMParser().parseFromString(s,"text/html").body||document.createElement("body"),x=g.querySelectorAll("script");for(const T of x)T.remove();return he.clean(g),g.innerHTML}static isPossiblyDangerous(s,g){const x=g.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(s)||!x.includes("javascript:")&&!x.includes("data:"))||!!s.startsWith("on")||void 0}static clean(s){const g=s.children;for(const x of g)he.removeAttributes(x),he.clean(x)}static removeAttributes(s){for(const{name:g,value:x}of s.attributes)he.isPossiblyDangerous(g,x)&&s.removeAttribute(g)}}he.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,he.selectProp=he.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),he.transformProp=he.testProp(["transform","WebkitTransform"]);const Le={supported:!1,testSupport:function(C){!Je&&Be&&(Rt?Et(C):$e=C)}};let $e,Be,Je=!1,Rt=!1;function Et(C){const s=C.createTexture();C.bindTexture(C.TEXTURE_2D,s);try{if(C.texImage2D(C.TEXTURE_2D,0,C.RGBA,C.RGBA,C.UNSIGNED_BYTE,Be),C.isContextLost())return;Le.supported=!0}catch{}C.deleteTexture(s),Je=!0}var kt;typeof document<"u"&&(Be=document.createElement("img"),Be.onload=()=>{$e&&Et($e),$e=null,Rt=!0},Be.onerror=()=>{Je=!0,$e=null},Be.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(C){let s,g,x,T;C.resetRequestQueue=()=>{s=[],g=0,x=0,T={}},C.addThrottleControl=G=>{const q=x++;return T[q]=G,q},C.removeThrottleControl=G=>{delete T[G],O()},C.getImage=(G,q,J=!0)=>new Promise(((re,ie)=>{Le.supported&&(G.headers||(G.headers={}),G.headers.accept="image/webp,*/*"),l.e(G,{type:"image"}),s.push({abortController:q,requestParameters:G,supportImageRefresh:J,state:"queued",onError:ce=>{ie(ce)},onSuccess:ce=>{re(ce)}}),O()}));const I=G=>l._(this,void 0,void 0,(function*(){G.state="running";const{requestParameters:q,supportImageRefresh:J,onError:re,onSuccess:ie,abortController:ce}=G,_e=J===!1&&!l.i(self)&&!l.g(q.url)&&(!q.headers||Object.keys(q.headers).reduce(((Ce,Oe)=>Ce&&Oe==="accept"),!0));g++;const Me=_e?z(q,ce):l.m(q,ce);try{const Ce=yield Me;delete G.abortController,G.state="completed",Ce.data instanceof HTMLImageElement||l.b(Ce.data)?ie(Ce):Ce.data&&ie({data:yield(Pe=Ce.data,typeof createImageBitmap=="function"?l.f(Pe):l.h(Pe)),cacheControl:Ce.cacheControl,expires:Ce.expires})}catch(Ce){delete G.abortController,re(Ce)}finally{g--,O()}var Pe})),O=()=>{const G=(()=>{for(const q of Object.keys(T))if(T[q]())return!0;return!1})()?l.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:l.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let q=g;q<G&&s.length>0;q++){const J=s.shift();J.abortController.signal.aborted?q--:I(J)}},z=(G,q)=>new Promise(((J,re)=>{const ie=new Image,ce=G.url,_e=G.credentials;_e&&_e==="include"?ie.crossOrigin="use-credentials":(_e&&_e==="same-origin"||!l.d(ce))&&(ie.crossOrigin="anonymous"),q.signal.addEventListener("abort",(()=>{ie.src="",re(new l.a(q.signal.reason))})),ie.fetchPriority="high",ie.onload=()=>{ie.onerror=ie.onload=null,J({data:ie})},ie.onerror=()=>{ie.onerror=ie.onload=null,q.signal.aborted||re(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},ie.src=ce}))})(kt||(kt={})),kt.resetRequestQueue();class Ht{constructor(s){this._transformRequestFn=s??null}transformRequest(s,g){return this._transformRequestFn&&this._transformRequestFn(s,g)||{url:s}}setTransformRequest(s){this._transformRequestFn=s}}function Xt(C){const s=[];if(typeof C=="string")s.push({id:"default",url:C});else if(C&&C.length>0){const g=[];for(const{id:x,url:T}of C){const I=`${x}${T}`;g.indexOf(I)===-1&&(g.push(I),s.push({id:x,url:T}))}}return s}function hi(C,s,g){try{const x=new URL(C);return x.pathname+=`${s}${g}`,x.toString()}catch{throw new Error(`Invalid sprite URL "${C}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function di(C){const{userImage:s}=C;return!!(s&&s.render&&s.render())&&(C.data.replace(new Uint8Array(s.data.buffer)),!0)}class Ei extends l.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.R({width:1,height:1}),this.dirty=!0}destroy(){this.atlasTexture&&(this.atlasTexture.destroy(),this.atlasTexture=null);for(const s of Object.keys(this.images))this.removeImage(s);this.patterns={},this.atlasImage=new l.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(s){if(this.loaded!==s&&(this.loaded=s,s)){for(const{ids:g,promiseResolve:x}of this.requestors)x(this._getImagesForIds(g));this.requestors=[]}}getImage(s){const g=this.images[s];if(g&&!g.data&&g.spriteData){const x=g.spriteData;g.data=new l.R({width:x.width,height:x.height},x.context.getImageData(x.x,x.y,x.width,x.height).data),g.spriteData=null}return g}addImage(s,g){if(this.images[s])throw new Error(`Image id ${s} already exist, use updateImage instead`);this._validate(s,g)&&(this.images[s]=g)}_validate(s,g){let x=!0;const T=g.data||g.spriteData;return this._validateStretch(g.stretchX,T&&T.width)||(this.fire(new l.k(new Error(`Image "${s}" has invalid "stretchX" value`))),x=!1),this._validateStretch(g.stretchY,T&&T.height)||(this.fire(new l.k(new Error(`Image "${s}" has invalid "stretchY" value`))),x=!1),this._validateContent(g.content,g)||(this.fire(new l.k(new Error(`Image "${s}" has invalid "content" value`))),x=!1),x}_validateStretch(s,g){if(!s)return!0;let x=0;for(const T of s){if(T[0]<x||T[1]<T[0]||g<T[1])return!1;x=T[1]}return!0}_validateContent(s,g){if(!s)return!0;if(s.length!==4)return!1;const x=g.spriteData,T=x&&x.width||g.data.width,I=x&&x.height||g.data.height;return!(s[0]<0||T<s[0]||s[1]<0||I<s[1]||s[2]<0||T<s[2]||s[3]<0||I<s[3]||s[2]<s[0]||s[3]<s[1])}updateImage(s,g,x=!0){const T=this.getImage(s);if(x&&(T.data.width!==g.data.width||T.data.height!==g.data.height))throw new Error(`size mismatch between old image (${T.data.width}x${T.data.height}) and new image (${g.data.width}x${g.data.height}).`);g.version=T.version+1,this.images[s]=g,this.updatedImages[s]=!0}removeImage(s){const g=this.images[s];delete this.images[s],delete this.patterns[s],g.userImage&&g.userImage.onRemove&&g.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(s){return new Promise(((g,x)=>{let T=!0;if(!this.isLoaded())for(const I of s)this.images[I]||(T=!1);this.isLoaded()||T?g(this._getImagesForIds(s)):this.requestors.push({ids:s,promiseResolve:g})}))}_getImagesForIds(s){const g={};for(const x of s){let T=this.getImage(x);T||(this.fire(new l.l("styleimagemissing",{id:x})),T=this.getImage(x)),T?g[x]={data:T.data.clone(),pixelRatio:T.pixelRatio,sdf:T.sdf,version:T.version,stretchX:T.stretchX,stretchY:T.stretchY,content:T.content,textFitWidth:T.textFitWidth,textFitHeight:T.textFitHeight,hasRenderCallback:!!(T.userImage&&T.userImage.render)}:l.w(`Image "${x}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return g}getPixelSize(){const{width:s,height:g}=this.atlasImage;return{width:s,height:g}}getPattern(s){const g=this.patterns[s],x=this.getImage(s);if(!x)return null;if(g&&g.position.version===x.version)return g.position;if(g)g.position.version=x.version;else{const T={w:x.data.width+2,h:x.data.height+2,x:0,y:0},I=new l.I(T,x);this.patterns[s]={bin:T,position:I}}return this._updatePatternAtlas(),this.patterns[s].position}bind(s){const g=s.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new l.T(s,this.atlasImage,g.RGBA),this.atlasTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE)}_updatePatternAtlas(){const s=[];for(const I in this.patterns)s.push(this.patterns[I].bin);const{w:g,h:x}=l.p(s),T=this.atlasImage;T.resize({width:g||1,height:x||1});for(const I in this.patterns){const{bin:O}=this.patterns[I],z=O.x+1,G=O.y+1,q=this.getImage(I).data,J=q.width,re=q.height;l.R.copy(q,T,{x:0,y:0},{x:z,y:G},{width:J,height:re}),l.R.copy(q,T,{x:0,y:re-1},{x:z,y:G-1},{width:J,height:1}),l.R.copy(q,T,{x:0,y:0},{x:z,y:G+re},{width:J,height:1}),l.R.copy(q,T,{x:J-1,y:0},{x:z-1,y:G},{width:1,height:re}),l.R.copy(q,T,{x:0,y:0},{x:z+J,y:G},{width:1,height:re})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(s){for(const g of s){if(this.callbackDispatchedThisFrame[g])continue;this.callbackDispatchedThisFrame[g]=!0;const x=this.getImage(g);x||l.w(`Image with ID: "${g}" was not found`),di(x)&&this.updateImage(g,x)}}cloneImages(){const s={};for(const g in this.images){const x=this.images[g];s[g]=Object.assign(Object.assign({},x),{data:x.data?x.data.clone():null})}return s}}const Ii=1e20;function fi(C,s,g,x,T,I,O,z,G){for(let q=s;q<s+x;q++)Ui(C,g*I+q,I,T,O,z,G);for(let q=g;q<g+T;q++)Ui(C,q*I+s,1,x,O,z,G)}function Ui(C,s,g,x,T,I,O){I[0]=0,O[0]=-Ii,O[1]=Ii,T[0]=C[s];for(let z=1,G=0,q=0;z<x;z++){T[z]=C[s+z*g];const J=z*z;do{const re=I[G];q=(T[z]-T[re]+J-re*re)/(z-re)/2}while(q<=O[G]&&--G>-1);G++,I[G]=z,O[G]=q,O[G+1]=Ii}for(let z=0,G=0;z<x;z++){for(;O[G+1]<z;)G++;const q=I[G],J=z-q;C[s+z*g]=T[q]+J*J}}const nt=l.v.layout_symbol["text-font"].default.join(",");class Ut{constructor(s,g,x){this.requestManager=s,this.localIdeographFontFamily=g,this.entries={},this.lang=x}setURL(s){this.url=s}getGlyphs(s){return l._(this,void 0,void 0,(function*(){const g=[];for(const I in s)for(const O of s[I])g.push(this._getAndCacheGlyphsPromise(I,O));const x=yield Promise.all(g),T={};for(const{stack:I,id:O,glyph:z}of x)T[I]||(T[I]={}),T[I][O]=z&&{id:z.id,bitmap:z.bitmap.clone(),metrics:z.metrics};return T}))}_getAndCacheGlyphsPromise(s,g){return l._(this,void 0,void 0,(function*(){let x=this.entries[s];x||(x=this.entries[s]={glyphs:{},requests:{},ranges:{}});let T=x.glyphs[g];return T!==void 0?{stack:s,id:g,glyph:T}:!this.url||this._charUsesLocalIdeographFontFamily(g)?(T=x.glyphs[g]=this._drawGlyph(x,s,g),{stack:s,id:g,glyph:T}):yield this._downloadAndCacheRangePromise(s,g)}))}_downloadAndCacheRangePromise(s,g){return l._(this,void 0,void 0,(function*(){const x=this.entries[s],T=Math.floor(g/256);if(x.ranges[T])return{stack:s,id:g,glyph:null};if(!x.requests[T]){const I=Ut.loadGlyphRange(s,T,this.url,this.requestManager);x.requests[T]=I}try{const I=yield x.requests[T];for(const O in I)x.glyphs[+O]=I[+O];return x.ranges[T]=!0,{stack:s,id:g,glyph:I[g]||null}}catch(I){const O=x.glyphs[g]=this._drawGlyph(x,s,g);return this._warnOnMissingGlyphRange(O,T,g,I),{stack:s,id:g,glyph:O}}}))}_warnOnMissingGlyphRange(s,g,x,T){const I=256*g,O=I+255,z=x.toString(16).padStart(4,"0").toUpperCase();l.w(`Unable to load glyph range ${g}, ${I}-${O}. Rendering codepoint U+${z} locally instead. ${T}`)}_charUsesLocalIdeographFontFamily(s){return!!this.localIdeographFontFamily&&l.q(s)}_drawGlyph(s,g,x){const T=g===nt&&this.localIdeographFontFamily!==""&&this._charUsesLocalIdeographFontFamily(x),I=T?"ideographTinySDF":"tinySDF";s[I]||(s[I]=this._createTinySDF(T?this.localIdeographFontFamily:g));const O=s[I].draw(String.fromCodePoint(x)),z=new RegExp("^\\p{gc=Cf}+$","u").test(String.fromCodePoint(x));return{id:x,bitmap:new l.r({width:O.width||60,height:O.height||60},O.data),metrics:{width:z?0:O.glyphWidth/2||24,height:O.glyphHeight/2||24,left:O.glyphLeft/2+.5||0,top:O.glyphTop/2-27.5||-8,advance:z?0:O.glyphAdvance/2||24,isDoubleResolution:!0}}}_createTinySDF(s){const g=s?s.split(","):[];g.push("sans-serif");const x=g.map((T=>/[-\w]+/.test(T)?T:`'${CSS.escape(T)}'`)).join(",");return new Ut.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:x,fontWeight:this._fontWeight(g[0]),fontStyle:this._fontStyle(g[0]),lang:this.lang})}_fontStyle(s){return/italic/i.test(s)?"italic":/oblique/i.test(s)?"oblique":"normal"}_fontWeight(s){const g={thin:100,hairline:100,"extra light":200,"ultra light":200,light:300,normal:400,regular:400,medium:500,semibold:600,demibold:600,bold:700,"extra bold":800,"ultra bold":800,black:900,heavy:900,"extra black":950,"ultra black":950};let x;for(const[T,I]of Object.entries(g))new RegExp(`\\b${T}\\b`,"i").test(s)&&(x=`${I}`);return x}destroy(){for(const s in this.entries){const g=this.entries[s];g.tinySDF&&(g.tinySDF=null),g.ideographTinySDF&&(g.ideographTinySDF=null),g.glyphs={},g.requests={},g.ranges={}}this.entries={}}}Ut.loadGlyphRange=function(C,s,g,x){return l._(this,void 0,void 0,(function*(){const T=256*s,I=T+255,O=x.transformRequest(g.replace("{fontstack}",C).replace("{range}",`${T}-${I}`),"Glyphs"),z=yield l.n(O,new AbortController);if(!z||!z.data)throw new Error(`Could not load glyph range. range: ${s}, ${T}-${I}`);const G={};for(const q of l.o(z.data))G[q.id]=q;return G}))},Ut.TinySDF=class{constructor({fontSize:C=24,buffer:s=3,radius:g=8,cutoff:x=.25,fontFamily:T="sans-serif",fontWeight:I="normal",fontStyle:O="normal",lang:z=null}={}){this.buffer=s,this.cutoff=x,this.radius=g,this.lang=z;const G=this.size=C+4*s,q=this._createCanvas(G),J=this.ctx=q.getContext("2d",{willReadFrequently:!0});J.font=`${O} ${I} ${C}px ${T}`,J.textBaseline="alphabetic",J.textAlign="left",J.fillStyle="black",this.gridOuter=new Float64Array(G*G),this.gridInner=new Float64Array(G*G),this.f=new Float64Array(G),this.z=new Float64Array(G+1),this.v=new Uint16Array(G)}_createCanvas(C){const s=document.createElement("canvas");return s.width=s.height=C,s}draw(C){const{width:s,actualBoundingBoxAscent:g,actualBoundingBoxDescent:x,actualBoundingBoxLeft:T,actualBoundingBoxRight:I}=this.ctx.measureText(C),O=Math.ceil(g),z=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(I-T))),G=Math.min(this.size-this.buffer,O+Math.ceil(x)),q=z+2*this.buffer,J=G+2*this.buffer,re=Math.max(q*J,0),ie=new Uint8ClampedArray(re),ce={data:ie,width:q,height:J,glyphWidth:z,glyphHeight:G,glyphTop:O,glyphLeft:0,glyphAdvance:s};if(z===0||G===0)return ce;const{ctx:_e,buffer:Me,gridInner:Pe,gridOuter:Ce}=this;this.lang&&(_e.lang=this.lang),_e.clearRect(Me,Me,z,G),_e.fillText(C,Me,Me+O);const Oe=_e.getImageData(Me,Me,z,G);Ce.fill(Ii,0,re),Pe.fill(0,0,re);for(let We=0;We<G;We++)for(let ke=0;ke<z;ke++){const Ge=Oe.data[4*(We*z+ke)+3]/255;if(Ge===0)continue;const Xe=(We+Me)*q+ke+Me;if(Ge===1)Ce[Xe]=0,Pe[Xe]=Ii;else{const Ue=.5-Ge;Ce[Xe]=Ue>0?Ue*Ue:0,Pe[Xe]=Ue<0?Ue*Ue:0}}fi(Ce,0,0,q,J,q,this.f,this.v,this.z),fi(Pe,Me,Me,z,G,q,this.f,this.v,this.z);for(let We=0;We<re;We++){const ke=Math.sqrt(Ce[We])-Math.sqrt(Pe[We]);ie[We]=Math.round(255-255*(ke/this.radius+this.cutoff))}return ce}};class mi{constructor(){this.specification=l.u.light.position}possiblyEvaluate(s,g){return l.F(s.expression.evaluate(g))}interpolate(s,g,x){return{x:l.G.number(s.x,g.x,x),y:l.G.number(s.y,g.y,x),z:l.G.number(s.z,g.z,x)}}}let li;class Wi extends l.E{constructor(s){super(),li=li||new l.t({anchor:new l.D(l.u.light.anchor),position:new mi,color:new l.D(l.u.light.color),intensity:new l.D(l.u.light.intensity)}),this._transitionable=new l.x(li,void 0),this.setLight(s),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(s,g={}){if(!this._validate(l.y,s,g))for(const x in s){const T=s[x];x.endsWith(l.z)?this._transitionable.setTransition(x.slice(0,-l.z.length),T):this._transitionable.setValue(x,T)}}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,g,x){return(!x||x.validate!==!1)&&l.B(this,s.call(l.C,{value:g,style:{glyphs:!0,sprite:!0},styleSpec:l.u}))}}const Ye=new l.t({"sky-color":new l.D(l.u.sky["sky-color"]),"horizon-color":new l.D(l.u.sky["horizon-color"]),"fog-color":new l.D(l.u.sky["fog-color"]),"fog-ground-blend":new l.D(l.u.sky["fog-ground-blend"]),"horizon-fog-blend":new l.D(l.u.sky["horizon-fog-blend"]),"sky-horizon-blend":new l.D(l.u.sky["sky-horizon-blend"]),"atmosphere-blend":new l.D(l.u.sky["atmosphere-blend"])});class Gt extends l.E{constructor(s){super(),this._transitionable=new l.x(Ye,void 0),this.setSky(s),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new l.H(0))}setSky(s,g={}){if(!this._validate(l.J,s,g)){s||(s={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const x in s){const T=s[x];x.endsWith(l.z)?this._transitionable.setTransition(x.slice(0,-l.z.length),T):this._transitionable.setValue(x,T)}}}getSky(){return this._transitionable.serialize()}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,g,x={}){return(x==null?void 0:x.validate)!==!1&&l.B(this,s.call(l.C,l.e({value:g,style:{glyphs:!0,sprite:!0},styleSpec:l.u})))}calculateFogBlendOpacity(s){return s<60?0:s<70?(s-60)/10:1}}class vi{constructor(s,g){this.width=s,this.height=g,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(s,g){const x=s.join(",")+String(g);return this.dashEntry[x]||(this.dashEntry[x]=this.addDash(s,g)),this.dashEntry[x]}getDashRanges(s,g,x){const T=[];let I=s.length%2==1?-s[s.length-1]*x:0,O=s[0]*x,z=!0;T.push({left:I,right:O,isDash:z,zeroLength:s[0]===0});let G=s[0];for(let q=1;q<s.length;q++){z=!z;const J=s[q];I=G*x,G+=J,O=G*x,T.push({left:I,right:O,isDash:z,zeroLength:J===0})}return T}addRoundDash(s,g,x){const T=g/2;for(let I=-x;I<=x;I++){const O=this.width*(this.nextRow+x+I);let z=0,G=s[z];for(let q=0;q<this.width;q++){q/G.right>1&&(G=s[++z]);const J=Math.abs(q-G.left),re=Math.abs(q-G.right),ie=Math.min(J,re);let ce;const _e=I/x*(T+1);if(G.isDash){const Me=T-Math.abs(_e);ce=Math.sqrt(ie*ie+Me*Me)}else ce=T-Math.sqrt(ie*ie+_e*_e);this.data[O+q]=Math.max(0,Math.min(255,ce+128))}}}addRegularDash(s){for(let z=s.length-1;z>=0;--z){const G=s[z],q=s[z+1];G.zeroLength?s.splice(z,1):q&&q.isDash===G.isDash&&(q.left=G.left,s.splice(z,1))}const g=s[0],x=s[s.length-1];g.isDash===x.isDash&&(g.left=x.left-this.width,x.right=g.right+this.width);const T=this.width*this.nextRow;let I=0,O=s[I];for(let z=0;z<this.width;z++){z/O.right>1&&(O=s[++I]);const G=Math.abs(z-O.left),q=Math.abs(z-O.right),J=Math.min(G,q);this.data[T+z]=Math.max(0,Math.min(255,(O.isDash?J:-J)+128))}}addDash(s,g){const x=g?7:0,T=2*x+1;if(this.nextRow+T>this.height)return l.w("LineAtlas out of space"),null;let I=0;for(let z=0;z<s.length;z++)I+=s[z];if(I!==0){const z=this.width/I,G=this.getDashRanges(s,this.width,z);g?this.addRoundDash(G,z,x):this.addRegularDash(G)}const O={y:this.nextRow+x,height:2*x,width:I};return this.nextRow+=T,this.dirty=!0,O}bind(s){const g=s.gl;this.texture?(g.bindTexture(g.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,g.texSubImage2D(g.TEXTURE_2D,0,0,0,this.width,this.height,g.ALPHA,g.UNSIGNED_BYTE,this.data))):(this.texture=g.createTexture(),g.bindTexture(g.TEXTURE_2D,this.texture),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.REPEAT),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,g.REPEAT),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,g.LINEAR),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,g.LINEAR),g.texImage2D(g.TEXTURE_2D,0,g.ALPHA,this.width,this.height,0,g.ALPHA,g.UNSIGNED_BYTE,this.data))}}const Si="maplibre_preloaded_worker_pool";class Li{constructor(){this.active={}}acquire(s){if(!this.workers)for(this.workers=[];this.workers.length<Li.workerCount;)this.workers.push(new Worker(l.c.WORKER_URL));return this.active[s]=!0,this.workers.slice()}release(s){delete this.active[s],this.numActive()===0&&(this.workers.forEach((g=>{g.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[Si]}numActive(){return Object.keys(this.active).length}}const Vi=Math.floor(se.hardwareConcurrency/2);let yn,Kn;function mr(){return yn||(yn=new Li),yn}Li.workerCount=l.K(globalThis)?Math.max(Math.min(Vi,3),1):1;class Co{constructor(s,g){this.workerPool=s,this.actors=[],this.currentActor=0,this.id=g;const x=this.workerPool.acquire(g);for(let T=0;T<x.length;T++){const I=new l.L(x[T],g);I.name=`Worker ${T}`,this.actors.push(I)}if(!this.actors.length)throw new Error("No actors found")}broadcast(s,g){const x=[];for(const T of this.actors)x.push(T.sendAsync({type:s,data:g}));return Promise.all(x)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(s=!0){this.actors.forEach((g=>{g.remove()})),this.actors=[],s&&this.workerPool.release(this.id)}registerMessageHandler(s,g){for(const x of this.actors)x.registerMessageHandler(s,g)}unregisterMessageHandler(s){for(const g of this.actors)g.unregisterMessageHandler(s)}}function Oa(){return Kn||(Kn=new Co(mr(),l.M),Kn.registerMessageHandler("GR",((C,s,g)=>l.m(s,g)))),Kn}function ra(C,s){const g=l.N();return l.O(g,g,[1,1,0]),l.Q(g,g,[.5*C.width,.5*C.height,1]),C.calculatePosMatrix?l.S(g,g,C.calculatePosMatrix(s.toUnwrapped())):g}function uh(C,s,g,x,T,I,O){var z;const G=(function(ie,ce,_e){if(ie)for(const Me of ie){const Pe=ce[Me];if(Pe&&Pe.source===_e&&Pe.type==="fill-extrusion")return!0}else for(const Me in ce){const Pe=ce[Me];if(Pe.source===_e&&Pe.type==="fill-extrusion")return!0}return!1})((z=T==null?void 0:T.layers)!==null&&z!==void 0?z:null,s,C.id),q=I.maxPitchScaleFactor(),J=C.tilesIn(x,q,G);J.sort(br);const re=[];for(const ie of J)re.push({wrappedTileID:ie.tileID.wrapped().key,queryResults:ie.tile.queryRenderedFeatures(s,g,C.getState(),ie.queryGeometry,ie.cameraQueryGeometry,ie.scale,T,I,q,ra(I,ie.tileID),O?(ce,_e)=>O(ie.tileID,ce,_e):void 0)});return(function(ie,ce){for(const _e in ie)for(const Me of ie[_e])Fa(Me,ce);return ie})((function(ie){const ce={},_e={};for(const Me of ie){const Pe=Me.queryResults,Ce=Me.wrappedTileID,Oe=_e[Ce]=_e[Ce]||{};for(const We in Pe){const ke=Pe[We],Ge=Oe[We]=Oe[We]||{},Xe=ce[We]=ce[We]||[];for(const Ue of ke)Ge[Ue.featureIndex]||(Ge[Ue.featureIndex]=!0,Xe.push(Ue))}}return ce})(re),C)}function br(C,s){const g=C.tileID,x=s.tileID;return g.overscaledZ-x.overscaledZ||g.canonical.y-x.canonical.y||g.wrap-x.wrap||g.canonical.x-x.canonical.x}function Fa(C,s){const g=C.feature,x=s.getFeatureState(g.layer["source-layer"],g.id);g.source=g.layer.source,g.layer["source-layer"]&&(g.sourceLayer=g.layer["source-layer"]),g.state=x}function Na(C,s,g,x){return l._(this,void 0,void 0,(function*(){let T=C;if(C.url?T=(yield l.j(s.transformRequest(C.url,"Source"),g)).data:yield se.frameAsync(g,x),!T)return null;const I=l.U(l.e(T,C),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in T&&T.vector_layers&&(I.vectorLayerIds=T.vector_layers.map((O=>O.id))),I}))}class Ir{constructor(s,g){s&&(g?this.setSouthWest(s).setNorthEast(g):Array.isArray(s)&&(s.length===4?this.setSouthWest([s[0],s[1]]).setNorthEast([s[2],s[3]]):this.setSouthWest(s[0]).setNorthEast(s[1])))}setNorthEast(s){return this._ne=s instanceof l.V?new l.V(s.lng,s.lat):l.V.convert(s),this}setSouthWest(s){return this._sw=s instanceof l.V?new l.V(s.lng,s.lat):l.V.convert(s),this}extend(s){const g=this._sw,x=this._ne;let T,I;if(s instanceof l.V)T=s,I=s;else{if(!(s instanceof Ir))return Array.isArray(s)?s.length===4||s.every(Array.isArray)?this.extend(Ir.convert(s)):this.extend(l.V.convert(s)):s&&("lng"in s||"lon"in s)&&"lat"in s?this.extend(l.V.convert(s)):this;if(T=s._sw,I=s._ne,!T||!I)return this}return g||x?(g.lng=Math.min(T.lng,g.lng),g.lat=Math.min(T.lat,g.lat),x.lng=Math.max(I.lng,x.lng),x.lat=Math.max(I.lat,x.lat)):(this._sw=new l.V(T.lng,T.lat),this._ne=new l.V(I.lng,I.lat)),this}getCenter(){return new l.V((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new l.V(this.getWest(),this.getNorth())}getSouthEast(){return new l.V(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(s){const{lng:g,lat:x}=l.V.convert(s);let T=this._sw.lng<=g&&g<=this._ne.lng;return this._sw.lng>this._ne.lng&&(T=this._sw.lng>=g&&g>=this._ne.lng),this._sw.lat<=x&&x<=this._ne.lat&&T}intersects(s){if(!((s=Ir.convert(s)).getNorth()>=this.getSouth()&&s.getSouth()<=this.getNorth()))return!1;const g=Math.abs(this.getEast()-this.getWest()),x=Math.abs(s.getEast()-s.getWest());if(g>=360||x>=360)return!0;const T=l.W(this.getWest(),-180,180),I=l.W(this.getEast(),-180,180),O=l.W(s.getWest(),-180,180),z=l.W(s.getEast(),-180,180),G=T>=I,q=O>=z;return!(!G||!q)||(G?z>=T||O<=I:q?I>=O||T<=z:O<=I&&z>=T)}static convert(s){return s instanceof Ir?s:s&&new Ir(s)}static fromLngLat(s,g=0){const x=360*g/40075017,T=x/Math.cos(Math.PI/180*s.lat);return new Ir(new l.V(s.lng-T,s.lat-x),new l.V(s.lng+T,s.lat+x))}adjustAntiMeridian(){const s=new l.V(this._sw.lng,this._sw.lat),g=new l.V(this._ne.lng,this._ne.lat);return new Ir(s,s.lng>g.lng?new l.V(g.lng+360,g.lat):g)}}class xl{constructor(s,g,x){this.bounds=Ir.convert(this.validateBounds(s)),this.minzoom=g||0,this.maxzoom=x||24}validateBounds(s){return Array.isArray(s)&&s.length===4?[Math.max(-180,s[0]),Math.max(-90,s[1]),Math.min(180,s[2]),Math.min(90,s[3])]:[-180,-90,180,90]}contains(s){const g=Math.pow(2,s.z),x=Math.floor(l.Y(this.bounds.getWest())*g),T=Math.floor(l.X(this.bounds.getNorth())*g),I=Math.ceil(l.Y(this.bounds.getEast())*g),O=Math.ceil(l.X(this.bounds.getSouth())*g);return s.x>=x&&s.x<I&&s.y>=T&&s.y<O}}class Fc extends l.E{constructor(s,g,x,T){if(super(),this.id=s,this.dispatcher=x,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.e(this,l.U(g,["url","scheme","tileSize","promoteId","encoding"])),this._options=l.e({type:"vector"},g),this._collectResourceTiming=g.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(T)}load(){return l._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new l.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const s=yield Na(this._options,this.map._requestManager,this._tileJSONRequest,this.map._ownerWindow);this._tileJSONRequest=null,this._loaded=!0,this.map.style.tileManagers[this.id].clearTiles(),s&&(l.e(this,s),s.bounds&&(this.tileBounds=new xl(s.bounds,this.minzoom,this.maxzoom)),this.fire(new l.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.l("data",{dataType:"source",sourceDataType:"content"})))}catch(s){this._tileJSONRequest=null,this._loaded=!0,l.Z(s)||this.fire(new l.k(s))}}))}loaded(){return this._loaded}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}onAdd(s){this.map=s,this.load()}setSourceProperty(s){this._tileJSONRequest&&this._tileJSONRequest.abort(),s(),this.load()}setTiles(s){return this.setSourceProperty((()=>{this._options.tiles=s})),this}setUrl(s){return this.setSourceProperty((()=>{this.url=s,this._options.url=s})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return l.e({},this._options)}loadTile(s){return l._(this,void 0,void 0,(function*(){const g=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),x={request:this.map._requestManager.transformRequest(g,"Tile"),uid:s.uid,tileID:s.tileID,zoom:s.tileID.overscaledZ,tileSize:this.tileSize*s.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,encoding:this.encoding,overzoomParameters:this._getOverzoomParameters(s)};x.request.collectResourceTiming=this._collectResourceTiming;let T="RT";if(s.actor&&s.state!=="expired"){if(s.state==="loading")return new Promise(((I,O)=>{s.reloadPromise={resolve:I,reject:O}}))}else s.actor=this.dispatcher.getActor(),T="LT";s.abortController=new AbortController;try{const I=yield s.actor.sendAsync({type:T,data:x},s.abortController);if(delete s.abortController,s.aborted)return;this._afterTileLoadWorkerResponse(s,I)}catch(I){if(delete s.abortController,s.aborted)return;if(I&&I.status!==404)throw I;this._afterTileLoadWorkerResponse(s,null)}}))}_getOverzoomParameters(s){if(s.tileID.canonical.z<=this.maxzoom||this.map._zoomLevelsToOverscale===void 0)return;const g=s.tileID.scaledTo(this.maxzoom).canonical,x=g.url(this.tiles,this.map.getPixelRatio(),this.scheme);return{maxZoomTileID:g,overzoomRequest:this.map._requestManager.transformRequest(x,"Tile")}}_afterTileLoadWorkerResponse(s,g){if(g&&g.resourceTiming&&(s.resourceTiming=g.resourceTiming),g&&this.map._refreshExpiredTiles&&s.setExpiryData(g),s.loadVectorData(g,this.map.painter),s.reloadPromise){const x=s.reloadPromise;s.reloadPromise=null,this.loadTile(s).then(x.resolve).catch(x.reject)}}abortTile(s){return l._(this,void 0,void 0,(function*(){s.abortController&&(s.abortController.abort(),delete s.abortController),s.actor&&(yield s.actor.sendAsync({type:"AT",data:{uid:s.uid,type:this.type,source:this.id}}))}))}unloadTile(s){return l._(this,void 0,void 0,(function*(){s.unloadVectorData(),s.actor&&(yield s.actor.sendAsync({type:"RMT",data:{uid:s.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class Nc extends l.E{constructor(s,g,x,T){super(),this.id=s,this.dispatcher=x,this.setEventedParent(T),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.e({type:"raster"},g),l.e(this,l.U(g,["url","scheme","tileSize"]))}load(){return l._(this,arguments,void 0,(function*(s=!1){this._loaded=!1,this.fire(new l.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const g=yield Na(this._options,this.map._requestManager,this._tileJSONRequest,this.map._ownerWindow);this._tileJSONRequest=null,this._loaded=!0,g&&(l.e(this,g),g.bounds&&(this.tileBounds=new xl(g.bounds,this.minzoom,this.maxzoom)),this.fire(new l.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:s})))}catch(g){this._tileJSONRequest=null,this._loaded=!0,l.Z(g)||this.fire(new l.k(g))}}))}loaded(){return this._loaded}onAdd(s){this.map=s,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(s){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),s(),this.load(!0)}setTiles(s){return this.setSourceProperty((()=>{this._options.tiles=s})),this}setUrl(s){return this.setSourceProperty((()=>{this.url=s,this._options.url=s})),this}serialize(){return l.e({},this._options)}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}loadTile(s){return l._(this,void 0,void 0,(function*(){const g=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);s.abortController=new AbortController;try{const x=yield kt.getImage(this.map._requestManager.transformRequest(g,"Tile"),s.abortController,this.map._refreshExpiredTiles);if(delete s.abortController,s.aborted)return void(s.state="unloaded");if(x&&x.data){this.map._refreshExpiredTiles&&(x.cacheControl||x.expires)&&s.setExpiryData({cacheControl:x.cacheControl,expires:x.expires});const T=this.map.painter.context,I=T.gl,O=x.data;s.texture=this.map.painter.getTileTexture(O.width),s.texture?s.texture.update(O,{useMipmap:!0}):(s.texture=new l.T(T,O,I.RGBA,{useMipmap:!0}),s.texture.bind(I.LINEAR,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST)),s.state="loaded"}}catch(x){if(delete s.abortController,s.aborted)s.state="unloaded";else if(x)throw s.state="errored",x}}))}abortTile(s){return l._(this,void 0,void 0,(function*(){s.abortController&&(s.abortController.abort(),delete s.abortController)}))}unloadTile(s){return l._(this,void 0,void 0,(function*(){s.texture&&this.map.painter.saveTileTexture(s.texture)}))}hasTransition(){return!1}}class Po extends Nc{constructor(s,g,x,T){super(s,g,x,T),this.type="raster-dem",this.maxzoom=22,this._options=l.e({type:"raster-dem"},g),this.encoding=g.encoding||"mapbox",this.redFactor=g.redFactor,this.greenFactor=g.greenFactor,this.blueFactor=g.blueFactor,this.baseShift=g.baseShift}loadTile(s){return l._(this,void 0,void 0,(function*(){const g=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),x=this.map._requestManager.transformRequest(g,"Tile");s.neighboringTiles=this._getNeighboringTiles(s.tileID),s.abortController=new AbortController;try{const T=yield kt.getImage(x,s.abortController,this.map._refreshExpiredTiles);if(delete s.abortController,s.aborted)return void(s.state="unloaded");if(T&&T.data){const I=T.data;this.map._refreshExpiredTiles&&(T.cacheControl||T.expires)&&s.setExpiryData({cacheControl:T.cacheControl,expires:T.expires});const O=l.b(I)&&l.$()?I:yield this.readImageNow(I),z={type:this.type,uid:s.uid,source:this.id,rawImageData:O,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!s.actor||s.state==="expired"){s.actor=this.dispatcher.getActor();const G=yield s.actor.sendAsync({type:"LDT",data:z});s.dem=G,s.needsHillshadePrepare=!0,s.needsTerrainPrepare=!0,s.state="loaded"}}}catch(T){if(delete s.abortController,s.aborted)s.state="unloaded";else if(T)throw s.state="errored",T}}))}readImageNow(s){return l._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&l.a0()){const g=s.width+2,x=s.height+2;try{return new l.R({width:g,height:x},yield l.a1(s,-1,-1,g,x))}catch{}}return se.getImageData(s,1)}))}_getNeighboringTiles(s){const g=s.canonical,x=Math.pow(2,g.z),T=(g.x-1+x)%x,I=g.x===0?s.wrap-1:s.wrap,O=(g.x+1+x)%x,z=g.x+1===x?s.wrap+1:s.wrap,G={};return G[new l.a2(s.overscaledZ,I,g.z,T,g.y).key]={backfilled:!1},G[new l.a2(s.overscaledZ,z,g.z,O,g.y).key]={backfilled:!1},g.y>0&&(G[new l.a2(s.overscaledZ,I,g.z,T,g.y-1).key]={backfilled:!1},G[new l.a2(s.overscaledZ,s.wrap,g.z,g.x,g.y-1).key]={backfilled:!1},G[new l.a2(s.overscaledZ,z,g.z,O,g.y-1).key]={backfilled:!1}),g.y+1<x&&(G[new l.a2(s.overscaledZ,I,g.z,T,g.y+1).key]={backfilled:!1},G[new l.a2(s.overscaledZ,s.wrap,g.z,g.x,g.y+1).key]={backfilled:!1},G[new l.a2(s.overscaledZ,z,g.z,O,g.y+1).key]={backfilled:!1}),G}unloadTile(s){return l._(this,void 0,void 0,(function*(){s.demTexture&&this.map.painter.saveTileTexture(s.demTexture),s.fbo&&(s.fbo.destroy(),delete s.fbo),s.dem&&delete s.dem,delete s.neighboringTiles,s.state="unloaded",s.actor&&(yield s.actor.sendAsync({type:"RDT",data:{type:this.type,uid:s.uid,source:this.id}}))}))}}function ic(C){return C.type==="GeometryCollection"?C.geometries.map((s=>s.coordinates)).flat(1/0):C.coordinates.flat(1/0)}function so(C){const s=new Ir;let g;switch(C.type){case"FeatureCollection":g=C.features.map((x=>ic(x.geometry))).flat(1/0);break;case"Feature":g=ic(C.geometry);break;default:g=ic(C)}if(g.length==0)return s;for(let x=0;x<g.length-1;x+=2)s.extend([g[x],g[x+1]]);return s}class Qr extends l.E{constructor(s,g,x,T){super(),this.id=s,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:g.data},this.actor=x.getActor(),this.setEventedParent(T),this._data=typeof g.data=="string"?{url:g.data}:{geojson:g.data},this._options=l.e({},g),this._collectResourceTiming=g.collectResourceTiming,g.maxzoom!==void 0&&(this.maxzoom=g.maxzoom),g.type&&(this.type=g.type),g.attribution&&(this.attribution=g.attribution),this.promoteId=g.promoteId,g.clusterMaxZoom!==void 0&&this.maxzoom<=g.clusterMaxZoom&&l.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${g.clusterMaxZoom}".`),this.workerOptions=l.e({source:this.id,cluster:g.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(g.buffer!==void 0?g.buffer:128),tolerance:this._pixelsToTileUnits(g.tolerance!==void 0?g.tolerance:.375),extent:l.a5,maxZoom:this.maxzoom,lineMetrics:g.lineMetrics||!1,generateId:g.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(g.clusterMaxZoom),minPoints:Math.max(2,g.clusterMinPoints||2),extent:l.a5,radius:this._pixelsToTileUnits(g.clusterRadius||50),log:!1,generateId:g.generateId||!1},clusterProperties:g.clusterProperties,filter:g.filter},g.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_hasPendingWorkerUpdate(){return this._pendingWorkerUpdate.data!==void 0||this._pendingWorkerUpdate.diff!==void 0||this._pendingWorkerUpdate.optionsChanged}_pixelsToTileUnits(s){return s*(l.a5/this.tileSize)}_getClusterMaxZoom(s){const g=s?Math.round(s):this.maxzoom-1;return Number.isInteger(s)||s===void 0||l.w(`Integer expected for option 'clusterMaxZoom': provided value "${s}" rounded to "${g}"`),g}load(){return l._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(s){this.map=s,this.load()}setData(s,g){this._data=typeof s=="string"?{url:s}:{geojson:s},this._pendingWorkerUpdate={data:s};const x=this._updateWorkerData();return g?x:this}updateData(s,g){this._pendingWorkerUpdate.diff=l.a6(this._pendingWorkerUpdate.diff,s);const x=this._updateWorkerData();return g?x:this}getData(){return l._(this,void 0,void 0,(function*(){const s=l.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:s})}))}getBounds(){return l._(this,void 0,void 0,(function*(){return so(yield this.getData())}))}setClusterOptions(s){return this.workerOptions.cluster=s.cluster,s.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(s.clusterRadius)),s.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(s.clusterMaxZoom)),this._pendingWorkerUpdate.optionsChanged=!0,this._updateWorkerData(),this}getClusterExpansionZoom(s){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:s,source:this.id}})}getClusterChildren(s){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:s,source:this.id}})}getClusterLeaves(s,g,x){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:s,limit:g,offset:x}})}_updateWorkerData(){return l._(this,void 0,void 0,(function*(){if(this._isUpdatingWorker)return;if(!this._hasPendingWorkerUpdate())return void l.w(`No pending worker updates for GeoJSONSource ${this.id}.`);const{data:s,diff:g}=this._pendingWorkerUpdate,x=this._getLoadGeoJSONParameters(s,g);s!==void 0?this._pendingWorkerUpdate.data=void 0:g&&(this._pendingWorkerUpdate.diff=void 0),this._pendingWorkerUpdate.optionsChanged=void 0,yield this._dispatchWorkerUpdate(x)}))}_getLoadGeoJSONParameters(s,g){const x=l.e({type:this.type},this.workerOptions);return typeof s=="string"?(x.request=this.map._requestManager.transformRequest(se.resolveURL(s),"Source"),x.request.collectResourceTiming=this._collectResourceTiming,x):s!==void 0?(x.data=s,x):(g&&(x.dataDiff=g),x)}_dispatchWorkerUpdate(s){return l._(this,void 0,void 0,(function*(){this._isUpdatingWorker=!0,this.fire(new l.l("dataloading",{dataType:"source"}));try{const g=yield this.actor.sendAsync({type:"LD",data:s});if(this._isUpdatingWorker=!1,this._removed||g.abandoned)return void this.fire(new l.l("dataabort",{dataType:"source"}));g.data&&(this._data={geojson:g.data});const x=this._applyDiffToSource(s.dataDiff),T=this._getShouldReloadTileOptions(x),I={dataType:"source"};this._applyResourceTiming(I,g),this.fire(new l.l("data",Object.assign(Object.assign({},I),{sourceDataType:"metadata"}))),this.fire(new l.l("data",Object.assign(Object.assign({},I),{sourceDataType:"content",shouldReloadTileOptions:T})))}catch(g){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new l.l("dataabort",{dataType:"source"}));this.fire(new l.k(g))}finally{this._hasPendingWorkerUpdate()&&this._updateWorkerData()}}))}_applyResourceTiming(s,g){var x;if(!this._collectResourceTiming)return;const T=(x=g.resourceTiming)===null||x===void 0?void 0:x[this.id];if(!T)return;const I=T.slice(0);I!=null&&I.length&&l.e(s,{resourceTiming:I})}_applyDiffToSource(s){if(!s)return;const g=typeof this.promoteId=="string"?this.promoteId:void 0;if(!this._data.url&&!this._data.updateable){const T=l.a7(this._data.geojson,g);if(!T)throw new Error(`GeoJSONSource "${this.id}": GeoJSON data is not compatible with updateData`);this._data={updateable:T}}if(!this._data.updateable)return;const x=l.a8(this._data.updateable,s,g);return s.removeAll||this._options.cluster?void 0:x}_getShouldReloadTileOptions(s){if(s)return{affectedBounds:s.filter(Boolean).map((g=>so(g)))}}shouldReloadTile(s,{affectedBounds:g}){if(s.state==="loading")return!0;if(s.state==="unloaded")return!1;const{buffer:x,extent:T}=this.workerOptions.geojsonVtOptions,I=(function({x:O,y:z,z:G},q=0){const J=l.a3((O-q)/Math.pow(2,G)),re=l.a4((z+1+q)/Math.pow(2,G)),ie=l.a3((O+1+q)/Math.pow(2,G)),ce=l.a4((z-q)/Math.pow(2,G));return new Ir([J,re],[ie,ce])})(s.tileID.canonical,x/T);for(const O of g)if(I.intersects(O))return!0;return!1}loaded(){return!this._isUpdatingWorker&&!this._hasPendingWorkerUpdate()}loadTile(s){return l._(this,void 0,void 0,(function*(){const g=s.actor?"RT":"LT";s.actor=this.actor;const x={type:this.type,uid:s.uid,tileID:s.tileID,zoom:s.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};s.abortController=new AbortController;const T=yield this.actor.sendAsync({type:g,data:x},s.abortController);delete s.abortController,s.unloadVectorData(),s.aborted||s.loadVectorData(T,this.map.painter,g==="RT")}))}abortTile(s){return l._(this,void 0,void 0,(function*(){s.abortController&&(s.abortController.abort(),delete s.abortController),s.aborted=!0}))}unloadTile(s){return l._(this,void 0,void 0,(function*(){s.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:s.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return l.e({},this._options,{type:this.type,data:this._data.updateable?{type:"FeatureCollection",features:Array.from(this._data.updateable.values())}:this._data.url||this._data.geojson})}hasTransition(){return!1}}class ao extends l.E{constructor(s,g,x,T){super(),this.flippedWindingOrder=!1,this.id=s,this.dispatcher=x,this.coordinates=g.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(T),this.options=g}load(s){return l._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new l.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const g=yield kt.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,g&&g.data&&(this.image=g.data,s&&(this.coordinates=s),this._finishLoading())}catch(g){this._request=null,this._loaded=!0,l.Z(g)||this.fire(new l.k(g))}}))}loaded(){return this._loaded}updateImage(s){return s.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=s.url,this.load(s.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(s){this.map=s,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(s){this.coordinates=s;const g=s.map(l.a9.fromLngLat);var x;return this.tileID=(function(T){const I=l.aa.fromPoints(T),O=I.width(),z=I.height(),G=Math.max(O,z),q=Math.max(0,Math.floor(-Math.log(G)/Math.LN2)),J=Math.pow(2,q);return new l.ac(q,Math.floor((I.minX+I.maxX)/2*J),Math.floor((I.minY+I.maxY)/2*J))})(g),this.terrainTileRanges=this._getOverlappingTileRanges(g),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=g.map((T=>this.tileID.getTilePoint(T)._round())),this.flippedWindingOrder=((x=this.tileCoords)[1].x-x[0].x)*(x[2].y-x[0].y)-(x[1].y-x[0].y)*(x[2].x-x[0].x)<0,this.fire(new l.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const s=this.map.painter.context,g=s.gl;this.texture||(this.texture=new l.T(s,this.image,g.RGBA),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE));let x=!1;for(const T in this.tiles){const I=this.tiles[T];I.state!=="loaded"&&(I.state="loaded",I.texture=this.texture,x=!0)}x&&this.fire(new l.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(s){return l._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(s.tileID.canonical)?(this.tiles[String(s.tileID.wrap)]=s,s.buckets={}):s.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(s){const{minX:g,minY:x,maxX:T,maxY:I}=l.aa.fromPoints(s),O={};for(let z=0;z<=l.ab;z++){const G=Math.pow(2,z),q=Math.floor(g*G),J=Math.floor(x*G),re=Math.floor(T*G),ie=Math.floor(I*G),ce=(q%G+G)%G,_e=re%G,Me=Math.floor(q/G),Pe=Math.floor(re/G);O[z]={minWrap:Me,maxWrap:Pe,minTileXWrapped:ce,maxTileXWrapped:_e,minTileY:J,maxTileY:ie}}return O}}class nc extends ao{constructor(s,g,x,T){super(s,g,x,T),this.roundZoom=!0,this.type="video",this.options=g}load(){return l._(this,void 0,void 0,(function*(){this._loaded=!1;const s=this.options;this.urls=[];for(const g of s.urls)this.urls.push(this.map._requestManager.transformRequest(g,"Source").url);try{const g=yield l.ad(this.urls);if(this._loaded=!0,!g)return;this.video=g,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(g){this.fire(new l.k(g))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(s){if(this.video){const g=this.video.seekable;s<g.start(0)||s>g.end(0)?this.fire(new l.k(new l.ae(`sources.${this.id}`,null,`Playback for this video can be set only between the ${g.start(0)} and ${g.end(0)}-second mark.`))):this.video.currentTime=s}}getVideo(){return this.video}onAdd(s){this.map||(this.map=s,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const s=this.map.painter.context,g=s.gl;this.texture?this.video.paused||(this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE),g.texSubImage2D(g.TEXTURE_2D,0,0,0,g.RGBA,g.UNSIGNED_BYTE,this.video)):(this.texture=new l.T(s,this.video,g.RGBA),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE));let x=!1;for(const T in this.tiles){const I=this.tiles[T];I.state!=="loaded"&&(I.state="loaded",I.texture=this.texture,x=!0)}x&&this.fire(new l.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Qo extends ao{constructor(s,g,x,T){super(s,g,x,T),g.coordinates?Array.isArray(g.coordinates)&&g.coordinates.length===4&&!g.coordinates.some((I=>!Array.isArray(I)||I.length!==2||I.some((O=>typeof O!="number"))))||this.fire(new l.k(new l.ae(`sources.${s}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.k(new l.ae(`sources.${s}`,null,'missing required property "coordinates"'))),g.animate&&typeof g.animate!="boolean"&&this.fire(new l.k(new l.ae(`sources.${s}`,null,'optional "animate" property must be a boolean value'))),g.canvas?typeof g.canvas=="string"||g.canvas instanceof HTMLCanvasElement||this.fire(new l.k(new l.ae(`sources.${s}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.k(new l.ae(`sources.${s}`,null,'missing required property "canvas"'))),this.options=g,this.animate=g.animate===void 0||g.animate}load(){return l._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(s){this.map=s,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let s=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,s=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,s=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const g=this.map.painter.context,x=g.gl;this.texture?(s||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):(this.texture=new l.T(g,this.canvas,x.RGBA,{premultiply:!0}),this.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE));let T=!1;for(const I in this.tiles){const O=this.tiles[I];O.state!=="loaded"&&(O.state="loaded",O.texture=this.texture,T=!0)}T&&this.fire(new l.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",animate:this.animate,canvas:this.options.canvas,coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const s of[this.canvas.width,this.canvas.height])if(isNaN(s)||s<=0)return!0;return!1}}const Ls={},hh=C=>{switch(C){case"geojson":return Qr;case"image":return ao;case"raster":return Nc;case"raster-dem":return Po;case"vector":return Fc;case"video":return nc;case"canvas":return Qo}return Ls[C]},it="RTLPluginLoaded";class fe extends l.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Oa()}_syncState(s){return this.status=s,this.dispatcher.broadcast("SRPS",{pluginStatus:s,pluginURL:this.url}).catch((g=>{throw this.status="error",g}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(s){return l._(this,arguments,void 0,(function*(g,x=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=se.resolveURL(g),!this.url)throw new Error(`requested url ${g} is invalid`);if(this.status==="unavailable"){if(!x)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return l._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new l.l(it))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let ge=null;function ve(){return ge||(ge=new fe),ge}var Fe,He;(function(C){C[C.Base=0]="Base",C[C.Parent=1]="Parent"})(Fe||(Fe={})),(function(C){C[C.Departing=0]="Departing",C[C.Incoming=1]="Incoming"})(He||(He={}));class st{constructor(s,g){this.timeAdded=0,this.fadeEndTime=0,this.fadeOpacity=1,this.tileID=s,this.uid=l.af(),this.uses=0,this.tileSize=g,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}isRenderable(s){return this.hasData()&&(!this.fadeEndTime||this.fadeOpacity>0)&&(s||!this.holdingForSymbolFade())}setCrossFadeLogic({fadingRole:s,fadingDirection:g,fadingParentID:x,fadeEndTime:T}){this.resetFadeLogic(),this.fadingRole=s,this.fadingDirection=g,this.fadingParentID=x,this.fadeEndTime=T}setSelfFadeLogic(s){this.resetFadeLogic(),this.selfFading=!0,this.fadeEndTime=s}resetFadeLogic(){this.fadingRole=null,this.fadingDirection=null,this.fadingParentID=null,this.selfFading=!1,this.timeAdded=Ae(),this.fadeEndTime=0,this.fadeOpacity=1}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(s){this.demTexture&&s.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(s,g,x){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",s){s.featureIndex&&(this.latestFeatureIndex=s.featureIndex,s.rawTileData?(this.latestRawTileData=s.rawTileData,this.latestFeatureIndex.rawTileData=s.rawTileData,this.latestFeatureIndex.encoding=s.encoding):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData,this.latestFeatureIndex.encoding=this.latestEncoding)),this.collisionBoxArray=s.collisionBoxArray,this.buckets=(function(T,I){const O={};if(!I)return O;for(const z of T){const G=z.layerIds.map((q=>I.getLayer(q))).filter(Boolean);if(G.length!==0){z.layers=G,z.stateDependentLayerIds&&(z.stateDependentLayers=z.stateDependentLayerIds.map((q=>G.filter((J=>J.id===q))[0])));for(const q of G)O[q.id]=z}}return O})(s.buckets,g==null?void 0:g.style),this.hasSymbolBuckets=!1;for(const T in this.buckets){const I=this.buckets[T];if(I instanceof l.ah){if(this.hasSymbolBuckets=!0,!x)break;I.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const T in this.buckets){const I=this.buckets[T];if(I instanceof l.ah&&I.hasRTLText){this.hasRTLText=!0,ve().lazyLoad();break}}this.queryPadding=0;for(const T in this.buckets){const I=this.buckets[T];this.queryPadding=Math.max(this.queryPadding,g.style.getLayer(T).queryRadius(I))}s.imageAtlas&&(this.imageAtlas=s.imageAtlas),s.glyphAtlasImage&&(this.glyphAtlasImage=s.glyphAtlasImage),this.dashPositions=s.dashPositions}else this.collisionBoxArray=new l.ag}unloadVectorData(){for(const s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.dashPositions&&(this.dashPositions=null),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(s){return this.buckets[s.id]}upload(s){for(const x in this.buckets){const T=this.buckets[x];T.uploadPending()&&T.upload(s)}const g=s.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new l.T(s,this.imageAtlas.image,g.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new l.T(s,this.glyphAtlasImage,g.ALPHA),this.glyphAtlasImage=null)}prepare(s){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(s,this.imageAtlasTexture)}queryRenderedFeatures(s,g,x,T,I,O,z,G,q,J,re){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:T,cameraQueryGeometry:I,scale:O,tileSize:this.tileSize,pixelPosMatrix:J,transform:G,params:z,queryPadding:this.queryPadding*q,getElevation:re},s,g,x):{}}querySourceFeatures(s,g){const x=this.latestFeatureIndex;if(!x||!x.rawTileData)return;const T=x.loadVTLayers(),I=g&&g.sourceLayer?g.sourceLayer:"",O=T[l.ai]||T[I];if(!O)return;const z=l.aj(g==null?void 0:g.filter,g==null?void 0:g.globalState),{z:G,x:q,y:J}=this.tileID.canonical,re={z:G,x:q,y:J};for(let ie=0;ie<O.length;ie++){const ce=O.feature(ie);if(z.needGeometry){const Pe=l.ak(ce,!0);if(!z.filter(new l.H(this.tileID.overscaledZ),Pe,this.tileID.canonical))continue}else if(!z.filter(new l.H(this.tileID.overscaledZ),ce))continue;const _e=x.getId(ce,I),Me=new l.al(ce,G,q,J,_e);Me.tile=re,s.push(Me)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(s){const g=this.expirationTime;if(s.cacheControl){const x=l.am(s.cacheControl);x["max-age"]&&(this.expirationTime=Date.now()+1e3*x["max-age"])}else s.expires&&(this.expirationTime=new Date(s.expires).getTime());if(this.expirationTime){const x=Date.now();let T=!1;if(this.expirationTime>x)T=!1;else if(g)if(this.expirationTime<g)T=!0;else{const I=this.expirationTime-g;I?this.expirationTime=x+Math.max(I,3e4):T=!0}else T=!0;T?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(s,g){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(s).length===0)return;const x=this.latestFeatureIndex.loadVTLayers();for(const T in this.buckets){if(!g.style.hasLayer(T))continue;const I=this.buckets[T],O=I.layers[0].sourceLayer||l.ai,z=x[O],G=s[O];if(!z||!G||Object.keys(G).length===0)continue;I.update(G,z,this.imageAtlas&&this.imageAtlas.patternPositions||{},this.dashPositions||{});const q=g&&g.style&&g.style.getLayer(T);q&&(this.queryPadding=Math.max(this.queryPadding,q.queryRadius(I)))}}holdingForSymbolFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Ae()}clearSymbolFadeHold(){this.symbolFadeHoldUntil=void 0}setSymbolHoldDuration(s){this.symbolFadeHoldUntil=Ae()+s}setDependencies(s,g){const x={};for(const T of g)x[T]=!0;this.dependencies[s]=x}hasDependency(s,g){for(const x of s){const T=this.dependencies[x];if(T){for(const I of g)if(T[I])return!0}}return!1}}class xt{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(s,g,x){const T=String(g);if(this.stateChanges[s]=this.stateChanges[s]||{},this.stateChanges[s][T]=this.stateChanges[s][T]||{},l.e(this.stateChanges[s][T],x),this.deletedStates[s]===null){this.deletedStates[s]={};for(const I in this.state[s])I!==T&&(this.deletedStates[s][I]=null)}else if(this.deletedStates[s]&&this.deletedStates[s][T]===null){this.deletedStates[s][T]={};for(const I in this.state[s][T])x[I]||(this.deletedStates[s][T][I]=null)}else for(const I in x)this.deletedStates[s]&&this.deletedStates[s][T]&&this.deletedStates[s][T][I]===null&&delete this.deletedStates[s][T][I]}removeFeatureState(s,g,x){if(this.deletedStates[s]===null)return;const T=String(g);if(this.deletedStates[s]=this.deletedStates[s]||{},x&&g!==void 0)this.deletedStates[s][T]!==null&&(this.deletedStates[s][T]=this.deletedStates[s][T]||{},this.deletedStates[s][T][x]=null);else if(g!==void 0)if(this.stateChanges[s]&&this.stateChanges[s][T])for(x in this.deletedStates[s][T]={},this.stateChanges[s][T])this.deletedStates[s][T][x]=null;else this.deletedStates[s][T]=null;else this.deletedStates[s]=null}getState(s,g){const x=String(g),T=l.e({},(this.state[s]||{})[x],(this.stateChanges[s]||{})[x]);if(this.deletedStates[s]===null)return{};if(this.deletedStates[s]){const I=this.deletedStates[s][g];if(I===null)return{};for(const O in I)delete T[O]}return T}initializeTileState(s,g){s.setFeatureState(this.state,g)}coalesceChanges(s,g){const x={};for(const T in this.stateChanges){this.state[T]=this.state[T]||{};const I={};for(const O in this.stateChanges[T])this.state[T][O]||(this.state[T][O]={}),l.e(this.state[T][O],this.stateChanges[T][O]),I[O]=this.state[T][O];x[T]=I}for(const T in this.deletedStates){this.state[T]=this.state[T]||{};const I={};if(this.deletedStates[T]===null)for(const O in this.state[T])I[O]={},this.state[T][O]={};else for(const O in this.deletedStates[T]){if(this.deletedStates[T][O]===null)this.state[T][O]={};else for(const z of Object.keys(this.deletedStates[T][O]))delete this.state[T][O][z];I[O]=this.state[T][O]}x[T]=x[T]||{},l.e(x[T],I)}this.stateChanges={},this.deletedStates={},Object.keys(x).length!==0&&s.setFeatureState(x,g)}}const Qe=89.25;function ht(C,s){const g=l.an(s.lat,-l.ao,l.ao);return new l.P(l.Y(s.lng)*C,l.X(g)*C)}function zt(C,s){return new l.a9(s.x/C,s.y/C).toLngLat()}function Pt(C){return C.cameraToCenterDistance*Math.min(.85*Math.tan(l.ap(90-C.pitch)),Math.tan(l.ap(Qe-C.pitch)))}function qt(C,s){const g=C.canonical,x=s/l.aq(g.z),T=g.x+Math.pow(2,g.z)*C.wrap,I=l.ar(new Float64Array(16));return l.O(I,I,[T*x,g.y*x,0]),l.Q(I,I,[x/l.a5,x/l.a5,1]),I}function Ke(C,s,g,x,T){const I=l.a9.fromLngLat(C,s),O=T*l.as(1,C.lat),{x:z,y:G,z:q}=Oi(g,x);return new l.a9(I.x+O*-z,I.y+O*-G,I.z+O*-q)}function Oi(C,s){const g=l.ap(C),x=l.ap(s),T=Math.cos(-g),I=Math.sin(g);return{x:I*Math.sin(x),y:-I*Math.cos(x),z:T}}function Tn(C,s,g){const x=s.intersectsFrustum(C);if(!g||x===0)return x;const T=s.intersectsPlane(g);return T===0?0:x===2&&T===2?2:1}function bi(C,s,g){let x=0;const T=(g-s)/10;for(let I=0;I<10;I++)x+=T*Math.pow(Math.cos(s+(I+.5)/10*(g-s)),C);return x}function ki(C,s){return function(g,x,T,I,O){const z=2*((C-1)/l.at(Math.cos(l.ap(Qe-O))/Math.cos(l.ap(Qe)))-1),G=Math.acos(T/I),q=2*bi(z-1,0,l.ap(O/2)),J=Math.min(l.ap(Qe),G+l.ap(O/2)),re=bi(z-1,Math.min(J,G-l.ap(O/2)),J),ie=Math.atan(x/T),ce=Math.hypot(x,T);let _e=g;return _e+=l.at(I/ce/Math.max(.5,Math.cos(l.ap(O/2)))),_e+=z*l.at(Math.cos(ie))/2,_e-=l.at(Math.max(1,re/q/s))/2,_e}}const qi=ki(9.314,3);function Bn(C,s){const g=(s.roundZoom?Math.round:Math.floor)(C.zoom+l.at(C.tileSize/s.tileSize));return Math.max(0,g)}function er(C,s){const g=C.getCameraFrustum(),x=C.getClippingPlane(),T=C.screenPointToMercatorCoordinate(C.getCameraPoint()),I=l.a9.fromLngLat(C.center,C.elevation);T.z=I.z+Math.cos(C.pitchInRadians)*C.cameraToCenterDistance/C.worldSize;const O=C.getCoveringTilesDetailsProvider(),z=O.allowVariableZoom(C,s),G=Bn(C,s),q=s.minzoom||0,J=s.maxzoom!==void 0?s.maxzoom:C.maxZoom,re=Math.min(Math.max(0,G),J),ie=Math.pow(2,re),ce=[ie*T.x,ie*T.y,0],_e=[ie*I.x,ie*I.y,0],Me=Math.hypot(I.x-T.x,I.y-T.y),Pe=Math.abs(I.z-T.z),Ce=Math.hypot(Me,Pe),Oe=Ge=>({zoom:0,x:0,y:0,wrap:Ge,fullyVisible:!1}),We=[],ke=[];if(C.renderWorldCopies&&O.allowWorldCopies())for(let Ge=1;Ge<=3;Ge++)We.push(Oe(-Ge)),We.push(Oe(Ge));for(We.push(Oe(0));We.length>0;){const Ge=We.pop(),Xe=Ge.x,Ue=Ge.y;let et=Ge.fullyVisible;const At={x:Xe,y:Ue,z:Ge.zoom},pt=O.getTileBoundingVolume(At,Ge.wrap,C.elevation,s);if(!et){const ii=Tn(g,pt,x);if(ii===0)continue;et=ii===2}const bt=O.distanceToTile2d(T.x,T.y,At,pt);let _t=G;z&&(_t=(s.calculateTileZoom||qi)(C.zoom+l.at(C.tileSize/s.tileSize),bt,Pe,Ce,C.fov)),_t=(s.roundZoom?Math.round:Math.floor)(_t),_t=Math.max(0,_t);const ti=Math.min(_t,J);if(Ge.wrap=O.getWrap(I,At,Ge.wrap),Ge.zoom>=ti){if(Ge.zoom<q)continue;const ii=re-Ge.zoom,Wt=ce[0]-.5-(Xe<<ii),ri=ce[1]-.5-(Ue<<ii),Ji=s.reparseOverscaled?Math.max(Ge.zoom,_t):Ge.zoom;ke.push({tileID:new l.a2(Ge.zoom===J?Ji:Ge.zoom,Ge.wrap,Ge.zoom,Xe,Ue),distanceSq:l.au([_e[0]-.5-Xe,_e[1]-.5-Ue]),tileDistanceToCamera:Math.sqrt(Wt*Wt+ri*ri)})}else for(let ii=0;ii<4;ii++)We.push({zoom:Ge.zoom+1,x:(Xe<<1)+ii%2,y:(Ue<<1)+(ii>>1),wrap:Ge.wrap,fullyVisible:et})}return ke.sort(((Ge,Xe)=>Ge.distanceSq-Xe.distanceSq)).map((Ge=>Ge.tileID))}const Kr=l.aa.fromPoints([new l.P(0,0),new l.P(l.a5,l.a5)]);function es(C){return C==="raster"||C==="image"||C==="video"}function tr(C,s,g,x,T,I,O){if(!s.hasData())return!1;const{tileID:z,fadingRole:G,fadingDirection:q,fadingParentID:J}=s;if(G===Fe.Base&&q===He.Incoming&&J)return g[J.key]=J,!0;const re=Math.max(z.overscaledZ-T,I);for(let ie=z.overscaledZ-1;ie>=re;ie--){const ce=z.scaledTo(ie),_e=C.getLoadedTile(ce);if(_e)return s.setCrossFadeLogic({fadingRole:Fe.Base,fadingDirection:He.Incoming,fadingParentID:_e.tileID,fadeEndTime:x+O}),_e.setCrossFadeLogic({fadingRole:Fe.Parent,fadingDirection:He.Departing,fadeEndTime:x+O}),g[ce.key]=ce,!0}return!1}function $i(C,s,g,x,T,I){if(!s.hasData())return!1;const O=s.tileID.children(T);let z=Vt(C,s,O,g,x,T,I);if(z)return!0;for(const G of O)Vt(C,s,G.children(T),g,x,T,I)&&(z=!0);return z}function Vt(C,s,g,x,T,I,O){if(g[0].overscaledZ>=I)return!1;let z=!1;for(const G of g){const q=C.getLoadedTile(G);if(!q)continue;const{fadingRole:J,fadingDirection:re,fadingParentID:ie}=q;J===Fe.Base&&re===He.Departing&&ie||(q.setCrossFadeLogic({fadingRole:Fe.Base,fadingDirection:He.Departing,fadingParentID:s.tileID,fadeEndTime:T+O}),s.setCrossFadeLogic({fadingRole:Fe.Parent,fadingDirection:He.Incoming,fadeEndTime:T+O})),x[G.key]=G,z=!0}return z}function Ar(C,s,g,x){const T=C.tileID;return!!C.selfFading||!C.hasData()&&!!s.has(T)&&(C.setSelfFadeLogic(g+x),!0)}function Cs(C,s){var g;C.needsHillshadePrepare=!0,C.needsTerrainPrepare=!0;let x=s.tileID.canonical.x-C.tileID.canonical.x;const T=s.tileID.canonical.y-C.tileID.canonical.y,I=Math.pow(2,C.tileID.canonical.z),O=s.tileID.key;x===0&&T===0||Math.abs(T)>1||(Math.abs(x)>1&&(Math.abs(x+I)===1?x+=I:Math.abs(x-I)===1&&(x-=I)),s.dem&&C.dem&&(C.dem.backfillBorder(s.dem,x,T),!((g=C.neighboringTiles)===null||g===void 0)&&g[O]&&(C.neighboringTiles[O].backfilled=!0)))}class ts{constructor(){this._tiles={}}handleWrapJump(s){const g={};for(const x in this._tiles){const T=this._tiles[x];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+s),g[T.tileID.key]=T}this._tiles=g}setFeatureState(s,g){for(const x in this._tiles)this._tiles[x].setFeatureState(s,g)}getAllTiles(){return Object.values(this._tiles)}getAllIds(s=!1){return s?Object.values(this._tiles).map((g=>g.tileID)).sort(l.aw).map((g=>g.key)):Object.keys(this._tiles)}getTileById(s){return this._tiles[s]}setTile(s,g){this._tiles[s]=g}deleteTileById(s){delete this._tiles[s]}getLoadedTile(s){const g=this.getTileById(s.key);return g!=null&&g.hasData()?g:null}isIdRenderable(s,g=!1){var x;return(x=this.getTileById(s))===null||x===void 0?void 0:x.isRenderable(g)}getRenderableIds(s=0,g){const x=[];for(const T of this.getAllIds())this.isIdRenderable(T,g)&&x.push(this.getTileById(T));return g?x.sort(((T,I)=>{const O=T.tileID,z=I.tileID,G=new l.P(O.canonical.x,O.canonical.y)._rotate(-s),q=new l.P(z.canonical.x,z.canonical.y)._rotate(-s);return O.overscaledZ-z.overscaledZ||q.y-G.y||q.x-G.x})).map((T=>T.tileID.key)):x.map((T=>T.tileID)).sort(l.aw).map((T=>T.key))}}class vn extends l.E{constructor(s,g,x){super(),this.id=s,this.dispatcher=x,this.on("data",(T=>this._dataHandler(T))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((T,I,O,z)=>{const G=new(hh(I.type))(T,I,O,z);if(G.id!==T)throw new Error(`Expected Source id to be ${T} instead of ${G.id}`);return G})(s,g,x,this),this._inViewTiles=new ts,this._outOfViewCache=new l.ax(0,(T=>this._unloadTile(T))),this._timers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._rasterFadeDuration=0,this._maxFadingAncestorLevels=5,this._state=new xt,this._didEmitContent=!1,this._updated=!1}onAdd(s){this.map=s,this._maxTileCacheSize=s?s._maxTileCacheSize:null,this._maxTileCacheZoomLevels=s?s._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(s)}onRemove(s){for(const g of this._inViewTiles.getAllTiles())g.unloadVectorData();this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(s),this._inViewTiles=new ts}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const s of this._inViewTiles.getAllTiles())if(s.state!=="loaded"&&s.state!=="errored")return!1;return!0}getSource(){return this._source}getState(){return this._state}pause(){this._paused=!0}resume(){if(!this._paused)return;const s=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,s&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(s,g,x){return l._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(s),this._tileLoaded(s,g,x)}catch(T){s.state="errored",T.status!==404?this._source.fire(new l.k(T,{tile:s})):this.update(this.transform,this.terrain)}}))}_unloadTile(s){this._source.unloadTile&&this._source.unloadTile(s)}_abortTile(s){this._source.abortTile&&this._source.abortTile(s),this._source.fire(new l.l("dataabort",{tile:s,coord:s.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(s){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._inViewTiles,this.map?this.map.painter:null);for(const g of this._inViewTiles.getAllTiles())g.upload(s),g.prepare(this.map.style.imageManager)}getIds(){return this._inViewTiles.getAllIds(!0)}getRenderableIds(s){var g;return this._inViewTiles.getRenderableIds((g=this.transform)===null||g===void 0?void 0:g.bearingInRadians,s)}hasRenderableParent(s){const g=s.overscaledZ-1;if(g>=this._source.minzoom){const x=this.getLoadedTile(s.scaledTo(g));if(x)return this._inViewTiles.isIdRenderable(x.tileID.key)}return!1}reload(s,g=void 0){if(this._paused)this._shouldReloadOnResume=!0;else{this._outOfViewCache.reset();for(const x of this._inViewTiles.getAllIds()){const T=this._inViewTiles.getTileById(x);g&&!this._source.shouldReloadTile(T,g)||(s?this._reloadTile(x,"expired"):T.state!=="errored"&&this._reloadTile(x,"reloading"))}}}_reloadTile(s,g){return l._(this,void 0,void 0,(function*(){const x=this._inViewTiles.getTileById(s);x&&(x.state!=="loading"&&(x.state=g),yield this._loadTile(x,s,g))}))}_tileLoaded(s,g,x){s.timeAdded=Ae(),s.selfFading&&(s.fadeEndTime=s.timeAdded+this._rasterFadeDuration),x==="expired"&&(s.refreshedUponExpiration=!0),this._setTileReloadTimer(g,s),this.getSource().type==="raster-dem"&&s.dem&&(function(T,I){var O,z;const G=I.getRenderableIds();for(const q of G){if(!T.neighboringTiles||!T.neighboringTiles[q])continue;const J=I.getTileById(q);T.neighboringTiles[q].backfilled||Cs(T,J),!((z=(O=J.neighboringTiles)===null||O===void 0?void 0:O[T.tileID.key])===null||z===void 0)&&z.backfilled||Cs(J,T)}})(s,this._inViewTiles),this._state.initializeTileState(s,this.map?this.map.painter:null),s.aborted||this._source.fire(new l.l("data",{dataType:"source",tile:s,coord:s.tileID}))}getTile(s){return this.getTileByID(s.key)}getTileByID(s){return this._inViewTiles.getTileById(s)}_retainLoadedChildren(s,g){const x=this._getLoadedDescendents(g),T=new Set;for(const I of g){const O=x[I.key];if(!(O!=null&&O.length)){T.add(I);continue}const z=I.overscaledZ+vn.maxOverzooming,G=O.filter((re=>re.tileID.overscaledZ<=z));if(!G.length){T.add(I);continue}const q=Math.min(...G.map((re=>re.tileID.overscaledZ))),J=G.filter((re=>re.tileID.overscaledZ===q)).map((re=>re.tileID));for(const re of J)s[re.key]=re;this._areDescendentsComplete(J,q,I.overscaledZ)||T.add(I)}return T}_getLoadedDescendents(s){var g;const x={};for(const T of this._inViewTiles.getAllTiles().filter((I=>I.hasData())))for(const I of s)T.tileID.isChildOf(I)&&(x[g=I.key]||(x[g]=[])).push(T);return x}_areDescendentsComplete(s,g,x){return s.length===1&&s[0].isOverscaled()?s[0].overscaledZ===g:Math.pow(4,g-x)===s.length}getLoadedTile(s){return this._inViewTiles.getLoadedTile(s)}updateCacheSize(s){const g=Math.ceil(s.width/this._source.tileSize)+1,x=Math.ceil(s.height/this._source.tileSize)+1,T=Math.floor(g*x*(this._maxTileCacheZoomLevels===null?l.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),I=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,T):T;this._outOfViewCache.setMaxSize(I)}handleWrapJump(s){const g=Math.round((s-(this._prevLng===void 0?s:this._prevLng))/360);this._prevLng=s,g&&(this._inViewTiles.handleWrapJump(g),this._resetTileReloadTimers())}update(s,g){if(!this._sourceLoaded||this._paused)return;let x;this.transform=s,this.terrain=g,this.updateCacheSize(s),this.handleWrapJump(this.transform.center.lng),this.used||this.usedForTerrain?this._source.tileID?x=s.getVisibleUnwrappedCoordinates(this._source.tileID).map((G=>new l.a2(G.canonical.z,G.wrap,G.canonical.z,G.canonical.x,G.canonical.y))):(x=er(s,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.type==="vector"&&this.map._zoomLevelsToOverscale!==void 0?s.maxZoom-this.map._zoomLevelsToOverscale:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:g,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(x=x.filter((G=>this._source.hasTile(G))))):x=[],this.usedForTerrain&&(x=this._addTerrainIdealTiles(x));const T=x.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,T&&this.fire(new l.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const I=Bn(s,this._source),O=this._updateRetainedTiles(x,I),z=es(this._source.type);z&&this._rasterFadeDuration>0&&!g&&(function(G,q,J,re,ie,ce,_e){const Me=Ae(),Pe=l.av(q);for(const Ce of q){const Oe=G.getTileById(Ce.key);Oe.fadingDirection!==He.Departing&&Oe.fadeOpacity!==0||Oe.resetFadeLogic(),tr(G,Oe,J,Me,re,ie,_e)||$i(G,Oe,J,Me,ce,_e)||Ar(Oe,Pe,Me,_e)||Oe.resetFadeLogic()}})(this._inViewTiles,x,O,this._maxFadingAncestorLevels,this._source.minzoom,this._source.maxzoom,this._rasterFadeDuration),z?this._cleanUpRasterTiles(O):this._cleanUpVectorTiles(O)}_cleanUpRasterTiles(s){for(const g of this._inViewTiles.getAllIds())s[g]||this._removeTile(g)}_cleanUpVectorTiles(s){for(const g of this._inViewTiles.getAllIds()){const x=this._inViewTiles.getTileById(g);s[g]?x.clearSymbolFadeHold():x.hasSymbolBuckets?x.holdingForSymbolFade()?x.symbolFadeFinished()&&this._removeTile(g):x.setSymbolHoldDuration(this.map._fadeDuration):this._removeTile(g)}}_addTerrainIdealTiles(s){const g=[];for(const x of s)if(x.canonical.z>this._source.minzoom){const T=x.scaledTo(x.canonical.z-1);g.push(T);const I=x.scaledTo(Math.max(this._source.minzoom,Math.min(x.canonical.z,5)));g.push(I)}return s.concat(g)}releaseSymbolFadeTiles(){for(const s of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(s).holdingForSymbolFade()&&this._removeTile(s)}_updateRetainedTiles(s,g){var x;const T=new Set;for(const q of s)this._addTile(q).hasData()||T.add(q);const I=s.reduce(((q,J)=>(q[J.key]=J,q)),{}),O=this._retainLoadedChildren(I,T),z={},G=Math.max(g-vn.maxUnderzooming,this._source.minzoom);for(const q of O){let J=this._inViewTiles.getTileById(q.key),re=J==null?void 0:J.wasRequested();for(let ie=q.overscaledZ-1;ie>=G;--ie){const ce=q.scaledTo(ie);if(z[ce.key])break;if(z[ce.key]=!0,J=this.getTile(ce),!J&&re&&(J=this._addTile(ce)),J){const _e=J.hasData();if((_e||!(!((x=this.map)===null||x===void 0)&&x.cancelPendingTileRequestsWhileZooming)||re)&&(I[ce.key]=ce),re=J.wasRequested(),_e)break}}}return I}_addTile(s){let g=this._inViewTiles.getTileById(s.key);if(g)return g;g=this._outOfViewCache.getAndRemove(s),g&&(g.resetFadeLogic(),this._setTileReloadTimer(s.key,g),g.tileID=s,this._state.initializeTileState(g,this.map?this.map.painter:null));const x=g;return g||(g=new st(s,this._source.tileSize*s.overscaleFactor()),this._loadTile(g,s.key,g.state)),g.uses++,this._inViewTiles.setTile(s.key,g),x||this._source.fire(new l.l("dataloading",{tile:g,coord:g.tileID,dataType:"source"})),g}_setTileReloadTimer(s,g){this._clearTileReloadTimer(s);const x=g.getExpiryTimeout();x&&(this._timers[s]=setTimeout((()=>{this._reloadTile(s,"expired"),delete this._timers[s]}),x))}_clearTileReloadTimer(s){const g=this._timers[s];g&&(clearTimeout(g),delete this._timers[s])}_resetTileReloadTimers(){for(const s in this._timers)clearTimeout(this._timers[s]),delete this._timers[s];for(const s of this._inViewTiles.getAllIds()){const g=this._inViewTiles.getTileById(s);this._setTileReloadTimer(s,g)}}refreshTiles(s){for(const g of this._inViewTiles.getAllIds()){const x=this._inViewTiles.getTileById(g);(this._inViewTiles.isIdRenderable(g)||x.state=="errored")&&s.some((T=>T.equals(x.tileID.canonical)))&&this._reloadTile(g,"expired")}}_removeTile(s){const g=this._inViewTiles.getTileById(s);g&&(g.uses--,this._inViewTiles.deleteTileById(s),this._clearTileReloadTimer(s),g.uses>0||(g.hasData()&&g.state!=="reloading"?this._outOfViewCache.add(g.tileID,g,g.getExpiryTimeout()):(g.aborted=!0,this._abortTile(g),this._unloadTile(g))))}_dataHandler(s){s.dataType==="source"&&(s.sourceDataType!=="metadata"?s.sourceDataType==="content"&&this._sourceLoaded&&!this._paused&&(this.reload(s.sourceDataChanged,s.shouldReloadTileOptions),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0):this._sourceLoaded=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const s of this._inViewTiles.getAllIds())this._removeTile(s);this._outOfViewCache.reset()}tilesIn(s,g,x){const T=[],I=this.transform;if(!I)return T;const O=I.getCoveringTilesDetailsProvider().allowWorldCopies(),z=x?I.getCameraQueryGeometry(s):s,G=ce=>I.screenPointToMercatorCoordinate(ce,this.terrain),q=this.transformBbox(s,G,!O),J=this.transformBbox(z,G,!O),re=this.getIds(),ie=l.aa.fromPoints(J);for(let ce=0;ce<re.length;ce++){const _e=this._inViewTiles.getTileById(re[ce]);if(_e.holdingForSymbolFade())continue;const Me=O?[_e.tileID]:[_e.tileID.unwrapTo(-1),_e.tileID.unwrapTo(0)],Pe=Math.pow(2,I.zoom-_e.tileID.overscaledZ),Ce=g*_e.queryPadding*l.a5/_e.tileSize/Pe;for(const Oe of Me){const We=ie.map((ke=>Oe.getTilePoint(new l.a9(ke.x,ke.y))));if(We.expandBy(Ce),We.intersects(Kr)){const ke=q.map((Xe=>Oe.getTilePoint(Xe))),Ge=J.map((Xe=>Oe.getTilePoint(Xe)));T.push({tile:_e,tileID:O?Oe:Oe.unwrapTo(0),queryGeometry:ke,cameraQueryGeometry:Ge,scale:Pe})}}}return T}transformBbox(s,g,x){let T=s.map(g);if(x){const I=l.aa.fromPoints(s);I.shrinkBy(.001*Math.min(I.width(),I.height()));const O=I.map(g);l.aa.fromPoints(T).covers(O)||(T=T.map((z=>z.x>.5?new l.a9(z.x-1,z.y,z.z):z)))}return T}getVisibleCoordinates(s){const g=this.getRenderableIds(s).map((x=>this._inViewTiles.getTileById(x).tileID));return this.transform&&this.transform.populateCache(g),g}hasTransition(){return!!this._source.hasTransition()||!(!es(this._source.type)||!(function(s,g){if(g<=0)return!1;const x=Ae();for(const T of s.getAllTiles())if(T.fadeEndTime>=x)return!0;return!1})(this._inViewTiles,this._rasterFadeDuration))}setRasterFadeDuration(s){this._rasterFadeDuration=s}setFeatureState(s,g,x){this._state.updateState(s=s||l.ai,g,x)}removeFeatureState(s,g,x){this._state.removeFeatureState(s=s||l.ai,g,x)}getFeatureState(s,g){return this._state.getState(s=s||l.ai,g)}setDependencies(s,g,x){const T=this._inViewTiles.getTileById(s);T&&T.setDependencies(g,x)}reloadTilesForDependencies(s,g){for(const x of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(x).hasDependency(s,g)&&this._reloadTile(x,"reloading");this._outOfViewCache.filter((x=>!x.hasDependency(s,g)))}areTilesLoaded(){for(const s of this._inViewTiles.getAllTiles())if(s.state!=="loaded"&&s.state!=="errored")return!1;return!0}}vn.maxUnderzooming=10,vn.maxOverzooming=3;class ei{constructor(s,g){this.reset(s,g)}reset(s,g){this.points=s||[],this._distances=[0];for(let x=1;x<this.points.length;x++)this._distances[x]=this._distances[x-1]+this.points[x].dist(this.points[x-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(g||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(s){if(this.points.length===1)return this.points[0];s=l.an(s,0,1);let g=1,x=this._distances[g];const T=s*this.paddedLength+this.padding;for(;x<T&&g<this._distances.length;)x=this._distances[++g];const I=g-1,O=this._distances[I],z=x-O,G=z>0?(T-O)/z:0;return this.points[I].mult(1-G).add(this.points[g].mult(G))}}function Xi(C,s){let g=!0;return C==="always"||C!=="never"&&s!=="never"||(g=!1),g}class en{constructor(s,g,x){const T=this.boxCells=[],I=this.circleCells=[];this.xCellCount=Math.ceil(s/x),this.yCellCount=Math.ceil(g/x);for(let O=0;O<this.xCellCount*this.yCellCount;O++)T.push([]),I.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=s,this.height=g,this.xScale=this.xCellCount/s,this.yScale=this.yCellCount/g,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(s,g,x,T,I){this._forEachCell(g,x,T,I,this._insertBoxCell,this.boxUid++),this.boxKeys.push(s),this.bboxes.push(g),this.bboxes.push(x),this.bboxes.push(T),this.bboxes.push(I)}insertCircle(s,g,x,T){this._forEachCell(g-T,x-T,g+T,x+T,this._insertCircleCell,this.circleUid++),this.circleKeys.push(s),this.circles.push(g),this.circles.push(x),this.circles.push(T)}_insertBoxCell(s,g,x,T,I,O){this.boxCells[I].push(O)}_insertCircleCell(s,g,x,T,I,O){this.circleCells[I].push(O)}_query(s,g,x,T,I,O,z){if(x<0||s>this.width||T<0||g>this.height)return[];const G=[];if(s<=0&&g<=0&&this.width<=x&&this.height<=T){if(I)return[{key:null,x1:s,y1:g,x2:x,y2:T}];for(let q=0;q<this.boxKeys.length;q++)G.push({key:this.boxKeys[q],x1:this.bboxes[4*q],y1:this.bboxes[4*q+1],x2:this.bboxes[4*q+2],y2:this.bboxes[4*q+3]});for(let q=0;q<this.circleKeys.length;q++){const J=this.circles[3*q],re=this.circles[3*q+1],ie=this.circles[3*q+2];G.push({key:this.circleKeys[q],x1:J-ie,y1:re-ie,x2:J+ie,y2:re+ie})}}else this._forEachCell(s,g,x,T,this._queryCell,G,{hitTest:I,overlapMode:O,seenUids:{box:{},circle:{}}},z);return G}query(s,g,x,T){return this._query(s,g,x,T,!1,null)}hitTest(s,g,x,T,I,O){return this._query(s,g,x,T,!0,I,O).length>0}hitTestCircle(s,g,x,T,I){const O=s-x,z=s+x,G=g-x,q=g+x;if(z<0||O>this.width||q<0||G>this.height)return!1;const J=[];return this._forEachCell(O,G,z,q,this._queryCellCircle,J,{hitTest:!0,overlapMode:T,circle:{x:s,y:g,radius:x},seenUids:{box:{},circle:{}}},I),J.length>0}_queryCell(s,g,x,T,I,O,z,G){const{seenUids:q,hitTest:J,overlapMode:re}=z,ie=this.boxCells[I];if(ie!==null){const _e=this.bboxes;for(const Me of ie)if(!q.box[Me]){q.box[Me]=!0;const Pe=4*Me,Ce=this.boxKeys[Me];if(s<=_e[Pe+2]&&g<=_e[Pe+3]&&x>=_e[Pe+0]&&T>=_e[Pe+1]&&(!G||G(Ce))&&(!J||!Xi(re,Ce.overlapMode))&&(O.push({key:Ce,x1:_e[Pe],y1:_e[Pe+1],x2:_e[Pe+2],y2:_e[Pe+3]}),J))return!0}}const ce=this.circleCells[I];if(ce!==null){const _e=this.circles;for(const Me of ce)if(!q.circle[Me]){q.circle[Me]=!0;const Pe=3*Me,Ce=this.circleKeys[Me];if(this._circleAndRectCollide(_e[Pe],_e[Pe+1],_e[Pe+2],s,g,x,T)&&(!G||G(Ce))&&(!J||!Xi(re,Ce.overlapMode))){const Oe=_e[Pe],We=_e[Pe+1],ke=_e[Pe+2];if(O.push({key:Ce,x1:Oe-ke,y1:We-ke,x2:Oe+ke,y2:We+ke}),J)return!0}}}return!1}_queryCellCircle(s,g,x,T,I,O,z,G){const{circle:q,seenUids:J,overlapMode:re}=z,ie=this.boxCells[I];if(ie!==null){const _e=this.bboxes;for(const Me of ie)if(!J.box[Me]){J.box[Me]=!0;const Pe=4*Me,Ce=this.boxKeys[Me];if(this._circleAndRectCollide(q.x,q.y,q.radius,_e[Pe+0],_e[Pe+1],_e[Pe+2],_e[Pe+3])&&(!G||G(Ce))&&!Xi(re,Ce.overlapMode))return O.push(!0),!0}}const ce=this.circleCells[I];if(ce!==null){const _e=this.circles;for(const Me of ce)if(!J.circle[Me]){J.circle[Me]=!0;const Pe=3*Me,Ce=this.circleKeys[Me];if(this._circlesCollide(_e[Pe],_e[Pe+1],_e[Pe+2],q.x,q.y,q.radius)&&(!G||G(Ce))&&!Xi(re,Ce.overlapMode))return O.push(!0),!0}}}_forEachCell(s,g,x,T,I,O,z,G){const q=this._convertToXCellCoord(s),J=this._convertToYCellCoord(g),re=this._convertToXCellCoord(x),ie=this._convertToYCellCoord(T);for(let ce=q;ce<=re;ce++)for(let _e=J;_e<=ie;_e++)if(I.call(this,s,g,x,T,this.xCellCount*_e+ce,O,z,G))return}_convertToXCellCoord(s){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(s*this.xScale)))}_convertToYCellCoord(s){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(s*this.yScale)))}_circlesCollide(s,g,x,T,I,O){const z=T-s,G=I-g,q=x+O;return q*q>z*z+G*G}_circleAndRectCollide(s,g,x,T,I,O,z){const G=(O-T)/2,q=Math.abs(s-(T+G));if(q>G+x)return!1;const J=(z-I)/2,re=Math.abs(g-(I+J));if(re>J+x)return!1;if(q<=G||re<=J)return!0;const ie=q-G,ce=re-J;return ie*ie+ce*ce<=x*x}}function ba(C,s,g){const x=l.N();if(!C){const{vecSouth:re,vecEast:ie}=bl(s),ce=D();ce[0]=ie[0],ce[1]=ie[1],ce[2]=re[0],ce[3]=re[1],T=ce,(J=(O=(I=ce)[0])*(q=I[3])-(G=I[2])*(z=I[1]))&&(T[0]=q*(J=1/J),T[1]=-z*J,T[2]=-G*J,T[3]=O*J),x[0]=ce[0],x[1]=ce[1],x[4]=ce[2],x[5]=ce[3]}var T,I,O,z,G,q,J;return l.Q(x,x,[1/g,1/g,1]),x}function df(C,s,g,x){if(C){const T=l.N();if(!s){const{vecSouth:I,vecEast:O}=bl(g);T[0]=O[0],T[1]=O[1],T[4]=I[0],T[5]=I[1]}return l.Q(T,T,[x,x,1]),T}return g.pixelsToClipSpaceMatrix}function bl(C){const s=Math.cos(C.rollInRadians),g=Math.sin(C.rollInRadians),x=Math.cos(C.pitchInRadians),T=Math.cos(C.bearingInRadians),I=Math.sin(C.bearingInRadians),O=l.aC();O[0]=-T*x*g-I*s,O[1]=-I*x*g+T*s;const z=l.aD(O);z<1e-9?l.aE(O):l.aF(O,O,1/z);const G=l.aC();G[0]=T*x*s-I*g,G[1]=I*x*s+T*g;const q=l.aD(G);return q<1e-9?l.aE(G):l.aF(G,G,1/q),{vecEast:G,vecSouth:O}}function Yi(C,s,g,x){let T;x?(T=[C,s,x(C,s),1],l.aH(T,T,g)):(T=[C,s,0,1],Io(T,T,g));const I=T[3];return{point:new l.P(T[0]/I,T[1]/I),signedDistanceFromCamera:I,isOccluded:!1}}function Ko(C,s){return .5+C/s*.5}function Al(C,s){return C.x>=-s[0]&&C.x<=s[0]&&C.y>=-s[1]&&C.y<=s[1]}function rc(C,s,g,x,T,I,O,z,G,q,J,re,ie){const ce=g?C.textSizeData:C.iconSizeData,_e=l.ay(ce,s.transform.zoom),Me=[256/s.width*2+1,256/s.height*2+1],Pe=g?C.text.dynamicLayoutVertexArray:C.icon.dynamicLayoutVertexArray;Pe.clear();const Ce=C.lineVertexArray,Oe=g?C.text.placedSymbolArray:C.icon.placedSymbolArray,We=s.transform.width/s.transform.height;let ke=!1;for(let Ge=0;Ge<Oe.length;Ge++){const Xe=Oe.get(Ge);if(Xe.hidden||Xe.writingMode===l.az.vertical&&!ke){Tl(Xe.numGlyphs,Pe);continue}ke=!1;const Ue=new l.P(Xe.anchorX,Xe.anchorY),et={getElevation:ie,pitchedLabelPlaneMatrix:x,lineVertexArray:Ce,pitchWithMap:I,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:s.transform,tileAnchorPoint:Ue,unwrappedTileID:G,width:q,height:J,translation:re},At=hu(Xe.anchorX,Xe.anchorY,et);if(!Al(At.point,Me)){Tl(Xe.numGlyphs,Pe);continue}const pt=Ko(s.transform.cameraToCenterDistance,At.signedDistanceFromCamera),bt=l.aA(ce,_e,Xe),_t=I?bt*s.transform.getPitchedTextCorrection(Xe.anchorX,Xe.anchorY,G)/pt:bt*pt,ti=cr({projectionContext:et,pitchedLabelPlaneMatrixInverse:T,symbol:Xe,fontSize:_t,flip:!1,keepUpright:O,glyphOffsetArray:C.glyphOffsetArray,dynamicLayoutVertexArray:Pe,aspectRatio:We,rotateToLine:z});ke=ti.useVertical,(ti.notEnoughRoom||ke||ti.needsFlipping&&cr({projectionContext:et,pitchedLabelPlaneMatrixInverse:T,symbol:Xe,fontSize:_t,flip:!0,keepUpright:O,glyphOffsetArray:C.glyphOffsetArray,dynamicLayoutVertexArray:Pe,aspectRatio:We,rotateToLine:z}).notEnoughRoom)&&Tl(Xe.numGlyphs,Pe)}g?C.text.dynamicLayoutVertexBuffer.updateData(Pe):C.icon.dynamicLayoutVertexBuffer.updateData(Pe)}function wl(C,s,g,x,T,I,O,z){const G=I.glyphStartIndex+I.numGlyphs,q=I.lineStartIndex,J=I.lineStartIndex+I.lineLength,re=s.getoffsetX(I.glyphStartIndex),ie=s.getoffsetX(G-1),ce=el(C*re,g,x,T,I.segment,q,J,z,O);if(!ce)return null;const _e=el(C*ie,g,x,T,I.segment,q,J,z,O);return _e?z.projectionCache.anyProjectionOccluded?null:{first:ce,last:_e}:null}function Ba(C,s,g,x){return C===l.az.horizontal&&Math.abs(g.y-s.y)>Math.abs(g.x-s.x)*x?{useVertical:!0}:(C===l.az.vertical?s.y<g.y:s.x>g.x)?{needsFlipping:!0}:null}function cr(C){const{projectionContext:s,pitchedLabelPlaneMatrixInverse:g,symbol:x,fontSize:T,flip:I,keepUpright:O,glyphOffsetArray:z,dynamicLayoutVertexArray:G,aspectRatio:q,rotateToLine:J}=C,re=T/24,ie=x.lineOffsetX*re,ce=x.lineOffsetY*re;let _e;if(x.numGlyphs>1){const Me=x.glyphStartIndex+x.numGlyphs,Pe=x.lineStartIndex,Ce=x.lineStartIndex+x.lineLength,Oe=wl(re,z,ie,ce,I,x,J,s);if(!Oe)return{notEnoughRoom:!0};const We=aa(Oe.first.point.x,Oe.first.point.y,s,g),ke=aa(Oe.last.point.x,Oe.last.point.y,s,g);if(O&&!I){const Ge=Ba(x.writingMode,We,ke,q);if(Ge)return Ge}_e=[Oe.first];for(let Ge=x.glyphStartIndex+1;Ge<Me-1;Ge++){const Xe=el(re*z.getoffsetX(Ge),ie,ce,I,x.segment,Pe,Ce,s,J);if(!Xe)return{notEnoughRoom:!0};_e.push(Xe)}_e.push(Oe.last)}else{if(O&&!I){const Pe=En(s.tileAnchorPoint.x,s.tileAnchorPoint.y,s).point,Ce=x.lineStartIndex+x.segment+1,Oe=new l.P(s.lineVertexArray.getx(Ce),s.lineVertexArray.gety(Ce)),We=En(Oe.x,Oe.y,s),ke=We.signedDistanceFromCamera>0?We.point:Bc(s.tileAnchorPoint,Oe,Pe,1,s),Ge=aa(Pe.x,Pe.y,s,g),Xe=aa(ke.x,ke.y,s,g),Ue=Ba(x.writingMode,Ge,Xe,q);if(Ue)return Ue}const Me=el(re*z.getoffsetX(x.glyphStartIndex),ie,ce,I,x.segment,x.lineStartIndex,x.lineStartIndex+x.lineLength,s,J);if(!Me||s.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};_e=[Me]}for(const Me of _e)l.aG(G,Me.point,Me.angle);return{}}function Bc(C,s,g,x,T){const I=C.add(C.sub(s)._unit()),O=En(I.x,I.y,T).point,z=g.sub(O);return g.add(z._mult(x/z.mag()))}function sa(C,s,g){const x=s.projectionCache;if(x.projections[C])return x.projections[C];const T=new l.P(s.lineVertexArray.getx(C),s.lineVertexArray.gety(C)),I=En(T.x,T.y,s);if(I.signedDistanceFromCamera>0)return x.projections[C]=I.point,x.anyProjectionOccluded=x.anyProjectionOccluded||I.isOccluded,I.point;const O=C-g.direction;return Bc(g.distanceFromAnchor===0?s.tileAnchorPoint:new l.P(s.lineVertexArray.getx(O),s.lineVertexArray.gety(O)),T,g.previousVertex,g.absOffsetX-g.distanceFromAnchor+1,s)}function En(C,s,g){const x=C+g.translation[0],T=s+g.translation[1];let I;return g.pitchWithMap?(I=Yi(x,T,g.pitchedLabelPlaneMatrix,g.getElevation),I.isOccluded=!1):(I=g.transform.projectTileCoordinates(x,T,g.unwrappedTileID,g.getElevation),I.point.x=(.5*I.point.x+.5)*g.width,I.point.y=(.5*-I.point.y+.5)*g.height),I}function aa(C,s,g,x){if(g.pitchWithMap){const T=[C,s,0,1];return l.aH(T,T,x),g.transform.projectTileCoordinates(T[0]/T[3],T[1]/T[3],g.unwrappedTileID,g.getElevation).point}return{x:C/g.width*2-1,y:1-s/g.height*2}}function hu(C,s,g){return g.transform.projectTileCoordinates(C,s,g.unwrappedTileID,g.getElevation)}function fu(C,s,g){return C._unit()._perp()._mult(s*g)}function zc(C,s,g,x,T,I,O,z,G){if(z.projectionCache.offsets[C])return z.projectionCache.offsets[C];const q=g.add(s);if(C+G.direction<x||C+G.direction>=T)return z.projectionCache.offsets[C]=q,q;const J=sa(C+G.direction,z,G),re=fu(J.sub(g),O,G.direction),ie=g.add(re),ce=J.add(re);return z.projectionCache.offsets[C]=l.aI(I,q,ie,ce)||q,z.projectionCache.offsets[C]}function el(C,s,g,x,T,I,O,z,G){const q=x?C-s:C+s;let J=q>0?1:-1,re=0;x&&(J*=-1,re=Math.PI),J<0&&(re+=Math.PI);let ie,ce=J>0?I+T:I+T+1;z.projectionCache.cachedAnchorPoint?ie=z.projectionCache.cachedAnchorPoint:(ie=En(z.tileAnchorPoint.x,z.tileAnchorPoint.y,z).point,z.projectionCache.cachedAnchorPoint=ie);let _e,Me,Pe=ie,Ce=ie,Oe=0,We=0;const ke=Math.abs(q),Ge=[];let Xe;for(;Oe+We<=ke;){if(ce+=J,ce<I||ce>=O)return null;Oe+=We,Ce=Pe,Me=_e;const At={absOffsetX:ke,direction:J,distanceFromAnchor:Oe,previousVertex:Ce};if(Pe=sa(ce,z,At),g===0)Ge.push(Ce),Xe=Pe.sub(Ce);else{let pt;const bt=Pe.sub(Ce);pt=bt.mag()===0?fu(sa(ce+J,z,At).sub(Pe),g,J):fu(bt,g,J),Me||(Me=Ce.add(pt)),_e=zc(ce,pt,Pe,I,O,Me,g,z,At),Ge.push(Me),Xe=_e.sub(Me)}We=Xe.mag()}const Ue=Xe._mult((ke-Oe)/We)._add(Me||Ce),et=re+Math.atan2(Pe.y-Ce.y,Pe.x-Ce.x);return Ge.push(Ue),{point:Ue,angle:G?et:0,path:Ge}}const du=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Tl(C,s){for(let g=0;g<C;g++){const x=s.length;s.resize(x+4),s.float32.set(du,3*x)}}function Io(C,s,g){const x=s[0],T=s[1];return C[0]=g[0]*x+g[4]*T+g[12],C[1]=g[1]*x+g[5]*T+g[13],C[3]=g[3]*x+g[7]*T+g[15],C}const kn=100;class fh{constructor(s,g=new en(s.width+200,s.height+200,25),x=new en(s.width+200,s.height+200,25)){this.transform=s,this.grid=g,this.ignoredGrid=x,this.pitchFactor=Math.cos(s.pitch*Math.PI/180)*s.cameraToCenterDistance,this.screenRightBoundary=s.width+kn,this.screenBottomBoundary=s.height+kn,this.gridRightBoundary=s.width+200,this.gridBottomBoundary=s.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(s,g,x,T,I,O,z,G,q,J,re,ie){const ce=this.projectAndGetPerspectiveRatio(s.anchorPointX+G[0],s.anchorPointY+G[1],I,J,ie),_e=x*ce.perspectiveRatio;let Me;if(O||z)Me=this._projectCollisionBox(s,_e,T,I,O,z,G,ce,J,re,ie);else{const Xe=ce.x+(re?re.x*_e:0),Ue=ce.y+(re?re.y*_e:0);Me={allPointsOccluded:!1,box:[Xe+s.x1*_e,Ue+s.y1*_e,Xe+s.x2*_e,Ue+s.y2*_e]}}const[Pe,Ce,Oe,We]=Me.box,ke=O?Me.allPointsOccluded:ce.isOccluded;let Ge=ke;return Ge||(Ge=ce.perspectiveRatio<this.perspectiveRatioCutoff),Ge||(Ge=!this.isInsideGrid(Pe,Ce,Oe,We)),Ge||g!=="always"&&this.grid.hitTest(Pe,Ce,Oe,We,g,q)?{box:[Pe,Ce,Oe,We],placeable:!1,offscreen:!1,occluded:ke}:{box:[Pe,Ce,Oe,We],placeable:!0,offscreen:this.isOffscreen(Pe,Ce,Oe,We),occluded:ke}}placeCollisionCircles(s,g,x,T,I,O,z,G,q,J,re,ie,ce,_e){const Me=[],Pe=new l.P(g.anchorX,g.anchorY),Ce=this.getPerspectiveRatio(Pe.x,Pe.y,O,_e),Oe=(q?I*this.transform.getPitchedTextCorrection(g.anchorX,g.anchorY,O)/Ce:I*Ce)/l.aM,We={getElevation:_e,pitchedLabelPlaneMatrix:z,lineVertexArray:x,pitchWithMap:q,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:Pe,unwrappedTileID:O,width:this.transform.width,height:this.transform.height,translation:ce},ke=wl(Oe,T,g.lineOffsetX*Oe,g.lineOffsetY*Oe,!1,g,!1,We);let Ge=!1,Xe=!1,Ue=!0;if(ke){const et=.5*re*Ce+ie,At=new l.P(-100,-100),pt=new l.P(this.screenRightBoundary,this.screenBottomBoundary),bt=new ei,_t=ke.first,ti=ke.last;let ii=[];for(let Ji=_t.path.length-1;Ji>=1;Ji--)ii.push(_t.path[Ji]);for(let Ji=1;Ji<ti.path.length;Ji++)ii.push(ti.path[Ji]);const Wt=2.5*et;if(q){const Ji=this.projectPathToScreenSpace(ii,We);ii=Ji.some((sn=>sn.signedDistanceFromCamera<=0))?[]:Ji.map((sn=>sn.point))}let ri=[];if(ii.length>0){const Ji=ii[0].clone(),sn=ii[0].clone();for(let rr=1;rr<ii.length;rr++)Ji.x=Math.min(Ji.x,ii[rr].x),Ji.y=Math.min(Ji.y,ii[rr].y),sn.x=Math.max(sn.x,ii[rr].x),sn.y=Math.max(sn.y,ii[rr].y);ri=Ji.x>=At.x&&sn.x<=pt.x&&Ji.y>=At.y&&sn.y<=pt.y?[ii]:sn.x<At.x||Ji.x>pt.x||sn.y<At.y||Ji.y>pt.y?[]:l.aJ([ii],At.x,At.y,pt.x,pt.y)}for(const Ji of ri){bt.reset(Ji,.25*et);let sn=0;sn=bt.length<=.5*et?1:Math.ceil(bt.paddedLength/Wt)+1;for(let rr=0;rr<sn;rr++){const sr=rr/Math.max(sn-1,1),yr=bt.lerp(sr),qn=yr.x+kn,zr=yr.y+kn;Me.push(qn,zr,et,0);const vr=qn-et,Gs=zr-et,Xr=qn+et,jn=zr+et;if(Ue=Ue&&this.isOffscreen(vr,Gs,Xr,jn),Xe=Xe||this.isInsideGrid(vr,Gs,Xr,jn),s!=="always"&&this.grid.hitTestCircle(qn,zr,et,s,J)&&(Ge=!0,!G))return{circles:[],offscreen:!1,collisionDetected:Ge}}}}return{circles:!G&&Ge||!Xe||Ce<this.perspectiveRatioCutoff?[]:Me,offscreen:Ue,collisionDetected:Ge}}projectPathToScreenSpace(s,g){const x=(function(T,I){const O=l.N();return l.aB(O,I.pitchedLabelPlaneMatrix),T.map((z=>{const G=Yi(z.x,z.y,O,I.getElevation),q=I.transform.projectTileCoordinates(G.point.x,G.point.y,I.unwrappedTileID,I.getElevation);return q.point.x=(.5*q.point.x+.5)*I.width,q.point.y=(.5*-q.point.y+.5)*I.height,q}))})(s,g);return(function(T){let I=0,O=0,z=0,G=0;for(let q=0;q<T.length;q++)T[q].isOccluded?(z=q+1,G=0):(G++,G>O&&(O=G,I=z));return T.slice(I,I+O)})(x)}queryRenderedSymbols(s){if(s.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const g=[],x=new l.aa;for(const re of s){const ie=new l.P(re.x+kn,re.y+kn);x.extend(ie),g.push(ie)}const{minX:T,minY:I,maxX:O,maxY:z}=x,G=this.grid.query(T,I,O,z).concat(this.ignoredGrid.query(T,I,O,z)),q={},J={};for(const re of G){const ie=re.key;if(q[ie.bucketInstanceId]===void 0&&(q[ie.bucketInstanceId]={}),q[ie.bucketInstanceId][ie.featureIndex])continue;const ce=[new l.P(re.x1,re.y1),new l.P(re.x2,re.y1),new l.P(re.x2,re.y2),new l.P(re.x1,re.y2)];l.aK(g,ce)&&(q[ie.bucketInstanceId][ie.featureIndex]=!0,J[ie.bucketInstanceId]===void 0&&(J[ie.bucketInstanceId]=[]),J[ie.bucketInstanceId].push(ie.featureIndex))}return J}insertCollisionBox(s,g,x,T,I,O){(x?this.ignoredGrid:this.grid).insert({bucketInstanceId:T,featureIndex:I,collisionGroupID:O,overlapMode:g},s[0],s[1],s[2],s[3])}insertCollisionCircles(s,g,x,T,I,O){const z=x?this.ignoredGrid:this.grid,G={bucketInstanceId:T,featureIndex:I,collisionGroupID:O,overlapMode:g};for(let q=0;q<s.length;q+=4)z.insertCircle(G,s[q],s[q+1],s[q+2])}projectAndGetPerspectiveRatio(s,g,x,T,I){if(I){let O;T?(O=[s,g,T(s,g),1],l.aH(O,O,I)):(O=[s,g,0,1],Io(O,O,I));const z=O[3];return{x:(O[0]/z+1)/2*this.transform.width+kn,y:(-O[1]/z+1)/2*this.transform.height+kn,perspectiveRatio:.5+this.transform.cameraToCenterDistance/z*.5,isOccluded:!1,signedDistanceFromCamera:z}}{const O=this.transform.projectTileCoordinates(s,g,x,T);return{x:(O.point.x+1)/2*this.transform.width+kn,y:(1-O.point.y)/2*this.transform.height+kn,perspectiveRatio:.5+this.transform.cameraToCenterDistance/O.signedDistanceFromCamera*.5,isOccluded:O.isOccluded,signedDistanceFromCamera:O.signedDistanceFromCamera}}}getPerspectiveRatio(s,g,x,T){const I=this.transform.projectTileCoordinates(s,g,x,T);return .5+this.transform.cameraToCenterDistance/I.signedDistanceFromCamera*.5}isOffscreen(s,g,x,T){return x<kn||s>=this.screenRightBoundary||T<kn||g>this.screenBottomBoundary}isInsideGrid(s,g,x,T){return x>=0&&s<this.gridRightBoundary&&T>=0&&g<this.gridBottomBoundary}getViewportMatrix(){const s=l.ar([]);return l.O(s,s,[-100,-100,0]),s}_projectCollisionBox(s,g,x,T,I,O,z,G,q,J,re){let ie=1,ce=0,_e=0,Me=1;const Pe=s.anchorPointX+z[0],Ce=s.anchorPointY+z[1];if(O&&!I){const ii=this.projectAndGetPerspectiveRatio(Pe+1,Ce,T,q,re),Wt=ii.x-G.x,ri=Math.atan((ii.y-G.y)/Wt)+(Wt<0?Math.PI:0),Ji=Math.sin(ri),sn=Math.cos(ri);ie=sn,ce=Ji,_e=-Ji,Me=sn}else if(!O&&I){const ii=bl(this.transform);ie=ii.vecEast[0],ce=ii.vecEast[1],_e=ii.vecSouth[0],Me=ii.vecSouth[1]}let Oe=G.x,We=G.y,ke=g;I&&(Oe=Pe,We=Ce,ke=Math.pow(2,-(this.transform.zoom-x.overscaledZ)),ke*=this.transform.getPitchedTextCorrection(Pe,Ce,T),J||(ke*=l.an(.5+G.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),J&&(Oe+=ie*J.x*ke+_e*J.y*ke,We+=ce*J.x*ke+Me*J.y*ke);const Ge=s.x1*ke,Xe=s.x2*ke,Ue=(Ge+Xe)/2,et=s.y1*ke,At=s.y2*ke,pt=(et+At)/2,bt=[{offsetX:Ge,offsetY:et},{offsetX:Ue,offsetY:et},{offsetX:Xe,offsetY:et},{offsetX:Xe,offsetY:pt},{offsetX:Xe,offsetY:At},{offsetX:Ue,offsetY:At},{offsetX:Ge,offsetY:At},{offsetX:Ge,offsetY:pt}];let _t=[];for(const{offsetX:ii,offsetY:Wt}of bt)_t.push(new l.P(Oe+ie*ii+_e*Wt,We+ce*ii+Me*Wt));let ti=!1;if(I){const ii=_t.map((Wt=>this.projectAndGetPerspectiveRatio(Wt.x,Wt.y,T,q,re)));ti=ii.some((Wt=>!Wt.isOccluded)),_t=ii.map((Wt=>new l.P(Wt.x,Wt.y)))}else ti=!0;return{box:l.aL(_t),allPointsOccluded:!ti}}}class kp{constructor(s,g,x,T){this.opacity=s?Math.max(0,Math.min(1,s.opacity+(s.placed?g:-g))):T&&x?1:0,this.placed=x}isHidden(){return this.opacity===0&&!this.placed}}class pu{constructor(s,g,x,T,I){this.text=new kp(s?s.text:null,g,x,I),this.icon=new kp(s?s.icon:null,g,T,I)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class u0{constructor(s,g,x){this.text=s,this.icon=g,this.skipFade=x}}class dh{constructor(s,g,x,T,I){this.bucketInstanceId=s,this.featureIndex=g,this.sourceLayerIndex=x,this.bucketIndex=T,this.tileID=I}}class Dp{constructor(s){this.crossSourceCollisions=s,this.maxGroupID=0,this.collisionGroups={}}get(s){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[s]){const g=++this.maxGroupID;this.collisionGroups[s]={ID:g,predicate:x=>x.collisionGroupID===g}}return this.collisionGroups[s]}}function Aa(C,s,g,x,T){const{horizontalAlign:I,verticalAlign:O}=l.aS(C);return new l.P(-(I-.5)*s+x[0]*T,-(O-.5)*g+x[1]*T)}class pf{constructor(s,g,x,T,I){this.transform=s.clone(),this.terrain=g,this.collisionIndex=new fh(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=x,this.retainedQueryData={},this.collisionGroups=new Dp(T),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=I,I&&(I.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(s){const g=this.terrain;return g?(x,T)=>g.getElevation(s,x,T):null}getBucketParts(s,g,x,T){const I=x.getBucket(g),O=x.latestFeatureIndex;if(!I||!O||g.id!==I.layerIds[0])return;const z=x.collisionBoxArray,G=I.layers[0].layout,q=I.layers[0].paint,J=Math.pow(2,this.transform.zoom-x.tileID.overscaledZ),re=x.tileSize/l.a5,ie=x.tileID.toUnwrapped(),ce=G.get("text-rotation-alignment")==="map",_e=l.aN(x,1,this.transform.zoom),Me=l.aO(this.collisionIndex.transform,x,q.get("text-translate"),q.get("text-translate-anchor")),Pe=l.aO(this.collisionIndex.transform,x,q.get("icon-translate"),q.get("icon-translate-anchor")),Ce=ba(ce,this.transform,_e);this.retainedQueryData[I.bucketInstanceId]=new dh(I.bucketInstanceId,O,I.sourceLayerIndex,I.index,x.tileID);const Oe={bucket:I,layout:G,translationText:Me,translationIcon:Pe,unwrappedTileID:ie,pitchedLabelPlaneMatrix:Ce,scale:J,textPixelRatio:re,holdingForFade:x.holdingForSymbolFade(),collisionBoxArray:z,partiallyEvaluatedTextSize:l.ay(I.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(I.sourceID)};if(T)for(const We of I.sortKeyRanges){const{sortKey:ke,symbolInstanceStart:Ge,symbolInstanceEnd:Xe}=We;s.push({sortKey:ke,symbolInstanceStart:Ge,symbolInstanceEnd:Xe,parameters:Oe})}else s.push({symbolInstanceStart:0,symbolInstanceEnd:I.symbolInstances.length,parameters:Oe})}attemptAnchorPlacement(s,g,x,T,I,O,z,G,q,J,re,ie,ce,_e,Me,Pe,Ce,Oe,We,ke){const Ge=l.aP[s.textAnchor],Xe=[s.textOffset0,s.textOffset1],Ue=Aa(Ge,x,T,Xe,I),et=this.collisionIndex.placeCollisionBox(g,ie,G,q,J,z,O,Pe,re.predicate,We,Ue,ke);if((!Oe||this.collisionIndex.placeCollisionBox(Oe,ie,G,q,J,z,O,Ce,re.predicate,We,Ue,ke).placeable)&&et.placeable){let At;if(this.prevPlacement&&this.prevPlacement.variableOffsets[ce.crossTileID]&&this.prevPlacement.placements[ce.crossTileID]&&this.prevPlacement.placements[ce.crossTileID].text&&(At=this.prevPlacement.variableOffsets[ce.crossTileID].anchor),ce.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[ce.crossTileID]={textOffset:Xe,width:x,height:T,anchor:Ge,textBoxScale:I,prevAnchor:At},this.markUsedJustification(_e,Ge,ce,Me),_e.allowVerticalPlacement&&(this.markUsedOrientation(_e,Me,ce),this.placedOrientations[ce.crossTileID]=Me),{shift:Ue,placedGlyphBoxes:et}}}placeLayerBucketPart(s,g,x){const{bucket:T,layout:I,translationText:O,translationIcon:z,unwrappedTileID:G,pitchedLabelPlaneMatrix:q,textPixelRatio:J,holdingForFade:re,collisionBoxArray:ie,partiallyEvaluatedTextSize:ce,collisionGroup:_e}=s.parameters,Me=I.get("text-optional"),Pe=I.get("icon-optional"),Ce=l.aQ(I,"text-overlap","text-allow-overlap"),Oe=Ce==="always",We=l.aQ(I,"icon-overlap","icon-allow-overlap"),ke=We==="always",Ge=I.get("text-rotation-alignment")==="map",Xe=I.get("text-pitch-alignment")==="map",Ue=I.get("icon-text-fit")!=="none",et=I.get("symbol-z-order")==="viewport-y",At=Oe&&(ke||!T.hasIconData()||Pe),pt=ke&&(Oe||!T.hasTextData()||Me);!T.collisionArrays&&ie&&T.deserializeCollisionBoxes(ie);const bt=this.retainedQueryData[T.bucketInstanceId].tileID,_t=this._getTerrainElevationFunc(bt),ti=this.transform.getFastPathSimpleProjectionMatrix(bt),ii=(Wt,ri,Ji)=>{var sn,rr;if(g[Wt.crossTileID])return;if(re)return void(this.placements[Wt.crossTileID]=new u0(!1,!1,!1));let sr=!1,yr=!1,qn=!0,zr=null,vr={box:null,placeable:!1,offscreen:null,occluded:!1},Gs={placeable:!1},Xr=null,jn=null,fr=null,Os=0,Fs=0,ws=0;ri.textFeatureIndex?Os=ri.textFeatureIndex:Wt.useRuntimeCollisionCircles&&(Os=Wt.featureIndex),ri.verticalTextFeatureIndex&&(Fs=ri.verticalTextFeatureIndex);const Hr=ri.textBox;if(Hr){const Xa=Xn=>{let ar=l.az.horizontal;if(T.allowVerticalPlacement&&!Xn&&this.prevPlacement){const gs=this.prevPlacement.placedOrientations[Wt.crossTileID];gs&&(this.placedOrientations[Wt.crossTileID]=gs,ar=gs,this.markUsedOrientation(T,ar,Wt))}return ar},xo=(Xn,ar)=>{if(T.allowVerticalPlacement&&Wt.numVerticalGlyphVertices>0&&ri.verticalTextBox){for(const gs of T.writingModes)if(gs===l.az.vertical?(vr=ar(),Gs=vr):vr=Xn(),vr&&vr.placeable)break}else vr=Xn()},Go=Wt.textAnchorOffsetStartIndex,$r=Wt.textAnchorOffsetEndIndex;if($r===Go){const Xn=(ar,gs)=>{const Ts=this.collisionIndex.placeCollisionBox(ar,Ce,J,bt,G,Xe,Ge,O,_e.predicate,_t,void 0,ti);return Ts&&Ts.placeable&&(this.markUsedOrientation(T,gs,Wt),this.placedOrientations[Wt.crossTileID]=gs),Ts};xo((()=>Xn(Hr,l.az.horizontal)),(()=>{const ar=ri.verticalTextBox;return T.allowVerticalPlacement&&Wt.numVerticalGlyphVertices>0&&ar?Xn(ar,l.az.vertical):{box:null,offscreen:null}})),Xa(vr&&vr.placeable)}else{let Xn=l.aP[(rr=(sn=this.prevPlacement)===null||sn===void 0?void 0:sn.variableOffsets[Wt.crossTileID])===null||rr===void 0?void 0:rr.anchor];const ar=(Ts,Td,Sd)=>{const Qc=Ts.x2-Ts.x1,E0=Ts.y2-Ts.y1,yc=Wt.textBoxScale,Ed=Ue&&We==="never"?Td:null;let vc=null,Ss=Ce==="never"?1:2,as="never";Xn&&Ss++;for(let Kc=0;Kc<Ss;Kc++){for(let kf=Go;kf<$r;kf++){const xc=T.textAnchorOffsets.get(kf);if(Xn&&xc.textAnchor!==Xn)continue;const Df=this.attemptAnchorPlacement(xc,Ts,Qc,E0,yc,Ge,Xe,J,bt,G,_e,as,Wt,T,Sd,O,z,Ed,_t);if(Df&&(vc=Df.placedGlyphBoxes,vc&&vc.placeable))return sr=!0,zr=Df.shift,vc}Xn?Xn=null:as=Ce}return x&&!vc&&(vc={box:this.collisionIndex.placeCollisionBox(Hr,"always",J,bt,G,Xe,Ge,O,_e.predicate,_t,void 0,ti).box,offscreen:!1,placeable:!1,occluded:!1}),vc};xo((()=>ar(Hr,ri.iconBox,l.az.horizontal)),(()=>{const Ts=ri.verticalTextBox;return T.allowVerticalPlacement&&(!vr||!vr.placeable)&&Wt.numVerticalGlyphVertices>0&&Ts?ar(Ts,ri.verticalIconBox,l.az.vertical):{box:null,occluded:!0,offscreen:null}})),vr&&(sr=vr.placeable,qn=vr.offscreen);const gs=Xa(vr&&vr.placeable);if(!sr&&this.prevPlacement){const Ts=this.prevPlacement.variableOffsets[Wt.crossTileID];Ts&&(this.variableOffsets[Wt.crossTileID]=Ts,this.markUsedJustification(T,Ts.anchor,Wt,gs))}}}if(Xr=vr,sr=Xr&&Xr.placeable,qn=Xr&&Xr.offscreen,Wt.useRuntimeCollisionCircles&&Wt.centerJustifiedTextSymbolIndex>=0){const Xa=T.text.placedSymbolArray.get(Wt.centerJustifiedTextSymbolIndex),xo=l.aA(T.textSizeData,ce,Xa),Go=I.get("text-padding");jn=this.collisionIndex.placeCollisionCircles(Ce,Xa,T.lineVertexArray,T.glyphOffsetArray,xo,G,q,x,Xe,_e.predicate,Wt.collisionCircleDiameter,Go,O,_t),jn.circles.length&&jn.collisionDetected&&!x&&l.w("Collisions detected, but collision boxes are not shown"),sr=Oe||jn.circles.length>0&&!jn.collisionDetected,qn=qn&&jn.offscreen}if(ri.iconFeatureIndex&&(ws=ri.iconFeatureIndex),ri.iconBox){const Xa=xo=>this.collisionIndex.placeCollisionBox(xo,We,J,bt,G,Xe,Ge,z,_e.predicate,_t,Ue&&zr?zr:void 0,ti);Gs&&Gs.placeable&&ri.verticalIconBox?(fr=Xa(ri.verticalIconBox),yr=fr.placeable):(fr=Xa(ri.iconBox),yr=fr.placeable),qn=qn&&fr.offscreen}const ua=Me||Wt.numHorizontalGlyphVertices===0&&Wt.numVerticalGlyphVertices===0,Wl=Pe||Wt.numIconVertices===0;ua||Wl?Wl?ua||(yr=yr&&sr):sr=yr&&sr:yr=sr=yr&&sr;const jo=yr&&fr.placeable;if(sr&&Xr.placeable&&this.collisionIndex.insertCollisionBox(Xr.box,Ce,I.get("text-ignore-placement"),T.bucketInstanceId,Gs&&Gs.placeable&&Fs?Fs:Os,_e.ID),jo&&this.collisionIndex.insertCollisionBox(fr.box,We,I.get("icon-ignore-placement"),T.bucketInstanceId,ws,_e.ID),jn&&sr&&this.collisionIndex.insertCollisionCircles(jn.circles,Ce,I.get("text-ignore-placement"),T.bucketInstanceId,Os,_e.ID),x&&this.storeCollisionData(T.bucketInstanceId,Ji,ri,Xr,fr,jn),Wt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(T.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Wt.crossTileID]=new u0((sr||At)&&!(Xr!=null&&Xr.occluded),(yr||pt)&&!(fr!=null&&fr.occluded),qn||T.justReloaded),g[Wt.crossTileID]=!0};if(et){if(s.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Wt=T.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let ri=Wt.length-1;ri>=0;--ri){const Ji=Wt[ri];ii(T.symbolInstances.get(Ji),T.collisionArrays[Ji],Ji)}}else for(let Wt=s.symbolInstanceStart;Wt<s.symbolInstanceEnd;Wt++)ii(T.symbolInstances.get(Wt),T.collisionArrays[Wt],Wt);T.justReloaded=!1}storeCollisionData(s,g,x,T,I,O){if(x.textBox||x.iconBox){let z,G;this.collisionBoxArrays.has(s)?z=this.collisionBoxArrays.get(s):(z=new Map,this.collisionBoxArrays.set(s,z)),z.has(g)?G=z.get(g):(G={text:null,icon:null},z.set(g,G)),x.textBox&&(G.text=T.box),x.iconBox&&(G.icon=I.box)}if(O){let z=this.collisionCircleArrays[s];z===void 0&&(z=this.collisionCircleArrays[s]=[]);for(let G=0;G<O.circles.length;G+=4)z.push(O.circles[G+0]-kn),z.push(O.circles[G+1]-kn),z.push(O.circles[G+2]),z.push(O.collisionDetected?1:0)}}markUsedJustification(s,g,x,T){let I;I=T===l.az.vertical?x.verticalPlacedTextSymbolIndex:{left:x.leftJustifiedTextSymbolIndex,center:x.centerJustifiedTextSymbolIndex,right:x.rightJustifiedTextSymbolIndex}[l.aR(g)];const O=[x.leftJustifiedTextSymbolIndex,x.centerJustifiedTextSymbolIndex,x.rightJustifiedTextSymbolIndex,x.verticalPlacedTextSymbolIndex];for(const z of O)z>=0&&(s.text.placedSymbolArray.get(z).crossTileID=I>=0&&z!==I?0:x.crossTileID)}markUsedOrientation(s,g,x){const T=g===l.az.horizontal||g===l.az.horizontalOnly?g:0,I=g===l.az.vertical?g:0,O=[x.leftJustifiedTextSymbolIndex,x.centerJustifiedTextSymbolIndex,x.rightJustifiedTextSymbolIndex];for(const z of O)s.text.placedSymbolArray.get(z).placedOrientation=T;x.verticalPlacedTextSymbolIndex&&(s.text.placedSymbolArray.get(x.verticalPlacedTextSymbolIndex).placedOrientation=I)}commit(s){this.commitTime=s,this.zoomAtLastRecencyCheck=this.transform.zoom;const g=this.prevPlacement;let x=!1;this.prevZoomAdjustment=g?g.zoomAdjustment(this.transform.zoom):0;const T=g?g.symbolFadeChange(s):1,I=g?g.opacities:{},O=g?g.variableOffsets:{},z=g?g.placedOrientations:{};for(const G in this.placements){const q=this.placements[G],J=I[G];J?(this.opacities[G]=new pu(J,T,q.text,q.icon),x=x||q.text!==J.text.placed||q.icon!==J.icon.placed):(this.opacities[G]=new pu(null,T,q.text,q.icon,q.skipFade),x=x||q.text||q.icon)}for(const G in I){const q=I[G];if(!this.opacities[G]){const J=new pu(q,T,!1,!1);J.isHidden()||(this.opacities[G]=J,x=x||q.text.placed||q.icon.placed)}}for(const G in O)this.variableOffsets[G]||!this.opacities[G]||this.opacities[G].isHidden()||(this.variableOffsets[G]=O[G]);for(const G in z)this.placedOrientations[G]||!this.opacities[G]||this.opacities[G].isHidden()||(this.placedOrientations[G]=z[G]);if(g&&g.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");x?this.lastPlacementChangeTime=s:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=g?g.lastPlacementChangeTime:s)}updateLayerOpacities(s,g){const x={};for(const T of g){const I=T.getBucket(s);I&&T.latestFeatureIndex&&s.id===I.layerIds[0]&&this.updateBucketOpacities(I,T.tileID,x,T.collisionBoxArray)}}updateBucketOpacities(s,g,x,T){s.hasTextData()&&(s.text.opacityVertexArray.clear(),s.text.hasVisibleVertices=!1),s.hasIconData()&&(s.icon.opacityVertexArray.clear(),s.icon.hasVisibleVertices=!1),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexArray.clear(),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexArray.clear();const I=s.layers[0],O=I.layout,z=new pu(null,0,!1,!1,!0),G=O.get("text-allow-overlap"),q=O.get("icon-allow-overlap"),J=I._unevaluatedLayout.hasValue("text-variable-anchor")||I._unevaluatedLayout.hasValue("text-variable-anchor-offset"),re=O.get("text-rotation-alignment")==="map",ie=O.get("text-pitch-alignment")==="map",ce=O.get("icon-text-fit")!=="none",_e=new pu(null,0,G&&(q||!s.hasIconData()||O.get("icon-optional")),q&&(G||!s.hasTextData()||O.get("text-optional")),!0);!s.collisionArrays&&T&&(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData())&&s.deserializeCollisionBoxes(T);const Me=(Ce,Oe,We)=>{for(let ke=0;ke<Oe/4;ke++)Ce.opacityVertexArray.emplaceBack(We);Ce.hasVisibleVertices=Ce.hasVisibleVertices||We!==ko},Pe=this.collisionBoxArrays.get(s.bucketInstanceId);for(let Ce=0;Ce<s.symbolInstances.length;Ce++){const Oe=s.symbolInstances.get(Ce),{numHorizontalGlyphVertices:We,numVerticalGlyphVertices:ke,crossTileID:Ge}=Oe;let Xe=this.opacities[Ge];x[Ge]?Xe=z:Xe||(Xe=_e,this.opacities[Ge]=Xe),x[Ge]=!0;const Ue=Oe.numIconVertices>0,et=this.placedOrientations[Oe.crossTileID],At=et===l.az.vertical,pt=et===l.az.horizontal||et===l.az.horizontalOnly;if(We>0||ke>0){const _t=nd(Xe.text);Me(s.text,We,At?ko:_t),Me(s.text,ke,pt?ko:_t);const ti=Xe.text.isHidden();[Oe.rightJustifiedTextSymbolIndex,Oe.centerJustifiedTextSymbolIndex,Oe.leftJustifiedTextSymbolIndex].forEach((ri=>{ri>=0&&(s.text.placedSymbolArray.get(ri).hidden=ti||At?1:0)})),Oe.verticalPlacedTextSymbolIndex>=0&&(s.text.placedSymbolArray.get(Oe.verticalPlacedTextSymbolIndex).hidden=ti||pt?1:0);const ii=this.variableOffsets[Oe.crossTileID];ii&&this.markUsedJustification(s,ii.anchor,Oe,et);const Wt=this.placedOrientations[Oe.crossTileID];Wt&&(this.markUsedJustification(s,"left",Oe,Wt),this.markUsedOrientation(s,Wt,Oe))}if(Ue){const _t=nd(Xe.icon),ti=!(ce&&Oe.verticalPlacedIconSymbolIndex&&At);Oe.placedIconSymbolIndex>=0&&(Me(s.icon,Oe.numIconVertices,ti?_t:ko),s.icon.placedSymbolArray.get(Oe.placedIconSymbolIndex).hidden=Xe.icon.isHidden()),Oe.verticalPlacedIconSymbolIndex>=0&&(Me(s.icon,Oe.numVerticalIconVertices,ti?ko:_t),s.icon.placedSymbolArray.get(Oe.verticalPlacedIconSymbolIndex).hidden=Xe.icon.isHidden())}const bt=Pe&&Pe.has(Ce)?Pe.get(Ce):{text:null,icon:null};if(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData()){const _t=s.collisionArrays[Ce];if(_t){let ti=new l.P(0,0);if(_t.textBox||_t.verticalTextBox){let ii=!0;if(J){const Wt=this.variableOffsets[Ge];Wt?(ti=Aa(Wt.anchor,Wt.width,Wt.height,Wt.textOffset,Wt.textBoxScale),re&&ti._rotate(ie?-this.transform.bearingInRadians:this.transform.bearingInRadians)):ii=!1}if(_t.textBox||_t.verticalTextBox){let Wt;_t.textBox&&(Wt=At),_t.verticalTextBox&&(Wt=pt),id(s.textCollisionBox.collisionVertexArray,Xe.text.placed,!ii||Wt,bt.text,ti.x,ti.y)}}if(_t.iconBox||_t.verticalIconBox){const ii=!!(!pt&&_t.verticalIconBox);let Wt;_t.iconBox&&(Wt=ii),_t.verticalIconBox&&(Wt=!ii),id(s.iconCollisionBox.collisionVertexArray,Xe.icon.placed,Wt,bt.icon,ce?ti.x:0,ce?ti.y:0)}}}}if(s.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[s.bucketInstanceId]&&(this.retainedQueryData[s.bucketInstanceId].featureSortOrder=s.featureSortOrder),s.hasTextData()&&s.text.opacityVertexBuffer&&s.text.opacityVertexBuffer.updateData(s.text.opacityVertexArray),s.hasIconData()&&s.icon.opacityVertexBuffer&&s.icon.opacityVertexBuffer.updateData(s.icon.opacityVertexArray),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexBuffer&&s.iconCollisionBox.collisionVertexBuffer.updateData(s.iconCollisionBox.collisionVertexArray),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexBuffer&&s.textCollisionBox.collisionVertexBuffer.updateData(s.textCollisionBox.collisionVertexArray),s.text.opacityVertexArray.length!==s.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${s.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${s.text.layoutVertexArray.length}) / 4`);if(s.icon.opacityVertexArray.length!==s.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${s.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${s.icon.layoutVertexArray.length}) / 4`);s.bucketInstanceId in this.collisionCircleArrays&&(s.collisionCircleArray=this.collisionCircleArrays[s.bucketInstanceId],delete this.collisionCircleArrays[s.bucketInstanceId])}symbolFadeChange(s){return this.fadeDuration===0?1:(s-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(s){return Math.max(0,(this.transform.zoom-s)/1.5)}hasTransitions(s){return this.stale||s-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(s,g){const x=this.zoomAtLastRecencyCheck===g?1-this.zoomAdjustment(g):1;return this.zoomAtLastRecencyCheck=g,this.commitTime+this.fadeDuration*x>s}setStale(){this.stale=!0}}function id(C,s,g,x,T,I){x&&x.length!==0||(x=[0,0,0,0]);const O=x[0]-kn,z=x[1]-kn,G=x[2]-kn,q=x[3]-kn;C.emplaceBack(s?1:0,g?1:0,T||0,I||0,O,z),C.emplaceBack(s?1:0,g?1:0,T||0,I||0,G,z),C.emplaceBack(s?1:0,g?1:0,T||0,I||0,G,q),C.emplaceBack(s?1:0,g?1:0,T||0,I||0,O,q)}const sc=Math.pow(2,25),Lc=Math.pow(2,24),Op=Math.pow(2,17),ac=Math.pow(2,16),oc=Math.pow(2,9),Fp=Math.pow(2,8),wa=Math.pow(2,1);function nd(C){if(C.opacity===0&&!C.placed)return 0;if(C.opacity===1&&C.placed)return 4294967295;const s=C.placed?1:0,g=Math.floor(127*C.opacity);return g*sc+s*Lc+g*Op+s*ac+g*oc+s*Fp+g*wa+s}const ko=0;class lc{constructor(s){this._sortAcrossTiles=s.layout.get("symbol-z-order")!=="viewport-y"&&!s.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(s,g,x,T,I){const O=this._bucketParts;for(;this._currentTileIndex<s.length;)if(g.getBucketParts(O,T,s[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,I())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,O.sort(((z,G)=>z.sortKey-G.sortKey)));this._currentPartIndex<O.length;)if(g.placeLayerBucketPart(O[this._currentPartIndex],this._seenCrossTileIDs,x),this._currentPartIndex++,I())return!0;return!1}}class ph{constructor(s,g,x,T,I,O,z,G){this.placement=new pf(s,g,O,z,G),this._currentPlacementIndex=x.length-1,this._forceFullPlacement=T,this._showCollisionBoxes=I,this._done=!1}isDone(){return this._done}continuePlacement(s,g,x){const T=Ae(),I=()=>!this._forceFullPlacement&&Ae()-T>2;for(;this._currentPlacementIndex>=0;){const O=g[s[this._currentPlacementIndex]],z=this.placement.collisionIndex.transform.zoom;if(O.type==="symbol"&&(!O.minzoom||O.minzoom<=z)&&(!O.maxzoom||O.maxzoom>z)){if(this._inProgressLayer||(this._inProgressLayer=new lc(O)),this._inProgressLayer.continuePlacement(x[O.source],this.placement,this._showCollisionBoxes,O,I))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(s){return this.placement.commit(s),this.placement}}const Qi=512/l.a5/2;class tl{constructor(s,g,x){this.tileID=s,this.bucketInstanceId=x,this._symbolsByKey={};const T=new Map;for(let I=0;I<g.length;I++){const O=g.get(I),z=O.key,G=T.get(z);G?G.push(O):T.set(z,[O])}for(const[I,O]of T){const z={positions:O.map((G=>({x:Math.floor(G.anchorX*Qi),y:Math.floor(G.anchorY*Qi)}))),crossTileIDs:O.map((G=>G.crossTileID))};if(z.positions.length>128){const G=new l.aT(z.positions.length,16,Uint16Array);for(const{x:q,y:J}of z.positions)G.add(q,J);G.finish(),delete z.positions,z.index=G}this._symbolsByKey[I]=z}}getScaledCoordinates(s,g){const{x,y:T,z:I}=this.tileID.canonical,{x:O,y:z,z:G}=g.canonical,q=Qi/Math.pow(2,G-I),J=(z*l.a5+s.anchorY)*q,re=T*l.a5*Qi;return{x:Math.floor((O*l.a5+s.anchorX)*q-x*l.a5*Qi),y:Math.floor(J-re)}}findMatches(s,g,x){const T=this.tileID.canonical.z<g.canonical.z?1:Math.pow(2,this.tileID.canonical.z-g.canonical.z);for(let I=0;I<s.length;I++){const O=s.get(I);if(O.crossTileID)continue;const z=this._symbolsByKey[O.key];if(!z)continue;const G=this.getScaledCoordinates(O,g);if(z.index){const q=z.index.range(G.x-T,G.y-T,G.x+T,G.y+T).sort();for(const J of q){const re=z.crossTileIDs[J];if(!x[re]){x[re]=!0,O.crossTileID=re;break}}}else if(z.positions)for(let q=0;q<z.positions.length;q++){const J=z.positions[q],re=z.crossTileIDs[q];if(Math.abs(J.x-G.x)<=T&&Math.abs(J.y-G.y)<=T&&!x[re]){x[re]=!0,O.crossTileID=re;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:s})=>s))}}class rd{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class gh{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(s){const g=Math.round((s-this.lng)/360);if(g!==0)for(const x in this.indexes){const T=this.indexes[x],I={};for(const O in T){const z=T[O];z.tileID=z.tileID.unwrapTo(z.tileID.wrap+g),I[z.tileID.key]=z}this.indexes[x]=I}this.lng=s}addBucket(s,g,x){if(this.indexes[s.overscaledZ]&&this.indexes[s.overscaledZ][s.key]){if(this.indexes[s.overscaledZ][s.key].bucketInstanceId===g.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(s.overscaledZ,this.indexes[s.overscaledZ][s.key])}for(let I=0;I<g.symbolInstances.length;I++)g.symbolInstances.get(I).crossTileID=0;this.usedCrossTileIDs[s.overscaledZ]||(this.usedCrossTileIDs[s.overscaledZ]={});const T=this.usedCrossTileIDs[s.overscaledZ];for(const I in this.indexes){const O=this.indexes[I];if(Number(I)>s.overscaledZ)for(const z in O){const G=O[z];G.tileID.isChildOf(s)&&G.findMatches(g.symbolInstances,s,T)}else{const z=O[s.scaledTo(Number(I)).key];z&&z.findMatches(g.symbolInstances,s,T)}}for(let I=0;I<g.symbolInstances.length;I++){const O=g.symbolInstances.get(I);O.crossTileID||(O.crossTileID=x.generate(),T[O.crossTileID]=!0)}return this.indexes[s.overscaledZ]===void 0&&(this.indexes[s.overscaledZ]={}),this.indexes[s.overscaledZ][s.key]=new tl(s,g.symbolInstances,g.bucketInstanceId),!0}removeBucketCrossTileIDs(s,g){for(const x of g.getCrossTileIDsLists())for(const T of x)delete this.usedCrossTileIDs[s][T]}removeStaleBuckets(s){let g=!1;for(const x in this.indexes){const T=this.indexes[x];for(const I in T)s[T[I].bucketInstanceId]||(this.removeBucketCrossTileIDs(x,T[I]),delete T[I],g=!0)}return g}}class Ps{constructor(){this.layerIndexes={},this.crossTileIDs=new rd,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(s,g,x){let T=this.layerIndexes[s.id];T===void 0&&(T=this.layerIndexes[s.id]=new gh);let I=!1;const O={};T.handleWrapJump(x);for(const z of g){const G=z.getBucket(s);G&&s.id===G.layerIds[0]&&(G.bucketInstanceId||(G.bucketInstanceId=++this.maxBucketInstanceId),T.addBucket(z.tileID,G,this.crossTileIDs)&&(I=!0),O[G.bucketInstanceId]=!0)}return T.removeStaleBuckets(O)&&(I=!0),I}pruneUnusedLayers(s){const g={};s.forEach((x=>{g[x]=!0}));for(const x in this.layerIndexes)g[x]||delete this.layerIndexes[x]}}var hs="void main() {fragColor=vec4(1.0);}";const wr={prelude:Gi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:Gi("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:Gi("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:Gi(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:Gi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Gi(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Gi(hs,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:Gi(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:Gi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Gi("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Gi("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:Gi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:Gi("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:Gi(hs,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:Gi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:Gi(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:Gi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:Gi(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Gi(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Gi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Gi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Gi(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:Gi(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Gi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Gi(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Gi(`uniform lowp float u_device_pixel_ratio;uniform lowp float u_lineatlas_width;uniform sampler2D u_image;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0/u_device_pixel_ratio)/min(dasharray_from.w,dasharray_to.w);alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),lineGradientSDF:Gi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform sampler2D u_image_dash;uniform float u_mix;uniform lowp float u_lineatlas_width;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);float sdfdist_a=texture(u_image_dash,v_tex_a).a;float sdfdist_b=texture(u_image_dash,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0)/min(dasharray_from.w,dasharray_to.w);float dash_alpha=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*dash_alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;out vec2 v_tex_a;out vec2 v_tex_b;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;float texel_height=1.0/u_image_height;float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),raster:Gi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:Gi(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Gi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Gi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Gi("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Gi("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Gi("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:Gi("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:Gi(`#ifdef GL_ES
precision highp float;
#endif
in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:Gi("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Gi(C,s){const g=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,x=s.match(/in ([\w]+) ([\w]+)/g),T=C.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),I=s.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),O=I?I.concat(T):T,z={};return{fragmentSource:C=C.replace(g,((G,q,J,re,ie)=>(z[ie]=!0,q==="define"?`
#ifndef HAS_UNIFORM_u_${ie}
in ${J} ${re} ${ie};
#else
uniform ${J} ${re} u_${ie};
#endif
`:`
#ifdef HAS_UNIFORM_u_${ie}
    ${J} ${re} ${ie} = u_${ie};
#endif
`))),vertexSource:s=s.replace(g,((G,q,J,re,ie)=>{const ce=re==="float"?"vec2":"vec4",_e=ie.match(/color/)?"color":ce;return z[ie]?q==="define"?`
#ifndef HAS_UNIFORM_u_${ie}
uniform lowp float u_${ie}_t;
in ${J} ${ce} a_${ie};
out ${J} ${re} ${ie};
#else
uniform ${J} ${re} u_${ie};
#endif
`:_e==="vec4"?`
#ifndef HAS_UNIFORM_u_${ie}
    ${ie} = a_${ie};
#else
    ${J} ${re} ${ie} = u_${ie};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ie}
    ${ie} = unpack_mix_${_e}(a_${ie}, u_${ie}_t);
#else
    ${J} ${re} ${ie} = u_${ie};
#endif
`:q==="define"?`
#ifndef HAS_UNIFORM_u_${ie}
uniform lowp float u_${ie}_t;
in ${J} ${ce} a_${ie};
#else
uniform ${J} ${re} u_${ie};
#endif
`:_e==="vec4"?`
#ifndef HAS_UNIFORM_u_${ie}
    ${J} ${re} ${ie} = a_${ie};
#else
    ${J} ${re} ${ie} = u_${ie};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ie}
    ${J} ${re} ${ie} = unpack_mix_${_e}(a_${ie}, u_${ie}_t);
#else
    ${J} ${re} ${ie} = u_${ie};
#endif
`})),staticAttributes:x,staticUniforms:O}}class Wn{constructor(s,g,x){this.vertexBuffer=s,this.indexBuffer=g,this.segments=x}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var fs=l.aU([{name:"a_pos",type:"Int16",components:2}]);const kr="#define PROJECTION_MERCATOR",Ta="mercator";class Is{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return Ta}get shaderDefine(){return kr}get shaderPreludeCode(){return wr.projectionMercator}get vertexShaderPreludeCode(){return wr.projectionMercator.vertexSource}get subdivisionGranularity(){return l.aV.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(s){}getMeshFromTileID(s,g,x,T,I){if(this._cachedMesh)return this._cachedMesh;const O=new l.aW;O.emplaceBack(0,0),O.emplaceBack(l.a5,0),O.emplaceBack(0,l.a5),O.emplaceBack(l.a5,l.a5);const z=s.createVertexBuffer(O,fs.members),G=l.aX.simpleSegment(0,0,4,2),q=new l.aY;q.emplaceBack(1,0,2),q.emplaceBack(1,2,3);const J=s.createIndexBuffer(q);return this._cachedMesh=new Wn(z,J,G),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(s){}}class oo{constructor(s=0,g=0,x=0,T=0){if(isNaN(s)||s<0||isNaN(g)||g<0||isNaN(x)||x<0||isNaN(T)||T<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=s,this.bottom=g,this.left=x,this.right=T}interpolate(s,g,x){return g.top!=null&&s.top!=null&&(this.top=l.G.number(s.top,g.top,x)),g.bottom!=null&&s.bottom!=null&&(this.bottom=l.G.number(s.bottom,g.bottom,x)),g.left!=null&&s.left!=null&&(this.left=l.G.number(s.left,g.left,x)),g.right!=null&&s.right!=null&&(this.right=l.G.number(s.right,g.right,x)),this}getCenter(s,g){const x=l.an((this.left+s-this.right)/2,0,s),T=l.an((this.top+g-this.bottom)/2,0,g);return new l.P(x,T)}equals(s){return this.top===s.top&&this.bottom===s.bottom&&this.left===s.left&&this.right===s.right}clone(){return new oo(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Do(C,s){if(!C.renderWorldCopies||C.lngRange)return;const g=s.lng-C.center.lng;s.lng+=g>180?-360:g<-180?360:0}function Tr(C){return Math.max(0,Math.floor(C))}class za{constructor(s,g){var x;this.applyConstrain=(T,I)=>this._constrainOverride!==null?this._constrainOverride(T,I):this._callbacks.defaultConstrain(T,I),this._callbacks=s,this._tileSize=512,this._renderWorldCopies=(g==null?void 0:g.renderWorldCopies)===void 0||!!(g!=null&&g.renderWorldCopies),this._minZoom=(g==null?void 0:g.minZoom)||0,this._maxZoom=(g==null?void 0:g.maxZoom)||22,this._minPitch=(g==null?void 0:g.minPitch)==null?0:g==null?void 0:g.minPitch,this._maxPitch=(g==null?void 0:g.maxPitch)==null?60:g==null?void 0:g.maxPitch,this._constrainOverride=(x=g==null?void 0:g.constrainOverride)!==null&&x!==void 0?x:null,this.setMaxBounds(),this._width=0,this._height=0,this._center=new l.V(0,0),this._elevation=0,this._zoom=0,this._tileZoom=Tr(this._zoom),this._scale=l.aq(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new oo,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(s,g,x){this._constrainOverride=s.constrainOverride,this._latRange=s.latRange,this._lngRange=s.lngRange,this._width=s.width,this._height=s.height,this._center=s.center,this._elevation=s.elevation,this._minElevationForCurrentTile=s.minElevationForCurrentTile,this._zoom=s.zoom,this._tileZoom=Tr(this._zoom),this._scale=l.aq(this._zoom),this._bearingInRadians=s.bearingInRadians,this._fovInRadians=s.fovInRadians,this._pitchInRadians=s.pitchInRadians,this._rollInRadians=s.rollInRadians,this._unmodified=s.unmodified,this._edgeInsets=new oo(s.padding.top,s.padding.bottom,s.padding.left,s.padding.right),this._minZoom=s.minZoom,this._maxZoom=s.maxZoom,this._minPitch=s.minPitch,this._maxPitch=s.maxPitch,this._renderWorldCopies=s.renderWorldCopies,this._cameraToCenterDistance=s.cameraToCenterDistance,this._nearZ=s.nearZ,this._farZ=s.farZ,this._autoCalculateNearFarZ=!x&&s.autoCalculateNearFarZ,g&&this.constrainInternal(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(s){this._minElevationForCurrentTile=s}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(s){this._minZoom!==s&&(this._minZoom=s,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(s){this._maxZoom!==s&&(this._maxZoom=s,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(s){this._minPitch!==s&&(this._minPitch=s,this.setPitch(Math.max(this.pitch,s)))}get maxPitch(){return this._maxPitch}setMaxPitch(s){this._maxPitch!==s&&(this._maxPitch=s,this.setPitch(Math.min(this.pitch,s)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(s){s===void 0?s=!0:s===null&&(s=!1),this._renderWorldCopies=s}get constrainOverride(){return this._constrainOverride}setConstrainOverride(s){s===void 0&&(s=null),this._constrainOverride!==s&&(this._constrainOverride=s,this.constrainInternal(),this._calcMatrices())}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(s){const g=l.W(s,-180,180)*Math.PI/180;var x,T,I,O,z,G,q,J,re;this._bearingInRadians!==g&&(this._unmodified=!1,this._bearingInRadians=g,this._calcMatrices(),this._rotationMatrix=D(),x=this._rotationMatrix,I=-this._bearingInRadians,O=(T=this._rotationMatrix)[0],z=T[1],G=T[2],q=T[3],J=Math.sin(I),re=Math.cos(I),x[0]=O*re+G*J,x[1]=z*re+q*J,x[2]=O*-J+G*re,x[3]=z*-J+q*re)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(s){const g=l.an(s,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==g&&(this._unmodified=!1,this._pitchInRadians=g,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(s){const g=s/180*Math.PI;this._rollInRadians!==g&&(this._unmodified=!1,this._rollInRadians=g,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return l.aZ(this._fovInRadians)}setFov(s){s=l.an(s,.1,150),this.fov!==s&&(this._unmodified=!1,this._fovInRadians=l.ap(s),this._calcMatrices())}get zoom(){return this._zoom}setZoom(s){const g=this.applyConstrain(this._center,s).zoom;this._zoom!==g&&(this._unmodified=!1,this._zoom=g,this._tileZoom=Math.max(0,Math.floor(g)),this._scale=l.aq(g),this.constrainInternal(),this._calcMatrices())}get center(){return this._center}setCenter(s){s.lat===this._center.lat&&s.lng===this._center.lng||(this._unmodified=!1,this._center=s,this.constrainInternal(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(s){s!==this._elevation&&(this._elevation=s,this.constrainInternal(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(s){this._edgeInsets.equals(s)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,s,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(s,g){this._autoCalculateNearFarZ=!1,this._nearZ=s,this._farZ=g,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(s){return this._edgeInsets.equals(s)}interpolatePadding(s,g,x){this._unmodified=!1,this._edgeInsets.interpolate(s,g,x),this.constrainInternal(),this._calcMatrices()}resize(s,g,x=!0){this._width=s,this._height=g,x&&this.constrainInternal(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new Ir([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(s){s?(this._lngRange=[s.getWest(),s.getEast()],this._latRange=[s.getSouth(),s.getNorth()],this.constrainInternal()):(this._lngRange=null,this._latRange=[-l.ao,l.ao])}getCameraQueryGeometry(s,g){if(g.length===1)return[g[0],s];{const{minX:x,minY:T,maxX:I,maxY:O}=l.aa.fromPoints(g).extend(s);return[new l.P(x,T),new l.P(I,T),new l.P(I,O),new l.P(x,O),new l.P(x,T)]}}constrainInternal(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const s=this._unmodified,{center:g,zoom:x}=this.applyConstrain(this.center,this.zoom);this.setCenter(g),this.setZoom(x),this._unmodified=s,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let s=l.ar(new Float64Array(16));l.Q(s,s,[this._width/2,-this._height/2,1]),l.O(s,s,[1,-1,0]),this._clipSpaceToPixelsMatrix=s,s=l.ar(new Float64Array(16)),l.Q(s,s,[1,-1,1]),l.O(s,s,[-1,-1,0]),l.Q(s,s,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=s,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(s,g,x,T){const I=x!==void 0?x:this.bearing,O=T=T!==void 0?T:this.pitch,{distanceToCenter:z,clampedElevation:G}=this._distanceToCenterFromAltElevationPitch(g,this.elevation,O),{x:q,y:J}=Oi(O,I),re=l.a9.fromLngLat(s,g);let ie,ce,_e=l.a_(1,re.y),Me=0;do{if(Me+=1,Me>10)break;ce=z/_e,ie=new l.a9(re.x+q*ce,re.y+J*ce),_e=1/ie.meterInMercatorCoordinateUnits()}while(Math.abs(z-ce*_e)>1e-12);return{center:ie.toLngLat(),elevation:G,zoom:l.at(this.height/2/Math.tan(this.fovInRadians/2)/ce/this.tileSize)}}recalculateZoomAndCenter(s){if(this.elevation-s==0)return;const g=1/this.worldSize,x=l.as(1,this.center.lat)*this.worldSize,T=l.a9.fromLngLat(this.center,this.elevation),I=T.x/g,O=T.y/g,z=T.z/g,G=this.pitch,q=this.bearing,{x:J,y:re,z:ie}=Oi(G,q),ce=this.cameraToCenterDistance,_e=I+ce*-J,Me=O+ce*-re,Pe=z+ce*ie,{distanceToCenter:Ce,clampedElevation:Oe}=this._distanceToCenterFromAltElevationPitch(Pe/x,s,G),We=Ce*x,ke=new l.a9((_e+J*We)*g,(Me+re*We)*g,0).toLngLat(),Ge=l.as(1,ke.lat),Xe=l.at(this.height/2/Math.tan(this.fovInRadians/2)/Ce/Ge/this.tileSize);this._elevation=Oe,this._center=ke,this.setZoom(Xe)}_distanceToCenterFromAltElevationPitch(s,g,x){const T=-Math.cos(l.ap(x)),I=s-g;let O,z=g;return T*I>=0||Math.abs(T)<.1?(O=1e4,z=s+O*T):O=-I/T,{distanceToCenter:O,clampedElevation:z}}getCameraPoint(){const s=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.P(s*Math.sin(this.rollInRadians),s*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const s=l.as(1,this.center.lat)*this.worldSize;return Ke(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/s).toLngLat()}getMercatorTileCoordinates(s){if(!s)return[0,0,1,1];const g=s.canonical.z>=0?1<<s.canonical.z:Math.pow(2,s.canonical.z);return[s.canonical.x/g,s.canonical.y/g,1/g/l.a5,1/g/l.a5]}}class lo{constructor(s,g){this.min=s,this.max=g,this.center=l.a$([],l.b0([],this.min,this.max),.5)}quadrant(s){const g=[s%2==0,s<2],x=l.b1(this.min),T=l.b1(this.max);for(let I=0;I<g.length;I++)x[I]=g[I]?this.min[I]:this.center[I],T[I]=g[I]?this.center[I]:this.max[I];return T[2]=this.max[2],new lo(x,T)}distanceX(s){return Math.max(Math.min(this.max[0],s[0]),this.min[0])-s[0]}distanceY(s){return Math.max(Math.min(this.max[1],s[1]),this.min[1])-s[1]}intersectsFrustum(s){let g=!0;for(let x=0;x<s.planes.length;x++){const T=this.intersectsPlane(s.planes[x]);if(T===0)return 0;T===1&&(g=!1)}return g?2:s.aabb.min[0]>this.max[0]||s.aabb.min[1]>this.max[1]||s.aabb.min[2]>this.max[2]||s.aabb.max[0]<this.min[0]||s.aabb.max[1]<this.min[1]||s.aabb.max[2]<this.min[2]?0:1}intersectsPlane(s){let g=s[3],x=s[3];for(let T=0;T<3;T++)s[T]>0?(g+=s[T]*this.min[T],x+=s[T]*this.max[T]):(x+=s[T]*this.min[T],g+=s[T]*this.max[T]);return g>=0?2:x<0?0:1}}class gu{distanceToTile2d(s,g,x,T){const I=T.distanceX([s,g]),O=T.distanceY([s,g]);return Math.hypot(I,O)}getWrap(s,g,x){return x}getTileBoundingVolume(s,g,x,T){var I,O;let z=0,G=0;if(T!=null&&T.terrain){const J=new l.a2(s.z,g,s.z,s.x,s.y),re=T.terrain.getMinMaxElevation(J);z=(I=re.minElevation)!==null&&I!==void 0?I:Math.min(0,x),G=(O=re.maxElevation)!==null&&O!==void 0?O:Math.max(0,x)}const q=1<<s.z;return new lo([g+s.x/q,s.y/q,z],[g+(s.x+1)/q,(s.y+1)/q,G])}allowVariableZoom(s,g){const x=s.fov*(Math.abs(Math.cos(s.rollInRadians))*s.height+Math.abs(Math.sin(s.rollInRadians))*s.width)/s.height,T=l.an(78.5-x/2,0,60);return!!g.terrain||s.pitch>T}allowWorldCopies(){return!0}prepareNextFrame(){}}class Sa{constructor(s,g,x){this.points=s,this.planes=g,this.aabb=x}static fromInvProjectionMatrix(s,g=1,x=0,T,I){const O=I?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],z=Math.pow(2,x),G=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((ie=>(function(ce,_e,Me,Pe){const Ce=l.aH([],ce,_e),Oe=1/Ce[3]/Me*Pe;return l.b6(Ce,Ce,[Oe,Oe,1/Ce[3],Oe])})(ie,s,g,z)));T&&(function(ie,ce,_e,Me){const Pe=Me?4:0,Ce=Me?0:4;let Oe=0;const We=[],ke=[];for(let Ue=0;Ue<4;Ue++){const et=l.b2([],ie[Ue+Ce],ie[Ue+Pe]),At=l.b7(et);l.a$(et,et,1/At),We.push(At),ke.push(et)}for(let Ue=0;Ue<4;Ue++){const et=l.b8(ie[Ue+Pe],ke[Ue],_e);Oe=et!==null&&et>=0?Math.max(Oe,et):Math.max(Oe,We[Ue])}const Ge=(function(Ue,et){const At=l.b2([],Ue[et[0]],Ue[et[1]]),pt=l.b2([],Ue[et[2]],Ue[et[1]]),bt=[0,0,0,0];return l.b3(bt,l.b4([],At,pt)),bt[3]=-l.b5(bt,Ue[et[0]]),bt})(ie,ce),Xe=(function(Ue,et){const At=l.b9(Ue),pt=l.ba([],Ue,1/At),bt=l.b2([],et,l.a$([],pt,l.b5(et,pt))),_t=l.b9(bt);if(_t>0){const ti=Math.sqrt(1-pt[3]*pt[3]),ii=l.a$([],pt,-pt[3]),Wt=l.b0([],ii,l.a$([],bt,ti/_t));return l.bb(et,Wt)}return null})(_e,Ge);if(Xe!==null){const Ue=Xe/l.b5(ke[0],Ge);Oe=Math.min(Oe,Ue)}for(let Ue=0;Ue<4;Ue++){const et=Math.min(Oe,We[Ue]);ie[Ue+Ce]=[ie[Ue+Pe][0]+ke[Ue][0]*et,ie[Ue+Pe][1]+ke[Ue][1]*et,ie[Ue+Pe][2]+ke[Ue][2]*et,1]}})(G,O[0],T,I);const q=O.map((ie=>{const ce=l.b2([],G[ie[0]],G[ie[1]]),_e=l.b2([],G[ie[2]],G[ie[1]]),Me=l.b3([],l.b4([],ce,_e)),Pe=-l.b5(Me,G[ie[1]]);return Me.concat(Pe)})),J=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],re=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const ie of G)for(let ce=0;ce<3;ce++)J[ce]=Math.min(J[ce],ie[ce]),re[ce]=Math.max(re[ce],ie[ce]);return new Sa(G,q,new lo(J,re))}}class bs{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(s){this._helper.setMinZoom(s)}setMaxZoom(s){this._helper.setMaxZoom(s)}setMinPitch(s){this._helper.setMinPitch(s)}setMaxPitch(s){this._helper.setMaxPitch(s)}setRenderWorldCopies(s){this._helper.setRenderWorldCopies(s)}setBearing(s){this._helper.setBearing(s)}setPitch(s){this._helper.setPitch(s)}setRoll(s){this._helper.setRoll(s)}setFov(s){this._helper.setFov(s)}setZoom(s){this._helper.setZoom(s)}setCenter(s){this._helper.setCenter(s)}setElevation(s){this._helper.setElevation(s)}setMinElevationForCurrentTile(s){this._helper.setMinElevationForCurrentTile(s)}setPadding(s){this._helper.setPadding(s)}interpolatePadding(s,g,x){return this._helper.interpolatePadding(s,g,x)}isPaddingEqual(s){return this._helper.isPaddingEqual(s)}resize(s,g,x=!0){this._helper.resize(s,g,x)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(s){this._helper.setMaxBounds(s)}setConstrainOverride(s){this._helper.setConstrainOverride(s)}overrideNearFarZ(s,g){this._helper.overrideNearFarZ(s,g)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(s){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),s)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(s,g){}constructor(s){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this.defaultConstrain=(g,x)=>{x=l.an(+x,this.minZoom,this.maxZoom);const T={center:new l.V(g.lng,g.lat),zoom:x};let I=this._helper._lngRange;if(!this._helper._renderWorldCopies&&I===null){const ke=179.9999999999;I=[-ke,ke]}const O=this.tileSize*l.aq(T.zoom);let z=0,G=O,q=0,J=O,re=0,ie=0;const{x:ce,y:_e}=this.size;if(this._helper._latRange){const ke=this._helper._latRange;z=l.X(ke[1])*O,G=l.X(ke[0])*O,G-z<_e&&(re=_e/(G-z))}I&&(q=l.W(l.Y(I[0])*O,0,O),J=l.W(l.Y(I[1])*O,0,O),J<q&&(J+=O),J-q<ce&&(ie=ce/(J-q)));const{x:Me,y:Pe}=ht(O,g);let Ce,Oe;const We=Math.max(ie||0,re||0);if(We){const ke=new l.P(ie?(J+q)/2:Me,re?(G+z)/2:Pe);return T.center=zt(O,ke).wrap(),T.zoom+=l.at(We),T}if(this._helper._latRange){const ke=_e/2;Pe-ke<z&&(Oe=z+ke),Pe+ke>G&&(Oe=G-ke)}if(I){const ke=(q+J)/2;let Ge=Me;this._helper._renderWorldCopies&&(Ge=l.W(Me,ke-O/2,ke+O/2));const Xe=ce/2;Ge-Xe<q&&(Ce=q+Xe),Ge+Xe>J&&(Ce=J-Xe)}if(Ce!==void 0||Oe!==void 0){const ke=new l.P(Ce??Me,Oe??Pe);T.center=zt(O,ke).wrap()}return T},this.applyConstrain=(g,x)=>this._helper.applyConstrain(g,x),this._helper=new za({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(g,x)=>this.defaultConstrain(g,x)},s),this._coveringTilesDetailsProvider=new gu}clone(){const s=new bs;return s.apply(this,!1),s}apply(s,g,x){this._helper.apply(s,g,x)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(s){const g=[new l.bc(0,s)];if(this._helper._renderWorldCopies){const x=this.screenPointToMercatorCoordinate(new l.P(0,0)),T=this.screenPointToMercatorCoordinate(new l.P(this._helper._width,0)),I=this.screenPointToMercatorCoordinate(new l.P(this._helper._width,this._helper._height)),O=this.screenPointToMercatorCoordinate(new l.P(0,this._helper._height)),z=Math.floor(Math.min(x.x,T.x,I.x,O.x)),G=Math.floor(Math.max(x.x,T.x,I.x,O.x)),q=1;for(let J=z-q;J<=G+q;J++)J!==0&&g.push(new l.bc(J,s))}return g}getCameraFrustum(){return Sa.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(s){const g=this.screenPointToLocation(this.centerPoint,s),x=s?s.getElevationForLngLatZoom(g,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(x)}setLocationAtPoint(s,g){const x=l.as(this.elevation,this.center.lat),T=this.screenPointToMercatorCoordinateAtZ(g,x),I=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,x),O=l.a9.fromLngLat(s),z=new l.a9(O.x-(T.x-I.x),O.y-(T.y-I.y));this.setCenter(z==null?void 0:z.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(s,g){return g?this.coordinatePoint(l.a9.fromLngLat(s),g.getElevationForLngLat(s,this),this._pixelMatrix3D):this.coordinatePoint(l.a9.fromLngLat(s))}screenPointToLocation(s,g){var x;return(x=this.screenPointToMercatorCoordinate(s,g))===null||x===void 0?void 0:x.toLngLat()}screenPointToMercatorCoordinate(s,g){if(g){const x=g.pointCoordinate(s);if(x!=null)return x}return this.screenPointToMercatorCoordinateAtZ(s)}screenPointToMercatorCoordinateAtZ(s,g){const x=g||0,T=[s.x,s.y,0,1],I=[s.x,s.y,1,1];l.aH(T,T,this._pixelMatrixInverse),l.aH(I,I,this._pixelMatrixInverse);const O=T[3],z=I[3],G=T[1]/O,q=I[1]/z,J=T[2]/O,re=I[2]/z,ie=J===re?0:(x-J)/(re-J);return new l.a9(l.G.number(T[0]/O,I[0]/z,ie)/this.worldSize,l.G.number(G,q,ie)/this.worldSize,x)}coordinatePoint(s,g=0,x=this._pixelMatrix){const T=[s.x*this.worldSize,s.y*this.worldSize,g,1];return l.aH(T,T,x),new l.P(T[0]/T[3],T[1]/T[3])}getBounds(){const s=Math.max(0,this._helper._height/2-Pt(this));return new Ir().extend(this.screenPointToLocation(new l.P(0,s))).extend(this.screenPointToLocation(new l.P(this._helper._width,s))).extend(this.screenPointToLocation(new l.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new l.P(0,this._helper._height)))}isPointOnMapSurface(s,g){return g?g.pointCoordinate(s)!=null:s.y>this.height/2-Pt(this)}calculatePosMatrix(s,g=!1,x){var T;const I=(T=s.key)!==null&&T!==void 0?T:l.bd(s.wrap,s.canonical.z,s.canonical.z,s.canonical.x,s.canonical.y),O=g?this._alignedPosMatrixCache:this._posMatrixCache;if(O.has(I)){const q=O.get(I);return x?q.f32:q.f64}const z=qt(s,this.worldSize);l.S(z,g?this._alignedProjMatrix:this._viewProjMatrix,z);const G={f64:z,f32:new Float32Array(z)};return O.set(I,G),x?G.f32:G.f64}calculateFogMatrix(s){const g=s.key,x=this._fogMatrixCacheF32;if(x.has(g))return x.get(g);const T=qt(s,this.worldSize);return l.S(T,this._fogMatrix,T),x.set(g,new Float32Array(T)),x.get(g)}calculateCenterFromCameraLngLatAlt(s,g,x,T){return this._helper.calculateCenterFromCameraLngLatAlt(s,g,x,T)}_calculateNearFarZIfNeeded(s,g,x){if(!this._helper.autoCalculateNearFarZ)return;const T=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),I=s-T*this._helper._pixelPerMeter/Math.cos(g),O=T<0?I:s,z=Math.PI/2+this.pitchInRadians,G=l.ap(this.fov)*(Math.abs(Math.cos(l.ap(this.roll)))*this.height+Math.abs(Math.sin(l.ap(this.roll)))*this.width)/this.height*(.5+x.y/this.height),q=Math.sin(G)*O/Math.sin(l.an(Math.PI-z-G,.01,Math.PI-.01)),J=Pt(this),re=Math.atan(J/this._helper.cameraToCenterDistance),ie=l.ap(.75),ce=re>ie?2*re*(.5+x.y/(2*J)):ie,_e=Math.sin(ce)*O/Math.sin(l.an(Math.PI-z-ce,.01,Math.PI-.01)),Me=Math.min(q,_e);this._helper._farZ=1.01*(Math.cos(Math.PI/2-g)*Me+O),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const s=this.centerOffset,g=ht(this.worldSize,this.center),x=g.x,T=g.y;this._helper._pixelPerMeter=l.as(1,this.center.lat)*this.worldSize;const I=l.ap(Math.min(this.pitch,Qe)),O=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(I));let z;this._calculateNearFarZIfNeeded(O,I,s),z=new Float64Array(16),l.be(z,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),l.aB(this._invProjMatrix,z),z[8]=2*-s.x/this._helper._width,z[9]=2*s.y/this._helper._height,this._projectionMatrix=l.bf(z),l.Q(z,z,[1,-1,1]),l.O(z,z,[0,0,-this._helper.cameraToCenterDistance]),l.bg(z,z,-this.rollInRadians),l.bh(z,z,this.pitchInRadians),l.bg(z,z,-this.bearingInRadians),l.O(z,z,[-x,-T,0]),this._mercatorMatrix=l.Q([],z,[this.worldSize,this.worldSize,this.worldSize]),l.Q(z,z,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=l.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,z),l.O(z,z,[0,0,-this.elevation]),this._viewProjMatrix=z,this._invViewProjMatrix=l.aB([],z);const G=[0,0,-1,1];l.aH(G,G,this._invViewProjMatrix),this._cameraPosition=[G[0]/G[3],G[1]/G[3],G[2]/G[3]],this._fogMatrix=new Float64Array(16),l.be(this._fogMatrix,this.fovInRadians,this.width/this.height,O,this._helper._farZ),this._fogMatrix[8]=2*-s.x/this.width,this._fogMatrix[9]=2*s.y/this.height,l.Q(this._fogMatrix,this._fogMatrix,[1,-1,1]),l.O(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),l.bg(this._fogMatrix,this._fogMatrix,-this.rollInRadians),l.bh(this._fogMatrix,this._fogMatrix,this.pitchInRadians),l.bg(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),l.O(this._fogMatrix,this._fogMatrix,[-x,-T,0]),l.Q(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),l.O(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=l.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,z);const q=this._helper._width%2/2,J=this._helper._height%2/2,re=Math.cos(this.bearingInRadians),ie=Math.sin(-this.bearingInRadians),ce=x-Math.round(x)+re*q+ie*J,_e=T-Math.round(T)+re*J+ie*q,Me=new Float64Array(z);if(l.O(Me,Me,[ce>.5?ce-1:ce,_e>.5?_e-1:_e,0]),this._alignedProjMatrix=Me,z=l.aB(new Float64Array(16),this._pixelMatrix),!z)throw new Error("failed to invert matrix");this._pixelMatrixInverse=z,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const s=this.screenPointToMercatorCoordinate(new l.P(0,0)),g=[s.x*this.worldSize,s.y*this.worldSize,0,1];return l.aH(g,g,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const s=l.as(1,this.center.lat)*this.worldSize;return Ke(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/s).toLngLat()}lngLatToCameraDepth(s,g){const x=l.a9.fromLngLat(s),T=[x.x*this.worldSize,x.y*this.worldSize,g,1];return l.aH(T,T,this._viewProjMatrix),T[2]/T[3]}getProjectionData(s){const{overscaledTileID:g,aligned:x,applyTerrainMatrix:T}=s,I=this._helper.getMercatorTileCoordinates(g),O=g?this.calculatePosMatrix(g,x,!0):null;let z;return z=g&&g.terrainRttPosMatrix32f&&T?g.terrainRttPosMatrix32f:O||l.bi(),{mainMatrix:z,tileMercatorCoords:I,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:z}}isLocationOccluded(s){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(s,g,x){return 1}transformLightDirection(s){return l.b1(s)}getRayDirectionFromPixel(s){throw new Error("Not implemented.")}projectTileCoordinates(s,g,x,T){const I=this.calculatePosMatrix(x);let O;T?(O=[s,g,T(s,g),1],l.aH(O,O,I)):(O=[s,g,0,1],Io(O,O,I));const z=O[3];return{point:new l.P(O[0]/z,O[1]/z),signedDistanceFromCamera:z,isOccluded:!1}}populateCache(s){for(const g of s)this.calculatePosMatrix(g)}getMatrixForModel(s,g){const x=l.a9.fromLngLat(s,g),T=x.meterInMercatorCoordinateUnits(),I=l.bj();return l.O(I,I,[x.x,x.y,x.z]),l.bg(I,I,Math.PI),l.bh(I,I,Math.PI/2),l.Q(I,I,[-T,T,T]),I}getProjectionDataForCustomLayer(s=!0){const g=new l.a2(0,0,0,0,0),x=this.getProjectionData({overscaledTileID:g,applyGlobeMatrix:s}),T=qt(g,this.worldSize);l.S(T,this._viewProjMatrix,T),x.tileMercatorCoords=[0,0,1,1];const I=[l.a5,l.a5,this.worldSize/this._helper.pixelsPerMeter],O=l.bk();return l.Q(O,T,I),x.fallbackMatrix=O,x.mainMatrix=O,x}getFastPathSimpleProjectionMatrix(s){return this.calculatePosMatrix(s)}}function Ea(){l.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function gf(C){if(C.useSlerp)if(C.k<1){const s=l.bl(C.startEulerAngles.roll,C.startEulerAngles.pitch,C.startEulerAngles.bearing),g=l.bl(C.endEulerAngles.roll,C.endEulerAngles.pitch,C.endEulerAngles.bearing),x=new Float64Array(4);l.bm(x,s,g,C.k);const T=l.bn(x);C.tr.setRoll(T.roll),C.tr.setPitch(T.pitch),C.tr.setBearing(T.bearing)}else C.tr.setRoll(C.endEulerAngles.roll),C.tr.setPitch(C.endEulerAngles.pitch),C.tr.setBearing(C.endEulerAngles.bearing);else C.tr.setRoll(l.G.number(C.startEulerAngles.roll,C.endEulerAngles.roll,C.k)),C.tr.setPitch(l.G.number(C.startEulerAngles.pitch,C.endEulerAngles.pitch,C.k)),C.tr.setBearing(l.G.number(C.startEulerAngles.bearing,C.endEulerAngles.bearing,C.k))}function mu(C,s,g,x,T){const I=T.padding,O=ht(T.worldSize,g.getNorthWest()),z=ht(T.worldSize,g.getNorthEast()),G=ht(T.worldSize,g.getSouthEast()),q=ht(T.worldSize,g.getSouthWest()),J=l.ap(-x),re=O.rotate(J),ie=z.rotate(J),ce=G.rotate(J),_e=q.rotate(J),Me=new l.P(Math.max(re.x,ie.x,_e.x,ce.x),Math.max(re.y,ie.y,_e.y,ce.y)),Pe=new l.P(Math.min(re.x,ie.x,_e.x,ce.x),Math.min(re.y,ie.y,_e.y,ce.y)),Ce=Me.sub(Pe),Oe=(T.width-(I.left+I.right+s.left+s.right))/Ce.x,We=(T.height-(I.top+I.bottom+s.top+s.bottom))/Ce.y;if(We<0||Oe<0)return void Ea();const ke=Math.min(l.at(T.scale*Math.min(Oe,We)),C.maxZoom),Ge=l.P.convert(C.offset),Xe=new l.P((s.left-s.right)/2,(s.top-s.bottom)/2).rotate(l.ap(x)),Ue=Ge.add(Xe).mult(T.scale/l.aq(ke));return{center:zt(T.worldSize,O.add(G).div(2).sub(Ue)),zoom:ke,bearing:x}}class _u{get useGlobeControls(){return!1}handlePanInertia(s,g){const x=s.mag(),T=Math.abs(Pt(g));return{easingOffset:s.mult(Math.min(.75*T/x,1)),easingCenter:g.center}}handleMapControlsRollPitchBearingZoom(s,g){s.bearingDelta&&g.setBearing(g.bearing+s.bearingDelta),s.pitchDelta&&g.setPitch(g.pitch+s.pitchDelta),s.rollDelta&&g.setRoll(g.roll+s.rollDelta),s.zoomDelta&&g.setZoom(g.zoom+s.zoomDelta)}handleMapControlsPan(s,g,x){s.around.distSqr(g.centerPoint)<.01||g.setLocationAtPoint(x,s.around)}cameraForBoxAndBearing(s,g,x,T,I){return mu(s,g,x,T,I)}handleJumpToCenterZoom(s,g){s.zoom!==(g.zoom!==void 0?+g.zoom:s.zoom)&&s.setZoom(+g.zoom),g.center!==void 0&&s.setCenter(l.V.convert(g.center))}handleEaseTo(s,g){const x=s.zoom,T=s.padding,I={roll:s.roll,pitch:s.pitch,bearing:s.bearing},O={roll:g.roll===void 0?s.roll:g.roll,pitch:g.pitch===void 0?s.pitch:g.pitch,bearing:g.bearing===void 0?s.bearing:g.bearing},z=g.zoom!==void 0,G=!s.isPaddingEqual(g.padding);let q=!1;const J=z?+g.zoom:s.zoom;let re=s.centerPoint.add(g.offsetAsPoint);const ie=s.screenPointToLocation(re),{center:ce,zoom:_e}=s.applyConstrain(l.V.convert(g.center||ie),J??x);Do(s,ce);const Me=ht(s.worldSize,ie),Pe=ht(s.worldSize,ce).sub(Me),Ce=l.aq(_e-x);return q=_e!==x,{easeFunc:Oe=>{if(q&&s.setZoom(l.G.number(x,_e,Oe)),l.bo(I,O)||gf({startEulerAngles:I,endEulerAngles:O,tr:s,k:Oe,useSlerp:I.roll!=O.roll}),G&&(s.interpolatePadding(T,g.padding,Oe),re=s.centerPoint.add(g.offsetAsPoint)),g.around)s.setLocationAtPoint(g.around,g.aroundPoint);else{const We=l.aq(s.zoom-x),ke=_e>x?Math.min(2,Ce):Math.max(.5,Ce),Ge=Math.pow(ke,1-Oe),Xe=zt(s.worldSize,Me.add(Pe.mult(Oe*Ge)).mult(We));s.setLocationAtPoint(s.renderWorldCopies?Xe.wrap():Xe,re)}},isZooming:q,elevationCenter:ce}}handleFlyTo(s,g){const x=g.zoom!==void 0,T=s.zoom,I=s.applyConstrain(l.V.convert(g.center||g.locationAtOffset),x?+g.zoom:T),O=I.center,z=I.zoom;Do(s,O);const G=ht(s.worldSize,g.locationAtOffset),q=ht(s.worldSize,O).sub(G),J=q.mag(),re=l.aq(z-T);let ie;if(g.minZoom!==void 0){const ce=Math.min(+g.minZoom,T,z),_e=s.applyConstrain(O,ce).zoom;ie=l.aq(_e-T)}return{easeFunc:(ce,_e,Me,Pe)=>{s.setZoom(ce===1?z:T+l.at(_e));const Ce=ce===1?O:zt(s.worldSize,G.add(q.mult(Me)).mult(_e));s.setLocationAtPoint(s.renderWorldCopies?Ce.wrap():Ce,Pe)},scaleOfZoom:re,targetCenter:O,scaleOfMinZoom:ie,pixelPathLength:J}}}class $n{constructor(s,g,x){this.blendFunction=s,this.blendColor=g,this.mask=x}}$n.Replace=[1,0],$n.disabled=new $n($n.Replace,l.bp.transparent,[!1,!1,!1,!1]),$n.unblended=new $n($n.Replace,l.bp.transparent,[!0,!0,!0,!0]),$n.alphaBlended=new $n([1,771],l.bp.transparent,[!0,!0,!0,!0]);const Uc=2305;class fn{constructor(s,g,x){this.enable=s,this.mode=g,this.frontFace=x}}fn.disabled=new fn(!1,1029,Uc),fn.backCCW=new fn(!0,1029,Uc),fn.frontCCW=new fn(!0,1028,Uc);class Ki{constructor(s,g,x){this.func=s,this.mask=g,this.range=x}}Ki.ReadOnly=!1,Ki.ReadWrite=!0,Ki.disabled=new Ki(519,Ki.ReadOnly,[0,1]);const yu=7680;class Mn{constructor(s,g,x,T,I,O){this.test=s,this.ref=g,this.mask=x,this.fail=T,this.depthFail=I,this.pass=O}}Mn.disabled=new Mn({func:519,mask:0},0,0,yu,yu,yu);const mh=new WeakMap;function Oo(C){var s;if(mh.has(C))return mh.get(C);{const g=(s=C.getParameter(C.VERSION))===null||s===void 0?void 0:s.startsWith("WebGL 2.0");return mh.set(C,g),g}}class Vc{get awaitingQuery(){return!!this._readbackQueue}constructor(s){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=s;const g=s.context,x=g.gl;this._texFormat=x.RGBA,this._texType=x.UNSIGNED_BYTE;const T=new l.aW;T.emplaceBack(-1,-1),T.emplaceBack(2,-1),T.emplaceBack(-1,2);const I=new l.aY;I.emplaceBack(0,1,2),this._fullscreenTriangle=new Wn(g.createVertexBuffer(T,fs.members),g.createIndexBuffer(I),l.aX.simpleSegment(0,0,T.length,I.length)),this._resultBuffer=new Uint8Array(4),g.activeTexture.set(x.TEXTURE1);const O=x.createTexture();x.bindTexture(x.TEXTURE_2D,O),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,x.CLAMP_TO_EDGE),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,x.CLAMP_TO_EDGE),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,x.NEAREST),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,x.NEAREST),x.texImage2D(x.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=g.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(O),Oo(x)&&(this._pbo=x.createBuffer(),x.bindBuffer(x.PIXEL_PACK_BUFFER,this._pbo),x.bufferData(x.PIXEL_PACK_BUFFER,4,x.STREAM_READ),x.bindBuffer(x.PIXEL_PACK_BUFFER,null))}destroy(){const s=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),s.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(s,g){const x=this._updateCount;return this._readbackQueue?x>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():x>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(s,g),this._updateCount++,this._measuredError}_bindFramebuffer(){const s=this._cachedRenderContext.context,g=s.gl;s.activeTexture.set(g.TEXTURE1),g.bindTexture(g.TEXTURE_2D,this._fbo.colorAttachment.get()),s.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(s,g){const x=this._cachedRenderContext.context,T=x.gl;if(this._bindFramebuffer(),x.viewport.set([0,0,this._texWidth,this._texHeight]),x.clear({color:l.bp.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(x,T.TRIANGLES,Ki.disabled,Mn.disabled,$n.unblended,fn.disabled,((I,O)=>({u_input:I,u_output_expected:O}))(s,g),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&Oo(T)){T.bindBuffer(T.PIXEL_PACK_BUFFER,this._pbo),T.readBuffer(T.COLOR_ATTACHMENT0),T.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),T.bindBuffer(T.PIXEL_PACK_BUFFER,null);const I=T.fenceSync(T.SYNC_GPU_COMMANDS_COMPLETE,0);T.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:I}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const s=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&Oo(s)){const g=s.clientWaitSync(this._readbackQueue.sync,0,0);if(g===s.WAIT_FAILED)return l.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(g===s.TIMEOUT_EXPIRED)return;s.bindBuffer(s.PIXEL_PACK_BUFFER,this._pbo),s.getBufferSubData(s.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),s.bindBuffer(s.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),s.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=Vc._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(s){let g=0;return g+=s[0]/256,g+=s[1]/65536,g+=s[2]/16777216,s[3]<127&&(g=-g),g/128}}const Ma=l.a5/128;function Np(C,s){const g=C.granularity!==void 0?Math.max(C.granularity,1):1,x=g+(C.generateBorders?2:0),T=g+(C.extendToNorthPole||C.generateBorders?1:0)+(C.extendToSouthPole||C.generateBorders?1:0),I=x+1,O=T+1,z=C.generateBorders?-1:0,G=C.generateBorders||C.extendToNorthPole?-1:0,q=g+(C.generateBorders?1:0),J=g+(C.generateBorders||C.extendToSouthPole?1:0),re=I*O,ie=x*T*6,ce=I*O>65536;if(ce&&s==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const _e=ce||s==="32bit",Me=new Int16Array(2*re);let Pe=0;for(let We=G;We<=J;We++)for(let ke=z;ke<=q;ke++){let Ge=ke/g*l.a5;ke===-1&&(Ge=-Ma),ke===g+1&&(Ge=l.a5+Ma);let Xe=We/g*l.a5;We===-1&&(Xe=C.extendToNorthPole?l.br:-Ma),We===g+1&&(Xe=C.extendToSouthPole?l.bs:l.a5+Ma),Me[Pe++]=Ge,Me[Pe++]=Xe}const Ce=_e?new Uint32Array(ie):new Uint16Array(ie);let Oe=0;for(let We=0;We<T;We++)for(let ke=0;ke<x;ke++){const Ge=ke+1+We*I,Xe=ke+(We+1)*I,Ue=ke+1+(We+1)*I;Ce[Oe++]=ke+We*I,Ce[Oe++]=Xe,Ce[Oe++]=Ge,Ce[Oe++]=Ge,Ce[Oe++]=Xe,Ce[Oe++]=Ue}return{vertices:Me.buffer.slice(0),indices:Ce.buffer.slice(0),uses32bitIndices:_e}}const mf=new l.aV({fill:new l.bt(128,2),line:new l.bt(512,0),tile:new l.bt(128,32),stencil:new l.bt(128,1),circle:3});class xn{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return wr.projectionGlobe}get vertexShaderPreludeCode(){return wr.projectionMercator.vertexSource}get subdivisionGranularity(){return mf}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(s){this._errorMeasurement||(this._errorMeasurement=new Vc(s));const g=l.X(this._errorQueryLatitudeDegrees),x=2*Math.atan(Math.exp(Math.PI-g*Math.PI*2))-.5*Math.PI,T=this._errorMeasurement.updateErrorLoop(g,x),I=Ae();T!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=T,this._errorMeasurementLastChangeTime=I);const O=Math.min(Math.max((I-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=l.bu(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,l.bv(O))}_getMeshKey(s){return`${s.granularity.toString(36)}_${s.generateBorders?"b":""}${s.extendToNorthPole?"n":""}${s.extendToSouthPole?"s":""}`}getMeshFromTileID(s,g,x,T,I){const O=(I==="stencil"?mf.stencil:mf.tile).getGranularityForZoomLevel(g.z);return this._getMesh(s,{granularity:O,generateBorders:x,extendToNorthPole:g.y===0&&T,extendToSouthPole:g.y===(1<<g.z)-1&&T})}_getMesh(s,g){const x=this._getMeshKey(g);if(x in this._tileMeshCache)return this._tileMeshCache[x];const T=(function(I,O){const z=Np(O,"16bit"),G=l.aW.deserialize({arrayBuffer:z.vertices,length:z.vertices.byteLength/2/2}),q=l.aY.deserialize({arrayBuffer:z.indices,length:z.indices.byteLength/2/3});return new Wn(I.createVertexBuffer(G,fs.members),I.createIndexBuffer(q),l.aX.simpleSegment(0,0,G.length,q.length))})(s,g);return this._tileMeshCache[x]=T,T}recalculate(s){}hasTransition(){const s=Ae();let g=!1;return g=g||(s-this._errorMeasurementLastChangeTime)/1e3<.7,g=g||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,g}setErrorQueryLatitudeDegrees(s){this._errorQueryLatitudeDegrees=s}}const _f=new l.t({type:new l.D(l.u.projection.type)});class h0 extends l.E{constructor(s){super(),this._transitionable=new l.x(_f,void 0),this.setProjection(s),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new l.H(0)),this._mercatorProjection=new Is,this._verticalPerspectiveProjection=new xn}get transitionState(){const s=this.properties.get("type");if(typeof s=="string"&&s==="mercator")return 0;if(typeof s=="string"&&s==="vertical-perspective")return 1;if(s instanceof l.bw){if(s.from==="vertical-perspective"&&s.to==="mercator")return 1-s.transition;if(s.from==="mercator"&&s.to==="vertical-perspective")return s.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(s){this._mercatorProjection.updateGPUdependent(s),this._verticalPerspectiveProjection.updateGPUdependent(s)}getMeshFromTileID(s,g,x,T,I){return this.currentProjection.getMeshFromTileID(s,g,x,T,I)}setProjection(s){this._transitionable.setValue("type",(s==null?void 0:s.type)||"mercator")}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}setErrorQueryLatitudeDegrees(s){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(s),this._mercatorProjection.setErrorQueryLatitudeDegrees(s)}}function is(C){const s=vu(C.worldSize,C.center.lat);return 2*Math.PI*s}function Fo(C,s,g,x,T){const I=1/(1<<T),O=s/l.a5*I+x*I,z=l.bz((C/l.a5*I+g*I)*Math.PI*2+Math.PI,2*Math.PI),G=2*Math.atan(Math.exp(Math.PI-O*Math.PI*2))-.5*Math.PI,q=Math.cos(G),J=new Float64Array(3);return J[0]=Math.sin(z)*q,J[1]=Math.sin(G),J[2]=Math.cos(z)*q,J}function Sr(C){return(function(s,g){const x=Math.cos(g),T=new Float64Array(3);return T[0]=Math.sin(s)*x,T[1]=Math.sin(g),T[2]=Math.cos(s)*x,T})(C.lng*Math.PI/180,C.lat*Math.PI/180)}function vu(C,s){return C/(2*Math.PI)/Math.cos(s*Math.PI/180)}function xu(C){const s=Math.asin(C[1])/Math.PI*180,g=Math.sqrt(C[0]*C[0]+C[2]*C[2]);if(g>1e-6){const x=C[0]/g,T=Math.acos(C[2]/g),I=(x>0?T:-T)/Math.PI*180;return new l.V(l.W(I,-180,180),s)}return new l.V(0,s)}function _h(C){return Math.cos(C*Math.PI/180)}function Dr(C,s){const g=_h(C),x=_h(s);return l.at(x/g)}function f0(C,s){const g=C.rotate(s.bearingInRadians),x=s.zoom+Dr(s.center.lat,0),T=l.bu(1/_h(s.center.lat),1/_h(Math.min(Math.abs(s.center.lat),60)),l.bx(x,7,3,0,1)),I=360/is({worldSize:s.worldSize,center:{lat:s.center.lat}});return new l.V(s.center.lng-g.x*I*T,l.an(s.center.lat+g.y*I,-l.ao,l.ao))}function bu(C){const s=.5*C,g=Math.sin(s),x=Math.cos(s);return Math.log(g+x)-Math.log(x-g)}function Bp(C,s,g,x){const T=C.lat+g*x;if(Math.abs(g)>1){const I=(Math.sign(C.lat+g)!==Math.sign(C.lat)?-Math.abs(C.lat):Math.abs(C.lat))*Math.PI/180,O=Math.abs(C.lat+g)*Math.PI/180,z=bu(I+x*(O-I)),G=bu(I),q=bu(O);return new l.V(C.lng+s*((z-G)/(q-G)),T)}return new l.V(C.lng+s*x,T)}class d0{constructor(s){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=s}swapBuffers(){if(!this._hadAnyChanges)return;const s=this._cachePrevious;this._cachePrevious=this._cache,this._cache=s,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(s,g,x,T){const I=`${s.z}_${s.x}_${s.y}_${T!=null&&T.terrain?"t":""}`,O=this._cache.get(I);if(O)return O;const z=this._cachePrevious.get(I);if(z)return this._cache.set(I,z),z;const G=this._boundingVolumeFactory(s,g,x,T);return this._cache.set(I,G),this._hadAnyChanges=!0,G}}class ye{constructor(s,g,x,T){this.min=x,this.max=T,this.points=s,this.planes=g}static fromAabb(s,g){const x=[];for(let T=0;T<8;T++)x.push([1&~T?s[0]:g[0],(T>>1&1)==1?g[1]:s[1],(T>>2&1)==1?g[2]:s[2]]);return new ye(x,[[-1,0,0,g[0]],[1,0,0,-s[0]],[0,-1,0,g[1]],[0,1,0,-s[1]],[0,0,-1,g[2]],[0,0,1,-s[2]]],s,g)}static fromCenterSizeAngles(s,g,x){const T=l.bB([],x[0],x[1],x[2]),I=l.bC([],[g[0],0,0],T),O=l.bC([],[0,g[1],0],T),z=l.bC([],[0,0,g[2]],T),G=[...s],q=[...s];for(let re=0;re<8;re++)for(let ie=0;ie<3;ie++){const ce=s[ie]+I[ie]*(1&~re?-1:1)+O[ie]*((re>>1&1)==1?1:-1)+z[ie]*((re>>2&1)==1?1:-1);G[ie]=Math.min(G[ie],ce),q[ie]=Math.max(q[ie],ce)}const J=[];for(let re=0;re<8;re++){const ie=[...s];l.b0(ie,ie,l.a$([],I,1&~re?-1:1)),l.b0(ie,ie,l.a$([],O,(re>>1&1)==1?1:-1)),l.b0(ie,ie,l.a$([],z,(re>>2&1)==1?1:-1)),J.push(ie)}return new ye(J,[[...I,-l.b5(I,J[0])],[...O,-l.b5(O,J[0])],[...z,-l.b5(z,J[0])],[-I[0],-I[1],-I[2],-l.b5(I,J[7])],[-O[0],-O[1],-O[2],-l.b5(O,J[7])],[-z[0],-z[1],-z[2],-l.b5(z,J[7])]],G,q)}intersectsFrustum(s){let g=!0;const x=this.points.length,T=this.planes.length,I=s.planes.length,O=s.points.length;for(let z=0;z<I;z++){const G=s.planes[z];let q=0;for(let J=0;J<x;J++){const re=this.points[J];G[0]*re[0]+G[1]*re[1]+G[2]*re[2]+G[3]>=0&&q++}if(q===0)return 0;q<x&&(g=!1)}if(g)return 2;for(let z=0;z<T;z++){const G=this.planes[z];let q=0;for(let J=0;J<O;J++){const re=s.points[J];G[0]*re[0]+G[1]*re[1]+G[2]*re[2]+G[3]>=0&&q++}if(q===0)return 0}return 1}intersectsPlane(s){const g=this.points.length;let x=0;for(let T=0;T<g;T++){const I=this.points[T];s[0]*I[0]+s[1]*I[1]+s[2]*I[2]+s[3]>=0&&x++}return x===g?2:x===0?0:1}}function me(C,s,g){const x=C-s;return x<0?-x:Math.max(0,x-g)}function Ve(C,s,g,x,T){const I=C-g;let O;return O=I<0?Math.min(-I,1+I-T):I>1?Math.min(Math.max(I-T,0),1-I):0,Math.max(O,me(s,x,T))}class Z{constructor(){this._boundingVolumeCache=new d0(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(s,g,x,T){const I=1<<x.z,O=1/I,z=x.x/I,G=x.y/I;let q=2;return q=Math.min(q,Ve(s,g,z,G,O)),q=Math.min(q,Ve(s,g,z+.5,-G-O,O)),q=Math.min(q,Ve(s,g,z+.5,2-G-O,O)),q}getWrap(s,g,x){const T=1<<g.z,I=1/T,O=g.x/T,z=me(s.x,O,I),G=me(s.x,O-1,I),q=me(s.x,O+1,I),J=Math.min(z,G,q);return J===q?1:J===G?-1:0}allowVariableZoom(s,g){return Bn(s,g)>4}allowWorldCopies(){return!1}getTileBoundingVolume(s,g,x,T){return this._boundingVolumeCache.getTileBoundingVolume(s,g,x,T)}_computeTileBoundingVolume(s,g,x,T){var I,O;let z=0,G=0;if(T!=null&&T.terrain){const q=new l.a2(s.z,g,s.z,s.x,s.y),J=T.terrain.getMinMaxElevation(q);z=(I=J.minElevation)!==null&&I!==void 0?I:Math.min(0,x),G=(O=J.maxElevation)!==null&&O!==void 0?O:Math.max(0,x)}if(z/=l.bE,G/=l.bE,z+=1,G+=1,s.z<=0)return ye.fromAabb([-G,-G,-G],[G,G,G]);if(s.z===1)return ye.fromAabb([s.x===0?-G:0,s.y===0?0:-G,-G],[s.x===0?0:G,s.y===0?G:0,G]);{const q=[Fo(0,0,s.x,s.y,s.z),Fo(l.a5,0,s.x,s.y,s.z),Fo(l.a5,l.a5,s.x,s.y,s.z),Fo(0,l.a5,s.x,s.y,s.z)],J=[];for(const bt of q)J.push(l.a$([],bt,G));if(G!==z)for(const bt of q)J.push(l.a$([],bt,z));s.y===0&&J.push([0,1,0]),s.y===(1<<s.z)-1&&J.push([0,-1,0]);const re=[1,1,1],ie=[-1,-1,-1];for(const bt of J)for(let _t=0;_t<3;_t++)re[_t]=Math.min(re[_t],bt[_t]),ie[_t]=Math.max(ie[_t],bt[_t]);const ce=Fo(l.a5/2,l.a5/2,s.x,s.y,s.z),_e=l.b4([],[0,1,0],ce);l.b3(_e,_e);const Me=l.b4([],ce,_e);l.b3(Me,Me);const Pe=l.b4([],q[2],q[1]);l.b3(Pe,Pe);const Ce=l.b4([],q[0],q[3]);l.b3(Ce,Ce),J.push(l.a$([],ce,G)),s.y>=(1<<s.z)/2&&J.push(l.a$([],Fo(l.a5/2,0,s.x,s.y,s.z),G)),s.y<(1<<s.z)/2&&J.push(l.a$([],Fo(l.a5/2,l.a5,s.x,s.y,s.z),G));const Oe=mt(ce,J),We=mt(Me,J),ke=[-ce[0],-ce[1],-ce[2],Oe.max],Ge=[ce[0],ce[1],ce[2],-Oe.min],Xe=[-Me[0],-Me[1],-Me[2],We.max],Ue=[Me[0],Me[1],Me[2],-We.min],et=[...Pe,0],At=[...Ce,0],pt=[];return s.y===0?pt.push(l.bD(At,et,ke),l.bD(At,et,Ge)):pt.push(l.bD(Xe,et,ke),l.bD(Xe,et,Ge),l.bD(Xe,At,ke),l.bD(Xe,At,Ge)),s.y===(1<<s.z)-1?pt.push(l.bD(At,et,ke),l.bD(At,et,Ge)):pt.push(l.bD(Ue,et,ke),l.bD(Ue,et,Ge),l.bD(Ue,At,ke),l.bD(Ue,At,Ge)),new ye(pt,[ke,Ge,Xe,Ue,et,At],re,ie)}}}function mt(C,s){let g=1/0,x=-1/0;for(const T of s){const I=l.b5(C,T);g=Math.min(g,I),x=Math.max(x,I)}return{min:g,max:x}}class c{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(s){this._helper.setMinZoom(s)}setMaxZoom(s){this._helper.setMaxZoom(s)}setMinPitch(s){this._helper.setMinPitch(s)}setMaxPitch(s){this._helper.setMaxPitch(s)}setRenderWorldCopies(s){this._helper.setRenderWorldCopies(s)}setBearing(s){this._helper.setBearing(s)}setPitch(s){this._helper.setPitch(s)}setRoll(s){this._helper.setRoll(s)}setFov(s){this._helper.setFov(s)}setZoom(s){this._helper.setZoom(s)}setCenter(s){this._helper.setCenter(s)}setElevation(s){this._helper.setElevation(s)}setMinElevationForCurrentTile(s){this._helper.setMinElevationForCurrentTile(s)}setPadding(s){this._helper.setPadding(s)}interpolatePadding(s,g,x){return this._helper.interpolatePadding(s,g,x)}isPaddingEqual(s){return this._helper.isPaddingEqual(s)}resize(s,g){this._helper.resize(s,g)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(s){this._helper.setMaxBounds(s)}setConstrainOverride(s){this._helper.setConstrainOverride(s)}overrideNearFarZ(s,g){this._helper.overrideNearFarZ(s,g)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(s){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),s)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(s){}constructor(s){this._cachedClippingPlane=l.bF(),this._projectionMatrix=l.bj(),this._globeViewProjMatrix32f=l.bi(),this._globeViewProjMatrixNoCorrection=l.bj(),this._globeViewProjMatrixNoCorrectionInverted=l.bj(),this._globeProjMatrixInverted=l.bj(),this._cameraPosition=l.bA(),this._globeLatitudeErrorCorrectionRadians=0,this.defaultConstrain=(g,x)=>{const T=l.an(g.lat,-l.ao,l.ao),I=l.an(+x,this.minZoom+Dr(0,T),this.maxZoom);return{center:new l.V(g.lng,T),zoom:I}},this.applyConstrain=(g,x)=>this._helper.applyConstrain(g,x),this._helper=new za({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(g,x)=>this.defaultConstrain(g,x)},s),this._coveringTilesDetailsProvider=new Z}clone(){const s=new c;return s.apply(this,!1),s}apply(s,g,x){this._globeLatitudeErrorCorrectionRadians=x||0,this._helper.apply(s,g)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const s=l.bA();return s[0]=this._cameraPosition[0],s[1]=this._cameraPosition[1],s[2]=this._cameraPosition[2],s}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(s){const{overscaledTileID:g,applyGlobeMatrix:x}=s,T=this._helper.getMercatorTileCoordinates(g);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:T,clippingPlane:this._cachedClippingPlane,projectionTransition:x?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(s){const g=this.pitchInRadians,x=this.cameraToCenterDistance/s,T=Math.sin(g)*x,I=Math.cos(g)*x+1,O=1/Math.sqrt(T*T+I*I)*1;let z=-T,G=I;const q=Math.sqrt(z*z+G*G);z/=q,G/=q;const J=[0,z,G];l.bG(J,J,[0,0,0],-this.bearingInRadians),l.bH(J,J,[0,0,0],-1*this.center.lat*Math.PI/180),l.bI(J,J,[0,0,0],this.center.lng*Math.PI/180);const re=1/l.b7(J);return l.a$(J,J,re),[...J,-O*re]}isLocationOccluded(s){return!this.isSurfacePointVisible(Sr(s))}transformLightDirection(s){const g=this._helper._center.lng*Math.PI/180,x=this._helper._center.lat*Math.PI/180,T=Math.cos(x),I=[Math.sin(g)*T,Math.sin(x),Math.cos(g)*T],O=[I[2],0,-I[0]],z=[0,0,0];l.b4(z,O,I),l.b3(O,O),l.b3(z,z);const G=[0,0,0];return l.b3(G,[O[0]*s[0]+z[0]*s[1]+I[0]*s[2],O[1]*s[0]+z[1]*s[1]+I[1]*s[2],O[2]*s[0]+z[2]*s[1]+I[2]*s[2]]),G}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(s,g,x){const T=(function(z,G,q){const J=1/(1<<q.z);return new l.a9(z/l.a5*J+q.x*J,G/l.a5*J+q.y*J)})(s,g,x.canonical),I=(O=T.y,[l.bz(T.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-O*Math.PI*2))-.5*Math.PI]);var O;return this.getCircleRadiusCorrection()/Math.cos(I[1])}projectTileCoordinates(s,g,x,T){const I=x.canonical,O=Fo(s,g,I.x,I.y,I.z),z=1+(T?T(s,g):0)/l.bE,G=[O[0]*z,O[1]*z,O[2]*z,1];l.aH(G,G,this._globeViewProjMatrixNoCorrection);const q=this._cachedClippingPlane,J=q[0]*O[0]+q[1]*O[1]+q[2]*O[2]+q[3]<0;return{point:new l.P(G[0]/G[3],G[1]/G[3]),signedDistanceFromCamera:G[3],isOccluded:J}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const s=vu(this.worldSize,this.center.lat),g=l.bk(),x=l.bk();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*s),l.be(g,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const T=this.centerOffset;g[8]=2*-T.x/this._helper._width,g[9]=2*T.y/this._helper._height,this._projectionMatrix=l.bf(g),this._globeProjMatrixInverted=l.bk(),l.aB(this._globeProjMatrixInverted,g),l.O(g,g,[0,0,-this.cameraToCenterDistance]),l.bg(g,g,this.rollInRadians),l.bh(g,g,-this.pitchInRadians),l.bg(g,g,this.bearingInRadians),l.O(g,g,[0,0,-s]);const I=l.bA();I[0]=s,I[1]=s,I[2]=s,l.bh(x,g,this.center.lat*Math.PI/180),l.bJ(x,x,-this.center.lng*Math.PI/180),l.Q(x,x,I),this._globeViewProjMatrixNoCorrection=x,l.bh(g,g,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),l.bJ(g,g,-this.center.lng*Math.PI/180),l.Q(g,g,I),this._globeViewProjMatrix32f=new Float32Array(g),this._globeViewProjMatrixNoCorrectionInverted=l.bk(),l.aB(this._globeViewProjMatrixNoCorrectionInverted,x);const O=l.bA();this._cameraPosition=l.bA(),this._cameraPosition[2]=this.cameraToCenterDistance/s,l.bG(this._cameraPosition,this._cameraPosition,O,-this.rollInRadians),l.bH(this._cameraPosition,this._cameraPosition,O,this.pitchInRadians),l.bG(this._cameraPosition,this._cameraPosition,O,-this.bearingInRadians),l.b0(this._cameraPosition,this._cameraPosition,[0,0,1]),l.bH(this._cameraPosition,this._cameraPosition,O,-this.center.lat*Math.PI/180),l.bI(this._cameraPosition,this._cameraPosition,O,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(s);const z=l.bf(this._globeViewProjMatrixNoCorrectionInverted);l.Q(z,z,[1,1,-1]),this._cachedFrustum=Sa.fromInvProjectionMatrix(z,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(s){l.w("calculateFogMatrix is not supported on globe projection.");const g=l.bk();return l.ar(g),g}getVisibleUnwrappedCoordinates(s){return[new l.bc(0,s)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(s){s&&l.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(s,g){if(!this._globeViewProjMatrixNoCorrection)return 1;const x=Sr(s);l.a$(x,x,1+g/l.bE);const T=l.bF();return l.aH(T,[x[0],x[1],x[2],1],this._globeViewProjMatrixNoCorrection),T[2]/T[3]}populateCache(s){}getBounds(){const s=.5*this.width,g=.5*this.height,x=[new l.P(0,0),new l.P(s,0),new l.P(this.width,0),new l.P(this.width,g),new l.P(this.width,this.height),new l.P(s,this.height),new l.P(0,this.height),new l.P(0,g)],T=[];for(const re of x)T.push(this.unprojectScreenPoint(re));let I=0,O=0,z=0,G=0;const q=this.center;for(const re of T){const ie=l.bK(q.lng,re.lng),ce=l.bK(q.lat,re.lat);ie<O&&(O=ie),ie>I&&(I=ie),ce<G&&(G=ce),ce>z&&(z=ce)}const J=[q.lng+O,q.lat+G,q.lng+I,q.lat+z];return this.isSurfacePointOnScreen([0,1,0])&&(J[3]=90,J[0]=-180,J[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(J[1]=-90,J[0]=-180,J[2]=180),new Ir(J)}calculateCenterFromCameraLngLatAlt(s,g,x,T){return this._helper.calculateCenterFromCameraLngLatAlt(s,g,x,T)}setLocationAtPoint(s,g){const x=Sr(this.unprojectScreenPoint(g)),T=Sr(s),I=l.bA();l.bL(I);const O=l.bA();l.bI(O,x,I,-this.center.lng*Math.PI/180),l.bH(O,O,I,this.center.lat*Math.PI/180);const z=T[0]*T[0]+T[2]*T[2],G=O[0]*O[0];if(z<G)return;const q=Math.sqrt(z-G),J=-q,re=l.bM(T[0],T[2],O[0],q),ie=l.bM(T[0],T[2],O[0],J),ce=l.bA();l.bI(ce,T,I,-re);const _e=l.bM(ce[1],ce[2],O[1],O[2]),Me=l.bA();l.bI(Me,T,I,-ie);const Pe=l.bM(Me[1],Me[2],O[1],O[2]),Ce=.5*Math.PI,Oe=_e>=-Ce&&_e<=Ce,We=Pe>=-Ce&&Pe<=Ce;let ke,Ge;if(Oe&&We){const At=this.center.lng*Math.PI/180,pt=this.center.lat*Math.PI/180;l.bN(re,At)+l.bN(_e,pt)<l.bN(ie,At)+l.bN(Pe,pt)?(ke=re,Ge=_e):(ke=ie,Ge=Pe)}else if(Oe)ke=re,Ge=_e;else{if(!We)return;ke=ie,Ge=Pe}const Xe=ke/Math.PI*180,Ue=Ge/Math.PI*180,et=this.center.lat;this.setCenter(new l.V(Xe,l.an(Ue,-90,90))),this.setZoom(this.zoom+Dr(et,this.center.lat))}locationToScreenPoint(s,g){const x=Sr(s);if(g){const T=g.getElevationForLngLatZoom(s,this._helper._tileZoom);l.a$(x,x,1+T/l.bE)}return this._projectSurfacePointToScreen(x)}_projectSurfacePointToScreen(s){const g=l.bF();return l.aH(g,[...s,1],this._globeViewProjMatrixNoCorrection),g[0]/=g[3],g[1]/=g[3],new l.P((.5*g[0]+.5)*this.width,(.5*-g[1]+.5)*this.height)}screenPointToMercatorCoordinate(s,g){if(g){const x=g.pointCoordinate(s);if(x)return x}return l.a9.fromLngLat(this.unprojectScreenPoint(s))}screenPointToLocation(s,g){var x;return(x=this.screenPointToMercatorCoordinate(s,g))===null||x===void 0?void 0:x.toLngLat()}isPointOnMapSurface(s,g){const x=this._cameraPosition,T=this.getRayDirectionFromPixel(s);return!!this.rayPlanetIntersection(x,T)}getRayDirectionFromPixel(s){const g=l.bF();g[0]=s.x/this.width*2-1,g[1]=-1*(s.y/this.height*2-1),g[2]=1,g[3]=1,l.aH(g,g,this._globeViewProjMatrixNoCorrectionInverted),g[0]/=g[3],g[1]/=g[3],g[2]/=g[3];const x=l.bA();x[0]=g[0]-this._cameraPosition[0],x[1]=g[1]-this._cameraPosition[1],x[2]=g[2]-this._cameraPosition[2];const T=l.bA();return l.b3(T,x),T}isSurfacePointVisible(s){const g=this._cachedClippingPlane;return g[0]*s[0]+g[1]*s[1]+g[2]*s[2]+g[3]>=0}isSurfacePointOnScreen(s){if(!this.isSurfacePointVisible(s))return!1;const g=l.bF();return l.aH(g,[...s,1],this._globeViewProjMatrixNoCorrection),g[0]/=g[3],g[1]/=g[3],g[2]/=g[3],g[0]>-1&&g[0]<1&&g[1]>-1&&g[1]<1&&g[2]>-1&&g[2]<1}rayPlanetIntersection(s,g){const x=l.b5(s,g),T=l.bA(),I=l.bA();l.a$(I,g,x),l.b2(T,s,I);const O=1-l.b5(T,T);if(O<0)return null;const z=l.b5(s,s)-1,G=-x+(x<0?1:-1)*Math.sqrt(O),q=z/G,J=G;return{tMin:Math.min(q,J),tMax:Math.max(q,J)}}unprojectScreenPoint(s){const g=this._cameraPosition,x=this.getRayDirectionFromPixel(s),T=this.rayPlanetIntersection(g,x);if(T){const J=l.bA();l.b0(J,g,[x[0]*T.tMin,x[1]*T.tMin,x[2]*T.tMin]);const re=l.bA();return l.b3(re,J),xu(re)}const I=this._cachedClippingPlane,O=I[0]*x[0]+I[1]*x[1]+I[2]*x[2],z=-l.bb(I,g)/O,G=l.bA();if(z>0)l.b0(G,g,[x[0]*z,x[1]*z,x[2]*z]);else{const J=l.bA();l.b0(J,g,[2*x[0],2*x[1],2*x[2]]);const re=l.bb(this._cachedClippingPlane,J);l.b2(G,J,[this._cachedClippingPlane[0]*re,this._cachedClippingPlane[1]*re,this._cachedClippingPlane[2]*re])}const q=(function(J){const re=l.bA();return re[0]=J[0]*-J[3],re[1]=J[1]*-J[3],re[2]=J[2]*-J[3],{center:re,radius:Math.sqrt(1-J[3]*J[3])}})(I);return xu((function(J,re,ie){const ce=l.bA();l.b2(ce,ie,J);const _e=l.bA();return l.by(_e,J,ce,re/l.b9(ce)),_e})(q.center,q.radius,G))}getMatrixForModel(s,g){const x=l.V.convert(s),T=1/l.bE,I=l.bj();return l.bJ(I,I,x.lng/180*Math.PI),l.bh(I,I,-x.lat/180*Math.PI),l.O(I,I,[0,0,1+g/l.bE]),l.bh(I,I,.5*Math.PI),l.Q(I,I,[T,T,T]),I}getProjectionDataForCustomLayer(s=!0){const g=this.getProjectionData({overscaledTileID:new l.a2(0,0,0,0,0),applyGlobeMatrix:s});return g.tileMercatorCoords=[0,0,1,1],g}getFastPathSimpleProjectionMatrix(s){}}class Re{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(s){this._helper.setMinZoom(s)}setMaxZoom(s){this._helper.setMaxZoom(s)}setMinPitch(s){this._helper.setMinPitch(s)}setMaxPitch(s){this._helper.setMaxPitch(s)}setRenderWorldCopies(s){this._helper.setRenderWorldCopies(s)}setBearing(s){this._helper.setBearing(s)}setPitch(s){this._helper.setPitch(s)}setRoll(s){this._helper.setRoll(s)}setFov(s){this._helper.setFov(s)}setZoom(s){this._helper.setZoom(s)}setCenter(s){this._helper.setCenter(s)}setElevation(s){this._helper.setElevation(s)}setMinElevationForCurrentTile(s){this._helper.setMinElevationForCurrentTile(s)}setPadding(s){this._helper.setPadding(s)}interpolatePadding(s,g,x){return this._helper.interpolatePadding(s,g,x)}isPaddingEqual(s){return this._helper.isPaddingEqual(s)}resize(s,g,x=!0){this._helper.resize(s,g,x)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(s){this._helper.setMaxBounds(s)}setConstrainOverride(s){this._helper.setConstrainOverride(s)}overrideNearFarZ(s,g){this._helper.overrideNearFarZ(s,g)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(s){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),s)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(s,g){this._globeness=s,this._globeLatitudeErrorCorrectionRadians=g,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(s){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this.defaultConstrain=(g,x)=>this.currentTransform.defaultConstrain(g,x),this.applyConstrain=(g,x)=>this._helper.applyConstrain(g,x),this._helper=new za({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(g,x)=>this.defaultConstrain(g,x)},s),this._globeness=1,this._mercatorTransform=new bs,this._verticalPerspectiveTransform=new c}clone(){const s=new Re;return s._globeness=this._globeness,s._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,s.apply(this,!1),s}apply(s,g){this._helper.apply(s,g),this._mercatorTransform.apply(this,!1),this._verticalPerspectiveTransform.apply(this,!1,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(s){const g=this._mercatorTransform.getProjectionData(s),x=this._verticalPerspectiveTransform.getProjectionData(s);return{mainMatrix:this.isGlobeRendering?x.mainMatrix:g.mainMatrix,clippingPlane:x.clippingPlane,tileMercatorCoords:x.tileMercatorCoords,projectionTransition:s.applyGlobeMatrix?this._globeness:0,fallbackMatrix:g.fallbackMatrix}}isLocationOccluded(s){return this.currentTransform.isLocationOccluded(s)}transformLightDirection(s){return this.currentTransform.transformLightDirection(s)}getPixelScale(){return l.bu(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return l.bu(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(s,g,x){const T=this._mercatorTransform.getPitchedTextCorrection(s,g,x),I=this._verticalPerspectiveTransform.getPitchedTextCorrection(s,g,x);return l.bu(T,I,this._globeness)}projectTileCoordinates(s,g,x,T){return this.currentTransform.projectTileCoordinates(s,g,x,T)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,!1,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(s){return this.currentTransform.calculateFogMatrix(s)}getVisibleUnwrappedCoordinates(s){return this.currentTransform.getVisibleUnwrappedCoordinates(s)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(s){this._mercatorTransform.recalculateZoomAndCenter(s),this._verticalPerspectiveTransform.recalculateZoomAndCenter(s)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(s,g){return this.currentTransform.lngLatToCameraDepth(s,g)}populateCache(s){this._mercatorTransform.populateCache(s),this._verticalPerspectiveTransform.populateCache(s)}getBounds(){return this.currentTransform.getBounds()}calculateCenterFromCameraLngLatAlt(s,g,x,T){return this._helper.calculateCenterFromCameraLngLatAlt(s,g,x,T)}setLocationAtPoint(s,g){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(s,g),void this.apply(this._mercatorTransform,!1);this._verticalPerspectiveTransform.setLocationAtPoint(s,g),this.apply(this._verticalPerspectiveTransform,!1)}locationToScreenPoint(s,g){return this.currentTransform.locationToScreenPoint(s,g)}screenPointToMercatorCoordinate(s,g){return this.currentTransform.screenPointToMercatorCoordinate(s,g)}screenPointToLocation(s,g){return this.currentTransform.screenPointToLocation(s,g)}isPointOnMapSurface(s,g){return this.currentTransform.isPointOnMapSurface(s,g)}getRayDirectionFromPixel(s){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(s)}getMatrixForModel(s,g){return this.currentTransform.getMatrixForModel(s,g)}getProjectionDataForCustomLayer(s=!0){const g=this._mercatorTransform.getProjectionDataForCustomLayer(s);if(!this.isGlobeRendering)return g;const x=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(s);return x.fallbackMatrix=g.mainMatrix,x}getFastPathSimpleProjectionMatrix(s){return this.currentTransform.getFastPathSimpleProjectionMatrix(s)}}class Ft{get useGlobeControls(){return!0}handlePanInertia(s,g){const x=f0(s,g);return Math.abs(x.lng-g.center.lng)>180&&(x.lng=g.center.lng+179.5*Math.sign(x.lng-g.center.lng)),{easingCenter:x,easingOffset:new l.P(0,0)}}handleMapControlsRollPitchBearingZoom(s,g){const x=s.around,T=g.screenPointToLocation(x);s.bearingDelta&&g.setBearing(g.bearing+s.bearingDelta),s.pitchDelta&&g.setPitch(g.pitch+s.pitchDelta),s.rollDelta&&g.setRoll(g.roll+s.rollDelta);const I=g.zoom;s.zoomDelta&&g.setZoom(g.zoom+s.zoomDelta);const O=g.zoom-I;if(O===0)return;const z=l.bK(g.center.lng,T.lng),G=z/(Math.abs(z/180)+1),q=l.bK(g.center.lat,T.lat),J=g.getRayDirectionFromPixel(x),re=g.cameraPosition,ie=-1*l.b5(re,J),ce=l.bA();l.b0(ce,re,[J[0]*ie,J[1]*ie,J[2]*ie]);const _e=l.b7(ce)-1,Me=Math.exp(.5*-Math.max(_e-.3,0)),Pe=vu(g.worldSize,g.center.lat)/Math.min(g.width,g.height),Ce=l.bx(Pe,.9,.5,1,.25),Oe=(1-l.aq(-O))*Math.min(Me,Ce),We=g.center.lat,ke=g.zoom,Ge=new l.V(g.center.lng+G*Oe,l.an(g.center.lat+q*Oe,-l.ao,l.ao));g.setLocationAtPoint(T,x);const Xe=g.center,Ue=l.bx(Math.abs(z),45,85,0,1),et=l.bx(Pe,.75,.35,0,1),At=Math.pow(Math.max(Ue,et),.25),pt=l.bK(Xe.lng,Ge.lng),bt=l.bK(Xe.lat,Ge.lat);g.setCenter(new l.V(Xe.lng+pt*At,Xe.lat+bt*At).wrap()),g.setZoom(ke+Dr(We,g.center.lat))}handleMapControlsPan(s,g,x){if(!s.panDelta)return;const T=g.center.lat,I=g.zoom;g.setCenter(f0(s.panDelta,g).wrap()),g.setZoom(I+Dr(T,g.center.lat))}cameraForBoxAndBearing(s,g,x,T,I){const O=mu(s,g,x,T,I),z=g.left/I.width*2-1,G=(I.width-g.right)/I.width*2-1,q=g.top/I.height*-2+1,J=(I.height-g.bottom)/I.height*-2+1,re=l.bK(x.getWest(),x.getEast())<0,ie=re?x.getEast():x.getWest(),ce=re?x.getWest():x.getEast(),_e=Math.max(x.getNorth(),x.getSouth()),Me=Math.min(x.getNorth(),x.getSouth()),Pe=ie+.5*l.bK(ie,ce),Ce=_e+.5*l.bK(_e,Me),Oe=I.clone();Oe.setCenter(O.center),Oe.setBearing(O.bearing),Oe.setPitch(0),Oe.setRoll(0),Oe.setZoom(O.zoom);const We=Oe.modelViewProjectionMatrix,ke=[Sr(x.getNorthWest()),Sr(x.getNorthEast()),Sr(x.getSouthWest()),Sr(x.getSouthEast()),Sr(new l.V(ce,Ce)),Sr(new l.V(ie,Ce)),Sr(new l.V(Pe,_e)),Sr(new l.V(Pe,Me))],Ge=Sr(O.center);let Xe=Number.POSITIVE_INFINITY;for(const Ue of ke)z<0&&(Xe=Ft.getLesserNonNegativeNonNull(Xe,Ft.solveVectorScale(Ue,Ge,We,"x",z))),G>0&&(Xe=Ft.getLesserNonNegativeNonNull(Xe,Ft.solveVectorScale(Ue,Ge,We,"x",G))),q>0&&(Xe=Ft.getLesserNonNegativeNonNull(Xe,Ft.solveVectorScale(Ue,Ge,We,"y",q))),J<0&&(Xe=Ft.getLesserNonNegativeNonNull(Xe,Ft.solveVectorScale(Ue,Ge,We,"y",J)));if(Number.isFinite(Xe)&&Xe!==0)return O.zoom=Oe.zoom+l.at(Xe),O;Ea()}handleJumpToCenterZoom(s,g){const x=s.center.lat,T=s.applyConstrain(g.center?l.V.convert(g.center):s.center,s.zoom).center;s.setCenter(T.wrap());const I=g.zoom!==void 0?+g.zoom:s.zoom+Dr(x,T.lat);s.zoom!==I&&s.setZoom(I)}handleEaseTo(s,g){const x=s.zoom,T=s.center,I=s.padding,O={roll:s.roll,pitch:s.pitch,bearing:s.bearing},z={roll:g.roll===void 0?s.roll:g.roll,pitch:g.pitch===void 0?s.pitch:g.pitch,bearing:g.bearing===void 0?s.bearing:g.bearing},G=g.zoom!==void 0,q=!s.isPaddingEqual(g.padding);let J=!1;const re=g.center?l.V.convert(g.center):T,ie=s.applyConstrain(re,x).center;Do(s,ie);const ce=s.clone();ce.setCenter(ie),ce.setZoom(G?+g.zoom:x+Dr(T.lat,re.lat)),ce.setBearing(g.bearing);const _e=new l.P(l.an(s.centerPoint.x+g.offsetAsPoint.x,0,s.width),l.an(s.centerPoint.y+g.offsetAsPoint.y,0,s.height));ce.setLocationAtPoint(ie,_e);const Me=(g.offset&&g.offsetAsPoint.mag())>0?ce.center:ie,Pe=G?+g.zoom:x+Dr(T.lat,Me.lat),Ce=x+Dr(T.lat,0),Oe=Pe+Dr(Me.lat,0),We=l.bK(T.lng,Me.lng),ke=l.bK(T.lat,Me.lat),Ge=l.aq(Oe-Ce);return J=Pe!==x,{easeFunc:Xe=>{if(l.bo(O,z)||gf({startEulerAngles:O,endEulerAngles:z,tr:s,k:Xe,useSlerp:O.roll!=z.roll}),q&&s.interpolatePadding(I,g.padding,Xe),g.around)l.w("Easing around a point is not supported under globe projection."),s.setLocationAtPoint(g.around,g.aroundPoint);else{const Ue=Oe>Ce?Math.min(2,Ge):Math.max(.5,Ge),et=Math.pow(Ue,1-Xe),At=Bp(T,We,ke,Xe*et);s.setCenter(At.wrap())}if(J){const Ue=l.G.number(Ce,Oe,Xe)+Dr(0,s.center.lat);s.setZoom(Ue)}},isZooming:J,elevationCenter:Me}}handleFlyTo(s,g){const x=g.zoom!==void 0,T=s.center,I=s.zoom,O=s.padding,z=!s.isPaddingEqual(g.padding),G=s.applyConstrain(l.V.convert(g.center||g.locationAtOffset),I).center,q=x?+g.zoom:s.zoom+Dr(s.center.lat,G.lat),J=s.clone();J.setCenter(G),J.setZoom(q),J.setBearing(g.bearing);const re=new l.P(l.an(s.centerPoint.x+g.offsetAsPoint.x,0,s.width),l.an(s.centerPoint.y+g.offsetAsPoint.y,0,s.height));J.setLocationAtPoint(G,re);const ie=J.center;Do(s,ie);const ce=(function(ke,Ge,Xe){const Ue=Sr(Ge),et=Sr(Xe),At=l.b5(Ue,et),pt=Math.acos(At),bt=is(ke);return pt/(2*Math.PI)*bt})(s,T,ie),_e=I+Dr(T.lat,0),Me=q+Dr(ie.lat,0),Pe=l.aq(Me-_e);let Ce;if(typeof g.minZoom=="number"){const ke=+g.minZoom+Dr(ie.lat,0),Ge=Math.min(ke,_e,Me)+Dr(0,ie.lat),Xe=s.applyConstrain(ie,Ge).zoom+Dr(ie.lat,0);Ce=l.aq(Xe-_e)}const Oe=l.bK(T.lng,ie.lng),We=l.bK(T.lat,ie.lat);return{easeFunc:(ke,Ge,Xe,Ue)=>{const et=Bp(T,Oe,We,Xe);z&&s.interpolatePadding(O,g.padding,ke);const At=ke===1?ie:et;s.setCenter(At.wrap());const pt=_e+l.at(Ge);s.setZoom(ke===1?q:pt+Dr(0,At.lat))},scaleOfZoom:Pe,targetCenter:ie,scaleOfMinZoom:Ce,pixelPathLength:ce}}static solveVectorScale(s,g,x,T,I){const O=T==="x"?[x[0],x[4],x[8],x[12]]:[x[1],x[5],x[9],x[13]],z=[x[3],x[7],x[11],x[15]],G=s[0]*O[0]+s[1]*O[1]+s[2]*O[2],q=s[0]*z[0]+s[1]*z[1]+s[2]*z[2],J=g[0]*O[0]+g[1]*O[1]+g[2]*O[2],re=g[0]*z[0]+g[1]*z[1]+g[2]*z[2];return J+I*q===G+I*re||z[3]*(G-J)+O[3]*(re-q)+G*re==J*q?null:(J+O[3]-I*re-I*z[3])/(J-G-I*re+I*q)}static getLesserNonNegativeNonNull(s,g){return g!==null&&g>=0&&g<s?g:s}}class ci{constructor(s){this._globe=s,this._mercatorCameraHelper=new _u,this._verticalPerspectiveCameraHelper=new Ft}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(s,g){return this.currentHelper.handlePanInertia(s,g)}handleMapControlsRollPitchBearingZoom(s,g){return this.currentHelper.handleMapControlsRollPitchBearingZoom(s,g)}handleMapControlsPan(s,g,x){this.currentHelper.handleMapControlsPan(s,g,x)}cameraForBoxAndBearing(s,g,x,T,I){return this.currentHelper.cameraForBoxAndBearing(s,g,x,T,I)}handleJumpToCenterZoom(s,g){this.currentHelper.handleJumpToCenterZoom(s,g)}handleEaseTo(s,g){return this.currentHelper.handleEaseTo(s,g)}handleFlyTo(s,g){return this.currentHelper.handleFlyTo(s,g)}}const si=(C,s)=>l.B(C,s&&s.filter((g=>g.identifier!=="source.canvas"))),dt=l.bO();class mn extends l.E{constructor(s,g={}){var x,T;super(),this._rtlPluginLoaded=()=>{for(const O in this.tileManagers){const z=this.tileManagers[O].getSource().type;z!=="vector"&&z!=="geojson"||this.tileManagers[O].reload()}},this.map=s,this.dispatcher=new Co(mr(),s._getMapId()),this.dispatcher.registerMessageHandler("GG",((O,z)=>this.getGlyphs(O,z))),this.dispatcher.registerMessageHandler("GI",((O,z)=>this.getImages(O,z))),this.dispatcher.registerMessageHandler("GDA",((O,z)=>this.getDashes(O,z))),this.imageManager=new Ei,this.imageManager.setEventedParent(this);const I=((x=s._container)===null||x===void 0?void 0:x.lang)||typeof document<"u"&&((T=document.documentElement)===null||T===void 0?void 0:T.lang)||void 0;this.glyphManager=new Ut(s._requestManager,g.localIdeographFontFamily,I),this.lineAtlas=new vi(256,512),this.crossTileSymbolIndex=new Ps,this._setInitialValues(),this._resetUpdates(),this.dispatcher.broadcast("SR",l.bP()),ve().on(it,this._rtlPluginLoaded),this.on("data",(O=>{if(O.dataType!=="source"||O.sourceDataType!=="metadata")return;const z=this.tileManagers[O.sourceId];if(!z)return;const G=z.getSource();if(G&&G.vectorLayerIds)for(const q in this._layers){const J=this._layers[q];J.source===G.id&&this._validateLayer(J)}}))}_setInitialValues(){var s;this._spritesImagesIds={},this._layers={},this._order=[],this.tileManagers={},this.zoomHistory=new l.bQ,this._availableImages=[],this._globalState={},this._serializedLayers={},this.stylesheet=null,this.light=null,this.sky=null,this.projection&&(this.projection.destroy(),delete this.projection),this._loaded=!1,this._changed=!1,this._updatedLayers={},this._updatedSources={},this._changedImages={},this._glyphsDidChange=!1,this._updatedPaintProps={},this._layerOrderChanged=!1,this.crossTileSymbolIndex=new(((s=this.crossTileSymbolIndex)===null||s===void 0?void 0:s.constructor)||Object),this.pauseablePlacement=void 0,this.placement=void 0,this.z=0}setGlobalStateProperty(s,g){var x,T,I;this._checkLoaded();const O=g===null?(I=(T=(x=this.stylesheet.state)===null||x===void 0?void 0:x[s])===null||T===void 0?void 0:T.default)!==null&&I!==void 0?I:null:g;if(l.bR(O,this._globalState[s]))return this;this._globalState[s]=O,this._applyGlobalStateChanges([s])}getGlobalState(){return this._globalState}setGlobalState(s){this._checkLoaded();const g=[];for(const x in s)!l.bR(this._globalState[x],s[x].default)&&(g.push(x),this._globalState[x]=s[x].default);this._applyGlobalStateChanges(g)}_applyGlobalStateChanges(s){if(s.length===0)return;const g=new Set,x={};for(const T of s){x[T]=this._globalState[T];for(const I in this._layers){const O=this._layers[I],z=O.getLayoutAffectingGlobalStateRefs(),G=O.getPaintAffectingGlobalStateRefs(),q=O.getVisibilityAffectingGlobalStateRefs();if(z.has(T)&&g.add(O.source),G.has(T))for(const{name:J,value:re}of G.get(T))this._updatePaintProperty(O,J,re);q!=null&&q.has(T)&&(O.recalculateVisibility(),this._updateLayer(O))}}this.dispatcher.broadcast("UGS",x);for(const T in this.tileManagers)g.has(T)&&(this._reloadSource(T),this._changed=!0)}loadURL(s,g={},x){this.fire(new l.l("dataloading",{dataType:"style"})),g.validate=typeof g.validate!="boolean"||g.validate;const T=this.map._requestManager.transformRequest(s,"Style");this._loadStyleRequest=new AbortController;const I=this._loadStyleRequest;l.j(T,this._loadStyleRequest).then((O=>{this._loadStyleRequest=null,this._load(O.data,g,x)})).catch((O=>{this._loadStyleRequest=null,O&&!I.signal.aborted&&this.fire(new l.k(O))}))}loadJSON(s,g={},x){this.fire(new l.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,se.frameAsync(this._frameRequest,this.map._ownerWindow).then((()=>{this._frameRequest=null,g.validate=g.validate!==!1,this._load(s,g,x)})).catch((()=>{}))}loadEmpty(){this.fire(new l.l("dataloading",{dataType:"style"})),this._load(dt,{validate:!1})}_load(s,g,x){var T,I;let O=g.transformStyle?g.transformStyle(x,s):s;if(!g.validate||!si(this,l.C(O))){O=Object.assign({},O),this._loaded=!0,this.stylesheet=O;for(const z in O.sources)this.addSource(z,O.sources[z],{validate:!1});O.sprite?this._loadSprite(O.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(O.glyphs),this._createLayers(),this.light=new Wi(this.stylesheet.light),this._setProjectionInternal(((T=this.stylesheet.projection)===null||T===void 0?void 0:T.type)||"mercator"),this.sky=new Gt(this.stylesheet.sky),this.map.setTerrain((I=this.stylesheet.terrain)!==null&&I!==void 0?I:null),this.fire(new l.l("data",{dataType:"style"})),this.fire(new l.l("style.load"))}}_createLayers(){var s,g,x;const T=l.bS(this.stylesheet.layers);this.setGlobalState((s=this.stylesheet.state)!==null&&s!==void 0?s:null),this.dispatcher.broadcast("SL",T),this._order=T.map((I=>I.id)),this._layers={},this._serializedLayers=null;for(const I of T){const O=l.bT(I,this._globalState);if(O.setEventedParent(this,{layer:{id:I.id}}),this._layers[I.id]=O,l.bU(O)&&this.tileManagers[O.source]){const z=(x=(g=I.paint)===null||g===void 0?void 0:g["raster-fade-duration"])!==null&&x!==void 0?x:O.paint.get("raster-fade-duration");this.tileManagers[O.source].setRasterFadeDuration(z)}}}_loadSprite(s,g=!1,x=void 0){this.imageManager.setLoaded(!1);const T=new AbortController;let I;this._spriteRequest=T,(function(O,z,G,q){return l._(this,void 0,void 0,(function*(){const J=Xt(O),re=G>1?"@2x":"",ie={},ce={};for(const{id:_e,url:Me}of J){const Pe=z.transformRequest(hi(Me,re,".json"),"SpriteJSON");ie[_e]=l.j(Pe,q);const Ce=z.transformRequest(hi(Me,re,".png"),"SpriteImage");ce[_e]=kt.getImage(Ce,q)}return yield Promise.all([...Object.values(ie),...Object.values(ce)]),(function(_e,Me){return l._(this,void 0,void 0,(function*(){const Pe={};for(const Ce in _e){Pe[Ce]={};const Oe=se.getImageCanvasContext((yield Me[Ce]).data),We=(yield _e[Ce]).data;for(const ke in We){const{width:Ge,height:Xe,x:Ue,y:et,sdf:At,pixelRatio:pt,stretchX:bt,stretchY:_t,content:ti,textFitWidth:ii,textFitHeight:Wt}=We[ke];Pe[Ce][ke]={data:null,pixelRatio:pt,sdf:At,stretchX:bt,stretchY:_t,content:ti,textFitWidth:ii,textFitHeight:Wt,spriteData:{width:Ge,height:Xe,x:Ue,y:et,context:Oe}}}}return Pe}))})(ie,ce)}))})(s,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((O=>{if(this._spriteRequest=null,O)for(const z in O){this._spritesImagesIds[z]=[];const G=this._spritesImagesIds[z]?this._spritesImagesIds[z].filter((q=>!(q in O))):[];for(const q of G)this.imageManager.removeImage(q),this._changedImages[q]=!0;for(const q in O[z]){const J=z==="default"?q:`${z}:${q}`;this._spritesImagesIds[z].push(J),J in this.imageManager.images?this.imageManager.updateImage(J,O[z][q],!1):this.imageManager.addImage(J,O[z][q]),g&&(this._changedImages[J]=!0)}}})).catch((O=>{this._spriteRequest=null,I=O,T.signal.aborted||this.fire(new l.k(I))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),g&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.l("data",{dataType:"style"})),x&&x(I)}))}_unloadSprite(){for(const s of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(s),this._changedImages[s]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.l("data",{dataType:"style"}))}_validateLayer(s){const g=this.tileManagers[s.source];if(!g)return;const x=s.sourceLayer;if(!x)return;const T=g.getSource();(T.type==="geojson"||T.vectorLayerIds&&T.vectorLayerIds.indexOf(x)===-1)&&this.fire(new l.k(new Error(`Source layer "${x}" does not exist on source "${T.id}" as specified by style layer "${s.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const s in this.tileManagers)if(!this.tileManagers[s].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(s,g=!1){const x=this._serializedAllLayers();if(!s||s.length===0)return Object.values(g?l.bV(x):x);const T=[];for(const I of s)if(x[I]){const O=g?l.bV(x[I]):x[I];T.push(O)}return T}_serializedAllLayers(){let s=this._serializedLayers;if(s)return s;s=this._serializedLayers={};const g=Object.keys(this._layers);for(const x of g){const T=this._layers[x];T.type!=="custom"&&(s[x]=T.serialize())}return s}hasTransitions(){var s,g,x;if(!((s=this.light)===null||s===void 0)&&s.hasTransition()||!((g=this.sky)===null||g===void 0)&&g.hasTransition()||!((x=this.projection)===null||x===void 0)&&x.hasTransition())return!0;for(const T in this.tileManagers)if(this.tileManagers[T].hasTransition())return!0;for(const T in this._layers)if(this._layers[T].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(s){if(!this._loaded)return;const g=this._changed;if(g){const T=Object.keys(this._updatedLayers),I=Object.keys(this._removedLayers);(T.length||I.length)&&this._updateWorkerLayers(T,I);for(const O in this._updatedSources){const z=this._updatedSources[O];if(z==="reload")this._reloadSource(O);else{if(z!=="clear")throw new Error(`Invalid action ${z}`);this._clearSource(O)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const O in this._updatedPaintProps)this._layers[O].updateTransitions(s);this.light.updateTransitions(s),this.sky.updateTransitions(s),this._resetUpdates()}const x={};for(const T in this.tileManagers){const I=this.tileManagers[T];x[T]=I.used,I.used=!1}for(const T of this._order){const I=this._layers[T];I.recalculate(s,this._availableImages),!I.isHidden(s.zoom)&&I.source&&(this.tileManagers[I.source].used=!0)}for(const T in x){const I=this.tileManagers[T];!!x[T]!=!!I.used&&I.fire(new l.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:T}))}this.light.recalculate(s),this.sky.recalculate(s),this.projection.recalculate(s),this.z=s.zoom,g&&this.fire(new l.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const s=Object.keys(this._changedImages);if(s.length){for(const g in this.tileManagers)this.tileManagers[g].reloadTilesForDependencies(["icons","patterns"],s);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const s in this.tileManagers)this.tileManagers[s].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(s,g){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(s,!1),removedIds:g})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(s,g={}){var x;this._checkLoaded();const T=this.serialize();if(s=g.transformStyle?g.transformStyle(T,s):s,((x=g.validate)===null||x===void 0||x)&&si(this,l.C(s)))return!1;(s=l.bV(s)).layers=l.bS(s.layers);const I=l.bW(T,s),O=this._getOperationsToPerform(I);if(O.unimplemented.length>0)throw new Error(`Unimplemented: ${O.unimplemented.join(", ")}.`);if(O.operations.length===0)return!1;for(const z of O.operations)z();return this.stylesheet=s,this._serializedLayers=null,this.fire(new l.l("style.load",{style:this})),!0}_getOperationsToPerform(s){const g=[],x=[];for(const T of s)switch(T.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":g.push((()=>this.addLayer.apply(this,T.args)));break;case"removeLayer":g.push((()=>this.removeLayer.apply(this,T.args)));break;case"setPaintProperty":g.push((()=>this.setPaintProperty.apply(this,T.args)));break;case"setLayoutProperty":g.push((()=>this.setLayoutProperty.apply(this,T.args)));break;case"setFilter":g.push((()=>this.setFilter.apply(this,T.args)));break;case"addSource":g.push((()=>this.addSource.apply(this,T.args)));break;case"removeSource":g.push((()=>this.removeSource.apply(this,T.args)));break;case"setLayerZoomRange":g.push((()=>this.setLayerZoomRange.apply(this,T.args)));break;case"setLight":g.push((()=>this.setLight.apply(this,T.args)));break;case"setGeoJSONSourceData":g.push((()=>this.setGeoJSONSourceData.apply(this,T.args)));break;case"setGlyphs":g.push((()=>this.setGlyphs.apply(this,T.args)));break;case"setSprite":g.push((()=>this.setSprite.apply(this,T.args)));break;case"setTerrain":g.push((()=>this.map.setTerrain.apply(this,T.args)));break;case"setSky":g.push((()=>this.setSky.apply(this,T.args)));break;case"setProjection":this.setProjection.apply(this,T.args);break;case"setGlobalState":g.push((()=>this.setGlobalState.apply(this,T.args)));break;case"setTransition":g.push((()=>{}));break;default:x.push(T.command)}return{operations:g,unimplemented:x}}addImage(s,g){if(this.getImage(s))return this.fire(new l.k(new Error(`An image named "${s}" already exists.`)));this.imageManager.addImage(s,g),this._afterImageUpdated(s)}updateImage(s,g){this.imageManager.updateImage(s,g)}getImage(s){return this.imageManager.getImage(s)}removeImage(s){if(!this.getImage(s))return this.fire(new l.k(new Error(`An image named "${s}" does not exist.`)));this.imageManager.removeImage(s),this._afterImageUpdated(s)}_afterImageUpdated(s){this._availableImages=this.imageManager.listImages(),this._changedImages[s]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(s,g,x={}){if(this._checkLoaded(),this.tileManagers[s]!==void 0)throw new Error(`Source "${s}" already exists.`);if(!g.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(g).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(g.type)>=0&&this._validate(l.C.source,`sources.${s}`,g,null,x))return;this.map&&this.map._collectResourceTiming&&(g.collectResourceTiming=!0);const T=this.tileManagers[s]=new vn(s,g,this.dispatcher);T.style=this,T.setEventedParent(this,(()=>({isSourceLoaded:T.loaded(),source:T.serialize(),sourceId:s}))),T.onAdd(this.map),this._changed=!0}removeSource(s){if(this._checkLoaded(),this.tileManagers[s]===void 0)throw new Error("There is no source with this ID");for(const x in this._layers)if(this._layers[x].source===s)return this.fire(new l.k(new Error(`Source "${s}" cannot be removed while layer "${x}" is using it.`)));const g=this.tileManagers[s];delete this.tileManagers[s],delete this._updatedSources[s],g.fire(new l.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:s})),g.setEventedParent(null),g.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(s,g){if(this._checkLoaded(),this.tileManagers[s]===void 0)throw new Error(`There is no source with this ID=${s}`);const x=this.tileManagers[s].getSource();if(x.type!=="geojson")throw new Error(`geojsonSource.type is ${x.type}, which is !== 'geojson`);x.setData(g),this._changed=!0}getSource(s){return this.tileManagers[s]&&this.tileManagers[s].getSource()}addLayer(s,g,x={}){this._checkLoaded();const T=s.id;if(this.getLayer(T))return void this.fire(new l.k(new Error(`Layer "${T}" already exists on this map.`)));let I;if(s.type==="custom"){if(si(this,l.bX(s)))return;I=l.bT(s,this._globalState)}else{if("source"in s&&typeof s.source=="object"&&(this.addSource(T,s.source),s=l.bV(s),s=l.e(s,{source:T})),this._validate(l.C.layer,`layers.${T}`,s,{arrayIndex:-1},x))return;I=l.bT(s,this._globalState),this._validateLayer(I),I.setEventedParent(this,{layer:{id:T}})}const O=g?this._order.indexOf(g):this._order.length;if(g&&O===-1)this.fire(new l.k(new Error(`Cannot add layer "${T}" before non-existing layer "${g}".`)));else{if(this._order.splice(O,0,T),this._layerOrderChanged=!0,this._layers[T]=I,this._removedLayers[T]&&I.source&&I.type!=="custom"){const z=this._removedLayers[T];delete this._removedLayers[T],z.type!==I.type?this._updatedSources[I.source]="clear":(this._updatedSources[I.source]="reload",this.tileManagers[I.source].pause())}this._updateLayer(I),I.onAdd&&I.onAdd(this.map)}}moveLayer(s,g){if(this._checkLoaded(),this._changed=!0,!this._layers[s])return void this.fire(new l.k(new Error(`The layer '${s}' does not exist in the map's style and cannot be moved.`)));if(s===g)return;const x=this._order.indexOf(s);this._order.splice(x,1);const T=g?this._order.indexOf(g):this._order.length;g&&T===-1?this.fire(new l.k(new Error(`Cannot move layer "${s}" before non-existing layer "${g}".`))):(this._order.splice(T,0,s),this._layerOrderChanged=!0)}removeLayer(s){this._checkLoaded();const g=this._layers[s];if(!g)return void this.fire(new l.k(new Error(`Cannot remove non-existing layer "${s}".`)));g.setEventedParent(null);const x=this._order.indexOf(s);this._order.splice(x,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[s]=g,delete this._layers[s],this._serializedLayers&&delete this._serializedLayers[s],delete this._updatedLayers[s],delete this._updatedPaintProps[s],g.onRemove&&g.onRemove(this.map)}getLayer(s){return this._layers[s]}getLayersOrder(){return[...this._order]}hasLayer(s){return s in this._layers}setLayerZoomRange(s,g,x){this._checkLoaded();const T=this.getLayer(s);T?T.minzoom===g&&T.maxzoom===x||(g!=null&&(T.minzoom=g),x!=null&&(T.maxzoom=x),this._updateLayer(T)):this.fire(new l.k(new Error(`Cannot set the zoom range of non-existing layer "${s}".`)))}setFilter(s,g,x={}){this._checkLoaded();const T=this.getLayer(s);if(T){if(!l.bR(T.filter,g))return g==null?(T.setFilter(void 0),void this._updateLayer(T)):void(this._validate(l.C.filter,`layers.${T.id}.filter`,g,null,x)||(T.setFilter(l.bV(g)),this._updateLayer(T)))}else this.fire(new l.k(new Error(`Cannot filter non-existing layer "${s}".`)))}getFilter(s){return l.bV(this.getLayer(s).filter)}setLayoutProperty(s,g,x,T={}){this._checkLoaded();const I=this.getLayer(s);I?l.bR(I.getLayoutProperty(g),x)||(I.setLayoutProperty(g,x,T),this._updateLayer(I)):this.fire(new l.k(new Error(`Cannot style non-existing layer "${s}".`)))}getLayoutProperty(s,g){const x=this.getLayer(s);if(x)return x.getLayoutProperty(g);this.fire(new l.k(new Error(`Cannot get style of non-existing layer "${s}".`)))}setPaintProperty(s,g,x,T={}){this._checkLoaded();const I=this.getLayer(s);I?l.bR(I.getPaintProperty(g),x)||this._updatePaintProperty(I,g,x,T):this.fire(new l.k(new Error(`Cannot style non-existing layer "${s}".`)))}_updatePaintProperty(s,g,x,T={}){s.setPaintProperty(g,x,T)&&this._updateLayer(s),l.bU(s)&&g==="raster-fade-duration"&&this.tileManagers[s.source].setRasterFadeDuration(x),this._changed=!0,this._updatedPaintProps[s.id]=!0,this._serializedLayers=null}getPaintProperty(s,g){return this.getLayer(s).getPaintProperty(g)}setFeatureState(s,g){this._checkLoaded();const x=s.source,T=s.sourceLayer,I=this.tileManagers[x];if(I===void 0)return void this.fire(new l.k(new Error(`The source '${x}' does not exist in the map's style.`)));const O=I.getSource().type;O==="geojson"&&T?this.fire(new l.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):O!=="vector"||T?(s.id===void 0&&this.fire(new l.k(new Error("The feature id parameter must be provided."))),I.setFeatureState(T,s.id,g)):this.fire(new l.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(s,g){this._checkLoaded();const x=s.source,T=this.tileManagers[x];if(T===void 0)return void this.fire(new l.k(new Error(`The source '${x}' does not exist in the map's style.`)));const I=T.getSource().type,O=I==="vector"?s.sourceLayer:void 0;I!=="vector"||O?g&&typeof s.id!="string"&&typeof s.id!="number"?this.fire(new l.k(new Error("A feature id is required to remove its specific state property."))):T.removeFeatureState(O,s.id,g):this.fire(new l.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(s){this._checkLoaded();const g=s.source,x=s.sourceLayer,T=this.tileManagers[g];if(T!==void 0)return T.getSource().type!=="vector"||x?(s.id===void 0&&this.fire(new l.k(new Error("The feature id parameter must be provided."))),T.getFeatureState(x,s.id)):void this.fire(new l.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new l.k(new Error(`The source '${g}' does not exist in the map's style.`)))}getTransition(){return l.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const s=l.bY(this.tileManagers,(I=>I.serialize())),g=this._serializeByIds(this._order,!0),x=this.map.getTerrain()||void 0,T=this.stylesheet;return l.bZ({version:T.version,name:T.name,metadata:T.metadata,light:T.light,sky:T.sky,center:T.center,zoom:T.zoom,bearing:T.bearing,pitch:T.pitch,sprite:T.sprite,glyphs:T.glyphs,transition:T.transition,projection:T.projection,sources:s,layers:g,terrain:x},(I=>I!==void 0))}_updateLayer(s){this._updatedLayers[s.id]=!0,s.source&&!this._updatedSources[s.source]&&this.tileManagers[s.source].getSource().type!=="raster"&&(this._updatedSources[s.source]="reload",this.tileManagers[s.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(s){const g=O=>this._layers[O].type==="fill-extrusion",x={},T=[];for(let O=this._order.length-1;O>=0;O--){const z=this._order[O];if(g(z)){x[z]=O;for(const G of s){const q=G[z];if(q)for(const J of q)T.push(J)}}}T.sort(((O,z)=>z.intersectionZ-O.intersectionZ));const I=[];for(let O=this._order.length-1;O>=0;O--){const z=this._order[O];if(g(z))for(let G=T.length-1;G>=0;G--){const q=T[G].feature;if(x[q.layer.id]<O)break;I.push(q),T.pop()}else for(const G of s){const q=G[z];if(q)for(const J of q)I.push(J.feature)}}return I}queryRenderedFeatures(s,g,x){g&&g.filter&&this._validate(l.C.filter,"queryRenderedFeatures.filter",g.filter,null,g);const T={};if(g&&g.layers){if(!(Array.isArray(g.layers)||g.layers instanceof Set))return this.fire(new l.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const q of g.layers){const J=this._layers[q];if(!J)return this.fire(new l.k(new Error(`The layer '${q}' does not exist in the map's style and cannot be queried for features.`))),[];T[J.source]=!0}}const I=[];g.availableImages=this._availableImages;const O=this._serializedAllLayers(),z=g.layers instanceof Set?g.layers:Array.isArray(g.layers)?new Set(g.layers):null,G=Object.assign(Object.assign({},g),{layers:z,globalState:this._globalState});for(const q in this.tileManagers)g.layers&&!T[q]||I.push(uh(this.tileManagers[q],this._layers,O,s,G,x,this.map.terrain?(J,re,ie)=>this.map.terrain.getElevation(J,re,ie):void 0));return this.placement&&I.push((function(q,J,re,ie,ce,_e,Me){const Pe={},Ce=_e.queryRenderedSymbols(ie),Oe=[];for(const We of Object.keys(Ce).map(Number))Oe.push(Me[We]);Oe.sort(br);for(const We of Oe){const ke=We.featureIndex.lookupSymbolFeatures(Ce[We.bucketInstanceId],J,We.bucketIndex,We.sourceLayerIndex,{filterSpec:ce.filter,globalState:ce.globalState},ce.layers,ce.availableImages,q);for(const Ge in ke){const Xe=Pe[Ge]=Pe[Ge]||[],Ue=ke[Ge];Ue.sort(((et,At)=>{const pt=We.featureSortOrder;if(pt){const bt=pt.indexOf(et.featureIndex);return pt.indexOf(At.featureIndex)-bt}return At.featureIndex-et.featureIndex}));for(const et of Ue)Xe.push(et)}}return(function(We,ke,Ge){for(const Xe in We)for(const Ue of We[Xe])Fa(Ue,Ge[ke[Xe].source]);return We})(Pe,q,re)})(this._layers,O,this.tileManagers,s,G,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(I)}querySourceFeatures(s,g){g!=null&&g.filter&&this._validate(l.C.filter,"querySourceFeatures.filter",g.filter,null,g);const x=this.tileManagers[s];return x?(function(T,I){const O=T.getRenderableIds().map((q=>T.getTileByID(q))),z=[],G={};for(let q=0;q<O.length;q++){const J=O[q],re=J.tileID.canonical.key;G[re]||(G[re]=!0,J.querySourceFeatures(z,I))}return z})(x,g?Object.assign(Object.assign({},g),{globalState:this._globalState}):{globalState:this._globalState}):[]}getLight(){return this.light.getLight()}setLight(s,g={}){this._checkLoaded();const x=this.light.getLight();let T=!1;for(const O in s)if(!l.bR(s[O],x[O])){T=!0;break}if(!T)return;const I={now:Ae(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(s,g),this.light.updateTransitions(I)}getProjection(){var s;return(s=this.stylesheet)===null||s===void 0?void 0:s.projection}setProjection(s){if(this._checkLoaded(),this.projection){if(this.projection.name===s.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=s,this._setProjectionInternal(s.type)}getSky(){var s;return(s=this.stylesheet)===null||s===void 0?void 0:s.sky}setSky(s,g={}){this._checkLoaded();const x=this.getSky();let T=!1;if(!s&&!x)return;if(s&&!x)T=!0;else if(!s&&x)T=!0;else for(const O in s)if(!l.bR(s[O],x[O])){T=!0;break}if(!T)return;const I={now:Ae(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=s,this.sky.setSky(s,g),this.sky.updateTransitions(I)}_setProjectionInternal(s){const g=(function(x,T){const I={constrainOverride:T};if(Array.isArray(x)){const O=new h0({type:x});return{projection:O,transform:new Re(I),cameraHelper:new ci(O)}}switch(x){case"mercator":return{projection:new Is,transform:new bs(I),cameraHelper:new _u};case"globe":{const O=new h0({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:O,transform:new Re(I),cameraHelper:new ci(O)}}case"vertical-perspective":return{projection:new xn,transform:new c(I),cameraHelper:new Ft};default:return l.w(`Unknown projection name: ${x}. Falling back to mercator projection.`),{projection:new Is,transform:new bs(I),cameraHelper:new _u}}})(s,this.map.transformConstrain);this.projection=g.projection,this.map.migrateProjection(g.transform,g.cameraHelper);for(const x in this.tileManagers)this.tileManagers[x].reload()}_validate(s,g,x,T,I={}){return(!I||I.validate!==!1)&&si(this,s.call(l.C,l.e({key:g,style:this.serialize(),value:x,styleSpec:l.u},T)))}_remove(s=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),ve().off(it,this._rtlPluginLoaded);for(const g in this._layers)this._layers[g].setEventedParent(null);for(const g in this.tileManagers){const x=this.tileManagers[g];x.setEventedParent(null),x.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),s&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(s)}_clearSource(s){this.tileManagers[s].clearTiles()}_reloadSource(s){this.tileManagers[s].resume(),this.tileManagers[s].reload()}_updateSources(s){for(const g in this.tileManagers)this.tileManagers[g].update(s,this.map.terrain)}_generateCollisionBoxes(){for(const s in this.tileManagers)this._reloadSource(s)}_updatePlacement(s,g,x,T,I=!1){let O=!1,z=!1;const G={};for(const q of this._order){const J=this._layers[q];if(J.type!=="symbol")continue;if(!G[J.source]){const ie=this.tileManagers[J.source];G[J.source]=ie.getRenderableIds(!0).map((ce=>ie.getTileByID(ce))).sort(((ce,_e)=>_e.tileID.overscaledZ-ce.tileID.overscaledZ||(ce.tileID.isLessThan(_e.tileID)?-1:1)))}const re=this.crossTileSymbolIndex.addLayer(J,G[J.source],s.center.lng);O=O||re}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((I=I||this._layerOrderChanged||x===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(Ae(),s.zoom))&&(this.pauseablePlacement=new ph(s,this.map.terrain,this._order,I,g,x,T,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,G),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(Ae()),z=!0),O&&this.pauseablePlacement.placement.setStale()),z||O)for(const q of this._order){const J=this._layers[q];J.type==="symbol"&&this.placement.updateLayerOpacities(J,G[J.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(Ae())}_releaseSymbolFadeTiles(){for(const s in this.tileManagers)this.tileManagers[s].releaseSymbolFadeTiles()}getImages(s,g){return l._(this,void 0,void 0,(function*(){const x=yield this.imageManager.getImages(g.icons);this._updateTilesForChangedImages();const T=this.tileManagers[g.source];return T&&T.setDependencies(g.tileID.key,g.type,g.icons),x}))}getGlyphs(s,g){return l._(this,void 0,void 0,(function*(){const x=yield this.glyphManager.getGlyphs(g.stacks),T=this.tileManagers[g.source];return T&&T.setDependencies(g.tileID.key,g.type,[""]),x}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(s,g={}){this._checkLoaded(),s&&this._validate(l.C.glyphs,"glyphs",s,null,g)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=s,this.glyphManager.entries={},this.glyphManager.setURL(s))}getDashes(s,g){return l._(this,void 0,void 0,(function*(){const x={};for(const[T,I]of Object.entries(g.dashes))x[T]=this.lineAtlas.getDash(I.dasharray,I.round);return x}))}addSprite(s,g,x={},T){this._checkLoaded();const I=[{id:s,url:g}],O=[...Xt(this.stylesheet.sprite),...I];this._validate(l.C.sprite,"sprite",O,null,x)||(this.stylesheet.sprite=O,this._loadSprite(I,!0,T))}removeSprite(s){this._checkLoaded();const g=Xt(this.stylesheet.sprite);if(g.find((x=>x.id===s))){if(this._spritesImagesIds[s])for(const x of this._spritesImagesIds[s])this.imageManager.removeImage(x),this._changedImages[x]=!0;g.splice(g.findIndex((x=>x.id===s)),1),this.stylesheet.sprite=g.length>0?g:void 0,delete this._spritesImagesIds[s],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.l("data",{dataType:"style"}))}else this.fire(new l.k(new Error(`Sprite "${s}" doesn't exists on this map.`)))}getSprite(){return Xt(this.stylesheet.sprite)}setSprite(s,g={},x){this._checkLoaded(),s&&this._validate(l.C.sprite,"sprite",s,null,g)||(this.stylesheet.sprite=s,s?this._loadSprite(s,!0,x):(this._unloadSprite(),x&&x(null)))}destroy(){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null);for(const s in this.tileManagers){const g=this.tileManagers[s];g.setEventedParent(null),g.onRemove(this.map)}this.tileManagers={},this.imageManager&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this._availableImages=[],this._spritesImagesIds={}),this.glyphManager&&this.glyphManager.destroy();for(const s in this._layers){const g=this._layers[s];g.setEventedParent(null),g.onRemove&&g.onRemove(this.map)}this._setInitialValues(),this.setEventedParent(null),this.dispatcher.unregisterMessageHandler("GG"),this.dispatcher.unregisterMessageHandler("GI"),this.dispatcher.unregisterMessageHandler("GDA"),this.dispatcher.remove(!0),this._listeners={},this._oneTimeListeners={}}}var or=l.aU([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class ur{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(s,g,x,T,I,O,z,G,q){this.context=s;let J=this.boundPaintVertexBuffers.length!==T.length;for(let re=0;!J&&re<T.length;re++)this.boundPaintVertexBuffers[re]!==T[re]&&(J=!0);!this.vao||this.boundProgram!==g||this.boundLayoutVertexBuffer!==x||J||this.boundIndexBuffer!==I||this.boundVertexOffset!==O||this.boundDynamicVertexBuffer!==z||this.boundDynamicVertexBuffer2!==G||this.boundDynamicVertexBuffer3!==q?this.freshBind(g,x,T,I,O,z,G,q):(s.bindVertexArray.set(this.vao),z&&z.bind(),I&&I.dynamicDraw&&I.bind(),G&&G.bind(),q&&q.bind())}freshBind(s,g,x,T,I,O,z,G){const q=s.numAttributes,J=this.context,re=J.gl;this.vao&&this.destroy(),this.vao=J.createVertexArray(),J.bindVertexArray.set(this.vao),this.boundProgram=s,this.boundLayoutVertexBuffer=g,this.boundPaintVertexBuffers=x,this.boundIndexBuffer=T,this.boundVertexOffset=I,this.boundDynamicVertexBuffer=O,this.boundDynamicVertexBuffer2=z,this.boundDynamicVertexBuffer3=G,g.enableAttributes(re,s);for(const ie of x)ie.enableAttributes(re,s);O&&O.enableAttributes(re,s),z&&z.enableAttributes(re,s),G&&G.enableAttributes(re,s),g.bind(),g.setVertexAttribPointers(re,s,I);for(const ie of x)ie.bind(),ie.setVertexAttribPointers(re,s,I);O&&(O.bind(),O.setVertexAttribPointers(re,s,I)),T&&T.bind(),z&&(z.bind(),z.setVertexAttribPointers(re,s,I)),G&&(G.bind(),G.setVertexAttribPointers(re,s,I)),J.currentNumAttributes=q}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Us=(C,s,g,x,T)=>({u_texture:0,u_ele_delta:C,u_fog_matrix:s,u_fog_color:g?g.properties.get("fog-color"):l.bp.white,u_fog_ground_blend:g?g.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:T?0:g?g.calculateFogBlendOpacity(x):0,u_horizon_color:g?g.properties.get("horizon-color"):l.bp.white,u_horizon_fog_blend:g?g.properties.get("horizon-fog-blend"):1,u_is_globe_mode:T?1:0}),Or={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function La(C){const s=[];for(let g=0;g<C.length;g++){if(C[g]===null)continue;const x=C[g].split(" ");s.push(x.pop())}return s}class jc{constructor(s,g,x,T,I,O,z,G,q=[]){const J=s.gl;this.program=J.createProgram();const re=La(g.staticAttributes),ie=x?x.getBinderAttributes():[],ce=re.concat(ie),_e=wr.prelude.staticUniforms?La(wr.prelude.staticUniforms):[],Me=z.staticUniforms?La(z.staticUniforms):[],Pe=g.staticUniforms?La(g.staticUniforms):[],Ce=x?x.getBinderUniforms():[],Oe=_e.concat(Me).concat(Pe).concat(Ce),We=[];for(const pt of Oe)We.indexOf(pt)<0&&We.push(pt);const ke=x?x.defines():[];Oo(J)&&ke.unshift("#version 300 es"),I&&ke.push("#define OVERDRAW_INSPECTOR;"),O&&ke.push("#define TERRAIN3D;"),G&&ke.push(G),q&&ke.push(...q);let Ge=ke.concat(wr.prelude.fragmentSource,z.fragmentSource,g.fragmentSource).join(`
`),Xe=ke.concat(wr.prelude.vertexSource,z.vertexSource,g.vertexSource).join(`
`);Oo(J)||(Ge=(function(pt){return pt.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")})(Ge),Xe=(function(pt){return pt.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")})(Xe));const Ue=J.createShader(J.FRAGMENT_SHADER);if(J.isContextLost())return void(this.failedToCreate=!0);if(J.shaderSource(Ue,Ge),J.compileShader(Ue),!J.getShaderParameter(Ue,J.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${J.getShaderInfoLog(Ue)}`);J.attachShader(this.program,Ue);const et=J.createShader(J.VERTEX_SHADER);if(J.isContextLost())return void(this.failedToCreate=!0);if(J.shaderSource(et,Xe),J.compileShader(et),!J.getShaderParameter(et,J.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${J.getShaderInfoLog(et)}`);J.attachShader(this.program,et),this.attributes={};const At={};this.numAttributes=ce.length;for(let pt=0;pt<this.numAttributes;pt++)ce[pt]&&(J.bindAttribLocation(this.program,pt,ce[pt]),this.attributes[ce[pt]]=pt);if(J.linkProgram(this.program),!J.getProgramParameter(this.program,J.LINK_STATUS))throw new Error(`Program failed to link: ${J.getProgramInfoLog(this.program)}`);J.deleteShader(et),J.deleteShader(Ue);for(let pt=0;pt<We.length;pt++){const bt=We[pt];if(bt&&!At[bt]){const _t=J.getUniformLocation(this.program,bt);_t&&(At[bt]=_t)}}this.fixedUniforms=T(s,At),this.terrainUniforms=((pt,bt)=>({u_depth:new l.b_(pt,bt.u_depth),u_terrain:new l.b_(pt,bt.u_terrain),u_terrain_dim:new l.bq(pt,bt.u_terrain_dim),u_terrain_matrix:new l.c0(pt,bt.u_terrain_matrix),u_terrain_unpack:new l.c1(pt,bt.u_terrain_unpack),u_terrain_exaggeration:new l.bq(pt,bt.u_terrain_exaggeration)}))(s,At),this.projectionUniforms=((pt,bt)=>({u_projection_matrix:new l.c0(pt,bt.u_projection_matrix),u_projection_tile_mercator_coords:new l.c1(pt,bt.u_projection_tile_mercator_coords),u_projection_clipping_plane:new l.c1(pt,bt.u_projection_clipping_plane),u_projection_transition:new l.bq(pt,bt.u_projection_transition),u_projection_fallback_matrix:new l.c0(pt,bt.u_projection_fallback_matrix)}))(s,At),this.binderUniforms=x?x.getUniforms(s,At):[]}draw(s,g,x,T,I,O,z,G,q,J,re,ie,ce,_e,Me,Pe,Ce,Oe,We){const ke=s.gl;if(this.failedToCreate)return;if(s.program.set(this.program),s.setDepthMode(x),s.setStencilMode(T),s.setColorMode(I),s.setCullFace(O),G){s.activeTexture.set(ke.TEXTURE2),ke.bindTexture(ke.TEXTURE_2D,G.depthTexture),s.activeTexture.set(ke.TEXTURE3),ke.bindTexture(ke.TEXTURE_2D,G.texture);for(const Xe in this.terrainUniforms)this.terrainUniforms[Xe].set(G[Xe])}if(q)for(const Xe in q)this.projectionUniforms[Or[Xe]].set(q[Xe]);if(z)for(const Xe in this.fixedUniforms)this.fixedUniforms[Xe].set(z[Xe]);Pe&&Pe.setUniforms(s,this.binderUniforms,_e,{zoom:Me});let Ge=0;switch(g){case ke.LINES:Ge=2;break;case ke.TRIANGLES:Ge=3;break;case ke.LINE_STRIP:Ge=1}for(const Xe of ce.get()){const Ue=Xe.vaos||(Xe.vaos={});(Ue[J]||(Ue[J]=new ur)).bind(s,this,re,Pe?Pe.getPaintVertexBuffers():[],ie,Xe.vertexOffset,Ce,Oe,We),ke.drawElements(g,Xe.primitiveLength*Ge,ke.UNSIGNED_SHORT,Xe.primitiveOffset*Ge*2)}}}function yf(C,s,g){const x=1/l.aN(g,1,s.transform.tileZoom),T=Math.pow(2,g.tileID.overscaledZ),I=g.tileSize*Math.pow(2,s.transform.tileZoom)/T,O=I*(g.tileID.canonical.x+g.tileID.wrap*T),z=I*g.tileID.canonical.y;return{u_image:0,u_texsize:g.imageAtlasTexture.size,u_scale:[x,C.fromScale,C.toScale],u_fade:C.t,u_pixel_coord_upper:[O>>16,z>>16],u_pixel_coord_lower:[65535&O,65535&z]}}const pn=(C,s,g,x)=>{const T=C.style.light,I=T.properties.get("position"),O=[I.x,I.y,I.z],z=l.c4();T.properties.get("anchor")==="viewport"&&l.c5(z,C.transform.bearingInRadians),l.c6(O,O,z);const G=C.transform.transformLightDirection(O),q=T.properties.get("color");return{u_lightpos:O,u_lightpos_globe:G,u_lightintensity:T.properties.get("intensity"),u_lightcolor:[q.r,q.g,q.b],u_vertical_gradient:+s,u_opacity:g,u_fill_translate:x}},No=(C,s,g,x,T,I,O)=>l.e(pn(C,s,g,x),yf(I,C,O),{u_height_factor:-Math.pow(2,T.overscaledZ)/O.tileSize/8}),ds=(C,s,g,x)=>l.e(yf(s,C,g),{u_fill_translate:x}),Ln=(C,s)=>({u_world:C,u_fill_translate:s}),Dn=(C,s,g,x,T)=>l.e(ds(C,s,g,T),{u_world:x}),Zn=(C,s,g,x,T)=>{const I=C.transform;let O,z,G=0;if(g.paint.get("circle-pitch-alignment")==="map"){const q=l.aN(s,1,I.zoom);O=!0,z=[q,q],G=q/(l.a5*Math.pow(2,s.tileID.overscaledZ))*2*Math.PI*T}else O=!1,z=I.pixelsToGLUnits;return{u_camera_to_center_distance:I.cameraToCenterDistance,u_scale_with_map:+(g.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+O,u_device_pixel_ratio:C.pixelRatio,u_extrude_scale:z,u_globe_extrude_scale:G,u_translate:x}},Gc=C=>({u_pixel_extrude_scale:[1/C.width,1/C.height]}),ir=C=>({u_viewport_size:[C.width,C.height]}),vf=(C,s=1)=>({u_color:C,u_overlay:0,u_overlay_scale:s}),Au=(C,s,g,x)=>{const T=l.aN(C,1,s)/(l.a5*Math.pow(2,C.tileID.overscaledZ))*2*Math.PI*x;return{u_extrude_scale:l.aN(C,1,s),u_intensity:g,u_globe_extrude_scale:T}},zp=(C,s,g,x)=>{const T=l.N();l.c7(T,0,C.width,C.height,0,0,1);const I=C.context.gl;return{u_matrix:T,u_world:[I.drawingBufferWidth,I.drawingBufferHeight],u_image:g,u_color_ramp:x,u_opacity:s.paint.get("heatmap-opacity")}},sd=(C,s,g)=>{const x=g.paint.get("hillshade-accent-color");let T;switch(g.paint.get("hillshade-method")){case"basic":T=4;break;case"combined":T=1;break;case"igor":T=2;break;case"multidirectional":T=3;break;default:T=0}const I=g.getIlluminationProperties();for(let O=0;O<I.directionRadians.length;O++)g.paint.get("hillshade-illumination-anchor")==="viewport"&&(I.directionRadians[O]+=C.transform.bearingInRadians);return{u_image:0,u_latrange:Up(0,s.tileID),u_exaggeration:g.paint.get("hillshade-exaggeration"),u_altitudes:I.altitudeRadians,u_azimuths:I.directionRadians,u_accent:x,u_method:T,u_highlights:I.highlightColor,u_shadows:I.shadowColor}},Lp=(C,s)=>{const g=s.stride,x=l.N();return l.c7(x,0,l.a5,-l.a5,0,0,1),l.O(x,x,[0,-l.a5,0]),{u_matrix:x,u_image:1,u_dimension:[g,g],u_zoom:C.overscaledZ,u_unpack:s.getUnpackVector()}};function Up(C,s){const g=Math.pow(2,s.canonical.z),x=s.canonical.y;return[new l.a9(0,x/g).toLngLat().lat,new l.a9(0,(x+1)/g).toLngLat().lat]}const p0=(C,s,g=0)=>({u_image:0,u_unpack:s.getUnpackVector(),u_dimension:[s.stride,s.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:g,u_opacity:C.paint.get("color-relief-opacity")}),Sl=(C,s,g,x)=>{const T=C.transform;return{u_translation:wu(C,s,g),u_ratio:x/l.aN(s,1,T.zoom),u_device_pixel_ratio:C.pixelRatio,u_units_to_pixels:[1/T.pixelsToGLUnits[0],1/T.pixelsToGLUnits[1]]}},Vp=(C,s,g,x,T)=>l.e(Sl(C,s,g,x),{u_image:0,u_image_height:T}),ad=(C,s,g,x,T)=>{const I=C.transform,O=co(s,I);return{u_translation:wu(C,s,g),u_texsize:s.imageAtlasTexture.size,u_ratio:x/l.aN(s,1,I.zoom),u_device_pixel_ratio:C.pixelRatio,u_image:0,u_scale:[O,T.fromScale,T.toScale],u_fade:T.t,u_units_to_pixels:[1/I.pixelsToGLUnits[0],1/I.pixelsToGLUnits[1]]}},ns=(C,s,g,x,T)=>{const I=co(s,C.transform);return l.e(Sl(C,s,g,x),{u_tileratio:I,u_crossfade_from:T.fromScale,u_crossfade_to:T.toScale,u_image:0,u_mix:T.t,u_lineatlas_width:C.lineAtlas.width,u_lineatlas_height:C.lineAtlas.height})},ks=(C,s,g,x,T,I)=>{const O=co(s,C.transform);return l.e(Sl(C,s,g,x),{u_image:0,u_image_height:I,u_tileratio:O,u_crossfade_from:T.fromScale,u_crossfade_to:T.toScale,u_image_dash:1,u_mix:T.t,u_lineatlas_width:C.lineAtlas.width,u_lineatlas_height:C.lineAtlas.height})};function co(C,s){return 1/l.aN(C,1,s.tileZoom)}function wu(C,s,g){return l.aO(C.transform,s,g.paint.get("line-translate"),g.paint.get("line-translate-anchor"))}const od=(C,s,g,x,T)=>{return{u_tl_parent:C,u_scale_parent:s,u_buffer_scale:1,u_fade_t:g.mix,u_opacity:g.opacity*x.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:x.paint.get("raster-brightness-min"),u_brightness_high:x.paint.get("raster-brightness-max"),u_saturation_factor:(O=x.paint.get("raster-saturation"),O>0?1-1/(1.001-O):-O),u_contrast_factor:(I=x.paint.get("raster-contrast"),I>0?1/(1-I):1+I),u_spin_weights:g0(x.paint.get("raster-hue-rotate")),u_coords_top:[T[0].x,T[0].y,T[1].x,T[1].y],u_coords_bottom:[T[3].x,T[3].y,T[2].x,T[2].y]};var I,O};function g0(C){C*=Math.PI/180;const s=Math.sin(C),g=Math.cos(C);return[(2*g+1)/3,(-Math.sqrt(3)*s-g+1)/3,(Math.sqrt(3)*s-g+1)/3]}const ld=(C,s,g,x,T,I,O,z,G,q,J,re,ie)=>{const ce=O.transform;return{u_is_size_zoom_constant:+(C==="constant"||C==="source"),u_is_size_feature_constant:+(C==="constant"||C==="camera"),u_size_t:s?s.uSizeT:0,u_size:s?s.uSize:0,u_camera_to_center_distance:ce.cameraToCenterDistance,u_pitch:ce.pitch/360*2*Math.PI,u_rotate_symbol:+g,u_aspect_ratio:ce.width/ce.height,u_fade_change:O.options.fadeDuration?O.symbolFadeChange:1,u_label_plane_matrix:z,u_coord_matrix:G,u_is_text:+J,u_pitch_with_map:+x,u_is_along_line:T,u_is_variable_anchor:I,u_texsize:re,u_texture:0,u_translation:q,u_pitched_scale:ie}},cd=(C,s,g,x,T,I,O,z,G,q,J,re,ie,ce)=>{const _e=O.transform;return l.e(ld(C,s,g,x,T,I,O,z,G,q,J,re,ce),{u_gamma_scale:x?Math.cos(_e.pitch*Math.PI/180)*_e.cameraToCenterDistance:1,u_device_pixel_ratio:O.pixelRatio,u_is_halo:1})},il=(C,s,g,x,T,I,O,z,G,q,J,re,ie)=>l.e(cd(C,s,g,x,T,I,O,z,G,q,!0,J,0,ie),{u_texsize_icon:re,u_texture_icon:1}),xf=(C,s)=>({u_opacity:C,u_color:s}),bf=(C,s,g,x,T)=>l.e((function(I,O,z,G){const q=z.imageManager.getPattern(I.from.toString()),J=z.imageManager.getPattern(I.to.toString()),{width:re,height:ie}=z.imageManager.getPixelSize(),ce=Math.pow(2,G.tileID.overscaledZ),_e=G.tileSize*Math.pow(2,z.transform.tileZoom)/ce,Me=_e*(G.tileID.canonical.x+G.tileID.wrap*ce),Pe=_e*G.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:q.tl,u_pattern_br_a:q.br,u_pattern_tl_b:J.tl,u_pattern_br_b:J.br,u_texsize:[re,ie],u_mix:O.t,u_pattern_size_a:q.displaySize,u_pattern_size_b:J.displaySize,u_scale_a:O.fromScale,u_scale_b:O.toScale,u_tile_units_to_pixels:1/l.aN(G,1,z.transform.tileZoom),u_pixel_coord_upper:[Me>>16,Pe>>16],u_pixel_coord_lower:[65535&Me,65535&Pe]}})(g,T,s,x),{u_opacity:C}),ud=(C,s)=>{},m0={fillExtrusion:(C,s)=>({u_lightpos:new l.c2(C,s.u_lightpos),u_lightpos_globe:new l.c2(C,s.u_lightpos_globe),u_lightintensity:new l.bq(C,s.u_lightintensity),u_lightcolor:new l.c2(C,s.u_lightcolor),u_vertical_gradient:new l.bq(C,s.u_vertical_gradient),u_opacity:new l.bq(C,s.u_opacity),u_fill_translate:new l.c3(C,s.u_fill_translate)}),fillExtrusionPattern:(C,s)=>({u_lightpos:new l.c2(C,s.u_lightpos),u_lightpos_globe:new l.c2(C,s.u_lightpos_globe),u_lightintensity:new l.bq(C,s.u_lightintensity),u_lightcolor:new l.c2(C,s.u_lightcolor),u_vertical_gradient:new l.bq(C,s.u_vertical_gradient),u_height_factor:new l.bq(C,s.u_height_factor),u_opacity:new l.bq(C,s.u_opacity),u_fill_translate:new l.c3(C,s.u_fill_translate),u_image:new l.b_(C,s.u_image),u_texsize:new l.c3(C,s.u_texsize),u_pixel_coord_upper:new l.c3(C,s.u_pixel_coord_upper),u_pixel_coord_lower:new l.c3(C,s.u_pixel_coord_lower),u_scale:new l.c2(C,s.u_scale),u_fade:new l.bq(C,s.u_fade)}),fill:(C,s)=>({u_fill_translate:new l.c3(C,s.u_fill_translate)}),fillPattern:(C,s)=>({u_image:new l.b_(C,s.u_image),u_texsize:new l.c3(C,s.u_texsize),u_pixel_coord_upper:new l.c3(C,s.u_pixel_coord_upper),u_pixel_coord_lower:new l.c3(C,s.u_pixel_coord_lower),u_scale:new l.c2(C,s.u_scale),u_fade:new l.bq(C,s.u_fade),u_fill_translate:new l.c3(C,s.u_fill_translate)}),fillOutline:(C,s)=>({u_world:new l.c3(C,s.u_world),u_fill_translate:new l.c3(C,s.u_fill_translate)}),fillOutlinePattern:(C,s)=>({u_world:new l.c3(C,s.u_world),u_image:new l.b_(C,s.u_image),u_texsize:new l.c3(C,s.u_texsize),u_pixel_coord_upper:new l.c3(C,s.u_pixel_coord_upper),u_pixel_coord_lower:new l.c3(C,s.u_pixel_coord_lower),u_scale:new l.c2(C,s.u_scale),u_fade:new l.bq(C,s.u_fade),u_fill_translate:new l.c3(C,s.u_fill_translate)}),circle:(C,s)=>({u_camera_to_center_distance:new l.bq(C,s.u_camera_to_center_distance),u_scale_with_map:new l.b_(C,s.u_scale_with_map),u_pitch_with_map:new l.b_(C,s.u_pitch_with_map),u_extrude_scale:new l.c3(C,s.u_extrude_scale),u_device_pixel_ratio:new l.bq(C,s.u_device_pixel_ratio),u_globe_extrude_scale:new l.bq(C,s.u_globe_extrude_scale),u_translate:new l.c3(C,s.u_translate)}),collisionBox:(C,s)=>({u_pixel_extrude_scale:new l.c3(C,s.u_pixel_extrude_scale)}),collisionCircle:(C,s)=>({u_viewport_size:new l.c3(C,s.u_viewport_size)}),debug:(C,s)=>({u_color:new l.b$(C,s.u_color),u_overlay:new l.b_(C,s.u_overlay),u_overlay_scale:new l.bq(C,s.u_overlay_scale)}),depth:ud,clippingMask:ud,heatmap:(C,s)=>({u_extrude_scale:new l.bq(C,s.u_extrude_scale),u_intensity:new l.bq(C,s.u_intensity),u_globe_extrude_scale:new l.bq(C,s.u_globe_extrude_scale)}),heatmapTexture:(C,s)=>({u_matrix:new l.c0(C,s.u_matrix),u_world:new l.c3(C,s.u_world),u_image:new l.b_(C,s.u_image),u_color_ramp:new l.b_(C,s.u_color_ramp),u_opacity:new l.bq(C,s.u_opacity)}),hillshade:(C,s)=>({u_image:new l.b_(C,s.u_image),u_latrange:new l.c3(C,s.u_latrange),u_exaggeration:new l.bq(C,s.u_exaggeration),u_altitudes:new l.c9(C,s.u_altitudes),u_azimuths:new l.c9(C,s.u_azimuths),u_accent:new l.b$(C,s.u_accent),u_method:new l.b_(C,s.u_method),u_shadows:new l.c8(C,s.u_shadows),u_highlights:new l.c8(C,s.u_highlights)}),hillshadePrepare:(C,s)=>({u_matrix:new l.c0(C,s.u_matrix),u_image:new l.b_(C,s.u_image),u_dimension:new l.c3(C,s.u_dimension),u_zoom:new l.bq(C,s.u_zoom),u_unpack:new l.c1(C,s.u_unpack)}),colorRelief:(C,s)=>({u_image:new l.b_(C,s.u_image),u_unpack:new l.c1(C,s.u_unpack),u_dimension:new l.c3(C,s.u_dimension),u_elevation_stops:new l.b_(C,s.u_elevation_stops),u_color_stops:new l.b_(C,s.u_color_stops),u_color_ramp_size:new l.b_(C,s.u_color_ramp_size),u_opacity:new l.bq(C,s.u_opacity)}),line:(C,s)=>({u_translation:new l.c3(C,s.u_translation),u_ratio:new l.bq(C,s.u_ratio),u_device_pixel_ratio:new l.bq(C,s.u_device_pixel_ratio),u_units_to_pixels:new l.c3(C,s.u_units_to_pixels)}),lineGradient:(C,s)=>({u_translation:new l.c3(C,s.u_translation),u_ratio:new l.bq(C,s.u_ratio),u_device_pixel_ratio:new l.bq(C,s.u_device_pixel_ratio),u_units_to_pixels:new l.c3(C,s.u_units_to_pixels),u_image:new l.b_(C,s.u_image),u_image_height:new l.bq(C,s.u_image_height)}),linePattern:(C,s)=>({u_translation:new l.c3(C,s.u_translation),u_texsize:new l.c3(C,s.u_texsize),u_ratio:new l.bq(C,s.u_ratio),u_device_pixel_ratio:new l.bq(C,s.u_device_pixel_ratio),u_image:new l.b_(C,s.u_image),u_units_to_pixels:new l.c3(C,s.u_units_to_pixels),u_scale:new l.c2(C,s.u_scale),u_fade:new l.bq(C,s.u_fade)}),lineSDF:(C,s)=>({u_translation:new l.c3(C,s.u_translation),u_ratio:new l.bq(C,s.u_ratio),u_device_pixel_ratio:new l.bq(C,s.u_device_pixel_ratio),u_units_to_pixels:new l.c3(C,s.u_units_to_pixels),u_image:new l.b_(C,s.u_image),u_mix:new l.bq(C,s.u_mix),u_tileratio:new l.bq(C,s.u_tileratio),u_crossfade_from:new l.bq(C,s.u_crossfade_from),u_crossfade_to:new l.bq(C,s.u_crossfade_to),u_lineatlas_width:new l.bq(C,s.u_lineatlas_width),u_lineatlas_height:new l.bq(C,s.u_lineatlas_height)}),lineGradientSDF:(C,s)=>({u_translation:new l.c3(C,s.u_translation),u_ratio:new l.bq(C,s.u_ratio),u_device_pixel_ratio:new l.bq(C,s.u_device_pixel_ratio),u_units_to_pixels:new l.c3(C,s.u_units_to_pixels),u_image:new l.b_(C,s.u_image),u_image_height:new l.bq(C,s.u_image_height),u_tileratio:new l.bq(C,s.u_tileratio),u_crossfade_from:new l.bq(C,s.u_crossfade_from),u_crossfade_to:new l.bq(C,s.u_crossfade_to),u_image_dash:new l.b_(C,s.u_image_dash),u_mix:new l.bq(C,s.u_mix),u_lineatlas_width:new l.bq(C,s.u_lineatlas_width),u_lineatlas_height:new l.bq(C,s.u_lineatlas_height)}),raster:(C,s)=>({u_tl_parent:new l.c3(C,s.u_tl_parent),u_scale_parent:new l.bq(C,s.u_scale_parent),u_buffer_scale:new l.bq(C,s.u_buffer_scale),u_fade_t:new l.bq(C,s.u_fade_t),u_opacity:new l.bq(C,s.u_opacity),u_image0:new l.b_(C,s.u_image0),u_image1:new l.b_(C,s.u_image1),u_brightness_low:new l.bq(C,s.u_brightness_low),u_brightness_high:new l.bq(C,s.u_brightness_high),u_saturation_factor:new l.bq(C,s.u_saturation_factor),u_contrast_factor:new l.bq(C,s.u_contrast_factor),u_spin_weights:new l.c2(C,s.u_spin_weights),u_coords_top:new l.c1(C,s.u_coords_top),u_coords_bottom:new l.c1(C,s.u_coords_bottom)}),symbolIcon:(C,s)=>({u_is_size_zoom_constant:new l.b_(C,s.u_is_size_zoom_constant),u_is_size_feature_constant:new l.b_(C,s.u_is_size_feature_constant),u_size_t:new l.bq(C,s.u_size_t),u_size:new l.bq(C,s.u_size),u_camera_to_center_distance:new l.bq(C,s.u_camera_to_center_distance),u_pitch:new l.bq(C,s.u_pitch),u_rotate_symbol:new l.b_(C,s.u_rotate_symbol),u_aspect_ratio:new l.bq(C,s.u_aspect_ratio),u_fade_change:new l.bq(C,s.u_fade_change),u_label_plane_matrix:new l.c0(C,s.u_label_plane_matrix),u_coord_matrix:new l.c0(C,s.u_coord_matrix),u_is_text:new l.b_(C,s.u_is_text),u_pitch_with_map:new l.b_(C,s.u_pitch_with_map),u_is_along_line:new l.b_(C,s.u_is_along_line),u_is_variable_anchor:new l.b_(C,s.u_is_variable_anchor),u_texsize:new l.c3(C,s.u_texsize),u_texture:new l.b_(C,s.u_texture),u_translation:new l.c3(C,s.u_translation),u_pitched_scale:new l.bq(C,s.u_pitched_scale)}),symbolSDF:(C,s)=>({u_is_size_zoom_constant:new l.b_(C,s.u_is_size_zoom_constant),u_is_size_feature_constant:new l.b_(C,s.u_is_size_feature_constant),u_size_t:new l.bq(C,s.u_size_t),u_size:new l.bq(C,s.u_size),u_camera_to_center_distance:new l.bq(C,s.u_camera_to_center_distance),u_pitch:new l.bq(C,s.u_pitch),u_rotate_symbol:new l.b_(C,s.u_rotate_symbol),u_aspect_ratio:new l.bq(C,s.u_aspect_ratio),u_fade_change:new l.bq(C,s.u_fade_change),u_label_plane_matrix:new l.c0(C,s.u_label_plane_matrix),u_coord_matrix:new l.c0(C,s.u_coord_matrix),u_is_text:new l.b_(C,s.u_is_text),u_pitch_with_map:new l.b_(C,s.u_pitch_with_map),u_is_along_line:new l.b_(C,s.u_is_along_line),u_is_variable_anchor:new l.b_(C,s.u_is_variable_anchor),u_texsize:new l.c3(C,s.u_texsize),u_texture:new l.b_(C,s.u_texture),u_gamma_scale:new l.bq(C,s.u_gamma_scale),u_device_pixel_ratio:new l.bq(C,s.u_device_pixel_ratio),u_is_halo:new l.b_(C,s.u_is_halo),u_translation:new l.c3(C,s.u_translation),u_pitched_scale:new l.bq(C,s.u_pitched_scale)}),symbolTextAndIcon:(C,s)=>({u_is_size_zoom_constant:new l.b_(C,s.u_is_size_zoom_constant),u_is_size_feature_constant:new l.b_(C,s.u_is_size_feature_constant),u_size_t:new l.bq(C,s.u_size_t),u_size:new l.bq(C,s.u_size),u_camera_to_center_distance:new l.bq(C,s.u_camera_to_center_distance),u_pitch:new l.bq(C,s.u_pitch),u_rotate_symbol:new l.b_(C,s.u_rotate_symbol),u_aspect_ratio:new l.bq(C,s.u_aspect_ratio),u_fade_change:new l.bq(C,s.u_fade_change),u_label_plane_matrix:new l.c0(C,s.u_label_plane_matrix),u_coord_matrix:new l.c0(C,s.u_coord_matrix),u_is_text:new l.b_(C,s.u_is_text),u_pitch_with_map:new l.b_(C,s.u_pitch_with_map),u_is_along_line:new l.b_(C,s.u_is_along_line),u_is_variable_anchor:new l.b_(C,s.u_is_variable_anchor),u_texsize:new l.c3(C,s.u_texsize),u_texsize_icon:new l.c3(C,s.u_texsize_icon),u_texture:new l.b_(C,s.u_texture),u_texture_icon:new l.b_(C,s.u_texture_icon),u_gamma_scale:new l.bq(C,s.u_gamma_scale),u_device_pixel_ratio:new l.bq(C,s.u_device_pixel_ratio),u_is_halo:new l.b_(C,s.u_is_halo),u_translation:new l.c3(C,s.u_translation),u_pitched_scale:new l.bq(C,s.u_pitched_scale)}),background:(C,s)=>({u_opacity:new l.bq(C,s.u_opacity),u_color:new l.b$(C,s.u_color)}),backgroundPattern:(C,s)=>({u_opacity:new l.bq(C,s.u_opacity),u_image:new l.b_(C,s.u_image),u_pattern_tl_a:new l.c3(C,s.u_pattern_tl_a),u_pattern_br_a:new l.c3(C,s.u_pattern_br_a),u_pattern_tl_b:new l.c3(C,s.u_pattern_tl_b),u_pattern_br_b:new l.c3(C,s.u_pattern_br_b),u_texsize:new l.c3(C,s.u_texsize),u_mix:new l.bq(C,s.u_mix),u_pattern_size_a:new l.c3(C,s.u_pattern_size_a),u_pattern_size_b:new l.c3(C,s.u_pattern_size_b),u_scale_a:new l.bq(C,s.u_scale_a),u_scale_b:new l.bq(C,s.u_scale_b),u_pixel_coord_upper:new l.c3(C,s.u_pixel_coord_upper),u_pixel_coord_lower:new l.c3(C,s.u_pixel_coord_lower),u_tile_units_to_pixels:new l.bq(C,s.u_tile_units_to_pixels)}),terrain:(C,s)=>({u_texture:new l.b_(C,s.u_texture),u_ele_delta:new l.bq(C,s.u_ele_delta),u_fog_matrix:new l.c0(C,s.u_fog_matrix),u_fog_color:new l.b$(C,s.u_fog_color),u_fog_ground_blend:new l.bq(C,s.u_fog_ground_blend),u_fog_ground_blend_opacity:new l.bq(C,s.u_fog_ground_blend_opacity),u_horizon_color:new l.b$(C,s.u_horizon_color),u_horizon_fog_blend:new l.bq(C,s.u_horizon_fog_blend),u_is_globe_mode:new l.bq(C,s.u_is_globe_mode)}),terrainDepth:(C,s)=>({u_ele_delta:new l.bq(C,s.u_ele_delta)}),terrainCoords:(C,s)=>({u_texture:new l.b_(C,s.u_texture),u_terrain_coords_id:new l.bq(C,s.u_terrain_coords_id),u_ele_delta:new l.bq(C,s.u_ele_delta)}),projectionErrorMeasurement:(C,s)=>({u_input:new l.bq(C,s.u_input),u_output_expected:new l.bq(C,s.u_output_expected)}),atmosphere:(C,s)=>({u_sun_pos:new l.c2(C,s.u_sun_pos),u_atmosphere_blend:new l.bq(C,s.u_atmosphere_blend),u_globe_position:new l.c2(C,s.u_globe_position),u_globe_radius:new l.bq(C,s.u_globe_radius),u_inv_proj_matrix:new l.c0(C,s.u_inv_proj_matrix)}),sky:(C,s)=>({u_sky_color:new l.b$(C,s.u_sky_color),u_horizon_color:new l.b$(C,s.u_horizon_color),u_horizon:new l.c3(C,s.u_horizon),u_horizon_normal:new l.c3(C,s.u_horizon_normal),u_sky_horizon_blend:new l.bq(C,s.u_sky_horizon_blend),u_sky_blend:new l.bq(C,s.u_sky_blend)})};class ee{constructor(s,g,x){this.context=s;const T=s.gl;this.buffer=T.createBuffer(),this.dynamicDraw=!!x,this.context.unbindVAO(),s.bindElementBuffer.set(this.buffer),T.bufferData(T.ELEMENT_ARRAY_BUFFER,g.arrayBuffer,this.dynamicDraw?T.DYNAMIC_DRAW:T.STATIC_DRAW),this.dynamicDraw||delete g.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(s){const g=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),g.bufferSubData(g.ELEMENT_ARRAY_BUFFER,0,s.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const yh={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class jp{constructor(s,g,x,T){this.length=g.length,this.attributes=x,this.itemSize=g.bytesPerElement,this.dynamicDraw=T,this.context=s;const I=s.gl;this.buffer=I.createBuffer(),s.bindVertexBuffer.set(this.buffer),I.bufferData(I.ARRAY_BUFFER,g.arrayBuffer,this.dynamicDraw?I.DYNAMIC_DRAW:I.STATIC_DRAW),this.dynamicDraw||delete g.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(s){if(s.length!==this.length)throw new Error(`Length of new data is ${s.length}, which doesn't match current length of ${this.length}`);const g=this.context.gl;this.bind(),g.bufferSubData(g.ARRAY_BUFFER,0,s.arrayBuffer)}enableAttributes(s,g){for(let x=0;x<this.attributes.length;x++){const T=g.attributes[this.attributes[x].name];T!==void 0&&s.enableVertexAttribArray(T)}}setVertexAttribPointers(s,g,x){for(let T=0;T<this.attributes.length;T++){const I=this.attributes[T],O=g.attributes[I.name];O!==void 0&&s.vertexAttribPointer(O,I.components,s[yh[I.type]],!1,this.itemSize,I.offset+this.itemSize*(x||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class On{constructor(s){this.gl=s.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(s){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class El extends On{getDefault(){return l.bp.transparent}set(s){const g=this.current;(s.r!==g.r||s.g!==g.g||s.b!==g.b||s.a!==g.a||this.dirty)&&(this.gl.clearColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class Af extends On{getDefault(){return 1}set(s){(s!==this.current||this.dirty)&&(this.gl.clearDepth(s),this.current=s,this.dirty=!1)}}class wf extends On{getDefault(){return 0}set(s){(s!==this.current||this.dirty)&&(this.gl.clearStencil(s),this.current=s,this.dirty=!1)}}class hd extends On{getDefault(){return[!0,!0,!0,!0]}set(s){const g=this.current;(s[0]!==g[0]||s[1]!==g[1]||s[2]!==g[2]||s[3]!==g[3]||this.dirty)&&(this.gl.colorMask(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class Tu extends On{getDefault(){return!0}set(s){(s!==this.current||this.dirty)&&(this.gl.depthMask(s),this.current=s,this.dirty=!1)}}class Tf extends On{getDefault(){return 255}set(s){(s!==this.current||this.dirty)&&(this.gl.stencilMask(s),this.current=s,this.dirty=!1)}}class vh extends On{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(s){const g=this.current;(s.func!==g.func||s.ref!==g.ref||s.mask!==g.mask||this.dirty)&&(this.gl.stencilFunc(s.func,s.ref,s.mask),this.current=s,this.dirty=!1)}}class uo extends On{getDefault(){const s=this.gl;return[s.KEEP,s.KEEP,s.KEEP]}set(s){const g=this.current;(s[0]!==g[0]||s[1]!==g[1]||s[2]!==g[2]||this.dirty)&&(this.gl.stencilOp(s[0],s[1],s[2]),this.current=s,this.dirty=!1)}}class _0 extends On{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const g=this.gl;s?g.enable(g.STENCIL_TEST):g.disable(g.STENCIL_TEST),this.current=s,this.dirty=!1}}class fd extends On{getDefault(){return[0,1]}set(s){const g=this.current;(s[0]!==g[0]||s[1]!==g[1]||this.dirty)&&(this.gl.depthRange(s[0],s[1]),this.current=s,this.dirty=!1)}}class ho extends On{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const g=this.gl;s?g.enable(g.DEPTH_TEST):g.disable(g.DEPTH_TEST),this.current=s,this.dirty=!1}}class Ml extends On{getDefault(){return this.gl.LESS}set(s){(s!==this.current||this.dirty)&&(this.gl.depthFunc(s),this.current=s,this.dirty=!1)}}class Ra extends On{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const g=this.gl;s?g.enable(g.BLEND):g.disable(g.BLEND),this.current=s,this.dirty=!1}}class nl extends On{getDefault(){const s=this.gl;return[s.ONE,s.ZERO]}set(s){const g=this.current;(s[0]!==g[0]||s[1]!==g[1]||this.dirty)&&(this.gl.blendFunc(s[0],s[1]),this.current=s,this.dirty=!1)}}class Su extends On{getDefault(){return l.bp.transparent}set(s){const g=this.current;(s.r!==g.r||s.g!==g.g||s.b!==g.b||s.a!==g.a||this.dirty)&&(this.gl.blendColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class xh extends On{getDefault(){return this.gl.FUNC_ADD}set(s){(s!==this.current||this.dirty)&&(this.gl.blendEquation(s),this.current=s,this.dirty=!1)}}class Sf extends On{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const g=this.gl;s?g.enable(g.CULL_FACE):g.disable(g.CULL_FACE),this.current=s,this.dirty=!1}}class Wc extends On{getDefault(){return this.gl.BACK}set(s){(s!==this.current||this.dirty)&&(this.gl.cullFace(s),this.current=s,this.dirty=!1)}}class Bo extends On{getDefault(){return this.gl.CCW}set(s){(s!==this.current||this.dirty)&&(this.gl.frontFace(s),this.current=s,this.dirty=!1)}}class y0 extends On{getDefault(){return null}set(s){(s!==this.current||this.dirty)&&(this.gl.useProgram(s),this.current=s,this.dirty=!1)}}class an extends On{getDefault(){return this.gl.TEXTURE0}set(s){(s!==this.current||this.dirty)&&(this.gl.activeTexture(s),this.current=s,this.dirty=!1)}}class tn extends On{getDefault(){const s=this.gl;return[0,0,s.drawingBufferWidth,s.drawingBufferHeight]}set(s){const g=this.current;(s[0]!==g[0]||s[1]!==g[1]||s[2]!==g[2]||s[3]!==g[3]||this.dirty)&&(this.gl.viewport(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class dd extends On{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const g=this.gl;g.bindFramebuffer(g.FRAMEBUFFER,s),this.current=s,this.dirty=!1}}class Ca extends On{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const g=this.gl;g.bindRenderbuffer(g.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class pd extends On{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const g=this.gl;g.bindTexture(g.TEXTURE_2D,s),this.current=s,this.dirty=!1}}class fo extends On{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const g=this.gl;g.bindBuffer(g.ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class Gp extends On{getDefault(){return null}set(s){const g=this.gl;g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class gd extends On{getDefault(){return null}set(s){var g;if(s===this.current&&!this.dirty)return;const x=this.gl;Oo(x)?x.bindVertexArray(s):(g=x.getExtension("OES_vertex_array_object"))===null||g===void 0||g.bindVertexArrayOES(s),this.current=s,this.dirty=!1}}class Zc extends On{getDefault(){return 4}set(s){if(s===this.current&&!this.dirty)return;const g=this.gl;g.pixelStorei(g.UNPACK_ALIGNMENT,s),this.current=s,this.dirty=!1}}class v0 extends On{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const g=this.gl;g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s),this.current=s,this.dirty=!1}}class Eu extends On{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const g=this.gl;g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,s),this.current=s,this.dirty=!1}}class Rl extends On{constructor(s,g){super(s),this.context=s,this.parent=g}getDefault(){return null}}class Mu extends Rl{setDirty(){this.dirty=!0}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const g=this.gl;g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class Pa extends Rl{set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const g=this.gl;g.framebufferRenderbuffer(g.FRAMEBUFFER,g.DEPTH_ATTACHMENT,g.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class cc extends Rl{set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const g=this.gl;g.framebufferRenderbuffer(g.FRAMEBUFFER,g.DEPTH_STENCIL_ATTACHMENT,g.RENDERBUFFER,s),this.current=s,this.dirty=!1}}const Xc="Framebuffer is not complete";class Ru{constructor(s,g,x,T,I){this.context=s,this.width=g,this.height=x;const O=s.gl,z=this.framebuffer=O.createFramebuffer();if(this.colorAttachment=new Mu(s,z),T)this.depthAttachment=I?new cc(s,z):new Pa(s,z);else if(I)throw new Error("Stencil cannot be set without depth");if(O.checkFramebufferStatus(O.FRAMEBUFFER)!==O.FRAMEBUFFER_COMPLETE)throw new Error(Xc)}destroy(){const s=this.context.gl,g=this.colorAttachment.get();if(g&&s.deleteTexture(g),this.depthAttachment){const x=this.depthAttachment.get();x&&s.deleteRenderbuffer(x)}s.deleteFramebuffer(this.framebuffer)}}class rl{constructor(s){var g,x;if(this.gl=s,this.clearColor=new El(this),this.clearDepth=new Af(this),this.clearStencil=new wf(this),this.colorMask=new hd(this),this.depthMask=new Tu(this),this.stencilMask=new Tf(this),this.stencilFunc=new vh(this),this.stencilOp=new uo(this),this.stencilTest=new _0(this),this.depthRange=new fd(this),this.depthTest=new ho(this),this.depthFunc=new Ml(this),this.blend=new Ra(this),this.blendFunc=new nl(this),this.blendColor=new Su(this),this.blendEquation=new xh(this),this.cullFace=new Sf(this),this.cullFaceSide=new Wc(this),this.frontFace=new Bo(this),this.program=new y0(this),this.activeTexture=new an(this),this.viewport=new tn(this),this.bindFramebuffer=new dd(this),this.bindRenderbuffer=new Ca(this),this.bindTexture=new pd(this),this.bindVertexBuffer=new fo(this),this.bindElementBuffer=new Gp(this),this.bindVertexArray=new gd(this),this.pixelStoreUnpack=new Zc(this),this.pixelStoreUnpackPremultiplyAlpha=new v0(this),this.pixelStoreUnpackFlipY=new Eu(this),this.extTextureFilterAnisotropic=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=s.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=s.getParameter(s.MAX_TEXTURE_SIZE),Oo(s)){this.HALF_FLOAT=s.HALF_FLOAT;const T=s.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(g=s.RGBA16F)!==null&&g!==void 0?g:T==null?void 0:T.RGBA16F_EXT,this.RGB16F=(x=s.RGB16F)!==null&&x!==void 0?x:T==null?void 0:T.RGB16F_EXT,s.getExtension("EXT_color_buffer_float")}else{s.getExtension("EXT_color_buffer_half_float"),s.getExtension("OES_texture_half_float_linear");const T=s.getExtension("OES_texture_half_float");this.HALF_FLOAT=T==null?void 0:T.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(s,g){return new ee(this,s,g)}createVertexBuffer(s,g,x){return new jp(this,s,g,x)}createRenderbuffer(s,g,x){const T=this.gl,I=T.createRenderbuffer();return this.bindRenderbuffer.set(I),T.renderbufferStorage(T.RENDERBUFFER,s,g,x),this.bindRenderbuffer.set(null),I}createFramebuffer(s,g,x,T){return new Ru(this,s,g,x,T)}clear({color:s,depth:g,stencil:x}){const T=this.gl;let I=0;s&&(I|=T.COLOR_BUFFER_BIT,this.clearColor.set(s),this.colorMask.set([!0,!0,!0,!0])),g!==void 0&&(I|=T.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(g),this.depthMask.set(!0)),x!==void 0&&(I|=T.STENCIL_BUFFER_BIT,this.clearStencil.set(x),this.stencilMask.set(255)),T.clear(I)}setCullFace(s){s.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(s.mode),this.frontFace.set(s.frontFace))}setDepthMode(s){s.func!==this.gl.ALWAYS||s.mask?(this.depthTest.set(!0),this.depthFunc.set(s.func),this.depthMask.set(s.mask),this.depthRange.set(s.range)):this.depthTest.set(!1)}setStencilMode(s){s.test.func!==this.gl.ALWAYS||s.mask?(this.stencilTest.set(!0),this.stencilMask.set(s.mask),this.stencilOp.set([s.fail,s.depthFail,s.pass]),this.stencilFunc.set({func:s.test.func,ref:s.ref,mask:s.test.mask})):this.stencilTest.set(!1)}setColorMode(s){l.bR(s.blendFunction,$n.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(s.blendFunction),this.blendColor.set(s.blendColor)),this.colorMask.set(s.mask)}createVertexArray(){var s;return Oo(this.gl)?this.gl.createVertexArray():(s=this.gl.getExtension("OES_vertex_array_object"))===null||s===void 0?void 0:s.createVertexArrayOES()}deleteVertexArray(s){var g;return Oo(this.gl)?this.gl.deleteVertexArray(s):(g=this.gl.getExtension("OES_vertex_array_object"))===null||g===void 0?void 0:g.deleteVertexArrayOES(s)}unbindVAO(){this.bindVertexArray.set(null)}}let As;function Vs(C,s,g,x,T){const I=C.context,O=C.transform,z=I.gl,G=C.useProgram("collisionBox"),q=[];let J=0,re=0;for(let Ce=0;Ce<x.length;Ce++){const Oe=x[Ce],We=s.getTile(Oe).getBucket(g);if(!We)continue;const ke=T?We.textCollisionBox:We.iconCollisionBox,Ge=We.collisionCircleArray;Ge.length>0&&(q.push({circleArray:Ge,circleOffset:re,coord:Oe}),J+=Ge.length/4,re=J),ke&&G.draw(I,z.LINES,Ki.disabled,Mn.disabled,C.colorModeForRenderPass(),fn.disabled,Gc(C.transform),C.style.map.terrain&&C.style.map.terrain.getTerrainData(Oe),O.getProjectionData({overscaledTileID:Oe,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),g.id,ke.layoutVertexBuffer,ke.indexBuffer,ke.segments,null,C.transform.zoom,null,null,ke.collisionVertexBuffer)}if(!T||!q.length)return;const ie=C.useProgram("collisionCircle"),ce=new l.ca;ce.resize(4*J),ce._trim();let _e=0;for(const Ce of q)for(let Oe=0;Oe<Ce.circleArray.length/4;Oe++){const We=4*Oe,ke=Ce.circleArray[We+0],Ge=Ce.circleArray[We+1],Xe=Ce.circleArray[We+2],Ue=Ce.circleArray[We+3];ce.emplace(_e++,ke,Ge,Xe,Ue,0),ce.emplace(_e++,ke,Ge,Xe,Ue,1),ce.emplace(_e++,ke,Ge,Xe,Ue,2),ce.emplace(_e++,ke,Ge,Xe,Ue,3)}(!As||As.length<2*J)&&(As=(function(Ce){const Oe=2*Ce,We=new l.cc;We.resize(Oe),We._trim();for(let ke=0;ke<Oe;ke++){const Ge=6*ke;We.uint16[Ge+0]=4*ke+0,We.uint16[Ge+1]=4*ke+1,We.uint16[Ge+2]=4*ke+2,We.uint16[Ge+3]=4*ke+2,We.uint16[Ge+4]=4*ke+3,We.uint16[Ge+5]=4*ke+0}return We})(J));const Me=I.createIndexBuffer(As,!0),Pe=I.createVertexBuffer(ce,l.cb.members,!0);for(const Ce of q){const Oe=ir(C.transform);ie.draw(I,z.TRIANGLES,Ki.disabled,Mn.disabled,C.colorModeForRenderPass(),fn.disabled,Oe,C.style.map.terrain&&C.style.map.terrain.getTerrainData(Ce.coord),null,g.id,Pe,Me,l.aX.simpleSegment(0,2*Ce.circleOffset,Ce.circleArray.length,Ce.circleArray.length/2),null,C.transform.zoom,null,null,null)}Pe.destroy(),Me.destroy()}const sl=l.ar(new Float32Array(16));function Cl(C,s,g,x,T,I){const{horizontalAlign:O,verticalAlign:z}=l.aS(C);return new l.P((-(O-.5)*s/T+x[0])*I,(-(z-.5)*g/T+x[1])*I)}function Ua(C,s,g,x,T,I){const O=s.tileAnchorPoint.add(new l.P(s.translation[0],s.translation[1]));if(s.pitchWithMap){let z=x.mult(I);g||(z=z.rotate(-T));const G=O.add(z);return Yi(G.x,G.y,s.pitchedLabelPlaneMatrix,s.getElevation).point}if(g){const z=En(s.tileAnchorPoint.x+1,s.tileAnchorPoint.y,s).point.sub(C),G=Math.atan(z.y/z.x)+(z.x<0?Math.PI:0);return C.add(x.rotate(G))}return C.add(x)}function Ia(C,s,g,x,T,I,O,z,G,q,J,re){const ie=C.text.placedSymbolArray,ce=C.text.dynamicLayoutVertexArray,_e=C.icon.dynamicLayoutVertexArray,Me={};ce.clear();for(let Pe=0;Pe<ie.length;Pe++){const Ce=ie.get(Pe),Oe=Ce.hidden||!Ce.crossTileID||C.allowVerticalPlacement&&!Ce.placedOrientation?null:x[Ce.crossTileID];if(Oe){const We=new l.P(Ce.anchorX,Ce.anchorY),ke={getElevation:re,width:T.width,height:T.height,pitchedLabelPlaneMatrix:I,pitchWithMap:g,transform:T,tileAnchorPoint:We,translation:q,unwrappedTileID:J},Ge=g?hu(We.x,We.y,ke):En(We.x,We.y,ke),Xe=Ko(T.cameraToCenterDistance,Ge.signedDistanceFromCamera);let Ue=l.aA(C.textSizeData,z,Ce)*Xe/l.aM;g&&(Ue*=C.tilePixelRatio/O);const{width:et,height:At,anchor:pt,textOffset:bt,textBoxScale:_t}=Oe,ti=Cl(pt,et,At,bt,_t,Ue),ii=T.getPitchedTextCorrection(We.x+q[0],We.y+q[1],J),Wt=Ua(Ge.point,ke,s,ti,-T.bearingInRadians,ii),ri=C.allowVerticalPlacement&&Ce.placedOrientation===l.az.vertical?Math.PI/2:0;for(let Ji=0;Ji<Ce.numGlyphs;Ji++)l.aG(ce,Wt,ri);G&&Ce.associatedIconIndex>=0&&(Me[Ce.associatedIconIndex]={shiftedAnchor:Wt,angle:ri})}else Tl(Ce.numGlyphs,ce)}if(G){_e.clear();const Pe=C.icon.placedSymbolArray;for(let Ce=0;Ce<Pe.length;Ce++){const Oe=Pe.get(Ce);if(Oe.hidden)Tl(Oe.numGlyphs,_e);else{const We=Me[Ce];if(We)for(let ke=0;ke<Oe.numGlyphs;ke++)l.aG(_e,We.shiftedAnchor,We.angle);else Tl(Oe.numGlyphs,_e)}}C.icon.dynamicLayoutVertexBuffer.updateData(_e)}C.text.dynamicLayoutVertexBuffer.updateData(ce)}function uc(C,s,g){return g.iconsInText&&s?"symbolTextAndIcon":C?"symbolSDF":"symbolIcon"}function Cu(C,s,g,x,T,I,O,z,G,q,J,re,ie){const ce=C.context,_e=ce.gl,Me=C.transform,Pe=z==="map",Ce=G==="map",Oe=z!=="viewport"&&g.layout.get("symbol-placement")!=="point",We=Pe&&!Ce&&!Oe,ke=!g.layout.get("symbol-sort-key").isConstant();let Ge=!1;const Xe=C.getDepthModeForSublayer(0,Ki.ReadOnly),Ue=g._unevaluatedLayout.hasValue("text-variable-anchor")||g._unevaluatedLayout.hasValue("text-variable-anchor-offset"),et=[],At=Me.getCircleRadiusCorrection();for(const pt of x){const bt=s.getTile(pt),_t=bt.getBucket(g);if(!_t)continue;const ti=T?_t.text:_t.icon;if(!ti||!ti.segments.get().length||!ti.hasVisibleVertices)continue;const ii=ti.programConfigurations.get(g.id),Wt=T||_t.sdfIcons,ri=T?_t.textSizeData:_t.iconSizeData,Ji=Ce||Me.pitch!==0,sn=C.useProgram(uc(Wt,T,_t),ii),rr=l.ay(ri,Me.zoom),sr=C.style.map.terrain&&C.style.map.terrain.getTerrainData(pt);let yr,qn,zr,vr,Gs=[0,0],Xr=null;if(T)qn=bt.glyphAtlasTexture,zr=_e.LINEAR,yr=bt.glyphAtlasTexture.size,_t.iconsInText&&(Gs=bt.imageAtlasTexture.size,Xr=bt.imageAtlasTexture,vr=Ji||C.options.rotating||C.options.zooming||ri.kind==="composite"||ri.kind==="camera"?_e.LINEAR:_e.NEAREST);else{const Xn=g.layout.get("icon-size").constantOr(0)!==1||_t.iconsNeedLinear;qn=bt.imageAtlasTexture,zr=Wt||C.options.rotating||C.options.zooming||Xn||Ji?_e.LINEAR:_e.NEAREST,yr=bt.imageAtlasTexture.size}const jn=l.aN(bt,1,C.transform.zoom),fr=ba(Pe,C.transform,jn),Os=l.N();l.aB(Os,fr);const Fs=df(Ce,Pe,C.transform,jn),ws=l.aO(Me,bt,I,O),Hr=Me.getProjectionData({overscaledTileID:pt,applyGlobeMatrix:!ie,applyTerrainMatrix:!0}),ua=Ue&&_t.hasTextData(),Wl=g.layout.get("icon-text-fit")!=="none"&&ua&&_t.hasIconData();if(Oe){const Xn=C.style.map.terrain?(gs,Ts)=>C.style.map.terrain.getElevation(pt,gs,Ts):null,ar=g.layout.get("text-rotation-alignment")==="map";rc(_t,C,T,fr,Os,Ce,q,ar,pt.toUnwrapped(),Me.width,Me.height,ws,Xn)}const jo=T&&Ue||Wl,Xa=Oe||jo?sl:Ce?fr:C.transform.clipSpaceToPixelsMatrix,xo=Wt&&g.paint.get(T?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Go;Go=Wt?_t.iconsInText?il(ri.kind,rr,We,Ce,Oe,jo,C,Xa,Fs,ws,yr,Gs,At):cd(ri.kind,rr,We,Ce,Oe,jo,C,Xa,Fs,ws,T,yr,0,At):ld(ri.kind,rr,We,Ce,Oe,jo,C,Xa,Fs,ws,T,yr,At);const $r={program:sn,buffers:ti,uniformValues:Go,projectionData:Hr,atlasTexture:qn,atlasTextureIcon:Xr,atlasInterpolation:zr,atlasInterpolationIcon:vr,isSDF:Wt,hasHalo:xo};if(ke&&_t.canOverlap){Ge=!0;const Xn=ti.segments.get();for(const ar of Xn)et.push({segments:new l.aX([ar]),sortKey:ar.sortKey,state:$r,terrainData:sr})}else et.push({segments:ti.segments,sortKey:0,state:$r,terrainData:sr})}Ge&&et.sort(((pt,bt)=>pt.sortKey-bt.sortKey));for(const pt of et){const bt=pt.state;if(ce.activeTexture.set(_e.TEXTURE0),bt.atlasTexture.bind(bt.atlasInterpolation,_e.CLAMP_TO_EDGE),bt.atlasTextureIcon&&(ce.activeTexture.set(_e.TEXTURE1),bt.atlasTextureIcon&&bt.atlasTextureIcon.bind(bt.atlasInterpolationIcon,_e.CLAMP_TO_EDGE)),bt.isSDF){const _t=bt.uniformValues;bt.hasHalo&&(_t.u_is_halo=1,Pl(bt.buffers,pt.segments,g,C,bt.program,Xe,J,re,_t,bt.projectionData,pt.terrainData)),_t.u_is_halo=0}Pl(bt.buffers,pt.segments,g,C,bt.program,Xe,J,re,bt.uniformValues,bt.projectionData,pt.terrainData)}}function Pl(C,s,g,x,T,I,O,z,G,q,J){const re=x.context;T.draw(re,re.gl.TRIANGLES,I,O,z,fn.backCCW,G,J,q,g.id,C.layoutVertexBuffer,C.indexBuffer,s,g.paint,x.transform.zoom,C.programConfigurations.get(g.id),C.dynamicLayoutVertexBuffer,C.opacityVertexBuffer)}function x0(C,s,g,x,T){const I=C.context,O=I.gl,z=Mn.disabled,G=new $n([O.ONE,O.ONE],l.bp.transparent,[!0,!0,!0,!0]),q=s.getBucket(g);if(!q)return;const J=x.key;let re=g.heatmapFbos.get(J);re||(re=nr(I,s.tileSize,s.tileSize),g.heatmapFbos.set(J,re)),I.bindFramebuffer.set(re.framebuffer),I.viewport.set([0,0,s.tileSize,s.tileSize]),I.clear({color:l.bp.transparent});const ie=q.programConfigurations.get(g.id),ce=C.useProgram("heatmap",ie,!T),_e=C.transform.getProjectionData({overscaledTileID:s.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Me=C.style.map.terrain.getTerrainData(x);ce.draw(I,O.TRIANGLES,Ki.disabled,z,G,fn.disabled,Au(s,C.transform.zoom,g.paint.get("heatmap-intensity"),1),Me,_e,g.id,q.layoutVertexBuffer,q.indexBuffer,q.segments,g.paint,C.transform.zoom,ie)}function js(C,s,g,x,T){const I=C.context,O=I.gl,z=C.transform;I.setColorMode(C.colorModeForRenderPass());const G=bn(I,s),q=g.key,J=s.heatmapFbos.get(q);if(!J)return;I.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,J.colorAttachment.get()),I.activeTexture.set(O.TEXTURE1),G.bind(O.LINEAR,O.CLAMP_TO_EDGE);const re=z.getProjectionData({overscaledTileID:g,applyTerrainMatrix:T,applyGlobeMatrix:!x});C.useProgram("heatmapTexture").draw(I,O.TRIANGLES,Ki.disabled,Mn.disabled,C.colorModeForRenderPass(),fn.disabled,zp(C,s,0,1),null,re,s.id,C.rasterBoundsBuffer,C.quadTriangleIndexBuffer,C.rasterBoundsSegments,s.paint,z.zoom),J.destroy(),s.heatmapFbos.delete(q)}function nr(C,s,g){var x,T;const I=C.gl,O=I.createTexture();I.bindTexture(I.TEXTURE_2D,O),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_WRAP_S,I.CLAMP_TO_EDGE),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_WRAP_T,I.CLAMP_TO_EDGE),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_MIN_FILTER,I.LINEAR),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_MAG_FILTER,I.LINEAR);const z=(x=C.HALF_FLOAT)!==null&&x!==void 0?x:I.UNSIGNED_BYTE,G=(T=C.RGBA16F)!==null&&T!==void 0?T:I.RGBA;I.texImage2D(I.TEXTURE_2D,0,G,s,g,0,I.RGBA,z,null);const q=C.createFramebuffer(s,g,!1,!1);return q.colorAttachment.set(O),q}function bn(C,s){return s.colorRampTexture||(s.colorRampTexture=new l.T(C,s.colorRamp,C.gl.RGBA)),s.colorRampTexture}function al(C,s,g,x,T,I,O,z){let G=256;if(T.stepInterpolant){const q=s.getSource().maxzoom,J=O.canonical.z===q?Math.ceil(1<<C.transform.maxZoom-O.canonical.z):1;G=l.an(l.ce(I.maxLineLength/l.a5*1024*J),256,g.maxTextureSize)}return z.gradient=l.cf({expression:T.gradientExpression(),evaluationKey:"lineProgress",resolution:G,image:z.gradient||void 0,clips:I.lineClipsArray}),z.texture?z.texture.update(z.gradient):z.texture=new l.T(g,z.gradient,x.RGBA),z.version=T.gradientVersion,z.texture}function po(C,s,g,x,T){C.activeTexture.set(s.TEXTURE0),g.imageAtlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE),x.updatePaintBuffers(T)}function Fr(C,s,g,x,T,I){(T||C.lineAtlas.dirty)&&(s.activeTexture.set(g.TEXTURE0),C.lineAtlas.bind(s)),x.updatePaintBuffers(I)}function Va(C,s,g,x,T,I,O){const z=I.gradients[T.id];let G=z.texture;T.gradientVersion!==z.version&&(G=al(C,s,g,x,T,I,O,z)),g.activeTexture.set(x.TEXTURE0),G.bind(T.stepInterpolant?x.NEAREST:x.LINEAR,x.CLAMP_TO_EDGE)}function ja(C,s,g,x,T,I,O,z,G){const q=I.gradients[T.id];let J=q.texture;T.gradientVersion!==q.version&&(J=al(C,s,g,x,T,I,O,q)),g.activeTexture.set(x.TEXTURE0),J.bind(T.stepInterpolant?x.NEAREST:x.LINEAR,x.CLAMP_TO_EDGE),g.activeTexture.set(x.TEXTURE1),C.lineAtlas.bind(g),z.updatePaintBuffers(G)}function Il(C,s,g,x,T){if(!g||!x||!x.imageAtlas)return;const I=x.imageAtlas.patternPositions;let O=I[g.to.toString()],z=I[g.from.toString()];if(!O&&z&&(O=z),!z&&O&&(z=O),!O||!z){const G=T.getPaintProperty(s);O=I[G],z=I[G]}O&&z&&C.setConstantPatternPositions(O,z)}function kl(C,s,g,x,T,I,O,z){const G=C.context.gl,q="fill-pattern",J=g.paint.get(q),re=J&&J.constantOr(1),ie=g.getCrossfadeParameters();let ce,_e,Me,Pe,Ce;const Oe=C.transform,We=g.paint.get("fill-translate"),ke=g.paint.get("fill-translate-anchor");O?(_e=re&&!g.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",ce=G.LINES):(_e=re?"fillPattern":"fill",ce=G.TRIANGLES);const Ge=J.constantOr(null);for(const Xe of x){const Ue=s.getTile(Xe);if(re&&!Ue.patternsLoaded())continue;const et=Ue.getBucket(g);if(!et)continue;const At=et.programConfigurations.get(g.id),pt=C.useProgram(_e,At),bt=C.style.map.terrain&&C.style.map.terrain.getTerrainData(Xe);re&&(C.context.activeTexture.set(G.TEXTURE0),Ue.imageAtlasTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),At.updatePaintBuffers(ie)),Il(At,q,Ge,Ue,g);const _t=Oe.getProjectionData({overscaledTileID:Xe,applyGlobeMatrix:!z,applyTerrainMatrix:!0}),ti=l.aO(Oe,Ue,We,ke);if(O){Pe=et.indexBuffer2,Ce=et.segments2;const Wt=[G.drawingBufferWidth,G.drawingBufferHeight];Me=_e==="fillOutlinePattern"&&re?Dn(C,ie,Ue,Wt,ti):Ln(Wt,ti)}else Pe=et.indexBuffer,Ce=et.segments,Me=re?ds(C,ie,Ue,ti):{u_fill_translate:ti};const ii=C.stencilModeForClipping(Xe);pt.draw(C.context,ce,T,ii,I,fn.backCCW,Me,bt,_t,g.id,et.layoutVertexBuffer,Pe,Ce,g.paint,C.transform.zoom,At)}}function Ga(C,s,g,x,T,I,O,z){const G=C.context,q=G.gl,J="fill-extrusion-pattern",re=g.paint.get(J),ie=re.constantOr(1),ce=g.getCrossfadeParameters(),_e=g.paint.get("fill-extrusion-opacity"),Me=re.constantOr(null),Pe=C.transform;for(const Ce of x){const Oe=s.getTile(Ce),We=Oe.getBucket(g);if(!We)continue;const ke=C.style.map.terrain&&C.style.map.terrain.getTerrainData(Ce),Ge=We.programConfigurations.get(g.id),Xe=C.useProgram(ie?"fillExtrusionPattern":"fillExtrusion",Ge);ie&&(C.context.activeTexture.set(q.TEXTURE0),Oe.imageAtlasTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE),Ge.updatePaintBuffers(ce));const Ue=Pe.getProjectionData({overscaledTileID:Ce,applyGlobeMatrix:!z,applyTerrainMatrix:!0});Il(Ge,J,Me,Oe,g);const et=l.aO(Pe,Oe,g.paint.get("fill-extrusion-translate"),g.paint.get("fill-extrusion-translate-anchor")),At=g.paint.get("fill-extrusion-vertical-gradient"),pt=ie?No(C,At,_e,et,Ce,ce,Oe):pn(C,At,_e,et);Xe.draw(G,G.gl.TRIANGLES,T,I,O,fn.backCCW,pt,ke,Ue,g.id,We.layoutVertexBuffer,We.indexBuffer,We.segments,g.paint,C.transform.zoom,Ge,C.style.map.terrain&&We.centroidVertexBuffer)}}function Dl(C,s,g,x,T,I,O,z,G){var q;const J=C.style.projection,re=C.context,ie=C.transform,ce=re.gl,_e=[`#define NUM_ILLUMINATION_SOURCES ${g.paint.get("hillshade-highlight-color").values.length}`],Me=C.useProgram("hillshade",null,!1,_e),Pe=!C.options.moving;for(const Ce of x){const Oe=s.getTile(Ce),We=Oe.fbo;if(!We)continue;const ke=J.getMeshFromTileID(re,Ce.canonical,z,!0,"raster"),Ge=(q=C.style.map.terrain)===null||q===void 0?void 0:q.getTerrainData(Ce);re.activeTexture.set(ce.TEXTURE0),ce.bindTexture(ce.TEXTURE_2D,We.colorAttachment.get());const Xe=ie.getProjectionData({overscaledTileID:Ce,aligned:Pe,applyGlobeMatrix:!G,applyTerrainMatrix:!0});Me.draw(re,ce.TRIANGLES,I,T[Ce.overscaledZ],O,fn.backCCW,sd(C,Oe,g),Ge,Xe,g.id,ke.vertexBuffer,ke.indexBuffer,ke.segments)}}function hc(C,s,g,x,T,I,O,z,G){var q;const J=C.style.projection,re=C.context,ie=C.transform,ce=re.gl,_e=C.useProgram("colorRelief"),Me=!C.options.moving;let Pe=!0,Ce=0;for(const Oe of x){const We=s.getTile(Oe),ke=We.dem;if(Pe){const pt=ce.getParameter(ce.MAX_TEXTURE_SIZE),{elevationTexture:bt,colorTexture:_t}=g.getColorRampTextures(re,pt,ke.getUnpackVector());re.activeTexture.set(ce.TEXTURE1),bt.bind(ce.NEAREST,ce.CLAMP_TO_EDGE),re.activeTexture.set(ce.TEXTURE4),_t.bind(ce.LINEAR,ce.CLAMP_TO_EDGE),Pe=!1,Ce=bt.size[0]}if(!ke||!ke.data)continue;const Ge=ke.stride,Xe=ke.getPixels();if(re.activeTexture.set(ce.TEXTURE0),re.pixelStoreUnpackPremultiplyAlpha.set(!1),We.demTexture=We.demTexture||C.getTileTexture(Ge),We.demTexture){const pt=We.demTexture;pt.update(Xe,{premultiply:!1}),pt.bind(ce.LINEAR,ce.CLAMP_TO_EDGE)}else We.demTexture=new l.T(re,Xe,ce.RGBA,{premultiply:!1}),We.demTexture.bind(ce.LINEAR,ce.CLAMP_TO_EDGE);const Ue=J.getMeshFromTileID(re,Oe.canonical,z,!0,"raster"),et=(q=C.style.map.terrain)===null||q===void 0?void 0:q.getTerrainData(Oe),At=ie.getProjectionData({overscaledTileID:Oe,aligned:Me,applyGlobeMatrix:!G,applyTerrainMatrix:!0});_e.draw(re,ce.TRIANGLES,I,T[Oe.overscaledZ],O,fn.backCCW,p0(g,We.dem,Ce),et,At,g.id,Ue.vertexBuffer,Ue.indexBuffer,Ue.segments)}}const fc=[new l.P(0,0),new l.P(l.a5,0),new l.P(l.a5,l.a5),new l.P(0,l.a5)];function zo(C,s,g,x,T,I,O,z,G=!1,q=!1){const J=x[x.length-1].overscaledZ,re=C.context,ie=re.gl,ce=C.useProgram("raster"),_e=C.transform,Me=C.style.projection,Pe=C.colorModeForRenderPass(),Ce=!C.options.moving,Oe=g.paint.get("raster-opacity"),We=g.paint.get("raster-resampling"),ke=g.paint.get("raster-fade-duration"),Ge=!!C.style.map.terrain;for(const Xe of x){const Ue=C.getDepthModeForSublayer(Xe.overscaledZ-J,Oe===1?Ki.ReadWrite:Ki.ReadOnly,ie.LESS),et=s.getTile(Xe),At=We==="nearest"?ie.NEAREST:ie.LINEAR;re.activeTexture.set(ie.TEXTURE0),et.texture.bind(At,ie.CLAMP_TO_EDGE,ie.LINEAR_MIPMAP_NEAREST),re.activeTexture.set(ie.TEXTURE1);const{parentTile:pt,parentScaleBy:bt,parentTopLeft:_t,fadeValues:ti}=Lo(et,s,ke,Ge);et.fadeOpacity=ti.tileOpacity,pt?(pt.fadeOpacity=ti.parentTileOpacity,pt.texture.bind(At,ie.CLAMP_TO_EDGE,ie.LINEAR_MIPMAP_NEAREST)):et.texture.bind(At,ie.CLAMP_TO_EDGE,ie.LINEAR_MIPMAP_NEAREST),et.texture.useMipmap&&re.extTextureFilterAnisotropic&&C.transform.pitch>20&&ie.texParameterf(ie.TEXTURE_2D,re.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,re.extTextureFilterAnisotropicMax);const ii=C.style.map.terrain&&C.style.map.terrain.getTerrainData(Xe),Wt=_e.getProjectionData({overscaledTileID:Xe,aligned:Ce,applyGlobeMatrix:!q,applyTerrainMatrix:!0}),ri=od(_t,bt,ti.fadeMix,g,z),Ji=Me.getMeshFromTileID(re,Xe.canonical,I,O,"raster");ce.draw(re,ie.TRIANGLES,Ue,T?T[Xe.overscaledZ]:Mn.disabled,Pe,G?fn.frontCCW:fn.backCCW,ri,ii,Wt,g.id,Ji.vertexBuffer,Ji.indexBuffer,Ji.segments)}}function Lo(C,s,g,x){const T={parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:{tileOpacity:1,parentTileOpacity:1,fadeMix:{opacity:1,mix:0}}};if(g===0||x)return T;if(C.fadingParentID){const I=s.getLoadedTile(C.fadingParentID);if(!I)return T;const O=Math.pow(2,I.tileID.overscaledZ-C.tileID.overscaledZ),z=[C.tileID.canonical.x*O%1,C.tileID.canonical.y*O%1],G=(function(q,J,re){const ie=Ae(),ce=(ie-J.timeAdded)/re,_e=q.fadingDirection===He.Incoming,Me=l.an((ie-q.timeAdded)/re,0,1),Pe=l.an(1-ce,0,1),Ce=_e?Me:Pe;return{tileOpacity:Ce,parentTileOpacity:_e?Pe:Me,fadeMix:{opacity:1,mix:1-Ce}}})(C,I,g);return{parentTile:I,parentScaleBy:O,parentTopLeft:z,fadeValues:G}}if(C.selfFading){const I=(function(O,z){const G=(Ae()-O.timeAdded)/z,q=l.an(G,0,1);return{tileOpacity:q,fadeMix:{opacity:q,mix:0}}})(C,g);return{parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:I}}return T}const Ol=new l.bp(1,0,0,1),Fl=new l.bp(0,1,0,1),md=new l.bp(0,0,1,1),_d=new l.bp(1,0,1,1),go=new l.bp(0,1,1,1);function bh(C,s,g,x){ps(C,0,s+g/2,C.transform.width,g,x)}function dc(C,s,g,x){ps(C,s-g/2,0,g,C.transform.height,x)}function ps(C,s,g,x,T,I){const O=C.context,z=O.gl;z.enable(z.SCISSOR_TEST),z.scissor(s*C.pixelRatio,g*C.pixelRatio,x*C.pixelRatio,T*C.pixelRatio),O.clear({color:I}),z.disable(z.SCISSOR_TEST)}function Ef(C,s,g){const x=C.context,T=x.gl,I=C.useProgram("debug"),O=Ki.disabled,z=Mn.disabled,G=C.colorModeForRenderPass(),q="$debug",J=C.style.map.terrain&&C.style.map.terrain.getTerrainData(g);x.activeTexture.set(T.TEXTURE0);const re=s.getTileByID(g.key).latestRawTileData,ie=Math.floor((re&&re.byteLength||0)/1024),ce=s.getTile(g).tileSize,_e=512/Math.min(ce,512)*(g.overscaledZ/C.transform.zoom)*.5;let Me=g.canonical.toString();g.overscaledZ!==g.canonical.z&&(Me+=` => ${g.overscaledZ}`),(function(Ce,Oe){Ce.initDebugOverlayCanvas();const We=Ce.debugOverlayCanvas,ke=Ce.context.gl,Ge=Ce.debugOverlayCanvas.getContext("2d");Ge.clearRect(0,0,We.width,We.height),Ge.shadowColor="white",Ge.shadowBlur=2,Ge.lineWidth=1.5,Ge.strokeStyle="white",Ge.textBaseline="top",Ge.font="bold 36px Open Sans, sans-serif",Ge.fillText(Oe,5,5),Ge.strokeText(Oe,5,5),Ce.debugOverlayTexture.update(We),Ce.debugOverlayTexture.bind(ke.LINEAR,ke.CLAMP_TO_EDGE)})(C,`${Me} ${ie}kB`);const Pe=C.transform.getProjectionData({overscaledTileID:g,applyGlobeMatrix:!0,applyTerrainMatrix:!0});I.draw(x,T.TRIANGLES,O,z,$n.alphaBlended,fn.disabled,vf(l.bp.transparent,_e),null,Pe,q,C.debugBuffer,C.quadTriangleIndexBuffer,C.debugSegments),I.draw(x,T.LINE_STRIP,O,z,G,fn.disabled,vf(l.bp.red),J,Pe,q,C.debugBuffer,C.tileBorderIndexBuffer,C.debugSegments)}function yd(C,s,g,x){const{isRenderingGlobe:T}=x,I=C.context,O=I.gl,z=C.transform,G=C.colorModeForRenderPass(),q=C.getDepthModeFor3D(),J=C.useProgram("terrain");I.bindFramebuffer.set(null),I.viewport.set([0,0,C.width,C.height]);for(const re of g){const ie=s.getTerrainMesh(re.tileID),ce=C.renderToTexture.getTexture(re),_e=s.getTerrainData(re.tileID);I.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,ce.texture);const Me=s.getMeshFrameDelta(z.zoom),Pe=z.calculateFogMatrix(re.tileID.toUnwrapped()),Ce=Us(Me,Pe,C.style.sky,z.pitch,T),Oe=z.getProjectionData({overscaledTileID:re.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});J.draw(I,O.TRIANGLES,q,Mn.disabled,G,fn.backCCW,Ce,_e,Oe,"terrain",ie.vertexBuffer,ie.indexBuffer,ie.segments)}}function b0(C,s){if(!s.mesh){const g=new l.aW;g.emplaceBack(-1,-1),g.emplaceBack(1,-1),g.emplaceBack(1,1),g.emplaceBack(-1,1);const x=new l.aY;x.emplaceBack(0,1,2),x.emplaceBack(0,2,3),s.mesh=new Wn(C.createVertexBuffer(g,fs.members),C.createIndexBuffer(x),l.aX.simpleSegment(0,0,g.length,x.length))}return s.mesh}class Wp{constructor(s,g){this.context=new rl(s),this.transform=g,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:l.ar(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=vn.maxOverzooming+vn.maxUnderzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ps}resize(s,g,x){if(this.width=Math.floor(s*x),this.height=Math.floor(g*x),this.pixelRatio=x,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const T of this.style._order)this.style._layers[T].resize()}setup(){const s=this.context,g=new l.aW;g.emplaceBack(0,0),g.emplaceBack(l.a5,0),g.emplaceBack(0,l.a5),g.emplaceBack(l.a5,l.a5),this.tileExtentBuffer=s.createVertexBuffer(g,fs.members),this.tileExtentSegments=l.aX.simpleSegment(0,0,4,2);const x=new l.aW;x.emplaceBack(0,0),x.emplaceBack(l.a5,0),x.emplaceBack(0,l.a5),x.emplaceBack(l.a5,l.a5),this.debugBuffer=s.createVertexBuffer(x,fs.members),this.debugSegments=l.aX.simpleSegment(0,0,4,5);const T=new l.ch;T.emplaceBack(0,0,0,0),T.emplaceBack(l.a5,0,l.a5,0),T.emplaceBack(0,l.a5,0,l.a5),T.emplaceBack(l.a5,l.a5,l.a5,l.a5),this.rasterBoundsBuffer=s.createVertexBuffer(T,or.members),this.rasterBoundsSegments=l.aX.simpleSegment(0,0,4,2);const I=new l.aW;I.emplaceBack(0,0),I.emplaceBack(l.a5,0),I.emplaceBack(0,l.a5),I.emplaceBack(l.a5,l.a5),this.rasterBoundsBufferPosOnly=s.createVertexBuffer(I,fs.members),this.rasterBoundsSegmentsPosOnly=l.aX.simpleSegment(0,0,4,5);const O=new l.aW;O.emplaceBack(0,0),O.emplaceBack(1,0),O.emplaceBack(0,1),O.emplaceBack(1,1),this.viewportBuffer=s.createVertexBuffer(O,fs.members),this.viewportSegments=l.aX.simpleSegment(0,0,4,2);const z=new l.ci;z.emplaceBack(0),z.emplaceBack(1),z.emplaceBack(3),z.emplaceBack(2),z.emplaceBack(0),this.tileBorderIndexBuffer=s.createIndexBuffer(z);const G=new l.aY;G.emplaceBack(1,0,2),G.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=s.createIndexBuffer(G);const q=this.context.gl;this.stencilClearMode=new Mn({func:q.ALWAYS,mask:0},0,255,q.ZERO,q.ZERO,q.ZERO),this.tileExtentMesh=new Wn(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const s=this.context,g=s.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const x=l.N();l.c7(x,0,this.width,this.height,0,0,1),l.Q(x,x,[g.drawingBufferWidth,g.drawingBufferHeight,0]);const T={mainMatrix:x,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:x};this.useProgram("clippingMask",null,!0).draw(s,g.TRIANGLES,Ki.disabled,this.stencilClearMode,$n.disabled,fn.disabled,null,null,T,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(s,g,x){if(this.currentStencilSource===s.source||!s.isTileClipped()||!g||!g.length)return;this.currentStencilSource=s.source,this.nextStencilID+g.length>256&&this.clearStencil();const T=this.context;T.setColorMode($n.disabled),T.setDepthMode(Ki.disabled);const I={};for(const O of g)I[O.key]=this.nextStencilID++;this._renderTileMasks(I,g,x,!0),this._renderTileMasks(I,g,x,!1),this._tileClippingMaskIDs=I}_renderTileMasks(s,g,x,T){const I=this.context,O=I.gl,z=this.style.projection,G=this.transform,q=this.useProgram("clippingMask");for(const J of g){const re=s[J.key],ie=this.style.map.terrain&&this.style.map.terrain.getTerrainData(J),ce=z.getMeshFromTileID(this.context,J.canonical,T,!0,"stencil"),_e=G.getProjectionData({overscaledTileID:J,applyGlobeMatrix:!x,applyTerrainMatrix:!0});q.draw(I,O.TRIANGLES,Ki.disabled,new Mn({func:O.ALWAYS,mask:0},re,255,O.KEEP,O.KEEP,O.REPLACE),$n.disabled,x?fn.disabled:fn.backCCW,null,ie,_e,"$clipping",ce.vertexBuffer,ce.indexBuffer,ce.segments)}}_renderTilesDepthBuffer(){const s=this.context,g=s.gl,x=this.style.projection,T=this.transform,I=this.useProgram("depth"),O=this.getDepthModeFor3D(),z=er(T,{tileSize:T.tileSize});for(const G of z){const q=this.style.map.terrain&&this.style.map.terrain.getTerrainData(G),J=x.getMeshFromTileID(this.context,G.canonical,!0,!0,"raster"),re=T.getProjectionData({overscaledTileID:G,applyGlobeMatrix:!0,applyTerrainMatrix:!0});I.draw(s,g.TRIANGLES,O,Mn.disabled,$n.disabled,fn.backCCW,null,q,re,"$clipping",J.vertexBuffer,J.indexBuffer,J.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const s=this.nextStencilID++,g=this.context.gl;return new Mn({func:g.NOTEQUAL,mask:255},s,255,g.KEEP,g.KEEP,g.REPLACE)}stencilModeForClipping(s){const g=this.context.gl;return new Mn({func:g.EQUAL,mask:255},this._tileClippingMaskIDs[s.key],0,g.KEEP,g.KEEP,g.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(s){const g=this.context.gl,x=s.sort(((O,z)=>z.overscaledZ-O.overscaledZ)),T=x[x.length-1].overscaledZ,I=x[0].overscaledZ-T+1;if(I>1){this.currentStencilSource=void 0,this.nextStencilID+I>256&&this.clearStencil();const O={};for(let z=0;z<I;z++)O[z+T]=new Mn({func:g.GEQUAL,mask:255},z+this.nextStencilID,255,g.KEEP,g.KEEP,g.REPLACE);return this.nextStencilID+=I,[O,x]}return[{[T]:Mn.disabled},x]}stencilConfigForOverlapTwoPass(s){const g=this.context.gl,x=s.sort(((O,z)=>z.overscaledZ-O.overscaledZ)),T=x[x.length-1].overscaledZ,I=x[0].overscaledZ-T+1;if(this.clearStencil(),I>1){const O={},z={};for(let G=0;G<I;G++)O[G+T]=new Mn({func:g.GREATER,mask:255},I+1+G,255,g.KEEP,g.KEEP,g.REPLACE),z[G+T]=new Mn({func:g.GREATER,mask:255},1+G,255,g.KEEP,g.KEEP,g.REPLACE);return this.nextStencilID=2*I+1,[O,z,x]}return this.nextStencilID=3,[{[T]:new Mn({func:g.GREATER,mask:255},2,255,g.KEEP,g.KEEP,g.REPLACE)},{[T]:new Mn({func:g.GREATER,mask:255},1,255,g.KEEP,g.KEEP,g.REPLACE)},x]}colorModeForRenderPass(){const s=this.context.gl;return this._showOverdrawInspector?new $n([s.CONSTANT_COLOR,s.ONE],new l.bp(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?$n.unblended:$n.alphaBlended}getDepthModeForSublayer(s,g,x){if(!this.opaquePassEnabledForLayer())return Ki.disabled;const T=1-((1+this.currentLayer)*this.numSublayers+s)*this.depthEpsilon;return new Ki(x||this.context.gl.LEQUAL,g,[T,T])}getDepthModeFor3D(){return new Ki(this.context.gl.LEQUAL,Ki.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(s,g){var x,T;this.style=s,this.options=g,this.lineAtlas=s.lineAtlas,this.imageManager=s.imageManager,this.glyphManager=s.glyphManager,this.symbolFadeChange=s.placement.symbolFadeChange(Ae()),this.imageManager.beginFrame();const I=this.style._order,O=this.style.tileManagers,z={},G={},q={},J={isRenderingToTexture:!1,isRenderingGlobe:((x=s.projection)===null||x===void 0?void 0:x.transitionState)>0};for(const ie in O){const ce=O[ie];ce.used&&ce.prepare(this.context),z[ie]=ce.getVisibleCoordinates(!1),G[ie]=z[ie].slice().reverse(),q[ie]=ce.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let ie=0;ie<I.length;ie++)if(this.style._layers[I[ie]].is3D()){this.opaquePassCutoff=ie;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const ie of I){const ce=this.style._layers[ie];if(!ce.hasOffscreenPass()||ce.isHidden(this.transform.zoom))continue;const _e=G[ce.source];(ce.type==="custom"||_e.length)&&this.renderLayer(this,O[ce.source],ce,_e,J)}if((T=this.style.projection)===null||T===void 0||T.updateGPUdependent({context:this.context,useProgram:ie=>this.useProgram(ie)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:g.showOverdrawInspector?l.bp.black:l.bp.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(ie,ce){const _e=ie.context,Me=_e.gl,Pe=((Xe,Ue,et)=>{const At=Math.cos(Ue.rollInRadians),pt=Math.sin(Ue.rollInRadians),bt=Pt(Ue),_t=Ue.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:Xe.properties.get("sky-color"),u_horizon_color:Xe.properties.get("horizon-color"),u_horizon:[(Ue.width/2-bt*pt)*et,(Ue.height/2+bt*At)*et],u_horizon_normal:[-pt,At],u_sky_horizon_blend:Xe.properties.get("sky-horizon-blend")*Ue.height/2*et,u_sky_blend:_t}})(ce,ie.style.map.transform,ie.pixelRatio),Ce=new Ki(Me.LEQUAL,Ki.ReadWrite,[0,1]),Oe=Mn.disabled,We=ie.colorModeForRenderPass(),ke=ie.useProgram("sky"),Ge=b0(_e,ce);ke.draw(_e,Me.TRIANGLES,Ce,Oe,We,fn.disabled,Pe,null,void 0,"sky",Ge.vertexBuffer,Ge.indexBuffer,Ge.segments)})(this,this.style.sky),this._showOverdrawInspector=g.showOverdrawInspector,this.depthRangeFor3D=[0,1-(s._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=I.length-1;this.currentLayer>=0;this.currentLayer--){const ie=this.style._layers[I[this.currentLayer]],ce=O[ie.source],_e=z[ie.source];this._renderTileClippingMasks(ie,_e,!1),this.renderLayer(this,ce,ie,_e,J)}this.renderPass="translucent";let re=!1;for(this.currentLayer=0;this.currentLayer<I.length;this.currentLayer++){const ie=this.style._layers[I[this.currentLayer]],ce=O[ie.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(ie,J))continue;this.opaquePassEnabledForLayer()||re||(re=!0,J.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const _e=(ie.type==="symbol"?q:G)[ie.source];this._renderTileClippingMasks(ie,z[ie.source],!!this.renderToTexture),this.renderLayer(this,ce,ie,_e,J)}if(J.isRenderingGlobe&&(function(ie,ce,_e){const Me=ie.context,Pe=Me.gl,Ce=ie.useProgram("atmosphere"),Oe=new Ki(Pe.LEQUAL,Ki.ReadOnly,[0,1]),We=ie.transform,ke=(function(_t,ti){const ii=_t.properties.get("position"),Wt=[-ii.x,-ii.y,-ii.z],ri=l.ar(new Float64Array(16));return _t.properties.get("anchor")==="map"&&(l.bg(ri,ri,ti.rollInRadians),l.bh(ri,ri,-ti.pitchInRadians),l.bg(ri,ri,ti.bearingInRadians),l.bh(ri,ri,ti.center.lat*Math.PI/180),l.bJ(ri,ri,-ti.center.lng*Math.PI/180)),l.cg(Wt,Wt,ri),Wt})(_e,ie.transform),Ge=We.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Xe=ce.properties.get("atmosphere-blend")*Ge.projectionTransition;if(Xe===0)return;const Ue=vu(We.worldSize,We.center.lat),et=We.inverseProjectionMatrix,At=new Float64Array(4);At[3]=1,l.aH(At,At,We.modelViewProjectionMatrix),At[0]/=At[3],At[1]/=At[3],At[2]/=At[3],At[3]=1,l.aH(At,At,et),At[0]/=At[3],At[1]/=At[3],At[2]/=At[3],At[3]=1;const pt=((_t,ti,ii,Wt,ri)=>({u_sun_pos:_t,u_atmosphere_blend:ti,u_globe_position:ii,u_globe_radius:Wt,u_inv_proj_matrix:ri}))(ke,Xe,[At[0],At[1],At[2]],Ue,et),bt=b0(Me,ce);Ce.draw(Me,Pe.TRIANGLES,Oe,Mn.disabled,$n.alphaBlended,fn.disabled,pt,null,null,"atmosphere",bt.vertexBuffer,bt.indexBuffer,bt.segments)})(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const ie=(function(ce,_e){let Me=null;const Pe=Object.values(ce._layers).flatMap((ke=>ke.source&&!ke.isHidden(_e)?[ce.tileManagers[ke.source]]:[])),Ce=Pe.filter((ke=>ke.getSource().type==="vector")),Oe=Pe.filter((ke=>ke.getSource().type!=="vector")),We=ke=>{(!Me||Me.getSource().maxzoom<ke.getSource().maxzoom)&&(Me=ke)};return Ce.forEach((ke=>We(ke))),Me||Oe.forEach((ke=>We(ke))),Me})(this.style,this.transform.zoom);ie&&(function(ce,_e,Me){for(let Pe=0;Pe<Me.length;Pe++)Ef(ce,_e,Me[Pe])})(this,ie,ie.getVisibleCoordinates())}this.options.showPadding&&(function(ie){const ce=ie.transform.padding;bh(ie,ie.transform.height-(ce.top||0),3,Ol),bh(ie,ce.bottom||0,3,Fl),dc(ie,ce.left||0,3,md),dc(ie,ie.transform.width-(ce.right||0),3,_d);const _e=ie.transform.centerPoint;(function(Me,Pe,Ce,Oe){ps(Me,Pe-1,Ce-10,2,20,Oe),ps(Me,Pe-10,Ce-1,20,2,Oe)})(ie,_e.x,ie.transform.height-_e.y,go)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(s){if(!this.style||!this.style.map||!this.style.map.terrain)return;const g=this.terrainFacilitator.matrix,x=this.transform.modelViewProjectionMatrix;let T=this.terrainFacilitator.dirty;T||(T=s?!l.cj(g,x):!l.ck(g,x)),T||(T=this.style.map.terrain.tileManager.anyTilesAfterTime(this.terrainFacilitator.renderTime)),T&&(l.cl(g,x),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(I,O){const z=I.context,G=z.gl,q=I.transform,J=$n.unblended,re=new Ki(G.LEQUAL,Ki.ReadWrite,[0,1]),ie=O.tileManager.getRenderableTiles(),ce=I.useProgram("terrainDepth");z.bindFramebuffer.set(O.getFramebuffer("depth").framebuffer),z.viewport.set([0,0,I.width/devicePixelRatio,I.height/devicePixelRatio]),z.clear({color:l.bp.transparent,depth:1});for(const _e of ie){const Me=O.getTerrainMesh(_e.tileID),Pe=O.getTerrainData(_e.tileID),Ce=q.getProjectionData({overscaledTileID:_e.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),Oe={u_ele_delta:O.getMeshFrameDelta(q.zoom)};ce.draw(z,G.TRIANGLES,re,Mn.disabled,J,fn.backCCW,Oe,Pe,Ce,"terrain",Me.vertexBuffer,Me.indexBuffer,Me.segments)}z.bindFramebuffer.set(null),z.viewport.set([0,0,I.width,I.height])})(this,this.style.map.terrain),(function(I,O){const z=I.context,G=z.gl,q=I.transform,J=$n.unblended,re=new Ki(G.LEQUAL,Ki.ReadWrite,[0,1]),ie=O.getCoordsTexture(),ce=O.tileManager.getRenderableTiles(),_e=I.useProgram("terrainCoords");z.bindFramebuffer.set(O.getFramebuffer("coords").framebuffer),z.viewport.set([0,0,I.width/devicePixelRatio,I.height/devicePixelRatio]),z.clear({color:l.bp.transparent,depth:1}),O.coordsIndex=[];for(const Me of ce){const Pe=O.getTerrainMesh(Me.tileID),Ce=O.getTerrainData(Me.tileID);z.activeTexture.set(G.TEXTURE0),G.bindTexture(G.TEXTURE_2D,ie.texture);const Oe={u_terrain_coords_id:(255-O.coordsIndex.length)/255,u_texture:0,u_ele_delta:O.getMeshFrameDelta(q.zoom)},We=q.getProjectionData({overscaledTileID:Me.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});_e.draw(z,G.TRIANGLES,re,Mn.disabled,J,fn.backCCW,Oe,Ce,We,"terrain",Pe.vertexBuffer,Pe.indexBuffer,Pe.segments),O.coordsIndex.push(Me.tileID.key)}z.bindFramebuffer.set(null),z.viewport.set([0,0,I.width,I.height])})(this,this.style.map.terrain))}renderLayer(s,g,x,T,I){x.isHidden(this.transform.zoom)||(x.type==="background"||x.type==="custom"||(T||[]).length)&&(this.id=x.id,l.cm(x)?(function(O,z,G,q,J,re){if(O.renderPass!=="translucent")return;const{isRenderingToTexture:ie}=re,ce=Mn.disabled,_e=O.colorModeForRenderPass();(G._unevaluatedLayout.hasValue("text-variable-anchor")||G._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(Me,Pe,Ce,Oe,We,ke,Ge,Xe,Ue){const et=Pe.transform,At=Pe.style.map.terrain,pt=We==="map",bt=ke==="map";for(const _t of Me){const ti=Oe.getTile(_t),ii=ti.getBucket(Ce);if(!ii||!ii.text||!ii.text.segments.get().length)continue;const Wt=l.ay(ii.textSizeData,et.zoom),ri=l.aN(ti,1,Pe.transform.zoom),Ji=ba(pt,Pe.transform,ri),sn=Ce.layout.get("icon-text-fit")!=="none"&&ii.hasIconData();if(Wt){const rr=Math.pow(2,et.zoom-ti.tileID.overscaledZ),sr=At?(yr,qn)=>At.getElevation(_t,yr,qn):null;Ia(ii,pt,bt,Ue,et,Ji,rr,Wt,sn,l.aO(et,ti,Ge,Xe),_t.toUnwrapped(),sr)}}})(q,O,G,z,G.layout.get("text-rotation-alignment"),G.layout.get("text-pitch-alignment"),G.paint.get("text-translate"),G.paint.get("text-translate-anchor"),J),G.paint.get("icon-opacity").constantOr(1)!==0&&Cu(O,z,G,q,!1,G.paint.get("icon-translate"),G.paint.get("icon-translate-anchor"),G.layout.get("icon-rotation-alignment"),G.layout.get("icon-pitch-alignment"),G.layout.get("icon-keep-upright"),ce,_e,ie),G.paint.get("text-opacity").constantOr(1)!==0&&Cu(O,z,G,q,!0,G.paint.get("text-translate"),G.paint.get("text-translate-anchor"),G.layout.get("text-rotation-alignment"),G.layout.get("text-pitch-alignment"),G.layout.get("text-keep-upright"),ce,_e,ie),z.map.showCollisionBoxes&&(Vs(O,z,G,q,!0),Vs(O,z,G,q,!1))})(s,g,x,T,this.style.placement.variableOffsets,I):l.cn(x)?(function(O,z,G,q,J){if(O.renderPass!=="translucent")return;const{isRenderingToTexture:re}=J,ie=G.paint.get("circle-opacity"),ce=G.paint.get("circle-stroke-width"),_e=G.paint.get("circle-stroke-opacity"),Me=!G.layout.get("circle-sort-key").isConstant();if(ie.constantOr(1)===0&&(ce.constantOr(1)===0||_e.constantOr(1)===0))return;const Pe=O.context,Ce=Pe.gl,Oe=O.transform,We=O.getDepthModeForSublayer(0,Ki.ReadOnly),ke=Mn.disabled,Ge=O.colorModeForRenderPass(),Xe=[],Ue=Oe.getCircleRadiusCorrection();for(let et=0;et<q.length;et++){const At=q[et],pt=z.getTile(At),bt=pt.getBucket(G);if(!bt)continue;const _t=G.paint.get("circle-translate"),ti=G.paint.get("circle-translate-anchor"),ii=l.aO(Oe,pt,_t,ti),Wt=bt.programConfigurations.get(G.id),ri=O.useProgram("circle",Wt),Ji=bt.layoutVertexBuffer,sn=bt.indexBuffer,rr=O.style.map.terrain&&O.style.map.terrain.getTerrainData(At),sr={programConfiguration:Wt,program:ri,layoutVertexBuffer:Ji,indexBuffer:sn,uniformValues:Zn(O,pt,G,ii,Ue),terrainData:rr,projectionData:Oe.getProjectionData({overscaledTileID:At,applyGlobeMatrix:!re,applyTerrainMatrix:!0})};if(Me){const yr=bt.segments.get();for(const qn of yr)Xe.push({segments:new l.aX([qn]),sortKey:qn.sortKey,state:sr})}else Xe.push({segments:bt.segments,sortKey:0,state:sr})}Me&&Xe.sort(((et,At)=>et.sortKey-At.sortKey));for(const et of Xe){const{programConfiguration:At,program:pt,layoutVertexBuffer:bt,indexBuffer:_t,uniformValues:ti,terrainData:ii,projectionData:Wt}=et.state;pt.draw(Pe,Ce.TRIANGLES,We,ke,Ge,fn.backCCW,ti,ii,Wt,G.id,bt,_t,et.segments,G.paint,O.transform.zoom,At)}})(s,g,x,T,I):l.co(x)?(function(O,z,G,q,J){if(G.paint.get("heatmap-opacity")===0)return;const re=O.context,{isRenderingToTexture:ie,isRenderingGlobe:ce}=J;if(O.style.map.terrain){for(const _e of q){const Me=z.getTile(_e);z.hasRenderableParent(_e)||(O.renderPass==="offscreen"?x0(O,Me,G,_e,ce):O.renderPass==="translucent"&&js(O,G,_e,ie,ce))}re.viewport.set([0,0,O.width,O.height])}else O.renderPass==="offscreen"?(function(_e,Me,Pe,Ce){const Oe=_e.context,We=Oe.gl,ke=_e.transform,Ge=Mn.disabled,Xe=new $n([We.ONE,We.ONE],l.bp.transparent,[!0,!0,!0,!0]);(function(Ue,et,At){const pt=Ue.gl;Ue.activeTexture.set(pt.TEXTURE1),Ue.viewport.set([0,0,et.width/4,et.height/4]);let bt=At.heatmapFbos.get(l.cd);bt?(pt.bindTexture(pt.TEXTURE_2D,bt.colorAttachment.get()),Ue.bindFramebuffer.set(bt.framebuffer)):(bt=nr(Ue,et.width/4,et.height/4),At.heatmapFbos.set(l.cd,bt))})(Oe,_e,Pe),Oe.clear({color:l.bp.transparent});for(let Ue=0;Ue<Ce.length;Ue++){const et=Ce[Ue];if(Me.hasRenderableParent(et))continue;const At=Me.getTile(et),pt=At.getBucket(Pe);if(!pt)continue;const bt=pt.programConfigurations.get(Pe.id),_t=_e.useProgram("heatmap",bt),ti=ke.getProjectionData({overscaledTileID:et,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),ii=ke.getCircleRadiusCorrection();_t.draw(Oe,We.TRIANGLES,Ki.disabled,Ge,Xe,fn.backCCW,Au(At,ke.zoom,Pe.paint.get("heatmap-intensity"),ii),null,ti,Pe.id,pt.layoutVertexBuffer,pt.indexBuffer,pt.segments,Pe.paint,ke.zoom,bt)}Oe.viewport.set([0,0,_e.width,_e.height])})(O,z,G,q):O.renderPass==="translucent"&&(function(_e,Me){const Pe=_e.context,Ce=Pe.gl;Pe.setColorMode(_e.colorModeForRenderPass());const Oe=Me.heatmapFbos.get(l.cd);Oe&&(Pe.activeTexture.set(Ce.TEXTURE0),Ce.bindTexture(Ce.TEXTURE_2D,Oe.colorAttachment.get()),Pe.activeTexture.set(Ce.TEXTURE1),bn(Pe,Me).bind(Ce.LINEAR,Ce.CLAMP_TO_EDGE),_e.useProgram("heatmapTexture").draw(Pe,Ce.TRIANGLES,Ki.disabled,Mn.disabled,_e.colorModeForRenderPass(),fn.disabled,zp(_e,Me,0,1),null,null,Me.id,_e.viewportBuffer,_e.quadTriangleIndexBuffer,_e.viewportSegments,Me.paint,_e.transform.zoom))})(O,G)})(s,g,x,T,I):l.cp(x)?(function(O,z,G,q,J){if(O.renderPass!=="translucent")return;const{isRenderingToTexture:re}=J,ie=G.paint.get("line-opacity"),ce=G.paint.get("line-width");if(ie.constantOr(1)===0||ce.constantOr(1)===0)return;const _e=O.getDepthModeForSublayer(0,Ki.ReadOnly),Me=O.colorModeForRenderPass(),Pe=G.paint.get("line-dasharray"),Ce=Pe.constantOr(1),Oe=G.paint.get("line-pattern"),We=Oe.constantOr(1),ke=G.paint.get("line-gradient"),Ge=G.getCrossfadeParameters();let Xe;Xe=We?"linePattern":Ce&&ke?"lineGradientSDF":Ce?"lineSDF":ke?"lineGradient":"line";const Ue=O.context,et=Ue.gl,At=O.transform;let pt=!0;for(const bt of q){const _t=z.getTile(bt);if(We&&!_t.patternsLoaded())continue;const ti=_t.getBucket(G);if(!ti)continue;const ii=ti.programConfigurations.get(G.id),Wt=O.context.program.get(),ri=O.useProgram(Xe,ii),Ji=pt||ri.program!==Wt,sn=O.style.map.terrain&&O.style.map.terrain.getTerrainData(bt),rr=Oe.constantOr(null),sr=Pe&&Pe.constantOr(null);if(rr&&_t.imageAtlas){const Gs=_t.imageAtlas,Xr=Gs.patternPositions[rr.to.toString()],jn=Gs.patternPositions[rr.from.toString()];Xr&&jn&&ii.setConstantPatternPositions(Xr,jn)}else if(sr){const Gs=G.layout.get("line-cap")==="round",Xr=O.lineAtlas.getDash(sr.to,Gs),jn=O.lineAtlas.getDash(sr.from,Gs);ii.setConstantDashPositions(Xr,jn)}const yr=At.getProjectionData({overscaledTileID:bt,applyGlobeMatrix:!re,applyTerrainMatrix:!0}),qn=At.getPixelScale();let zr;We?(zr=ad(O,_t,G,qn,Ge),po(Ue,et,_t,ii,Ge)):Ce&&ke?(zr=ks(O,_t,G,qn,Ge,ti.lineClipsArray.length),ja(O,z,Ue,et,G,ti,bt,ii,Ge)):Ce?(zr=ns(O,_t,G,qn,Ge),Fr(O,Ue,et,ii,Ji,Ge)):ke?(zr=Vp(O,_t,G,qn,ti.lineClipsArray.length),Va(O,z,Ue,et,G,ti,bt)):zr=Sl(O,_t,G,qn);const vr=O.stencilModeForClipping(bt);ri.draw(Ue,et.TRIANGLES,_e,vr,Me,fn.disabled,zr,sn,yr,G.id,ti.layoutVertexBuffer,ti.indexBuffer,ti.segments,G.paint,O.transform.zoom,ii,ti.layoutVertexBuffer2),pt=!1}})(s,g,x,T,I):l.cq(x)?(function(O,z,G,q,J){const re=G.paint.get("fill-color"),ie=G.paint.get("fill-opacity");if(ie.constantOr(1)===0)return;const{isRenderingToTexture:ce}=J,_e=O.colorModeForRenderPass(),Me=G.paint.get("fill-pattern"),Pe=O.opaquePassEnabledForLayer()&&!Me.constantOr(1)&&re.constantOr(l.bp.transparent).a===1&&ie.constantOr(0)===1?"opaque":"translucent";if(O.renderPass===Pe){const Ce=O.getDepthModeForSublayer(1,O.renderPass==="opaque"?Ki.ReadWrite:Ki.ReadOnly);kl(O,z,G,q,Ce,_e,!1,ce)}if(O.renderPass==="translucent"&&G.paint.get("fill-antialias")){const Ce=O.getDepthModeForSublayer(G.getPaintProperty("fill-outline-color")?2:0,Ki.ReadOnly);kl(O,z,G,q,Ce,_e,!0,ce)}})(s,g,x,T,I):l.cr(x)?(function(O,z,G,q,J){const re=G.paint.get("fill-extrusion-opacity");if(re===0)return;const{isRenderingToTexture:ie}=J;if(O.renderPass==="translucent"){const ce=new Ki(O.context.gl.LEQUAL,Ki.ReadWrite,O.depthRangeFor3D);if(re!==1||G.paint.get("fill-extrusion-pattern").constantOr(1))Ga(O,z,G,q,ce,Mn.disabled,$n.disabled,ie),Ga(O,z,G,q,ce,O.stencilModeFor3D(),O.colorModeForRenderPass(),ie);else{const _e=O.colorModeForRenderPass();Ga(O,z,G,q,ce,Mn.disabled,_e,ie)}}})(s,g,x,T,I):l.cs(x)?(function(O,z,G,q,J){if(O.renderPass!=="offscreen"&&O.renderPass!=="translucent")return;const{isRenderingToTexture:re}=J,ie=O.context,ce=O.style.projection.useSubdivision,_e=O.getDepthModeForSublayer(0,Ki.ReadOnly),Me=O.colorModeForRenderPass();if(O.renderPass==="offscreen")(function(Pe,Ce,Oe,We,ke,Ge,Xe){const Ue=Pe.context,et=Ue.gl;for(const At of Oe){const pt=Ce.getTile(At),bt=pt.dem;if(!bt||!bt.data||!pt.needsHillshadePrepare)continue;const _t=bt.dim,ti=bt.stride,ii=bt.getPixels();if(Ue.activeTexture.set(et.TEXTURE1),Ue.pixelStoreUnpackPremultiplyAlpha.set(!1),pt.demTexture=pt.demTexture||Pe.getTileTexture(ti),pt.demTexture){const ri=pt.demTexture;ri.update(ii,{premultiply:!1}),ri.bind(et.NEAREST,et.CLAMP_TO_EDGE)}else pt.demTexture=new l.T(Ue,ii,et.RGBA,{premultiply:!1}),pt.demTexture.bind(et.NEAREST,et.CLAMP_TO_EDGE);Ue.activeTexture.set(et.TEXTURE0);let Wt=pt.fbo;if(!Wt){const ri=new l.T(Ue,{width:_t,height:_t,data:null},et.RGBA);ri.bind(et.LINEAR,et.CLAMP_TO_EDGE),Wt=pt.fbo=Ue.createFramebuffer(_t,_t,!0,!1),Wt.colorAttachment.set(ri.texture)}Ue.bindFramebuffer.set(Wt.framebuffer),Ue.viewport.set([0,0,_t,_t]),Pe.useProgram("hillshadePrepare").draw(Ue,et.TRIANGLES,ke,Ge,Xe,fn.disabled,Lp(pt.tileID,bt),null,null,We.id,Pe.rasterBoundsBuffer,Pe.quadTriangleIndexBuffer,Pe.rasterBoundsSegments),pt.needsHillshadePrepare=!1}})(O,z,q,G,_e,Mn.disabled,Me),ie.viewport.set([0,0,O.width,O.height]);else if(O.renderPass==="translucent")if(ce){const[Pe,Ce,Oe]=O.stencilConfigForOverlapTwoPass(q);Dl(O,z,G,Oe,Pe,_e,Me,!1,re),Dl(O,z,G,Oe,Ce,_e,Me,!0,re)}else{const[Pe,Ce]=O.getStencilConfigForOverlapAndUpdateStencilID(q);Dl(O,z,G,Ce,Pe,_e,Me,!1,re)}})(s,g,x,T,I):l.ct(x)?(function(O,z,G,q,J){if(O.renderPass!=="translucent"||!q.length)return;const{isRenderingToTexture:re}=J,ie=O.style.projection.useSubdivision,ce=O.getDepthModeForSublayer(0,Ki.ReadOnly),_e=O.colorModeForRenderPass();if(ie){const[Me,Pe,Ce]=O.stencilConfigForOverlapTwoPass(q);hc(O,z,G,Ce,Me,ce,_e,!1,re),hc(O,z,G,Ce,Pe,ce,_e,!0,re)}else{const[Me,Pe]=O.getStencilConfigForOverlapAndUpdateStencilID(q);hc(O,z,G,Pe,Me,ce,_e,!1,re)}})(s,g,x,T,I):l.bU(x)?(function(O,z,G,q,J){if(O.renderPass!=="translucent"||G.paint.get("raster-opacity")===0||!q.length)return;const{isRenderingToTexture:re}=J,ie=z.getSource(),ce=O.style.projection.useSubdivision;if(ie instanceof ao)zo(O,z,G,q,null,!1,!1,ie.tileCoords,ie.flippedWindingOrder,re);else if(ce){const[_e,Me,Pe]=O.stencilConfigForOverlapTwoPass(q);zo(O,z,G,Pe,_e,!1,!0,fc,!1,re),zo(O,z,G,Pe,Me,!0,!0,fc,!1,re)}else{const[_e,Me]=O.getStencilConfigForOverlapAndUpdateStencilID(q);zo(O,z,G,Me,_e,!1,!0,fc,!1,re)}})(s,g,x,T,I):l.cu(x)?(function(O,z,G,q,J){const re=G.paint.get("background-color"),ie=G.paint.get("background-opacity");if(ie===0)return;const{isRenderingToTexture:ce}=J,_e=O.context,Me=_e.gl,Pe=O.style.projection,Ce=O.transform,Oe=Ce.tileSize,We=G.paint.get("background-pattern");if(O.isPatternMissing(We))return;const ke=!We&&re.a===1&&ie===1&&O.opaquePassEnabledForLayer()?"opaque":"translucent";if(O.renderPass!==ke)return;const Ge=Mn.disabled,Xe=O.getDepthModeForSublayer(0,ke==="opaque"?Ki.ReadWrite:Ki.ReadOnly),Ue=O.colorModeForRenderPass(),et=O.useProgram(We?"backgroundPattern":"background"),At=q||er(Ce,{tileSize:Oe,terrain:O.style.map.terrain});We&&(_e.activeTexture.set(Me.TEXTURE0),O.imageManager.bind(O.context));const pt=G.getCrossfadeParameters();for(const bt of At){const _t=Ce.getProjectionData({overscaledTileID:bt,applyGlobeMatrix:!ce,applyTerrainMatrix:!0}),ti=We?bf(ie,O,We,{tileID:bt,tileSize:Oe},pt):xf(ie,re),ii=O.style.map.terrain&&O.style.map.terrain.getTerrainData(bt),Wt=Pe.getMeshFromTileID(_e,bt.canonical,!1,!0,"raster");et.draw(_e,Me.TRIANGLES,Xe,Ge,Ue,fn.backCCW,ti,ii,_t,G.id,Wt.vertexBuffer,Wt.indexBuffer,Wt.segments)}})(s,0,x,T,I):l.cv(x)&&(function(O,z,G,q){const{isRenderingGlobe:J}=q,re=O.context,ie=G.implementation,ce=O.style.projection,_e=O.transform,Me=_e.getProjectionDataForCustomLayer(J),Pe={farZ:_e.farZ,nearZ:_e.nearZ,fov:_e.fov*Math.PI/180,modelViewProjectionMatrix:_e.modelViewProjectionMatrix,projectionMatrix:_e.projectionMatrix,shaderData:{variantName:ce.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${ce.shaderPreludeCode.vertexSource}`,define:ce.shaderDefine},defaultProjectionData:Me},Ce=ie.renderingMode?ie.renderingMode:"2d";if(O.renderPass==="offscreen"){const Oe=ie.prerender;Oe&&(O.setCustomLayerDefaults(),re.setColorMode(O.colorModeForRenderPass()),Oe.call(ie,re.gl,Pe),re.setDirty(),O.setBaseState())}else if(O.renderPass==="translucent"){O.setCustomLayerDefaults(),re.setColorMode(O.colorModeForRenderPass()),re.setStencilMode(Mn.disabled);const Oe=Ce==="3d"?O.getDepthModeFor3D():O.getDepthModeForSublayer(0,Ki.ReadOnly);re.setDepthMode(Oe),ie.render(re.gl,Pe),re.setDirty(),O.setBaseState(),re.bindFramebuffer.set(null)}})(s,0,x,I))}saveTileTexture(s){const g=this._tileTextures[s.size[0]];g?g.push(s):this._tileTextures[s.size[0]]=[s]}getTileTexture(s){const g=this._tileTextures[s];return g&&g.length>0?g.pop():null}isPatternMissing(s){if(!s)return!1;if(!s.from||!s.to)return!0;const g=this.imageManager.getPattern(s.from.toString()),x=this.imageManager.getPattern(s.to.toString());return!g||!x}useProgram(s,g,x=!1,T=[]){this.cache=this.cache||{};const I=!!this.style.map.terrain,O=this.style.projection,z=x?wr.projectionMercator:O.shaderPreludeCode,G=x?kr:O.shaderDefine,q=s+(g?g.cacheKey:"")+`/${x?Ta:O.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(I?"/terrain":"")+(T?`/${T.join("/")}`:"");return this.cache[q]||(this.cache[q]=new jc(this.context,wr[s],g,m0[s],this._showOverdrawInspector,I,z,G,T)),this.cache[q]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const s=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(s.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new l.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){var s,g;if(this._tileTextures){for(const x in this._tileTextures){const T=this._tileTextures[x];if(T)for(const I of T)I.destroy()}this._tileTextures={}}if(this.tileExtentBuffer&&this.tileExtentBuffer.destroy(),this.debugBuffer&&this.debugBuffer.destroy(),this.rasterBoundsBuffer&&this.rasterBoundsBuffer.destroy(),this.rasterBoundsBufferPosOnly&&this.rasterBoundsBufferPosOnly.destroy(),this.viewportBuffer&&this.viewportBuffer.destroy(),this.tileBorderIndexBuffer&&this.tileBorderIndexBuffer.destroy(),this.quadTriangleIndexBuffer&&this.quadTriangleIndexBuffer.destroy(),this.tileExtentMesh&&((s=this.tileExtentMesh.vertexBuffer)===null||s===void 0||s.destroy()),this.tileExtentMesh&&((g=this.tileExtentMesh.indexBuffer)===null||g===void 0||g.destroy()),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.cache){for(const x in this.cache){const T=this.cache[x];T&&T.program&&this.context.gl.deleteProgram(T.program)}this.cache={}}this.context&&this.context.setDefault()}overLimit(){const{drawingBufferWidth:s,drawingBufferHeight:g}=this.context.gl;return this.width!==s||this.height!==g}}function A0(C,s){let g,x=!1,T=null,I=null;const O=()=>{T=null,x&&(C.apply(I,g),T=setTimeout(O,s),x=!1)};return(...z)=>(x=!0,I=this,g=z,T||O(),T)}class rs{constructor(s){this._getCurrentHash=()=>{const g=window.location.hash.replace("#","");if(this._hashName){let x;return g.split("&").map((T=>T.split("="))).forEach((T=>{T[0]===this._hashName&&(x=T)})),(x&&x[1]||"").split("/")}return g.split("/")},this._onHashChange=()=>{const g=this._getCurrentHash();if(!this._isValidHash(g))return!1;const x=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(g[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+g[2],+g[1]],zoom:+g[0],bearing:x,pitch:+(g[4]||0)}),!0},this._updateHashUnthrottled=()=>{const g=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,g)},this._removeHash=()=>{const g=this._getCurrentHash();if(g.length===0)return;const x=g.join("/");let T=x;T.split("&").length>0&&(T=T.split("&")[0]),this._hashName&&(T=`${this._hashName}=${x}`);let I=window.location.hash.replace(T,"");I.startsWith("#&")?I=I.slice(0,1)+I.slice(2):I==="#"&&(I="");let O=window.location.href.replace(/(#.+)?$/,I);O=O.replace("&&","&"),window.history.replaceState(window.history.state,null,O)},this._updateHash=A0(this._updateHashUnthrottled,300),this._hashName=s&&encodeURIComponent(s)}addTo(s){return this._map=s,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(s){const g=this._map.getCenter(),x=Math.round(100*this._map.getZoom())/100,T=Math.ceil((x*Math.LN2+Math.log(512/360/.5))/Math.LN10),I=Math.pow(10,T),O=Math.round(g.lng*I)/I,z=Math.round(g.lat*I)/I,G=this._map.getBearing(),q=this._map.getPitch();let J="";if(J+=s?`/${O}/${z}/${x}`:`${x}/${z}/${O}`,(G||q)&&(J+="/"+Math.round(10*G)/10),q&&(J+=`/${Math.round(q)}`),this._hashName){const re=this._hashName;let ie=!1;const ce=window.location.hash.slice(1).split("&").map((_e=>{const Me=_e.split("=")[0];return Me===re?(ie=!0,`${Me}=${J}`):_e})).filter((_e=>_e));return ie||ce.push(`${re}=${J}`),`#${ce.join("&")}`}return`#${J}`}_isValidHash(s){if(s.length<3||s.some(isNaN))return!1;try{new l.V(+s[2],+s[1])}catch{return!1}const g=+s[0],x=+(s[3]||0),T=+(s[4]||0);return g>=this._map.getMinZoom()&&g<=this._map.getMaxZoom()&&x>=-180&&x<=180&&T>=this._map.getMinPitch()&&T<=this._map.getMaxPitch()}}const Nl={linearity:.3,easing:l.cw(0,0,.3,1)},Ah=l.e({deceleration:2500,maxSpeed:1400},Nl),oa=l.e({deceleration:20,maxSpeed:1400},Nl),mo=l.e({deceleration:1e3,maxSpeed:360},Nl),Pu=l.e({deceleration:1e3,maxSpeed:90},Nl),la=l.e({deceleration:1e3,maxSpeed:360},Nl);class tm{constructor(s){this._map=s,this.clear()}clear(){this._inertiaBuffer=[]}record(s){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:Ae(),settings:s})}_drainInertiaBuffer(){const s=this._inertiaBuffer,g=Ae();for(;s.length>0&&g-s[0].time>160;)s.shift()}_onMoveEnd(s){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const g={zoom:0,bearing:0,pitch:0,roll:0,pan:new l.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:I}of this._inertiaBuffer)g.zoom+=I.zoomDelta||0,g.bearing+=I.bearingDelta||0,g.pitch+=I.pitchDelta||0,g.roll+=I.rollDelta||0,I.panDelta&&g.pan._add(I.panDelta),I.around&&(g.around=I.around),I.pinchAround&&(g.pinchAround=I.pinchAround);const x=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,T={};if(g.pan.mag()){const I=Mf(g.pan.mag(),x,l.e({},Ah,s||{})),O=g.pan.mult(I.amount/g.pan.mag()),z=this._map.cameraHelper.handlePanInertia(O,this._map.transform);T.center=z.easingCenter,T.offset=z.easingOffset,pc(T,I)}if(g.zoom){const I=Mf(g.zoom,x,oa),O=l.cx(this._map.transform.zoom+I.amount,this._map.getZoomSnap(),I.amount);T.zoom=O,pc(T,I)}if(g.bearing){const I=Mf(g.bearing,x,mo);T.bearing=this._map.transform.bearing+l.an(I.amount,-179,179),pc(T,I)}if(g.pitch){const I=Mf(g.pitch,x,Pu);T.pitch=this._map.transform.pitch+I.amount,pc(T,I)}if(g.roll){const I=Mf(g.roll,x,la);T.roll=this._map.transform.roll+l.an(I.amount,-179,179),pc(T,I)}if(T.zoom||T.bearing){const I=g.pinchAround===void 0?g.around:g.pinchAround;T.around=I?this._map.unproject(I):this._map.getCenter()}return this.clear(),l.e(T,{noMoveStart:!0})}}function pc(C,s){(!C.duration||C.duration<s.duration)&&(C.duration=s.duration,C.easing=s.easing)}function Mf(C,s,g){const{maxSpeed:x,linearity:T,deceleration:I}=g,O=l.an(C*T/(s/1e3),-x,x),z=Math.abs(O)/(I*T);return{easing:g.easing,duration:1e3*z,amount:O*(z/2)}}class Ds extends l.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,g,x,T={}){x=x instanceof MouseEvent?x:new MouseEvent(s,x);const I=he.mousePos(g.getCanvas(),x),O=g.unproject(I);super(s,l.e({point:I,lngLat:O,originalEvent:x},T)),this._defaultPrevented=!1,this.target=g}}class ol extends l.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,g,x){const T=s==="touchend"?x.changedTouches:x.touches,I=he.touchPos(g.getCanvasContainer(),T),O=I.map((G=>g.unproject(G))),z=I.reduce(((G,q,J,re)=>G.add(q.div(re.length))),new l.P(0,0));super(s,{points:I,point:z,lngLats:O,lngLat:g.unproject(z),originalEvent:x}),this._defaultPrevented=!1}}class vd extends l.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,g,x){super(s,{originalEvent:x}),this._defaultPrevented=!1}}class xd{constructor(s,g){this._map=s,this._clickTolerance=g.clickTolerance}reset(){delete this._mousedownPos}wheel(s){return this._firePreventable(new vd(s.type,this._map,s))}mousedown(s,g){return this._mousedownPos=g,this._firePreventable(new Ds(s.type,this._map,s))}mouseup(s){this._map.fire(new Ds(s.type,this._map,s))}click(s,g){this._mousedownPos&&this._mousedownPos.dist(g)>=this._clickTolerance||this._map.fire(new Ds(s.type,this._map,s))}dblclick(s){return this._firePreventable(new Ds(s.type,this._map,s))}mouseover(s){this._map.fire(new Ds(s.type,this._map,s))}mouseout(s){this._map.fire(new Ds(s.type,this._map,s))}touchstart(s){return this._firePreventable(new ol(s.type,this._map,s))}touchmove(s){this._map.fire(new ol(s.type,this._map,s))}touchend(s){this._map.fire(new ol(s.type,this._map,s))}touchcancel(s){this._map.fire(new ol(s.type,this._map,s))}_firePreventable(s){if(this._map.fire(s),s.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Zp{constructor(s){this._map=s}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(s){this._map.fire(new Ds(s.type,this._map,s))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ds("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(s){this._delayContextMenu?this._contextMenuEvent=s:this._ignoreContextMenu||this._map.fire(new Ds(s.type,this._map,s)),this._map.listens("contextmenu")&&s.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ll{constructor(s){this._map=s}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(s){return this.transform.screenPointToLocation(l.P.convert(s),this._map.terrain)}}class gc{constructor(s,g){this._map=s,this._tr=new ll(s),this._el=s.getCanvasContainer(),this._container=s.getContainer(),this._clickTolerance=g.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(s,g){this.isEnabled()&&s.shiftKey&&s.button===0&&(he.disableDrag(),this._startPos=this._lastPos=g,this._active=!0)}mousemoveWindow(s,g){if(!this._active)return;const x=g;if(this._lastPos.equals(x)||!this._box&&x.dist(this._startPos)<this._clickTolerance)return;const T=this._startPos;this._lastPos=x,this._box||(this._box=he.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",s));const I=Math.min(T.x,x.x),O=Math.max(T.x,x.x),z=Math.min(T.y,x.y),G=Math.max(T.y,x.y);he.setTransform(this._box,`translate(${I}px,${z}px)`),this._box.style.width=O-I+"px",this._box.style.height=G-z+"px"}mouseupWindow(s,g){if(!this._active||s.button!==0)return;const x=this._startPos,T=g;if(this.reset(),he.suppressClick(),x.x!==T.x||x.y!==T.y)return this._map.fire(new l.l("boxzoomend",{originalEvent:s})),{cameraAnimation:I=>I.fitScreenCoordinates(x,T,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",s)}keydown(s){this._active&&s.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",s))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(he.remove(this._box),this._box=null),he.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(s,g){return this._map.fire(new l.l(s,{originalEvent:g}))}}function Wa(C,s){if(C.length!==s.length)throw new Error(`The number of touches and points are not equal - touches ${C.length}, points ${s.length}`);const g={};for(let x=0;x<C.length;x++)g[C[x].identifier]=s[x];return g}class yi{constructor(s){this.reset(),this.numTouches=s.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(s,g,x){(this.centroid||x.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=s.timeStamp),x.length===this.numTouches&&(this.centroid=(function(T){const I=new l.P(0,0);for(const O of T)I._add(O);return I.div(T.length)})(g),this.touches=Wa(x,g)))}touchmove(s,g,x){if(this.aborted||!this.centroid)return;const T=Wa(x,g);for(const I in this.touches){const O=T[I];(!O||O.dist(this.touches[I])>30)&&(this.aborted=!0)}}touchend(s,g,x){if((!this.centroid||s.timeStamp-this.startTime>500)&&(this.aborted=!0),x.length===0){const T=!this.aborted&&this.centroid;if(this.reset(),T)return T}}}class wh{constructor(s){this.singleTap=new yi(s),this.numTaps=s.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(s,g,x){this.singleTap.touchstart(s,g,x)}touchmove(s,g,x){this.singleTap.touchmove(s,g,x)}touchend(s,g,x){const T=this.singleTap.touchend(s,g,x);if(T){const I=s.timeStamp-this.lastTime<500,O=!this.lastTap||this.lastTap.dist(T)<30;if(I&&O||this.reset(),this.count++,this.lastTime=s.timeStamp,this.lastTap=T,this.count===this.numTaps)return this.reset(),T}}}class Hc{constructor(s){this._tr=new ll(s),this._zoomIn=new wh({numTouches:1,numTaps:2}),this._zoomOut=new wh({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(s,g,x){this._zoomIn.touchstart(s,g,x),this._zoomOut.touchstart(s,g,x)}touchmove(s,g,x){this._zoomIn.touchmove(s,g,x),this._zoomOut.touchmove(s,g,x)}touchend(s,g,x){const T=this._zoomIn.touchend(s,g,x),I=this._zoomOut.touchend(s,g,x),O=this._tr;return T?(this._active=!0,s.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:z=>z.easeTo({duration:300,zoom:l.cx(O.zoom+1,z.getZoomSnap()),around:O.unproject(T)},{originalEvent:s})}):I?(this._active=!0,s.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:z=>z.easeTo({duration:300,zoom:l.cx(O.zoom-1,z.getZoomSnap()),around:O.unproject(I)},{originalEvent:s})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Uo{constructor(s){this._enabled=!!s.enable,this._moveStateManager=s.moveStateManager,this._clickTolerance=s.clickTolerance||1,this._moveFunction=s.move,this._activateOnStart=!!s.activateOnStart,s.assignEvents(this),this.reset()}reset(s){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(s)}_move(...s){const g=this._moveFunction(...s);if(g.bearingDelta||g.pitchDelta||g.rollDelta||g.around||g.panDelta)return this._active=!0,g}dragStart(s,g){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(s)&&(this._moveStateManager.startMove(s),this._lastPoint=Array.isArray(g)?g[0]:g,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(s,g){if(!this.isEnabled())return;const x=this._lastPoint;if(!x)return;if(s.preventDefault(),!this._moveStateManager.isValidMoveEvent(s))return void this.reset(s);const T=Array.isArray(g)?g[0]:g;return!this._moved&&T.dist(x)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=T,this._move(x,T))}dragEnd(s){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(s)&&(this._moved&&he.suppressClick(),this.reset(s))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const cl=0,Th=2,bd={[cl]:1,[Th]:2};class Bl{constructor(s){this._correctEvent=s.checkCorrectEvent}startMove(s){const g=he.mouseButton(s);this._eventButton=g}endMove(s){delete this._eventButton}isValidStartEvent(s){return this._correctEvent(s)}isValidMoveEvent(s){return!(function(g,x){const T=bd[x];return g.buttons===void 0||(g.buttons&T)!==T})(s,this._eventButton)}isValidEndEvent(s){return he.mouseButton(s)===this._eventButton}}class Iu{constructor(){this._firstTouch=void 0}_isOneFingerTouch(s){return s.targetTouches.length===1}_isSameTouchEvent(s){return s.targetTouches[0].identifier===this._firstTouch}startMove(s){this._firstTouch=s.targetTouches[0].identifier}endMove(s){delete this._firstTouch}isValidStartEvent(s){return this._isOneFingerTouch(s)}isValidMoveEvent(s){return this._isOneFingerTouch(s)&&this._isSameTouchEvent(s)}isValidEndEvent(s){return this._isOneFingerTouch(s)&&this._isSameTouchEvent(s)}}class Rf{constructor(s=new Bl({checkCorrectEvent:()=>!0}),g=new Iu){this.mouseMoveStateManager=s,this.oneFingerTouchMoveStateManager=g}_executeRelevantHandler(s,g,x){return s instanceof MouseEvent?g(s):typeof TouchEvent<"u"&&s instanceof TouchEvent?x(s):void 0}startMove(s){this._executeRelevantHandler(s,(g=>this.mouseMoveStateManager.startMove(g)),(g=>this.oneFingerTouchMoveStateManager.startMove(g)))}endMove(s){this._executeRelevantHandler(s,(g=>this.mouseMoveStateManager.endMove(g)),(g=>this.oneFingerTouchMoveStateManager.endMove(g)))}isValidStartEvent(s){return this._executeRelevantHandler(s,(g=>this.mouseMoveStateManager.isValidStartEvent(g)),(g=>this.oneFingerTouchMoveStateManager.isValidStartEvent(g)))}isValidMoveEvent(s){return this._executeRelevantHandler(s,(g=>this.mouseMoveStateManager.isValidMoveEvent(g)),(g=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(g)))}isValidEndEvent(s){return this._executeRelevantHandler(s,(g=>this.mouseMoveStateManager.isValidEndEvent(g)),(g=>this.oneFingerTouchMoveStateManager.isValidEndEvent(g)))}}const zl=C=>{C.mousedown=C.dragStart,C.mousemoveWindow=C.dragMove,C.mouseup=C.dragEnd,C.contextmenu=s=>{s.preventDefault()}};class Sh{constructor(s,g){this._clickTolerance=s.clickTolerance||1,this._map=g,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new l.P(0,0)}_shouldBePrevented(s){return s<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(s,g,x){return this._calculateTransform(s,g,x)}touchmove(s,g,x){if(this._active){if(!this._shouldBePrevented(x.length))return s.preventDefault(),this._calculateTransform(s,g,x);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",s)}}touchend(s,g,x){this._calculateTransform(s,g,x),this._active&&this._shouldBePrevented(x.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(s,g,x){x.length>0&&(this._active=!0);const T=Wa(x,g),I=new l.P(0,0),O=new l.P(0,0);let z=0;for(const q in T){const J=T[q],re=this._touches[q];re&&(I._add(J),O._add(J.sub(re)),z++,T[q]=J)}if(this._touches=T,this._shouldBePrevented(z)||!O.mag())return;const G=O.div(z);return this._sum._add(G),this._sum.mag()<this._clickTolerance?void 0:{around:I.div(z),panDelta:G}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Eh{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(s,g,x){this._firstTwoTouches||x.length<2||(this._firstTwoTouches=[x[0].identifier,x[1].identifier],this._start([g[0],g[1]]))}touchmove(s,g,x){if(!this._firstTwoTouches)return;s.preventDefault();const[T,I]=this._firstTwoTouches,O=Ll(x,g,T),z=Ll(x,g,I);if(!O||!z)return;const G=this._aroundCenter?null:O.add(z).div(2);return this._move([O,z],G,s)}touchend(s,g,x){if(!this._firstTwoTouches)return;const[T,I]=this._firstTwoTouches,O=Ll(x,g,T),z=Ll(x,g,I);O&&z||(this._active&&he.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(s){this._enabled=!0,this._aroundCenter=!!s&&s.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Ll(C,s,g){for(let x=0;x<C.length;x++)if(C[x].identifier===g)return s[x]}function w0(C,s){return Math.log(C/s)/Math.LN2}class ul extends Eh{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(s){this._startDistance=this._distance=s[0].dist(s[1])}_move(s,g){const x=this._distance;if(this._distance=s[0].dist(s[1]),this._active||!(Math.abs(w0(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:w0(this._distance,x),pinchAround:g}}}function ca(C,s){return 180*C.angleWith(s)/Math.PI}class ku extends Eh{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(s){this._startVector=this._vector=s[0].sub(s[1]),this._minDiameter=s[0].dist(s[1])}_move(s,g,x){const T=this._vector;if(this._vector=s[0].sub(s[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:ca(this._vector,T),pinchAround:g}}_isBelowThreshold(s){this._minDiameter=Math.min(this._minDiameter,s.mag());const g=25/(Math.PI*this._minDiameter)*360,x=ca(s,this._startVector);return Math.abs(x)<g}}function ss(C){return Math.abs(C.y)>Math.abs(C.x)}class Nr extends Eh{constructor(s){super(),this._currentTouchCount=0,this._map=s}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(s,g,x){super.touchstart(s,g,x),this._currentTouchCount=x.length}_start(s){this._lastPoints=s,ss(s[0].sub(s[1]))&&(this._valid=!1)}_move(s,g,x){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const T=s[0].sub(this._lastPoints[0]),I=s[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(T,I,x.timeStamp),this._valid?(this._lastPoints=s,this._active=!0,{pitchDelta:(T.y+I.y)/2*-.5}):void 0}gestureBeginsVertically(s,g,x){if(this._valid!==void 0)return this._valid;const T=s.mag()>=2,I=g.mag()>=2;if(!T&&!I)return;if(!T||!I)return this._firstMove===void 0&&(this._firstMove=x),x-this._firstMove<100&&void 0;const O=s.y>0==g.y>0;return ss(s)&&ss(g)&&O}}const Br={panStep:100,bearingStep:15,pitchStep:10};class Un{constructor(s){this._tr=new ll(s);const g=Br;this._panStep=g.panStep,this._bearingStep=g.bearingStep,this._pitchStep=g.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(s){if(s.altKey||s.ctrlKey||s.metaKey)return;let g=0,x=0,T=0,I=0,O=0;switch(s.keyCode){case 61:case 107:case 171:case 187:g=1;break;case 189:case 109:case 173:g=-1;break;case 37:s.shiftKey?x=-1:(s.preventDefault(),I=-1);break;case 39:s.shiftKey?x=1:(s.preventDefault(),I=1);break;case 38:s.shiftKey?T=1:(s.preventDefault(),O=-1);break;case 40:s.shiftKey?T=-1:(s.preventDefault(),O=1);break;default:return}return this._rotationDisabled&&(x=0,T=0),{cameraAnimation:z=>{const G=this._tr;z.easeTo({duration:300,easeId:"keyboardHandler",easing:T0,zoom:g?l.cx(G.zoom+g*(s.shiftKey?2:1),z.getZoomSnap()):G.zoom,bearing:G.bearing+x*this._bearingStep,pitch:G.pitch+T*this._pitchStep,offset:[-I*this._panStep,-O*this._panStep],center:G.center},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function T0(C){return C*(2-C)}const mc=4.000244140625,$c=1/450;class Cf{constructor(s,g){this._onTimeout=x=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(x)},this._map=s,this._tr=new ll(s),this._triggerRenderFrame=g,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=$c}setZoomRate(s){this._defaultZoomRate=s}setWheelZoomRate(s){this._wheelZoomRate=s}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(s){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!s&&s.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(s){return!!this._map.cooperativeGestures.isEnabled()&&!(s.ctrlKey||this._map.cooperativeGestures.isBypassed(s))}wheel(s){if(!this.isEnabled())return;if(this._shouldBePrevented(s))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",s);let g=s.deltaMode===WheelEvent.DOM_DELTA_LINE?40*s.deltaY:s.deltaY;const x=Ae(),T=x-(this._lastWheelEventTime||0);this._lastWheelEventTime=x,g!==0&&g%mc==0?this._type="wheel":g!==0&&Math.abs(g)<4?this._type="trackpad":T>400?(this._type=null,this._lastValue=g,this._timeout=setTimeout(this._onTimeout,40,s)):this._type||(this._type=Math.abs(T*g)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,g+=this._lastValue)),s.shiftKey&&g&&(g/=4),this._type&&(this._lastWheelEvent=s,this._delta-=g,this._active||this._start(s)),s.preventDefault()}_start(s){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const g=he.mousePos(this._map.getCanvas(),s),x=this._tr;this._aroundPoint=this._aroundCenter?x.transform.locationToScreenPoint(l.V.convert(x.center)):g,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const s=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const z=s.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=z),typeof this._targetZoom=="number"&&(this._targetZoom+=z)}if(this._delta!==0){const z=this._type==="wheel"&&Math.abs(this._delta)>mc?this._wheelZoomRate:this._defaultZoomRate;let G=2/(1+Math.exp(-Math.abs(this._delta*z)));this._delta<0&&G!==0&&(G=1/G);const q=typeof this._targetZoom!="number"?s.scale:l.aq(this._targetZoom),J=s.applyConstrain(s.getCameraLngLat(),l.at(q*G)).zoom,re=this._map.getZoomSnap();if(this._type==="wheel"&&re>0){const ie=l.cx(s.zoom,re);this._targetZoom=l.cx(J,re,J-ie)}else this._targetZoom=J;this._type==="wheel"&&(this._startZoom=s.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const g=typeof this._targetZoom!="number"?s.zoom:this._targetZoom,x=this._startZoom,T=this._easing;let I,O=!1;if(this._type==="wheel"&&x&&T){const z=Ae()-this._lastWheelEventTime,G=Math.min((z+5)/200,1),q=T(G);I=l.G.number(x,g,q),G<1?this._frameId||(this._frameId=!0):O=!0}else I=g,O=!0;return this._active=!0,O&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout}),200)),this._lastExpectedZoom=I,{noInertia:!0,needsRenderFrame:!O,zoomDelta:I-s.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(s){let g=l.cz;if(this._prevEase){const x=this._prevEase,T=(Ae()-x.start)/x.duration,I=x.easing(T+.01)-x.easing(T),O=.27/Math.sqrt(I*I+1e-4)*.01,z=Math.sqrt(.0729-O*O);g=l.cw(O,z,.25,1)}return this._prevEase={start:Ae(),duration:s,easing:g},g}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Ad{constructor(s,g){this._clickZoom=s,this._tapZoom=g}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Du{constructor(s){this._tr=new ll(s),this.reset()}reset(){this._active=!1}dblclick(s,g){return s.preventDefault(),{cameraAnimation:x=>{x.easeTo({duration:300,zoom:l.cx(this._tr.zoom+(s.shiftKey?-1:1),x.getZoomSnap()),around:this._tr.unproject(g)},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Pf{constructor(){this._tap=new wh({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(s,g,x){if(!this._swipePoint)if(this._tapTime){const T=g[0],I=s.timeStamp-this._tapTime<500,O=this._tapPoint.dist(T)<30;I&&O?x.length>0&&(this._swipePoint=T,this._swipeTouch=x[0].identifier):this.reset()}else this._tap.touchstart(s,g,x)}touchmove(s,g,x){if(this._tapTime){if(this._swipePoint){if(x[0].identifier!==this._swipeTouch)return;const T=g[0],I=T.y-this._swipePoint.y;return this._swipePoint=T,s.preventDefault(),this._active=!0,{zoomDelta:I/128}}}else this._tap.touchmove(s,g,x)}touchend(s,g,x){if(this._tapTime)this._swipePoint&&x.length===0&&this.reset();else{const T=this._tap.touchend(s,g,x);T&&(this._tapTime=s.timeStamp,this._tapPoint=T)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class S0{constructor(s,g,x){this._el=s,this._mousePan=g,this._touchPan=x}enable(s){this._inertiaOptions=s||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class _o{constructor(s,g,x,T){this._pitchWithRotate=s.pitchWithRotate,this._rollEnabled=s.rollEnabled,this._mouseRotate=g,this._mousePitch=x,this._mouseRoll=T}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class Ou{constructor(s,g,x,T){this._el=s,this._touchZoom=g,this._touchRotate=x,this._tapDragZoom=T,this._rotationDisabled=!1,this._enabled=!0}enable(s){this._touchZoom.enable(s),this._rotationDisabled||this._touchRotate.enable(s),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class xi{constructor(s,g){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=s,this._options=g,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const s=this._map.getCanvasContainer();s.classList.add("maplibregl-cooperative-gestures"),this._container=he.create("div","maplibregl-cooperative-gesture-screen",s);let g=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(g=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const x=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),T=document.createElement("div");T.className="maplibregl-desktop-message",T.textContent=g,this._container.appendChild(T);const I=document.createElement("div");I.className="maplibregl-mobile-message",I.textContent=x,this._container.appendChild(I),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(he.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(s){return s[this._bypassKey]}notifyGestureBlocked(s,g){this._enabled&&(this._map.fire(new l.l("cooperativegestureprevented",{gestureType:s,originalEvent:g})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const Mi=C=>C.zoom||C.drag||C.roll||C.pitch||C.rotate;class Vo extends l.l{}function Mh(C){return C.panDelta&&C.panDelta.mag()||C.zoomDelta||C.bearingDelta||C.pitchDelta||C.rollDelta}class Rh{get _ownerDocument(){var s;return((s=this._el)===null||s===void 0?void 0:s.ownerDocument)||document}get _ownerWindow(){var s,g;return((g=(s=this._el)===null||s===void 0?void 0:s.ownerDocument)===null||g===void 0?void 0:g.defaultView)||window}constructor(s,g){this.handleWindowEvent=T=>{this.handleEvent(T,`${T.type}Window`)},this.handleEvent=(T,I)=>{if(T.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const O=T.type==="renderFrame"?void 0:T,z={needsRenderFrame:!1},G={},q={};for(const{handlerName:ie,handler:ce,allowed:_e}of this._handlers){if(!ce.isEnabled())continue;let Me;if(this._blockedByActive(q,_e,ie))ce.reset();else if(ce[I||T.type]){if(l.cA(T,I||T.type)){const Pe=he.mousePos(this._map.getCanvas(),T);Me=ce[I||T.type](T,Pe)}else if(l.cB(T,I||T.type)){const Pe=this._getMapTouches(T.touches),Ce=he.touchPos(this._map.getCanvas(),Pe);Me=ce[I||T.type](T,Ce,Pe)}else l.cC(I||T.type)||(Me=ce[I||T.type](T));this.mergeHandlerResult(z,G,Me,ie,O),Me&&Me.needsRenderFrame&&this._triggerRenderFrame()}(Me||ce.isActive())&&(q[ie]=ce)}const J={};for(const ie in this._previousActiveHandlers)q[ie]||(J[ie]=O);this._previousActiveHandlers=q,(Object.keys(J).length||Mh(z))&&(this._changes.push([z,G,J]),this._triggerRenderFrame()),(Object.keys(q).length||Mh(z))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:re}=z;re&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],re(this._map))},this._map=s,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new tm(s),this._bearingSnap=g.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(g);const x=this._el;this._listeners=[[x,"touchstart",{passive:!0}],[x,"touchmove",{passive:!1}],[x,"touchend",void 0],[x,"touchcancel",void 0],[x,"mousedown",void 0],[x,"mousemove",void 0],[x,"mouseup",void 0],[this._ownerDocument,"mousemove",{capture:!0}],[this._ownerDocument,"mouseup",void 0],[x,"mouseover",void 0],[x,"mouseout",void 0],[x,"dblclick",void 0],[x,"click",void 0],[x,"keydown",{capture:!1}],[x,"keyup",void 0],[x,"wheel",{passive:!1}],[x,"contextmenu",void 0],[this._ownerWindow,"blur",void 0]];for(const[T,I,O]of this._listeners)he.addEventListener(T,I,T===this._ownerDocument?this.handleWindowEvent:this.handleEvent,O)}destroy(){for(const[s,g,x]of this._listeners)he.removeEventListener(s,g,s===this._ownerDocument?this.handleWindowEvent:this.handleEvent,x)}_addDefaultHandlers(s){const g=this._map,x=g.getCanvasContainer();this._add("mapEvent",new xd(g,s));const T=g.boxZoom=new gc(g,s);this._add("boxZoom",T),s.interactive&&s.boxZoom&&T.enable();const I=g.cooperativeGestures=new xi(g,s.cooperativeGestures);this._add("cooperativeGestures",I),s.cooperativeGestures&&I.enable();const O=new Hc(g),z=new Du(g);g.doubleClickZoom=new Ad(z,O),this._add("tapZoom",O),this._add("clickZoom",z),s.interactive&&s.doubleClickZoom&&g.doubleClickZoom.enable();const G=new Pf;this._add("tapDragZoom",G);const q=g.touchPitch=new Nr(g);this._add("touchPitch",q),s.interactive&&s.touchPitch&&g.touchPitch.enable(s.touchPitch);const J=()=>g.project(g.getCenter()),re=(function({enable:ke,clickTolerance:Ge,aroundCenter:Xe=!0,minPixelCenterThreshold:Ue=100,rotateDegreesPerPixelMoved:et=.8},At){const pt=new Bl({checkCorrectEvent:bt=>he.mouseButton(bt)===0&&bt.ctrlKey||he.mouseButton(bt)===2&&!bt.ctrlKey});return new Uo({clickTolerance:Ge,move:(bt,_t)=>{const ti=At();if(Xe&&Math.abs(ti.y-bt.y)>Ue)return{bearingDelta:l.cy(new l.P(bt.x,_t.y),_t,ti)};let ii=(_t.x-bt.x)*et;return Xe&&_t.y<ti.y&&(ii=-ii),{bearingDelta:ii}},moveStateManager:pt,enable:ke,assignEvents:zl})})(s,J),ie=(function({enable:ke,clickTolerance:Ge,pitchDegreesPerPixelMoved:Xe=-.5}){const Ue=new Bl({checkCorrectEvent:et=>he.mouseButton(et)===0&&et.ctrlKey||he.mouseButton(et)===2});return new Uo({clickTolerance:Ge,move:(et,At)=>({pitchDelta:(At.y-et.y)*Xe}),moveStateManager:Ue,enable:ke,assignEvents:zl})})(s),ce=(function({enable:ke,clickTolerance:Ge,rollDegreesPerPixelMoved:Xe=.3},Ue){const et=new Bl({checkCorrectEvent:At=>he.mouseButton(At)===2&&At.ctrlKey});return new Uo({clickTolerance:Ge,move:(At,pt)=>{const bt=Ue();let _t=(pt.x-At.x)*Xe;return pt.y<bt.y&&(_t=-_t),{rollDelta:_t}},moveStateManager:et,enable:ke,assignEvents:zl})})(s,J);g.dragRotate=new _o(s,re,ie,ce),this._add("mouseRotate",re,["mousePitch"]),this._add("mousePitch",ie,["mouseRotate","mouseRoll"]),this._add("mouseRoll",ce,["mousePitch"]),s.interactive&&s.dragRotate&&g.dragRotate.enable();const _e=(function({enable:ke,clickTolerance:Ge}){const Xe=new Bl({checkCorrectEvent:Ue=>he.mouseButton(Ue)===0&&!Ue.ctrlKey});return new Uo({clickTolerance:Ge,move:(Ue,et)=>({around:et,panDelta:et.sub(Ue)}),activateOnStart:!0,moveStateManager:Xe,enable:ke,assignEvents:zl})})(s),Me=new Sh(s,g);g.dragPan=new S0(x,_e,Me),this._add("mousePan",_e),this._add("touchPan",Me,["touchZoom","touchRotate"]),s.interactive&&s.dragPan&&g.dragPan.enable(s.dragPan);const Pe=new ku,Ce=new ul;g.touchZoomRotate=new Ou(x,Ce,Pe,G),this._add("touchRotate",Pe,["touchPan","touchZoom"]),this._add("touchZoom",Ce,["touchPan","touchRotate"]),s.interactive&&s.touchZoomRotate&&g.touchZoomRotate.enable(s.touchZoomRotate),this._add("blockableMapEvent",new Zp(g));const Oe=g.scrollZoom=new Cf(g,(()=>this._triggerRenderFrame()));this._add("scrollZoom",Oe,["mousePan"]),s.interactive&&s.scrollZoom&&g.scrollZoom.enable(s.scrollZoom);const We=g.keyboard=new Un(g);this._add("keyboard",We),s.interactive&&s.keyboard&&g.keyboard.enable()}_add(s,g,x){this._handlers.push({handlerName:s,handler:g,allowed:x}),this._handlersById[s]=g}stop(s){if(!this._updatingCamera){for(const{handler:g}of this._handlers)g.reset();this._inertia.clear(),this._fireEvents({},{},s),this._changes=[]}}isActive(){for(const{handler:s}of this._handlers)if(s.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Mi(this._eventsInProgress)||this.isZooming()}_blockedByActive(s,g,x){for(const T in s)if(T!==x&&(!g||g.indexOf(T)<0))return!0;return!1}_getMapTouches(s){const g=[];for(const x of s)this._el.contains(x.target)&&g.push(x);return g}mergeHandlerResult(s,g,x,T,I){if(!x)return;l.e(s,x);const O={handlerName:T,originalEvent:x.originalEvent||I};x.zoomDelta!==void 0&&(g.zoom=O),x.panDelta!==void 0&&(g.drag=O),x.rollDelta!==void 0&&(g.roll=O),x.pitchDelta!==void 0&&(g.pitch=O),x.bearingDelta!==void 0&&(g.rotate=O)}_applyChanges(){const s={},g={},x={};for(const[T,I,O]of this._changes)T.panDelta&&(s.panDelta=(s.panDelta||new l.P(0,0))._add(T.panDelta)),T.zoomDelta&&(s.zoomDelta=(s.zoomDelta||0)+T.zoomDelta),T.bearingDelta&&(s.bearingDelta=(s.bearingDelta||0)+T.bearingDelta),T.pitchDelta&&(s.pitchDelta=(s.pitchDelta||0)+T.pitchDelta),T.rollDelta&&(s.rollDelta=(s.rollDelta||0)+T.rollDelta),T.around!==void 0&&(s.around=T.around),T.pinchAround!==void 0&&(s.pinchAround=T.pinchAround),T.noInertia&&(s.noInertia=T.noInertia),l.e(g,I),l.e(x,O);this._updateMapTransform(s,g,x),this._changes=[]}_updateMapTransform(s,g,x){const T=this._map,I=T._getTransformForUpdate(),O=T.terrain;if(!(Mh(s)||O&&this._terrainMovement))return this._fireEvents(g,x,!0);T._stop(!0);let{panDelta:z,zoomDelta:G,bearingDelta:q,pitchDelta:J,rollDelta:re,around:ie,pinchAround:ce}=s;ce!==void 0&&(ie=ce),ie=ie||T.transform.centerPoint,O&&!I.isPointOnMapSurface(ie)&&(ie=I.centerPoint);const _e={panDelta:z,zoomDelta:G,rollDelta:re,pitchDelta:J,bearingDelta:q,around:ie};this._map.cameraHelper.useGlobeControls&&!I.isPointOnMapSurface(ie)&&(ie=I.centerPoint);const Me=ie.distSqr(I.centerPoint)<.01?I.center:I.screenPointToLocation(z?ie.sub(z):ie);this._handleMapControls({terrain:O,tr:I,deltasForHelper:_e,preZoomAroundLoc:Me,combinedEventsInProgress:g,panDelta:z}),T._applyUpdatedTransform(I),this._map._update(),s.noInertia||this._inertia.record(s),this._fireEvents(g,x,!0)}_handleMapControls({terrain:s,tr:g,deltasForHelper:x,preZoomAroundLoc:T,combinedEventsInProgress:I,panDelta:O}){const z=this._map.cameraHelper;if(z.handleMapControlsRollPitchBearingZoom(x,g),s)return z.useGlobeControls?(this._terrainMovement||!I.drag&&!I.zoom||(this._terrainMovement=!0,this._map._elevationFreeze=!0),void z.handleMapControlsPan(x,g,T)):this._terrainMovement||!I.drag&&!I.zoom?void(I.drag&&this._terrainMovement&&O?g.setCenter(g.screenPointToLocation(g.centerPoint.sub(O))):z.handleMapControlsPan(x,g,T)):(this._terrainMovement=!0,this._map._elevationFreeze=!0,void z.handleMapControlsPan(x,g,T));z.handleMapControlsPan(x,g,T)}_fireEvents(s,g,x){const T=Mi(this._eventsInProgress),I=Mi(s),O={};for(const re in s){const{originalEvent:ie}=s[re];this._eventsInProgress[re]||(O[`${re}start`]=ie),this._eventsInProgress[re]=s[re]}!T&&I&&this._fireEvent("movestart",I.originalEvent);for(const re in O)this._fireEvent(re,O[re]);I&&this._fireEvent("move",I.originalEvent);for(const re in s){const{originalEvent:ie}=s[re];this._fireEvent(re,ie)}const z={};let G;for(const re in this._eventsInProgress){const{handlerName:ie,originalEvent:ce}=this._eventsInProgress[re];this._handlersById[ie].isActive()||(delete this._eventsInProgress[re],G=g[ie]||ce,z[`${re}end`]=G)}for(const re in z)this._fireEvent(re,z[re]);const q=Mi(this._eventsInProgress),J=(T||I)&&!q;if(J&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const re=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&re.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(re)}if(x&&J){this._updatingCamera=!0;const re=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),ie=ce=>ce!==0&&-this._bearingSnap<ce&&ce<this._bearingSnap;!re||!re.essential&&se.prefersReducedMotion?(this._map.fire(new l.l("moveend",{originalEvent:G})),ie(this._map.getBearing())&&this._map.resetNorth()):(ie(re.bearing||this._map.getBearing())&&(re.bearing=0),re.freezeElevation=!0,this._map.easeTo(re,{originalEvent:G})),this._updatingCamera=!1}}_fireEvent(s,g){this._map.fire(new l.l(s,g?{originalEvent:g}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((s=>{delete this._frameId,this.handleEvent(new Vo("renderFrame",{timeStamp:s})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Er extends l.E{constructor(s,g,x){super(),this._renderFrameCallback=()=>{const T=Math.min((Ae()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(T)),T<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=s,this._bearingSnap=x.bearingSnap,this._zoomSnap=x.zoomSnap,this.cameraHelper=g,this.on("moveend",(()=>{delete this._requestedCameraState}))}migrateProjection(s,g){s.apply(this.transform,!0),this.transform=s,this.cameraHelper=g}getCenter(){return new l.V(this.transform.center.lng,this.transform.center.lat)}setCenter(s,g){return this.jumpTo({center:s},g)}getCenterElevation(){return this.transform.elevation}setCenterElevation(s,g){return this.jumpTo({elevation:s},g),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(s){this._centerClampedToGround=s}panBy(s,g,x){return s=l.P.convert(s).mult(-1),this.panTo(this.transform.center,l.e({offset:s},g),x)}panTo(s,g,x){return this.easeTo(l.e({center:s},g),x)}getZoom(){return this.transform.zoom}setZoom(s,g){return this.jumpTo({zoom:s},g),this}zoomTo(s,g,x){return this.easeTo(l.e({zoom:s},g),x)}zoomIn(s,g){return this.zoomTo(l.cx(this.getZoom()+1,this._zoomSnap),s,g),this}zoomOut(s,g){return this.zoomTo(l.cx(this.getZoom()-1,this._zoomSnap),s,g),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(s,g){return s!=this.transform.fov&&(this.transform.setFov(s),this.fire(new l.l("movestart",g)).fire(new l.l("move",g)).fire(new l.l("moveend",g))),this}getBearing(){return this.transform.bearing}setZoomSnap(s){return this._zoomSnap=s,this}getZoomSnap(){return this._zoomSnap}setBearing(s,g){return this.jumpTo({bearing:s},g),this}getPadding(){return this.transform.padding}setPadding(s,g){return this.jumpTo({padding:s},g),this}rotateTo(s,g,x){return this.easeTo(l.e({bearing:s},g),x)}resetNorth(s,g){return this.rotateTo(0,l.e({duration:1e3},s),g),this}resetNorthPitch(s,g){return this.easeTo(l.e({bearing:0,pitch:0,roll:0,duration:1e3},s),g),this}snapToNorth(s,g){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(s,g):this}getPitch(){return this.transform.pitch}setPitch(s,g){return this.jumpTo({pitch:s},g),this}getRoll(){return this.transform.roll}setRoll(s,g){return this.jumpTo({roll:s},g),this}cameraForBounds(s,g){s=Ir.convert(s).adjustAntiMeridian();const x=g&&g.bearing||0;return this._cameraForBoxAndBearing(s.getNorthWest(),s.getSouthEast(),x,g)}_cameraForBoxAndBearing(s,g,x,T){const I={top:0,bottom:0,right:0,left:0};if(typeof(T=l.e({padding:I,offset:[0,0],maxZoom:this.transform.maxZoom},T)).padding=="number"){const q=T.padding;T.padding={top:q,bottom:q,right:q,left:q}}const O=l.e(I,T.padding);T.padding=O;const z=this.transform,G=new Ir(s,g);return this.cameraHelper.cameraForBoxAndBearing(T,O,G,x,z)}fitBounds(s,g,x){return this._fitInternal(this.cameraForBounds(s,g),g,x)}fitScreenCoordinates(s,g,x,T,I){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(l.P.convert(s)),this.transform.screenPointToLocation(l.P.convert(g)),x,T),T,I)}_fitInternal(s,g,x){return s?(delete(g=l.e(s,g)).padding,g.linear?this.easeTo(g,x):this.flyTo(g,x)):this}jumpTo(s,g){this.stop();const x=this._getTransformForUpdate();let T=!1,I=!1,O=!1;const z=x.zoom;this.cameraHelper.handleJumpToCenterZoom(x,s);const G=x.zoom!==z;return"elevation"in s&&x.elevation!==+s.elevation&&x.setElevation(+s.elevation),"bearing"in s&&x.bearing!==+s.bearing&&(T=!0,x.setBearing(+s.bearing)),"pitch"in s&&x.pitch!==+s.pitch&&(I=!0,x.setPitch(+s.pitch)),"roll"in s&&x.roll!==+s.roll&&(O=!0,x.setRoll(+s.roll)),s.padding==null||x.isPaddingEqual(s.padding)||x.setPadding(s.padding),this._applyUpdatedTransform(x),this.fire(new l.l("movestart",g)).fire(new l.l("move",g)),G&&this.fire(new l.l("zoomstart",g)).fire(new l.l("zoom",g)).fire(new l.l("zoomend",g)),T&&this.fire(new l.l("rotatestart",g)).fire(new l.l("rotate",g)).fire(new l.l("rotateend",g)),I&&this.fire(new l.l("pitchstart",g)).fire(new l.l("pitch",g)).fire(new l.l("pitchend",g)),O&&this.fire(new l.l("rollstart",g)).fire(new l.l("roll",g)).fire(new l.l("rollend",g)),this.fire(new l.l("moveend",g))}calculateCameraOptionsFromTo(s,g,x,T=0){const I=l.a9.fromLngLat(s,g),O=l.a9.fromLngLat(x,T),z=O.x-I.x,G=O.y-I.y,q=O.z-I.z,J=Math.hypot(z,G,q);if(J===0)throw new Error("Can't calculate camera options with same From and To");const re=Math.hypot(z,G),ie=l.at(this.transform.cameraToCenterDistance/J/this.transform.tileSize),ce=180*Math.atan2(z,-G)/Math.PI;let _e=180*Math.acos(re/J)/Math.PI;return _e=q<0?90-_e:90+_e,{center:O.toLngLat(),elevation:T,zoom:ie,pitch:_e,bearing:ce}}calculateCameraOptionsFromCameraLngLatAltRotation(s,g,x,T,I){const O=this.transform.calculateCenterFromCameraLngLatAlt(s,g,x,T);return{center:O.center,elevation:O.elevation,zoom:O.zoom,bearing:x,pitch:T,roll:I}}easeTo(s,g){this._stop(!1,s.easeId),((s=l.e({offset:[0,0],duration:500,easing:l.cz},s)).animate===!1||!s.essential&&se.prefersReducedMotion)&&(s.duration=0);const x=this._getTransformForUpdate(),T=this.getBearing(),I=x.pitch,O=x.roll,z="bearing"in s?this._normalizeBearing(s.bearing,T):T,G="pitch"in s?+s.pitch:I,q="roll"in s?this._normalizeBearing(s.roll,O):O,J="padding"in s?s.padding:x.padding,re=l.P.convert(s.offset);let ie,ce;s.around&&(ie=l.V.convert(s.around),ce=x.locationToScreenPoint(ie));const _e={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},Me=this.cameraHelper.handleEaseTo(x,{bearing:z,pitch:G,roll:q,padding:J,around:ie,aroundPoint:ce,offsetAsPoint:re,offset:s.offset,zoom:s.zoom,center:s.center});return this._rotating=this._rotating||T!==z,this._pitching=this._pitching||G!==I,this._rolling=this._rolling||q!==O,this._padding=!x.isPaddingEqual(J),this._zooming=this._zooming||Me.isZooming,this._easeId=s.easeId,this._prepareEase(g,s.noMoveStart,_e),this.terrain&&this._prepareElevation(Me.elevationCenter),this._ease((Pe=>{Me.easeFunc(Pe),this.terrain&&!s.freezeElevation&&this._updateElevation(Pe),this._applyUpdatedTransform(x),this._fireMoveEvents(g)}),(Pe=>{this.terrain&&s.freezeElevation&&this._finalizeElevation(),this._afterEase(g,Pe)}),s),this}_prepareEase(s,g,x={}){this._moving=!0,g||x.moving||this.fire(new l.l("movestart",s)),this._zooming&&!x.zooming&&this.fire(new l.l("zoomstart",s)),this._rotating&&!x.rotating&&this.fire(new l.l("rotatestart",s)),this._pitching&&!x.pitching&&this.fire(new l.l("pitchstart",s)),this._rolling&&!x.rolling&&this.fire(new l.l("rollstart",s))}_prepareElevation(s){this._elevationCenter=s,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(s,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(s){this._elevationStart!==void 0&&this._elevationCenter!==void 0||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const g=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(s<1&&g!==this._elevationTarget){const x=this._elevationTarget-this._elevationStart;this._elevationStart+=s*(x-(g-(x*s+this._elevationStart))/(1-s)),this._elevationTarget=g}this.transform.setElevation(l.G.number(this._elevationStart,this._elevationTarget,s))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(s){if(!this.terrain&&s.elevation>=0&&s.pitch<=90)return{};const g=s.getCameraLngLat(),x=s.getCameraAltitude(),T=this.terrain?this.terrain.getElevationForLngLatZoom(g,s.zoom):0;if(x<T){const I=this.calculateCameraOptionsFromTo(g,T,s.center,s.elevation);return{pitch:I.pitch,zoom:I.zoom}}return{}}_applyUpdatedTransform(s){const g=[];if(g.push((T=>this._elevateCameraIfInsideTerrain(T))),this.transformCameraUpdate&&g.push((T=>this.transformCameraUpdate(T))),!g.length)return;const x=s.clone();for(const T of g){const I=x.clone(),{center:O,zoom:z,roll:G,pitch:q,bearing:J,elevation:re}=T(I);O&&I.setCenter(O),re!==void 0&&I.setElevation(re),z!==void 0&&I.setZoom(z),G!==void 0&&I.setRoll(G),q!==void 0&&I.setPitch(q),J!==void 0&&I.setBearing(J),x.apply(I,!1)}this.transform.apply(x,!1)}_fireMoveEvents(s){this.fire(new l.l("move",s)),this._zooming&&this.fire(new l.l("zoom",s)),this._rotating&&this.fire(new l.l("rotate",s)),this._pitching&&this.fire(new l.l("pitch",s)),this._rolling&&this.fire(new l.l("roll",s))}_afterEase(s,g){if(this._easeId&&g&&this._easeId===g)return;delete this._easeId;const x=this._zooming,T=this._rotating,I=this._pitching,O=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,x&&this.fire(new l.l("zoomend",s)),T&&this.fire(new l.l("rotateend",s)),I&&this.fire(new l.l("pitchend",s)),O&&this.fire(new l.l("rollend",s)),this.fire(new l.l("moveend",s))}flyTo(s,g){if(!s.essential&&se.prefersReducedMotion){const _t=l.U(s,["center","zoom","bearing","pitch","roll","elevation","padding"]);return this.jumpTo(_t,g)}this.stop(),s=l.e({offset:[0,0],speed:1.2,curve:1.42,easing:l.cz},s);const x=this._getTransformForUpdate(),T=x.bearing,I=x.pitch,O=x.roll,z=x.padding,G="bearing"in s?this._normalizeBearing(s.bearing,T):T,q="pitch"in s?+s.pitch:I,J="roll"in s?this._normalizeBearing(s.roll,O):O,re="padding"in s?s.padding:x.padding,ie=l.P.convert(s.offset);let ce=x.centerPoint.add(ie);const _e=x.screenPointToLocation(ce),Me=this.cameraHelper.handleFlyTo(x,{bearing:G,pitch:q,roll:J,padding:re,locationAtOffset:_e,offsetAsPoint:ie,center:s.center,minZoom:s.minZoom,zoom:s.zoom});let Pe=s.curve;const Ce=Math.max(x.width,x.height),Oe=Ce/Me.scaleOfZoom,We=Me.pixelPathLength;typeof Me.scaleOfMinZoom=="number"&&(Pe=Math.sqrt(Ce/Me.scaleOfMinZoom/We*2));const ke=Pe*Pe;function Ge(_t){const ti=(Oe*Oe-Ce*Ce+(_t?-1:1)*ke*ke*We*We)/(2*(_t?Oe:Ce)*ke*We);return Math.log(Math.sqrt(ti*ti+1)-ti)}function Xe(_t){return(Math.exp(_t)-Math.exp(-_t))/2}function Ue(_t){return(Math.exp(_t)+Math.exp(-_t))/2}const et=Ge(!1);let At=function(_t){return Ue(et)/Ue(et+Pe*_t)},pt=function(_t){return Ce*((Ue(et)*(Xe(ti=et+Pe*_t)/Ue(ti))-Xe(et))/ke)/We;var ti},bt=(Ge(!0)-et)/Pe;if(Math.abs(We)<2e-6||!isFinite(bt)){if(Math.abs(Ce-Oe)<1e-6)return this.easeTo(s,g);const _t=Oe<Ce?-1:1;bt=Math.abs(Math.log(Oe/Ce))/Pe,pt=()=>0,At=ti=>Math.exp(_t*Pe*ti)}return s.duration="duration"in s?+s.duration:1e3*bt/("screenSpeed"in s?+s.screenSpeed/Pe:+s.speed),s.maxDuration&&s.duration>s.maxDuration&&(s.duration=0),this._zooming=!0,this._rotating=T!==G,this._pitching=q!==I,this._rolling=J!==O,this._padding=!x.isPaddingEqual(re),this._prepareEase(g,!1),this.terrain&&this._prepareElevation(Me.targetCenter),this._ease((_t=>{const ti=_t*bt,ii=1/At(ti),Wt=pt(ti);this._rotating&&x.setBearing(l.G.number(T,G,_t)),this._pitching&&x.setPitch(l.G.number(I,q,_t)),this._rolling&&x.setRoll(l.G.number(O,J,_t)),this._padding&&(x.interpolatePadding(z,re,_t),ce=x.centerPoint.add(ie)),Me.easeFunc(_t,ii,Wt,ce),this.terrain&&!s.freezeElevation&&this._updateElevation(_t),this._applyUpdatedTransform(x),this._fireMoveEvents(g)}),(()=>{this.terrain&&s.freezeElevation&&this._finalizeElevation(),this._afterEase(g)}),s),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(s,g){var x;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const T=this._onEaseEnd;delete this._onEaseEnd,T.call(this,g)}return s||(x=this.handlers)===null||x===void 0||x.stop(!1),this}_ease(s,g,x){x.animate===!1||x.duration===0?(s(1),g()):(this._easeStart=Ae(),this._easeOptions=x,this._onEaseFrame=s,this._onEaseEnd=g,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(s,g){s=l.W(s,-180,180);const x=Math.abs(s-g);return Math.abs(s-360-g)<x&&(s-=360),Math.abs(s+360-g)<x&&(s+=360),s}queryTerrainElevation(s){return this.terrain?this.terrain.getElevationForLngLat(l.V.convert(s),this.transform):null}}const rn={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class hr{constructor(s=rn){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=g=>{!g||g.sourceDataType!=="metadata"&&g.sourceDataType!=="visibility"&&g.dataType!=="style"&&g.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=s}getDefaultPosition(){return"bottom-right"}onAdd(s){return this._map=s,this._compact=this.options.compact,this._container=he.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=he.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=he.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){he.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(s,g){const x=this._map._getUIString(`AttributionControl.${g}`);s.title=x,s.setAttribute("aria-label",x)}_updateAttributions(){if(!this._map.style)return;let s=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?s=s.concat(this.options.customAttribution.map((T=>typeof T!="string"?"":T))):typeof this.options.customAttribution=="string"&&s.push(this.options.customAttribution)),this._map.style.stylesheet){const T=this._map.style.stylesheet;this.styleOwner=T.owner,this.styleId=T.id}const g=this._map.style.tileManagers;for(const T in g){const I=g[T];if(I.used||I.usedForTerrain){const O=I.getSource();O.attribution&&s.indexOf(O.attribution)<0&&s.push(O.attribution)}}s=s.filter((T=>String(T).trim())),s.sort(((T,I)=>T.length-I.length)),s=s.filter(((T,I)=>{for(let O=I+1;O<s.length;O++)if(s[O].indexOf(T)>=0)return!1;return!0}));const x=s.join(" | ");x!==this._attribHTML&&(this._attribHTML=x,s.length?(this._innerContainer.innerHTML=he.sanitize(x),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Ch{constructor(s={}){this._updateCompact=()=>{const g=this._container.children;if(g.length){const x=g[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&x.classList.add("maplibregl-compact"):x.classList.remove("maplibregl-compact")}},this.options=s}getDefaultPosition(){return"bottom-left"}onAdd(s){this._map=s,this._compact=this.options&&this.options.compact,this._container=he.create("div","maplibregl-ctrl");const g=he.create("a","maplibregl-ctrl-logo");return g.target="_blank",g.rel="noopener nofollow",g.href="https://maplibre.org/",g.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),g.setAttribute("rel","noopener nofollow"),this._container.appendChild(g),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){he.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class _c{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(s){const g=++this._id;return this._queue.push({callback:s,id:g,cancelled:!1}),g}remove(s){const g=this._currentlyRunning,x=g?this._queue.concat(g):this._queue;for(const T of x)if(T.id===s)return void(T.cancelled=!0)}run(s=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const g=this._currentlyRunning=this._queue;this._queue=[];for(const x of g)if(!x.cancelled&&(x.callback(s),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var un=l.aU([{name:"a_pos3d",type:"Int16",components:3}]);class Vn extends l.E{constructor(s){super(),this._lastTilesetChange=Ae(),this.tileManager=s,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=s._source.tileSize*2**this.deltaZoom,s.usedForTerrain=!0,s.tileSize=this.tileSize}destruct(){this.tileManager.usedForTerrain=!1,this.tileManager.tileSize=null}getSource(){return this.tileManager._source}update(s,g){this.tileManager.update(s,g),this._renderableTilesKeys=[];const x={};for(const T of er(s,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:g,calculateTileZoom:this.tileManager._source.calculateTileZoom}))x[T.key]=!0,this._renderableTilesKeys.push(T.key),this._tiles[T.key]||(T.terrainRttPosMatrix32f=new Float64Array(16),l.c7(T.terrainRttPosMatrix32f,0,l.a5,l.a5,0,0,1),this._tiles[T.key]=new st(T,this.tileSize),this._lastTilesetChange=Ae());for(const T in this._tiles)x[T]||delete this._tiles[T]}freeRtt(s){for(const g in this._tiles){const x=this._tiles[g];(!s||x.tileID.equals(s)||x.tileID.isChildOf(s)||s.isChildOf(x.tileID))&&(x.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((s=>this.getTileByID(s)))}getTileByID(s){return this._tiles[s]}getTerrainCoords(s,g){return g?this._getTerrainCoordsForTileRanges(s,g):this._getTerrainCoordsForRegularTile(s)}_getTerrainCoordsForRegularTile(s){const g={};for(const x of this._renderableTilesKeys){const T=this._tiles[x].tileID,I=s.clone(),O=l.bk();if(T.canonical.equals(s.canonical))l.c7(O,0,l.a5,l.a5,0,0,1);else if(T.canonical.isChildOf(s.canonical)){const z=T.canonical.z-s.canonical.z,G=T.canonical.x-(T.canonical.x>>z<<z),q=T.canonical.y-(T.canonical.y>>z<<z),J=l.a5>>z;l.c7(O,0,J,J,0,0,1),l.O(O,O,[-G*J,-q*J,0])}else{if(!s.canonical.isChildOf(T.canonical))continue;{const z=s.canonical.z-T.canonical.z,G=s.canonical.x-(s.canonical.x>>z<<z),q=s.canonical.y-(s.canonical.y>>z<<z),J=l.a5>>z;l.c7(O,0,l.a5,l.a5,0,0,1),l.O(O,O,[G*J,q*J,0]),l.Q(O,O,[1/2**z,1/2**z,0])}}I.terrainRttPosMatrix32f=new Float32Array(O),g[x]=I}return g}_getTerrainCoordsForTileRanges(s,g){const x={};for(const T of this._renderableTilesKeys){const I=this._tiles[T].tileID;if(!this._isWithinTileRanges(I,g))continue;const O=s.clone(),z=l.bk();if(I.canonical.z===s.canonical.z){const G=s.canonical.x-I.canonical.x+s.wrap*(1<<s.canonical.z),q=s.canonical.y-I.canonical.y;l.c7(z,0,l.a5,l.a5,0,0,1),l.O(z,z,[G*l.a5,q*l.a5,0])}else if(I.canonical.z>s.canonical.z){const G=I.canonical.z-s.canonical.z,q=I.canonical.x-(I.canonical.x>>G<<G)+s.wrap*(1<<I.canonical.z),J=I.canonical.y-(I.canonical.y>>G<<G),re=s.canonical.x-(I.canonical.x>>G),ie=s.canonical.y-(I.canonical.y>>G),ce=l.a5>>G;l.c7(z,0,ce,ce,0,0,1),l.O(z,z,[-q*ce+re*l.a5,-J*ce+ie*l.a5,0])}else{const G=s.canonical.z-I.canonical.z,q=s.canonical.x-(s.canonical.x>>G<<G)+s.wrap*(1<<s.canonical.z),J=s.canonical.y-(s.canonical.y>>G<<G),re=(s.canonical.x>>G)-I.canonical.x,ie=(s.canonical.y>>G)-I.canonical.y,ce=l.a5<<G;l.c7(z,0,ce,ce,0,0,1),l.O(z,z,[q*l.a5+re*ce,J*l.a5+ie*ce,0])}O.terrainRttPosMatrix32f=new Float32Array(z),x[T]=O}return x}getSourceTile(s,g){const x=this.tileManager._source;let T=s.overscaledZ-this.deltaZoom;if(T>x.maxzoom&&(T=x.maxzoom),T<x.minzoom)return;this._sourceTileCache[s.key]||(this._sourceTileCache[s.key]=s.scaledTo(T).key);let I=this.findTileInCaches(this._sourceTileCache[s.key]);if(!(I!=null&&I.dem)&&g)for(;T>=x.minzoom&&!(I!=null&&I.dem);)I=this.findTileInCaches(s.scaledTo(T--).key);return I}findTileInCaches(s){let g=this.tileManager.getTileByID(s);return g||(g=this.tileManager._outOfViewCache.getByKey(s),g)}anyTilesAfterTime(s=Date.now()){return this._lastTilesetChange>=s}_isWithinTileRanges(s,g){const x=g[s.canonical.z];return!!x&&(s.wrap>x.minWrap||s.wrap<x.maxWrap||s.canonical.x>=x.minTileXWrapped&&s.canonical.x<=x.maxTileXWrapped&&s.canonical.y>=x.minTileY&&s.canonical.y<=x.maxTileY)}}class zi{constructor(s,g,x){this._meshCache={},this.painter=s,this.tileManager=new Vn(g),this.options=x,this.exaggeration=typeof x.exaggeration=="number"?x.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(s,g,x,T=l.a5){var I;if(!(g>=0&&g<T&&x>=0&&x<T))return 0;const O=this.getTerrainData(s),z=(I=O.tile)===null||I===void 0?void 0:I.dem;if(!z)return 0;const G=l.cD([],[g/T*l.a5,x/T*l.a5],O.u_terrain_matrix),q=[G[0]*z.dim,G[1]*z.dim],J=Math.floor(q[0]),re=Math.floor(q[1]),ie=q[0]-J,ce=q[1]-re;return z.get(J,re)*(1-ie)*(1-ce)+z.get(J+1,re)*ie*(1-ce)+z.get(J,re+1)*(1-ie)*ce+z.get(J+1,re+1)*ie*ce}getElevationForLngLatZoom(s,g){if(!l.cE(g,s.wrap()))return 0;const{tileID:x,mercatorX:T,mercatorY:I}=this._getOverscaledTileIDFromLngLatZoom(s,g);return this.getElevation(x,T%l.a5,I%l.a5,l.a5)}getElevationForLngLat(s,g){const x=er(g,{maxzoom:this.tileManager.maxzoom,minzoom:this.tileManager.minzoom,tileSize:512,terrain:this});let T=0;for(const I of x)I.canonical.z>T&&(T=Math.min(I.canonical.z,this.tileManager.maxzoom));return this.getElevationForLngLatZoom(s,T)}getElevation(s,g,x,T=l.a5){return this.getDEMElevation(s,g,x,T)*this.exaggeration}getTerrainData(s){if(!this._emptyDemTexture){const T=this.painter.context,I=new l.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new l.T(T,I,T.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new l.T(T,new l.R({width:1,height:1}),T.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(T.gl.NEAREST,T.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=l.ar([])}const g=this.tileManager.getSourceTile(s,!0);if(g&&g.dem&&(!g.demTexture||g.needsTerrainPrepare)){const T=this.painter.context;g.demTexture=this.painter.getTileTexture(g.dem.stride),g.demTexture?g.demTexture.update(g.dem.getPixels(),{premultiply:!1}):g.demTexture=new l.T(T,g.dem.getPixels(),T.gl.RGBA,{premultiply:!1}),g.demTexture.bind(T.gl.NEAREST,T.gl.CLAMP_TO_EDGE),g.needsTerrainPrepare=!1}const x=g&&g.toString()+g.tileID.key+s.key;if(x&&!this._demMatrixCache[x]){const T=this.tileManager.getSource().maxzoom;let I=s.canonical.z-g.tileID.canonical.z;s.overscaledZ>s.canonical.z&&(s.canonical.z>=T?I=s.canonical.z-T:l.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const O=s.canonical.x-(s.canonical.x>>I<<I),z=s.canonical.y-(s.canonical.y>>I<<I),G=l.cF(new Float64Array(16),[1/(l.a5<<I),1/(l.a5<<I),0]);l.O(G,G,[O*l.a5,z*l.a5,0]),this._demMatrixCache[s.key]={matrix:G,coord:s}}return{u_depth:2,u_terrain:3,u_terrain_dim:g&&g.dem&&g.dem.dim||1,u_terrain_matrix:x?this._demMatrixCache[s.key].matrix:this._emptyDemMatrix,u_terrain_unpack:g&&g.dem&&g.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(g&&g.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:g}}getFramebuffer(s){const g=this.painter,x=g.width/devicePixelRatio,T=g.height/devicePixelRatio;return!this._fbo||this._fbo.width===x&&this._fbo.height===T||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new l.T(g.context,{width:x,height:T,data:null},g.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(g.context.gl.NEAREST,g.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new l.T(g.context,{width:x,height:T,data:null},g.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(g.context.gl.NEAREST,g.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=g.context.createFramebuffer(x,T,!0,!1),this._fbo.depthAttachment.set(g.context.createRenderbuffer(g.context.gl.DEPTH_COMPONENT16,x,T))),this._fbo.colorAttachment.set(s==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const s=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const g=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let I=0,O=0;I<this._coordsTextureSize;I++)for(let z=0;z<this._coordsTextureSize;z++,O+=4)g[O+0]=255&z,g[O+1]=255&I,g[O+2]=z>>8<<4|I>>8,g[O+3]=0;const x=new l.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(g.buffer)),T=new l.T(s,x,s.gl.RGBA,{premultiply:!1});return T.bind(s.gl.NEAREST,s.gl.CLAMP_TO_EDGE),this._coordsTexture=T,T}pointCoordinate(s){this.painter.maybeDrawDepthAndCoords(!0);const g=new Uint8Array(4),x=this.painter.context,T=x.gl,I=Math.round(s.x*this.painter.pixelRatio/devicePixelRatio),O=Math.round(s.y*this.painter.pixelRatio/devicePixelRatio),z=Math.round(this.painter.height/devicePixelRatio);x.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),T.readPixels(I,z-O-1,1,1,T.RGBA,T.UNSIGNED_BYTE,g),x.bindFramebuffer.set(null);const G=g[0]+(g[2]>>4<<8),q=g[1]+((15&g[2])<<8),J=this.coordsIndex[255-g[3]],re=J&&this.tileManager.getTileByID(J);if(!re)return null;const ie=this._coordsTextureSize,ce=(1<<re.tileID.canonical.z)*ie;return new l.a9((re.tileID.canonical.x*ie+G)/ce+re.tileID.wrap,(re.tileID.canonical.y*ie+q)/ce,this.getElevation(re.tileID,G,q,ie))}depthAtPoint(s){const g=new Uint8Array(4),x=this.painter.context,T=x.gl;return x.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),T.readPixels(s.x,this.painter.height/devicePixelRatio-s.y-1,1,1,T.RGBA,T.UNSIGNED_BYTE,g),x.bindFramebuffer.set(null),(g[0]/16777216+g[1]/65536+g[2]/256+g[3])/256}getTerrainMesh(s){var g;const x=((g=this.painter.style.projection)===null||g===void 0?void 0:g.transitionState)>0,T=x&&s.canonical.y===0,I=x&&s.canonical.y===(1<<s.canonical.z)-1,O=`m_${T?"n":""}_${I?"s":""}`;if(this._meshCache[O])return this._meshCache[O];const z=this.painter.context,G=new l.cG,q=new l.aY,J=this.meshSize,re=l.a5/J,ie=J*J;for(let Ue=0;Ue<=J;Ue++)for(let et=0;et<=J;et++)G.emplaceBack(et*re,Ue*re,0);for(let Ue=0;Ue<ie;Ue+=J+1)for(let et=0;et<J;et++)q.emplaceBack(et+Ue,J+et+Ue+1,J+et+Ue+2),q.emplaceBack(et+Ue,J+et+Ue+2,et+Ue+1);const ce=G.length,_e=ce+(J+1),Me=(J+1)*J,Pe=T?l.br:0,Ce=T?0:1,Oe=I?l.bs:l.a5,We=I?0:1;for(let Ue=0;Ue<=J;Ue++)G.emplaceBack(Ue*re,Pe,Ce);for(let Ue=0;Ue<=J;Ue++)G.emplaceBack(Ue*re,Oe,We);for(let Ue=0;Ue<J;Ue++)q.emplaceBack(Me+Ue,_e+Ue,_e+Ue+1),q.emplaceBack(Me+Ue,_e+Ue+1,Me+Ue+1),q.emplaceBack(0+Ue,ce+Ue+1,ce+Ue),q.emplaceBack(0+Ue,0+Ue+1,ce+Ue+1);const ke=G.length,Ge=ke+2*(J+1);for(const Ue of[0,1])for(let et=0;et<=J;et++)for(const At of[0,1])G.emplaceBack(Ue*l.a5,et*re,At);for(let Ue=0;Ue<2*J;Ue+=2)q.emplaceBack(ke+Ue,ke+Ue+1,ke+Ue+3),q.emplaceBack(ke+Ue,ke+Ue+3,ke+Ue+2),q.emplaceBack(Ge+Ue,Ge+Ue+3,Ge+Ue+1),q.emplaceBack(Ge+Ue,Ge+Ue+2,Ge+Ue+3);const Xe=new Wn(z.createVertexBuffer(G,un.members),z.createIndexBuffer(q),l.aX.simpleSegment(0,0,G.length,q.length));return this._meshCache[O]=Xe,Xe}getMeshFrameDelta(s){return 2*Math.PI*l.bE/Math.pow(2,Math.max(s,0))/5}getMinTileElevationForLngLatZoom(s,g){var x;if(!l.cE(g,s.wrap()))return 0;const{tileID:T}=this._getOverscaledTileIDFromLngLatZoom(s,g);return(x=this.getMinMaxElevation(T).minElevation)!==null&&x!==void 0?x:0}getMinMaxElevation(s){const g=this.getTerrainData(s).tile,x={minElevation:null,maxElevation:null};return g&&g.dem&&(x.minElevation=g.dem.min*this.exaggeration,x.maxElevation=g.dem.max*this.exaggeration),x}_getOverscaledTileIDFromLngLatZoom(s,g){const x=l.a9.fromLngLat(s.wrap()),T=(1<<g)*l.a5,I=x.x*T,O=x.y*T,z=Math.floor(I/l.a5),G=Math.floor(O/l.a5);return{tileID:new l.a2(g,0,g,z,G),mercatorX:I,mercatorY:O}}}class _r{constructor(s,g,x){this._context=s,this._size=g,this._tileSize=x,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const s of this._objects)s.texture.destroy(),s.fbo.destroy()}_createObject(s){const g=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),x=new l.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return x.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),g.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),g.colorAttachment.set(x.texture),{id:s,fbo:g,texture:x,stamp:-1,inUse:!1}}getObjectForId(s){return this._objects[s]}useObject(s){s.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((g=>s.id!==g)),this._recentlyUsed.push(s.id)}stampObject(s){s.stamp=++this._stamp}getOrCreateFreeObject(){for(const g of this._recentlyUsed)if(!this._objects[g].inUse)return this._objects[g];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const s=this._createObject(this._objects.length);return this._objects.push(s),s}freeObject(s){s.inUse=!1}freeAllObjects(){for(const s of this._objects)this.freeObject(s)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((s=>!s.inUse))===!1}}const yo={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class Za{constructor(s,g){this.painter=s,this.terrain=g,this.pool=new _r(s.context,30,g.tileManager.tileSize*g.qualityFactor)}destruct(){this.pool.destruct()}getTexture(s){return this.pool.getObjectForId(s.rtt[this._stacks.length-1].id).texture}prepareForRender(s,g){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.tileManager.getRenderableTiles(),this._renderableLayerIds=s._order.filter((x=>!s._layers[x].isHidden(g))),this._coordsAscending={};for(const x in s.tileManagers){this._coordsAscending[x]={};const T=s.tileManagers[x].getVisibleCoordinates(),I=s.tileManagers[x].getSource(),O=I instanceof ao?I.terrainTileRanges:null;for(const z of T){const G=this.terrain.tileManager.getTerrainCoords(z,O);for(const q in G)this._coordsAscending[x][q]||(this._coordsAscending[x][q]=[]),this._coordsAscending[x][q].push(G[q])}}this._coordsAscendingStr={};for(const x of s._order){const T=s._layers[x],I=T.source;if(yo[T.type]&&!this._coordsAscendingStr[I]){this._coordsAscendingStr[I]={};for(const O in this._coordsAscending[I])this._coordsAscendingStr[I][O]=this._coordsAscending[I][O].map((z=>z.key)).sort().join()}}for(const x of this._renderableTiles)for(const T in this._coordsAscendingStr){const I=this._coordsAscendingStr[T][x.tileID.key];I&&I!==x.rttCoords[T]&&(x.rtt=[])}}renderLayer(s,g){if(s.isHidden(this.painter.transform.zoom))return!1;const x=Object.assign(Object.assign({},g),{isRenderingToTexture:!0}),T=s.type,I=this.painter,O=this._renderableLayerIds[this._renderableLayerIds.length-1]===s.id;if(yo[T]&&(this._prevType&&yo[this._prevType]||this._stacks.push([]),this._prevType=T,this._stacks[this._stacks.length-1].push(s.id),!O))return!0;if(yo[this._prevType]||yo[T]&&O){this._prevType=T;const z=this._stacks.length-1,G=this._stacks[z]||[];for(const q of this._renderableTiles){if(this.pool.isFull()&&(yd(this.painter,this.terrain,this._rttTiles,x),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(q),q.rtt[z]){const re=this.pool.getObjectForId(q.rtt[z].id);if(re.stamp===q.rtt[z].stamp){this.pool.useObject(re);continue}}const J=this.pool.getOrCreateFreeObject();this.pool.useObject(J),this.pool.stampObject(J),q.rtt[z]={id:J.id,stamp:J.stamp},I.context.bindFramebuffer.set(J.fbo.framebuffer),I.context.clear({color:l.bp.transparent,stencil:0}),I.currentStencilSource=void 0;for(let re=0;re<G.length;re++){const ie=I.style._layers[G[re]],ce=ie.source?this._coordsAscending[ie.source][q.tileID.key]:[q.tileID];I.context.viewport.set([0,0,J.fbo.width,J.fbo.height]),I._renderTileClippingMasks(ie,ce,!0),I.renderLayer(I,I.style.tileManagers[ie.source],ie,ce,x),ie.source&&(q.rttCoords[ie.source]=this._coordsAscendingStr[ie.source][q.tileID.key])}}return yd(this.painter,this.terrain,this._rttTiles,x),this._rttTiles=[],this.pool.freeAllObjects(),yo[T]}return!1}}const qc={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Yc=M,Ul={hash:!1,interactive:!0,bearingSnap:7,zoomSnap:0,attributionControl:rn,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:l.c.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,transformConstrain:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,reduceMotion:void 0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0,experimentalZoomLevelsToOverscale:void 0},wd={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class lr{constructor(s,g,x=!1){this.mousedown=I=>{this.startMove(I,he.mousePos(this.element,I)),he.addEventListener(window,"mousemove",this.mousemove),he.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=I=>{this.move(I,he.mousePos(this.element,I))},this.mouseup=I=>{this._rotatePitchHandler.dragEnd(I),this.offTemp()},this.touchstart=I=>{I.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=he.touchPos(this.element,I.targetTouches)[0],this.startMove(I,this._startPos),he.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),he.addEventListener(window,"touchend",this.touchend))},this.touchmove=I=>{I.targetTouches.length!==1?this.reset():(this._lastPos=he.touchPos(this.element,I.targetTouches)[0],this.move(I,this._lastPos))},this.touchend=I=>{I.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=g;const T=new Rf;this._rotatePitchHandler=new Uo({clickTolerance:3,move:(I,O)=>{const z=g.getBoundingClientRect(),G=new l.P((z.bottom-z.top)/2,(z.right-z.left)/2);return{bearingDelta:l.cy(new l.P(I.x,O.y),O,G),pitchDelta:x?-.5*(O.y-I.y):void 0}},moveStateManager:T,enable:!0,assignEvents:()=>{}}),this.map=s,he.addEventListener(g,"mousedown",this.mousedown),he.addEventListener(g,"touchstart",this.touchstart,{passive:!1}),he.addEventListener(g,"touchcancel",this.reset)}startMove(s,g){this._rotatePitchHandler.dragStart(s,g),he.disableDrag()}move(s,g){const x=this.map,{bearingDelta:T,pitchDelta:I}=this._rotatePitchHandler.dragMove(s,g)||{};T&&x.setBearing(x.getBearing()+T),I&&x.setPitch(x.getPitch()+I)}off(){const s=this.element;he.removeEventListener(s,"mousedown",this.mousedown),he.removeEventListener(s,"touchstart",this.touchstart,{passive:!1}),he.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),he.removeEventListener(window,"touchend",this.touchend),he.removeEventListener(s,"touchcancel",this.reset),this.offTemp()}offTemp(){he.enableDrag(),he.removeEventListener(window,"mousemove",this.mousemove),he.removeEventListener(window,"mouseup",this.mouseup),he.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),he.removeEventListener(window,"touchend",this.touchend)}}let vo;function Ph(C,s,g,x=!1){if(x||!g.getCoveringTilesDetailsProvider().allowWorldCopies())return C==null?void 0:C.wrap();const T=new l.V(C.lng,C.lat);if(C=new l.V(C.lng,C.lat),s){const I=new l.V(C.lng-360,C.lat),O=new l.V(C.lng+360,C.lat),z=g.locationToScreenPoint(C).distSqr(s);g.locationToScreenPoint(I).distSqr(s)<z?C=I:g.locationToScreenPoint(O).distSqr(s)<z&&(C=O)}for(;Math.abs(C.lng-g.center.lng)>180;){const I=g.locationToScreenPoint(C);if(I.x>=0&&I.y>=0&&I.x<=g.width&&I.y<=g.height)break;C.lng>g.center.lng?C.lng-=360:C.lng+=360}return C.lng!==T.lng&&g.isPointOnMapSurface(g.locationToScreenPoint(C))?C:T}const Zr={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Ih(C,s,g){const x=C.classList;for(const T in Zr)x.remove(`maplibregl-${g}-anchor-${T}`);x.add(`maplibregl-${g}-anchor-${s}`)}class If extends l.E{constructor(s){if(super(),this._onKeyPress=g=>{const x=g.code,T=g.charCode||g.keyCode;x!=="Space"&&x!=="Enter"&&T!==32&&T!==13||this.togglePopup()},this._onMapClick=g=>{const x=g.originalEvent.target,T=this._element;this._popup&&(x===T||T.contains(x))&&this.togglePopup()},this._update=g=>{if(!this._map)return;const x=this._map.loaded()&&!this._map.isMoving();((g==null?void 0:g.type)==="terrain"||(g==null?void 0:g.type)==="render"&&!x)&&this._map.once("render",this._update),this._lngLat=Ph(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let T="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?T=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(T=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let I="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?I="rotateX(0deg)":this._pitchAlignment==="map"&&(I=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||g&&g.type!=="moveend"||(this._pos=this._pos.round()),he.setTransform(this._element,`${Zr[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${I} ${T}`),se.frameAsync(new AbortController,this._map._ownerWindow).then((()=>{this._updateOpacity(g&&g.type==="moveend")})).catch((()=>{}))},this._onMove=g=>{if(!this._isDragging){const x=this._clickTolerance||this._map._clickTolerance;this._isDragging=g.point.dist(this._pointerdownPos)>=x}this._isDragging&&(this._pos=g.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new l.l("dragstart"))),this.fire(new l.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new l.l("dragend")),this._state="inactive"},this._addDragHandler=g=>{this._element.contains(g.originalEvent.target)&&(g.preventDefault(),this._positionDelta=g.point.sub(this._pos).add(this._offset),this._pointerdownPos=g.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=s&&s.anchor||"center",this._color=s&&s.color||"#3FB1CE",this._scale=s&&s.scale||1,this._draggable=s&&s.draggable||!1,this._clickTolerance=s&&s.clickTolerance||0,this._subpixelPositioning=s&&s.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=s&&s.rotation||0,this._rotationAlignment=s&&s.rotationAlignment||"auto",this._pitchAlignment=s&&s.pitchAlignment&&s.pitchAlignment!=="auto"?s.pitchAlignment:this._rotationAlignment,this.setOpacity(s==null?void 0:s.opacity,s==null?void 0:s.opacityWhenCovered),s&&s.element)this._element=s.element,this._offset=l.P.convert(s&&s.offset||[0,0]);else{this._defaultMarker=!0,this._element=he.create("div");const g=he.createNS("http://www.w3.org/2000/svg","svg"),x=41,T=27;g.setAttributeNS(null,"display","block"),g.setAttributeNS(null,"height",`${x}px`),g.setAttributeNS(null,"width",`${T}px`),g.setAttributeNS(null,"viewBox",`0 0 ${T} ${x}`);const I=he.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"stroke","none"),I.setAttributeNS(null,"stroke-width","1"),I.setAttributeNS(null,"fill","none"),I.setAttributeNS(null,"fill-rule","evenodd");const O=he.createNS("http://www.w3.org/2000/svg","g");O.setAttributeNS(null,"fill-rule","nonzero");const z=he.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"transform","translate(3.0, 29.0)"),z.setAttributeNS(null,"fill","#000000");const G=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Ce of G){const Oe=he.createNS("http://www.w3.org/2000/svg","ellipse");Oe.setAttributeNS(null,"opacity","0.04"),Oe.setAttributeNS(null,"cx","10.5"),Oe.setAttributeNS(null,"cy","5.80029008"),Oe.setAttributeNS(null,"rx",Ce.rx),Oe.setAttributeNS(null,"ry",Ce.ry),z.appendChild(Oe)}const q=he.createNS("http://www.w3.org/2000/svg","g");q.setAttributeNS(null,"fill",this._color);const J=he.createNS("http://www.w3.org/2000/svg","path");J.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),q.appendChild(J);const re=he.createNS("http://www.w3.org/2000/svg","g");re.setAttributeNS(null,"opacity","0.25"),re.setAttributeNS(null,"fill","#000000");const ie=he.createNS("http://www.w3.org/2000/svg","path");ie.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),re.appendChild(ie);const ce=he.createNS("http://www.w3.org/2000/svg","g");ce.setAttributeNS(null,"transform","translate(6.0, 7.0)"),ce.setAttributeNS(null,"fill","#FFFFFF");const _e=he.createNS("http://www.w3.org/2000/svg","g");_e.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Me=he.createNS("http://www.w3.org/2000/svg","circle");Me.setAttributeNS(null,"fill","#000000"),Me.setAttributeNS(null,"opacity","0.25"),Me.setAttributeNS(null,"cx","5.5"),Me.setAttributeNS(null,"cy","5.5"),Me.setAttributeNS(null,"r","5.4999962");const Pe=he.createNS("http://www.w3.org/2000/svg","circle");Pe.setAttributeNS(null,"fill","#FFFFFF"),Pe.setAttributeNS(null,"cx","5.5"),Pe.setAttributeNS(null,"cy","5.5"),Pe.setAttributeNS(null,"r","5.4999962"),_e.appendChild(Me),_e.appendChild(Pe),O.appendChild(z),O.appendChild(q),O.appendChild(re),O.appendChild(ce),O.appendChild(_e),g.appendChild(O),g.setAttributeNS(null,"height",x*this._scale+"px"),g.setAttributeNS(null,"width",T*this._scale+"px"),this._element.appendChild(g),this._offset=l.P.convert(s&&s.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(g=>{g.preventDefault()})),this._element.addEventListener("mousedown",(g=>{g.preventDefault()})),Ih(this._element,this._anchor,"marker"),s&&s.className)for(const g of s.className.split(" "))this._element.classList.add(g);this._popup=null}addTo(s){return this.remove(),this._map=s,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",s._getUIString("Marker.Title")),this._element.hasAttribute("role")||this._element.setAttribute("role","button"),s.getCanvasContainer().appendChild(this._element),s.on("move",this._update),s.on("moveend",this._update),s.on("terrain",this._update),s.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),he.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(s){return this._lngLat=l.V.convert(s),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(s){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),s){if(!("offset"in s.options)){const T=Math.abs(13.5)/Math.SQRT2;s.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[T,-1*(38.1-13.5+T)],"bottom-right":[-T,-1*(38.1-13.5+T)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=s,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(s){return this._subpixelPositioning=s,this}getPopup(){return this._popup}togglePopup(){const s=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:s?(s.isOpen()?s.remove():(s.setLngLat(this._lngLat),s.addTo(this._map)),this):this}_updateOpacity(s=!1){var g,x;const T=(g=this._map)===null||g===void 0?void 0:g.terrain,I=this._map.transform.isLocationOccluded(this._lngLat);if(!T||I){const ce=I?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==ce&&(this._element.style.opacity=ce))}if(s)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const O=this._map,z=O.terrain.depthAtPoint(this._pos),G=O.terrain.getElevationForLngLat(this._lngLat,O.transform);if(O.transform.lngLatToCameraDepth(this._lngLat,G)-z<.006)return void(this._element.style.opacity=this._opacity);const q=-this._offset.y/O.transform.pixelsPerMeter,J=Math.sin(O.getPitch()*Math.PI/180)*q,re=O.terrain.depthAtPoint(new l.P(this._pos.x,this._pos.y-this._offset.y)),ie=O.transform.lngLatToCameraDepth(this._lngLat,G+J)-re>.006;!((x=this._popup)===null||x===void 0)&&x.isOpen()&&ie&&this._popup.remove(),this._element.style.opacity=ie?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(s){return this._offset=l.P.convert(s),this._update(),this}addClassName(s){this._element.classList.add(s)}removeClassName(s){this._element.classList.remove(s)}toggleClassName(s){return this._element.classList.toggle(s)}setDraggable(s){return this._draggable=!!s,this._map&&(s?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(s){return this._rotation=s||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(s){return this._rotationAlignment=s||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(s){return this._pitchAlignment=s&&s!=="auto"?s:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(s,g){return(this._opacity===void 0||s===void 0&&g===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),s!==void 0&&(this._opacity=s),g!==void 0&&(this._opacityWhenCovered=g),this._map&&this._updateOpacity(!0),this}}const Jc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Vl=0,jl=!1;const ea={maxWidth:100,unit:"metric"};function Mr(C,s,g){const x=g&&g.maxWidth||100,T=C._container.clientHeight/2,I=C._container.clientWidth/2,O=C.unproject([I-x/2,T]),z=C.unproject([I+x/2,T]),G=Math.round(C.project(z).x-C.project(O).x),q=Math.min(x,G,C._container.clientWidth),J=O.distanceTo(z);if(g&&g.unit==="imperial"){const re=3.2808*J;re>5280?Gl(s,q,re/5280,C._getUIString("ScaleControl.Miles")):Gl(s,q,re,C._getUIString("ScaleControl.Feet"))}else g&&g.unit==="nautical"?Gl(s,q,J/1852,C._getUIString("ScaleControl.NauticalMiles")):J>=1e3?Gl(s,q,J/1e3,C._getUIString("ScaleControl.Kilometers")):Gl(s,q,J,C._getUIString("ScaleControl.Meters"))}function Gl(C,s,g,x){const T=(function(I){const O=Math.pow(10,`${Math.floor(I)}`.length-1);let z=I/O;return z=z>=10?10:z>=5?5:z>=3?3:z>=2?2:z>=1?1:(function(G){const q=Math.pow(10,Math.ceil(-Math.log(G)/Math.LN10));return Math.round(G*q)/q})(z),O*z})(g);C.style.width=s*(T/g)+"px",C.innerHTML=`${T}&nbsp;${x}`}const Fu={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0,padding:void 0},Nu=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function kh(C){if(C){if(typeof C=="number"){const s=Math.round(Math.abs(C)/Math.SQRT2);return{center:new l.P(0,0),top:new l.P(0,C),"top-left":new l.P(s,s),"top-right":new l.P(-s,s),bottom:new l.P(0,-C),"bottom-left":new l.P(s,-s),"bottom-right":new l.P(-s,-s),left:new l.P(C,0),right:new l.P(-C,0)}}if(C instanceof l.P||Array.isArray(C)){const s=l.P.convert(C);return{center:s,top:s,"top-left":s,"top-right":s,bottom:s,"bottom-left":s,"bottom-right":s,left:s,right:s}}return{center:l.P.convert(C.center||[0,0]),top:l.P.convert(C.top||[0,0]),"top-left":l.P.convert(C["top-left"]||[0,0]),"top-right":l.P.convert(C["top-right"]||[0,0]),bottom:l.P.convert(C.bottom||[0,0]),"bottom-left":l.P.convert(C["bottom-left"]||[0,0]),"bottom-right":l.P.convert(C["bottom-right"]||[0,0]),left:l.P.convert(C.left||[0,0]),right:l.P.convert(C.right||[0,0])}}return kh(new l.P(0,0))}const hl=M;_.AJAXError=l.cJ,_.Event=l.l,_.Evented=l.E,_.LngLat=l.V,_.MercatorCoordinate=l.a9,_.Point=l.P,_.addProtocol=l.cK,_.config=l.c,_.removeProtocol=l.cL,_.AttributionControl=hr,_.BoxZoomHandler=gc,_.CanvasSource=Qo,_.CooperativeGesturesHandler=xi,_.DoubleClickZoomHandler=Ad,_.DragPanHandler=S0,_.DragRotateHandler=_o,_.EdgeInsets=oo,_.FullscreenControl=class extends l.E{constructor(C={}){super(),this._onFullscreenChange=()=>{var s;let g=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((s=g==null?void 0:g.shadowRoot)===null||s===void 0)&&s.fullscreenElement;)g=g.shadowRoot.fullscreenElement;g===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,C&&C.container&&(C.container instanceof HTMLElement?this._container=C.container:l.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(C){return this._map=C,this._container||(this._container=this._map.getContainer()),this._controlContainer=he.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){he.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const C=this._fullscreenButton=he.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);he.create("span","maplibregl-ctrl-icon",C).setAttribute("aria-hidden","true"),C.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const C=this._getTitle();this._fullscreenButton.setAttribute("aria-label",C),this._fullscreenButton.title=C}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new l.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new l.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},_.GeoJSONSource=Qr,_.GeolocateControl=class extends l.E{constructor(C){super(),this._onSuccess=s=>{if(this._map){if(this._isOutOfMapMaxBounds(s))return this._setErrorState(),this.fire(new l.l("outofmaxbounds",s)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=s,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(s),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(s),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new l.l("geolocate",s)),this._finish()}},this._updateCamera=s=>{const g=new l.V(s.coords.longitude,s.coords.latitude),x=s.coords.accuracy,T=this._map.getBearing(),I=l.e({bearing:T},this.options.fitBoundsOptions),O=Ir.fromLngLat(g,x);this._map.fitBounds(O,I,{geolocateSource:!0})},this._updateMarker=s=>{if(s){const g=new l.V(s.coords.longitude,s.coords.latitude);this._accuracyCircleMarker.setLngLat(g).addTo(this._map),this._userLocationDotMarker.setLngLat(g).addTo(this._map),this._accuracy=s.coords.accuracy,this._updateCircleRadiusIfNeeded()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onUpdate=()=>{this._updateCircleRadiusIfNeeded()},this._onError=s=>{if(this._map){if(s.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const g=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=g,this._geolocateButton.setAttribute("aria-label",g),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(s.code===3&&jl)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new l.l("error",s)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(s=>s.preventDefault())),this._geolocateButton=he.create("button","maplibregl-ctrl-geolocate",this._container),he.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=s=>{if(this._map){if(s===!1){l.w("Geolocation support is not available so the GeolocateControl will be disabled.");const g=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=g,this._geolocateButton.setAttribute("aria-label",g)}else{const g=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=g,this._geolocateButton.setAttribute("aria-label",g)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=he.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new If({element:this._dotElement}),this._circleElement=he.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new If({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onUpdate),this._map.on("move",this._onUpdate),this._map.on("rotate",this._onUpdate),this._map.on("pitch",this._onUpdate)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(g=>{const x=(g==null?void 0:g[0])instanceof ResizeObserverEntry;g.geolocateSource||this._watchState!=="ACTIVE_LOCK"||x||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new l.l("trackuserlocationend")),this.fire(new l.l("userlocationlostfocus")))}))}},this.options=l.e({},Jc,C)}onAdd(C){return this._map=C,this._container=he.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return l._(this,arguments,void 0,(function*(s=!1){if(vo!==void 0&&!s)return vo;if(window.navigator.permissions===void 0)return vo=!!window.navigator.geolocation,vo;try{vo=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{vo=!!window.navigator.geolocation}return vo}))})().then((s=>this._finishSetupUI(s))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),he.remove(this._container),this._map.off("zoom",this._onUpdate),this._map.off("move",this._onUpdate),this._map.off("rotate",this._onUpdate),this._map.off("pitch",this._onUpdate),this._map=void 0,Vl=0,jl=!1}_isOutOfMapMaxBounds(C){const s=this._map.getMaxBounds(),g=C.coords;return s&&(g.longitude<s.getWest()||g.longitude>s.getEast()||g.latitude<s.getSouth()||g.latitude>s.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":case"BACKGROUND_ERROR":case"OFF":case void 0:break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadiusIfNeeded(){const C=this._userLocationDotMarker.getLngLat();if(!(this.options.showUserLocation&&this.options.showAccuracyCircle&&this._accuracy&&C))return;const s=this._map.project(C),g=this._map.unproject([s.x+100,s.y]),x=C.distanceTo(g)/100,T=2*this._accuracy/x;this._circleElement.style.width=`${T.toFixed(2)}px`,this._circleElement.style.height=`${T.toFixed(2)}px`}trigger(){if(!this._setup)return l.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Vl--,jl=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new l.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.l("trackuserlocationstart")),this.fire(new l.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let C;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Vl++,Vl>1?(C={maximumAge:6e5,timeout:0},jl=!0):(C=this.options.positionOptions,jl=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,C)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},_.GlobeControl=class{constructor(){this._toggleProjection=()=>{var C;const s=(C=this._map.getProjection())===null||C===void 0?void 0:C.type;this._map.setProjection(s!=="mercator"&&s?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var C;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((C=this._map.getProjection())===null||C===void 0?void 0:C.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(C){return this._map=C,this._container=he.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=he.create("button","maplibregl-ctrl-globe",this._container),he.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){he.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},_.Hash=rs,_.ImageSource=ao,_.KeyboardHandler=Un,_.LngLatBounds=Ir,_.LogoControl=Ch,_.Map=class extends Er{get _ownerWindow(){var C,s;return((s=(C=this._container)===null||C===void 0?void 0:C.ownerDocument)===null||s===void 0?void 0:s.defaultView)||window}constructor(C){var s,g;l.cH.mark(l.cI.create);const x=Object.assign(Object.assign(Object.assign({},Ul),C),{canvasContextAttributes:Object.assign(Object.assign({},Ul.canvasContextAttributes),C.canvasContextAttributes)});if(x.minZoom!=null&&x.maxZoom!=null&&x.minZoom>x.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(x.minPitch!=null&&x.maxPitch!=null&&x.minPitch>x.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(x.minPitch!=null&&x.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(x.maxPitch!=null&&x.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const T=new bs,I=new _u;x.minZoom!==void 0&&T.setMinZoom(x.minZoom),x.maxZoom!==void 0&&T.setMaxZoom(x.maxZoom),x.minPitch!==void 0&&T.setMinPitch(x.minPitch),x.maxPitch!==void 0&&T.setMaxPitch(x.maxPitch),x.renderWorldCopies!==void 0&&T.setRenderWorldCopies(x.renderWorldCopies),x.transformConstrain!==null&&T.setConstrainOverride(x.transformConstrain),super(T,I,{bearingSnap:x.bearingSnap,zoomSnap:x.zoomSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new _c,this._controls=[],this._mapId=l.af(),this._lostContextStyle={style:null,images:null},this._contextLost=z=>{z.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.painter.destroy();for(const G of Object.values(this.style._layers))if(G.type==="custom"&&console.warn(`Custom layer with id '${G.id}' cannot be restored after WebGL context loss. You will need to re-add it manually after context restoration.`),G._listeners)for(const[q]of Object.entries(G._listeners))console.warn(`Custom layer with id '${G.id}' had event listeners for event '${q}' which cannot be restored after WebGL context loss. You will need to re-add them manually after context restoration.`);this._lostContextStyle=this._getStyleAndImages(),this.style.destroy(),this.style=null,this.fire(new l.l("webglcontextlost",{originalEvent:z}))},this._contextRestored=z=>{this._lostContextStyle.style&&this.setStyle(this._lostContextStyle.style,{diff:!1}),this._lostContextStyle.images&&(this.style.imageManager.images=this._lostContextStyle.images),this._lostContextStyle={style:null,images:null},this._setupPainter(),this.resize(),this._update(),this._resizeInternal(),this.fire(new l.l("webglcontextrestored",{originalEvent:z}))},this._onMapScroll=z=>{if(z.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=x.interactive,this._maxTileCacheSize=x.maxTileCacheSize,this._maxTileCacheZoomLevels=x.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},x.canvasContextAttributes),this._trackResize=x.trackResize===!0,this._bearingSnap=x.bearingSnap,this._zoomSnap=x.zoomSnap,this._centerClampedToGround=x.centerClampedToGround,this._refreshExpiredTiles=x.refreshExpiredTiles===!0,this._fadeDuration=x.fadeDuration,this._crossSourceCollisions=x.crossSourceCollisions===!0,this._collectResourceTiming=x.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},qc),x.locale),this._clickTolerance=x.clickTolerance,this._overridePixelRatio=x.pixelRatio,this._maxCanvasSize=x.maxCanvasSize,this._zoomLevelsToOverscale=x.experimentalZoomLevelsToOverscale,this.transformCameraUpdate=x.transformCameraUpdate,this.transformConstrain=x.transformConstrain,this.cancelPendingTileRequestsWhileZooming=x.cancelPendingTileRequestsWhileZooming===!0,x.reduceMotion!==void 0&&(se.prefersReducedMotion=x.reduceMotion),this._imageQueueHandle=kt.addThrottleControl((()=>this.isMoving())),this._requestManager=new Ht(x.transformRequest),this._container=this._resolveContainer(x.container),x.maxBounds&&this.setMaxBounds(x.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"&&(this._ownerWindow.addEventListener("online",this._onWindowOnline,!1),this._setupResizeObserver()),this.handlers=new Rh(this,x),this._hash=x.hash&&new rs(typeof x.hash=="string"&&x.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:x.center,elevation:x.elevation,zoom:x.zoom,bearing:x.bearing,pitch:x.pitch,roll:x.roll}),x.bounds&&(this.resize(),this.fitBounds(x.bounds,l.e({},x.fitBoundsOptions,{duration:0}))));const O=typeof x.style=="string"||((g=(s=x.style)===null||s===void 0?void 0:s.projection)===null||g===void 0?void 0:g.type)!=="globe";this.resize(null,O),this._localIdeographFontFamily=x.localIdeographFontFamily,this._validateStyle=x.validateStyle,x.style&&this.setStyle(x.style,{localIdeographFontFamily:x.localIdeographFontFamily}),x.attributionControl&&this.addControl(new hr(typeof x.attributionControl=="boolean"?void 0:x.attributionControl)),x.maplibreLogo&&this.addControl(new Ch,x.logoPosition),this.on("style.load",(()=>{if(O||this._resizeTransform(),this.transform.unmodified){const z=l.U(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(z)}})),this.on("data",(z=>{this._update(z.dataType==="style"),this.fire(new l.l(`${z.dataType}data`,z))})),this.on("dataloading",(z=>{this.fire(new l.l(`${z.dataType}dataloading`,z))})),this.on("dataabort",(z=>{this.fire(new l.l("sourcedataabort",z))}))}_getMapId(){return this._mapId}setGlobalStateProperty(C,s){return this.style.setGlobalStateProperty(C,s),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(C,s){if(s===void 0&&(s=C.getDefaultPosition?C.getDefaultPosition():"top-right"),!C||!C.onAdd)return this.fire(new l.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const g=C.onAdd(this);this._controls.push(C);const x=this._controlPositions[s];return s.indexOf("bottom")!==-1?x.insertBefore(g,x.firstChild):x.appendChild(g),this}removeControl(C){if(!C||!C.onRemove)return this.fire(new l.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const s=this._controls.indexOf(C);return s>-1&&this._controls.splice(s,1),C.onRemove(this),this}hasControl(C){return this._controls.indexOf(C)>-1}coveringTiles(C){return er(this.transform,C)}calculateCameraOptionsFromTo(C,s,g,x){return x==null&&this.terrain&&(x=this.terrain.getElevationForLngLat(g,this.transform)),super.calculateCameraOptionsFromTo(C,s,g,x)}resize(C,s=!0){if(this._lostContextStyle.style!==null)return this;this._resizeInternal(s);const g=!this._moving;return g&&(this.stop(),this.fire(new l.l("movestart",C)).fire(new l.l("move",C))),this.fire(new l.l("resize",C)),g&&this.fire(new l.l("moveend",C)),this}_resizeInternal(C=!0){const[s,g]=this._containerDimensions(),x=this._getClampedPixelRatio(s,g);if(this._resizeCanvas(s,g,x),this.painter.resize(s,g,x),this.painter.overLimit()){const T=this.painter.context.gl;this._maxCanvasSize=[T.drawingBufferWidth,T.drawingBufferHeight];const I=this._getClampedPixelRatio(s,g);this._resizeCanvas(s,g,I),this.painter.resize(s,g,I)}this._resizeTransform(C)}_resizeTransform(C=!0){var s;const[g,x]=this._containerDimensions();this.transform.resize(g,x,C),(s=this._requestedCameraState)===null||s===void 0||s.resize(g,x,C)}_getClampedPixelRatio(C,s){const{0:g,1:x}=this._maxCanvasSize,T=this.getPixelRatio(),I=C*T,O=s*T;return Math.min(I>g?g/I:1,O>x?x/O:1)*T}getPixelRatio(){var C;return(C=this._overridePixelRatio)!==null&&C!==void 0?C:devicePixelRatio}setPixelRatio(C){this._overridePixelRatio=C,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(C){return this.transform.setMaxBounds(Ir.convert(C)),this._update()}setMinZoom(C){if((C=C??-2)>=-2&&C<=this.transform.maxZoom){const s=this.transform.zoom,g=this._getTransformForUpdate();return g.setMinZoom(C),this._applyUpdatedTransform(g),this._update(),s!==this.transform.zoom&&this.fire(new l.l("zoomstart")).fire(new l.l("zoom")).fire(new l.l("zoomend")).fire(new l.l("movestart")).fire(new l.l("move")).fire(new l.l("moveend")),this}throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(C){if((C=C??22)>=this.transform.minZoom){const s=this.transform.zoom,g=this._getTransformForUpdate();return g.setMaxZoom(C),this._applyUpdatedTransform(g),this._update(),s!==this.transform.zoom&&this.fire(new l.l("zoomstart")).fire(new l.l("zoom")).fire(new l.l("zoomend")).fire(new l.l("movestart")).fire(new l.l("move")).fire(new l.l("moveend")),this}throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(C){if((C=C??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(C>=0&&C<=this.transform.maxPitch){const s=this.transform.pitch,g=this._getTransformForUpdate();return g.setMinPitch(C),this._applyUpdatedTransform(g),this._update(),s!==this.transform.pitch&&this.fire(new l.l("pitchstart")).fire(new l.l("pitch")).fire(new l.l("pitchend")).fire(new l.l("movestart")).fire(new l.l("move")).fire(new l.l("moveend")),this}throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(C){if((C=C??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(C>=this.transform.minPitch){const s=this.transform.pitch,g=this._getTransformForUpdate();return g.setMaxPitch(C),this._applyUpdatedTransform(g),this._update(),s!==this.transform.pitch&&this.fire(new l.l("pitchstart")).fire(new l.l("pitch")).fire(new l.l("pitchend")).fire(new l.l("movestart")).fire(new l.l("move")).fire(new l.l("moveend")),this}throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(C){return this.transform.setRenderWorldCopies(C),this._update()}setTransformConstrain(C){return this.transform.setConstrainOverride(C),this._update()}project(C){return this.transform.locationToScreenPoint(l.V.convert(C),this.style&&this.terrain)}unproject(C){return this.transform.screenPointToLocation(l.P.convert(C),this.terrain)}isMoving(){var C;return this._moving||((C=this.handlers)===null||C===void 0?void 0:C.isMoving())}isZooming(){var C;return this._zooming||((C=this.handlers)===null||C===void 0?void 0:C.isZooming())}isRotating(){var C;return this._rotating||((C=this.handlers)===null||C===void 0?void 0:C.isRotating())}_createDelegatedListener(C,s,g){if(C==="mouseenter"||C==="mouseover"){let x=!1;return{layers:s,listener:g,delegates:{mousemove:I=>{const O=s.filter((G=>this.getLayer(G))),z=O.length!==0?this.queryRenderedFeatures(I.point,{layers:O}):[];z.length?x||(x=!0,g.call(this,new Ds(C,this,I.originalEvent,{features:z}))):x=!1},mouseout:()=>{x=!1}}}}if(C==="mouseleave"||C==="mouseout"){let x=!1;return{layers:s,listener:g,delegates:{mousemove:O=>{const z=s.filter((G=>this.getLayer(G)));(z.length!==0?this.queryRenderedFeatures(O.point,{layers:z}):[]).length?x=!0:x&&(x=!1,g.call(this,new Ds(C,this,O.originalEvent)))},mouseout:O=>{x&&(x=!1,g.call(this,new Ds(C,this,O.originalEvent)))}}}}{const x=T=>{const I=s.filter((z=>this.getLayer(z))),O=I.length!==0?this.queryRenderedFeatures(T.point,{layers:I}):[];O.length&&(T.features=O,g.call(this,T),delete T.features)};return{layers:s,listener:g,delegates:{[C]:x}}}}_saveDelegatedListener(C,s){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[C]=this._delegatedListeners[C]||[],this._delegatedListeners[C].push(s)}_removeDelegatedListener(C,s,g){if(!this._delegatedListeners||!this._delegatedListeners[C])return;const x=this._delegatedListeners[C];for(let T=0;T<x.length;T++){const I=x[T];if(I.listener===g&&I.layers.length===s.length&&I.layers.every((O=>s.includes(O)))){for(const O in I.delegates)this.off(O,I.delegates[O]);return void x.splice(T,1)}}}on(C,s,g){if(g===void 0)return super.on(C,s);const x=typeof s=="string"?[s]:s,T=this._createDelegatedListener(C,x,g);this._saveDelegatedListener(C,T);for(const I in T.delegates)this.on(I,T.delegates[I]);return{unsubscribe:()=>{this._removeDelegatedListener(C,x,g)}}}once(C,s,g){if(g===void 0)return super.once(C,s);const x=typeof s=="string"?[s]:s,T=this._createDelegatedListener(C,x,g);for(const I in T.delegates){const O=T.delegates[I];T.delegates[I]=(...z)=>{this._removeDelegatedListener(C,x,g),O(...z)}}this._saveDelegatedListener(C,T);for(const I in T.delegates)this.once(I,T.delegates[I]);return this}off(C,s,g){return g===void 0?super.off(C,s):(this._removeDelegatedListener(C,typeof s=="string"?[s]:s,g),this)}queryRenderedFeatures(C,s){if(!this.style)return[];let g;const x=C instanceof l.P||Array.isArray(C),T=x?C:[[0,0],[this.transform.width,this.transform.height]];if(s=s||(x?{}:C)||{},T instanceof l.P||typeof T[0]=="number")g=[l.P.convert(T)];else{const I=l.P.convert(T[0]),O=l.P.convert(T[1]);g=[I,new l.P(O.x,I.y),O,new l.P(I.x,O.y),I]}return this.style.queryRenderedFeatures(g,s,this.transform)}querySourceFeatures(C,s){return this.style.querySourceFeatures(C,s)}setStyle(C,s){return(s=l.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},s)).diff!==!1&&s.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&C?(this._diffStyle(C,s),this):(this._localIdeographFontFamily=s.localIdeographFontFamily,this._updateStyle(C,s))}setTransformRequest(C){return this._requestManager.setTransformRequest(C),this}_getUIString(C){const s=this._locale[C];if(s==null)throw new Error(`Missing UI string '${C}'`);return s}_updateStyle(C,s){var g,x;if(s.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(C,s)));const T=this.style&&s.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!C)),C?(this.style=new mn(this,s||{}),this.style.setEventedParent(this,{style:this.style}),typeof C=="string"?this.style.loadURL(C,s,T):this.style.loadJSON(C,s,T),this):((x=(g=this.style)===null||g===void 0?void 0:g.projection)===null||x===void 0||x.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new mn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(C,s){if(typeof C=="string"){const g=this._requestManager.transformRequest(C,"Style");l.j(g,new AbortController).then((x=>{this._updateDiff(x.data,s)})).catch((x=>{x&&this.fire(new l.k(x))}))}else typeof C=="object"&&this._updateDiff(C,s)}_updateDiff(C,s){try{this.style.setState(C,s)&&this._update(!0)}catch(g){l.w(`Unable to perform style diff: ${g.message||g.error||g}.  Rebuilding the style from scratch.`),this._updateStyle(C,s)}}getStyle(){if(this.style)return this.style.serialize()}_getStyleAndImages(){return this.style?{style:this.style.serialize(),images:this.style.imageManager.cloneImages()}:{style:null,images:{}}}isStyleLoaded(){return this.style?this.style.loaded():l.w("There is no style added to the map.")}addSource(C,s){return this._lazyInitEmptyStyle(),this.style.addSource(C,s),this._update(!0)}isSourceLoaded(C){const s=this.style&&this.style.tileManagers[C];if(s!==void 0)return s.loaded();this.fire(new l.k(new Error(`There is no tile manager with ID '${C}'`)))}setTerrain(C){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),C){const s=this.style.tileManagers[C.source];if(!s)throw new Error(`cannot load terrain, because there exists no source with ID: ${C.source}`);this.terrain===null&&s.reload();for(const g in this.style._layers){const x=this.style._layers[g];x.type==="hillshade"&&x.source===C.source&&l.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),x.type==="color-relief"&&x.source===C.source&&l.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new zi(this.painter,s,C),this.painter.renderToTexture=new Za(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=g=>{var x;g.dataType==="style"?this.terrain.tileManager.freeRtt():g.dataType==="source"&&g.tile&&(g.sourceId!==C.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((x=g.source)===null||x===void 0?void 0:x.type)==="image"?this.terrain.tileManager.freeRtt():this.terrain.tileManager.freeRtt(g.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.tileManager.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new l.l("terrain",{terrain:C})),this}getTerrain(){var C,s;return(s=(C=this.terrain)===null||C===void 0?void 0:C.options)!==null&&s!==void 0?s:null}areTilesLoaded(){const C=this.style&&this.style.tileManagers;for(const s of Object.values(C))if(!s.areTilesLoaded())return!1;return!0}removeSource(C){return this.style.removeSource(C),this._update(!0)}getSource(C){return this.style.getSource(C)}setSourceTileLodParams(C,s,g){if(g){const x=this.getSource(g);if(!x)throw new Error(`There is no source with ID "${g}", cannot set LOD parameters`);x.calculateTileZoom=ki(Math.max(1,C),Math.max(1,s))}else for(const x in this.style.tileManagers)this.style.tileManagers[x].getSource().calculateTileZoom=ki(Math.max(1,C),Math.max(1,s));return this._update(!0),this}refreshTiles(C,s){const g=this.style.tileManagers[C];if(!g)throw new Error(`There is no tile manager with ID "${C}", cannot refresh tile`);s===void 0?g.reload(!0):g.refreshTiles(s.map((x=>new l.ac(x.z,x.x,x.y))))}addImage(C,s,g={}){const{pixelRatio:x=1,sdf:T=!1,stretchX:I,stretchY:O,content:z,textFitWidth:G,textFitHeight:q}=g;if(this._lazyInitEmptyStyle(),!(s instanceof HTMLImageElement||l.b(s))){if(s.width===void 0||s.height===void 0)return this.fire(new l.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:J,height:re,data:ie}=s,ce=s;return this.style.addImage(C,{data:new l.R({width:J,height:re},new Uint8Array(ie)),pixelRatio:x,stretchX:I,stretchY:O,content:z,textFitWidth:G,textFitHeight:q,sdf:T,version:0,userImage:ce}),ce.onAdd&&ce.onAdd(this,C),this}}{const{width:J,height:re,data:ie}=se.getImageData(s);this.style.addImage(C,{data:new l.R({width:J,height:re},ie),pixelRatio:x,stretchX:I,stretchY:O,content:z,textFitWidth:G,textFitHeight:q,sdf:T,version:0})}}updateImage(C,s){const g=this.style.getImage(C);if(!g)return this.fire(new l.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const x=s instanceof HTMLImageElement||l.b(s)?se.getImageData(s):s,{width:T,height:I,data:O}=x;if(T===void 0||I===void 0)return this.fire(new l.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(T!==g.data.width||I!==g.data.height)return this.fire(new l.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const z=!(s instanceof HTMLImageElement||l.b(s));return g.data.replace(O,z),this.style.updateImage(C,g),this}getImage(C){return this.style.getImage(C)}hasImage(C){return C?!!this.style.getImage(C):(this.fire(new l.k(new Error("Missing required image id"))),!1)}removeImage(C){this.style.removeImage(C)}loadImage(C){return kt.getImage(this._requestManager.transformRequest(C,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(C,s){return this._lazyInitEmptyStyle(),this.style.addLayer(C,s),this._update(!0)}moveLayer(C,s){return this.style.moveLayer(C,s),this._update(!0)}removeLayer(C){return this.style.removeLayer(C),this._update(!0)}getLayer(C){return this.style.getLayer(C)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(C,s,g){return this.style.setLayerZoomRange(C,s,g),this._update(!0)}setFilter(C,s,g={}){return this.style.setFilter(C,s,g),this._update(!0)}getFilter(C){return this.style.getFilter(C)}setPaintProperty(C,s,g,x={}){return this.style.setPaintProperty(C,s,g,x),this._update(!0)}getPaintProperty(C,s){return this.style.getPaintProperty(C,s)}setLayoutProperty(C,s,g,x={}){return this.style.setLayoutProperty(C,s,g,x),this._update(!0)}getLayoutProperty(C,s){return this.style.getLayoutProperty(C,s)}setGlyphs(C,s={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(C,s),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(C,s,g={}){return this._lazyInitEmptyStyle(),this.style.addSprite(C,s,g,(x=>{x||this._update(!0)})),this}removeSprite(C){return this._lazyInitEmptyStyle(),this.style.removeSprite(C),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(C,s={}){return this._lazyInitEmptyStyle(),this.style.setSprite(C,s,(g=>{g||this._update(!0)})),this}setLight(C,s={}){return this._lazyInitEmptyStyle(),this.style.setLight(C,s),this._update(!0)}getLight(){return this.style.getLight()}setSky(C,s={}){return this._lazyInitEmptyStyle(),this.style.setSky(C,s),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(C,s){return this.style.setFeatureState(C,s),this._update()}removeFeatureState(C,s){return this.style.removeFeatureState(C,s),this._update()}getFeatureState(C){return this.style.getFeatureState(C)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let C=0,s=0;return this._container&&(C=this._container.clientWidth||400,s=this._container.clientHeight||300),[C,s]}_setupResizeObserver(){var C;let s=!1;const g=A0((T=>{this._trackResize&&!this._removed&&(this.resize(T),this.redraw())}),50),x=(C=this._ownerWindow.ResizeObserver)!==null&&C!==void 0?C:ResizeObserver;this._resizeObserver=new x((T=>{s?g(T):s=!0})),this._resizeObserver.observe(this._container)}_resolveContainer(C){if(typeof C=="string"){const s=document.getElementById(C);if(!s)throw new Error(`Container '${C}' not found.`);return s}if(C instanceof HTMLElement||C&&typeof C=="object"&&C.nodeType===1)return C;throw new Error("Invalid type: 'container' must be a String or HTMLElement.")}_setupContainer(){const C=this._container;C.classList.add("maplibregl-map");const s=this._canvasContainer=he.create("div","maplibregl-canvas-container",C);this._interactive&&s.classList.add("maplibregl-interactive"),this._canvas=he.create("canvas","maplibregl-canvas",s),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const g=this._containerDimensions(),x=this._getClampedPixelRatio(g[0],g[1]);this._resizeCanvas(g[0],g[1],x);const T=this._controlContainer=he.create("div","maplibregl-control-container",C),I=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((O=>{I[O]=he.create("div",`maplibregl-ctrl-${O} `,T)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(C,s,g){this._canvas.width=Math.floor(g*C),this._canvas.height=Math.floor(g*s),this._canvas.style.width=`${C}px`,this._canvas.style.height=`${s}px`}_setupPainter(){const C=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let s=null;this._canvas.addEventListener("webglcontextcreationerror",(x=>{s={requestedAttributes:C},x&&(s.statusMessage=x.statusMessage,s.type=x.type)}),{once:!0});let g=null;if(g=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,C):this._canvas.getContext("webgl2",C)||this._canvas.getContext("webgl",C),!g){const x="Failed to initialize WebGL";throw s?(s.message=x,new Error(JSON.stringify(s))):new Error(x)}this.painter=new Wp(g,this.transform),Le.testSupport(g)}migrateProjection(C,s){super.migrateProjection(C,s),this.painter.transform=C,this.fire(new l.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(C){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||C,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(C){return this._update(),this._renderTaskQueue.add(C)}_cancelRenderFrame(C){this._renderTaskQueue.remove(C)}_render(C){var s,g,x,T,I;const O=this._idleTriggered?this._fadeDuration:0,z=((s=this.style.projection)===null||s===void 0?void 0:s.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(C),this._removed)return;let G=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const re=this.transform.zoom,ie=Ae();this.style.zoomHistory.update(re,ie);const ce=new l.H(re,{now:ie,fadeDuration:O,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),_e=ce.crossFadingFactor();_e===1&&_e===this._crossFadingFactor||(G=!0,this._crossFadingFactor=_e),this.style.update(ce)}const q=((g=this.style.projection)===null||g===void 0?void 0:g.transitionState)>0!==z;(x=this.style.projection)===null||x===void 0||x.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((T=this.style.projection)===null||T===void 0?void 0:T.transitionState,(I=this.style.projection)===null||I===void 0?void 0:I.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||q)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.tileManager.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,O,this._crossSourceCollisions,q),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:O,showPadding:this.showPadding}),this.fire(new l.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,l.cH.mark(l.cI.load),this.fire(new l.l("load"))),this.style&&(this.style.hasTransitions()||G)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const J=this._sourcesDirty||this._styleDirty||this._placementDirty;return J||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new l.l("idle")),!this._loaded||this._fullyLoaded||J||(this._fullyLoaded=!0,l.cH.mark(l.cI.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var C;this._hash&&this._hash.remove();for(const g of this._controls)g.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&this._ownerWindow.removeEventListener("online",this._onWindowOnline,!1),kt.removeThrottleControl(this._imageQueueHandle),(C=this._resizeObserver)===null||C===void 0||C.disconnect();const s=this.painter.context.gl.getExtension("WEBGL_lose_context");s!=null&&s.loseContext&&s.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),he.remove(this._canvasContainer),he.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),l.cH.clearMetrics(),this._removed=!0,this.fire(new l.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,se.frame(this._frameRequest,(C=>{l.cH.frame(C),this._frameRequest=null;try{this._render(C)}catch(s){if(!l.Z(s)&&!(function(g){return g.message===Xc})(s))throw s}}),(()=>{}),this._ownerWindow))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(C){this._showTileBoundaries!==C&&(this._showTileBoundaries=C,this._update())}get showPadding(){return!!this._showPadding}set showPadding(C){this._showPadding!==C&&(this._showPadding=C,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(C){this._showCollisionBoxes!==C&&(this._showCollisionBoxes=C,C?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(C){this._showOverdrawInspector!==C&&(this._showOverdrawInspector=C,this._update())}get repaint(){return!!this._repaint}set repaint(C){this._repaint!==C&&(this._repaint=C,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(C){this._vertices=C,this._update()}get version(){return Yc}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(C){return this._lazyInitEmptyStyle(),this.style.setProjection(C),this._update(!0)}},_.MapMouseEvent=Ds,_.MapTouchEvent=ol,_.MapWheelEvent=vd,_.Marker=If,_.NavigationControl=class{constructor(C){this._updateZoomButtons=()=>{const s=this._map.getZoom(),g=s===this._map.getMaxZoom(),x=s===this._map.getMinZoom();this._zoomInButton.disabled=g,this._zoomOutButton.disabled=x,this._zoomInButton.setAttribute("aria-disabled",g.toString()),this._zoomOutButton.setAttribute("aria-disabled",x.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(s,g)=>{const x=this._map._getUIString(`NavigationControl.${g}`);s.title=x,s.setAttribute("aria-label",x)},this.options=l.e({},wd,C),this._container=he.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(s=>s.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(s=>this._map.zoomIn({},{originalEvent:s}))),he.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(s=>this._map.zoomOut({},{originalEvent:s}))),he.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(s=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:s}):this._map.resetNorth({},{originalEvent:s})})),this._compassIcon=he.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(C){return this._map=C,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new lr(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){he.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(C,s){const g=he.create("button",C,this._container);return g.type="button",g.addEventListener("click",s),g}},_.Popup=class extends l.E{constructor(C){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&he.remove(this._content),this._container&&(he.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new l.l("close"))),this),this._onMouseUp=s=>{this._update(s.point)},this._onMouseMove=s=>{this._update(s.point)},this._onDrag=s=>{this._update(s.point)},this._update=s=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=he.create("div","maplibregl-popup",this._map.getContainer()),this._tip=he.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const O of this.options.className.split(" "))this._container.classList.add(O);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=Ph(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!s)return;const g=this._flatPos=this._pos=this._trackPointer&&s?s:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&s?s:this._map.transform.locationToScreenPoint(this._lngLat));let x=this.options.anchor;const T=kh(this.options.offset);if(!x){const O=this._container.offsetWidth,z=this._container.offsetHeight,G=(function(J){var re,ie,ce,_e;return J?{top:(re=J.top)!==null&&re!==void 0?re:0,right:(ie=J.right)!==null&&ie!==void 0?ie:0,bottom:(ce=J.bottom)!==null&&ce!==void 0?ce:0,left:(_e=J.left)!==null&&_e!==void 0?_e:0}:{top:0,right:0,bottom:0,left:0}})(this.options.padding);let q;q=g.y+T.bottom.y<z+G.top?["top"]:g.y>this._map.transform.height-z-G.bottom?["bottom"]:[],g.x<O/2+G.left?q.push("left"):g.x>this._map.transform.width-O/2-G.right&&q.push("right"),x=q.length===0?"bottom":q.join("-")}let I=g.add(T[x]);this.options.subpixelPositioning||(I=I.round()),he.setTransform(this._container,`${Zr[x]} translate(${I.x}px,${I.y}px)`),Ih(this._container,x,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=l.e(Object.create(Fu),C)}addTo(C){return this._map&&this.remove(),this._map=C,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new l.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(C){return this._lngLat=l.V.convert(C),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(C){return this.setDOMContent(document.createTextNode(C))}setHTML(C){const s=document.createDocumentFragment(),g=document.createElement("body");let x;for(g.innerHTML=C;x=g.firstChild,x;)s.appendChild(x);return this.setDOMContent(s)}getMaxWidth(){var C;return(C=this._container)===null||C===void 0?void 0:C.style.maxWidth}setMaxWidth(C){return this.options.maxWidth=C,this._update(),this}setDOMContent(C){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=he.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(C),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(C){return this._container&&this._container.classList.add(C),this}removeClassName(C){return this._container&&this._container.classList.remove(C),this}setOffset(C){return this.options.offset=C,this._update(),this}toggleClassName(C){if(this._container)return this._container.classList.toggle(C)}setSubpixelPositioning(C){this.options.subpixelPositioning=C}setPadding(C){this.options.padding=C,this._update()}_createCloseButton(){this.options.closeButton&&(this._closeButton=he.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const C=this._container.querySelector(Nu);C&&C.focus()}},_.RasterDEMTileSource=Po,_.RasterTileSource=Nc,_.ScaleControl=class{constructor(C){this._onMove=()=>{Mr(this._map,this._container,this.options)},this.setUnit=s=>{this.options.unit=s,Mr(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},ea),C)}getDefaultPosition(){return"bottom-left"}onAdd(C){return this._map=C,this._container=he.create("div","maplibregl-ctrl maplibregl-ctrl-scale",C.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){he.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},_.ScrollZoomHandler=Cf,_.Style=mn,_.TerrainControl=class{constructor(C){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=C}onAdd(C){return this._map=C,this._container=he.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=he.create("button","maplibregl-ctrl-terrain",this._container),he.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){he.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},_.TwoFingersTouchPitchHandler=Nr,_.TwoFingersTouchRotateHandler=ku,_.TwoFingersTouchZoomHandler=ul,_.TwoFingersTouchZoomRotateHandler=Ou,_.VectorTileSource=Fc,_.VideoSource=nc,_.addSourceType=(C,s)=>l._(void 0,void 0,void 0,(function*(){if(hh(C))throw new Error(`A source type called "${C}" already exists.`);((g,x)=>{Ls[g]=x})(C,s)})),_.clearPrewarmedResources=function(){const C=yn;C&&(C.isPreloaded()&&C.numActive()===1?(C.release(Si),yn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},_.createTileMesh=Np,_.getMaxParallelImageRequests=function(){return l.c.MAX_PARALLEL_IMAGE_REQUESTS},_.getRTLTextPluginStatus=function(){return ve().getRTLTextPluginStatus()},_.getVersion=function(){return hl},_.getWorkerCount=function(){return Li.workerCount},_.getWorkerUrl=function(){return l.c.WORKER_URL},_.importScriptInWorkers=function(C){return Oa().broadcast("IS",C)},_.isTimeFrozen=function(){return de.isFrozen()},_.now=Ae,_.prewarm=function(){mr().acquire(Si)},_.restoreNow=function(){de.restoreNow()},_.setMaxParallelImageRequests=function(C){l.c.MAX_PARALLEL_IMAGE_REQUESTS=C},_.setNow=function(C){de.setNow(C)},_.setRTLTextPlugin=function(C,s){return ve().setRTLTextPlugin(C,s)},_.setWorkerCount=function(C){Li.workerCount=C},_.setWorkerUrl=function(C){l.c.WORKER_URL=C}}));var p=t;return p}))})(Tv)),Tv.exports}var TN=wN();const HT=KI(TN),SN="4.3.3";var LS;const EN=(LS=globalThis.loaders)==null?void 0:LS.parseImageNode,_A=typeof Image<"u",yA=typeof ImageBitmap<"u",MN=!!EN,vA=aw?!0:MN;function RN(i){switch(i){case"auto":return yA||_A||vA;case"imagebitmap":return yA;case"image":return _A;case"data":return vA;default:throw new Error(`@loaders.gl/images: image ${i} not supported in this environment`)}}function CN(){if(yA)return"imagebitmap";if(_A)return"image";if(vA)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function PN(i){const e=kN(i);if(!e)throw new Error("Not an image");return e}function IN(i){switch(PN(i)){case"data":return i;case"image":case"imagebitmap":const e=document.createElement("canvas"),t=e.getContext("2d");if(!t)throw new Error("getImageData");return e.width=i.width,e.height=i.height,t.drawImage(i,0,0),t.getImageData(0,0,i.width,i.height);default:throw new Error("getImageData")}}function kN(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&i instanceof Image?"image":i&&typeof i=="object"&&i.data&&i.width&&i.height?"data":null}const DN=/^data:image\/svg\+xml/,ON=/\.svg((\?|#).*)?$/;function Aw(i){return i&&(DN.test(i)||ON.test(i))}function FN(i,e){if(Aw(e)){let r=new TextDecoder().decode(i);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(r=unescape(encodeURIComponent(r)))}catch(p){throw new Error(p.message)}return`data:image/svg+xml;base64,${btoa(r)}`}return FE(i,e)}function FE(i,e){if(Aw(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(i)])}async function NE(i,e,t){const r=FN(i,t),o=self.URL||self.webkitURL,p=typeof r!="string"&&o.createObjectURL(r);try{return await NN(p||r,e)}finally{p&&o.revokeObjectURL(p)}}async function NN(i,e){const t=new Image;return t.src=i,e.image&&e.image.decode&&t.decode?(await t.decode(),t):await new Promise((r,o)=>{try{t.onload=()=>r(t),t.onerror=p=>{const _=p instanceof Error?p.message:"error";o(new Error(_))}}catch(p){o(p)}})}const BN={};let $T=!0;async function zN(i,e,t){let r;Aw(t)?r=await NE(i,e,t):r=FE(i,t);const o=e&&e.imagebitmap;return await LN(r,o)}async function LN(i,e=null){if((UN(e)||!$T)&&(e=null),e)try{return await createImageBitmap(i,e)}catch(t){console.warn(t),$T=!1}return await createImageBitmap(i)}function UN(i){for(const e in i||BN)return!1;return!0}function VN(i){return!ZN(i,"ftyp",4)||(i[8]&96)===0?null:jN(i)}function jN(i){switch(GN(i,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function GN(i,e,t){return String.fromCharCode(...i.slice(e,t))}function WN(i){return[...i].map(e=>e.charCodeAt(0))}function ZN(i,e,t=0){const r=WN(e);for(let o=0;o<r.length;++o)if(r[o]!==i[o+t])return!1;return!0}const r0=!1,K2=!0;function BE(i){const e=k1(i);return HN(e)||YN(e)||$N(e)||qN(e)||XN(e)}function XN(i){const e=new Uint8Array(i instanceof DataView?i.buffer:i),t=VN(e);return t?{mimeType:t.mimeType,width:0,height:0}:null}function HN(i){const e=k1(i);return e.byteLength>=24&&e.getUint32(0,r0)===2303741511?{mimeType:"image/png",width:e.getUint32(16,r0),height:e.getUint32(20,r0)}:null}function $N(i){const e=k1(i);return e.byteLength>=10&&e.getUint32(0,r0)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,K2),height:e.getUint16(8,K2)}:null}function qN(i){const e=k1(i);return e.byteLength>=14&&e.getUint16(0,r0)===16973&&e.getUint32(2,K2)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,K2),height:e.getUint32(22,K2)}:null}function YN(i){const e=k1(i);if(!(e.byteLength>=3&&e.getUint16(0,r0)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:r,sofMarkers:o}=JN();let p=2;for(;p+9<e.byteLength;){const _=e.getUint16(p,r0);if(o.has(_))return{mimeType:"image/jpeg",height:e.getUint16(p+5,r0),width:e.getUint16(p+7,r0)};if(!r.has(_))return null;p+=2,p+=e.getUint16(p,r0)}return null}function JN(){const i=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)i.add(t);return{tableMarkers:i,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function k1(i){if(i instanceof DataView)return i;if(ArrayBuffer.isView(i))return new DataView(i.buffer);if(i instanceof ArrayBuffer)return new DataView(i);throw new Error("toDataView")}async function QN(i,e){var o;const{mimeType:t}=BE(i)||{},r=(o=globalThis.loaders)==null?void 0:o.parseImageNode;return Nv(r),await r(i,t)}async function KN(i,e,t){e=e||{};const o=(e.image||{}).type||"auto",{url:p}=t||{},_=eB(o);let l;switch(_){case"imagebitmap":l=await zN(i,e,p);break;case"image":l=await NE(i,e,p);break;case"data":l=await QN(i);break;default:Nv(!1)}return o==="data"&&(l=IN(l)),l}function eB(i){switch(i){case"auto":case"data":return CN();default:return RN(i),i}}const tB=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],iB=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],nB={image:{type:"auto",decode:!0}},rB={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:SN,mimeTypes:iB,extensions:tB,parse:KN,tests:[i=>!!BE(new DataView(i))],options:nB},Wr=new S1({id:"deck"});let xA={};function sB(i){xA=i}function Dc(i,e,t,r){Wr.level>0&&xA[i]&&xA[i].call(null,e,t,r)}function aB(i){const e=i[0],t=i[i.length-1];return e==="{"&&t==="}"||e==="["&&t==="]"}const oB={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:aB,parseTextSync:JSON.parse};function lB(){const i="9.2.6",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==i)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${i}`);return e||(Wr.log(1,`deck.gl ${i}`)(),globalThis.deck={...globalThis.deck,VERSION:i,version:i,log:Wr,_registerLoggers:sB},w8([oB,[rB,{imagebitmap:{premultiplyAlpha:"none"}}]])),i}const cB=lB();function ww(i,e){if(!i)throw new Error(e||"shadertools: assertion failed.")}const Eb={number:{type:"number",validate(i,e){return Number.isFinite(i)&&typeof e=="object"&&(e.max===void 0||i<=e.max)&&(e.min===void 0||i>=e.min)}},array:{type:"array",validate(i,e){return Array.isArray(i)||ArrayBuffer.isView(i)}}};function uB(i){const e={};for(const[t,r]of Object.entries(i))e[t]=hB(r);return e}function hB(i){let e=qT(i);if(e!=="object")return{value:i,...Eb[e],type:e};if(typeof i=="object")return i?i.type!==void 0?{...i,...Eb[i.type],type:i.type}:i.value===void 0?{type:"object",value:i}:(e=qT(i.value),{...i,...Eb[e],type:e}):{type:"object",value:null};throw new Error("props")}function qT(i){return Array.isArray(i)||ArrayBuffer.isView(i)?"array":typeof i}const fB=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,dB=`#ifdef MODULE_MATERIAL
  fragColor = material_filterColor(fragColor);
#endif

#ifdef MODULE_LIGHTING
  fragColor = lighting_filterColor(fragColor);
#endif

#ifdef MODULE_FOG
  fragColor = fog_filterColor(fragColor);
#endif

#ifdef MODULE_PICKING
  fragColor = picking_filterHighlightColor(fragColor);
  fragColor = picking_filterPickingColor(fragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,pB={vertex:fB,fragment:dB},YT=/void\s+main\s*\([^)]*\)\s*\{\n?/,JT=/}\n?[^{}]*$/,Mb=[],Sv="__LUMA_INJECT_DECLARATIONS__";function gB(i){const e={vertex:{},fragment:{}};for(const t in i){let r=i[t];const o=mB(t);typeof r=="string"&&(r={order:0,injection:r}),e[o][t]=r}return e}function mB(i){const e=i.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function qv(i,e,t,r=!1){const o=e==="vertex";for(const p in t){const _=t[p];_.sort((M,D)=>M.order-D.order),Mb.length=_.length;for(let M=0,D=_.length;M<D;++M)Mb[M]=_[M].injection;const l=`${Mb.join(`
`)}
`;switch(p){case"vs:#decl":o&&(i=i.replace(Sv,l));break;case"vs:#main-start":o&&(i=i.replace(YT,M=>M+l));break;case"vs:#main-end":o&&(i=i.replace(JT,M=>l+M));break;case"fs:#decl":o||(i=i.replace(Sv,l));break;case"fs:#main-start":o||(i=i.replace(YT,M=>M+l));break;case"fs:#main-end":o||(i=i.replace(JT,M=>l+M));break;default:i=i.replace(p,M=>M+l)}}return i=i.replace(Sv,""),r&&(i=i.replace(/\}\s*$/,p=>p+pB[e])),i}function Yv(i){i.map(e=>_B(e))}function _B(i){if(i.instance)return;Yv(i.dependencies||[]);const{propTypes:e={},deprecations:t=[],inject:r={}}=i,o={normalizedInjections:gB(r),parsedDeprecations:yB(t)};e&&(o.propValidators=uB(e)),i.instance=o;let p={};e&&(p=Object.entries(e).reduce((_,[l,M])=>{const D=M==null?void 0:M.value;return D&&(_[l]=D),_},{})),i.defaultUniforms={...i.defaultUniforms,...p}}function zE(i,e,t){var r;(r=i.deprecations)==null||r.forEach(o=>{var p;(p=o.regex)!=null&&p.test(e)&&(o.deprecated?t.deprecated(o.old,o.new)():t.removed(o.old,o.new)())})}function yB(i){return i.forEach(e=>{switch(e.type){case"function":e.regex=new RegExp(`\\b${e.old}\\(`);break;default:e.regex=new RegExp(`${e.type} ${e.old};`)}}),i}function Tw(i){Yv(i);const e={},t={};LE({modules:i,level:0,moduleMap:e,moduleDepth:t});const r=Object.keys(t).sort((o,p)=>t[p]-t[o]).map(o=>e[o]);return Yv(r),r}function LE(i){const{modules:e,level:t,moduleMap:r,moduleDepth:o}=i;if(t>=5)throw new Error("Possible loop in shader dependency graph");for(const p of e)r[p.name]=p,(o[p.name]===void 0||o[p.name]<t)&&(o[p.name]=t);for(const p of e)p.dependencies&&LE({modules:p.dependencies,level:t+1,moduleMap:r,moduleDepth:o})}function vB(i){switch(i==null?void 0:i.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
// Apple optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Headless Chrome's software shader 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// If the GPU doesn't have full 32 bits precision, will causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function xB(i,e){var r;if(Number(((r=i.match(/^#version[ \t]+(\d+)/m))==null?void 0:r[1])||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return i=QT(i,bB),i;case"fragment":return i=QT(i,AB),i;default:throw new Error(e)}}const UE=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],bB=[...UE,[bA("attribute"),"in $1"],[bA("varying"),"out $1"]],AB=[...UE,[bA("varying"),"in $1"]];function QT(i,e){for(const[t,r]of e)i=i.replace(t,r);return i}function bA(i){return new RegExp(`\\b${i}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function VE(i,e){let t="";for(const r in i){const o=i[r];if(t+=`void ${o.signature} {
`,o.header&&(t+=`  ${o.header}`),e[r]){const p=e[r];p.sort((_,l)=>_.order-l.order);for(const _ of p)t+=`  ${_.injection}
`}o.footer&&(t+=`  ${o.footer}`),t+=`}
`}return t}function jE(i){const e={vertex:{},fragment:{}};for(const t of i){let r,o;typeof t!="string"?(r=t,o=r.hook):(r={},o=t),o=o.trim();const[p,_]=o.split(":"),l=o.replace(/\(.+/,""),M=Object.assign(r,{signature:_});switch(p){case"vs":e.vertex[l]=M;break;case"fs":e.fragment[l]=M;break;default:throw new Error(p)}}return e}function wB(i,e){return{name:TB(i,e),language:"glsl",version:SB(i)}}function TB(i,e="unnamed"){const r=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(i);return r?r[1]:e}function SB(i){let e=100;const t=i.match(/[^\s]+/g);if(t&&t.length>=2&&t[0]==="#version"){const r=parseInt(t[1],10);Number.isFinite(r)&&(e=r)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const GE=`

${Sv}
`,EB=`precision highp float;
`;function MB(i){const e=Tw(i.modules||[]);return{source:CB(i.platformInfo,{...i,source:i.source,stage:"vertex",modules:e}),getUniforms:WE(e)}}function RB(i){const{vs:e,fs:t}=i,r=Tw(i.modules||[]);return{vs:KT(i.platformInfo,{...i,source:e,stage:"vertex",modules:r}),fs:KT(i.platformInfo,{...i,source:t,stage:"fragment",modules:r}),getUniforms:WE(r)}}function CB(i,e){var Ae;const{source:t,stage:r,modules:o,hookFunctions:p=[],inject:_={},log:l}=e;ww(typeof t=="string","shader source must be a string");const M=t;let D="";const B=jE(p),j={},$={},se={};for(const he in _){const Le=typeof _[he]=="string"?{injection:_[he],order:0}:_[he],$e=/^(v|f)s:(#)?([\w-]+)$/.exec(he);if($e){const Be=$e[2],Je=$e[3];Be?Je==="decl"?$[he]=[Le]:se[he]=[Le]:j[he]=[Le]}else se[he]=[Le]}const de=o;for(const he of de){l&&zE(he,M,l);const Le=ZE(he,"wgsl");D+=Le;const $e=((Ae=he.injections)==null?void 0:Ae[r])||{};for(const Be in $e){const Je=/^(v|f)s:#([\w-]+)$/.exec(Be);if(Je){const Et=Je[2]==="decl"?$:se;Et[Be]=Et[Be]||[],Et[Be].push($e[Be])}else j[Be]=j[Be]||[],j[Be].push($e[Be])}}return D+=GE,D=qv(D,r,$),D+=VE(B[r],j),D+=M,D=qv(D,r,se),D}function KT(i,e){var Et;const{source:t,stage:r,language:o="glsl",modules:p,defines:_={},hookFunctions:l=[],inject:M={},prologue:D=!0,log:B}=e;ww(typeof t=="string","shader source must be a string");const j=o==="glsl"?wB(t).version:-1,$=i.shaderLanguageVersion,se=j===100?"#version 100":"#version 300 es",Ae=t.split(`
`).slice(1).join(`
`),he={};p.forEach(kt=>{Object.assign(he,kt.defines)}),Object.assign(he,_);let Le="";switch(o){case"wgsl":break;case"glsl":Le=D?`${se}

// ----- PROLOGUE -------------------------
${`#define SHADER_TYPE_${r.toUpperCase()}`}

${vB(i)}
${r==="fragment"?EB:""}

// ----- APPLICATION DEFINES -------------------------

${PB(he)}

`:`${se}
`;break}const $e=jE(l),Be={},Je={},Rt={};for(const kt in M){const Ht=typeof M[kt]=="string"?{injection:M[kt],order:0}:M[kt],Xt=/^(v|f)s:(#)?([\w-]+)$/.exec(kt);if(Xt){const hi=Xt[2],di=Xt[3];hi?di==="decl"?Je[kt]=[Ht]:Rt[kt]=[Ht]:Be[kt]=[Ht]}else Rt[kt]=[Ht]}for(const kt of p){B&&zE(kt,Ae,B);const Ht=ZE(kt,r);Le+=Ht;const Xt=((Et=kt.instance)==null?void 0:Et.normalizedInjections[r])||{};for(const hi in Xt){const di=/^(v|f)s:#([\w-]+)$/.exec(hi);if(di){const Ii=di[2]==="decl"?Je:Rt;Ii[hi]=Ii[hi]||[],Ii[hi].push(Xt[hi])}else Be[hi]=Be[hi]||[],Be[hi].push(Xt[hi])}}return Le+="// ----- MAIN SHADER SOURCE -------------------------",Le+=GE,Le=qv(Le,r,Je),Le+=VE($e[r],Be),Le+=Ae,Le=qv(Le,r,Rt),o==="glsl"&&j!==$&&(Le=xB(Le,r)),Le.trim()}function WE(i){return function(t){var o;const r={};for(const p of i){const _=(o=p.getUniforms)==null?void 0:o.call(p,t,r);Object.assign(r,_)}return r}}function PB(i={}){let e="";for(const t in i){const r=i[t];(r||Number.isFinite(r))&&(e+=`#define ${t.toUpperCase()} ${i[t]}
`)}return e}function ZE(i,e){let t;switch(e){case"vertex":t=i.vs||"";break;case"fragment":t=i.fs||"";break;case"wgsl":t=i.source||"";break;default:ww(!1)}if(!i.name)throw new Error("Shader module must have a name");const r=i.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");let o=`// ----- MODULE ${i.name} ---------------

`;return e!=="wgsl"&&(o+=`#define MODULE_${r}
`),o+=`${t}
`,o}const IB=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,kB=/^\s*\#\s*endif\s*$/;function DB(i,e){var _;const t=i.split(`
`),r=[];let o=!0,p=null;for(const l of t){const M=l.match(IB),D=l.match(kB);M?(p=M[1],o=!!((_=e==null?void 0:e.defines)!=null&&_[p])):D?o=!0:o&&r.push(l)}return r.join(`
`)}const d_=class d_{constructor(){pe(this,"_hookFunctions",[]);pe(this,"_defaultModules",[])}static getDefaultShaderAssembler(){return d_.defaultShaderAssembler=d_.defaultShaderAssembler||new d_,d_.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(t=>t.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const t=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(r=>r.name!==t)}addShaderHook(e,t){t&&(e=Object.assign(t,{hook:e})),this._hookFunctions.push(e)}assembleWGSLShader(e){const t=this._getModuleList(e.modules),r=this._hookFunctions,{source:o,getUniforms:p}=MB({...e,source:e.source,modules:t,hookFunctions:r});return{source:e.platformInfo.shaderLanguage==="wgsl"?DB(o):o,getUniforms:p,modules:t}}assembleGLSLShaderPair(e){const t=this._getModuleList(e.modules),r=this._hookFunctions;return{...RB({...e,vs:e.vs,fs:e.fs,modules:t,hookFunctions:r}),modules:t}}_getModuleList(e=[]){const t=new Array(this._defaultModules.length+e.length),r={};let o=0;for(let p=0,_=this._defaultModules.length;p<_;++p){const l=this._defaultModules[p],M=l.name;t[o++]=l,r[M]=!0}for(let p=0,_=e.length;p<_;++p){const l=e[p],M=l.name;r[M]||(t[o++]=l,r[M]=!0)}return t.length=o,Yv(t),t}};pe(d_,"defaultShaderAssembler");let Jv=d_;const OB=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,FB=`#version 300 es
${OB}`;function NB(i){const{input:e,inputChannels:t,output:r}={};if(!e)return FB;if(!t)throw new Error("inputChannels");const o=BB(t),p=zB(e,t);return`#version 300 es
in ${o} ${e};
out vec4 ${r};
void main() {
  ${r} = ${p};
}`}function BB(i){switch(i){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${i}`)}}function zB(i,e){switch(e){case 1:return`vec4(${i}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${i}, 0.0, 1.0)`;case 3:return`vec4(${i}, 1.0)`;case 4:return i;default:throw new Error(`invalid channels: ${e}`)}}class LB{constructor(){pe(this,"stats",new Map)}getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new kx({id:e})),this.stats.get(e)}}const XE=new LB,ni=new S1({id:"luma.gl"}),Rb={};function Fx(i="id"){Rb[i]=Rb[i]||1;const e=Rb[i]++;return`${i}-${e}`}var oA;let us=(oA=class{constructor(e,t,r){pe(this,"id");pe(this,"props");pe(this,"userData",{});pe(this,"_device");pe(this,"destroyed",!1);pe(this,"allocatedBytes",0);pe(this,"_attachedResources",new Set);if(!e)throw new Error("no device");this._device=e,this.props=UB(t,r);const o=this.props.id!=="undefined"?this.props.id:Fx(this[Symbol.toStringTag]);this.props.id=o,this.id=o,this.userData=this.props.userData||{},this.addStats()}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get(`${t}s Active`).decrementCount()}trackAllocatedMemory(e,t=this[Symbol.toStringTag]){const r=this._device.statsManager.getStats("Resource Counts");r.get("GPU Memory").addCount(e),r.get(`${t} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const t=this._device.statsManager.getStats("Resource Counts");t.get("GPU Memory").subtractCount(this.allocatedBytes),t.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${t}s Created`).incrementCount(),e.get(`${t}s Active`).incrementCount()}},pe(oA,"defaultProps",{id:"undefined",handle:void 0,userData:void 0}),oA);function UB(i,e){const t={...e};for(const r in i)i[r]!==void 0&&(t[r]=i[r]);return t}var to;let xa=(to=class extends us{constructor(t,r){const o={...r};(r.usage||0)&to.INDEX&&!r.indexType&&(r.data instanceof Uint32Array?o.indexType="uint32":r.data instanceof Uint16Array?o.indexType="uint16":r.data instanceof Uint8Array&&(o.indexType="uint8")),delete o.data;super(t,o,to.defaultProps);pe(this,"usage");pe(this,"indexType");pe(this,"updateTimestamp");pe(this,"debugData",new ArrayBuffer(0));this.usage=o.usage||0,this.indexType=o.indexType,this.updateTimestamp=t.incrementTimestamp()}get[Symbol.toStringTag](){return"Buffer"}clone(t){return this.device.createBuffer({...this.props,...t})}_setDebugData(t,r,o){const p=ArrayBuffer.isView(t)?t.buffer:t,_=Math.min(t?t.byteLength:o,to.DEBUG_DATA_MAX_LENGTH);p===null?this.debugData=new ArrayBuffer(_):r===0&&o===p.byteLength?this.debugData=p.slice(0,_):this.debugData=p.slice(r,r+_)}},pe(to,"INDEX",16),pe(to,"VERTEX",32),pe(to,"UNIFORM",64),pe(to,"STORAGE",128),pe(to,"INDIRECT",256),pe(to,"QUERY_RESOLVE",512),pe(to,"MAP_READ",1),pe(to,"MAP_WRITE",2),pe(to,"COPY_SRC",4),pe(to,"COPY_DST",8),pe(to,"DEBUG_DATA_MAX_LENGTH",32),pe(to,"defaultProps",{...us.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",onMapped:void 0}),to);function HE(i){const[e,t,r]=Mw[i],o=i.includes("norm"),p=!o&&!i.startsWith("float"),_=i.startsWith("s");return{signedType:e,primitiveType:t,byteLength:r,normalized:o,integer:p,signed:_}}function VB(i){const e=i;switch(e){case"uint8":return"unorm8";case"sint8":return"snorm8";case"uint16":return"unorm16";case"sint16":return"snorm16";default:return e}}function jB(i,e){switch(e){case 1:return i;case 2:return i+i%2;default:return i+(4-i%4)%4}}function Sw(i){const e=ArrayBuffer.isView(i)?i.constructor:i;if(e===Uint8ClampedArray)return"uint8";const t=Object.values(Mw).find(r=>e===r[4]);if(!t)throw new Error(e.name);return t[0]}function Ew(i){const[,,,,e]=Mw[i];return e}const Mw={uint8:["uint8","u32",1,!1,Uint8Array],sint8:["sint8","i32",1,!1,Int8Array],unorm8:["uint8","f32",1,!0,Uint8Array],snorm8:["sint8","f32",1,!0,Int8Array],uint16:["uint16","u32",2,!1,Uint16Array],sint16:["sint16","i32",2,!1,Int16Array],unorm16:["uint16","u32",2,!0,Uint16Array],snorm16:["sint16","i32",2,!0,Int16Array],float16:["float16","f16",2,!1,Uint16Array],float32:["float32","f32",4,!1,Float32Array],uint32:["uint32","u32",4,!1,Uint32Array],sint32:["sint32","i32",4,!1,Int32Array]};function Rw(i){let e;i.endsWith("-webgl")&&(i.replace("-webgl",""),e=!0);const[t,r]=i.split("x"),o=t,p=r?parseInt(r):1,_=HE(o),l={type:o,components:p,byteLength:_.byteLength*p,integer:_.integer,signed:_.signed,normalized:_.normalized};return e&&(l.webglOnly=!0),l}function GB(i,e,t){const r=t?VB(i):i;switch(r){case"unorm8":return e===1?"unorm8":e===3?"unorm8x3-webgl":`${r}x${e}`;case"snorm8":case"uint8":case"sint8":case"uint16":case"sint16":case"unorm16":case"snorm16":case"float16":if(e===1||e===3)throw new Error(`size: ${e}`);return`${r}x${e}`;default:return e===1?r:`${r}x${e}`}}function WB(i,e,t){if(!e||e>4)throw new Error(`size ${e}`);const r=e,o=Sw(i);return GB(o,r,t)}function ZB(i){let e;switch(i.primitiveType){case"f32":e="float32";break;case"i32":e="sint32";break;case"u32":e="uint32";break;case"f16":return i.components<=2?"float16x2":"float16x4"}return i.components===1?e:`${e}x${i.components}`}const Ql="texture-compression-bc",cs="texture-compression-astc",t0="texture-compression-etc2",XB="texture-compression-etc1-webgl",rv="texture-compression-pvrtc-webgl",Cb="texture-compression-atc-webgl",sv="float32-renderable-webgl",Pb="float16-renderable-webgl",HB="rgb9e5ufloat-renderable-webgl",Ib="snorm8-renderable-webgl",F2="norm16-renderable-webgl",kb="snorm16-renderable-webgl",av="float32-filterable",e4="float16-filterable-webgl";function $E(i){const e=YB[i];if(!e)throw new Error(`Unsupported texture format ${i}`);return e}const $B={r8unorm:{},rg8unorm:{},"rgb8unorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},r8snorm:{render:Ib},rg8snorm:{render:Ib},"rgb8snorm-webgl":{},rgba8snorm:{render:Ib},r8uint:{},rg8uint:{},rgba8uint:{},r8sint:{},rg8sint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},r16unorm:{f:F2},rg16unorm:{render:F2},"rgb16unorm-webgl":{f:F2},rgba16unorm:{render:F2},r16snorm:{f:kb},rg16snorm:{render:kb},"rgb16snorm-webgl":{f:F2},rgba16snorm:{render:kb},r16uint:{},rg16uint:{},rgba16uint:{},r16sint:{},rg16sint:{},rgba16sint:{},r16float:{render:Pb,filter:"float16-filterable-webgl"},rg16float:{render:Pb,filter:e4},rgba16float:{render:Pb,filter:e4},r32uint:{},rg32uint:{},rgba32uint:{},r32sint:{},rg32sint:{},rgba32sint:{},r32float:{render:sv,filter:av},rg32float:{render:!1,filter:av},"rgb32float-webgl":{render:sv,filter:av},rgba32float:{render:sv,filter:av},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},rgb9e5ufloat:{channels:"rgb",packed:!0,render:HB},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:sv},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},rgb10a2uint:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0}},qB={"bc1-rgb-unorm-webgl":{f:Ql},"bc1-rgb-unorm-srgb-webgl":{f:Ql},"bc1-rgba-unorm":{f:Ql},"bc1-rgba-unorm-srgb":{f:Ql},"bc2-rgba-unorm":{f:Ql},"bc2-rgba-unorm-srgb":{f:Ql},"bc3-rgba-unorm":{f:Ql},"bc3-rgba-unorm-srgb":{f:Ql},"bc4-r-unorm":{f:Ql},"bc4-r-snorm":{f:Ql},"bc5-rg-unorm":{f:Ql},"bc5-rg-snorm":{f:Ql},"bc6h-rgb-ufloat":{f:Ql},"bc6h-rgb-float":{f:Ql},"bc7-rgba-unorm":{f:Ql},"bc7-rgba-unorm-srgb":{f:Ql},"etc2-rgb8unorm":{f:t0},"etc2-rgb8unorm-srgb":{f:t0},"etc2-rgb8a1unorm":{f:t0},"etc2-rgb8a1unorm-srgb":{f:t0},"etc2-rgba8unorm":{f:t0},"etc2-rgba8unorm-srgb":{f:t0},"eac-r11unorm":{f:t0},"eac-r11snorm":{f:t0},"eac-rg11unorm":{f:t0},"eac-rg11snorm":{f:t0},"astc-4x4-unorm":{f:cs},"astc-4x4-unorm-srgb":{f:cs},"astc-5x4-unorm":{f:cs},"astc-5x4-unorm-srgb":{f:cs},"astc-5x5-unorm":{f:cs},"astc-5x5-unorm-srgb":{f:cs},"astc-6x5-unorm":{f:cs},"astc-6x5-unorm-srgb":{f:cs},"astc-6x6-unorm":{f:cs},"astc-6x6-unorm-srgb":{f:cs},"astc-8x5-unorm":{f:cs},"astc-8x5-unorm-srgb":{f:cs},"astc-8x6-unorm":{f:cs},"astc-8x6-unorm-srgb":{f:cs},"astc-8x8-unorm":{f:cs},"astc-8x8-unorm-srgb":{f:cs},"astc-10x5-unorm":{f:cs},"astc-10x5-unorm-srgb":{f:cs},"astc-10x6-unorm":{f:cs},"astc-10x6-unorm-srgb":{f:cs},"astc-10x8-unorm":{f:cs},"astc-10x8-unorm-srgb":{f:cs},"astc-10x10-unorm":{f:cs},"astc-10x10-unorm-srgb":{f:cs},"astc-12x10-unorm":{f:cs},"astc-12x10-unorm-srgb":{f:cs},"astc-12x12-unorm":{f:cs},"astc-12x12-unorm-srgb":{f:cs},"pvrtc-rgb4unorm-webgl":{f:rv},"pvrtc-rgba4unorm-webgl":{f:rv},"pvrtc-rbg2unorm-webgl":{f:rv},"pvrtc-rgba2unorm-webgl":{f:rv},"etc1-rbg-unorm-webgl":{f:XB},"atc-rgb-unorm-webgl":{f:Cb},"atc-rgba-unorm-webgl":{f:Cb},"atc-rgbai-unorm-webgl":{f:Cb}},YB={...$B,...qB},JB=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],QB=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;class KB{getInfo(e){return t4(e)}isColor(e){return e.startsWith("rgba")||e.startsWith("bgra")||e.startsWith("rgb")}isDepthStencil(e){return e.startsWith("depth")||e.startsWith("stencil")}isCompressed(e){return JB.some(t=>e.startsWith(t))}getCapabilities(e){const t=$E(e),r={format:e,create:t.f??!0,render:t.render??!0,filter:t.filter??!0,blend:t.blend??!0,store:t.store??!0},o=t4(e),p=e.startsWith("depth")||e.startsWith("stencil"),_=o==null?void 0:o.signed,l=o==null?void 0:o.integer,M=o==null?void 0:o.webgl;return r.render&&(r.render=!_),r.filter&&(r.filter=!p&&!_&&!l&&!M),r}}const Xy=new KB;function t4(i){let e=ez(i);if(Xy.isCompressed(i)){e.channels="rgb",e.components=3,e.bytesPerPixel=1,e.srgb=!1,e.compressed=!0;const r=tz(i);r&&(e.blockWidth=r.blockWidth,e.blockHeight=r.blockHeight)}const t=QB.exec(i);if(t){const[,r,o,p,_,l]=t,M=`${p}${o}`,D=HE(M),B=D.byteLength*8,j=r.length,$=[B,j>=2?B:0,j>=3?B:0,j>=4?B:0];e={format:i,attachment:e.attachment,dataType:D.signedType,components:j,channels:r,integer:D.integer,signed:D.signed,normalized:D.normalized,bitsPerChannel:$,bytesPerPixel:D.byteLength*r.length,packed:e.packed,srgb:e.srgb},l==="-webgl"&&(e.webgl=!0),_==="-srgb"&&(e.srgb=!0)}return i.endsWith("-webgl")&&(e.webgl=!0),i.endsWith("-srgb")&&(e.srgb=!0),e}function ez(i){var p;const e=$E(i),t=e.bytesPerPixel||1,r=e.bitsPerChannel||[8,8,8,8];return delete e.bitsPerChannel,delete e.bytesPerPixel,delete e.f,delete e.render,delete e.filter,delete e.blend,delete e.store,{...e,format:i,attachment:e.attachment||"color",channels:e.channels||"r",components:e.components||((p=e.channels)==null?void 0:p.length)||1,bytesPerPixel:t,bitsPerChannel:r,dataType:e.dataType||"uint8",srgb:e.srgb??!1,packed:e.packed??!1,webgl:e.webgl??!1,integer:e.integer??!1,signed:e.signed??!1,normalized:e.normalized??!1,compressed:e.compressed??!1}}function tz(i){const t=/.*-(\d+)x(\d+)-.*/.exec(i);if(t){const[,r,o]=t;return{blockWidth:Number(r),blockHeight:Number(o)}}return null}function iz(i){return typeof ImageData<"u"&&i instanceof ImageData||typeof ImageBitmap<"u"&&i instanceof ImageBitmap||typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement||typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement||typeof VideoFrame<"u"&&i instanceof VideoFrame||typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&i instanceof OffscreenCanvas}function nz(i){if(typeof ImageData<"u"&&i instanceof ImageData||typeof ImageBitmap<"u"&&i instanceof ImageBitmap||typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&i instanceof OffscreenCanvas)return{width:i.width,height:i.height};if(typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement)return{width:i.naturalWidth,height:i.naturalHeight};if(typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement)return{width:i.videoWidth,height:i.videoHeight};if(typeof VideoFrame<"u"&&i instanceof VideoFrame)return{width:i.displayWidth,height:i.displayHeight};throw new Error("Unknown image type")}class rz{}class sz{constructor(e=[],t){pe(this,"features");pe(this,"disabledFeatures");this.features=new Set(e),this.disabledFeatures=t||{}}*[Symbol.iterator](){yield*this.features}has(e){var t;return!((t=this.disabledFeatures)!=null&&t[e])&&this.features.has(e)}}const mx=class mx{constructor(e){pe(this,"id");pe(this,"props");pe(this,"userData",{});pe(this,"statsManager",XE);pe(this,"timestamp",0);pe(this,"_reused",!1);pe(this,"_lumaData",{});pe(this,"_textureCaps",{});this.props={...mx.defaultProps,...e},this.id=this.props.id||Fx(this[Symbol.toStringTag].toLowerCase())}get[Symbol.toStringTag](){return"Device"}toString(){return`Device(${this.id})`}getVertexFormatInfo(e){return Rw(e)}isVertexFormatSupported(e){return!0}getTextureFormatInfo(e){return Xy.getInfo(e)}getTextureFormatCapabilities(e){let t=this._textureCaps[e];if(!t){const r=this._getDeviceTextureFormatCapabilities(e);t=this._getDeviceSpecificTextureFormatCapabilities(r),this._textureCaps[e]=t}return t}getMipLevelCount(e,t,r=1){const o=Math.max(e,t,r);return 1+Math.floor(Math.log2(o))}isExternalImage(e){return iz(e)}getExternalImageSize(e){return nz(e)}isTextureFormatSupported(e){return this.getTextureFormatCapabilities(e).create}isTextureFormatFilterable(e){return this.getTextureFormatCapabilities(e).filter}isTextureFormatRenderable(e){return this.getTextureFormatCapabilities(e).render}isTextureFormatCompressed(e){return Xy.isCompressed(e)}pushDebugGroup(e){this.commandEncoder.pushDebugGroup(e)}popDebugGroup(){var e;(e=this.commandEncoder)==null||e.popDebugGroup()}insertDebugMarker(e){var t;(t=this.commandEncoder)==null||t.insertDebugMarker(e)}loseDevice(){return!1}incrementTimestamp(){return this.timestamp++}reportError(e,t,...r){return this.props.onError(e,t)?()=>{}:ni.error(e.message,t,...r)}debug(){if(this.props.debug)debugger;else ni.once(0,`'Type luma.log.set({debug: true}) in console to enable debug breakpoints',
or create a device with the 'debug: true' prop.`)()}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}beginRenderPass(e){return this.commandEncoder.beginRenderPass(e)}beginComputePass(e){return this.commandEncoder.beginComputePass(e)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(e,t){throw new Error("not implemented")}readPixelsToBufferWebGL(e,t){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,t){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(e){return e.createCanvasContext===!0?{}:e.createCanvasContext}_getDeviceTextureFormatCapabilities(e){const t=Xy.getCapabilities(e),r=p=>(typeof p=="string"?this.features.has(p):p)??!0,o=r(t.create);return{format:e,create:o,render:o&&r(t.render),filter:o&&r(t.filter),blend:o&&r(t.blend),store:o&&r(t.store)}}_normalizeBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const t={...e};if((e.usage||0)&xa.INDEX&&(e.indexType||(e.data instanceof Uint32Array?t.indexType="uint32":e.data instanceof Uint16Array?t.indexType="uint16":e.data instanceof Uint8Array&&(t.data=new Uint16Array(e.data),t.indexType="uint16")),!t.indexType))throw new Error("indices buffer content must be of type uint16 or uint32");return t}};pe(mx,"defaultProps",{id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,webgl:{},onError:(e,t)=>{},onResize:(e,t)=>{const[r,o]=e.getDevicePixelSize();ni.log(1,`${e} resized => ${r}x${o}px`)()},onPositionChange:(e,t)=>{const[r,o]=e.getPosition();ni.log(1,`${e} repositioned => ${r},${o}`)()},onVisibilityChange:e=>ni.log(1,`${e} Visibility changed ${e.isVisible}`)(),onDevicePixelRatioChange:(e,t)=>ni.log(1,`${e} DPR changed ${t.oldRatio} => ${e.devicePixelRatio}`)(),debug:ni.get("debug")||void 0,debugShaders:ni.get("debug-shaders")||void 0,debugFramebuffers:!!ni.get("debug-framebuffers"),debugFactories:!!ni.get("debug-factories"),debugWebGL:!!ni.get("debug-webgl"),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_reuseDevices:!1,_requestMaxLimits:!0,_cacheShaders:!1,_cachePipelines:!1,_cacheDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_handle:void 0});let T_=mx;const az="set luma.log.level=1 (or higher) to trace rendering",i4="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.",o1=class o1{constructor(){pe(this,"stats",XE);pe(this,"log",ni);pe(this,"VERSION","9.2.6");pe(this,"spector");pe(this,"preregisteredAdapters",new Map);if(globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw ni.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),ni.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");ni.error("This version of luma.gl has already been initialized")()}ni.log(1,`${this.VERSION} - ${az}`)(),globalThis.luma=this}async createDevice(e={}){const t={...o1.defaultProps,...e},r=this.selectAdapter(t.type,t.adapters);if(!r)throw new Error(i4);return t.waitForPageLoad&&await r.pageLoaded,await r.create(t)}async attachDevice(e,t){var p;const r=this._getTypeFromHandle(e,t.adapters),o=r&&this.selectAdapter(r,t.adapters);if(!o)throw new Error(i4);return await((p=o==null?void 0:o.attach)==null?void 0:p.call(o,e,t))}registerAdapters(e){for(const t of e)this.preregisteredAdapters.set(t.type,t)}getSupportedAdapters(e=[]){const t=this._getAdapterMap(e);return Array.from(t).map(([,r])=>r).filter(r=>{var o;return(o=r.isSupported)==null?void 0:o.call(r)}).map(r=>r.type)}getBestAvailableAdapterType(e=[]){var o,p;const t=["webgpu","webgl","null"],r=this._getAdapterMap(e);for(const _ of t)if((p=(o=r.get(_))==null?void 0:o.isSupported)!=null&&p.call(o))return _;return null}selectAdapter(e,t=[]){let r=e;e==="best-available"&&(r=this.getBestAvailableAdapterType(t));const o=this._getAdapterMap(t);return r&&o.get(r)||null}enforceWebGL2(e=!0,t=[]){var p;const o=this._getAdapterMap(t).get("webgl");o||ni.warn("enforceWebGL2: webgl adapter not found")(),(p=o==null?void 0:o.enforceWebGL2)==null||p.call(o,e)}setDefaultDeviceProps(e){Object.assign(o1.defaultProps,e)}_getAdapterMap(e=[]){const t=new Map(this.preregisteredAdapters);for(const r of e)t.set(r.type,r);return t}_getTypeFromHandle(e,t=[]){return e instanceof WebGL2RenderingContext?"webgl":typeof GPUDevice<"u"&&e instanceof GPUDevice||e!=null&&e.queue?"webgpu":e===null?"null":(e instanceof WebGLRenderingContext?ni.warn("WebGL1 is not supported",e)():ni.warn("Unknown handle type",e)(),null)}};pe(o1,"defaultProps",{...T_.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0});let AA=o1;const wA=new AA;class oz{get pageLoaded(){return uz()}}const lz=C_()&&typeof document<"u",cz=()=>lz&&document.readyState==="complete";let ov=null;function uz(){return ov||(cz()||typeof window>"u"?ov=Promise.resolve():ov=new Promise(i=>window.addEventListener("load",()=>i()))),ov}function hz(){let i,e;return{promise:new Promise((r,o)=>{i=r,e=o}),resolve:i,reject:e}}const p_=class p_{constructor(e){pe(this,"id");pe(this,"props");pe(this,"canvas");pe(this,"htmlCanvas");pe(this,"offscreenCanvas");pe(this,"type");pe(this,"initialized");pe(this,"isInitialized",!1);pe(this,"isVisible",!0);pe(this,"cssWidth");pe(this,"cssHeight");pe(this,"devicePixelRatio");pe(this,"devicePixelWidth");pe(this,"devicePixelHeight");pe(this,"drawingBufferWidth");pe(this,"drawingBufferHeight");pe(this,"_initializedResolvers",hz());pe(this,"_resizeObserver");pe(this,"_intersectionObserver");pe(this,"_position");pe(this,"destroyed",!1);var t,r;if(this.props={...p_.defaultProps,...e},e=this.props,this.initialized=this._initializedResolvers.promise,C_()?e.canvas?typeof e.canvas=="string"?this.canvas=dz(e.canvas):this.canvas=e.canvas:this.canvas=pz(e):this.canvas={width:e.width||1,height:e.height||1},p_.isHTMLCanvas(this.canvas)?(this.id=e.id||this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):p_.isOffscreenCanvas(this.canvas)?(this.id=e.id||"offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas):(this.id=e.id||"node-canvas-context",this.type="node"),this.cssWidth=((t=this.htmlCanvas)==null?void 0:t.clientWidth)||this.canvas.width,this.cssHeight=((r=this.htmlCanvas)==null?void 0:r.clientHeight)||this.canvas.height,this.devicePixelWidth=this.canvas.width,this.devicePixelHeight=this.canvas.height,this.drawingBufferWidth=this.canvas.width,this.drawingBufferHeight=this.canvas.height,this.devicePixelRatio=globalThis.devicePixelRatio||1,this._position=[0,0],p_.isHTMLCanvas(this.canvas)){this._intersectionObserver=new IntersectionObserver(o=>this._handleIntersection(o)),this._intersectionObserver.observe(this.canvas),this._resizeObserver=new ResizeObserver(o=>this._handleResize(o));try{this._resizeObserver.observe(this.canvas,{box:"device-pixel-content-box"})}catch{this._resizeObserver.observe(this.canvas,{box:"content-box"})}setTimeout(()=>this._observeDevicePixelRatio(),0),this.props.trackPosition&&this._trackPosition()}}static isHTMLCanvas(e){return typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement}static isOffscreenCanvas(e){return typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas}toString(){return`${this[Symbol.toStringTag]}(${this.id})`}destroy(){this.destroyed=!0}setProps(e){return"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1,this._updateDrawingBufferSize()),this}getCSSSize(){return[this.cssWidth,this.cssHeight]}getPosition(){return this._position}getDevicePixelSize(){return[this.devicePixelWidth,this.devicePixelHeight]}getDrawingBufferSize(){return[this.drawingBufferWidth,this.drawingBufferHeight]}getMaxDrawingBufferSize(){const e=this.device.limits.maxTextureDimension2D;return[e,e]}setDrawingBufferSize(e,t){this.canvas.width=e,this.canvas.height=t,this.drawingBufferWidth=e,this.drawingBufferHeight=t}getDevicePixelRatio(){return typeof window<"u"&&window.devicePixelRatio||1}cssToDevicePixels(e,t=!0){const r=this.cssToDeviceRatio(),[o,p]=this.getDrawingBufferSize();return gz(e,r,o,p,t)}getPixelSize(){return this.getDevicePixelSize()}getAspect(){const[e,t]=this.getDevicePixelSize();return e/t}cssToDeviceRatio(){try{const[e]=this.getDrawingBufferSize(),[t]=this.getCSSSize();return t?e/t:1}catch{return 1}}resize(e){this.setDrawingBufferSize(e.width,e.height)}_setAutoCreatedCanvasId(e){var t;((t=this.htmlCanvas)==null?void 0:t.id)==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}_handleIntersection(e){const t=e.find(o=>o.target===this.canvas);if(!t)return;const r=t.isIntersecting;this.isVisible!==r&&(this.isVisible=r,this.device.props.onVisibilityChange(this))}_handleResize(e){var M,D;const t=e.find(B=>B.target===this.canvas);if(!t)return;this.cssWidth=t.contentBoxSize[0].inlineSize,this.cssHeight=t.contentBoxSize[0].blockSize;const r=this.getDevicePixelSize(),o=((M=t.devicePixelContentBoxSize)==null?void 0:M[0].inlineSize)||t.contentBoxSize[0].inlineSize*devicePixelRatio,p=((D=t.devicePixelContentBoxSize)==null?void 0:D[0].blockSize)||t.contentBoxSize[0].blockSize*devicePixelRatio,[_,l]=this.getMaxDrawingBufferSize();this.devicePixelWidth=Math.max(1,Math.min(o,_)),this.devicePixelHeight=Math.max(1,Math.min(p,l)),this._updateDrawingBufferSize(),this.device.props.onResize(this,{oldPixelSize:r})}_updateDrawingBufferSize(){if(this.props.autoResize){if(typeof this.props.useDevicePixels=="number"){const e=this.props.useDevicePixels;this.setDrawingBufferSize(this.cssWidth*e,this.cssHeight*e)}else this.props.useDevicePixels?this.setDrawingBufferSize(this.devicePixelWidth,this.devicePixelHeight):this.setDrawingBufferSize(this.cssWidth,this.cssHeight);this._updateDevice()}this._initializedResolvers.resolve(),this.isInitialized=!0,this.updatePosition()}_observeDevicePixelRatio(){const e=this.devicePixelRatio;this.devicePixelRatio=window.devicePixelRatio,this.updatePosition(),this.device.props.onDevicePixelRatioChange(this,{oldRatio:e}),matchMedia(`(resolution: ${this.devicePixelRatio}dppx)`).addEventListener("change",()=>this._observeDevicePixelRatio(),{once:!0})}_trackPosition(e=100){const t=setInterval(()=>{this.destroyed?clearInterval(t):this.updatePosition()},e)}updatePosition(){var t,r,o;const e=(t=this.htmlCanvas)==null?void 0:t.getBoundingClientRect();if(e){const p=[e.left,e.top];if(this._position??(this._position=p),p[0]!==this._position[0]||p[1]!==this._position[1]){const l=this._position;this._position=p,(o=(r=this.device.props).onPositionChange)==null||o.call(r,this,{oldPosition:l})}}}};pe(p_,"defaultProps",{id:void 0,canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb",trackPosition:!1});let Qv=p_;function fz(i){if(typeof i=="string"){const e=document.getElementById(i);if(!e)throw new Error(`${i} is not an HTML element`);return e}return i||document.body}function dz(i){const e=document.getElementById(i);if(!Qv.isHTMLCanvas(e))throw new Error("Object is not a canvas element");return e}function pz(i){const{width:e,height:t}=i,r=document.createElement("canvas");r.id=Fx("lumagl-auto-created-canvas"),r.width=e||1,r.height=t||1,r.style.width=Number.isFinite(e)?`${e}px`:"100%",r.style.height=Number.isFinite(t)?`${t}px`:"100%",i!=null&&i.visible||(r.style.visibility="hidden");const o=fz((i==null?void 0:i.container)||null);return o.insertBefore(r,o.firstChild),r}function gz(i,e,t,r,o){const p=i,_=n4(p[0],e,t);let l=r4(p[1],e,r,o),M=n4(p[0]+1,e,t);const D=M===t-1?M:M-1;M=r4(p[1]+1,e,r,o);let B;return o?(M=M===0?M:M+1,B=l,l=M):B=M===r-1?M:M-1,{x:_,y:l,width:Math.max(D-_+1,1),height:Math.max(B-l+1,1)}}function n4(i,e,t){return Math.min(Math.round(i*e),t-1)}function r4(i,e,t,r){return r?Math.max(0,t-1-Math.round(i*e)):Math.min(Math.round(i*e),t-1)}const l1=class l1 extends us{get[Symbol.toStringTag](){return"Sampler"}constructor(e,t){t=l1.normalizeProps(e,t),super(e,t,l1.defaultProps)}static normalizeProps(e,t){return t}};pe(l1,"defaultProps",{...us.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1});let Yy=l1;const mz={"1d":"1d","2d":"2d","2d-array":"2d",cube:"2d","cube-array":"2d","3d":"3d"},Eo=class Eo extends us{constructor(t,r){r=Eo.normalizeProps(t,r);super(t,r,Eo.defaultProps);pe(this,"dimension");pe(this,"baseDimension");pe(this,"format");pe(this,"width");pe(this,"height");pe(this,"depth");pe(this,"mipLevels");pe(this,"updateTimestamp");if(this.dimension=this.props.dimension,this.baseDimension=mz[this.dimension],this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.mipLevels=this.props.mipLevels,this.props.width===void 0||this.props.height===void 0)if(t.isExternalImage(r.data)){const o=t.getExternalImageSize(r.data);this.width=(o==null?void 0:o.width)||1,this.height=(o==null?void 0:o.height)||1}else this.width=1,this.height=1,(this.props.width===void 0||this.props.height===void 0)&&ni.warn(`${this} created with undefined width or height. This is deprecated. Use AsyncTexture instead.`)();this.updateTimestamp=t.incrementTimestamp()}get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}setSampler(t){this.sampler=t instanceof Yy?t:this.device.createSampler(t)}clone(t){return this.device.createTexture({...this.props,...t})}static normalizeProps(t,r){const o={...r},{width:p,height:_}=o;return typeof p=="number"&&(o.width=Math.max(1,Math.ceil(p))),typeof _=="number"&&(o.height=Math.max(1,Math.ceil(_))),o}_initializeData(t){this.device.isExternalImage(t)?this.copyExternalImage({image:t,width:this.width,height:this.height,depth:this.depth,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1}):t&&this.copyImageData({data:t,mipLevel:0,x:0,y:0,z:0,aspect:"all"})}_normalizeCopyImageDataOptions(t){const{width:r,height:o,depth:p}=this,_={...Eo.defaultCopyDataOptions,width:r,height:o,depth:p,...t},l=this.device.getTextureFormatInfo(this.format);if(!t.bytesPerRow&&!l.bytesPerPixel)throw new Error(`bytesPerRow must be provided for texture format ${this.format}`);return _.bytesPerRow=t.bytesPerRow||r*(l.bytesPerPixel||4),_.rowsPerImage=t.rowsPerImage||o,_}_normalizeCopyExternalImageOptions(t){const r=this.device.getExternalImageSize(t.image),o={...Eo.defaultCopyExternalImageOptions,...r,...t};return o.width=Math.min(o.width,this.width-o.x),o.height=Math.min(o.height,this.height-o.y),o}};pe(Eo,"SAMPLE",4),pe(Eo,"STORAGE",8),pe(Eo,"RENDER",16),pe(Eo,"COPY_SRC",1),pe(Eo,"COPY_DST",2),pe(Eo,"TEXTURE",4),pe(Eo,"RENDER_ATTACHMENT",16),pe(Eo,"defaultProps",{...us.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",usage:Eo.TEXTURE|Eo.RENDER_ATTACHMENT|Eo.COPY_DST,width:void 0,height:void 0,depth:1,mipLevels:1,samples:void 0,sampler:{},view:void 0}),pe(Eo,"defaultCopyDataOptions",{data:void 0,byteOffset:0,bytesPerRow:void 0,rowsPerImage:void 0,mipLevel:0,x:0,y:0,z:0,aspect:"all"}),pe(Eo,"defaultCopyExternalImageOptions",{image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1});let lh=Eo;const _x=class _x extends us{get[Symbol.toStringTag](){return"TextureView"}constructor(e,t){super(e,t,_x.defaultProps)}};pe(_x,"defaultProps",{...us.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0});let Kv=_x;function _z(i,e,t){let r="";const o=e.split(/\r?\n/),p=i.slice().sort((_,l)=>_.lineNum-l.lineNum);switch((t==null?void 0:t.showSourceCode)||"no"){case"all":let _=0;for(let l=1;l<=o.length;l++)for(r+=qE(o[l-1],l,t);p.length>_&&p[_].lineNum===l;){const M=p[_++];r+=Db(M,o,M.lineNum,{...t,inlineSource:!1})}for(;p.length>_;){const l=p[_++];r+=Db(l,[],0,{...t,inlineSource:!1})}return r;case"issues":case"no":for(const l of i)r+=Db(l,o,l.lineNum,{inlineSource:(t==null?void 0:t.showSourceCode)!=="no"});return r}}function Db(i,e,t,r){if(r!=null&&r.inlineSource){const p=yz(e,t),_=i.linePos>0?`${" ".repeat(i.linePos+5)}^^^
`:"";return`
${p}${_}${i.type.toUpperCase()}: ${i.message}

`}const o=i.type==="error"?"red":"#8B4000";return r!=null&&r.html?`<div class='luma-compiler-log-error' style="color:${o};"><b> ${i.type.toUpperCase()}: ${i.message}</b></div>`:`${i.type.toUpperCase()}: ${i.message}`}function yz(i,e,t){let r="";for(let o=e-2;o<=e;o++){const p=i[o-1];p!==void 0&&(r+=qE(p,e,t))}return r}function qE(i,e,t){const r=t!=null&&t.html?xz(i):i;return`${vz(String(e),4)}: ${r}${t!=null&&t.html?"<br/>":`
`}`}function vz(i,e){let t="";for(let r=i.length;r<e;++r)t+=" ";return t+i}function xz(i){return i.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}const yx=class yx extends us{constructor(t,r){r={...r,debugShaders:r.debugShaders||t.props.debugShaders||"errors"};super(t,{id:bz(r),...r},yx.defaultProps);pe(this,"stage");pe(this,"source");pe(this,"compilationStatus","pending");this.stage=this.props.stage,this.source=this.props.source}get[Symbol.toStringTag](){return"Shader"}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){const t=this.props.debugShaders;switch(t){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const r=await this.getCompilationInfo();t==="warnings"&&(r==null?void 0:r.length)===0||this._displayShaderLog(r,this.id)}_displayShaderLog(t,r){var B;if(typeof document>"u"||!(document!=null&&document.createElement))return;const o=r,p=`${this.stage} shader "${o}"`;let _=_z(t,this.source,{showSourceCode:"all",html:!0});const l=this.getTranslatedSource();l&&(_+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${l}</pre></code>`);const M=document.createElement("Button");M.innerHTML=`
<h1>Compilation error in ${p}</h1><br /><br />
<code style="user-select:text;"><pre>
${_}
</pre></code>`,M.style.top="10px",M.style.left="10px",M.style.position="absolute",M.style.zIndex="9999",M.style.width="100%",M.style.textAlign="left",document.body.appendChild(M),(B=document.getElementsByClassName("luma-compiler-log-error")[0])==null||B.scrollIntoView(),M.onclick=()=>{const j=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(j)}}};pe(yx,"defaultProps",{...us.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0});let ex=yx;function bz(i){return Az(i.source)||i.id||Fx(`unnamed ${i.stage}-shader`)}function Az(i,e="unnamed"){const r=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(i);return r?r[1]:e}const vx=class vx extends us{constructor(t,r={}){super(t,r,vx.defaultProps);pe(this,"width");pe(this,"height");this.width=this.props.width,this.height=this.props.height}get[Symbol.toStringTag](){return"Framebuffer"}clone(t){const r=this.colorAttachments.map(p=>p.texture.clone(t)),o=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(t);return this.device.createFramebuffer({...this.props,colorAttachments:r,depthStencilAttachment:o})}resize(t){let r=!t;if(t){const[o,p]=Array.isArray(t)?t:[t.width,t.height];r=r||p!==this.height||o!==this.width,this.width=o,this.height=p}r&&(ni.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((r,o)=>{if(typeof r=="string"){const p=this.createColorTexture(r,o);return this.attachResource(p),p.view}return r instanceof lh?r.view:r});const t=this.props.depthStencilAttachment;if(t)if(typeof t=="string"){const r=this.createDepthStencilTexture(t);this.attachResource(r),this.depthStencilAttachment=r.view}else t instanceof lh?this.depthStencilAttachment=t.view:this.depthStencilAttachment=t}createColorTexture(t,r){return this.device.createTexture({id:`${this.id}-color-attachment-${r}`,usage:lh.RENDER_ATTACHMENT,format:t,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(t){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:lh.RENDER_ATTACHMENT,format:t,width:this.width,height:this.height})}resizeAttachments(t,r){for(let o=0;o<this.colorAttachments.length;++o)if(this.colorAttachments[o]){const p=this.colorAttachments[o].texture.clone({width:t,height:r});this.destroyAttachedResource(this.colorAttachments[o]),this.colorAttachments[o]=p.view,this.attachResource(p.view)}if(this.depthStencilAttachment){const o=this.depthStencilAttachment.texture.clone({width:t,height:r});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=o.view,this.attachResource(o)}this.updateAttachments()}};pe(vx,"defaultProps",{...us.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null});let tx=vx;const xx=class xx extends us{constructor(t,r){super(t,r,xx.defaultProps);pe(this,"shaderLayout");pe(this,"bufferLayout");pe(this,"linkStatus","pending");pe(this,"hash","");this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}get[Symbol.toStringTag](){return"RenderPipeline"}};pe(xx,"defaultProps",{...us.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",colorAttachmentFormats:void 0,depthStencilAttachmentFormat:void 0,parameters:{},bindings:{},uniforms:{}});let __=xx;const Jf=class Jf extends us{get[Symbol.toStringTag](){return"RenderPass"}constructor(e,t){t=Jf.normalizeProps(e,t),super(e,t,Jf.defaultProps)}static normalizeProps(e,t){return t}};pe(Jf,"defaultClearColor",[0,0,0,1]),pe(Jf,"defaultClearDepth",1),pe(Jf,"defaultClearStencil",0),pe(Jf,"defaultProps",{...us.defaultProps,framebuffer:null,parameters:void 0,clearColor:Jf.defaultClearColor,clearColors:void 0,clearDepth:Jf.defaultClearDepth,clearStencil:Jf.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0});let TA=Jf;const bx=class bx extends us{constructor(t,r){super(t,r,bx.defaultProps);pe(this,"hash","");pe(this,"shaderLayout");this.shaderLayout=r.shaderLayout}get[Symbol.toStringTag](){return"ComputePipeline"}};pe(bx,"defaultProps",{...us.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0});let ix=bx;const Ax=class Ax extends us{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,t){super(e,t,Ax.defaultProps)}};pe(Ax,"defaultProps",{...us.defaultProps,measureExecutionTime:void 0});let SA=Ax;const wx=class wx extends us{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,t){super(e,t,wx.defaultProps)}};pe(wx,"defaultProps",{...us.defaultProps});let EA=wx;function YE(i){return Ez[i]}function wz(i){const[e,t]=Sz[i],r=e==="i32"||e==="u32",o=e!=="u32",p=Tz[e]*t;return{primitiveType:e,components:t,byteLength:p,integer:r,signed:o}}const Tz={f32:4,f16:2,i32:4,u32:4},Sz={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},Ez={f32:{type:"f32",components:1},f16:{type:"f16",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<f16>":{type:"f16",components:2},"vec3<f16>":{type:"f16",components:3},"vec4<f16>":{type:"f16",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16},"mat2x2<f16>":{type:"f16",components:4},"mat2x3<f16>":{type:"f16",components:6},"mat2x4<f16>":{type:"f16",components:8},"mat3x2<f16>":{type:"f16",components:6},"mat3x3<f16>":{type:"f16",components:9},"mat3x4<f16>":{type:"f16",components:12},"mat4x2<f16>":{type:"f16",components:8},"mat4x3<f16>":{type:"f16",components:12},"mat4x4<f16>":{type:"f16",components:16},"mat2x2<i32>":{type:"i32",components:4},"mat2x3<i32>":{type:"i32",components:6},"mat2x4<i32>":{type:"i32",components:8},"mat3x2<i32>":{type:"i32",components:6},"mat3x3<i32>":{type:"i32",components:9},"mat3x4<i32>":{type:"i32",components:12},"mat4x2<i32>":{type:"i32",components:8},"mat4x3<i32>":{type:"i32",components:12},"mat4x4<i32>":{type:"i32",components:16},"mat2x2<u32>":{type:"u32",components:4},"mat2x3<u32>":{type:"u32",components:6},"mat2x4<u32>":{type:"u32",components:8},"mat3x2<u32>":{type:"u32",components:6},"mat3x3<u32>":{type:"u32",components:9},"mat3x4<u32>":{type:"u32",components:12},"mat4x2<u32>":{type:"u32",components:8},"mat4x3<u32>":{type:"u32",components:12},"mat4x4<u32>":{type:"u32",components:16}};function JE(i,e){const t={};for(const r of i.attributes){const o=Rz(i,e,r.name);o&&(t[r.name]=o)}return t}function Mz(i,e,t=16){const r=JE(i,e),o=new Array(t).fill(null);for(const p of Object.values(r))o[p.location]=p;return o}function Rz(i,e,t){const r=Cz(i,t),o=Pz(e,t);if(!r)return null;const p=wz(r.type),_=ZB(p),l=(o==null?void 0:o.vertexFormat)||_,M=Rw(l);return{attributeName:(o==null?void 0:o.attributeName)||r.name,bufferName:(o==null?void 0:o.bufferName)||r.name,location:r.location,shaderType:r.type,primitiveType:p.primitiveType,shaderComponents:p.components,vertexFormat:l,bufferDataType:M.type,bufferComponents:M.components,normalized:M.normalized,integer:p.integer,stepMode:(o==null?void 0:o.stepMode)||r.stepMode||"vertex",byteOffset:(o==null?void 0:o.byteOffset)||0,byteStride:(o==null?void 0:o.byteStride)||0}}function Cz(i,e){const t=i.attributes.find(r=>r.name===e);return t||ni.warn(`shader layout attribute "${e}" not present in shader`),t||null}function Pz(i,e){Iz(i);let t=kz(i,e);return t||(t=Dz(i,e),t)?t:(ni.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function Iz(i){for(const e of i)(e.attributes&&e.format||!e.attributes&&!e.format)&&ni.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function kz(i,e){for(const t of i)if(t.format&&t.name===e)return{attributeName:t.name,bufferName:e,stepMode:t.stepMode,vertexFormat:t.format,byteOffset:0,byteStride:t.byteStride||0};return null}function Dz(i,e){var t;for(const r of i){let o=r.byteStride;if(typeof r.byteStride!="number")for(const _ of r.attributes||[]){const l=Rw(_.format);o+=l.byteLength}const p=(t=r.attributes)==null?void 0:t.find(_=>_.attribute===e);if(p)return{attributeName:p.attribute,bufferName:r.name,stepMode:r.stepMode,vertexFormat:p.format,byteOffset:p.byteOffset,byteStride:o}}return null}const Tx=class Tx extends us{constructor(t,r){super(t,r,Tx.defaultProps);pe(this,"maxVertexAttributes");pe(this,"attributeInfos");pe(this,"indexBuffer",null);pe(this,"attributes");this.maxVertexAttributes=t.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null),this.attributeInfos=Mz(r.shaderLayout,r.bufferLayout,this.maxVertexAttributes)}get[Symbol.toStringTag](){return"VertexArray"}setConstantWebGL(t,r){this.device.reportError(new Error("constant attributes not supported"),this)()}};pe(Tx,"defaultProps",{...us.defaultProps,shaderLayout:void 0,bufferLayout:[]});let MA=Tx;const Sx=class Sx extends us{get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,t){super(e,t,Sx.defaultProps)}};pe(Sx,"defaultProps",{...us.defaultProps,layout:void 0,buffers:{}});let RA=Sx;const Ex=class Ex extends us{get[Symbol.toStringTag](){return"QuerySet"}constructor(e,t){super(e,t,Ex.defaultProps)}};pe(Ex,"defaultProps",{...us.defaultProps,type:void 0,count:void 0});let CA=Ex,lv;function QE(i){return(!lv||lv.byteLength<i)&&(lv=new ArrayBuffer(i)),lv}function Oz(i,e){const t=QE(i.BYTES_PER_ELEMENT*e);return new i(t,0,e)}function Fz(i){return ArrayBuffer.isView(i)&&!(i instanceof DataView)}function nx(i){return Array.isArray(i)?i.length===0||typeof i[0]=="number":Fz(i)}const Nz=1024;class Bz{constructor(e,t={}){pe(this,"layout",{});pe(this,"byteLength");let r=0;for(const[p,_]of Object.entries(e)){const l=YE(_),{type:M,components:D}=l,B=D*((t==null?void 0:t[p])??1);r=jB(r,B);const j=r;r+=B,this.layout[p]={type:M,size:B,offset:j}}r+=(4-r%4)%4;const o=r*4;this.byteLength=Math.max(o,Nz)}getData(e){const t=QE(this.byteLength),r={i32:new Int32Array(t),u32:new Uint32Array(t),f32:new Float32Array(t),f16:new Uint16Array(t)};for(const[o,p]of Object.entries(e)){const _=this.layout[o];if(!_){ni.warn(`Supplied uniform value ${o} not present in uniform block layout`)();continue}const{type:l,size:M,offset:D}=_,B=r[l];if(M===1){if(typeof p!="number"&&typeof p!="boolean"){ni.warn(`Supplied value for single component uniform ${o} is not a number: ${p}`)();continue}B[D]=Number(p)}else{if(!nx(p)){ni.warn(`Supplied value for multi component / array uniform ${o} is not a numeric array: ${p}`)();continue}B.set(p,D)}}return new Uint8Array(t,0,this.byteLength)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function zz(i,e,t=16){if(i!==e)return!1;const r=i,o=e;if(!nx(r))return!1;if(nx(o)&&r.length===o.length){for(let p=0;p<r.length;++p)if(o[p]!==r[p])return!1}return!0}function Lz(i){return nx(i)?i.slice():i}class Uz{constructor(e){pe(this,"name");pe(this,"uniforms",{});pe(this,"modifiedUniforms",{});pe(this,"modified",!0);pe(this,"bindingLayout",{});pe(this,"needsRedraw","initialized");var t;if(this.name=(e==null?void 0:e.name)||"unnamed",e!=null&&e.name&&(e!=null&&e.shaderLayout)){const r=(t=e==null?void 0:e.shaderLayout.bindings)==null?void 0:t.find(p=>p.type==="uniform"&&p.name===(e==null?void 0:e.name));if(!r)throw new Error(e==null?void 0:e.name);const o=r;for(const p of o.uniforms||[])this.bindingLayout[p.name]=p}}setUniforms(e){for(const[t,r]of Object.entries(e))this._setUniform(t,r),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${t}=${r}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,t){zz(this.uniforms[e],t)||(this.uniforms[e]=Lz(t),this.modifiedUniforms[e]=!0,this.modified=!0)}}class Vz{constructor(e){pe(this,"uniformBlocks",new Map);pe(this,"uniformBufferLayouts",new Map);pe(this,"uniformBuffers",new Map);for(const[t,r]of Object.entries(e)){const o=t,p=new Bz(r.uniformTypes??{},r.uniformSizes??{});this.uniformBufferLayouts.set(o,p);const _=new Uz({name:t});_.setUniforms(r.defaultUniforms||{}),this.uniformBlocks.set(o,_)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){var t;for(const[r,o]of Object.entries(e))(t=this.uniformBlocks.get(r))==null||t.setUniforms(o);this.updateUniformBuffers()}getUniformBufferByteLength(e){var t;return((t=this.uniformBufferLayouts.get(e))==null?void 0:t.byteLength)||0}getUniformBufferData(e){var r,o;const t=((r=this.uniformBlocks.get(e))==null?void 0:r.getAllUniforms())||{};return(o=this.uniformBufferLayouts.get(e))==null?void 0:o.getData(t)}createUniformBuffer(e,t,r){r&&this.setUniforms(r);const o=this.getUniformBufferByteLength(t),p=e.createBuffer({usage:xa.UNIFORM|xa.COPY_DST,byteLength:o}),_=this.getUniformBufferData(t);return p.write(_),p}getManagedUniformBuffer(e,t){if(!this.uniformBuffers.get(t)){const r=this.getUniformBufferByteLength(t),o=e.createBuffer({usage:xa.UNIFORM|xa.COPY_DST,byteLength:r});this.uniformBuffers.set(t,o)}return this.uniformBuffers.get(t)}updateUniformBuffers(){let e=!1;for(const t of this.uniformBlocks.keys()){const r=this.updateUniformBuffer(t);e||(e=r)}return e&&ni.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){var p;const t=this.uniformBlocks.get(e);let r=this.uniformBuffers.get(e),o=!1;if(r&&(t!=null&&t.needsRedraw)){o||(o=t.needsRedraw);const _=this.getUniformBufferData(e);r=this.uniformBuffers.get(e),r==null||r.write(_);const l=(p=this.uniformBlocks.get(e))==null?void 0:p.getAllUniforms();ni.log(4,`Writing to uniform buffer ${String(e)}`,_,l)()}return o}}class lf{constructor(e,t){this.name=e,this.attributes=t,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}get isPointer(){return!1}getTypeName(){return this.name}}class s4{constructor(e,t,r){this.name=e,this.type=t,this.attributes=r,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class Wg extends lf{constructor(e,t){super(e,t),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class Hg extends lf{constructor(e,t){super(e,t),this.count=0,this.stride=0}get isArray(){return!0}getTypeName(){return`array<${this.format.getTypeName()}, ${this.count}>`}}class PA extends lf{constructor(e,t,r){super(e,r),this.format=t}get isPointer(){return!0}getTypeName(){return`&${this.format.getTypeName()}`}}class S_ extends lf{constructor(e,t,r,o){super(e,r),this.format=t,this.access=o}get isTemplate(){return!0}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}var Vg;(i=>{i[i.Uniform=0]="Uniform",i[i.Storage=1]="Storage",i[i.Texture=2]="Texture",i[i.Sampler=3]="Sampler",i[i.StorageTexture=4]="StorageTexture"})(Vg||(Vg={}));class cv{constructor(e,t,r,o,p,_,l){this.name=e,this.type=t,this.group=r,this.binding=o,this.attributes=p,this.resourceType=_,this.access=l}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class jz{constructor(e,t){this.name=e,this.type=t}}class Gz{constructor(e,t,r,o){this.name=e,this.type=t,this.locationType=r,this.location=o,this.interpolation=null}}class a4{constructor(e,t,r,o){this.name=e,this.type=t,this.locationType=r,this.location=o}}class Wz{constructor(e,t,r,o){this.name=e,this.type=t,this.attributes=r,this.id=o}}class Zz{constructor(e,t,r){this.name=e,this.type=t,this.attributes=r}}class Xz{constructor(e,t=null,r){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=t,this.attributes=r}}class Hz{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}function $z(i){var e=(32768&i)>>15,t=(31744&i)>>10,r=1023&i;return t==0?(e?-1:1)*Math.pow(2,-14)*(r/Math.pow(2,10)):t==31?r?NaN:1/0*(e?-1:1):(e?-1:1)*Math.pow(2,t-15)*(1+r/Math.pow(2,10))}const KE=new Float32Array(1),qz=new Int32Array(KE.buffer),Kl=new Uint16Array(1);function Yz(i){KE[0]=i;const e=qz[0],t=e>>31&1;let r=e>>23&255,o=8388607&e;if(r===255)return Kl[0]=t<<15|31744|(o!==0?512:0),Kl[0];if(r===0){if(o===0)return Kl[0]=t<<15,Kl[0];o|=8388608;let p=113;for(;!(8388608&o);)o<<=1,p--;return r=127-p,o&=8388607,r>0?(o=(o>>126-r)+(o>>127-r&1),Kl[0]=t<<15|r<<10|o>>13,Kl[0]):(Kl[0]=t<<15,Kl[0])}return r=r-127+15,r>=31?(Kl[0]=t<<15|31744,Kl[0]):r<=0?r<-10?(Kl[0]=t<<15,Kl[0]):(o=(8388608|o)>>1-r,Kl[0]=t<<15|o>>13,Kl[0]):(o>>=13,Kl[0]=t<<15|r<<10|o,Kl[0])}const Cw=new Uint32Array(1),eM=new Float32Array(Cw.buffer,0,1);function o4(i){const e=112+(i>>6&31)<<23|(63&i)<<17;return Cw[0]=e,eM[0]}function Jz(i,e,t,r,o,p,_,l,M){const D=r*(_>>=o)*(p>>=o)+t*_+e*l;switch(M){case"r8unorm":return[Pr(i,D,"8unorm",1)[0]];case"r8snorm":return[Pr(i,D,"8snorm",1)[0]];case"r8uint":return[Pr(i,D,"8uint",1)[0]];case"r8sint":return[Pr(i,D,"8sint",1)[0]];case"rg8unorm":{const B=Pr(i,D,"8unorm",2);return[B[0],B[1]]}case"rg8snorm":{const B=Pr(i,D,"8snorm",2);return[B[0],B[1]]}case"rg8uint":{const B=Pr(i,D,"8uint",2);return[B[0],B[1]]}case"rg8sint":{const B=Pr(i,D,"8sint",2);return[B[0],B[1]]}case"rgba8unorm-srgb":case"rgba8unorm":{const B=Pr(i,D,"8unorm",4);return[B[0],B[1],B[2],B[3]]}case"rgba8snorm":{const B=Pr(i,D,"8snorm",4);return[B[0],B[1],B[2],B[3]]}case"rgba8uint":{const B=Pr(i,D,"8uint",4);return[B[0],B[1],B[2],B[3]]}case"rgba8sint":{const B=Pr(i,D,"8sint",4);return[B[0],B[1],B[2],B[3]]}case"bgra8unorm-srgb":case"bgra8unorm":{const B=Pr(i,D,"8unorm",4);return[B[2],B[1],B[0],B[3]]}case"r16uint":return[Pr(i,D,"16uint",1)[0]];case"r16sint":return[Pr(i,D,"16sint",1)[0]];case"r16float":return[Pr(i,D,"16float",1)[0]];case"rg16uint":{const B=Pr(i,D,"16uint",2);return[B[0],B[1]]}case"rg16sint":{const B=Pr(i,D,"16sint",2);return[B[0],B[1]]}case"rg16float":{const B=Pr(i,D,"16float",2);return[B[0],B[1]]}case"rgba16uint":{const B=Pr(i,D,"16uint",4);return[B[0],B[1],B[2],B[3]]}case"rgba16sint":{const B=Pr(i,D,"16sint",4);return[B[0],B[1],B[2],B[3]]}case"rgba16float":{const B=Pr(i,D,"16float",4);return[B[0],B[1],B[2],B[3]]}case"r32uint":return[Pr(i,D,"32uint",1)[0]];case"r32sint":return[Pr(i,D,"32sint",1)[0]];case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return[Pr(i,D,"32float",1)[0]];case"rg32uint":{const B=Pr(i,D,"32uint",2);return[B[0],B[1]]}case"rg32sint":{const B=Pr(i,D,"32sint",2);return[B[0],B[1]]}case"rg32float":{const B=Pr(i,D,"32float",2);return[B[0],B[1]]}case"rgba32uint":{const B=Pr(i,D,"32uint",4);return[B[0],B[1],B[2],B[3]]}case"rgba32sint":{const B=Pr(i,D,"32sint",4);return[B[0],B[1],B[2],B[3]]}case"rgba32float":{const B=Pr(i,D,"32float",4);return[B[0],B[1],B[2],B[3]]}case"rg11b10ufloat":{const B=new Uint32Array(i.buffer,D,1)[0],j=(4192256&B)>>11,$=(4290772992&B)>>22;return[o4(2047&B),o4(j),(function(se){const de=112+(se>>5&31)<<23|(31&se)<<18;return Cw[0]=de,eM[0]})($),1]}}return null}function Pr(i,e,t,r){const o=[0,0,0,0];for(let p=0;p<r;++p)switch(t){case"8unorm":o[p]=i[e]/255,e++;break;case"8snorm":o[p]=i[e]/255*2-1,e++;break;case"8uint":o[p]=i[e],e++;break;case"8sint":o[p]=i[e]-127,e++;break;case"16uint":o[p]=i[e]|i[e+1]<<8,e+=2;break;case"16sint":o[p]=(i[e]|i[e+1]<<8)-32768,e+=2;break;case"16float":o[p]=$z(i[e]|i[e+1]<<8),e+=2;break;case"32uint":case"32sint":o[p]=i[e]|i[e+1]<<8|i[e+2]<<16|i[e+3]<<24,e+=4;break;case"32float":o[p]=new Float32Array(i.buffer,e,1)[0],e+=4}return o}function Vr(i,e,t,r,o){for(let p=0;p<r;++p)switch(t){case"8unorm":i[e]=255*o[p],e++;break;case"8snorm":i[e]=.5*(o[p]+1)*255,e++;break;case"8uint":i[e]=o[p],e++;break;case"8sint":i[e]=o[p]+127,e++;break;case"16uint":new Uint16Array(i.buffer,e,1)[0]=o[p],e+=2;break;case"16sint":new Int16Array(i.buffer,e,1)[0]=o[p],e+=2;break;case"16float":{const _=Yz(o[p]);new Uint16Array(i.buffer,e,1)[0]=_,e+=2;break}case"32uint":new Uint32Array(i.buffer,e,1)[0]=o[p],e+=4;break;case"32sint":new Int32Array(i.buffer,e,1)[0]=o[p],e+=4;break;case"32float":new Float32Array(i.buffer,e,1)[0]=o[p],e+=4}return o}const Ob={r8unorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8snorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8uint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8sint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg8unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8snorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"rgba8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8snorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},bgra8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bgra8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r16uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16float:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg16uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba16uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r32uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg32uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba32uint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32sint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32float:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rg11b10ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},stencil8:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!1,hasStencil:!0,channels:1},depth16unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},depth24plus:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,depthOnlyFormat:"depth32float",channels:1},"depth24plus-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,depthOnlyFormat:"depth32float",channels:1},depth32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},"depth32float-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,stencilOnlyFormat:"depth32float",channels:1},rgb9e5ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bc1-rgba-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc1-rgba-unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc4-r-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc4-r-snorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc5-rg-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc5-rg-snorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc6h-rgb-ufloat":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc6h-rgb-float":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"eac-r11unorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-r11snorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-rg11unorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"eac-rg11snorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"astc-4x4-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-4x4-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x5-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-5x5-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x6-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-6x6-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-8x5-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x5-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x6-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x6-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x8-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-8x8-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-10x5-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x5-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x6-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x6-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x8-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x8-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x10-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-10x10-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x12-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4},"astc-12x12-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4}};class ff{constructor(){this.id=ff._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}search(e){e(this)}searchBlock(e,t){if(e){t(rx.instance);for(const r of e)r instanceof Array?this.searchBlock(r,t):r.search(t);t(sx.instance)}}constEvaluate(e,t){throw new Error("Cannot evaluate node")}constEvaluateString(e){return this.constEvaluate(e).toString()}}ff._id=0;class rx extends ff{}rx.instance=new rx;class sx extends ff{}sx.instance=new sx;const tM=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]);class Ks extends ff{constructor(){super()}}class p1 extends Ks{constructor(e,t,r,o,p,_){super(),this.calls=new Set,this.name=e,this.args=t,this.returnType=r,this.body=o,this.startLine=p,this.endLine=_}get astNodeType(){return"function"}search(e){if(this.attributes)for(const t of this.attributes)e(t);e(this);for(const t of this.args)e(t);this.searchBlock(this.body,e)}}class Qz extends Ks{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class iM extends Ks{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class IA extends Ks{constructor(e,t){super(),this.body=e,this.loopId=t}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class nM extends Ks{constructor(e,t,r,o){super(),this.init=e,this.condition=t,this.increment=r,this.body=o}get astNodeType(){return"for"}search(e){var t,r,o;(t=this.init)===null||t===void 0||t.search(e),(r=this.condition)===null||r===void 0||r.search(e),(o=this.increment)===null||o===void 0||o.search(e),this.searchBlock(this.body,e)}}class Cp extends Ks{constructor(e,t,r,o,p){super(),this.attributes=null,this.name=e,this.type=t,this.storage=r,this.access=o,this.value=p}get astNodeType(){return"var"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}class Pw extends Ks{constructor(e,t,r){super(),this.attributes=null,this.name=e,this.type=t,this.value=r}get astNodeType(){return"override"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}}class e1 extends Ks{constructor(e,t,r,o,p){super(),this.attributes=null,this.name=e,this.type=t,this.storage=r,this.access=o,this.value=p}get astNodeType(){return"let"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}class Ev extends Ks{constructor(e,t,r,o,p){super(),this.attributes=null,this.name=e,this.type=t,this.storage=r,this.access=o,this.value=p}get astNodeType(){return"const"}constEvaluate(e,t){return this.value.constEvaluate(e,t)}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}var By,j2,St,lt;(i=>{i.increment="++",i.decrement="--"})(By||(By={})),(i=>{i.parse=function(e){const t=e;if(t=="parse")throw new Error("Invalid value for IncrementOperator");return i[t]}})(By||(By={}));class rM extends Ks{constructor(e,t){super(),this.operator=e,this.variable=t}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}(i=>{i.assign="=",i.addAssign="+=",i.subtractAssin="-=",i.multiplyAssign="*=",i.divideAssign="/=",i.moduloAssign="%=",i.andAssign="&=",i.orAssign="|=",i.xorAssign="^=",i.shiftLeftAssign="<<=",i.shiftRightAssign=">>="})(j2||(j2={})),(i=>{i.parse=function(e){const t=e;if(t=="parse")throw new Error("Invalid value for AssignOperator");return t}})(j2||(j2={}));class sM extends Ks{constructor(e,t,r){super(),this.operator=e,this.variable=t,this.value=r}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class Iw extends Ks{constructor(e,t){super(),this.name=e,this.args=t}get astNodeType(){return"call"}isBuiltin(){return tM.has(this.name)}search(e){for(const t of this.args)t.search(e);e(this)}}class aM extends Ks{constructor(e,t){super(),this.body=e,this.continuing=t}get astNodeType(){return"loop"}search(e){var t;this.searchBlock(this.body,e),(t=this.continuing)===null||t===void 0||t.search(e)}}class oM extends Ks{constructor(e,t){super(),this.condition=e,this.cases=t}get astNodeType(){return"switch"}search(e){e(this);for(const t of this.cases)t.search(e)}}class lM extends Ks{constructor(e,t,r,o){super(),this.condition=e,this.body=t,this.elseif=r,this.else=o}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class cM extends Ks{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}}class Kz extends Ks{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class eL extends Ks{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class uM extends Ks{constructor(e,t){super(),this.severity=e,this.rule=t}get astNodeType(){return"diagnostic"}}class kw extends Ks{constructor(e,t){super(),this.name=e,this.type=t}get astNodeType(){return"alias"}}class tL extends Ks{constructor(){super()}get astNodeType(){return"discard"}}class hM extends Ks{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}}class fM extends Ks{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}}class Kt extends Ks{constructor(e){super(),this.attributes=null,this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(e){let t=e[0];if(t.name==="f32")return t;for(let r=1;r<e.length;++r){const o=Kt._priority.get(t.name);Kt._priority.get(e[r].name)<o&&(t=e[r])}return t.name==="x32"?Kt.i32:t}getTypeName(){return this.name}}Kt.x32=new Kt("x32"),Kt.f32=new Kt("f32"),Kt.i32=new Kt("i32"),Kt.u32=new Kt("u32"),Kt.f16=new Kt("f16"),Kt.bool=new Kt("bool"),Kt.void=new Kt("void"),Kt._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class l4 extends Kt{constructor(e){super(e)}}class Mp extends Kt{constructor(e,t,r,o){super(e),this.members=t,this.startLine=r,this.endLine=o}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let t=0;t<this.members.length;t++)if(this.members[t].name==e)return t;return-1}search(e){for(const t of this.members)e(t)}}class gt extends Kt{constructor(e,t,r){super(e),this.format=t,this.access=r}get astNodeType(){return"template"}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}gt.vec2f=new gt("vec2",Kt.f32,null),gt.vec3f=new gt("vec3",Kt.f32,null),gt.vec4f=new gt("vec4",Kt.f32,null),gt.vec2i=new gt("vec2",Kt.i32,null),gt.vec3i=new gt("vec3",Kt.i32,null),gt.vec4i=new gt("vec4",Kt.i32,null),gt.vec2u=new gt("vec2",Kt.u32,null),gt.vec3u=new gt("vec3",Kt.u32,null),gt.vec4u=new gt("vec4",Kt.u32,null),gt.vec2h=new gt("vec2",Kt.f16,null),gt.vec3h=new gt("vec3",Kt.f16,null),gt.vec4h=new gt("vec4",Kt.f16,null),gt.vec2b=new gt("vec2",Kt.bool,null),gt.vec3b=new gt("vec3",Kt.bool,null),gt.vec4b=new gt("vec4",Kt.bool,null),gt.mat2x2f=new gt("mat2x2",Kt.f32,null),gt.mat2x3f=new gt("mat2x3",Kt.f32,null),gt.mat2x4f=new gt("mat2x4",Kt.f32,null),gt.mat3x2f=new gt("mat3x2",Kt.f32,null),gt.mat3x3f=new gt("mat3x3",Kt.f32,null),gt.mat3x4f=new gt("mat3x4",Kt.f32,null),gt.mat4x2f=new gt("mat4x2",Kt.f32,null),gt.mat4x3f=new gt("mat4x3",Kt.f32,null),gt.mat4x4f=new gt("mat4x4",Kt.f32,null),gt.mat2x2h=new gt("mat2x2",Kt.f16,null),gt.mat2x3h=new gt("mat2x3",Kt.f16,null),gt.mat2x4h=new gt("mat2x4",Kt.f16,null),gt.mat3x2h=new gt("mat3x2",Kt.f16,null),gt.mat3x3h=new gt("mat3x3",Kt.f16,null),gt.mat3x4h=new gt("mat3x4",Kt.f16,null),gt.mat4x2h=new gt("mat4x2",Kt.f16,null),gt.mat4x3h=new gt("mat4x3",Kt.f16,null),gt.mat4x4h=new gt("mat4x4",Kt.f16,null),gt.mat2x2i=new gt("mat2x2",Kt.i32,null),gt.mat2x3i=new gt("mat2x3",Kt.i32,null),gt.mat2x4i=new gt("mat2x4",Kt.i32,null),gt.mat3x2i=new gt("mat3x2",Kt.i32,null),gt.mat3x3i=new gt("mat3x3",Kt.i32,null),gt.mat3x4i=new gt("mat3x4",Kt.i32,null),gt.mat4x2i=new gt("mat4x2",Kt.i32,null),gt.mat4x3i=new gt("mat4x3",Kt.i32,null),gt.mat4x4i=new gt("mat4x4",Kt.i32,null),gt.mat2x2u=new gt("mat2x2",Kt.u32,null),gt.mat2x3u=new gt("mat2x3",Kt.u32,null),gt.mat2x4u=new gt("mat2x4",Kt.u32,null),gt.mat3x2u=new gt("mat3x2",Kt.u32,null),gt.mat3x3u=new gt("mat3x3",Kt.u32,null),gt.mat3x4u=new gt("mat3x4",Kt.u32,null),gt.mat4x2u=new gt("mat4x2",Kt.u32,null),gt.mat4x3u=new gt("mat4x3",Kt.u32,null),gt.mat4x4u=new gt("mat4x4",Kt.u32,null);class Mv extends Kt{constructor(e,t,r,o){super(e),this.storage=t,this.type=r,this.access=o}get astNodeType(){return"pointer"}}class t1 extends Kt{constructor(e,t,r,o){super(e),this.attributes=t,this.format=r,this.count=o}get astNodeType(){return"array"}get isArray(){return!0}}class G2 extends Kt{constructor(e,t,r){super(e),this.format=t,this.access=r}get astNodeType(){return"sampler"}}class td extends ff{constructor(){super(),this.postfix=null}}class E_ extends td{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}}class n0 extends td{constructor(e,t){super(),this.type=e,this.args=t}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(const t of this.args)t.search(e)}constEvaluate(e,t){return t&&(t[0]=this.type),e.evalExpression(this,e.context)}}class Dw extends td{constructor(e,t){super(),this.cachedReturnValue=null,this.name=e,this.args=t}get astNodeType(){return"callExpr"}setCachedReturnValue(e){this.cachedReturnValue=e}get isBuiltin(){return tM.has(this.name)}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){for(const t of this.args)t.search(e);e(this)}}class oh extends td{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}constEvaluate(e,t){return e.evalExpression(this,e.context)}}class dM extends td{constructor(e,t){super(),this.name=e,this.initializer=t}get astNodeType(){return"constExpr"}constEvaluate(e,t){if(this.initializer){const r=e.evalExpression(this.initializer,e.context);return r!==null&&this.postfix?r.getSubData(e,this.postfix,e.context):r}return null}search(e){this.initializer.search(e)}}class Mo extends td{constructor(e,t){super(),this.value=e,this.type=t}get astNodeType(){return"literalExpr"}constEvaluate(e,t){return t!==void 0&&(t[0]=this.type),this.value}get isScalar(){return this.value instanceof at}get isVector(){return this.value instanceof ze||this.value instanceof cn}get scalarValue(){return this.value instanceof at?this.value.value:(console.error("Value is not scalar."),0)}get vectorValue(){return this.value instanceof ze||this.value instanceof cn?this.value.data:(console.error("Value is not a vector or matrix."),new Float32Array(0))}}class pM extends td{constructor(e,t){super(),this.type=e,this.value=t}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class Jy extends td{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class gM extends td{constructor(){super()}}class io extends gM{constructor(e,t){super(),this.operator=e,this.right=t}get astNodeType(){return"unaryOp"}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.right.search(e)}}class qf extends gM{constructor(e,t,r){super(),this.operator=e,this.left=t,this.right=r}get astNodeType(){return"binaryOp"}_getPromotedType(e,t){return e.name===t.name?e:e.name==="f32"||t.name==="f32"?Kt.f32:e.name==="u32"||t.name==="u32"?Kt.u32:Kt.i32}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.left.search(e),this.right.search(e)}}class mM extends ff{constructor(e){super(),this.body=e}search(e){e(this),this.searchBlock(this.body,e)}}class Rv extends td{constructor(){super()}get astNodeType(){return"default"}}class _M extends mM{constructor(e,t){super(t),this.selectors=e}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class yM extends mM{constructor(e){super(e)}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class c4 extends ff{constructor(e,t,r){super(),this.name=e,this.type=t,this.attributes=r}get astNodeType(){return"argument"}}class iL extends ff{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class u4 extends ff{constructor(e,t,r){super(),this.name=e,this.type=t,this.attributes=r}get astNodeType(){return"member"}}class vM extends ff{constructor(e,t){super(),this.name=e,this.value=t}get astNodeType(){return"attribute"}}class hf{constructor(e,t){this.parent=null,this.typeInfo=e,this.parent=t,this.id=hf._id++}clone(){throw`Clone: Not implemented for ${this.constructor.name}`}setDataValue(e,t,r,o){console.error(`SetDataValue: Not implemented for ${this.constructor.name}`)}getSubData(e,t,r){return console.error(`GetDataValue: Not implemented for ${this.constructor.name}`),null}toString(){return`<${this.typeInfo.getTypeName()}>`}}hf._id=0;class kA extends hf{constructor(){super(new lf("void",null),null)}toString(){return"void"}}kA.void=new kA;class Ry extends hf{constructor(e){super(new PA("pointer",e.typeInfo,null),null),this.reference=e}clone(){return this}setDataValue(e,t,r,o){this.reference.setDataValue(e,t,r,o)}getSubData(e,t,r){return t?this.reference.getSubData(e,t,r):this}toString(){return`&${this.reference.toString()}`}}class at extends hf{constructor(e,t,r=null){super(t,r),e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array?this.data=e:this.typeInfo.name==="x32"?e-Math.floor(e)!==0?this.data=new Float32Array([e]):this.data=e>=0?new Uint32Array([e]):new Int32Array([e]):this.typeInfo.name==="i32"||this.typeInfo.name==="bool"?this.data=new Int32Array([e]):this.typeInfo.name==="u32"?this.data=new Uint32Array([e]):this.typeInfo.name==="f32"||this.typeInfo.name==="f16"?this.data=new Float32Array([e]):console.error("ScalarData2: Invalid type",t)}clone(){if(this.data instanceof Float32Array)return new at(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new at(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new at(new Uint32Array(this.data),this.typeInfo,null);throw"ScalarData: Invalid data type"}get value(){return this.data[0]}set value(e){this.data[0]=e}setDataValue(e,t,r,o){if(r)return void console.error("SetDataValue: Scalar data does not support postfix",r);if(!(t instanceof at))return void console.error("SetDataValue: Invalid value",t);let p=t.data[0];this.typeInfo.name==="i32"||this.typeInfo.name==="u32"?p=Math.floor(p):this.typeInfo.name==="bool"&&(p=p?1:0),this.data[0]=p}getSubData(e,t,r){return t?(console.error("getSubData: Scalar data does not support postfix",t),null):this}toString(){return`${this.value}`}}function nL(i,e,t){const r=e.length;return r===2?t==="f32"?new ze(new Float32Array(e),i.getTypeInfo("vec2f")):t==="i32"||t==="bool"?new ze(new Int32Array(e),i.getTypeInfo("vec2i")):t==="u32"?new ze(new Uint32Array(e),i.getTypeInfo("vec2u")):t==="f16"?new ze(new Float32Array(e),i.getTypeInfo("vec2h")):(console.error(`getSubData: Unknown format ${t}`),null):r===3?t==="f32"?new ze(new Float32Array(e),i.getTypeInfo("vec3f")):t==="i32"||t==="bool"?new ze(new Int32Array(e),i.getTypeInfo("vec3i")):t==="u32"?new ze(new Uint32Array(e),i.getTypeInfo("vec3u")):t==="f16"?new ze(new Float32Array(e),i.getTypeInfo("vec3h")):(console.error(`getSubData: Unknown format ${t}`),null):r===4?t==="f32"?new ze(new Float32Array(e),i.getTypeInfo("vec4f")):t==="i32"||t==="bool"?new ze(new Int32Array(e),i.getTypeInfo("vec4i")):t==="u32"?new ze(new Uint32Array(e),i.getTypeInfo("vec4u")):t==="f16"?new ze(new Float32Array(e),i.getTypeInfo("vec4h")):(console.error(`getSubData: Unknown format ${t}`),null):(console.error(`getSubData: Invalid vector size ${e.length}`),null)}class ze extends hf{constructor(e,t,r=null){if(super(t,r),e instanceof Float32Array||e instanceof Uint32Array||e instanceof Int32Array)this.data=e;else{const o=this.typeInfo.name;o==="vec2f"||o==="vec3f"||o==="vec4f"?this.data=new Float32Array(e):o==="vec2i"||o==="vec3i"||o==="vec4i"?this.data=new Int32Array(e):o==="vec2u"||o==="vec3u"||o==="vec4u"?this.data=new Uint32Array(e):o==="vec2h"||o==="vec3h"||o==="vec4h"?this.data=new Float32Array(e):o==="vec2b"||o==="vec3b"||o==="vec4b"?this.data=new Int32Array(e):o==="vec2"||o==="vec3"||o==="vec4"?this.data=new Float32Array(e):console.error(`VectorData: Invalid type ${o}`)}}clone(){if(this.data instanceof Float32Array)return new ze(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new ze(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new ze(new Uint32Array(this.data),this.typeInfo,null);throw"VectorData: Invalid data type"}setDataValue(e,t,r,o){r instanceof E_?console.error("TODO: Set vector postfix"):t instanceof ze?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,r){if(t===null)return this;let o=e.getTypeInfo("f32");if(this.typeInfo instanceof S_)o=this.typeInfo.format||o;else{const _=this.typeInfo.name;_==="vec2f"||_==="vec3f"||_==="vec4f"?o=e.getTypeInfo("f32"):_==="vec2i"||_==="vec3i"||_==="vec4i"?o=e.getTypeInfo("i32"):_==="vec2b"||_==="vec3b"||_==="vec4b"?o=e.getTypeInfo("bool"):_==="vec2u"||_==="vec3u"||_==="vec4u"?o=e.getTypeInfo("u32"):_==="vec2h"||_==="vec3h"||_==="vec4h"?o=e.getTypeInfo("f16"):console.error(`GetSubData: Unknown type ${_}`)}let p=this;for(;t!==null&&p!==null;){if(t instanceof Jy){const _=t.index;let l=-1;if(_ instanceof Mo){if(!(_.value instanceof at))return console.error(`GetSubData: Invalid array index ${_.value}`),null;l=_.value.value}else{const M=e.evalExpression(_,r);if(!(M instanceof at))return console.error("GetSubData: Unknown index type",_),null;l=M.value}if(l<0||l>=p.data.length)return console.error("GetSubData: Index out of range",l),null;if(p.data instanceof Float32Array){const M=new Float32Array(p.data.buffer,p.data.byteOffset+4*l,1);return new at(M,o)}if(p.data instanceof Int32Array){const M=new Int32Array(p.data.buffer,p.data.byteOffset+4*l,1);return new at(M,o)}if(p.data instanceof Uint32Array){const M=new Uint32Array(p.data.buffer,p.data.byteOffset+4*l,1);return new at(M,o)}throw"GetSubData: Invalid data type"}if(!(t instanceof E_))return console.error("GetSubData: Unknown postfix",t),null;{const _=t.value.toLowerCase();if(_.length===1){let M=0;if(_==="x"||_==="r")M=0;else if(_==="y"||_==="g")M=1;else if(_==="z"||_==="b")M=2;else{if(_!=="w"&&_!=="a")return console.error(`GetSubData: Unknown member ${_}`),null;M=3}if(this.data instanceof Float32Array){let D=new Float32Array(this.data.buffer,this.data.byteOffset+4*M,1);return new at(D,o,this)}if(this.data instanceof Int32Array){let D=new Int32Array(this.data.buffer,this.data.byteOffset+4*M,1);return new at(D,o,this)}if(this.data instanceof Uint32Array){let D=new Uint32Array(this.data.buffer,this.data.byteOffset+4*M,1);return new at(D,o,this)}}const l=[];for(const M of _)M==="x"||M==="r"?l.push(this.data[0]):M==="y"||M==="g"?l.push(this.data[1]):M==="z"||M==="b"?l.push(this.data[2]):M==="w"||M==="a"?l.push(this.data[3]):console.error(`GetDataValue: Unknown member ${M}`);p=nL(e,l,o.name)}t=t.postfix}return p}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class cn extends hf{constructor(e,t,r=null){super(t,r),e instanceof Float32Array?this.data=e:this.data=new Float32Array(e)}clone(){return new cn(new Float32Array(this.data),this.typeInfo,null)}setDataValue(e,t,r,o){r instanceof E_?console.error("TODO: Set matrix postfix"):t instanceof cn?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,r){if(t===null)return this;const o=this.typeInfo.name;if(e.getTypeInfo("f32"),this.typeInfo instanceof S_)this.typeInfo.format;else if(o.endsWith("f"))e.getTypeInfo("f32");else if(o.endsWith("i"))e.getTypeInfo("i32");else if(o.endsWith("u"))e.getTypeInfo("u32");else{if(!o.endsWith("h"))return console.error(`GetDataValue: Unknown type ${o}`),null;e.getTypeInfo("f16")}if(t instanceof Jy){const p=t.index;let _=-1;if(p instanceof Mo){if(!(p.value instanceof at))return console.error(`GetDataValue: Invalid array index ${p.value}`),null;_=p.value.value}else{const D=e.evalExpression(p,r);if(!(D instanceof at))return console.error("GetDataValue: Unknown index type",p),null;_=D.value}if(_<0||_>=this.data.length)return console.error("GetDataValue: Index out of range",_),null;const l=o.endsWith("h")?"h":"f";let M;if(o==="mat2x2"||o==="mat2x2f"||o==="mat2x2h"||o==="mat3x2"||o==="mat3x2f"||o==="mat3x2h"||o==="mat4x2"||o==="mat4x2f"||o==="mat4x2h")M=new ze(new Float32Array(this.data.buffer,this.data.byteOffset+2*_*4,2),e.getTypeInfo(`vec2${l}`));else if(o==="mat2x3"||o==="mat2x3f"||o==="mat2x3h"||o==="mat3x3"||o==="mat3x3f"||o==="mat3x3h"||o==="mat4x3"||o==="mat4x3f"||o==="mat4x3h")M=new ze(new Float32Array(this.data.buffer,this.data.byteOffset+3*_*4,3),e.getTypeInfo(`vec3${l}`));else{if(o!=="mat2x4"&&o!=="mat2x4f"&&o!=="mat2x4h"&&o!=="mat3x4"&&o!=="mat3x4f"&&o!=="mat3x4h"&&o!=="mat4x4"&&o!=="mat4x4f"&&o!=="mat4x4h")return console.error(`GetDataValue: Unknown type ${o}`),null;M=new ze(new Float32Array(this.data.buffer,this.data.byteOffset+4*_*4,4),e.getTypeInfo(`vec4${l}`))}return t.postfix?M.getSubData(e,t.postfix,r):M}return console.error("GetDataValue: Invalid postfix",t),null}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class va extends hf{constructor(e,t,r=0,o=null){super(t,o),this.buffer=e instanceof ArrayBuffer?e:e.buffer,this.offset=r}clone(){const e=new Uint8Array(new Uint8Array(this.buffer,this.offset,this.typeInfo.size));return new va(e.buffer,this.typeInfo,0,null)}setDataValue(e,t,r,o){if(t===null)return void console.log("setDataValue: NULL data.");let p=this.offset,_=this.typeInfo;for(;r;){if(r instanceof Jy)if(_ instanceof Hg){const l=r.index;if(l instanceof Mo){if(!(l.value instanceof at))return void console.error(`SetDataValue: Invalid index type ${l.value}`);p+=l.value.value*_.stride}else{const M=e.evalExpression(l,o);if(!(M instanceof at))return void console.error("SetDataValue: Unknown index type",l);p+=M.value*_.stride}_=_.format}else console.error(`SetDataValue: Type ${_.getTypeName()} is not an array`);else{if(!(r instanceof E_))return void console.error("SetDataValue: Unknown postfix type",r);{const l=r.value;if(_ instanceof Wg){let M=!1;for(const D of _.members)if(D.name===l){p+=D.offset,_=D.type,M=!0;break}if(!M)return void console.error(`SetDataValue: Member ${l} not found`)}else if(_ instanceof lf){const M=_.getTypeName();let D=0;if(l==="x"||l==="r")D=0;else if(l==="y"||l==="g")D=1;else if(l==="z"||l==="b")D=2;else{if(l!=="w"&&l!=="a")return void console.error(`SetDataValue: Unknown member ${l}`);D=3}if(!(t instanceof at))return void console.error("SetDataValue: Invalid value",t);const B=t.value;return M==="vec2f"?void(new Float32Array(this.buffer,p,2)[D]=B):M==="vec3f"?void(new Float32Array(this.buffer,p,3)[D]=B):M==="vec4f"?void(new Float32Array(this.buffer,p,4)[D]=B):M==="vec2i"?void(new Int32Array(this.buffer,p,2)[D]=B):M==="vec3i"?void(new Int32Array(this.buffer,p,3)[D]=B):M==="vec4i"?void(new Int32Array(this.buffer,p,4)[D]=B):M==="vec2u"?void(new Uint32Array(this.buffer,p,2)[D]=B):M==="vec3u"?void(new Uint32Array(this.buffer,p,3)[D]=B):M==="vec4u"?void(new Uint32Array(this.buffer,p,4)[D]=B):void console.error(`SetDataValue: Type ${M} is not a struct`)}}}r=r.postfix}this.setData(e,t,_,p,o)}setData(e,t,r,o,p){const _=r.getTypeName();if(_!=="f32"&&_!=="f16")if(_!=="i32"&&_!=="atomic<i32>"&&_!=="x32")if(_!=="u32"&&_!=="atomic<u32>")if(_!=="bool"){if(_==="vec2f"||_==="vec2h"){const l=new Float32Array(this.buffer,o,2);return void(t instanceof ze?(l[0]=t.data[0],l[1]=t.data[1]):(l[0]=t[0],l[1]=t[1]))}if(_==="vec3f"||_==="vec3h"){const l=new Float32Array(this.buffer,o,3);return void(t instanceof ze?(l[0]=t.data[0],l[1]=t.data[1],l[2]=t.data[2]):(l[0]=t[0],l[1]=t[1],l[2]=t[2]))}if(_==="vec4f"||_==="vec4h"){const l=new Float32Array(this.buffer,o,4);return void(t instanceof ze?(l[0]=t.data[0],l[1]=t.data[1],l[2]=t.data[2],l[3]=t.data[3]):(l[0]=t[0],l[1]=t[1],l[2]=t[2],l[3]=t[3]))}if(_==="vec2i"){const l=new Int32Array(this.buffer,o,2);return void(t instanceof ze?(l[0]=t.data[0],l[1]=t.data[1]):(l[0]=t[0],l[1]=t[1]))}if(_==="vec3i"){const l=new Int32Array(this.buffer,o,3);return void(t instanceof ze?(l[0]=t.data[0],l[1]=t.data[1],l[2]=t.data[2]):(l[0]=t[0],l[1]=t[1],l[2]=t[2]))}if(_==="vec4i"){const l=new Int32Array(this.buffer,o,4);return void(t instanceof ze?(l[0]=t.data[0],l[1]=t.data[1],l[2]=t.data[2],l[3]=t.data[3]):(l[0]=t[0],l[1]=t[1],l[2]=t[2],l[3]=t[3]))}if(_==="vec2u"){const l=new Uint32Array(this.buffer,o,2);return void(t instanceof ze?(l[0]=t.data[0],l[1]=t.data[1]):(l[0]=t[0],l[1]=t[1]))}if(_==="vec3u"){const l=new Uint32Array(this.buffer,o,3);return void(t instanceof ze?(l[0]=t.data[0],l[1]=t.data[1],l[2]=t.data[2]):(l[0]=t[0],l[1]=t[1],l[2]=t[2]))}if(_==="vec4u"){const l=new Uint32Array(this.buffer,o,4);return void(t instanceof ze?(l[0]=t.data[0],l[1]=t.data[1],l[2]=t.data[2],l[3]=t.data[3]):(l[0]=t[0],l[1]=t[1],l[2]=t[2],l[3]=t[3]))}if(_==="vec2b"){const l=new Uint32Array(this.buffer,o,2);return void(t instanceof ze?(l[0]=t.data[0],l[1]=t.data[1]):(l[0]=t[0],l[1]=t[1]))}if(_==="vec3b"){const l=new Uint32Array(this.buffer,o,3);return void(t instanceof ze?(l[0]=t.data[0],l[1]=t.data[1],l[2]=t.data[2]):(l[0]=t[0],l[1]=t[1],l[2]=t[2]))}if(_==="vec4b"){const l=new Uint32Array(this.buffer,o,4);return void(t instanceof ze?(l[0]=t.data[0],l[1]=t.data[1],l[2]=t.data[2],l[3]=t.data[3]):(l[0]=t[0],l[1]=t[1],l[2]=t[2],l[3]=t[3]))}if(_==="mat2x2f"||_==="mat2x2h"){const l=new Float32Array(this.buffer,o,4);return void(t instanceof cn?(l[0]=t.data[0],l[1]=t.data[1],l[2]=t.data[2],l[3]=t.data[3]):(l[0]=t[0],l[1]=t[1],l[2]=t[2],l[3]=t[3]))}if(_==="mat2x3f"||_==="mat2x3h"){const l=new Float32Array(this.buffer,o,6);return void(t instanceof cn?(l[0]=t.data[0],l[1]=t.data[1],l[2]=t.data[2],l[3]=t.data[3],l[4]=t.data[4],l[5]=t.data[5]):(l[0]=t[0],l[1]=t[1],l[2]=t[2],l[3]=t[3],l[4]=t[4],l[5]=t[5]))}if(_==="mat2x4f"||_==="mat2x4h"){const l=new Float32Array(this.buffer,o,8);return void(t instanceof cn?(l[0]=t.data[0],l[1]=t.data[1],l[2]=t.data[2],l[3]=t.data[3],l[4]=t.data[4],l[5]=t.data[5],l[6]=t.data[6],l[7]=t.data[7]):(l[0]=t[0],l[1]=t[1],l[2]=t[2],l[3]=t[3],l[4]=t[4],l[5]=t[5],l[6]=t[6],l[7]=t[7]))}if(_==="mat3x2f"||_==="mat3x2h"){const l=new Float32Array(this.buffer,o,6);return void(t instanceof cn?(l[0]=t.data[0],l[1]=t.data[1],l[2]=t.data[2],l[3]=t.data[3],l[4]=t.data[4],l[5]=t.data[5]):(l[0]=t[0],l[1]=t[1],l[2]=t[2],l[3]=t[3],l[4]=t[4],l[5]=t[5]))}if(_==="mat3x3f"||_==="mat3x3h"){const l=new Float32Array(this.buffer,o,9);return void(t instanceof cn?(l[0]=t.data[0],l[1]=t.data[1],l[2]=t.data[2],l[3]=t.data[3],l[4]=t.data[4],l[5]=t.data[5],l[6]=t.data[6],l[7]=t.data[7],l[8]=t.data[8]):(l[0]=t[0],l[1]=t[1],l[2]=t[2],l[3]=t[3],l[4]=t[4],l[5]=t[5],l[6]=t[6],l[7]=t[7],l[8]=t[8]))}if(_==="mat3x4f"||_==="mat3x4h"){const l=new Float32Array(this.buffer,o,12);return void(t instanceof cn?(l[0]=t.data[0],l[1]=t.data[1],l[2]=t.data[2],l[3]=t.data[3],l[4]=t.data[4],l[5]=t.data[5],l[6]=t.data[6],l[7]=t.data[7],l[8]=t.data[8],l[9]=t.data[9],l[10]=t.data[10],l[11]=t.data[11]):(l[0]=t[0],l[1]=t[1],l[2]=t[2],l[3]=t[3],l[4]=t[4],l[5]=t[5],l[6]=t[6],l[7]=t[7],l[8]=t[8],l[9]=t[9],l[10]=t[10],l[11]=t[11]))}if(_==="mat4x2f"||_==="mat4x2h"){const l=new Float32Array(this.buffer,o,8);return void(t instanceof cn?(l[0]=t.data[0],l[1]=t.data[1],l[2]=t.data[2],l[3]=t.data[3],l[4]=t.data[4],l[5]=t.data[5],l[6]=t.data[6],l[7]=t.data[7]):(l[0]=t[0],l[1]=t[1],l[2]=t[2],l[3]=t[3],l[4]=t[4],l[5]=t[5],l[6]=t[6],l[7]=t[7]))}if(_==="mat4x3f"||_==="mat4x3h"){const l=new Float32Array(this.buffer,o,12);return void(t instanceof cn?(l[0]=t.data[0],l[1]=t.data[1],l[2]=t.data[2],l[3]=t.data[3],l[4]=t.data[4],l[5]=t.data[5],l[6]=t.data[6],l[7]=t.data[7],l[8]=t.data[8],l[9]=t.data[9],l[10]=t.data[10],l[11]=t.data[11]):(l[0]=t[0],l[1]=t[1],l[2]=t[2],l[3]=t[3],l[4]=t[4],l[5]=t[5],l[6]=t[6],l[7]=t[7],l[8]=t[8],l[9]=t[9],l[10]=t[10],l[11]=t[11]))}if(_==="mat4x4f"||_==="mat4x4h"){const l=new Float32Array(this.buffer,o,16);return void(t instanceof cn?(l[0]=t.data[0],l[1]=t.data[1],l[2]=t.data[2],l[3]=t.data[3],l[4]=t.data[4],l[5]=t.data[5],l[6]=t.data[6],l[7]=t.data[7],l[8]=t.data[8],l[9]=t.data[9],l[10]=t.data[10],l[11]=t.data[11],l[12]=t.data[12],l[13]=t.data[13],l[14]=t.data[14],l[15]=t.data[15]):(l[0]=t[0],l[1]=t[1],l[2]=t[2],l[3]=t[3],l[4]=t[4],l[5]=t[5],l[6]=t[6],l[7]=t[7],l[8]=t[8],l[9]=t[9],l[10]=t[10],l[11]=t[11],l[12]=t[12],l[13]=t[13],l[14]=t[14],l[15]=t[15]))}if(t instanceof va){if(r===t.typeInfo)return void new Uint8Array(this.buffer,o,t.buffer.byteLength).set(new Uint8Array(t.buffer));console.error("SetDataValue: Type mismatch",_,t.typeInfo.getTypeName())}else console.error(`SetData: Unknown type ${_}`)}else t instanceof at&&(new Int32Array(this.buffer,o,1)[0]=t.value);else t instanceof at&&(new Uint32Array(this.buffer,o,1)[0]=t.value);else t instanceof at&&(new Int32Array(this.buffer,o,1)[0]=t.value);else t instanceof at&&(new Float32Array(this.buffer,o,1)[0]=t.value)}getSubData(e,t,r){var o,p,_;if(t===null)return this;let l=this.offset,M=this.typeInfo;for(;t;){if(t instanceof Jy){const B=t.index,j=B instanceof td?e.evalExpression(B,r):B;let $=0;if(j instanceof at?$=j.value:typeof j=="number"?$=j:console.error("GetDataValue: Invalid index type",B),M instanceof Hg)l+=$*M.stride,M=M.format;else{const se=M.getTypeName();se==="mat4x4"||se==="mat4x4f"||se==="mat4x4h"?(l+=16*$,M=e.getTypeInfo("vec4f")):console.error(`getDataValue: Type ${M.getTypeName()} is not an array`)}}else{if(!(t instanceof E_))return console.error("GetDataValue: Unknown postfix type",t),null;{const B=t.value;if(M instanceof Wg){let j=!1;for(const $ of M.members)if($.name===B){l+=$.offset,M=$.type,j=!0;break}if(!j)return console.error(`GetDataValue: Member ${B} not found`),null}else if(M instanceof lf){const j=M.getTypeName();if(j==="vec2f"||j==="vec3f"||j==="vec4f"||j==="vec2i"||j==="vec3i"||j==="vec4i"||j==="vec2u"||j==="vec3u"||j==="vec4u"||j==="vec2b"||j==="vec3b"||j==="vec4b"||j==="vec2h"||j==="vec3h"||j==="vec4h"||j==="vec2"||j==="vec3"||j==="vec4"){if(B.length>0&&B.length<5){let $="f";const se=[];for(let de=0;de<B.length;++de){const Ae=B[de].toLowerCase();let he=0;if(Ae==="x"||Ae==="r")he=0;else if(Ae==="y"||Ae==="g")he=1;else if(Ae==="z"||Ae==="b")he=2;else{if(Ae!=="w"&&Ae!=="a")return console.error(`Unknown member ${B}`),null;he=3}if(B.length===1){if(j.endsWith("f"))return this.buffer.byteLength<l+4*he+4?(console.log("Insufficient buffer data"),null):new at(new Float32Array(this.buffer,l+4*he,1),e.getTypeInfo("f32"),this);if(j.endsWith("h"))return new at(new Float32Array(this.buffer,l+4*he,1),e.getTypeInfo("f16"),this);if(j.endsWith("i"))return new at(new Int32Array(this.buffer,l+4*he,1),e.getTypeInfo("i32"),this);if(j.endsWith("b"))return new at(new Int32Array(this.buffer,l+4*he,1),e.getTypeInfo("bool"),this);if(j.endsWith("u"))return new at(new Uint32Array(this.buffer,l+4*he,1),e.getTypeInfo("i32"),this)}if(j==="vec2f")se.push(new Float32Array(this.buffer,l,2)[he]);else if(j==="vec3f"){if(l+12>=this.buffer.byteLength)return console.log("Insufficient buffer data"),null;const Le=new Float32Array(this.buffer,l,3);se.push(Le[he])}else if(j==="vec4f")se.push(new Float32Array(this.buffer,l,4)[he]);else if(j==="vec2i")$="i",se.push(new Int32Array(this.buffer,l,2)[he]);else if(j==="vec3i")$="i",se.push(new Int32Array(this.buffer,l,3)[he]);else if(j==="vec4i")$="i",se.push(new Int32Array(this.buffer,l,4)[he]);else if(j==="vec2u"){$="u";const Le=new Uint32Array(this.buffer,l,2);se.push(Le[he])}else j==="vec3u"?($="u",se.push(new Uint32Array(this.buffer,l,3)[he])):j==="vec4u"&&($="u",se.push(new Uint32Array(this.buffer,l,4)[he]))}return se.length===2?M=e.getTypeInfo(`vec2${$}`):se.length===3?M=e.getTypeInfo(`vec3${$}`):se.length===4?M=e.getTypeInfo(`vec4${$}`):console.error(`GetDataValue: Invalid vector length ${se.length}`),new ze(se,M,null)}return console.error(`GetDataValue: Unknown member ${B}`),null}return console.error(`GetDataValue: Type ${j} is not a struct`),null}}}t=t.postfix}const D=M.getTypeName();return D==="f32"?new at(new Float32Array(this.buffer,l,1),M,this):D==="i32"?new at(new Int32Array(this.buffer,l,1),M,this):D==="u32"?new at(new Uint32Array(this.buffer,l,1),M,this):D==="vec2f"?new ze(new Float32Array(this.buffer,l,2),M,this):D==="vec3f"?new ze(new Float32Array(this.buffer,l,3),M,this):D==="vec4f"?new ze(new Float32Array(this.buffer,l,4),M,this):D==="vec2i"?new ze(new Int32Array(this.buffer,l,2),M,this):D==="vec3i"?new ze(new Int32Array(this.buffer,l,3),M,this):D==="vec4i"?new ze(new Int32Array(this.buffer,l,4),M,this):D==="vec2u"?new ze(new Uint32Array(this.buffer,l,2),M,this):D==="vec3u"?new ze(new Uint32Array(this.buffer,l,3),M,this):D==="vec4u"?new ze(new Uint32Array(this.buffer,l,4),M,this):M instanceof S_&&M.name==="atomic"?((o=M.format)===null||o===void 0?void 0:o.name)==="u32"?new at(new Uint32Array(this.buffer,l,1)[0],M.format,this):((p=M.format)===null||p===void 0?void 0:p.name)==="i32"?new at(new Int32Array(this.buffer,l,1)[0],M.format,this):(console.error(`GetDataValue: Invalid atomic format ${(_=M.format)===null||_===void 0?void 0:_.name}`),null):new va(this.buffer,M,l,this)}toString(){let e="";if(this.typeInfo instanceof Hg)if(this.typeInfo.format.name==="f32"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let r=1;r<t.length;++r)e+=`, ${t[r]}`}else if(this.typeInfo.format.name==="i32"){const t=new Int32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let r=1;r<t.length;++r)e+=`, ${t[r]}`}else if(this.typeInfo.format.name==="u32"){const t=new Uint32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let r=1;r<t.length;++r)e+=`, ${t[r]}`}else if(this.typeInfo.format.name==="vec2f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}]`;for(let r=1;r<t.length/2;++r)e+=`, [${t[2*r]}, ${t[2*r+1]}]`}else if(this.typeInfo.format.name==="vec3f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}]`;for(let r=4;r<t.length;r+=4)e+=`, [${t[r]}, ${t[r+1]}, ${t[r+2]}]`}else if(this.typeInfo.format.name==="vec4f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}, ${t[3]}]`;for(let r=4;r<t.length;r+=4)e+=`, [${t[r]}, ${t[r+1]}, ${t[r+2]}, ${t[r+3]}]`}else e="[...]";else this.typeInfo instanceof Wg?e+="{...}":e="[...]";return e}}class Rp extends hf{constructor(e,t,r,o){super(t,null),this.data=e,this.descriptor=r,this.view=o}clone(){return new Rp(this.data,this.typeInfo,this.descriptor,this.view)}get width(){var e,t;const r=this.descriptor.size;return r instanceof Array&&r.length>0?(e=r[0])!==null&&e!==void 0?e:0:r instanceof Object&&(t=r.width)!==null&&t!==void 0?t:0}get height(){var e,t;const r=this.descriptor.size;return r instanceof Array&&r.length>1?(e=r[1])!==null&&e!==void 0?e:0:r instanceof Object&&(t=r.height)!==null&&t!==void 0?t:0}get depthOrArrayLayers(){var e,t;const r=this.descriptor.size;return r instanceof Array&&r.length>2?(e=r[2])!==null&&e!==void 0?e:0:r instanceof Object&&(t=r.depthOrArrayLayers)!==null&&t!==void 0?t:0}get format(){var e;return this.descriptor&&(e=this.descriptor.format)!==null&&e!==void 0?e:"rgba8unorm"}get sampleCount(){var e;return this.descriptor&&(e=this.descriptor.sampleCount)!==null&&e!==void 0?e:1}get mipLevelCount(){var e;return this.descriptor&&(e=this.descriptor.mipLevelCount)!==null&&e!==void 0?e:1}get dimension(){var e;return this.descriptor&&(e=this.descriptor.dimension)!==null&&e!==void 0?e:"2d"}getMipLevelSize(e){if(e>=this.mipLevelCount)return[0,0,0];const t=[this.width,this.height,this.depthOrArrayLayers];for(let r=0;r<t.length;++r)t[r]=Math.max(1,t[r]>>e);return t}get texelByteSize(){const e=this.format,t=Ob[e];return t?t.isDepthStencil?4:t.bytesPerBlock:0}get bytesPerRow(){return this.width*this.texelByteSize}get isDepthStencil(){const e=this.format,t=Ob[e];return!!t&&t.isDepthStencil}getGpuSize(){const e=this.format,t=Ob[e],r=this.width;if(!e||r<=0||!t)return-1;const o=this.height,p=this.depthOrArrayLayers,_=this.dimension;return r/t.blockWidth*(_==="1d"?1:o/t.blockHeight)*t.bytesPerBlock*p}getPixel(e,t,r=0,o=0){const p=this.texelByteSize,_=this.bytesPerRow,l=this.height,M=this.data[o];return Jz(new Uint8Array(M),e,t,r,o,l,_,p,this.format)}setPixel(e,t,r,o,p){const _=this.texelByteSize,l=this.bytesPerRow,M=this.height,D=this.data[o];(function(B,j,$,se,de,Ae,he,Le,$e,Be){const Je=se*(he>>=de)*(Ae>>=de)+$*he+j*Le;switch($e){case"r8unorm":return void Vr(B,Je,"8unorm",1,Be);case"r8snorm":return void Vr(B,Je,"8snorm",1,Be);case"r8uint":return void Vr(B,Je,"8uint",1,Be);case"r8sint":return void Vr(B,Je,"8sint",1,Be);case"rg8unorm":return void Vr(B,Je,"8unorm",2,Be);case"rg8snorm":return void Vr(B,Je,"8snorm",2,Be);case"rg8uint":return void Vr(B,Je,"8uint",2,Be);case"rg8sint":return void Vr(B,Je,"8sint",2,Be);case"rgba8unorm-srgb":case"rgba8unorm":case"bgra8unorm-srgb":case"bgra8unorm":return void Vr(B,Je,"8unorm",4,Be);case"rgba8snorm":return void Vr(B,Je,"8snorm",4,Be);case"rgba8uint":return void Vr(B,Je,"8uint",4,Be);case"rgba8sint":return void Vr(B,Je,"8sint",4,Be);case"r16uint":return void Vr(B,Je,"16uint",1,Be);case"r16sint":return void Vr(B,Je,"16sint",1,Be);case"r16float":return void Vr(B,Je,"16float",1,Be);case"rg16uint":return void Vr(B,Je,"16uint",2,Be);case"rg16sint":return void Vr(B,Je,"16sint",2,Be);case"rg16float":return void Vr(B,Je,"16float",2,Be);case"rgba16uint":return void Vr(B,Je,"16uint",4,Be);case"rgba16sint":return void Vr(B,Je,"16sint",4,Be);case"rgba16float":return void Vr(B,Je,"16float",4,Be);case"r32uint":return void Vr(B,Je,"32uint",1,Be);case"r32sint":return void Vr(B,Je,"32sint",1,Be);case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return void Vr(B,Je,"32float",1,Be);case"rg32uint":return void Vr(B,Je,"32uint",2,Be);case"rg32sint":return void Vr(B,Je,"32sint",2,Be);case"rg32float":return void Vr(B,Je,"32float",2,Be);case"rgba32uint":return void Vr(B,Je,"32uint",4,Be);case"rgba32sint":return void Vr(B,Je,"32sint",4,Be);case"rgba32float":return void Vr(B,Je,"32float",4,Be);case"rg11b10ufloat":console.error("TODO: rg11b10ufloat not supported for writing")}})(new Uint8Array(D),e,t,r,o,M,l,_,this.format,p)}}(i=>{i[i.token=0]="token",i[i.keyword=1]="keyword",i[i.reserved=2]="reserved"})(lt||(lt={}));class ut{constructor(e,t,r){this.name=e,this.type=t,this.rule=r}toString(){return this.name}}class Ie{}St=Ie,Ie.none=new ut("",lt.reserved,""),Ie.eof=new ut("EOF",lt.token,""),Ie.reserved={asm:new ut("asm",lt.reserved,"asm"),bf16:new ut("bf16",lt.reserved,"bf16"),do:new ut("do",lt.reserved,"do"),enum:new ut("enum",lt.reserved,"enum"),f16:new ut("f16",lt.reserved,"f16"),f64:new ut("f64",lt.reserved,"f64"),handle:new ut("handle",lt.reserved,"handle"),i8:new ut("i8",lt.reserved,"i8"),i16:new ut("i16",lt.reserved,"i16"),i64:new ut("i64",lt.reserved,"i64"),mat:new ut("mat",lt.reserved,"mat"),premerge:new ut("premerge",lt.reserved,"premerge"),regardless:new ut("regardless",lt.reserved,"regardless"),typedef:new ut("typedef",lt.reserved,"typedef"),u8:new ut("u8",lt.reserved,"u8"),u16:new ut("u16",lt.reserved,"u16"),u64:new ut("u64",lt.reserved,"u64"),unless:new ut("unless",lt.reserved,"unless"),using:new ut("using",lt.reserved,"using"),vec:new ut("vec",lt.reserved,"vec"),void:new ut("void",lt.reserved,"void")},Ie.keywords={array:new ut("array",lt.keyword,"array"),atomic:new ut("atomic",lt.keyword,"atomic"),bool:new ut("bool",lt.keyword,"bool"),f32:new ut("f32",lt.keyword,"f32"),i32:new ut("i32",lt.keyword,"i32"),mat2x2:new ut("mat2x2",lt.keyword,"mat2x2"),mat2x3:new ut("mat2x3",lt.keyword,"mat2x3"),mat2x4:new ut("mat2x4",lt.keyword,"mat2x4"),mat3x2:new ut("mat3x2",lt.keyword,"mat3x2"),mat3x3:new ut("mat3x3",lt.keyword,"mat3x3"),mat3x4:new ut("mat3x4",lt.keyword,"mat3x4"),mat4x2:new ut("mat4x2",lt.keyword,"mat4x2"),mat4x3:new ut("mat4x3",lt.keyword,"mat4x3"),mat4x4:new ut("mat4x4",lt.keyword,"mat4x4"),ptr:new ut("ptr",lt.keyword,"ptr"),sampler:new ut("sampler",lt.keyword,"sampler"),sampler_comparison:new ut("sampler_comparison",lt.keyword,"sampler_comparison"),struct:new ut("struct",lt.keyword,"struct"),texture_1d:new ut("texture_1d",lt.keyword,"texture_1d"),texture_2d:new ut("texture_2d",lt.keyword,"texture_2d"),texture_2d_array:new ut("texture_2d_array",lt.keyword,"texture_2d_array"),texture_3d:new ut("texture_3d",lt.keyword,"texture_3d"),texture_cube:new ut("texture_cube",lt.keyword,"texture_cube"),texture_cube_array:new ut("texture_cube_array",lt.keyword,"texture_cube_array"),texture_multisampled_2d:new ut("texture_multisampled_2d",lt.keyword,"texture_multisampled_2d"),texture_storage_1d:new ut("texture_storage_1d",lt.keyword,"texture_storage_1d"),texture_storage_2d:new ut("texture_storage_2d",lt.keyword,"texture_storage_2d"),texture_storage_2d_array:new ut("texture_storage_2d_array",lt.keyword,"texture_storage_2d_array"),texture_storage_3d:new ut("texture_storage_3d",lt.keyword,"texture_storage_3d"),texture_depth_2d:new ut("texture_depth_2d",lt.keyword,"texture_depth_2d"),texture_depth_2d_array:new ut("texture_depth_2d_array",lt.keyword,"texture_depth_2d_array"),texture_depth_cube:new ut("texture_depth_cube",lt.keyword,"texture_depth_cube"),texture_depth_cube_array:new ut("texture_depth_cube_array",lt.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new ut("texture_depth_multisampled_2d",lt.keyword,"texture_depth_multisampled_2d"),texture_external:new ut("texture_external",lt.keyword,"texture_external"),u32:new ut("u32",lt.keyword,"u32"),vec2:new ut("vec2",lt.keyword,"vec2"),vec3:new ut("vec3",lt.keyword,"vec3"),vec4:new ut("vec4",lt.keyword,"vec4"),bitcast:new ut("bitcast",lt.keyword,"bitcast"),block:new ut("block",lt.keyword,"block"),break:new ut("break",lt.keyword,"break"),case:new ut("case",lt.keyword,"case"),continue:new ut("continue",lt.keyword,"continue"),continuing:new ut("continuing",lt.keyword,"continuing"),default:new ut("default",lt.keyword,"default"),diagnostic:new ut("diagnostic",lt.keyword,"diagnostic"),discard:new ut("discard",lt.keyword,"discard"),else:new ut("else",lt.keyword,"else"),enable:new ut("enable",lt.keyword,"enable"),fallthrough:new ut("fallthrough",lt.keyword,"fallthrough"),false:new ut("false",lt.keyword,"false"),fn:new ut("fn",lt.keyword,"fn"),for:new ut("for",lt.keyword,"for"),function:new ut("function",lt.keyword,"function"),if:new ut("if",lt.keyword,"if"),let:new ut("let",lt.keyword,"let"),const:new ut("const",lt.keyword,"const"),loop:new ut("loop",lt.keyword,"loop"),while:new ut("while",lt.keyword,"while"),private:new ut("private",lt.keyword,"private"),read:new ut("read",lt.keyword,"read"),read_write:new ut("read_write",lt.keyword,"read_write"),return:new ut("return",lt.keyword,"return"),requires:new ut("requires",lt.keyword,"requires"),storage:new ut("storage",lt.keyword,"storage"),switch:new ut("switch",lt.keyword,"switch"),true:new ut("true",lt.keyword,"true"),alias:new ut("alias",lt.keyword,"alias"),type:new ut("type",lt.keyword,"type"),uniform:new ut("uniform",lt.keyword,"uniform"),var:new ut("var",lt.keyword,"var"),override:new ut("override",lt.keyword,"override"),workgroup:new ut("workgroup",lt.keyword,"workgroup"),write:new ut("write",lt.keyword,"write"),r8unorm:new ut("r8unorm",lt.keyword,"r8unorm"),r8snorm:new ut("r8snorm",lt.keyword,"r8snorm"),r8uint:new ut("r8uint",lt.keyword,"r8uint"),r8sint:new ut("r8sint",lt.keyword,"r8sint"),r16uint:new ut("r16uint",lt.keyword,"r16uint"),r16sint:new ut("r16sint",lt.keyword,"r16sint"),r16float:new ut("r16float",lt.keyword,"r16float"),rg8unorm:new ut("rg8unorm",lt.keyword,"rg8unorm"),rg8snorm:new ut("rg8snorm",lt.keyword,"rg8snorm"),rg8uint:new ut("rg8uint",lt.keyword,"rg8uint"),rg8sint:new ut("rg8sint",lt.keyword,"rg8sint"),r32uint:new ut("r32uint",lt.keyword,"r32uint"),r32sint:new ut("r32sint",lt.keyword,"r32sint"),r32float:new ut("r32float",lt.keyword,"r32float"),rg16uint:new ut("rg16uint",lt.keyword,"rg16uint"),rg16sint:new ut("rg16sint",lt.keyword,"rg16sint"),rg16float:new ut("rg16float",lt.keyword,"rg16float"),rgba8unorm:new ut("rgba8unorm",lt.keyword,"rgba8unorm"),rgba8unorm_srgb:new ut("rgba8unorm_srgb",lt.keyword,"rgba8unorm_srgb"),rgba8snorm:new ut("rgba8snorm",lt.keyword,"rgba8snorm"),rgba8uint:new ut("rgba8uint",lt.keyword,"rgba8uint"),rgba8sint:new ut("rgba8sint",lt.keyword,"rgba8sint"),bgra8unorm:new ut("bgra8unorm",lt.keyword,"bgra8unorm"),bgra8unorm_srgb:new ut("bgra8unorm_srgb",lt.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new ut("rgb10a2unorm",lt.keyword,"rgb10a2unorm"),rg11b10float:new ut("rg11b10float",lt.keyword,"rg11b10float"),rg32uint:new ut("rg32uint",lt.keyword,"rg32uint"),rg32sint:new ut("rg32sint",lt.keyword,"rg32sint"),rg32float:new ut("rg32float",lt.keyword,"rg32float"),rgba16uint:new ut("rgba16uint",lt.keyword,"rgba16uint"),rgba16sint:new ut("rgba16sint",lt.keyword,"rgba16sint"),rgba16float:new ut("rgba16float",lt.keyword,"rgba16float"),rgba32uint:new ut("rgba32uint",lt.keyword,"rgba32uint"),rgba32sint:new ut("rgba32sint",lt.keyword,"rgba32sint"),rgba32float:new ut("rgba32float",lt.keyword,"rgba32float"),static_assert:new ut("static_assert",lt.keyword,"static_assert")},Ie.tokens={decimal_float_literal:new ut("decimal_float_literal",lt.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new ut("hex_float_literal",lt.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new ut("int_literal",lt.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new ut("uint_literal",lt.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new ut("name",lt.token,/([_\p{XID_Start}][\p{XID_Continue}]+)|([\p{XID_Start}])/u),ident:new ut("ident",lt.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new ut("and",lt.token,"&"),and_and:new ut("and_and",lt.token,"&&"),arrow:new ut("arrow ",lt.token,"->"),attr:new ut("attr",lt.token,"@"),forward_slash:new ut("forward_slash",lt.token,"/"),bang:new ut("bang",lt.token,"!"),bracket_left:new ut("bracket_left",lt.token,"["),bracket_right:new ut("bracket_right",lt.token,"]"),brace_left:new ut("brace_left",lt.token,"{"),brace_right:new ut("brace_right",lt.token,"}"),colon:new ut("colon",lt.token,":"),comma:new ut("comma",lt.token,","),equal:new ut("equal",lt.token,"="),equal_equal:new ut("equal_equal",lt.token,"=="),not_equal:new ut("not_equal",lt.token,"!="),greater_than:new ut("greater_than",lt.token,">"),greater_than_equal:new ut("greater_than_equal",lt.token,">="),shift_right:new ut("shift_right",lt.token,">>"),less_than:new ut("less_than",lt.token,"<"),less_than_equal:new ut("less_than_equal",lt.token,"<="),shift_left:new ut("shift_left",lt.token,"<<"),modulo:new ut("modulo",lt.token,"%"),minus:new ut("minus",lt.token,"-"),minus_minus:new ut("minus_minus",lt.token,"--"),period:new ut("period",lt.token,"."),plus:new ut("plus",lt.token,"+"),plus_plus:new ut("plus_plus",lt.token,"++"),or:new ut("or",lt.token,"|"),or_or:new ut("or_or",lt.token,"||"),paren_left:new ut("paren_left",lt.token,"("),paren_right:new ut("paren_right",lt.token,")"),semicolon:new ut("semicolon",lt.token,";"),star:new ut("star",lt.token,"*"),tilde:new ut("tilde",lt.token,"~"),underscore:new ut("underscore",lt.token,"_"),xor:new ut("xor",lt.token,"^"),plus_equal:new ut("plus_equal",lt.token,"+="),minus_equal:new ut("minus_equal",lt.token,"-="),times_equal:new ut("times_equal",lt.token,"*="),division_equal:new ut("division_equal",lt.token,"/="),modulo_equal:new ut("modulo_equal",lt.token,"%="),and_equal:new ut("and_equal",lt.token,"&="),or_equal:new ut("or_equal",lt.token,"|="),xor_equal:new ut("xor_equal",lt.token,"^="),shift_right_equal:new ut("shift_right_equal",lt.token,">>="),shift_left_equal:new ut("shift_left_equal",lt.token,"<<=")},Ie.simpleTokens={"@":St.tokens.attr,"{":St.tokens.brace_left,"}":St.tokens.brace_right,":":St.tokens.colon,",":St.tokens.comma,"(":St.tokens.paren_left,")":St.tokens.paren_right,";":St.tokens.semicolon},Ie.literalTokens={"&":St.tokens.and,"&&":St.tokens.and_and,"->":St.tokens.arrow,"/":St.tokens.forward_slash,"!":St.tokens.bang,"[":St.tokens.bracket_left,"]":St.tokens.bracket_right,"=":St.tokens.equal,"==":St.tokens.equal_equal,"!=":St.tokens.not_equal,">":St.tokens.greater_than,">=":St.tokens.greater_than_equal,">>":St.tokens.shift_right,"<":St.tokens.less_than,"<=":St.tokens.less_than_equal,"<<":St.tokens.shift_left,"%":St.tokens.modulo,"-":St.tokens.minus,"--":St.tokens.minus_minus,".":St.tokens.period,"+":St.tokens.plus,"++":St.tokens.plus_plus,"|":St.tokens.or,"||":St.tokens.or_or,"*":St.tokens.star,"~":St.tokens.tilde,_:St.tokens.underscore,"^":St.tokens.xor,"+=":St.tokens.plus_equal,"-=":St.tokens.minus_equal,"*=":St.tokens.times_equal,"/=":St.tokens.division_equal,"%=":St.tokens.modulo_equal,"&=":St.tokens.and_equal,"|=":St.tokens.or_equal,"^=":St.tokens.xor_equal,">>=":St.tokens.shift_right_equal,"<<=":St.tokens.shift_left_equal},Ie.regexTokens={decimal_float_literal:St.tokens.decimal_float_literal,hex_float_literal:St.tokens.hex_float_literal,int_literal:St.tokens.int_literal,uint_literal:St.tokens.uint_literal,ident:St.tokens.ident},Ie.storage_class=[St.keywords.function,St.keywords.private,St.keywords.workgroup,St.keywords.uniform,St.keywords.storage],Ie.access_mode=[St.keywords.read,St.keywords.write,St.keywords.read_write],Ie.sampler_type=[St.keywords.sampler,St.keywords.sampler_comparison],Ie.sampled_texture_type=[St.keywords.texture_1d,St.keywords.texture_2d,St.keywords.texture_2d_array,St.keywords.texture_3d,St.keywords.texture_cube,St.keywords.texture_cube_array],Ie.multisampled_texture_type=[St.keywords.texture_multisampled_2d],Ie.storage_texture_type=[St.keywords.texture_storage_1d,St.keywords.texture_storage_2d,St.keywords.texture_storage_2d_array,St.keywords.texture_storage_3d],Ie.depth_texture_type=[St.keywords.texture_depth_2d,St.keywords.texture_depth_2d_array,St.keywords.texture_depth_cube,St.keywords.texture_depth_cube_array,St.keywords.texture_depth_multisampled_2d],Ie.texture_external_type=[St.keywords.texture_external],Ie.any_texture_type=[...St.sampled_texture_type,...St.multisampled_texture_type,...St.storage_texture_type,...St.depth_texture_type,...St.texture_external_type],Ie.texel_format=[St.keywords.r8unorm,St.keywords.r8snorm,St.keywords.r8uint,St.keywords.r8sint,St.keywords.r16uint,St.keywords.r16sint,St.keywords.r16float,St.keywords.rg8unorm,St.keywords.rg8snorm,St.keywords.rg8uint,St.keywords.rg8sint,St.keywords.r32uint,St.keywords.r32sint,St.keywords.r32float,St.keywords.rg16uint,St.keywords.rg16sint,St.keywords.rg16float,St.keywords.rgba8unorm,St.keywords.rgba8unorm_srgb,St.keywords.rgba8snorm,St.keywords.rgba8uint,St.keywords.rgba8sint,St.keywords.bgra8unorm,St.keywords.bgra8unorm_srgb,St.keywords.rgb10a2unorm,St.keywords.rg11b10float,St.keywords.rg32uint,St.keywords.rg32sint,St.keywords.rg32float,St.keywords.rgba16uint,St.keywords.rgba16sint,St.keywords.rgba16float,St.keywords.rgba32uint,St.keywords.rgba32sint,St.keywords.rgba32float],Ie.const_literal=[St.tokens.int_literal,St.tokens.uint_literal,St.tokens.decimal_float_literal,St.tokens.hex_float_literal,St.keywords.true,St.keywords.false],Ie.literal_or_ident=[St.tokens.ident,St.tokens.int_literal,St.tokens.uint_literal,St.tokens.decimal_float_literal,St.tokens.hex_float_literal,St.tokens.name],Ie.element_count_expression=[St.tokens.int_literal,St.tokens.uint_literal,St.tokens.ident],Ie.template_types=[St.keywords.vec2,St.keywords.vec3,St.keywords.vec4,St.keywords.mat2x2,St.keywords.mat2x3,St.keywords.mat2x4,St.keywords.mat3x2,St.keywords.mat3x3,St.keywords.mat3x4,St.keywords.mat4x2,St.keywords.mat4x3,St.keywords.mat4x4,St.keywords.atomic,St.keywords.bitcast,...St.any_texture_type],Ie.attribute_name=[St.tokens.ident,St.keywords.block,St.keywords.diagnostic],Ie.assignment_operators=[St.tokens.equal,St.tokens.plus_equal,St.tokens.minus_equal,St.tokens.times_equal,St.tokens.division_equal,St.tokens.modulo_equal,St.tokens.and_equal,St.tokens.or_equal,St.tokens.xor_equal,St.tokens.shift_right_equal,St.tokens.shift_left_equal],Ie.increment_operators=[St.tokens.plus_plus,St.tokens.minus_minus];class h4{constructor(e,t,r,o,p){this.type=e,this.lexeme=t,this.line=r,this.start=o,this.end=p}toString(){return this.lexeme}isTemplateType(){return Ie.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==Ie.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class rL{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new h4(Ie.eof,"",this._line,this._current,this._current)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}if(this._peekAhead()=="*"){this._advance();let _=1;for(;_>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),_--,_==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),_++)}return!0}}const t=Ie.simpleTokens[e];if(t)return this._addToken(t),!0;let r=Ie.none;const o=this._isAlpha(e),p=e==="_";if(this._isAlphaNumeric(e)){let _=this._peekAhead();for(;this._isAlphaNumeric(_);)e+=this._advance(),_=this._peekAhead()}if(o){const _=Ie.keywords[e];if(_)return this._addToken(_),!0}if(o||p)return this._addToken(Ie.tokens.ident),!0;for(;;){let _=this._findType(e);const l=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(l=="=")return this._current++,e+=l,this._addToken(Ie.tokens.minus_equal),!0;if(l=="-")return this._current++,e+=l,this._addToken(Ie.tokens.minus_minus),!0;const M=this._tokens.length-1;if((Ie.literal_or_ident.indexOf(this._tokens[M].type)!=-1||this._tokens[M].type==Ie.tokens.paren_right)&&l!=">")return this._addToken(_),!0}if(e==">"&&(l==">"||l=="=")){let M=!1,D=this._tokens.length-1;for(let B=0;B<5&&D>=0&&Ie.assignment_operators.indexOf(this._tokens[D].type)===-1;++B,--D)if(this._tokens[D].type===Ie.tokens.less_than){D>0&&this._tokens[D-1].isArrayOrTemplateType()&&(M=!0);break}if(M)return this._addToken(_),!0}if(_===Ie.none){let M=e,D=0;const B=2;for(let j=0;j<B;++j)if(M+=this._peekAhead(j),_=this._findType(M),_!==Ie.none){D=j;break}if(_===Ie.none)return r!==Ie.none&&(this._current--,this._addToken(r),!0);e=M,this._current+=D+1}if(r=_,this._isAtEnd())break;e+=this._advance()}return r!==Ie.none&&(this._addToken(r),!0)}_findType(e){for(const r in Ie.regexTokens){const o=Ie.regexTokens[r];if(this._match(e,o.rule))return o}return Ie.literalTokens[e]||Ie.none}_match(e,t){const r=t.exec(e);return r&&r.index==0&&r[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return!this._isNumeric(e)&&!this._isWhitespace(e)&&e!=="_"&&e!=="."&&e!=="("&&e!==")"&&e!=="["&&e!=="]"&&e!=="{"&&e!=="}"&&e!==","&&e!==";"&&e!==":"&&e!=="="&&e!=="!"&&e!=="<"&&e!==">"&&e!=="+"&&e!=="-"&&e!=="*"&&e!=="/"&&e!=="%"&&e!=="&"&&e!=="|"&&e!=="^"&&e!=="~"&&e!=="@"&&e!=="#"&&e!=="?"&&e!=="'"&&e!=="`"&&e!=='"'&&e!=="\\"&&e!==`
`&&e!=="\r"&&e!=="	"&&e!=="\0"}_isNumeric(e){return e>="0"&&e<="9"}_isAlphaNumeric(e){return this._isAlpha(e)||this._isNumeric(e)||e==="_"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let t=this._source[this._current];return e=e||0,e++,this._current+=e,t}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const t=this._source.substring(this._start,this._current);this._tokens.push(new h4(e,t,this._line,this._start,this._current))}}function Ri(i){return Array.isArray(i)||(i==null?void 0:i.buffer)instanceof ArrayBuffer}const ax=new Float32Array(1),sL=new Uint32Array(ax.buffer),aL=new Uint32Array(ax.buffer),ox=new Int32Array(1),oL=new Float32Array(ox.buffer),lL=new Uint32Array(ox.buffer),lx=new Uint32Array(1),cL=new Float32Array(lx.buffer),uL=new Int32Array(lx.buffer);function f4(i,e,t){if(e===t)return i;if(e==="f32"){if(t==="i32"||t==="x32")return ax[0]=i,sL[0];if(t==="u32")return ax[0]=i,aL[0]}else if(e==="i32"||e==="x32"){if(t==="f32")return ox[0]=i,oL[0];if(t==="u32")return ox[0]=i,lL[0]}else if(e==="u32"){if(t==="f32")return lx[0]=i,cL[0];if(t==="i32"||t==="x32")return lx[0]=i,uL[0]}return console.error(`Unsupported cast from ${e} to ${t}`),i}class hL{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class uv{constructor(e,t){this.align=e,this.size=t}}class s0{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new Hz,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}updateAST(e){for(const t of e)t instanceof p1&&this._functions.set(t.name,new hL(t));for(const t of e)if(t instanceof Mp){const r=this.getTypeInfo(t,null);r instanceof Wg&&this.structs.push(r)}for(const t of e)if(t instanceof kw)this.aliases.push(this._getAliasInfo(t));else{if(t instanceof Pw){const r=t,o=this._getAttributeNum(r.attributes,"id",0),p=r.type!=null?this.getTypeInfo(r.type,r.attributes):null;this.overrides.push(new Wz(r.name,p,r.attributes,o));continue}if(this._isUniformVar(t)){const r=t,o=this._getAttributeNum(r.attributes,"group",0),p=this._getAttributeNum(r.attributes,"binding",0),_=this.getTypeInfo(r.type,r.attributes),l=new cv(r.name,_,o,p,r.attributes,Vg.Uniform,r.access);l.access||(l.access="read"),this.uniforms.push(l);continue}if(this._isStorageVar(t)){const r=t,o=this._getAttributeNum(r.attributes,"group",0),p=this._getAttributeNum(r.attributes,"binding",0),_=this.getTypeInfo(r.type,r.attributes),l=this._isStorageTexture(_),M=new cv(r.name,_,o,p,r.attributes,l?Vg.StorageTexture:Vg.Storage,r.access);M.access||(M.access="read"),this.storage.push(M);continue}if(this._isTextureVar(t)){const r=t,o=this._getAttributeNum(r.attributes,"group",0),p=this._getAttributeNum(r.attributes,"binding",0),_=this.getTypeInfo(r.type,r.attributes),l=this._isStorageTexture(_),M=new cv(r.name,_,o,p,r.attributes,l?Vg.StorageTexture:Vg.Texture,r.access);M.access||(M.access="read"),l?this.storage.push(M):this.textures.push(M);continue}if(this._isSamplerVar(t)){const r=t,o=this._getAttributeNum(r.attributes,"group",0),p=this._getAttributeNum(r.attributes,"binding",0),_=this.getTypeInfo(r.type,r.attributes),l=new cv(r.name,_,o,p,r.attributes,Vg.Sampler,r.access);this.samplers.push(l);continue}}for(const t of e)if(t instanceof p1){const r=this._getAttribute(t,"vertex"),o=this._getAttribute(t,"fragment"),p=this._getAttribute(t,"compute"),_=r||o||p,l=new Xz(t.name,_==null?void 0:_.name,t.attributes);l.attributes=t.attributes,l.startLine=t.startLine,l.endLine=t.endLine,this.functions.push(l),this._functions.get(t.name).info=l,_&&(this._functions.get(t.name).inUse=!0,l.inUse=!0,l.resources=this._findResources(t,!!_),l.inputs=this._getInputs(t.args),l.outputs=this._getOutputs(t.returnType),this.entry[_.name].push(l)),l.arguments=t.args.map(M=>new Zz(M.name,this.getTypeInfo(M.type,M.attributes),M.attributes)),l.returnType=t.returnType?this.getTypeInfo(t.returnType,t.attributes):null;continue}for(const t of this._functions.values())t.info&&(t.info.inUse=t.inUse,this._addCalls(t.node,t.info.calls));for(const t of this._functions.values())t.node.search(r=>{var o,p,_;if(r instanceof vM){if(r.value)if(Ri(r.value))for(const l of r.value)for(const M of this.overrides)l===M.name&&((o=t.info)===null||o===void 0||o.overrides.push(M));else for(const l of this.overrides)r.value===l.name&&((p=t.info)===null||p===void 0||p.overrides.push(l))}else if(r instanceof oh)for(const l of this.overrides)r.name===l.name&&((_=t.info)===null||_===void 0||_.overrides.push(l))});for(const t of this.uniforms)this._markStructsInUse(t.type);for(const t of this.storage)this._markStructsInUse(t.type)}getFunctionInfo(e){for(const t of this.functions)if(t.name==e)return t;return null}getStructInfo(e){for(const t of this.structs)if(t.name==e)return t;return null}getOverrideInfo(e){for(const t of this.overrides)if(t.name==e)return t;return null}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(const t of e.members)this._markStructsInUse(t.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{const t=this._getAlias(e.name);t&&this._markStructsInUse(t)}}_addCalls(e,t){var r;for(const o of e.calls){const p=(r=this._functions.get(o.name))===null||r===void 0?void 0:r.info;p&&t.add(p)}}findResource(e,t,r){if(r){for(const o of this.entry.compute)if(o.name===r){for(const p of o.resources)if(p.group==e&&p.binding==t)return p}for(const o of this.entry.vertex)if(o.name===r){for(const p of o.resources)if(p.group==e&&p.binding==t)return p}for(const o of this.entry.fragment)if(o.name===r){for(const p of o.resources)if(p.group==e&&p.binding==t)return p}}for(const o of this.uniforms)if(o.group==e&&o.binding==t)return o;for(const o of this.storage)if(o.group==e&&o.binding==t)return o;for(const o of this.textures)if(o.group==e&&o.binding==t)return o;for(const o of this.samplers)if(o.group==e&&o.binding==t)return o;return null}_findResource(e){for(const t of this.uniforms)if(t.name==e)return t;for(const t of this.storage)if(t.name==e)return t;for(const t of this.textures)if(t.name==e)return t;for(const t of this.samplers)if(t.name==e)return t;return null}_markStructsFromAST(e){const t=this.getTypeInfo(e,null);this._markStructsInUse(t)}_findResources(e,t){const r=[],o=this,p=[];return e.search(_=>{if(_ instanceof rx)p.push({});else if(_ instanceof sx)p.pop();else if(_ instanceof Cp){const l=_;t&&l.type!==null&&this._markStructsFromAST(l.type),p.length>0&&(p[p.length-1][l.name]=l)}else if(_ instanceof n0){const l=_;t&&l.type!==null&&this._markStructsFromAST(l.type)}else if(_ instanceof e1){const l=_;t&&l.type!==null&&this._markStructsFromAST(l.type),p.length>0&&(p[p.length-1][l.name]=l)}else if(_ instanceof oh){const l=_;if(p.length>0&&p[p.length-1][l.name])return;const M=o._findResource(l.name);M&&r.push(M)}else if(_ instanceof Dw){const l=_,M=o._functions.get(l.name);M&&(t&&(M.inUse=!0),e.calls.add(M.node),M.resources===null&&(M.resources=o._findResources(M.node,t)),r.push(...M.resources))}else if(_ instanceof Iw){const l=_,M=o._functions.get(l.name);M&&(t&&(M.inUse=!0),e.calls.add(M.node),M.resources===null&&(M.resources=o._findResources(M.node,t)),r.push(...M.resources))}}),[...new Map(r.map(_=>[_.name,_])).values()]}getBindGroups(){const e=[];function t(r,o){r>=e.length&&(e.length=r+1),e[r]===void 0&&(e[r]=[]),o>=e[r].length&&(e[r].length=o+1)}for(const r of this.uniforms)t(r.group,r.binding),e[r.group][r.binding]=r;for(const r of this.storage)t(r.group,r.binding),e[r.group][r.binding]=r;for(const r of this.textures)t(r.group,r.binding),e[r.group][r.binding]=r;for(const r of this.samplers)t(r.group,r.binding),e[r.group][r.binding]=r;return e}_getOutputs(e,t=void 0){if(t===void 0&&(t=[]),e instanceof Mp)this._getStructOutputs(e,t);else{const r=this._getOutputInfo(e);r!==null&&t.push(r)}return t}_getStructOutputs(e,t){for(const r of e.members)if(r.type instanceof Mp)this._getStructOutputs(r.type,t);else{const o=this._getAttribute(r,"location")||this._getAttribute(r,"builtin");if(o!==null){const p=this.getTypeInfo(r.type,r.type.attributes),_=this._parseInt(o.value),l=new a4(r.name,p,o.name,_);t.push(l)}}}_getOutputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){const r=this.getTypeInfo(e,e.attributes),o=this._parseInt(t.value);return new a4("",r,t.name,o)}return null}_getInputs(e,t=void 0){t===void 0&&(t=[]);for(const r of e)if(r.type instanceof Mp)this._getStructInputs(r.type,t);else{const o=this._getInputInfo(r);o!==null&&t.push(o)}return t}_getStructInputs(e,t){for(const r of e.members)if(r.type instanceof Mp)this._getStructInputs(r.type,t);else{const o=this._getInputInfo(r);o!==null&&t.push(o)}}_getInputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){const r=this._getAttribute(e,"interpolation"),o=this.getTypeInfo(e.type,e.attributes),p=this._parseInt(t.value),_=new Gz(e.name,o,t.name,p);return r!==null&&(_.interpolation=this._parseString(r.value)),_}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const t=parseInt(e);return isNaN(t)?e:t}_getAlias(e){for(const t of this.aliases)if(t.name==e)return t.type;return null}_getAliasInfo(e){return new jz(e.name,this.getTypeInfo(e.type,null))}getTypeInfoByName(e){for(const t of this.structs)if(t.name==e)return t;for(const t of this.aliases)if(t.name==e)return t.type;return null}getTypeInfo(e,t=null){if(this._types.has(e))return this._types.get(e);if(e instanceof Mv){const o=e.type?this.getTypeInfo(e.type,e.attributes):null,p=new PA(e.name,o,t);return this._types.set(e,p),this._updateTypeInfo(p),p}if(e instanceof t1){const o=e,p=o.format?this.getTypeInfo(o.format,o.attributes):null,_=new Hg(o.name,t);return _.format=p,_.count=o.count,this._types.set(e,_),this._updateTypeInfo(_),_}if(e instanceof Mp){const o=e,p=new Wg(o.name,t);p.startLine=o.startLine,p.endLine=o.endLine;for(const _ of o.members){const l=this.getTypeInfo(_.type,_.attributes);p.members.push(new s4(_.name,l,_.attributes))}return this._types.set(e,p),this._updateTypeInfo(p),p}if(e instanceof G2){const o=e,p=o.format instanceof Kt,_=o.format?p?this.getTypeInfo(o.format,null):new lf(o.format,null):null,l=new S_(o.name,_,t,o.access);return this._types.set(e,l),this._updateTypeInfo(l),l}if(e instanceof gt){const o=e,p=o.format?this.getTypeInfo(o.format,null):null,_=new S_(o.name,p,t,o.access);return this._types.set(e,_),this._updateTypeInfo(_),_}const r=new lf(e.name,t);return this._types.set(e,r),this._updateTypeInfo(r),r}_updateTypeInfo(e){var t,r,o;const p=this._getTypeSize(e);if(e.size=(t=p==null?void 0:p.size)!==null&&t!==void 0?t:0,e instanceof Hg&&e.format){const _=this._getTypeSize(e.format);e.stride=Math.max((r=_==null?void 0:_.size)!==null&&r!==void 0?r:0,(o=_==null?void 0:_.align)!==null&&o!==void 0?o:0),this._updateTypeInfo(e.format)}e instanceof PA&&this._updateTypeInfo(e.format),e instanceof Wg&&this._updateStructInfo(e)}_updateStructInfo(e){var t;let r=0,o=0,p=0,_=0;for(let l=0,M=e.members.length;l<M;++l){const D=e.members[l],B=this._getTypeSize(D);if(!B)continue;(t=this._getAlias(D.type.name))!==null&&t!==void 0||D.type;const j=B.align,$=B.size;r=this._roundUp(j,r+o),o=$,p=r,_=Math.max(_,j),D.offset=r,D.size=$,this._updateTypeInfo(D.type)}e.size=this._roundUp(_,p+o),e.align=_}_getTypeSize(e){var t,r;if(e==null)return null;const o=this._getAttributeNum(e.attributes,"size",0),p=this._getAttributeNum(e.attributes,"align",0);if(e instanceof s4&&(e=e.type),e instanceof lf){const _=this._getAlias(e.name);_!==null&&(e=_)}{const _=s0._typeInfo[e.name];if(_!==void 0){const l=((t=e.format)===null||t===void 0?void 0:t.name)==="f16"?2:1;return new uv(Math.max(p,_.align/l),Math.max(o,_.size/l))}}{const _=s0._typeInfo[e.name.substring(0,e.name.length-1)];if(_){const l=e.name[e.name.length-1]==="h"?2:1;return new uv(Math.max(p,_.align/l),Math.max(o,_.size/l))}}if(e instanceof Hg){let _=e,l=8,M=8;const D=this._getTypeSize(_.format);return D!==null&&(M=D.size,l=D.align),M=_.count*this._getAttributeNum((r=e==null?void 0:e.attributes)!==null&&r!==void 0?r:null,"stride",this._roundUp(l,M)),o&&(M=o),new uv(Math.max(p,l),Math.max(o,M))}if(e instanceof Wg){let _=0,l=0,M=0,D=0,B=0;for(const j of e.members){const $=this._getTypeSize(j.type);$!==null&&(_=Math.max($.align,_),M=this._roundUp($.align,M+D),D=$.size,B=M)}return l=this._roundUp(_,B+D),new uv(Math.max(p,_),Math.max(o,l))}return null}_isUniformVar(e){return e instanceof Cp&&e.storage=="uniform"}_isStorageVar(e){return e instanceof Cp&&e.storage=="storage"}_isTextureVar(e){return e instanceof Cp&&e.type!==null&&s0._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof Cp&&e.type!==null&&s0._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,t){const r=e;if(!r||!r.attributes)return null;const o=r.attributes;for(let p of o)if(p.name==t)return p;return null}_getAttributeNum(e,t,r){if(e===null)return r;for(let o of e)if(o.name==t){let p=o!==null&&o.value!==null?o.value:r;return p instanceof Array&&(p=p[0]),typeof p=="number"?p:typeof p=="string"?parseInt(p):r}return r}_roundUp(e,t){return Math.ceil(t/e)*e}}s0._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},s0._textureTypes=Ie.any_texture_type.map(i=>i.name),s0._samplerTypes=Ie.sampler_type.map(i=>i.name);let Ow=0;class Fw{constructor(e,t,r){this.id=Ow++,this.name=e,this.value=t,this.node=r}clone(){return new Fw(this.name,this.value,this.node)}}class Nw{constructor(e){this.id=Ow++,this.name=e.name,this.node=e}clone(){return new Nw(this.node)}}class Bw{constructor(e){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",this.id=Ow++,e&&(this.parent=e,this.currentFunctionName=e.currentFunctionName)}getVariable(e){var t;return this.variables.has(e)?(t=this.variables.get(e))!==null&&t!==void 0?t:null:this.parent?this.parent.getVariable(e):null}getFunction(e){var t;return this.functions.has(e)?(t=this.functions.get(e))!==null&&t!==void 0?t:null:this.parent?this.parent.getFunction(e):null}createVariable(e,t,r){this.variables.set(e,new Fw(e,t,r??null))}setVariable(e,t,r){const o=this.getVariable(e);o!==null?o.value=t:this.createVariable(e,t,r)}getVariableValue(e){var t;const r=this.getVariable(e);return(t=r==null?void 0:r.value)!==null&&t!==void 0?t:null}clone(){return new Bw(this)}}class fL{evalExpression(e,t){return null}getTypeInfo(e){return null}getVariableName(e,t){return""}}class dL{constructor(e){this.exec=e}getTypeInfo(e){return this.exec.getTypeInfo(e)}All(e,t){const r=this.exec.evalExpression(e.args[0],t);let o=!0;if(r instanceof ze)return r.data.forEach(p=>{p||(o=!1)}),new at(o?1:0,this.getTypeInfo("bool"));throw new Error(`All() expects a vector argument. Line ${e.line}`)}Any(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof ze){const o=r.data.some(p=>p);return new at(o?1:0,this.getTypeInfo("bool"))}throw new Error(`Any() expects a vector argument. Line ${e.line}`)}Select(e,t){const r=this.exec.evalExpression(e.args[2],t);if(!(r instanceof at))throw new Error(`Select() expects a bool condition. Line ${e.line}`);return r.value?this.exec.evalExpression(e.args[1],t):this.exec.evalExpression(e.args[0],t)}ArrayLength(e,t){let r=e.args[0];r instanceof io&&(r=r.right);const o=this.exec.evalExpression(r,t);if(o instanceof va&&o.typeInfo.size===0){const p=o.typeInfo,_=o.buffer.byteLength/p.stride;return new at(_,this.getTypeInfo("u32"))}return new at(o.typeInfo.size,this.getTypeInfo("u32"))}Abs(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof ze)return new ze(r.data.map(p=>Math.abs(p)),r.typeInfo);const o=r;return new at(Math.abs(o.value),o.typeInfo)}Acos(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof ze)return new ze(r.data.map(p=>Math.acos(p)),r.typeInfo);const o=r;return new at(Math.acos(o.value),r.typeInfo)}Acosh(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof ze)return new ze(r.data.map(p=>Math.acosh(p)),r.typeInfo);const o=r;return new at(Math.acosh(o.value),r.typeInfo)}Asin(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof ze)return new ze(r.data.map(p=>Math.asin(p)),r.typeInfo);const o=r;return new at(Math.asin(o.value),r.typeInfo)}Asinh(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof ze)return new ze(r.data.map(p=>Math.asinh(p)),r.typeInfo);const o=r;return new at(Math.asinh(o.value),r.typeInfo)}Atan(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof ze)return new ze(r.data.map(p=>Math.atan(p)),r.typeInfo);const o=r;return new at(Math.atan(o.value),r.typeInfo)}Atanh(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof ze)return new ze(r.data.map(p=>Math.atanh(p)),r.typeInfo);const o=r;return new at(Math.atanh(o.value),r.typeInfo)}Atan2(e,t){const r=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t);if(r instanceof ze&&o instanceof ze)return new ze(r.data.map((l,M)=>Math.atan2(l,o.data[M])),r.typeInfo);const p=r,_=o;return new at(Math.atan2(p.value,_.value),r.typeInfo)}Ceil(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof ze)return new ze(r.data.map(p=>Math.ceil(p)),r.typeInfo);const o=r;return new at(Math.ceil(o.value),r.typeInfo)}_clamp(e,t,r){return Math.min(Math.max(e,t),r)}Clamp(e,t){const r=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t),p=this.exec.evalExpression(e.args[2],t);if(r instanceof ze&&o instanceof ze&&p instanceof ze)return new ze(r.data.map((D,B)=>this._clamp(D,o.data[B],p.data[B])),r.typeInfo);const _=r,l=o,M=p;return new at(this._clamp(_.value,l.value,M.value),r.typeInfo)}Cos(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof ze)return new ze(r.data.map(p=>Math.cos(p)),r.typeInfo);const o=r;return new at(Math.cos(o.value),r.typeInfo)}Cosh(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof ze)return new ze(r.data.map(p=>Math.cosh(p)),r.typeInfo);const o=r;return new at(Math.cos(o.value),r.typeInfo)}CountLeadingZeros(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof ze)return new ze(r.data.map(p=>Math.clz32(p)),r.typeInfo);const o=r;return new at(Math.clz32(o.value),r.typeInfo)}_countOneBits(e){let t=0;for(;e!==0;)1&e&&t++,e>>=1;return t}CountOneBits(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof ze)return new ze(r.data.map(p=>this._countOneBits(p)),r.typeInfo);const o=r;return new at(this._countOneBits(o.value),r.typeInfo)}_countTrailingZeros(e){if(e===0)return 32;let t=0;for(;!(1&e);)e>>=1,t++;return t}CountTrailingZeros(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof ze)return new ze(r.data.map(p=>this._countTrailingZeros(p)),r.typeInfo);const o=r;return new at(this._countTrailingZeros(o.value),r.typeInfo)}Cross(e,t){const r=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t);if(r instanceof ze&&o instanceof ze){if(r.data.length!==3||o.data.length!==3)return console.error(`Cross() expects 3D vectors. Line ${e.line}`),null;const p=r.data,_=o.data;return new ze([p[1]*_[2]-_[1]*p[2],p[2]*_[0]-_[2]*p[0],p[0]*_[1]-_[0]*p[1]],r.typeInfo)}return console.error(`Cross() expects vector arguments. Line ${e.line}`),null}Degrees(e,t){const r=this.exec.evalExpression(e.args[0],t),o=180/Math.PI;return r instanceof ze?new ze(r.data.map(p=>p*o),r.typeInfo):new at(r.value*o,this.getTypeInfo("f32"))}Determinant(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof cn){const o=r.data,p=r.typeInfo.getTypeName(),_=p.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if(p==="mat2x2"||p==="mat2x2f"||p==="mat2x2h")return new at(o[0]*o[3]-o[1]*o[2],_);if(p==="mat2x3"||p==="mat2x3f"||p==="mat2x3h")return new at(o[0]*(o[4]*o[8]-o[5]*o[7])-o[1]*(o[3]*o[8]-o[5]*o[6])+o[2]*(o[3]*o[7]-o[4]*o[6]),_);if(p==="mat2x4"||p==="mat2x4f"||p==="mat2x4h")console.error(`TODO: Determinant for ${p}`);else if(p==="mat3x2"||p==="mat3x2f"||p==="mat3x2h")console.error(`TODO: Determinant for ${p}`);else{if(p==="mat3x3"||p==="mat3x3f"||p==="mat3x3h")return new at(o[0]*(o[4]*o[8]-o[5]*o[7])-o[1]*(o[3]*o[8]-o[5]*o[6])+o[2]*(o[3]*o[7]-o[4]*o[6]),_);p==="mat3x4"||p==="mat3x4f"||p==="mat3x4h"||p==="mat4x2"||p==="mat4x2f"||p==="mat4x2h"||p==="mat4x3"||p==="mat4x3f"||p==="mat4x3h"?console.error(`TODO: Determinant for ${p}`):p!=="mat4x4"&&p!=="mat4x4f"&&p!=="mat4x4h"||console.error(`TODO: Determinant for ${p}`)}}return console.error(`Determinant expects a matrix argument. Line ${e.line}`),null}Distance(e,t){const r=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t);if(r instanceof ze&&o instanceof ze){let l=0;for(let M=0;M<r.data.length;++M)l+=(r.data[M]-o.data[M])*(r.data[M]-o.data[M]);return new at(Math.sqrt(l),this.getTypeInfo("f32"))}const p=r,_=o;return new at(Math.abs(p.value-_.value),r.typeInfo)}_dot(e,t){let r=0;for(let o=0;o<e.length;++o)r+=t[o]*e[o];return r}Dot(e,t){const r=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t);return r instanceof ze&&o instanceof ze?new at(this._dot(r.data,o.data),this.getTypeInfo("f32")):(console.error(`Dot() expects vector arguments. Line ${e.line}`),null)}Dot4U8Packed(e,t){return console.error(`TODO: dot4U8Packed. Line ${e.line}`),null}Dot4I8Packed(e,t){return console.error(`TODO: dot4I8Packed. Line ${e.line}`),null}Exp(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof ze)return new ze(r.data.map(p=>Math.exp(p)),r.typeInfo);const o=r;return new at(Math.exp(o.value),r.typeInfo)}Exp2(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof ze)return new ze(r.data.map(p=>Math.pow(2,p)),r.typeInfo);const o=r;return new at(Math.pow(2,o.value),r.typeInfo)}ExtractBits(e,t){const r=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t),p=this.exec.evalExpression(e.args[2],t);if(o.typeInfo.name!=="u32"&&o.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 offset argument. Line ${e.line}`),null;if(p.typeInfo.name!=="u32"&&p.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 count argument. Line ${e.line}`),null;const _=o.value,l=p.value;if(r instanceof ze)return new ze(r.data.map(D=>D>>_&(1<<l)-1),r.typeInfo);if(r.typeInfo.name!=="i32"&&r.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 argument. Line ${e.line}`),null;const M=r.value;return new at(M>>_&(1<<l)-1,this.getTypeInfo("i32"))}FaceForward(e,t){const r=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t),p=this.exec.evalExpression(e.args[2],t);if(r instanceof ze&&o instanceof ze&&p instanceof ze){const _=this._dot(o.data,p.data);return new ze(_<0?Array.from(r.data):r.data.map(l=>-l),r.typeInfo)}return console.error(`FaceForward() expects vector arguments. Line ${e.line}`),null}_firstLeadingBit(e){return e===0?-1:31-Math.clz32(e)}FirstLeadingBit(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof ze)return new ze(r.data.map(p=>this._firstLeadingBit(p)),r.typeInfo);const o=r;return new at(this._firstLeadingBit(o.value),r.typeInfo)}_firstTrailingBit(e){return e===0?-1:Math.log2(e&-e)}FirstTrailingBit(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof ze)return new ze(r.data.map(p=>this._firstTrailingBit(p)),r.typeInfo);const o=r;return new at(this._firstTrailingBit(o.value),r.typeInfo)}Floor(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof ze)return new ze(r.data.map(p=>Math.floor(p)),r.typeInfo);const o=r;return new at(Math.floor(o.value),r.typeInfo)}Fma(e,t){const r=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t),p=this.exec.evalExpression(e.args[2],t);if(r instanceof ze&&o instanceof ze&&p instanceof ze)return r.data.length!==o.data.length||r.data.length!==p.data.length?(console.error(`Fma() expects vectors of the same length. Line ${e.line}`),null):new ze(r.data.map((D,B)=>D*o.data[B]+p.data[B]),r.typeInfo);const _=r,l=o,M=p;return new at(_.value*l.value+M.value,_.typeInfo)}Fract(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof ze)return new ze(r.data.map(p=>p-Math.floor(p)),r.typeInfo);const o=r;return new at(o.value-Math.floor(o.value),r.typeInfo)}Frexp(e,t){return console.error(`TODO: frexp. Line ${e.line}`),null}InsertBits(e,t){const r=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t),p=this.exec.evalExpression(e.args[2],t),_=this.exec.evalExpression(e.args[3],t);if(p.typeInfo.name!=="u32"&&p.typeInfo.name!=="x32")return console.error(`InsertBits() expects an i32 offset argument. Line ${e.line}`),null;const l=p.value,M=(1<<_.value)-1<<l,D=~M;if(r instanceof ze&&o instanceof ze)return new ze(r.data.map(($,se)=>$&D|o.data[se]<<l&M),r.typeInfo);const B=r.value,j=o.value;return new at(B&D|j<<l&M,r.typeInfo)}InverseSqrt(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof ze)return new ze(r.data.map(p=>1/Math.sqrt(p)),r.typeInfo);const o=r;return new at(1/Math.sqrt(o.value),r.typeInfo)}Ldexp(e,t){return console.error(`TODO: ldexp. Line ${e.line}`),null}Length(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof ze){let p=0;return r.data.forEach(_=>{p+=_*_}),new at(Math.sqrt(p),this.getTypeInfo("f32"))}const o=r;return new at(Math.abs(o.value),r.typeInfo)}Log(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof ze)return new ze(r.data.map(p=>Math.log(p)),r.typeInfo);const o=r;return new at(Math.log(o.value),r.typeInfo)}Log2(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof ze)return new ze(r.data.map(p=>Math.log2(p)),r.typeInfo);const o=r;return new at(Math.log2(o.value),r.typeInfo)}Max(e,t){const r=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t);if(r instanceof ze&&o instanceof ze)return new ze(r.data.map((l,M)=>Math.max(l,o.data[M])),r.typeInfo);const p=r,_=o;return new at(Math.max(p.value,_.value),r.typeInfo)}Min(e,t){const r=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t);if(r instanceof ze&&o instanceof ze)return new ze(r.data.map((l,M)=>Math.min(l,o.data[M])),r.typeInfo);const p=r,_=o;return new at(Math.min(p.value,_.value),r.typeInfo)}Mix(e,t){const r=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t),p=this.exec.evalExpression(e.args[2],t);if(r instanceof ze&&o instanceof ze&&p instanceof ze)return new ze(r.data.map((M,D)=>r.data[D]*(1-p.data[D])+o.data[D]*p.data[D]),r.typeInfo);const _=o,l=p;return new at(r.value*(1-l.value)+_.value*l.value,r.typeInfo)}Modf(e,t){const r=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t);if(r instanceof ze&&o instanceof ze)return new ze(r.data.map((_,l)=>_%o.data[l]),r.typeInfo);const p=o;return new at(r.value%p.value,r.typeInfo)}Normalize(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof ze){const o=this.Length(e,t).value;return new ze(r.data.map(p=>p/o),r.typeInfo)}return console.error(`Normalize() expects a vector argument. Line ${e.line}`),null}Pow(e,t){const r=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t);if(r instanceof ze&&o instanceof ze)return new ze(r.data.map((l,M)=>Math.pow(l,o.data[M])),r.typeInfo);const p=r,_=o;return new at(Math.pow(p.value,_.value),r.typeInfo)}QuantizeToF16(e,t){const r=this.exec.evalExpression(e.args[0],t);return r instanceof ze?new ze(r.data.map(o=>o),r.typeInfo):new at(r.value,r.typeInfo)}Radians(e,t){const r=this.exec.evalExpression(e.args[0],t);return r instanceof ze?new ze(r.data.map(o=>o*Math.PI/180),r.typeInfo):new at(r.value*Math.PI/180,this.getTypeInfo("f32"))}Reflect(e,t){let r=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t);if(r instanceof ze&&o instanceof ze){const p=this._dot(r.data,o.data);return new ze(r.data.map((_,l)=>_-2*p*o.data[l]),r.typeInfo)}return console.error(`Reflect() expects vector arguments. Line ${e.line}`),null}Refract(e,t){let r=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t),p=this.exec.evalExpression(e.args[2],t);if(r instanceof ze&&o instanceof ze&&p instanceof at){const _=this._dot(o.data,r.data);return new ze(r.data.map((l,M)=>{const D=1-p.value*p.value*(1-_*_);if(D<0)return 0;const B=Math.sqrt(D);return p.value*l-(p.value*_+B)*o.data[M]}),r.typeInfo)}return console.error(`Refract() expects vector arguments and a scalar argument. Line ${e.line}`),null}ReverseBits(e,t){return console.error(`TODO: reverseBits. Line ${e.line}`),null}Round(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof ze)return new ze(r.data.map(p=>Math.round(p)),r.typeInfo);const o=r;return new at(Math.round(o.value),r.typeInfo)}Saturate(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof ze)return new ze(r.data.map(p=>Math.min(Math.max(p,0),1)),r.typeInfo);const o=r;return new at(Math.min(Math.max(o.value,0),1),r.typeInfo)}Sign(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof ze)return new ze(r.data.map(p=>Math.sign(p)),r.typeInfo);const o=r;return new at(Math.sign(o.value),r.typeInfo)}Sin(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof ze)return new ze(r.data.map(p=>Math.sin(p)),r.typeInfo);const o=r;return new at(Math.sin(o.value),r.typeInfo)}Sinh(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof ze)return new ze(r.data.map(p=>Math.sinh(p)),r.typeInfo);const o=r;return new at(Math.sinh(o.value),r.typeInfo)}_smoothstep(e,t,r){const o=Math.min(Math.max((r-e)/(t-e),0),1);return o*o*(3-2*o)}SmoothStep(e,t){const r=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t),p=this.exec.evalExpression(e.args[2],t);if(p instanceof ze&&r instanceof ze&&o instanceof ze)return new ze(p.data.map((D,B)=>this._smoothstep(r.data[B],o.data[B],D)),p.typeInfo);const _=r,l=o,M=p;return new at(this._smoothstep(_.value,l.value,M.value),p.typeInfo)}Sqrt(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof ze)return new ze(r.data.map(p=>Math.sqrt(p)),r.typeInfo);const o=r;return new at(Math.sqrt(o.value),r.typeInfo)}Step(e,t){const r=this.exec.evalExpression(e.args[0],t),o=this.exec.evalExpression(e.args[1],t);if(o instanceof ze&&r instanceof ze)return new ze(o.data.map((_,l)=>_<r.data[l]?0:1),o.typeInfo);const p=r;return new at(o.value<p.value?0:1,p.typeInfo)}Tan(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof ze)return new ze(r.data.map(p=>Math.tan(p)),r.typeInfo);const o=r;return new at(Math.tan(o.value),r.typeInfo)}Tanh(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof ze)return new ze(r.data.map(p=>Math.tanh(p)),r.typeInfo);const o=r;return new at(Math.tanh(o.value),r.typeInfo)}_getTransposeType(e){const t=e.getTypeName();return t==="mat2x2f"||t==="mat2x2h"?e:t==="mat2x3f"?this.getTypeInfo("mat3x2f"):t==="mat2x3h"?this.getTypeInfo("mat3x2h"):t==="mat2x4f"?this.getTypeInfo("mat4x2f"):t==="mat2x4h"?this.getTypeInfo("mat4x2h"):t==="mat3x2f"?this.getTypeInfo("mat2x3f"):t==="mat3x2h"?this.getTypeInfo("mat2x3h"):t==="mat3x3f"||t==="mat3x3h"?e:t==="mat3x4f"?this.getTypeInfo("mat4x3f"):t==="mat3x4h"?this.getTypeInfo("mat4x3h"):t==="mat4x2f"?this.getTypeInfo("mat2x4f"):t==="mat4x2h"?this.getTypeInfo("mat2x4h"):t==="mat4x3f"?this.getTypeInfo("mat3x4f"):t==="mat4x3h"?this.getTypeInfo("mat3x4h"):(t==="mat4x4f"||t==="mat4x4h"||console.error(`Invalid matrix type ${t}`),e)}Transpose(e,t){const r=this.exec.evalExpression(e.args[0],t);if(!(r instanceof cn))return console.error(`Transpose() expects a matrix argument. Line ${e.line}`),null;const o=this._getTransposeType(r.typeInfo);if(r.typeInfo.name==="mat2x2"||r.typeInfo.name==="mat2x2f"||r.typeInfo.name==="mat2x2h"){const p=r.data;return new cn([p[0],p[2],p[1],p[3]],o)}if(r.typeInfo.name==="mat2x3"||r.typeInfo.name==="mat2x3f"||r.typeInfo.name==="mat2x3h"){const p=r.data;return new cn([p[0],p[3],p[6],p[1],p[4],p[7]],o)}if(r.typeInfo.name==="mat2x4"||r.typeInfo.name==="mat2x4f"||r.typeInfo.name==="mat2x4h"){const p=r.data;return new cn([p[0],p[4],p[8],p[12],p[1],p[5],p[9],p[13]],o)}if(r.typeInfo.name==="mat3x2"||r.typeInfo.name==="mat3x2f"||r.typeInfo.name==="mat3x2h"){const p=r.data;return new cn([p[0],p[3],p[1],p[4],p[2],p[5]],o)}if(r.typeInfo.name==="mat3x3"||r.typeInfo.name==="mat3x3f"||r.typeInfo.name==="mat3x3h"){const p=r.data;return new cn([p[0],p[3],p[6],p[1],p[4],p[7],p[2],p[5],p[8]],o)}if(r.typeInfo.name==="mat3x4"||r.typeInfo.name==="mat3x4f"||r.typeInfo.name==="mat3x4h"){const p=r.data;return new cn([p[0],p[4],p[8],p[12],p[1],p[5],p[9],p[13],p[2],p[6],p[10],p[14]],o)}if(r.typeInfo.name==="mat4x2"||r.typeInfo.name==="mat4x2f"||r.typeInfo.name==="mat4x2h"){const p=r.data;return new cn([p[0],p[4],p[1],p[5],p[2],p[6]],o)}if(r.typeInfo.name==="mat4x3"||r.typeInfo.name==="mat4x3f"||r.typeInfo.name==="mat4x3h"){const p=r.data;return new cn([p[0],p[4],p[8],p[1],p[5],p[9],p[2],p[6],p[10]],o)}if(r.typeInfo.name==="mat4x4"||r.typeInfo.name==="mat4x4f"||r.typeInfo.name==="mat4x4h"){const p=r.data;return new cn([p[0],p[4],p[8],p[12],p[1],p[5],p[9],p[13],p[2],p[6],p[10],p[14],p[3],p[7],p[11],p[15]],o)}return console.error(`Invalid matrix type ${r.typeInfo.name}`),null}Trunc(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof ze)return new ze(r.data.map(p=>Math.trunc(p)),r.typeInfo);const o=r;return new at(Math.trunc(o.value),r.typeInfo)}Dpdx(e,t){return console.error(`TODO: dpdx. Line ${e.line}`),null}DpdxCoarse(e,t){return console.error(`TODO: dpdxCoarse. Line ${e.line}`),null}DpdxFine(e,t){return console.error("TODO: dpdxFine"),null}Dpdy(e,t){return console.error("TODO: dpdy"),null}DpdyCoarse(e,t){return console.error("TODO: dpdyCoarse"),null}DpdyFine(e,t){return console.error("TODO: dpdyFine"),null}Fwidth(e,t){return console.error("TODO: fwidth"),null}FwidthCoarse(e,t){return console.error("TODO: fwidthCoarse"),null}FwidthFine(e,t){return console.error("TODO: fwidthFine"),null}TextureDimensions(e,t){const r=e.args[0],o=e.args.length>1?this.exec.evalExpression(e.args[1],t).value:0;if(r instanceof oh){const p=r.name,_=t.getVariableValue(p);if(_ instanceof Rp){if(o<0||o>=_.mipLevelCount)return console.error(`Invalid mip level for textureDimensions. Line ${e.line}`),null;const l=_.getMipLevelSize(o),M=_.dimension;return M==="1d"?new at(l[0],this.getTypeInfo("u32")):M==="3d"?new ze(l,this.getTypeInfo("vec3u")):M==="2d"?new ze(l.slice(0,2),this.getTypeInfo("vec2u")):(console.error(`Invalid texture dimension ${M} not found. Line ${e.line}`),null)}return console.error(`Texture ${p} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureDimensions. Line ${e.line}`),null}TextureGather(e,t){return console.error("TODO: textureGather"),null}TextureGatherCompare(e,t){return console.error("TODO: textureGatherCompare"),null}TextureLoad(e,t){const r=e.args[0],o=this.exec.evalExpression(e.args[1],t),p=e.args.length>2?this.exec.evalExpression(e.args[2],t).value:0;if(!(o instanceof ze)||o.data.length!==2)return console.error(`Invalid UV argument for textureLoad. Line ${e.line}`),null;if(r instanceof oh){const _=r.name,l=t.getVariableValue(_);if(l instanceof Rp){const M=Math.floor(o.data[0]),D=Math.floor(o.data[1]);if(M<0||M>=l.width||D<0||D>=l.height)return console.error(`Texture ${_} out of bounds. Line ${e.line}`),null;const B=l.getPixel(M,D,0,p);return B===null?(console.error(`Invalid texture format for textureLoad. Line ${e.line}`),null):new ze(B,this.getTypeInfo("vec4f"))}return console.error(`Texture ${_} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureLoad. Line ${e.line}`),null}TextureNumLayers(e,t){const r=e.args[0];if(r instanceof oh){const o=r.name,p=t.getVariableValue(o);return p instanceof Rp?new at(p.depthOrArrayLayers,this.getTypeInfo("u32")):(console.error(`Texture ${o} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLayers. Line ${e.line}`),null}TextureNumLevels(e,t){const r=e.args[0];if(r instanceof oh){const o=r.name,p=t.getVariableValue(o);return p instanceof Rp?new at(p.mipLevelCount,this.getTypeInfo("u32")):(console.error(`Texture ${o} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLevels. Line ${e.line}`),null}TextureNumSamples(e,t){const r=e.args[0];if(r instanceof oh){const o=r.name,p=t.getVariableValue(o);return p instanceof Rp?new at(p.sampleCount,this.getTypeInfo("u32")):(console.error(`Texture ${o} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumSamples. Line ${e.line}`),null}TextureSample(e,t){return console.error("TODO: textureSample"),null}TextureSampleBias(e,t){return console.error("TODO: textureSampleBias"),null}TextureSampleCompare(e,t){return console.error("TODO: textureSampleCompare"),null}TextureSampleCompareLevel(e,t){return console.error("TODO: textureSampleCompareLevel"),null}TextureSampleGrad(e,t){return console.error("TODO: textureSampleGrad"),null}TextureSampleLevel(e,t){return console.error("TODO: textureSampleLevel"),null}TextureSampleBaseClampToEdge(e,t){return console.error("TODO: textureSampleBaseClampToEdge"),null}TextureStore(e,t){const r=e.args[0],o=this.exec.evalExpression(e.args[1],t),p=e.args.length===4?this.exec.evalExpression(e.args[2],t).value:0,_=e.args.length===4?this.exec.evalExpression(e.args[3],t).data:this.exec.evalExpression(e.args[2],t).data;if(_.length!==4)return console.error(`Invalid value argument for textureStore. Line ${e.line}`),null;if(!(o instanceof ze)||o.data.length!==2)return console.error(`Invalid UV argument for textureStore. Line ${e.line}`),null;if(r instanceof oh){const l=r.name,M=t.getVariableValue(l);if(M instanceof Rp){const D=M.getMipLevelSize(0),B=Math.floor(o.data[0]),j=Math.floor(o.data[1]);return B<0||B>=D[0]||j<0||j>=D[1]?(console.error(`Texture ${l} out of bounds. Line ${e.line}`),null):(M.setPixel(B,j,0,p,Array.from(_)),null)}return console.error(`Texture ${l} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureStore. Line ${e.line}`),null}AtomicLoad(e,t){let r=e.args[0];r instanceof io&&(r=r.right);const o=this.exec.getVariableName(r,t);return t.getVariable(o).value.getSubData(this.exec,r.postfix,t)}AtomicStore(e,t){let r=e.args[0];r instanceof io&&(r=r.right);const o=this.exec.getVariableName(r,t),p=t.getVariable(o);let _=e.args[1];const l=this.exec.evalExpression(_,t),M=p.value.getSubData(this.exec,r.postfix,t);return M instanceof at&&l instanceof at&&(M.value=l.value),p.value instanceof va&&p.value.setDataValue(this.exec,M,r.postfix,t),null}AtomicAdd(e,t){let r=e.args[0];r instanceof io&&(r=r.right);const o=this.exec.getVariableName(r,t),p=t.getVariable(o);let _=e.args[1];const l=this.exec.evalExpression(_,t),M=p.value.getSubData(this.exec,r.postfix,t),D=new at(M.value,M.typeInfo);return M instanceof at&&l instanceof at&&(M.value+=l.value),p.value instanceof va&&p.value.setDataValue(this.exec,M,r.postfix,t),D}AtomicSub(e,t){let r=e.args[0];r instanceof io&&(r=r.right);const o=this.exec.getVariableName(r,t),p=t.getVariable(o);let _=e.args[1];const l=this.exec.evalExpression(_,t),M=p.value.getSubData(this.exec,r.postfix,t),D=new at(M.value,M.typeInfo);return M instanceof at&&l instanceof at&&(M.value-=l.value),p.value instanceof va&&p.value.setDataValue(this.exec,M,r.postfix,t),D}AtomicMax(e,t){let r=e.args[0];r instanceof io&&(r=r.right);const o=this.exec.getVariableName(r,t),p=t.getVariable(o);let _=e.args[1];const l=this.exec.evalExpression(_,t),M=p.value.getSubData(this.exec,r.postfix,t),D=new at(M.value,M.typeInfo);return M instanceof at&&l instanceof at&&(M.value=Math.max(M.value,l.value)),p.value instanceof va&&p.value.setDataValue(this.exec,M,r.postfix,t),D}AtomicMin(e,t){let r=e.args[0];r instanceof io&&(r=r.right);const o=this.exec.getVariableName(r,t),p=t.getVariable(o);let _=e.args[1];const l=this.exec.evalExpression(_,t),M=p.value.getSubData(this.exec,r.postfix,t),D=new at(M.value,M.typeInfo);return M instanceof at&&l instanceof at&&(M.value=Math.min(M.value,l.value)),p.value instanceof va&&p.value.setDataValue(this.exec,M,r.postfix,t),D}AtomicAnd(e,t){let r=e.args[0];r instanceof io&&(r=r.right);const o=this.exec.getVariableName(r,t),p=t.getVariable(o);let _=e.args[1];const l=this.exec.evalExpression(_,t),M=p.value.getSubData(this.exec,r.postfix,t),D=new at(M.value,M.typeInfo);return M instanceof at&&l instanceof at&&(M.value=M.value&l.value),p.value instanceof va&&p.value.setDataValue(this.exec,M,r.postfix,t),D}AtomicOr(e,t){let r=e.args[0];r instanceof io&&(r=r.right);const o=this.exec.getVariableName(r,t),p=t.getVariable(o);let _=e.args[1];const l=this.exec.evalExpression(_,t),M=p.value.getSubData(this.exec,r.postfix,t),D=new at(M.value,M.typeInfo);return M instanceof at&&l instanceof at&&(M.value=M.value|l.value),p.value instanceof va&&p.value.setDataValue(this.exec,M,r.postfix,t),D}AtomicXor(e,t){let r=e.args[0];r instanceof io&&(r=r.right);const o=this.exec.getVariableName(r,t),p=t.getVariable(o);let _=e.args[1];const l=this.exec.evalExpression(_,t),M=p.value.getSubData(this.exec,r.postfix,t),D=new at(M.value,M.typeInfo);return M instanceof at&&l instanceof at&&(M.value=M.value^l.value),p.value instanceof va&&p.value.setDataValue(this.exec,M,r.postfix,t),D}AtomicExchange(e,t){let r=e.args[0];r instanceof io&&(r=r.right);const o=this.exec.getVariableName(r,t),p=t.getVariable(o);let _=e.args[1];const l=this.exec.evalExpression(_,t),M=p.value.getSubData(this.exec,r.postfix,t),D=new at(M.value,M.typeInfo);return M instanceof at&&l instanceof at&&(M.value=l.value),p.value instanceof va&&p.value.setDataValue(this.exec,M,r.postfix,t),D}AtomicCompareExchangeWeak(e,t){return console.error("TODO: atomicCompareExchangeWeak"),null}Pack4x8snorm(e,t){return console.error("TODO: pack4x8snorm"),null}Pack4x8unorm(e,t){return console.error("TODO: pack4x8unorm"),null}Pack4xI8(e,t){return console.error("TODO: pack4xI8"),null}Pack4xU8(e,t){return console.error("TODO: pack4xU8"),null}Pack4x8Clamp(e,t){return console.error("TODO: pack4x8Clamp"),null}Pack4xU8Clamp(e,t){return console.error("TODO: pack4xU8Clamp"),null}Pack2x16snorm(e,t){return console.error("TODO: pack2x16snorm"),null}Pack2x16unorm(e,t){return console.error("TODO: pack2x16unorm"),null}Pack2x16float(e,t){return console.error("TODO: pack2x16float"),null}Unpack4x8snorm(e,t){return console.error("TODO: unpack4x8snorm"),null}Unpack4x8unorm(e,t){return console.error("TODO: unpack4x8unorm"),null}Unpack4xI8(e,t){return console.error("TODO: unpack4xI8"),null}Unpack4xU8(e,t){return console.error("TODO: unpack4xU8"),null}Unpack2x16snorm(e,t){return console.error("TODO: unpack2x16snorm"),null}Unpack2x16unorm(e,t){return console.error("TODO: unpack2x16unorm"),null}Unpack2x16float(e,t){return console.error("TODO: unpack2x16float"),null}StorageBarrier(e,t){return null}TextureBarrier(e,t){return null}WorkgroupBarrier(e,t){return null}WorkgroupUniformLoad(e,t){return null}SubgroupAdd(e,t){return console.error("TODO: subgroupAdd"),null}SubgroupExclusiveAdd(e,t){return console.error("TODO: subgroupExclusiveAdd"),null}SubgroupInclusiveAdd(e,t){return console.error("TODO: subgroupInclusiveAdd"),null}SubgroupAll(e,t){return console.error("TODO: subgroupAll"),null}SubgroupAnd(e,t){return console.error("TODO: subgroupAnd"),null}SubgroupAny(e,t){return console.error("TODO: subgroupAny"),null}SubgroupBallot(e,t){return console.error("TODO: subgroupBallot"),null}SubgroupBroadcast(e,t){return console.error("TODO: subgroupBroadcast"),null}SubgroupBroadcastFirst(e,t){return console.error("TODO: subgroupBroadcastFirst"),null}SubgroupElect(e,t){return console.error("TODO: subgroupElect"),null}SubgroupMax(e,t){return console.error("TODO: subgroupMax"),null}SubgroupMin(e,t){return console.error("TODO: subgroupMin"),null}SubgroupMul(e,t){return console.error("TODO: subgroupMul"),null}SubgroupExclusiveMul(e,t){return console.error("TODO: subgroupExclusiveMul"),null}SubgroupInclusiveMul(e,t){return console.error("TODO: subgroupInclusiveMul"),null}SubgroupOr(e,t){return console.error("TODO: subgroupOr"),null}SubgroupShuffle(e,t){return console.error("TODO: subgroupShuffle"),null}SubgroupShuffleDown(e,t){return console.error("TODO: subgroupShuffleDown"),null}SubgroupShuffleUp(e,t){return console.error("TODO: subgroupShuffleUp"),null}SubgroupShuffleXor(e,t){return console.error("TODO: subgroupShuffleXor"),null}SubgroupXor(e,t){return console.error("TODO: subgroupXor"),null}QuadBroadcast(e,t){return console.error("TODO: quadBroadcast"),null}QuadSwapDiagonal(e,t){return console.error("TODO: quadSwapDiagonal"),null}QuadSwapX(e,t){return console.error("TODO: quadSwapX"),null}QuadSwapY(e,t){return console.error("TODO: quadSwapY"),null}}const Fb={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4},kc={mat2x2:[2,2,4],mat2x2f:[2,2,4],mat2x2h:[2,2,4],mat2x3:[2,3,6],mat2x3f:[2,3,6],mat2x3h:[2,3,6],mat2x4:[2,4,8],mat2x4f:[2,4,8],mat2x4h:[2,4,8],mat3x2:[3,2,6],mat3x2f:[3,2,6],mat3x2h:[3,2,6],mat3x3:[3,3,9],mat3x3f:[3,3,9],mat3x3h:[3,3,9],mat3x4:[3,4,12],mat3x4f:[3,4,12],mat3x4h:[3,4,12],mat4x2:[4,2,8],mat4x2f:[4,2,8],mat4x2h:[4,2,8],mat4x3:[4,3,12],mat4x3f:[4,3,12],mat4x3h:[4,3,12],mat4x4:[4,4,16],mat4x4f:[4,4,16],mat4x4h:[4,4,16]};class ec extends fL{constructor(e,t){var r;super(),this.ast=e??[],this.reflection=new s0,this.reflection.updateAST(this.ast),this.context=(r=t==null?void 0:t.clone())!==null&&r!==void 0?r:new Bw,this.builtins=new dL(this),this.typeInfo={bool:this.getTypeInfo(Kt.bool),i32:this.getTypeInfo(Kt.i32),u32:this.getTypeInfo(Kt.u32),f32:this.getTypeInfo(Kt.f32),f16:this.getTypeInfo(Kt.f16),vec2f:this.getTypeInfo(gt.vec2f),vec2u:this.getTypeInfo(gt.vec2u),vec2i:this.getTypeInfo(gt.vec2i),vec2h:this.getTypeInfo(gt.vec2h),vec3f:this.getTypeInfo(gt.vec3f),vec3u:this.getTypeInfo(gt.vec3u),vec3i:this.getTypeInfo(gt.vec3i),vec3h:this.getTypeInfo(gt.vec3h),vec4f:this.getTypeInfo(gt.vec4f),vec4u:this.getTypeInfo(gt.vec4u),vec4i:this.getTypeInfo(gt.vec4i),vec4h:this.getTypeInfo(gt.vec4h),mat2x2f:this.getTypeInfo(gt.mat2x2f),mat2x3f:this.getTypeInfo(gt.mat2x3f),mat2x4f:this.getTypeInfo(gt.mat2x4f),mat3x2f:this.getTypeInfo(gt.mat3x2f),mat3x3f:this.getTypeInfo(gt.mat3x3f),mat3x4f:this.getTypeInfo(gt.mat3x4f),mat4x2f:this.getTypeInfo(gt.mat4x2f),mat4x3f:this.getTypeInfo(gt.mat4x3f),mat4x4f:this.getTypeInfo(gt.mat4x4f)}}getVariableValue(e){var t,r;const o=(r=(t=this.context.getVariable(e))===null||t===void 0?void 0:t.value)!==null&&r!==void 0?r:null;if(o===null)return null;if(o instanceof at)return o.value;if(o instanceof ze||o instanceof cn)return Array.from(o.data);if(o instanceof va&&o.typeInfo instanceof Hg){if(o.typeInfo.format.name==="u32")return Array.from(new Uint32Array(o.buffer,o.offset,o.typeInfo.count));if(o.typeInfo.format.name==="i32")return Array.from(new Int32Array(o.buffer,o.offset,o.typeInfo.count));if(o.typeInfo.format.name==="f32")return Array.from(new Float32Array(o.buffer,o.offset,o.typeInfo.count))}return console.error(`Unsupported return variable type ${o.typeInfo.name}`),null}execute(e){(e=e??{}).constants&&this._setOverrides(e.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(e,t,r,o){const p=this.context.clone();(o=o??{}).constants&&this._setOverrides(o.constants,p),this._execStatements(this.ast,p);const _=p.getFunction(e);if(!_)return void console.error(`Function ${e} not found`);if(typeof t=="number")t=[t,1,1];else{if(t.length===0)return void console.error("Invalid dispatch count");t.length===1?t=[t[0],1,1]:t.length===2?t=[t[0],t[1],1]:t.length>3&&(t=[t[0],t[1],t[2]])}const l=t[0],M=t[1],D=t[2],B=this.getTypeInfo("vec3u");p.setVariable("@num_workgroups",new ze(t,B));const j=this.reflection.getFunctionInfo(e);j===null&&console.error(`Function ${e} not found in reflection data`);for(const $ in r)for(const se in r[$]){const de=r[$][se];p.variables.forEach(Ae=>{var he;const Le=Ae.node;if(Le!=null&&Le.attributes){let $e=null,Be=null;for(const Je of Le.attributes)Je.name==="binding"?$e=Je.value:Je.name==="group"&&(Be=Je.value);if(se==$e&&$==Be){let Je=!1;for(const Rt of j.resources)if(Rt.name===Ae.name&&Rt.group===parseInt($)&&Rt.binding===parseInt(se)){Je=!0;break}if(Je)if(de.texture!==void 0&&de.descriptor!==void 0){const Rt=new Rp(de.texture,this.getTypeInfo(Le.type),de.descriptor,(he=de.texture.view)!==null&&he!==void 0?he:null);Ae.value=Rt}else de.uniform!==void 0?Ae.value=new va(de.uniform,this.getTypeInfo(Le.type)):Ae.value=new va(de,this.getTypeInfo(Le.type))}}})}for(let $=0;$<D;++$)for(let se=0;se<M;++se)for(let de=0;de<l;++de)p.setVariable("@workgroup_id",new ze([de,se,$],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(_,[de,se,$],p)}execStatement(e,t){if(e instanceof cM)return this.evalExpression(e.value,t);if(e instanceof hM){if(e.condition){const r=this.evalExpression(e.condition,t);if(!(r instanceof at))throw new Error("Invalid break-if condition");if(!r.value)return null}return ec._breakObj}if(e instanceof fM)return ec._continueObj;if(e instanceof e1)this._let(e,t);else if(e instanceof Cp)this._var(e,t);else if(e instanceof Ev)this._const(e,t);else if(e instanceof p1)this._function(e,t);else{if(e instanceof lM)return this._if(e,t);if(e instanceof oM)return this._switch(e,t);if(e instanceof nM)return this._for(e,t);if(e instanceof iM)return this._while(e,t);if(e instanceof aM)return this._loop(e,t);if(e instanceof IA){const r=t.clone();return r.currentFunctionName=t.currentFunctionName,this._execStatements(e.body,r)}if(e instanceof sM)this._assign(e,t);else if(e instanceof rM)this._increment(e,t);else{if(e instanceof Mp)return null;if(e instanceof Pw){const r=e.name;t.getVariable(r)===null&&t.setVariable(r,new at(0,this.getTypeInfo("u32")))}else if(e instanceof Iw)this._call(e,t);else{if(e instanceof uM||e instanceof kw)return null;console.error("Invalid statement type.",e,`Line ${e.line}`)}}}return null}evalExpression(e,t){return e instanceof qf?this._evalBinaryOp(e,t):e instanceof Mo?this._evalLiteral(e,t):e instanceof oh?this._evalVariable(e,t):e instanceof Dw?this._evalCall(e,t):e instanceof n0?this._evalCreate(e,t):e instanceof dM?this._evalConst(e,t):e instanceof pM?this._evalBitcast(e,t):e instanceof io?this._evalUnaryOp(e,t):(console.error("Invalid expression type",e,`Line ${e.line}`),null)}getTypeInfo(e){var t;if(e instanceof Kt){const o=this.reflection.getTypeInfo(e);if(o!==null)return o}let r=(t=this.typeInfo[e])!==null&&t!==void 0?t:null;return r!==null||(r=this.reflection.getTypeInfoByName(e)),r}_setOverrides(e,t){for(const r in e){const o=e[r],p=this.reflection.getOverrideInfo(r);p!==null?(p.type===null&&(p.type=this.getTypeInfo("u32")),p.type.name==="u32"||p.type.name==="i32"||p.type.name==="f32"||p.type.name==="f16"?t.setVariable(r,new at(o,p.type)):p.type.name==="bool"?t.setVariable(r,new at(o?1:0,p.type)):p.type.name==="vec2"||p.type.name==="vec3"||p.type.name==="vec4"||p.type.name==="vec2f"||p.type.name==="vec3f"||p.type.name==="vec4f"||p.type.name==="vec2i"||p.type.name==="vec3i"||p.type.name==="vec4i"||p.type.name==="vec2u"||p.type.name==="vec3u"||p.type.name==="vec4u"||p.type.name==="vec2h"||p.type.name==="vec3h"||p.type.name==="vec4h"?t.setVariable(r,new ze(o,p.type)):console.error(`Invalid constant type for ${r}`)):console.error(`Override ${r} does not exist in the shader.`)}}_dispatchWorkgroup(e,t,r){const o=[1,1,1];for(const B of e.node.attributes)if(B.name==="workgroup_size"){if(B.value.length>0){const j=r.getVariableValue(B.value[0]);o[0]=j instanceof at?j.value:parseInt(B.value[0])}if(B.value.length>1){const j=r.getVariableValue(B.value[1]);o[1]=j instanceof at?j.value:parseInt(B.value[1])}if(B.value.length>2){const j=r.getVariableValue(B.value[2]);o[2]=j instanceof at?j.value:parseInt(B.value[2])}}const p=this.getTypeInfo("vec3u"),_=this.getTypeInfo("u32");r.setVariable("@workgroup_size",new ze(o,p));const l=o[0],M=o[1],D=o[2];for(let B=0,j=0;B<D;++B)for(let $=0;$<M;++$)for(let se=0;se<l;++se,++j){const de=[se,$,B],Ae=[se+t[0]*o[0],$+t[1]*o[1],B+t[2]*o[2]];r.setVariable("@local_invocation_id",new ze(de,p)),r.setVariable("@global_invocation_id",new ze(Ae,p)),r.setVariable("@local_invocation_index",new at(j,_)),this._dispatchExec(e,r)}}_dispatchExec(e,t){for(const r of e.node.args)for(const o of r.attributes)if(o.name==="builtin"){const p=`@${o.value}`,_=t.getVariable(p);_!==void 0&&t.variables.set(r.name,_)}this._execStatements(e.node.body,t)}getVariableName(e,t){for(;e instanceof io;)e=e.right;return e instanceof oh?e.name:(console.error("Unknown variable type",e,"Line",e.line),null)}_execStatements(e,t){for(const r of e){if(r instanceof Array){const p=t.clone(),_=this._execStatements(r,p);if(_)return _;continue}const o=this.execStatement(r,t);if(o)return o}return null}_call(e,t){const r=t.clone();r.currentFunctionName=e.name;const o=t.getFunction(e.name);if(o){for(let p=0;p<o.node.args.length;++p){const _=o.node.args[p],l=this.evalExpression(e.args[p],r);r.setVariable(_.name,l,_)}this._execStatements(o.node.body,r)}else e.isBuiltin?this._callBuiltinFunction(e,r):this.getTypeInfo(e.name)&&this._evalCreate(e,t)}_increment(e,t){const r=this.getVariableName(e.variable,t),o=t.getVariable(r);o?e.operator==="++"?o.value instanceof at?o.value.value++:console.error(`Variable ${r} is not a scalar. Line ${e.line}`):e.operator==="--"?o.value instanceof at?o.value.value--:console.error(`Variable ${r} is not a scalar. Line ${e.line}`):console.error(`Unknown increment operator ${e.operator}. Line ${e.line}`):console.error(`Variable ${r} not found. Line ${e.line}`)}_getVariableData(e,t){if(e instanceof oh){const r=this.getVariableName(e,t),o=t.getVariable(r);return o===null?(console.error(`Variable ${r} not found. Line ${e.line}`),null):o.value.getSubData(this,e.postfix,t)}if(e instanceof io){if(e.operator==="*"){const r=this._getVariableData(e.right,t);return r instanceof Ry?r.reference.getSubData(this,e.postfix,t):(console.error(`Variable ${e.right} is not a pointer. Line ${e.line}`),null)}if(e.operator==="&"){const r=this._getVariableData(e.right,t);return new Ry(r)}}return null}_assign(e,t){let r=null,o="<var>",p=null;if(e.variable instanceof io){const M=this._getVariableData(e.variable,t),D=this.evalExpression(e.value,t),B=e.operator;if(B==="="){if(M instanceof at||M instanceof ze||M instanceof cn){if(D instanceof at||D instanceof ze||D instanceof cn&&M.data.length===D.data.length)return void M.data.set(D.data);console.error(`Invalid assignment. Line ${e.line}`)}else if(M instanceof va&&D instanceof va&&M.buffer.byteLength-M.offset>=D.buffer.byteLength-D.offset)return void(M.buffer.byteLength%4==0?new Uint32Array(M.buffer,M.offset,M.typeInfo.size/4).set(new Uint32Array(D.buffer,D.offset,D.typeInfo.size/4)):new Uint8Array(M.buffer,M.offset,M.typeInfo.size).set(new Uint8Array(D.buffer,D.offset,D.typeInfo.size)));return console.error(`Invalid assignment. Line ${e.line}`),null}if(B==="+=")return M instanceof at||M instanceof ze||M instanceof cn?D instanceof at||D instanceof ze||D instanceof cn?void M.data.set(D.data.map((j,$)=>M.data[$]+j)):void console.error(`Invalid assignment . Line ${e.line}`):void console.error(`Invalid assignment. Line ${e.line}`);if(B==="-=")return(M instanceof at||M instanceof ze||M instanceof cn)&&(D instanceof at||D instanceof ze||D instanceof cn)?void M.data.set(D.data.map((j,$)=>M.data[$]-j)):void console.error(`Invalid assignment. Line ${e.line}`)}if(e.variable instanceof io){if(e.variable.operator==="*"){o=this.getVariableName(e.variable.right,t);const M=t.getVariable(o);if(!(M&&M.value instanceof Ry))return void console.error(`Variable ${o} is not a pointer. Line ${e.line}`);r=M.value.reference;let D=e.variable.postfix;if(!D){let B=e.variable.right;for(;B instanceof io;){if(B.postfix){D=B.postfix;break}B=B.right}}D&&(r=r.getSubData(this,D,t))}}else{p=e.variable.postfix,o=this.getVariableName(e.variable,t);const M=t.getVariable(o);if(M===null)return void console.error(`Variable ${o} not found. Line ${e.line}`);r=M.value}if(r instanceof Ry&&(r=r.reference),r===null)return void console.error(`Variable ${o} not found. Line ${e.line}`);const _=this.evalExpression(e.value,t),l=e.operator;if(l!=="="){const M=r.getSubData(this,p,t);if(M instanceof ze&&_ instanceof at){const D=M.data,B=_.value;if(l==="+=")for(let j=0;j<D.length;++j)D[j]+=B;else if(l==="-=")for(let j=0;j<D.length;++j)D[j]-=B;else if(l==="*=")for(let j=0;j<D.length;++j)D[j]*=B;else if(l==="/=")for(let j=0;j<D.length;++j)D[j]/=B;else if(l==="%=")for(let j=0;j<D.length;++j)D[j]%=B;else if(l==="&=")for(let j=0;j<D.length;++j)D[j]&=B;else if(l==="|=")for(let j=0;j<D.length;++j)D[j]|=B;else if(l==="^=")for(let j=0;j<D.length;++j)D[j]^=B;else if(l==="<<=")for(let j=0;j<D.length;++j)D[j]<<=B;else if(l===">>=")for(let j=0;j<D.length;++j)D[j]>>=B;else console.error(`Invalid operator ${l}. Line ${e.line}`)}else if(M instanceof ze&&_ instanceof ze){const D=M.data,B=_.data;if(D.length!==B.length)return void console.error(`Vector length mismatch. Line ${e.line}`);if(l==="+=")for(let j=0;j<D.length;++j)D[j]+=B[j];else if(l==="-=")for(let j=0;j<D.length;++j)D[j]-=B[j];else if(l==="*=")for(let j=0;j<D.length;++j)D[j]*=B[j];else if(l==="/=")for(let j=0;j<D.length;++j)D[j]/=B[j];else if(l==="%=")for(let j=0;j<D.length;++j)D[j]%=B[j];else if(l==="&=")for(let j=0;j<D.length;++j)D[j]&=B[j];else if(l==="|=")for(let j=0;j<D.length;++j)D[j]|=B[j];else if(l==="^=")for(let j=0;j<D.length;++j)D[j]^=B[j];else if(l==="<<=")for(let j=0;j<D.length;++j)D[j]<<=B[j];else if(l===">>=")for(let j=0;j<D.length;++j)D[j]>>=B[j];else console.error(`Invalid operator ${l}. Line ${e.line}`)}else{if(!(M instanceof at&&_ instanceof at))return void console.error(`Invalid type for ${e.operator} operator. Line ${e.line}`);l==="+="?M.value+=_.value:l==="-="?M.value-=_.value:l==="*="?M.value*=_.value:l==="/="?M.value/=_.value:l==="%="?M.value%=_.value:l==="&="?M.value&=_.value:l==="|="?M.value|=_.value:l==="^="?M.value^=_.value:l==="<<="?M.value<<=_.value:l===">>="?M.value>>=_.value:console.error(`Invalid operator ${l}. Line ${e.line}`)}return void(r instanceof va&&r.setDataValue(this,M,p,t))}if(r instanceof va)r.setDataValue(this,_,p,t);else if(p){if(!(r instanceof ze||r instanceof cn))return void console.error(`Variable ${o} is not a vector or matrix. Line ${e.line}`);if(p instanceof Jy){const M=this.evalExpression(p.index,t).value;if(r instanceof ze){if(!(_ instanceof at))return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);r.data[M]=_.value}else{if(!(r instanceof cn))return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);{const D=this.evalExpression(p.index,t).value;if(D<0)return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);if(!(_ instanceof ze))return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);{const B=r.typeInfo.getTypeName();if(B==="mat2x2"||B==="mat2x2f"||B==="mat2x2h"){if(!(D<2&&_.data.length===2))return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);r.data[2*D]=_.data[0],r.data[2*D+1]=_.data[1]}else if(B==="mat2x3"||B==="mat2x3f"||B==="mat2x3h"){if(!(D<2&&_.data.length===3))return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);r.data[3*D]=_.data[0],r.data[3*D+1]=_.data[1],r.data[3*D+2]=_.data[2]}else if(B==="mat2x4"||B==="mat2x4f"||B==="mat2x4h"){if(!(D<2&&_.data.length===4))return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);r.data[4*D]=_.data[0],r.data[4*D+1]=_.data[1],r.data[4*D+2]=_.data[2],r.data[4*D+3]=_.data[3]}else if(B==="mat3x2"||B==="mat3x2f"||B==="mat3x2h"){if(!(D<3&&_.data.length===2))return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);r.data[2*D]=_.data[0],r.data[2*D+1]=_.data[1]}else if(B==="mat3x3"||B==="mat3x3f"||B==="mat3x3h"){if(!(D<3&&_.data.length===3))return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);r.data[3*D]=_.data[0],r.data[3*D+1]=_.data[1],r.data[3*D+2]=_.data[2]}else if(B==="mat3x4"||B==="mat3x4f"||B==="mat3x4h"){if(!(D<3&&_.data.length===4))return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);r.data[4*D]=_.data[0],r.data[4*D+1]=_.data[1],r.data[4*D+2]=_.data[2],r.data[4*D+3]=_.data[3]}else if(B==="mat4x2"||B==="mat4x2f"||B==="mat4x2h"){if(!(D<4&&_.data.length===2))return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);r.data[2*D]=_.data[0],r.data[2*D+1]=_.data[1]}else if(B==="mat4x3"||B==="mat4x3f"||B==="mat4x3h"){if(!(D<4&&_.data.length===3))return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);r.data[3*D]=_.data[0],r.data[3*D+1]=_.data[1],r.data[3*D+2]=_.data[2]}else{if(B!=="mat4x4"&&B!=="mat4x4f"&&B!=="mat4x4h")return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);if(!(D<4&&_.data.length===4))return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);r.data[4*D]=_.data[0],r.data[4*D+1]=_.data[1],r.data[4*D+2]=_.data[2],r.data[4*D+3]=_.data[3]}}}}}else if(p instanceof E_){const M=p.value;if(!(r instanceof ze))return void console.error(`Invalid assignment to ${M}. Variable ${o} is not a vector. Line ${e.line}`);if(_ instanceof at){if(M.length>1)return void console.error(`Invalid assignment to ${M} for variable ${o}. Line ${e.line}`);if(M==="x")r.data[0]=_.value;else if(M==="y"){if(r.data.length<2)return void console.error(`Invalid assignment to ${M} for variable ${o}. Line ${e.line}`);r.data[1]=_.value}else if(M==="z"){if(r.data.length<3)return void console.error(`Invalid assignment to ${M} for variable ${o}. Line ${e.line}`);r.data[2]=_.value}else if(M==="w"){if(r.data.length<4)return void console.error(`Invalid assignment to ${M} for variable ${o}. Line ${e.line}`);r.data[3]=_.value}}else{if(!(_ instanceof ze))return void console.error(`Invalid assignment to ${o}. Line ${e.line}`);if(M.length!==_.data.length)return void console.error(`Invalid assignment to ${M} for variable ${o}. Line ${e.line}`);for(let D=0;D<M.length;++D){const B=M[D];if(B==="x"||B==="r")r.data[0]=_.data[D];else if(B==="y"||B==="g"){if(_.data.length<2)return void console.error(`Invalid assignment to ${B} for variable ${o}. Line ${e.line}`);r.data[1]=_.data[D]}else if(B==="z"||B==="b"){if(_.data.length<3)return void console.error(`Invalid assignment to ${B} for variable ${o}. Line ${e.line}`);r.data[2]=_.data[D]}else{if(B!=="w"&&B!=="a")return void console.error(`Invalid assignment to ${B} for variable ${o}. Line ${e.line}`);if(_.data.length<4)return void console.error(`Invalid assignment to ${B} for variable ${o}. Line ${e.line}`);r.data[3]=_.data[D]}}}}}else r instanceof at&&_ instanceof at?r.value=_.value:r instanceof ze&&_ instanceof ze||r instanceof cn&&_ instanceof cn?r.data.set(_.data):console.error(`Invalid assignment to ${o}. Line ${e.line}`)}_function(e,t){const r=new Nw(e);t.functions.set(e.name,r)}_const(e,t){let r=null;e.value!==null&&(r=this.evalExpression(e.value,t)),t.createVariable(e.name,r,e)}_let(e,t){let r=null;if(e.value!==null){if(r=this.evalExpression(e.value,t),r===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof io||(r=r.clone())}else{const o=e.type.name;if(o==="f32"||o==="i32"||o==="u32"||o==="bool"||o==="f16"||o==="vec2"||o==="vec3"||o==="vec4"||o==="vec2f"||o==="vec3f"||o==="vec4f"||o==="vec2i"||o==="vec3i"||o==="vec4i"||o==="vec2u"||o==="vec3u"||o==="vec4u"||o==="vec2h"||o==="vec3h"||o==="vec4h"||o==="vec2b"||o==="vec3b"||o==="vec4b"||o==="mat2x2"||o==="mat2x3"||o==="mat2x4"||o==="mat3x2"||o==="mat3x3"||o==="mat3x4"||o==="mat4x2"||o==="mat4x3"||o==="mat4x4"||o==="mat2x2f"||o==="mat2x3f"||o==="mat2x4f"||o==="mat3x2f"||o==="mat3x3f"||o==="mat3x4f"||o==="mat4x2f"||o==="mat4x3f"||o==="mat4x4f"||o==="mat2x2h"||o==="mat2x3h"||o==="mat2x4h"||o==="mat3x2h"||o==="mat3x3h"||o==="mat3x4h"||o==="mat4x2h"||o==="mat4x3h"||o==="mat4x4h"||o==="array"){const p=new n0(e.type,[]);r=this._evalCreate(p,t)}}t.createVariable(e.name,r,e)}_var(e,t){let r=null;if(e.value!==null){if(r=this.evalExpression(e.value,t),r===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof io||(r=r.clone())}else{if(e.type===null)return void console.error(`Variable ${e.name} has no type. Line ${e.line}`);const o=e.type.name;if(o==="f32"||o==="i32"||o==="u32"||o==="bool"||o==="f16"||o==="vec2"||o==="vec3"||o==="vec4"||o==="vec2f"||o==="vec3f"||o==="vec4f"||o==="vec2i"||o==="vec3i"||o==="vec4i"||o==="vec2u"||o==="vec3u"||o==="vec4u"||o==="vec2h"||o==="vec3h"||o==="vec4h"||o==="vec2b"||o==="vec3b"||o==="vec4b"||o==="mat2x2"||o==="mat2x3"||o==="mat2x4"||o==="mat3x2"||o==="mat3x3"||o==="mat3x4"||o==="mat4x2"||o==="mat4x3"||o==="mat4x4"||o==="mat2x2f"||o==="mat2x3f"||o==="mat2x4f"||o==="mat3x2f"||o==="mat3x3f"||o==="mat3x4f"||o==="mat4x2f"||o==="mat4x3f"||o==="mat4x4f"||o==="mat2x2h"||o==="mat2x3h"||o==="mat2x4h"||o==="mat3x2h"||o==="mat3x3h"||o==="mat3x4h"||o==="mat4x2h"||o==="mat4x3h"||o==="mat4x4h"||e.type instanceof t1||e.type instanceof Mp||e.type instanceof gt){const p=new n0(e.type,[]);r=this._evalCreate(p,t)}}t.createVariable(e.name,r,e)}_switch(e,t){t=t.clone();const r=this.evalExpression(e.condition,t);if(!(r instanceof at))return console.error(`Invalid if condition. Line ${e.line}`),null;let o=null;for(const p of e.cases)if(p instanceof _M)for(const _ of p.selectors){if(_ instanceof Rv){o=p;continue}const l=this.evalExpression(_,t);if(!(l instanceof at))return console.error(`Invalid case selector. Line ${e.line}`),null;if(l.value===r.value)return this._execStatements(p.body,t)}else p instanceof yM&&(o=p);return o?this._execStatements(o.body,t):null}_if(e,t){t=t.clone();const r=this.evalExpression(e.condition,t);if(!(r instanceof at))return console.error(`Invalid if condition. Line ${e.line}`),null;if(r.value)return this._execStatements(e.body,t);for(const o of e.elseif){const p=this.evalExpression(o.condition,t);if(!(p instanceof at))return console.error(`Invalid if condition. Line ${e.line}`),null;if(p.value)return this._execStatements(o.body,t)}return e.else?this._execStatements(e.else,t):null}_getScalarValue(e){return e instanceof at?e.value:(console.error("Expected scalar value.",e),0)}_for(e,t){for(t=t.clone(),this.execStatement(e.init,t);this._getScalarValue(this.evalExpression(e.condition,t));){const r=this._execStatements(e.body,t);if(r===ec._breakObj)break;if(r!==null&&r!==ec._continueObj)return r;this.execStatement(e.increment,t)}return null}_loop(e,t){for(t=t.clone();;){const r=this._execStatements(e.body,t);if(r===ec._breakObj)break;if(r===ec._continueObj){if(e.continuing&&this._execStatements(e.continuing.body,t)===ec._breakObj)break}else if(r!==null)return r}return null}_while(e,t){for(t=t.clone();this._getScalarValue(this.evalExpression(e.condition,t));){const r=this._execStatements(e.body,t);if(r===ec._breakObj)break;if(r!==ec._continueObj&&r!==null)return r}return null}_evalBitcast(e,t){const r=this.evalExpression(e.value,t),o=e.type;if(r instanceof at){const p=f4(r.value,r.typeInfo.name,o.name);return new at(p,this.getTypeInfo(o))}if(r instanceof ze){const p=r.typeInfo.getTypeName();let _="";if(p.endsWith("f"))_="f32";else if(p.endsWith("i"))_="i32";else if(p.endsWith("u"))_="u32";else if(p.endsWith("b"))_="bool";else{if(!p.endsWith("h"))return console.error(`Unknown vector type ${p}. Line ${e.line}`),null;_="f16"}const l=o.getTypeName();let M="";if(l.endsWith("f"))M="f32";else if(l.endsWith("i"))M="i32";else if(l.endsWith("u"))M="u32";else if(l.endsWith("b"))M="bool";else{if(!l.endsWith("h"))return console.error(`Unknown vector type ${M}. Line ${e.line}`),null;M="f16"}const D=(function(B,j,$){if(j===$)return B;const se=new Array(B.length);for(let de=0;de<B.length;de++)se[de]=f4(B[de],j,$);return se})(Array.from(r.data),_,M);return new ze(D,this.getTypeInfo(o))}return console.error(`TODO: bitcast for ${r.typeInfo.name}. Line ${e.line}`),null}_evalConst(e,t){return t.getVariableValue(e.name).clone().getSubData(this,e.postfix,t)}_evalCreate(e,t){var r;if(e instanceof n0){if(e.type===null)return kA.void;switch(e.type.getTypeName()){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(e,t);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(e,t);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(e,t)}}const o=e instanceof n0?e.type.name:e.name,p=e instanceof n0?this.getTypeInfo(e.type):this.getTypeInfo(e.name);if(p===null)return console.error(`Unknown type ${o}. Line ${e.line}`),null;if(p.size===0)return null;const _=new va(new ArrayBuffer(p.size),p,0);if(p instanceof Wg){if(e.args)for(let l=0;l<e.args.length;++l){const M=p.members[l],D=e.args[l],B=this.evalExpression(D,t);_.setData(this,B,M.type,M.offset,t)}}else if(p instanceof Hg){let l=0;if(e.args)for(let M=0;M<e.args.length;++M){const D=e.args[M],B=this.evalExpression(D,t);p.format===null&&(((r=B.typeInfo)===null||r===void 0?void 0:r.name)==="x32"?p.format=this.getTypeInfo("i32"):p.format=B.typeInfo),_.setData(this,B,p.format,l,t),l+=p.stride}}else console.error(`Unknown type "${o}". Line ${e.line}`);return e instanceof n0?_.getSubData(this,e.postfix,t):_}_evalLiteral(e,t){const r=this.getTypeInfo(e.type),o=r.name;return o==="x32"||o==="u32"||o==="f32"||o==="f16"||o==="i32"||o==="bool"?new at(e.scalarValue,r):o==="vec2"||o==="vec3"||o==="vec4"||o==="vec2f"||o==="vec3f"||o==="vec4f"||o==="vec2h"||o==="vec3h"||o==="vec4h"||o==="vec2i"||o==="vec3i"||o==="vec4i"||o==="vec2u"||o==="vec3u"||o==="vec4u"?this._callConstructorVec(e,t):o==="mat2x2"||o==="mat2x3"||o==="mat2x4"||o==="mat3x2"||o==="mat3x3"||o==="mat3x4"||o==="mat4x2"||o==="mat4x3"||o==="mat4x4"||o==="mat2x2f"||o==="mat2x3f"||o==="mat2x4f"||o==="mat3x2f"||o==="mat3x3f"||o==="mat3x4f"||o==="mat4x2f"||o==="mat4x3f"||o==="mat4x4f"||o==="mat2x2h"||o==="mat2x3h"||o==="mat2x4h"||o==="mat3x2h"||o==="mat3x3h"||o==="mat3x4h"||o==="mat4x2h"||o==="mat4x3h"||o==="mat4x4h"?this._callConstructorMatrix(e,t):e.value}_evalVariable(e,t){const r=t.getVariableValue(e.name);return r===null?r:r.getSubData(this,e.postfix,t)}_maxFormatTypeInfo(e){let t=e[0];if(t.name==="f32")return t;for(let r=1;r<e.length;++r){const o=ec._priority.get(t.name);ec._priority.get(e[r].name)<o&&(t=e[r])}return t.name==="x32"?this.getTypeInfo("i32"):t}_evalUnaryOp(e,t){const r=this.evalExpression(e.right,t);if(e.operator==="&")return new Ry(r);if(e.operator==="*")return r instanceof Ry?r.reference.getSubData(this,e.postfix,t):(console.error(`Invalid dereference. Line ${e.line}`),null);const o=r instanceof at?r.value:r instanceof ze?Array.from(r.data):null;switch(e.operator){case"+":{if(Ri(o)){const l=o.map((M,D)=>+M);return new ze(l,r.typeInfo)}const p=o,_=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new at(+p,_)}case"-":{if(Ri(o)){const l=o.map((M,D)=>-M);return new ze(l,r.typeInfo)}const p=o,_=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new at(-p,_)}case"!":{if(Ri(o)){const l=o.map((M,D)=>M?0:1);return new ze(l,r.typeInfo)}const p=o,_=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new at(p?0:1,_)}case"~":{if(Ri(o)){const l=o.map((M,D)=>~M);return new ze(l,r.typeInfo)}const p=o,_=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new at(~p,_)}}return console.error(`Invalid unary operator ${e.operator}. Line ${e.line}`),null}_evalBinaryOp(e,t){const r=this.evalExpression(e.left,t),o=this.evalExpression(e.right,t),p=r instanceof at?r.value:r instanceof ze||r instanceof cn?Array.from(r.data):null,_=o instanceof at?o.value:o instanceof ze||o instanceof cn?Array.from(o.data):null;switch(e.operator){case"+":{if(Ri(p)&&Ri(_)){const B=p,j=_;if(B.length!==j.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const $=B.map((se,de)=>se+j[de]);return new ze($,r.typeInfo)}if(Ri(p)){const B=_,j=p.map(($,se)=>$+B);return new ze(j,r.typeInfo)}if(Ri(_)){const B=p,j=_.map(($,se)=>B+$);return new ze(j,o.typeInfo)}const l=p,M=_,D=this._maxFormatTypeInfo([r.typeInfo,o.typeInfo]);return new at(l+M,D)}case"-":{if(Ri(p)&&Ri(_)){const B=p,j=_;if(B.length!==j.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const $=B.map((se,de)=>se-j[de]);return new ze($,r.typeInfo)}if(Ri(p)){const B=_,j=p.map(($,se)=>$-B);return new ze(j,r.typeInfo)}if(Ri(_)){const B=p,j=_.map(($,se)=>B-$);return new ze(j,o.typeInfo)}const l=p,M=_,D=this._maxFormatTypeInfo([r.typeInfo,o.typeInfo]);return new at(l-M,D)}case"*":{if(Ri(p)&&Ri(_)){const B=p,j=_;if(r instanceof cn&&o instanceof cn){const $=(function(he,Le,$e,Be){if(kc[Le.name]===void 0||kc[Be.name]===void 0)return null;const Je=kc[Le.name][0],Rt=kc[Le.name][1],Et=kc[Be.name][0];if(Je!==kc[Be.name][1])return null;const kt=new Array(Et*Rt);for(let Ht=0;Ht<Rt;Ht++)for(let Xt=0;Xt<Et;Xt++){let hi=0;for(let di=0;di<Je;di++)hi+=he[di*Rt+Ht]*$e[Xt*Je+di];kt[Ht*Et+Xt]=hi}return kt})(B,r.typeInfo,j,o.typeInfo);if($===null)return console.error(`Matrix multiplication failed. Line ${e.line}.`),null;const se=kc[o.typeInfo.name][0],de=kc[r.typeInfo.name][1],Ae=this.getTypeInfo(`mat${se}x${de}f`);return new cn($,Ae)}if(r instanceof cn&&o instanceof ze){const $=(function(se,de,Ae,he){if(kc[de.name]===void 0||Fb[he.name]===void 0)return null;const Le=kc[de.name][0],$e=kc[de.name][1];if(Le!==Ae.length)return null;const Be=new Array($e);for(let Je=0;Je<$e;Je++){let Rt=0;for(let Et=0;Et<Le;Et++)Rt+=se[Et*$e+Je]*Ae[Et];Be[Je]=Rt}return Be})(B,r.typeInfo,j,o.typeInfo);return $===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new ze($,o.typeInfo)}if(r instanceof ze&&o instanceof cn){const $=(function(se,de,Ae,he){if(Fb[de.name]===void 0||kc[he.name]===void 0)return null;const Le=kc[he.name][0],$e=kc[he.name][1];if($e!==se.length)return null;const Be=[];for(let Je=0;Je<Le;Je++){let Rt=0;for(let Et=0;Et<$e;Et++)Rt+=se[Et]*Ae[Et*Le+Je];Be[Je]=Rt}return Be})(B,r.typeInfo,j,o.typeInfo);return $===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new ze($,r.typeInfo)}{if(B.length!==j.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const $=B.map((se,de)=>se*j[de]);return new ze($,r.typeInfo)}}if(Ri(p)){const B=_,j=p.map(($,se)=>$*B);return r instanceof cn?new cn(j,r.typeInfo):new ze(j,r.typeInfo)}if(Ri(_)){const B=p,j=_.map(($,se)=>B*$);return o instanceof cn?new cn(j,o.typeInfo):new ze(j,o.typeInfo)}const l=p,M=_,D=this._maxFormatTypeInfo([r.typeInfo,o.typeInfo]);return new at(l*M,D)}case"%":{if(Ri(p)&&Ri(_)){const B=p,j=_;if(B.length!==j.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const $=B.map((se,de)=>se%j[de]);return new ze($,r.typeInfo)}if(Ri(p)){const B=_,j=p.map(($,se)=>$%B);return new ze(j,r.typeInfo)}if(Ri(_)){const B=p,j=_.map(($,se)=>B%$);return new ze(j,o.typeInfo)}const l=p,M=_,D=this._maxFormatTypeInfo([r.typeInfo,o.typeInfo]);return new at(l%M,D)}case"/":{if(Ri(p)&&Ri(_)){const B=p,j=_;if(B.length!==j.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const $=B.map((se,de)=>se/j[de]);return new ze($,r.typeInfo)}if(Ri(p)){const B=_,j=p.map(($,se)=>$/B);return new ze(j,r.typeInfo)}if(Ri(_)){const B=p,j=_.map(($,se)=>B/$);return new ze(j,o.typeInfo)}const l=p,M=_,D=this._maxFormatTypeInfo([r.typeInfo,o.typeInfo]);return new at(l/M,D)}case"&":{if(Ri(p)&&Ri(_)){const B=p,j=_;if(B.length!==j.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const $=B.map((se,de)=>se&j[de]);return new ze($,r.typeInfo)}if(Ri(p)){const B=_,j=p.map(($,se)=>$&B);return new ze(j,r.typeInfo)}if(Ri(_)){const B=p,j=_.map(($,se)=>B&$);return new ze(j,o.typeInfo)}const l=p,M=_,D=this._maxFormatTypeInfo([r.typeInfo,o.typeInfo]);return new at(l&M,D)}case"|":{if(Ri(p)&&Ri(_)){const B=p,j=_;if(B.length!==j.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const $=B.map((se,de)=>se|j[de]);return new ze($,r.typeInfo)}if(Ri(p)){const B=_,j=p.map(($,se)=>$|B);return new ze(j,r.typeInfo)}if(Ri(_)){const B=p,j=_.map(($,se)=>B|$);return new ze(j,o.typeInfo)}const l=p,M=_,D=this._maxFormatTypeInfo([r.typeInfo,o.typeInfo]);return new at(l|M,D)}case"^":{if(Ri(p)&&Ri(_)){const B=p,j=_;if(B.length!==j.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const $=B.map((se,de)=>se^j[de]);return new ze($,r.typeInfo)}if(Ri(p)){const B=_,j=p.map(($,se)=>$^B);return new ze(j,r.typeInfo)}if(Ri(_)){const B=p,j=_.map(($,se)=>B^$);return new ze(j,o.typeInfo)}const l=p,M=_,D=this._maxFormatTypeInfo([r.typeInfo,o.typeInfo]);return new at(l^M,D)}case"<<":{if(Ri(p)&&Ri(_)){const B=p,j=_;if(B.length!==j.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const $=B.map((se,de)=>se<<j[de]);return new ze($,r.typeInfo)}if(Ri(p)){const B=_,j=p.map(($,se)=>$<<B);return new ze(j,r.typeInfo)}if(Ri(_)){const B=p,j=_.map(($,se)=>B<<$);return new ze(j,o.typeInfo)}const l=p,M=_,D=this._maxFormatTypeInfo([r.typeInfo,o.typeInfo]);return new at(l<<M,D)}case">>":{if(Ri(p)&&Ri(_)){const B=p,j=_;if(B.length!==j.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const $=B.map((se,de)=>se>>j[de]);return new ze($,r.typeInfo)}if(Ri(p)){const B=_,j=p.map(($,se)=>$>>B);return new ze(j,r.typeInfo)}if(Ri(_)){const B=p,j=_.map(($,se)=>B>>$);return new ze(j,o.typeInfo)}const l=p,M=_,D=this._maxFormatTypeInfo([r.typeInfo,o.typeInfo]);return new at(l>>M,D)}case">":if(Ri(p)&&Ri(_)){const l=p,M=_;if(l.length!==M.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const D=l.map((B,j)=>B>M[j]?1:0);return new ze(D,r.typeInfo)}if(Ri(p)){const l=_,M=p.map((D,B)=>D>l?1:0);return new ze(M,r.typeInfo)}if(Ri(_)){const l=p,M=_.map((D,B)=>l>D?1:0);return new ze(M,o.typeInfo)}return new at(p>_?1:0,this.getTypeInfo("bool"));case"<":if(Ri(p)&&Ri(_)){const l=p,M=_;if(l.length!==M.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const D=l.map((B,j)=>B<M[j]?1:0);return new ze(D,r.typeInfo)}if(Ri(p)){const l=_,M=p.map((D,B)=>D<l?1:0);return new ze(M,r.typeInfo)}if(Ri(_)){const l=p,M=_.map((D,B)=>l<D?1:0);return new ze(M,o.typeInfo)}return new at(p<_?1:0,this.getTypeInfo("bool"));case"==":if(Ri(p)&&Ri(_)){const l=p,M=_;if(l.length!==M.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const D=l.map((B,j)=>B===M[j]?1:0);return new ze(D,r.typeInfo)}if(Ri(p)){const l=_,M=p.map((D,B)=>D==l?1:0);return new ze(M,r.typeInfo)}if(Ri(_)){const l=p,M=_.map((D,B)=>l==D?1:0);return new ze(M,o.typeInfo)}return new at(p===_?1:0,this.getTypeInfo("bool"));case"!=":if(Ri(p)&&Ri(_)){const l=p,M=_;if(l.length!==M.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const D=l.map((B,j)=>B!==M[j]?1:0);return new ze(D,r.typeInfo)}if(Ri(p)){const l=_,M=p.map((D,B)=>D!==l?1:0);return new ze(M,r.typeInfo)}if(Ri(_)){const l=p,M=_.map((D,B)=>l!==D?1:0);return new ze(M,o.typeInfo)}return new at(p!==_?1:0,this.getTypeInfo("bool"));case">=":if(Ri(p)&&Ri(_)){const l=p,M=_;if(l.length!==M.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const D=l.map((B,j)=>B>=M[j]?1:0);return new ze(D,r.typeInfo)}if(Ri(p)){const l=_,M=p.map((D,B)=>D>=l?1:0);return new ze(M,r.typeInfo)}if(Ri(_)){const l=p,M=_.map((D,B)=>l>=D?1:0);return new ze(M,o.typeInfo)}return new at(p>=_?1:0,this.getTypeInfo("bool"));case"<=":if(Ri(p)&&Ri(_)){const l=p,M=_;if(l.length!==M.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const D=l.map((B,j)=>B<=M[j]?1:0);return new ze(D,r.typeInfo)}if(Ri(p)){const l=_,M=p.map((D,B)=>D<=l?1:0);return new ze(M,r.typeInfo)}if(Ri(_)){const l=p,M=_.map((D,B)=>l<=D?1:0);return new ze(M,o.typeInfo)}return new at(p<=_?1:0,this.getTypeInfo("bool"));case"&&":if(Ri(p)&&Ri(_)){const l=p,M=_;if(l.length!==M.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const D=l.map((B,j)=>B&&M[j]?1:0);return new ze(D,r.typeInfo)}if(Ri(p)){const l=_,M=p.map((D,B)=>D&&l?1:0);return new ze(M,r.typeInfo)}if(Ri(_)){const l=p,M=_.map((D,B)=>l&&D?1:0);return new ze(M,o.typeInfo)}return new at(p&&_?1:0,this.getTypeInfo("bool"));case"||":if(Ri(p)&&Ri(_)){const l=p,M=_;if(l.length!==M.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const D=l.map((B,j)=>B||M[j]?1:0);return new ze(D,r.typeInfo)}if(Ri(p)){const l=_,M=p.map((D,B)=>D||l?1:0);return new ze(M,r.typeInfo)}if(Ri(_)){const l=p,M=_.map((D,B)=>l||D?1:0);return new ze(M,o.typeInfo)}return new at(p||_?1:0,this.getTypeInfo("bool"))}return console.error(`Unknown operator ${e.operator}. Line ${e.line}`),null}_evalCall(e,t){if(e.cachedReturnValue!==null)return e.cachedReturnValue;const r=t.clone();r.currentFunctionName=e.name;const o=t.getFunction(e.name);if(!o)return e.isBuiltin?this._callBuiltinFunction(e,r):this.getTypeInfo(e.name)?this._evalCreate(e,t):(console.error(`Unknown function "${e.name}". Line ${e.line}`),null);for(let p=0;p<o.node.args.length;++p){const _=o.node.args[p],l=this.evalExpression(e.args[p],r);r.createVariable(_.name,l,_)}return this._execStatements(o.node.body,r)}_callBuiltinFunction(e,t){switch(e.name){case"all":return this.builtins.All(e,t);case"any":return this.builtins.Any(e,t);case"select":return this.builtins.Select(e,t);case"arrayLength":return this.builtins.ArrayLength(e,t);case"abs":return this.builtins.Abs(e,t);case"acos":return this.builtins.Acos(e,t);case"acosh":return this.builtins.Acosh(e,t);case"asin":return this.builtins.Asin(e,t);case"asinh":return this.builtins.Asinh(e,t);case"atan":return this.builtins.Atan(e,t);case"atanh":return this.builtins.Atanh(e,t);case"atan2":return this.builtins.Atan2(e,t);case"ceil":return this.builtins.Ceil(e,t);case"clamp":return this.builtins.Clamp(e,t);case"cos":return this.builtins.Cos(e,t);case"cosh":return this.builtins.Cosh(e,t);case"countLeadingZeros":return this.builtins.CountLeadingZeros(e,t);case"countOneBits":return this.builtins.CountOneBits(e,t);case"countTrailingZeros":return this.builtins.CountTrailingZeros(e,t);case"cross":return this.builtins.Cross(e,t);case"degrees":return this.builtins.Degrees(e,t);case"determinant":return this.builtins.Determinant(e,t);case"distance":return this.builtins.Distance(e,t);case"dot":return this.builtins.Dot(e,t);case"dot4U8Packed":return this.builtins.Dot4U8Packed(e,t);case"dot4I8Packed":return this.builtins.Dot4I8Packed(e,t);case"exp":return this.builtins.Exp(e,t);case"exp2":return this.builtins.Exp2(e,t);case"extractBits":return this.builtins.ExtractBits(e,t);case"faceForward":return this.builtins.FaceForward(e,t);case"firstLeadingBit":return this.builtins.FirstLeadingBit(e,t);case"firstTrailingBit":return this.builtins.FirstTrailingBit(e,t);case"floor":return this.builtins.Floor(e,t);case"fma":return this.builtins.Fma(e,t);case"fract":return this.builtins.Fract(e,t);case"frexp":return this.builtins.Frexp(e,t);case"insertBits":return this.builtins.InsertBits(e,t);case"inverseSqrt":return this.builtins.InverseSqrt(e,t);case"ldexp":return this.builtins.Ldexp(e,t);case"length":return this.builtins.Length(e,t);case"log":return this.builtins.Log(e,t);case"log2":return this.builtins.Log2(e,t);case"max":return this.builtins.Max(e,t);case"min":return this.builtins.Min(e,t);case"mix":return this.builtins.Mix(e,t);case"modf":return this.builtins.Modf(e,t);case"normalize":return this.builtins.Normalize(e,t);case"pow":return this.builtins.Pow(e,t);case"quantizeToF16":return this.builtins.QuantizeToF16(e,t);case"radians":return this.builtins.Radians(e,t);case"reflect":return this.builtins.Reflect(e,t);case"refract":return this.builtins.Refract(e,t);case"reverseBits":return this.builtins.ReverseBits(e,t);case"round":return this.builtins.Round(e,t);case"saturate":return this.builtins.Saturate(e,t);case"sign":return this.builtins.Sign(e,t);case"sin":return this.builtins.Sin(e,t);case"sinh":return this.builtins.Sinh(e,t);case"smoothstep":return this.builtins.SmoothStep(e,t);case"sqrt":return this.builtins.Sqrt(e,t);case"step":return this.builtins.Step(e,t);case"tan":return this.builtins.Tan(e,t);case"tanh":return this.builtins.Tanh(e,t);case"transpose":return this.builtins.Transpose(e,t);case"trunc":return this.builtins.Trunc(e,t);case"dpdx":return this.builtins.Dpdx(e,t);case"dpdxCoarse":return this.builtins.DpdxCoarse(e,t);case"dpdxFine":return this.builtins.DpdxFine(e,t);case"dpdy":return this.builtins.Dpdy(e,t);case"dpdyCoarse":return this.builtins.DpdyCoarse(e,t);case"dpdyFine":return this.builtins.DpdyFine(e,t);case"fwidth":return this.builtins.Fwidth(e,t);case"fwidthCoarse":return this.builtins.FwidthCoarse(e,t);case"fwidthFine":return this.builtins.FwidthFine(e,t);case"textureDimensions":return this.builtins.TextureDimensions(e,t);case"textureGather":return this.builtins.TextureGather(e,t);case"textureGatherCompare":return this.builtins.TextureGatherCompare(e,t);case"textureLoad":return this.builtins.TextureLoad(e,t);case"textureNumLayers":return this.builtins.TextureNumLayers(e,t);case"textureNumLevels":return this.builtins.TextureNumLevels(e,t);case"textureNumSamples":return this.builtins.TextureNumSamples(e,t);case"textureSample":return this.builtins.TextureSample(e,t);case"textureSampleBias":return this.builtins.TextureSampleBias(e,t);case"textureSampleCompare":return this.builtins.TextureSampleCompare(e,t);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(e,t);case"textureSampleGrad":return this.builtins.TextureSampleGrad(e,t);case"textureSampleLevel":return this.builtins.TextureSampleLevel(e,t);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(e,t);case"textureStore":return this.builtins.TextureStore(e,t);case"atomicLoad":return this.builtins.AtomicLoad(e,t);case"atomicStore":return this.builtins.AtomicStore(e,t);case"atomicAdd":return this.builtins.AtomicAdd(e,t);case"atomicSub":return this.builtins.AtomicSub(e,t);case"atomicMax":return this.builtins.AtomicMax(e,t);case"atomicMin":return this.builtins.AtomicMin(e,t);case"atomicAnd":return this.builtins.AtomicAnd(e,t);case"atomicOr":return this.builtins.AtomicOr(e,t);case"atomicXor":return this.builtins.AtomicXor(e,t);case"atomicExchange":return this.builtins.AtomicExchange(e,t);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(e,t);case"pack4x8snorm":return this.builtins.Pack4x8snorm(e,t);case"pack4x8unorm":return this.builtins.Pack4x8unorm(e,t);case"pack4xI8":return this.builtins.Pack4xI8(e,t);case"pack4xU8":return this.builtins.Pack4xU8(e,t);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(e,t);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(e,t);case"pack2x16snorm":return this.builtins.Pack2x16snorm(e,t);case"pack2x16unorm":return this.builtins.Pack2x16unorm(e,t);case"pack2x16float":return this.builtins.Pack2x16float(e,t);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(e,t);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(e,t);case"unpack4xI8":return this.builtins.Unpack4xI8(e,t);case"unpack4xU8":return this.builtins.Unpack4xU8(e,t);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(e,t);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(e,t);case"unpack2x16float":return this.builtins.Unpack2x16float(e,t);case"storageBarrier":return this.builtins.StorageBarrier(e,t);case"textureBarrier":return this.builtins.TextureBarrier(e,t);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(e,t);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(e,t);case"subgroupAdd":return this.builtins.SubgroupAdd(e,t);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(e,t);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(e,t);case"subgroupAll":return this.builtins.SubgroupAll(e,t);case"subgroupAnd":return this.builtins.SubgroupAnd(e,t);case"subgroupAny":return this.builtins.SubgroupAny(e,t);case"subgroupBallot":return this.builtins.SubgroupBallot(e,t);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(e,t);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(e,t);case"subgroupElect":return this.builtins.SubgroupElect(e,t);case"subgroupMax":return this.builtins.SubgroupMax(e,t);case"subgroupMin":return this.builtins.SubgroupMin(e,t);case"subgroupMul":return this.builtins.SubgroupMul(e,t);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(e,t);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(e,t);case"subgroupOr":return this.builtins.SubgroupOr(e,t);case"subgroupShuffle":return this.builtins.SubgroupShuffle(e,t);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(e,t);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(e,t);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(e,t);case"subgroupXor":return this.builtins.SubgroupXor(e,t);case"quadBroadcast":return this.builtins.QuadBroadcast(e,t);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(e,t);case"quadSwapX":return this.builtins.QuadSwapX(e,t);case"quadSwapY":return this.builtins.QuadSwapY(e,t)}const r=t.getFunction(e.name);if(r){const o=t.clone();for(let p=0;p<r.node.args.length;++p){const _=r.node.args[p],l=this.evalExpression(e.args[p],o);o.setVariable(_.name,l,_)}return this._execStatements(r.node.body,o)}return null}_callConstructorValue(e,t){if(!e.args||e.args.length===0)return new at(0,this.getTypeInfo(e.type));const r=this.evalExpression(e.args[0],t);return r.typeInfo=this.getTypeInfo(e.type),r.getSubData(this,e.postfix,t).clone()}_callConstructorVec(e,t){const r=this.getTypeInfo(e.type),o=e.type.getTypeName(),p=Fb[o];if(p===void 0)return console.error(`Invalid vec constructor ${o}. Line ${e.line}`),null;const _=[];if(e instanceof Mo)if(e.isVector){const l=e.vectorValue;for(const M of l)_.push(M)}else _.push(e.scalarValue);else if(e.args)for(const l of e.args){const M=this.evalExpression(l,t);if(M instanceof ze){const D=M.data;for(let B=0;B<D.length;++B){let j=D[B];_.push(j)}}else if(M instanceof at){let D=M.value;_.push(D)}}if(e.type instanceof gt&&e.type.format===null&&(e.type.format=gt.f32),_.length===0){const l=new Array(p).fill(0);return new ze(l,r).getSubData(this,e.postfix,t)}if(_.length===1)for(;_.length<p;)_.push(_[0]);return _.length<p?(console.error(`Invalid vec constructor. Line ${e.line}`),null):new ze(_.length>p?_.slice(0,p):_,r).getSubData(this,e.postfix,t)}_callConstructorMatrix(e,t){const r=this.getTypeInfo(e.type),o=e.type.getTypeName(),p=kc[o];if(p===void 0)return console.error(`Invalid matrix constructor ${o}. Line ${e.line}`),null;const _=[];if(e instanceof Mo)if(e.isVector){const l=e.vectorValue;for(const M of l)_.push(M)}else _.push(e.scalarValue);else if(e.args)for(const l of e.args){const M=this.evalExpression(l,t);M instanceof ze?_.push(...M.data):M instanceof at?_.push(M.value):M instanceof cn&&_.push(...M.data)}if(r instanceof S_&&r.format===null&&(r.format=this.getTypeInfo("f32")),_.length===0){const l=new Array(p[2]).fill(0);return new cn(l,r).getSubData(this,e.postfix,t)}return _.length!==p[2]?(console.error(`Invalid matrix constructor. Line ${e.line}`),null):new cn(_,r).getSubData(this,e.postfix,t)}}ec._breakObj=new hf(new lf("BREAK",null),null),ec._continueObj=new hf(new lf("CONTINUE",null),null),ec._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class pL{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class gL{constructor(){this._tokens=[],this._current=0,this._currentLine=1,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new pL,this._exec=new ec,this._forwardTypeCount=0}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const t=[];for(;!this._isAtEnd();){const r=this._global_decl_or_directive();if(!r)break;t.push(r)}if(this._deferArrayCountEval.length>0){for(const r of this._deferArrayCountEval){const o=r.arrayType,p=r.countNode;if(p instanceof oh){const _=p.name,l=this._context.constants.get(_);if(l)try{const M=l.constEvaluate(this._exec);o.count=M}catch{}}}this._deferArrayCountEval.length=0}if(this._forwardTypeCount>0)for(const r of t)r.search(o=>{o instanceof u4||o instanceof Mv?o.type=this._forwardType(o.type):o instanceof t1?o.format=this._forwardType(o.format):o instanceof Cp||o instanceof e1||o instanceof Ev?o.type=this._forwardType(o.type):o instanceof p1?o.returnType=this._forwardType(o.returnType):o instanceof c4&&(o.type=this._forwardType(o.type))});return t}_forwardType(e){if(e instanceof l4){const t=this._getType(e.name);if(t)return t}else e instanceof Mv?e.type=this._forwardType(e.type):e instanceof t1&&(e.format=this._forwardType(e.format));return e}_initialize(e){if(e)if(typeof e=="string"){const t=new rL(e);this._tokens=t.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_updateNode(e,t){return e.line=t??this._currentLine,e}_error(e,t){return{token:e,message:t,toString:()=>`${t}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==Ie.eof}_match(e){if(e instanceof ut)return!!this._check(e)&&(this._advance(),!0);for(let t=0,r=e.length;t<r;++t){const o=e[t];if(this._check(o))return this._advance(),!0}return!1}_consume(e,t){if(this._check(e))return this._advance();throw this._error(this._peek(),`${t}. Line:${this._currentLine}`)}_check(e){if(this._isAtEnd())return!1;const t=this._peek();if(e instanceof Array){const r=t.type;let o=!1;for(const p of e){if(r===p)return!0;p===Ie.tokens.name&&(o=!0)}if(o){const p=Ie.tokens.name.rule.exec(t.lexeme);if(p&&p.index==0&&p[0]==t.lexeme)return!0}return!1}if(t.type===e)return!0;if(e===Ie.tokens.name){const r=Ie.tokens.name.rule.exec(t.lexeme);return r&&r.index==0&&r[0]==t.lexeme}return!1}_advance(){var e,t;return this._currentLine=(t=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&t!==void 0?t:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(Ie.tokens.semicolon)&&!this._isAtEnd(););if(this._match(Ie.keywords.alias)){const t=this._type_alias();return this._consume(Ie.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(Ie.keywords.diagnostic)){const t=this._diagnostic();return this._consume(Ie.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(Ie.keywords.requires)){const t=this._requires_directive();return this._consume(Ie.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(Ie.keywords.enable)){const t=this._enable_directive();return this._consume(Ie.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}const e=this._attribute();if(this._check(Ie.keywords.var)){const t=this._global_variable_decl();return t!=null&&(t.attributes=e),this._consume(Ie.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(Ie.keywords.override)){const t=this._override_variable_decl();return t!=null&&(t.attributes=e),this._consume(Ie.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(Ie.keywords.let)){const t=this._global_let_decl();return t!=null&&(t.attributes=e),this._consume(Ie.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(Ie.keywords.const)){const t=this._global_const_decl();return t!=null&&(t.attributes=e),this._consume(Ie.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(Ie.keywords.struct)){const t=this._struct_decl();return t!=null&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}if(this._check(Ie.keywords.fn)){const t=this._function_decl();return t!=null&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}return null}_function_decl(){if(!this._match(Ie.keywords.fn))return null;const e=this._currentLine,t=this._consume(Ie.tokens.ident,"Expected function name.").toString();this._consume(Ie.tokens.paren_left,"Expected '(' for function arguments.");const r=[];if(!this._check(Ie.tokens.paren_right))do{if(this._check(Ie.tokens.paren_right))break;const l=this._attribute(),M=this._consume(Ie.tokens.name,"Expected argument name.").toString();this._consume(Ie.tokens.colon,"Expected ':' for argument type.");const D=this._attribute(),B=this._type_decl();B!=null&&(B.attributes=D,r.push(this._updateNode(new c4(M,B,l))))}while(this._match(Ie.tokens.comma));this._consume(Ie.tokens.paren_right,"Expected ')' after function arguments.");let o=null;if(this._match(Ie.tokens.arrow)){const l=this._attribute();o=this._type_decl(),o!=null&&(o.attributes=l)}const p=this._compound_statement(),_=this._currentLine;return this._updateNode(new p1(t,r,o,p,e,_),e)}_compound_statement(){const e=[];for(this._consume(Ie.tokens.brace_left,"Expected '{' for block.");!this._check(Ie.tokens.brace_right);){const t=this._statement();t!==null&&e.push(t)}return this._consume(Ie.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(Ie.tokens.semicolon)&&!this._isAtEnd(););if(this._check(Ie.tokens.attr)&&this._attribute(),this._check(Ie.keywords.if))return this._if_statement();if(this._check(Ie.keywords.switch))return this._switch_statement();if(this._check(Ie.keywords.loop))return this._loop_statement();if(this._check(Ie.keywords.for))return this._for_statement();if(this._check(Ie.keywords.while))return this._while_statement();if(this._check(Ie.keywords.continuing))return this._continuing_statement();if(this._check(Ie.keywords.static_assert))return this._static_assert_statement();if(this._check(Ie.tokens.brace_left))return this._compound_statement();let e=null;if(this._check(Ie.keywords.return))e=this._return_statement();else if(this._check([Ie.keywords.var,Ie.keywords.let,Ie.keywords.const]))e=this._variable_statement();else if(this._match(Ie.keywords.discard))e=this._updateNode(new tL);else if(this._match(Ie.keywords.break)){const t=this._updateNode(new hM);if(this._currentLoop.length>0){const r=this._currentLoop[this._currentLoop.length-1];t.loopId=r.id}e=t,this._check(Ie.keywords.if)&&(this._advance(),t.condition=this._optional_paren_expression())}else if(this._match(Ie.keywords.continue)){const t=this._updateNode(new fM);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${t.line}`);{const r=this._currentLoop[this._currentLoop.length-1];t.loopId=r.id}e=t}else e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return e!=null&&this._consume(Ie.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(Ie.keywords.static_assert))return null;const e=this._currentLine,t=this._optional_paren_expression();return this._updateNode(new Qz(t),e)}_while_statement(){if(!this._match(Ie.keywords.while))return null;const e=this._updateNode(new iM(null,null));return this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(Ie.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_continuing_statement(){const e=this._currentLoop.length>0?this._currentLoop[this._currentLoop.length-1].id:-1;if(!this._match(Ie.keywords.continuing))return null;const t=this._currentLine,r=this._compound_statement();return this._updateNode(new IA(r,e),t)}_for_statement(){if(!this._match(Ie.keywords.for))return null;this._consume(Ie.tokens.paren_left,"Expected '('.");const e=this._updateNode(new nM(null,null,null,null));return this._currentLoop.push(e),e.init=this._check(Ie.tokens.semicolon)?null:this._for_init(),this._consume(Ie.tokens.semicolon,"Expected ';'."),e.condition=this._check(Ie.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(Ie.tokens.semicolon,"Expected ';'."),e.increment=this._check(Ie.tokens.paren_right)?null:this._for_increment(),this._consume(Ie.tokens.paren_right,"Expected ')'."),this._check(Ie.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(Ie.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let t=null;return this._match(Ie.tokens.equal)&&(t=this._short_circuit_or_expression()),this._updateNode(new Cp(e.name,e.type,e.storage,e.access,t),e.line)}if(this._match(Ie.keywords.let)){const e=this._currentLine,t=this._consume(Ie.tokens.name,"Expected name for let.").toString();let r=null;if(this._match(Ie.tokens.colon)){const p=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=p)}this._consume(Ie.tokens.equal,"Expected '=' for let.");const o=this._short_circuit_or_expression();return this._updateNode(new e1(t,r,null,null,o),e)}if(this._match(Ie.keywords.const)){const e=this._currentLine,t=this._consume(Ie.tokens.name,"Expected name for const.").toString();let r=null;if(this._match(Ie.tokens.colon)){const p=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=p)}this._consume(Ie.tokens.equal,"Expected '=' for const.");const o=this._short_circuit_or_expression();return r===null&&o instanceof Mo&&(r=o.type),this._updateNode(new Ev(t,r,null,null,o),e)}return null}_increment_decrement_statement(){const e=this._current,t=this._unary_expression();if(t==null)return null;if(!this._check(Ie.increment_operators))return this._current=e,null;const r=this._consume(Ie.increment_operators,"Expected increment operator");return this._updateNode(new rM(r.type===Ie.tokens.plus_plus?By.increment:By.decrement,t))}_assignment_statement(){let e=null;const t=this._currentLine;if(this._check(Ie.tokens.brace_right))return null;let r=this._match(Ie.tokens.underscore);if(r||(e=this._unary_expression()),!r&&e==null)return null;const o=this._consume(Ie.assignment_operators,"Expected assignment operator."),p=this._short_circuit_or_expression();return this._updateNode(new sM(j2.parse(o.lexeme),e,p),t)}_func_call_statement(){if(!this._check(Ie.tokens.ident))return null;const e=this._currentLine,t=this._current,r=this._consume(Ie.tokens.ident,"Expected function name."),o=this._argument_expression_list();return o===null?(this._current=t,null):this._updateNode(new Iw(r.lexeme,o),e)}_loop_statement(){if(!this._match(Ie.keywords.loop))return null;this._check(Ie.tokens.attr)&&this._attribute(),this._consume(Ie.tokens.brace_left,"Expected '{' for loop.");const e=this._updateNode(new aM([],null));this._currentLoop.push(e);let t=this._statement();for(;t!==null;){if(Array.isArray(t))for(let r of t)e.body.push(r);else e.body.push(t);if(t instanceof IA){e.continuing=t;break}t=this._statement()}return this._currentLoop.pop(),this._consume(Ie.tokens.brace_right,"Expected '}' for loop."),e}_switch_statement(){if(!this._match(Ie.keywords.switch))return null;const e=this._updateNode(new oM(null,[]));if(this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(Ie.tokens.attr)&&this._attribute(),this._consume(Ie.tokens.brace_left,"Expected '{' for switch."),e.cases=this._switch_body(),e.cases==null||e.cases.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(Ie.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),e}_switch_body(){const e=[];let t=!1;for(;this._check([Ie.keywords.default,Ie.keywords.case]);){if(this._match(Ie.keywords.case)){const r=this._case_selectors();for(const p of r)if(p instanceof Rv){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");t=!0;break}this._match(Ie.tokens.colon),this._check(Ie.tokens.attr)&&this._attribute(),this._consume(Ie.tokens.brace_left,"Exected '{' for switch case.");const o=this._case_body();this._consume(Ie.tokens.brace_right,"Exected '}' for switch case."),e.push(this._updateNode(new _M(r,o)))}if(this._match(Ie.keywords.default)){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(Ie.tokens.colon),this._check(Ie.tokens.attr)&&this._attribute(),this._consume(Ie.tokens.brace_left,"Exected '{' for switch default.");const r=this._case_body();this._consume(Ie.tokens.brace_right,"Exected '}' for switch default."),e.push(this._updateNode(new yM(r)))}}return e}_case_selectors(){const e=[];for(this._match(Ie.keywords.default)?e.push(this._updateNode(new Rv)):e.push(this._shift_expression());this._match(Ie.tokens.comma);)this._match(Ie.keywords.default)?e.push(this._updateNode(new Rv)):e.push(this._shift_expression());return e}_case_body(){if(this._match(Ie.keywords.fallthrough))return this._consume(Ie.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const t=this._case_body();return t.length==0?e:[...e,t[0]]}_if_statement(){if(!this._match(Ie.keywords.if))return null;const e=this._currentLine,t=this._optional_paren_expression();this._check(Ie.tokens.attr)&&this._attribute();const r=this._compound_statement();let o=[];this._match_elseif()&&(this._check(Ie.tokens.attr)&&this._attribute(),o=this._elseif_statement(o));let p=null;return this._match(Ie.keywords.else)&&(this._check(Ie.tokens.attr)&&this._attribute(),p=this._compound_statement()),this._updateNode(new lM(t,r,o,p),e)}_match_elseif(){return this._tokens[this._current].type===Ie.keywords.else&&this._tokens[this._current+1].type===Ie.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(e=[]){const t=this._optional_paren_expression(),r=this._compound_statement();return e.push(this._updateNode(new iL(t,r))),this._match_elseif()&&(this._check(Ie.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(Ie.keywords.return))return null;const e=this._short_circuit_or_expression();return this._updateNode(new cM(e))}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(Ie.tokens.or_or);)e=this._updateNode(new qf(this._previous().toString(),e,this._short_circuit_and_expr()));return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(Ie.tokens.and_and);)e=this._updateNode(new qf(this._previous().toString(),e,this._inclusive_or_expression()));return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(Ie.tokens.or);)e=this._updateNode(new qf(this._previous().toString(),e,this._exclusive_or_expression()));return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(Ie.tokens.xor);)e=this._updateNode(new qf(this._previous().toString(),e,this._and_expression()));return e}_and_expression(){let e=this._equality_expression();for(;this._match(Ie.tokens.and);)e=this._updateNode(new qf(this._previous().toString(),e,this._equality_expression()));return e}_equality_expression(){const e=this._relational_expression();return this._match([Ie.tokens.equal_equal,Ie.tokens.not_equal])?this._updateNode(new qf(this._previous().toString(),e,this._relational_expression())):e}_relational_expression(){let e=this._shift_expression();for(;this._match([Ie.tokens.less_than,Ie.tokens.greater_than,Ie.tokens.less_than_equal,Ie.tokens.greater_than_equal]);)e=this._updateNode(new qf(this._previous().toString(),e,this._shift_expression()));return e}_shift_expression(){let e=this._additive_expression();for(;this._match([Ie.tokens.shift_left,Ie.tokens.shift_right]);)e=this._updateNode(new qf(this._previous().toString(),e,this._additive_expression()));return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([Ie.tokens.plus,Ie.tokens.minus]);)e=this._updateNode(new qf(this._previous().toString(),e,this._multiplicative_expression()));return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([Ie.tokens.star,Ie.tokens.forward_slash,Ie.tokens.modulo]);)e=this._updateNode(new qf(this._previous().toString(),e,this._unary_expression()));return e}_unary_expression(){return this._match([Ie.tokens.minus,Ie.tokens.bang,Ie.tokens.tilde,Ie.tokens.star,Ie.tokens.and])?this._updateNode(new io(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),t=this._postfix_expression();return t&&(e.postfix=t),e}_postfix_expression(){if(this._match(Ie.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(Ie.tokens.bracket_right,"Expected ']'.");const t=this._updateNode(new Jy(e)),r=this._postfix_expression();return r&&(t.postfix=r),t}if(this._match(Ie.tokens.period)){const e=this._consume(Ie.tokens.name,"Expected member name."),t=this._postfix_expression(),r=this._updateNode(new E_(e.lexeme));return t&&(r.postfix=t),r}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_getType(e){const t=this._getStruct(e);if(t!==null)return t;switch(e){case"void":return Kt.void;case"bool":return Kt.bool;case"i32":return Kt.i32;case"u32":return Kt.u32;case"f32":return Kt.f32;case"f16":return Kt.f16;case"vec2f":return gt.vec2f;case"vec3f":return gt.vec3f;case"vec4f":return gt.vec4f;case"vec2i":return gt.vec2i;case"vec3i":return gt.vec3i;case"vec4i":return gt.vec4i;case"vec2u":return gt.vec2u;case"vec3u":return gt.vec3u;case"vec4u":return gt.vec4u;case"vec2h":return gt.vec2h;case"vec3h":return gt.vec3h;case"vec4h":return gt.vec4h;case"mat2x2f":return gt.mat2x2f;case"mat2x3f":return gt.mat2x3f;case"mat2x4f":return gt.mat2x4f;case"mat3x2f":return gt.mat3x2f;case"mat3x3f":return gt.mat3x3f;case"mat3x4f":return gt.mat3x4f;case"mat4x2f":return gt.mat4x2f;case"mat4x3f":return gt.mat4x3f;case"mat4x4f":return gt.mat4x4f;case"mat2x2h":return gt.mat2x2h;case"mat2x3h":return gt.mat2x3h;case"mat2x4h":return gt.mat2x4h;case"mat3x2h":return gt.mat3x2h;case"mat3x3h":return gt.mat3x3h;case"mat3x4h":return gt.mat3x4h;case"mat4x2h":return gt.mat4x2h;case"mat4x3h":return gt.mat4x3h;case"mat4x4h":return gt.mat4x4h;case"mat2x2i":return gt.mat2x2i;case"mat2x3i":return gt.mat2x3i;case"mat2x4i":return gt.mat2x4i;case"mat3x2i":return gt.mat3x2i;case"mat3x3i":return gt.mat3x3i;case"mat3x4i":return gt.mat3x4i;case"mat4x2i":return gt.mat4x2i;case"mat4x3i":return gt.mat4x3i;case"mat4x4i":return gt.mat4x4i;case"mat2x2u":return gt.mat2x2u;case"mat2x3u":return gt.mat2x3u;case"mat2x4u":return gt.mat2x4u;case"mat3x2u":return gt.mat3x2u;case"mat3x3u":return gt.mat3x3u;case"mat3x4u":return gt.mat3x4u;case"mat4x2u":return gt.mat4x2u;case"mat4x3u":return gt.mat4x3u;case"mat4x4u":return gt.mat4x4u}return null}_validateTypeRange(e,t){if(t.name==="i32"){if(e<-2147483648||e>2147483647)throw this._error(this._previous(),`Value out of range for i32: ${e}. Line: ${this._currentLine}.`)}else if(t.name==="u32"&&(e<0||e>4294967295))throw this._error(this._previous(),`Value out of range for u32: ${e}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(Ie.tokens.ident)){const r=this._previous().toString();if(this._check(Ie.tokens.paren_left)){const o=this._argument_expression_list(),p=this._getType(r);return p!==null?this._updateNode(new n0(p,o)):this._updateNode(new Dw(r,o))}if(this._context.constants.has(r)){const o=this._context.constants.get(r);return this._updateNode(new dM(r,o.value))}return this._updateNode(new oh(r))}if(this._match(Ie.tokens.int_literal)){const r=this._previous().toString();let o=r.endsWith("i")||r.endsWith("i")?Kt.i32:r.endsWith("u")||r.endsWith("U")?Kt.u32:Kt.x32;const p=parseInt(r);return this._validateTypeRange(p,o),this._updateNode(new Mo(new at(p,this._exec.getTypeInfo(o)),o))}if(this._match(Ie.tokens.uint_literal)){const r=parseInt(this._previous().toString());return this._validateTypeRange(r,Kt.u32),this._updateNode(new Mo(new at(r,this._exec.getTypeInfo(Kt.u32)),Kt.u32))}if(this._match([Ie.tokens.decimal_float_literal,Ie.tokens.hex_float_literal])){let r=this._previous().toString(),o=r.endsWith("h");o&&(r=r.substring(0,r.length-1));const p=parseFloat(r);this._validateTypeRange(p,o?Kt.f16:Kt.f32);const _=o?Kt.f16:Kt.f32;return this._updateNode(new Mo(new at(p,this._exec.getTypeInfo(_)),_))}if(this._match([Ie.keywords.true,Ie.keywords.false])){let r=this._previous().toString()===Ie.keywords.true.rule;return this._updateNode(new Mo(new at(r?1:0,this._exec.getTypeInfo(Kt.bool)),Kt.bool))}if(this._check(Ie.tokens.paren_left))return this._paren_expression();if(this._match(Ie.keywords.bitcast)){this._consume(Ie.tokens.less_than,"Expected '<'.");const r=this._type_decl();this._consume(Ie.tokens.greater_than,"Expected '>'.");const o=this._paren_expression();return this._updateNode(new pM(r,o))}const e=this._type_decl(),t=this._argument_expression_list();return this._updateNode(new n0(e,t))}_argument_expression_list(){if(!this._match(Ie.tokens.paren_left))return null;const e=[];do{if(this._check(Ie.tokens.paren_right))break;const t=this._short_circuit_or_expression();e.push(t)}while(this._match(Ie.tokens.comma));return this._consume(Ie.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(Ie.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(Ie.tokens.paren_right),e}_paren_expression(){this._consume(Ie.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(Ie.tokens.paren_right,"Expected ')'."),e}_struct_decl(){if(!this._match(Ie.keywords.struct))return null;const e=this._currentLine,t=this._consume(Ie.tokens.ident,"Expected name for struct.").toString();this._consume(Ie.tokens.brace_left,"Expected '{' for struct body.");const r=[];for(;!this._check(Ie.tokens.brace_right);){const _=this._attribute(),l=this._consume(Ie.tokens.name,"Expected variable name.").toString();this._consume(Ie.tokens.colon,"Expected ':' for struct member type.");const M=this._attribute(),D=this._type_decl();D!=null&&(D.attributes=M),this._check(Ie.tokens.brace_right)?this._match(Ie.tokens.comma):this._consume(Ie.tokens.comma,"Expected ',' for struct member."),r.push(this._updateNode(new u4(l,D,_)))}this._consume(Ie.tokens.brace_right,"Expected '}' after struct body.");const o=this._currentLine,p=this._updateNode(new Mp(t,r,e,o),e);return this._context.structs.set(t,p),p}_global_variable_decl(){const e=this._variable_decl();if(!e)return null;if(this._match(Ie.tokens.equal)){const t=this._const_expression();e.value=t}if(e.type!==null&&e.value instanceof Mo){if(e.value.type.name!=="x32"&&e.type.getTypeName()!==e.value.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${e.value.type.name} to ${e.type.name}. Line:${this._currentLine}`);e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type),e.value.type=e.type}else e.type===null&&e.value instanceof Mo&&(e.type=e.value.type.name==="x32"?Kt.i32:e.value.type,e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type));return e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(Ie.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){var e;if(!this._match(Ie.keywords.const))return null;const t=this._consume(Ie.tokens.name,"Expected variable name"),r=this._currentLine;let o=null;if(this._match(Ie.tokens.colon)){const M=this._attribute();o=this._type_decl(),o!=null&&(o.attributes=M)}let p=null;this._consume(Ie.tokens.equal,"const declarations require an assignment");const _=this._short_circuit_or_expression();try{let M=[Kt.f32],D=_.constEvaluate(this._exec,M);D instanceof at&&this._validateTypeRange(D.value,M[0]),M[0]instanceof gt&&M[0].format===null&&D.typeInfo instanceof S_&&D.typeInfo.format!==null&&(D.typeInfo.format.name==="f16"?M[0].format=Kt.f16:D.typeInfo.format.name==="f32"?M[0].format=Kt.f32:D.typeInfo.format.name==="i32"?M[0].format=Kt.i32:D.typeInfo.format.name==="u32"?M[0].format=Kt.u32:D.typeInfo.format.name==="bool"?M[0].format=Kt.bool:console.error(`TODO: impelement template format type ${D.typeInfo.format.name}`)),p=this._updateNode(new Mo(D,M[0])),this._exec.context.setVariable(t.toString(),D)}catch{p=_}if(o!==null&&p instanceof Mo){if(p.type.name!=="x32"&&o.getTypeName()!==p.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${p.type.name} to ${o.name}. Line:${this._currentLine}`);p.type=o,p.isScalar&&this._validateTypeRange(p.scalarValue,p.type)}else o===null&&p instanceof Mo&&(o=(e=p==null?void 0:p.type)!==null&&e!==void 0?e:Kt.f32,o===Kt.x32&&(o=Kt.i32));const l=this._updateNode(new Ev(t.toString(),o,"","",p),r);return this._context.constants.set(l.name,l),l}_global_let_decl(){if(!this._match(Ie.keywords.let))return null;const e=this._currentLine,t=this._consume(Ie.tokens.name,"Expected variable name");let r=null;if(this._match(Ie.tokens.colon)){const p=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=p)}let o=null;if(this._match(Ie.tokens.equal)&&(o=this._const_expression()),r!==null&&o instanceof Mo){if(o.type.name!=="x32"&&r.getTypeName()!==o.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${o.type.name} to ${r.name}. Line:${this._currentLine}`);o.type=r}else r===null&&o instanceof Mo&&(r=o.type.name==="x32"?Kt.i32:o.type);return o instanceof Mo&&o.isScalar&&this._validateTypeRange(o.scalarValue,r),this._updateNode(new e1(t.toString(),r,"","",o),e)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(Ie.keywords.var))return null;const e=this._currentLine;let t="",r="";this._match(Ie.tokens.less_than)&&(t=this._consume(Ie.storage_class,"Expected storage_class.").toString(),this._match(Ie.tokens.comma)&&(r=this._consume(Ie.access_mode,"Expected access_mode.").toString()),this._consume(Ie.tokens.greater_than,"Expected '>'."));const o=this._consume(Ie.tokens.name,"Expected variable name");let p=null;if(this._match(Ie.tokens.colon)){const _=this._attribute();p=this._type_decl(),p!=null&&(p.attributes=_)}return this._updateNode(new Cp(o.toString(),p,t,r,null),e)}_override_decl(){if(!this._match(Ie.keywords.override))return null;const e=this._consume(Ie.tokens.name,"Expected variable name");let t=null;if(this._match(Ie.tokens.colon)){const r=this._attribute();t=this._type_decl(),t!=null&&(t.attributes=r)}return this._updateNode(new Pw(e.toString(),t,null))}_diagnostic(){this._consume(Ie.tokens.paren_left,"Expected '('");const e=this._consume(Ie.tokens.ident,"Expected severity control name.");this._consume(Ie.tokens.comma,"Expected ','");let t=this._consume(Ie.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(Ie.tokens.period)&&(t+=`.${this._consume(Ie.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(Ie.tokens.paren_right,"Expected ')'"),this._updateNode(new uM(e.toString(),t))}_enable_directive(){const e=this._consume(Ie.tokens.ident,"identity expected.");return this._updateNode(new Kz(e.toString()))}_requires_directive(){const e=[this._consume(Ie.tokens.ident,"identity expected.").toString()];for(;this._match(Ie.tokens.comma);){const t=this._consume(Ie.tokens.ident,"identity expected.");e.push(t.toString())}return this._updateNode(new eL(e))}_type_alias(){const e=this._consume(Ie.tokens.ident,"identity expected.");this._consume(Ie.tokens.equal,"Expected '=' for type alias.");let t=this._type_decl();if(t===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(t.name)&&(t=this._context.aliases.get(t.name).type);const r=this._updateNode(new kw(e.toString(),t));return this._context.aliases.set(r.name,r),r}_type_decl(){if(this._check([Ie.tokens.ident,...Ie.texel_format,Ie.keywords.bool,Ie.keywords.f32,Ie.keywords.i32,Ie.keywords.u32])){const r=this._advance().toString();if(this._context.structs.has(r))return this._context.structs.get(r);if(this._context.aliases.has(r))return this._context.aliases.get(r).type;if(!this._getType(r)){const o=this._updateNode(new l4(r));return this._forwardTypeCount++,o}return this._updateNode(new Kt(r))}let e=this._texture_sampler_types();if(e)return e;if(this._check(Ie.template_types)){let r=this._advance().toString(),o=null,p=null;return this._match(Ie.tokens.less_than)&&(o=this._type_decl(),p=null,this._match(Ie.tokens.comma)&&(p=this._consume(Ie.access_mode,"Expected access_mode for pointer").toString()),this._consume(Ie.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new gt(r,o,p))}if(this._match(Ie.keywords.ptr)){let r=this._previous().toString();this._consume(Ie.tokens.less_than,"Expected '<' for pointer.");const o=this._consume(Ie.storage_class,"Expected storage_class for pointer");this._consume(Ie.tokens.comma,"Expected ',' for pointer.");const p=this._type_decl();let _=null;return this._match(Ie.tokens.comma)&&(_=this._consume(Ie.access_mode,"Expected access_mode for pointer").toString()),this._consume(Ie.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new Mv(r,o.toString(),p,_))}const t=this._attribute();if(this._match(Ie.keywords.array)){let r=null,o=-1;const p=this._previous();let _=null;if(this._match(Ie.tokens.less_than)){r=this._type_decl(),this._context.aliases.has(r.name)&&(r=this._context.aliases.get(r.name).type);let M="";if(this._match(Ie.tokens.comma)){_=this._shift_expression();try{M=_.constEvaluate(this._exec).toString(),_=null}catch{M="1"}}this._consume(Ie.tokens.greater_than,"Expected '>' for array."),o=M?parseInt(M):0}const l=this._updateNode(new t1(p.toString(),t,r,o));return _&&this._deferArrayCountEval.push({arrayType:l,countNode:_}),l}return null}_texture_sampler_types(){if(this._match(Ie.sampler_type))return this._updateNode(new G2(this._previous().toString(),null,null));if(this._match(Ie.depth_texture_type))return this._updateNode(new G2(this._previous().toString(),null,null));if(this._match(Ie.sampled_texture_type)||this._match(Ie.multisampled_texture_type)){const e=this._previous();this._consume(Ie.tokens.less_than,"Expected '<' for sampler type.");const t=this._type_decl();return this._consume(Ie.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new G2(e.toString(),t,null))}if(this._match(Ie.storage_texture_type)){const e=this._previous();this._consume(Ie.tokens.less_than,"Expected '<' for sampler type.");const t=this._consume(Ie.texel_format,"Invalid texel format.").toString();this._consume(Ie.tokens.comma,"Expected ',' after texel format.");const r=this._consume(Ie.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(Ie.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new G2(e.toString(),t,r))}return null}_attribute(){let e=[];for(;this._match(Ie.tokens.attr);){const t=this._consume(Ie.attribute_name,"Expected attribute name"),r=this._updateNode(new vM(t.toString(),null));if(this._match(Ie.tokens.paren_left)){if(r.value=this._consume(Ie.literal_or_ident,"Expected attribute value").toString(),this._check(Ie.tokens.comma)){this._advance();do{const o=this._consume(Ie.literal_or_ident,"Expected attribute value").toString();r.value instanceof Array||(r.value=[r.value]),r.value.push(o)}while(this._match(Ie.tokens.comma))}this._consume(Ie.tokens.paren_right,"Expected ')'")}e.push(r)}return e.length==0?null:e}}class mL extends s0{constructor(e){super(),e&&this.update(e)}update(e){const t=new gL().parse(e);this.updateAST(t)}}function _L(i){var p;const e={attributes:[],bindings:[]};let t;try{t=yL(i)}catch(_){return ni.error(_.message)(),e}for(const _ of t.uniforms){const l=[];for(const M of((p=_.type)==null?void 0:p.members)||[])l.push({name:M.name,type:d4(M.type)});e.bindings.push({type:"uniform",name:_.name,group:_.group,location:_.binding,members:l})}for(const _ of t.textures)e.bindings.push({type:"texture",name:_.name,group:_.group,location:_.binding});for(const _ of t.samplers)e.bindings.push({type:"sampler",name:_.name,group:_.group,location:_.binding});const r=t.entry.vertex[0],o=(r==null?void 0:r.inputs.length)||0;for(let _=0;_<o;_++){const l=r.inputs[_];if(l.locationType==="location"){const M=d4(l.type);e.attributes.push({name:l.name,location:Number(l.location),type:M})}}return e}function d4(i){return i!=null&&i.format?`${i.name}<${i.format.name}>`:i.name}function yL(i){try{return new mL(i)}catch(e){if(e instanceof Error)throw e;let t="WGSL parse error";throw typeof e=="object"&&(e!=null&&e.message)&&(t+=`: ${e.message} `),typeof e=="object"&&(e!=null&&e.token)&&(t+=e.token.line||""),new Error(t,{cause:e})}}const vL={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...vL}};const cf=globalThis.mathgl.config;function xL(i,{precision:e=cf.precision}={}){return i=bL(i),`${parseFloat(i.toPrecision(e))}`}function Qy(i){return Array.isArray(i)||ArrayBuffer.isView(i)&&!(i instanceof DataView)}function a0(i,e,t){return wL(i,r=>Math.max(e,Math.min(t,r)))}function cx(i,e,t){return Qy(i)?i.map((r,o)=>cx(r,e[o],t)):t*e+(1-t)*i}function g1(i,e,t){const r=cf.EPSILON;try{if(i===e)return!0;if(Qy(i)&&Qy(e)){if(i.length!==e.length)return!1;for(let o=0;o<i.length;++o)if(!g1(i[o],e[o]))return!1;return!0}return i&&i.equals?i.equals(e):e&&e.equals?e.equals(i):typeof i=="number"&&typeof e=="number"?Math.abs(i-e)<=cf.EPSILON*Math.max(1,Math.abs(i),Math.abs(e)):!1}finally{cf.EPSILON=r}}function bL(i){return Math.round(i/cf.EPSILON)*cf.EPSILON}function AL(i){return i.clone?i.clone():new Array(i.length)}function wL(i,e,t){if(Qy(i)){const r=i;t=t||AL(r);for(let o=0;o<t.length&&o<r.length;++o){const p=typeof i=="number"?i:i[o];t[o]=e(p,o,t)}return t}return e(i)}class xM extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,t=0){for(let r=0;r<this.ELEMENTS;++r)this[r]=e[r+t];return this.check()}toArray(e=[],t=0){for(let r=0;r<this.ELEMENTS;++r)e[t+r]=this[r];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:Qy(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(cf)}formatString(e){let t="";for(let r=0;r<this.ELEMENTS;++r)t+=(r>0?", ":"")+xL(this[r],e);return`${e.printTypes?this.constructor.name:""}[${t}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(!g1(this[t],e[t]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,t,r){if(r===void 0)return this.lerp(this,e,t);for(let o=0;o<this.ELEMENTS;++o){const p=e[o],_=typeof t=="number"?t:t[o];this[o]=p+r*(_-p)}return this.check()}min(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}max(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}clamp(e,t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e[r]),t[r]);return this.check()}add(...e){for(const t of e)for(let r=0;r<this.ELEMENTS;++r)this[r]+=t[r];return this.check()}subtract(...e){for(const t of e)for(let r=0;r<this.ELEMENTS;++r)this[r]-=t[r];return this.check()}scale(e){if(typeof e=="number")for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;else for(let t=0;t<this.ELEMENTS&&t<e.length;++t)this[t]*=e[t];return this.check()}multiplyByScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}check(){if(cf.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}addScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e),t);return this.check()}get elements(){return this}}function TL(i,e){if(i.length!==e)return!1;for(let t=0;t<i.length;++t)if(!Number.isFinite(i[t]))return!1;return!0}function ah(i){if(!Number.isFinite(i))throw new Error(`Invalid number ${JSON.stringify(i)}`);return i}function Nb(i,e,t=""){if(cf.debug&&!TL(i,e))throw new Error(`math.gl: ${t} some fields set to invalid numbers'`);return i}function p4(i,e){if(!i)throw new Error(`math.gl assertion ${e}`)}class SL extends xM{get x(){return this[0]}set x(e){this[0]=ah(e)}get y(){return this[1]}set y(e){this[1]=ah(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let t=0;for(let r=0;r<this.ELEMENTS;++r){const o=this[r]-e[r];t+=o*o}return ah(t)}dot(e){let t=0;for(let r=0;r<this.ELEMENTS;++r)t+=this[r]*e[r];return ah(t)}normalize(){const e=this.magnitude();if(e!==0)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}multiply(...e){for(const t of e)for(let r=0;r<this.ELEMENTS;++r)this[r]*=t[r];return this.check()}divide(...e){for(const t of e)for(let r=0;r<this.ELEMENTS;++r)this[r]/=t[r];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return p4(e>=0&&e<this.ELEMENTS,"index is out of range"),ah(this[e])}setComponent(e,t){return p4(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}addVectors(e,t){return this.copy(e).add(t)}subVectors(e,t){return this.copy(e).subtract(t)}multiplyVectors(e,t){return this.copy(e).multiply(t)}addScaledVector(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}}const Cv=1e-6;let Ky=typeof Float32Array<"u"?Float32Array:Array;function EL(){const i=new Ky(2);return Ky!=Float32Array&&(i[0]=0,i[1]=0),i}function g4(i,e,t){return i[0]=e[0]+t[0],i[1]=e[1]+t[1],i}function ML(i,e){return i[0]=-e[0],i[1]=-e[1],i}function bM(i,e,t,r){const o=e[0],p=e[1];return i[0]=o+r*(t[0]-o),i[1]=p+r*(t[1]-p),i}function RL(i,e,t){const r=e[0],o=e[1];return i[0]=t[0]*r+t[4]*o+t[12],i[1]=t[1]*r+t[5]*o+t[13],i}(function(){const i=EL();return function(e,t,r,o,p,_){let l,M;for(t||(t=2),r||(r=0),o?M=Math.min(o*t+r,e.length):M=e.length,l=r;l<M;l+=t)i[0]=e[l],i[1]=e[l+1],p(i,i,_),e[l]=i[0],e[l+1]=i[1];return e}})();function CL(i,e,t){const r=e[0],o=e[1],p=t[3]*r+t[7]*o||1;return i[0]=(t[0]*r+t[4]*o)/p,i[1]=(t[1]*r+t[5]*o)/p,i}function AM(i,e,t){const r=e[0],o=e[1],p=e[2],_=t[3]*r+t[7]*o+t[11]*p||1;return i[0]=(t[0]*r+t[4]*o+t[8]*p)/_,i[1]=(t[1]*r+t[5]*o+t[9]*p)/_,i[2]=(t[2]*r+t[6]*o+t[10]*p)/_,i}function PL(i,e,t){const r=e[0],o=e[1];return i[0]=t[0]*r+t[2]*o,i[1]=t[1]*r+t[3]*o,i[2]=e[2],i}function IL(){const i=new Ky(3);return Ky!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function kL(i){const e=i[0],t=i[1],r=i[2];return Math.sqrt(e*e+t*t+r*r)}function DL(i,e,t){return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],i}function OL(i){const e=i[0],t=i[1],r=i[2];return e*e+t*t+r*r}function FL(i,e){return i[0]=-e[0],i[1]=-e[1],i[2]=-e[2],i}function NL(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]}function BL(i,e,t){const r=e[0],o=e[1],p=e[2],_=t[0],l=t[1],M=t[2];return i[0]=o*M-p*l,i[1]=p*_-r*M,i[2]=r*l-o*_,i}function zL(i,e,t,r){const o=e[0],p=e[1],_=e[2];return i[0]=o+r*(t[0]-o),i[1]=p+r*(t[1]-p),i[2]=_+r*(t[2]-_),i}function wM(i,e,t){const r=e[0],o=e[1],p=e[2];let _=t[3]*r+t[7]*o+t[11]*p+t[15];return _=_||1,i[0]=(t[0]*r+t[4]*o+t[8]*p+t[12])/_,i[1]=(t[1]*r+t[5]*o+t[9]*p+t[13])/_,i[2]=(t[2]*r+t[6]*o+t[10]*p+t[14])/_,i}function LL(i,e,t){const r=e[0],o=e[1],p=e[2];return i[0]=r*t[0]+o*t[3]+p*t[6],i[1]=r*t[1]+o*t[4]+p*t[7],i[2]=r*t[2]+o*t[5]+p*t[8],i}function UL(i,e,t){const r=t[0],o=t[1],p=t[2],_=t[3],l=e[0],M=e[1],D=e[2];let B=o*D-p*M,j=p*l-r*D,$=r*M-o*l,se=o*$-p*j,de=p*B-r*$,Ae=r*j-o*B;const he=_*2;return B*=he,j*=he,$*=he,se*=2,de*=2,Ae*=2,i[0]=l+B+se,i[1]=M+j+de,i[2]=D+$+Ae,i}function VL(i,e,t,r){const o=[],p=[];return o[0]=e[0]-t[0],o[1]=e[1]-t[1],o[2]=e[2]-t[2],p[0]=o[0],p[1]=o[1]*Math.cos(r)-o[2]*Math.sin(r),p[2]=o[1]*Math.sin(r)+o[2]*Math.cos(r),i[0]=p[0]+t[0],i[1]=p[1]+t[1],i[2]=p[2]+t[2],i}function jL(i,e,t,r){const o=[],p=[];return o[0]=e[0]-t[0],o[1]=e[1]-t[1],o[2]=e[2]-t[2],p[0]=o[2]*Math.sin(r)+o[0]*Math.cos(r),p[1]=o[1],p[2]=o[2]*Math.cos(r)-o[0]*Math.sin(r),i[0]=p[0]+t[0],i[1]=p[1]+t[1],i[2]=p[2]+t[2],i}function GL(i,e,t,r){const o=[],p=[];return o[0]=e[0]-t[0],o[1]=e[1]-t[1],o[2]=e[2]-t[2],p[0]=o[0]*Math.cos(r)-o[1]*Math.sin(r),p[1]=o[0]*Math.sin(r)+o[1]*Math.cos(r),p[2]=o[2],i[0]=p[0]+t[0],i[1]=p[1]+t[1],i[2]=p[2]+t[2],i}function WL(i,e){const t=i[0],r=i[1],o=i[2],p=e[0],_=e[1],l=e[2],M=Math.sqrt((t*t+r*r+o*o)*(p*p+_*_+l*l)),D=M&&NL(i,e)/M;return Math.acos(Math.min(Math.max(D,-1),1))}const TM=DL,ZL=kL,Bb=OL;(function(){const i=IL();return function(e,t,r,o,p,_){let l,M;for(t||(t=3),r||(r=0),o?M=Math.min(o*t+r,e.length):M=e.length,l=r;l<M;l+=t)i[0]=e[l],i[1]=e[l+1],i[2]=e[l+2],p(i,i,_),e[l]=i[0],e[l+1]=i[1],e[l+2]=i[2];return e}})();const zb=[0,0,0];let hv;class c0 extends SL{static get ZERO(){return hv||(hv=new c0(0,0,0),Object.freeze(hv)),hv}constructor(e=0,t=0,r=0){super(-0,-0,-0),arguments.length===1&&Qy(e)?this.copy(e):(cf.debug&&(ah(e),ah(t),ah(r)),this[0]=e,this[1]=t,this[2]=r)}set(e,t,r){return this[0]=e,this[1]=t,this[2]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return cf.debug&&(ah(e.x),ah(e.y),ah(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=ah(e)}angle(e){return WL(this,e)}cross(e){return BL(this,this,e),this.check()}rotateX({radians:e,origin:t=zb}){return VL(this,this,t,e),this.check()}rotateY({radians:e,origin:t=zb}){return jL(this,this,t,e),this.check()}rotateZ({radians:e,origin:t=zb}){return GL(this,this,t,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return wM(this,this,e),this.check()}transformAsVector(e){return AM(this,this,e),this.check()}transformByMatrix3(e){return LL(this,this,e),this.check()}transformByMatrix2(e){return PL(this,this,e),this.check()}transformByQuaternion(e){return UL(this,this,e),this.check()}}class XL extends xM{toString(){let e="[";if(cf.printRowMajor){e+="row-major:";for(let t=0;t<this.RANK;++t)for(let r=0;r<this.RANK;++r)e+=` ${this[r*this.RANK+t]}`}else{e+="column-major:";for(let t=0;t<this.ELEMENTS;++t)e+=` ${this[t]}`}return e+="]",e}getElementIndex(e,t){return t*this.RANK+e}getElement(e,t){return this[t*this.RANK+e]}setElement(e,t,r){return this[t*this.RANK+e]=ah(r),this}getColumn(e,t=new Array(this.RANK).fill(-0)){const r=e*this.RANK;for(let o=0;o<this.RANK;++o)t[o]=this[r+o];return t}setColumn(e,t){const r=e*this.RANK;for(let o=0;o<this.RANK;++o)this[r+o]=t[o];return this}}function HL(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function $L(i,e){if(i===e){const t=e[1],r=e[2],o=e[3],p=e[6],_=e[7],l=e[11];i[1]=e[4],i[2]=e[8],i[3]=e[12],i[4]=t,i[6]=e[9],i[7]=e[13],i[8]=r,i[9]=p,i[11]=e[14],i[12]=o,i[13]=_,i[14]=l}else i[0]=e[0],i[1]=e[4],i[2]=e[8],i[3]=e[12],i[4]=e[1],i[5]=e[5],i[6]=e[9],i[7]=e[13],i[8]=e[2],i[9]=e[6],i[10]=e[10],i[11]=e[14],i[12]=e[3],i[13]=e[7],i[14]=e[11],i[15]=e[15];return i}function DA(i,e){const t=e[0],r=e[1],o=e[2],p=e[3],_=e[4],l=e[5],M=e[6],D=e[7],B=e[8],j=e[9],$=e[10],se=e[11],de=e[12],Ae=e[13],he=e[14],Le=e[15],$e=t*l-r*_,Be=t*M-o*_,Je=t*D-p*_,Rt=r*M-o*l,Et=r*D-p*l,kt=o*D-p*M,Ht=B*Ae-j*de,Xt=B*he-$*de,hi=B*Le-se*de,di=j*he-$*Ae,Ei=j*Le-se*Ae,Ii=$*Le-se*he;let fi=$e*Ii-Be*Ei+Je*di+Rt*hi-Et*Xt+kt*Ht;return fi?(fi=1/fi,i[0]=(l*Ii-M*Ei+D*di)*fi,i[1]=(o*Ei-r*Ii-p*di)*fi,i[2]=(Ae*kt-he*Et+Le*Rt)*fi,i[3]=($*Et-j*kt-se*Rt)*fi,i[4]=(M*hi-_*Ii-D*Xt)*fi,i[5]=(t*Ii-o*hi+p*Xt)*fi,i[6]=(he*Je-de*kt-Le*Be)*fi,i[7]=(B*kt-$*Je+se*Be)*fi,i[8]=(_*Ei-l*hi+D*Ht)*fi,i[9]=(r*hi-t*Ei-p*Ht)*fi,i[10]=(de*Et-Ae*Je+Le*$e)*fi,i[11]=(j*Je-B*Et-se*$e)*fi,i[12]=(l*Xt-_*di-M*Ht)*fi,i[13]=(t*di-r*Xt+o*Ht)*fi,i[14]=(Ae*Be-de*Rt-he*$e)*fi,i[15]=(B*Rt-j*Be+$*$e)*fi,i):null}function qL(i){const e=i[0],t=i[1],r=i[2],o=i[3],p=i[4],_=i[5],l=i[6],M=i[7],D=i[8],B=i[9],j=i[10],$=i[11],se=i[12],de=i[13],Ae=i[14],he=i[15],Le=e*_-t*p,$e=e*l-r*p,Be=t*l-r*_,Je=D*de-B*se,Rt=D*Ae-j*se,Et=B*Ae-j*de,kt=e*Et-t*Rt+r*Je,Ht=p*Et-_*Rt+l*Je,Xt=D*Be-B*$e+j*Le,hi=se*Be-de*$e+Ae*Le;return M*kt-o*Ht+he*Xt-$*hi}function y_(i,e,t){const r=e[0],o=e[1],p=e[2],_=e[3],l=e[4],M=e[5],D=e[6],B=e[7],j=e[8],$=e[9],se=e[10],de=e[11],Ae=e[12],he=e[13],Le=e[14],$e=e[15];let Be=t[0],Je=t[1],Rt=t[2],Et=t[3];return i[0]=Be*r+Je*l+Rt*j+Et*Ae,i[1]=Be*o+Je*M+Rt*$+Et*he,i[2]=Be*p+Je*D+Rt*se+Et*Le,i[3]=Be*_+Je*B+Rt*de+Et*$e,Be=t[4],Je=t[5],Rt=t[6],Et=t[7],i[4]=Be*r+Je*l+Rt*j+Et*Ae,i[5]=Be*o+Je*M+Rt*$+Et*he,i[6]=Be*p+Je*D+Rt*se+Et*Le,i[7]=Be*_+Je*B+Rt*de+Et*$e,Be=t[8],Je=t[9],Rt=t[10],Et=t[11],i[8]=Be*r+Je*l+Rt*j+Et*Ae,i[9]=Be*o+Je*M+Rt*$+Et*he,i[10]=Be*p+Je*D+Rt*se+Et*Le,i[11]=Be*_+Je*B+Rt*de+Et*$e,Be=t[12],Je=t[13],Rt=t[14],Et=t[15],i[12]=Be*r+Je*l+Rt*j+Et*Ae,i[13]=Be*o+Je*M+Rt*$+Et*he,i[14]=Be*p+Je*D+Rt*se+Et*Le,i[15]=Be*_+Je*B+Rt*de+Et*$e,i}function ux(i,e,t){const r=t[0],o=t[1],p=t[2];let _,l,M,D,B,j,$,se,de,Ae,he,Le;return e===i?(i[12]=e[0]*r+e[4]*o+e[8]*p+e[12],i[13]=e[1]*r+e[5]*o+e[9]*p+e[13],i[14]=e[2]*r+e[6]*o+e[10]*p+e[14],i[15]=e[3]*r+e[7]*o+e[11]*p+e[15]):(_=e[0],l=e[1],M=e[2],D=e[3],B=e[4],j=e[5],$=e[6],se=e[7],de=e[8],Ae=e[9],he=e[10],Le=e[11],i[0]=_,i[1]=l,i[2]=M,i[3]=D,i[4]=B,i[5]=j,i[6]=$,i[7]=se,i[8]=de,i[9]=Ae,i[10]=he,i[11]=Le,i[12]=_*r+B*o+de*p+e[12],i[13]=l*r+j*o+Ae*p+e[13],i[14]=M*r+$*o+he*p+e[14],i[15]=D*r+se*o+Le*p+e[15]),i}function zw(i,e,t){const r=t[0],o=t[1],p=t[2];return i[0]=e[0]*r,i[1]=e[1]*r,i[2]=e[2]*r,i[3]=e[3]*r,i[4]=e[4]*o,i[5]=e[5]*o,i[6]=e[6]*o,i[7]=e[7]*o,i[8]=e[8]*p,i[9]=e[9]*p,i[10]=e[10]*p,i[11]=e[11]*p,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}function YL(i,e,t,r){let o=r[0],p=r[1],_=r[2],l=Math.sqrt(o*o+p*p+_*_),M,D,B,j,$,se,de,Ae,he,Le,$e,Be,Je,Rt,Et,kt,Ht,Xt,hi,di,Ei,Ii,fi,Ui;return l<Cv?null:(l=1/l,o*=l,p*=l,_*=l,D=Math.sin(t),M=Math.cos(t),B=1-M,j=e[0],$=e[1],se=e[2],de=e[3],Ae=e[4],he=e[5],Le=e[6],$e=e[7],Be=e[8],Je=e[9],Rt=e[10],Et=e[11],kt=o*o*B+M,Ht=p*o*B+_*D,Xt=_*o*B-p*D,hi=o*p*B-_*D,di=p*p*B+M,Ei=_*p*B+o*D,Ii=o*_*B+p*D,fi=p*_*B-o*D,Ui=_*_*B+M,i[0]=j*kt+Ae*Ht+Be*Xt,i[1]=$*kt+he*Ht+Je*Xt,i[2]=se*kt+Le*Ht+Rt*Xt,i[3]=de*kt+$e*Ht+Et*Xt,i[4]=j*hi+Ae*di+Be*Ei,i[5]=$*hi+he*di+Je*Ei,i[6]=se*hi+Le*di+Rt*Ei,i[7]=de*hi+$e*di+Et*Ei,i[8]=j*Ii+Ae*fi+Be*Ui,i[9]=$*Ii+he*fi+Je*Ui,i[10]=se*Ii+Le*fi+Rt*Ui,i[11]=de*Ii+$e*fi+Et*Ui,e!==i&&(i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i)}function SM(i,e,t){const r=Math.sin(t),o=Math.cos(t),p=e[4],_=e[5],l=e[6],M=e[7],D=e[8],B=e[9],j=e[10],$=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=p*o+D*r,i[5]=_*o+B*r,i[6]=l*o+j*r,i[7]=M*o+$*r,i[8]=D*o-p*r,i[9]=B*o-_*r,i[10]=j*o-l*r,i[11]=$*o-M*r,i}function JL(i,e,t){const r=Math.sin(t),o=Math.cos(t),p=e[0],_=e[1],l=e[2],M=e[3],D=e[8],B=e[9],j=e[10],$=e[11];return e!==i&&(i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=p*o-D*r,i[1]=_*o-B*r,i[2]=l*o-j*r,i[3]=M*o-$*r,i[8]=p*r+D*o,i[9]=_*r+B*o,i[10]=l*r+j*o,i[11]=M*r+$*o,i}function EM(i,e,t){const r=Math.sin(t),o=Math.cos(t),p=e[0],_=e[1],l=e[2],M=e[3],D=e[4],B=e[5],j=e[6],$=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=p*o+D*r,i[1]=_*o+B*r,i[2]=l*o+j*r,i[3]=M*o+$*r,i[4]=D*o-p*r,i[5]=B*o-_*r,i[6]=j*o-l*r,i[7]=$*o-M*r,i}function QL(i,e){const t=e[0],r=e[1],o=e[2],p=e[3],_=t+t,l=r+r,M=o+o,D=t*_,B=r*_,j=r*l,$=o*_,se=o*l,de=o*M,Ae=p*_,he=p*l,Le=p*M;return i[0]=1-j-de,i[1]=B+Le,i[2]=$-he,i[3]=0,i[4]=B-Le,i[5]=1-D-de,i[6]=se+Ae,i[7]=0,i[8]=$+he,i[9]=se-Ae,i[10]=1-D-j,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function KL(i,e,t,r,o,p,_){const l=1/(t-e),M=1/(o-r),D=1/(p-_);return i[0]=p*2*l,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=p*2*M,i[6]=0,i[7]=0,i[8]=(t+e)*l,i[9]=(o+r)*M,i[10]=(_+p)*D,i[11]=-1,i[12]=0,i[13]=0,i[14]=_*p*2*D,i[15]=0,i}function eU(i,e,t,r,o){const p=1/Math.tan(e/2);if(i[0]=p/t,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=p,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,o!=null&&o!==1/0){const _=1/(r-o);i[10]=(o+r)*_,i[14]=2*o*r*_}else i[10]=-1,i[14]=-2*r;return i}const tU=eU;function iU(i,e,t,r,o,p,_){const l=1/(e-t),M=1/(r-o),D=1/(p-_);return i[0]=-2*l,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*M,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*D,i[11]=0,i[12]=(e+t)*l,i[13]=(o+r)*M,i[14]=(_+p)*D,i[15]=1,i}const nU=iU;function rU(i,e,t,r){let o,p,_,l,M,D,B,j,$,se;const de=e[0],Ae=e[1],he=e[2],Le=r[0],$e=r[1],Be=r[2],Je=t[0],Rt=t[1],Et=t[2];return Math.abs(de-Je)<Cv&&Math.abs(Ae-Rt)<Cv&&Math.abs(he-Et)<Cv?HL(i):(j=de-Je,$=Ae-Rt,se=he-Et,o=1/Math.sqrt(j*j+$*$+se*se),j*=o,$*=o,se*=o,p=$e*se-Be*$,_=Be*j-Le*se,l=Le*$-$e*j,o=Math.sqrt(p*p+_*_+l*l),o?(o=1/o,p*=o,_*=o,l*=o):(p=0,_=0,l=0),M=$*l-se*_,D=se*p-j*l,B=j*_-$*p,o=Math.sqrt(M*M+D*D+B*B),o?(o=1/o,M*=o,D*=o,B*=o):(M=0,D=0,B=0),i[0]=p,i[1]=M,i[2]=j,i[3]=0,i[4]=_,i[5]=D,i[6]=$,i[7]=0,i[8]=l,i[9]=B,i[10]=se,i[11]=0,i[12]=-(p*de+_*Ae+l*he),i[13]=-(M*de+D*Ae+B*he),i[14]=-(j*de+$*Ae+se*he),i[15]=1,i)}function sU(){const i=new Ky(4);return Ky!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0,i[3]=0),i}function MM(i,e,t){return i[0]=e[0]*t,i[1]=e[1]*t,i[2]=e[2]*t,i[3]=e[3]*t,i}function r2(i,e,t){const r=e[0],o=e[1],p=e[2],_=e[3];return i[0]=t[0]*r+t[4]*o+t[8]*p+t[12]*_,i[1]=t[1]*r+t[5]*o+t[9]*p+t[13]*_,i[2]=t[2]*r+t[6]*o+t[10]*p+t[14]*_,i[3]=t[3]*r+t[7]*o+t[11]*p+t[15]*_,i}(function(){const i=sU();return function(e,t,r,o,p,_){let l,M;for(t||(t=4),r||(r=0),o?M=Math.min(o*t+r,e.length):M=e.length,l=r;l<M;l+=t)i[0]=e[l],i[1]=e[l+1],i[2]=e[l+2],i[3]=e[l+3],p(i,i,_),e[l]=i[0],e[l+1]=i[1],e[l+2]=i[2],e[l+3]=i[3];return e}})();var OA;(function(i){i[i.COL0ROW0=0]="COL0ROW0",i[i.COL0ROW1=1]="COL0ROW1",i[i.COL0ROW2=2]="COL0ROW2",i[i.COL0ROW3=3]="COL0ROW3",i[i.COL1ROW0=4]="COL1ROW0",i[i.COL1ROW1=5]="COL1ROW1",i[i.COL1ROW2=6]="COL1ROW2",i[i.COL1ROW3=7]="COL1ROW3",i[i.COL2ROW0=8]="COL2ROW0",i[i.COL2ROW1=9]="COL2ROW1",i[i.COL2ROW2=10]="COL2ROW2",i[i.COL2ROW3=11]="COL2ROW3",i[i.COL3ROW0=12]="COL3ROW0",i[i.COL3ROW1=13]="COL3ROW1",i[i.COL3ROW2=14]="COL3ROW2",i[i.COL3ROW3=15]="COL3ROW3"})(OA||(OA={}));const aU=45*Math.PI/180,oU=1,Lb=.1,Ub=500,lU=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class ed extends XL{static get IDENTITY(){return uU()}static get ZERO(){return cU()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return OA}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,t,r,o,p,_,l,M,D,B,j,$,se,de,Ae,he){return this[0]=e,this[1]=t,this[2]=r,this[3]=o,this[4]=p,this[5]=_,this[6]=l,this[7]=M,this[8]=D,this[9]=B,this[10]=j,this[11]=$,this[12]=se,this[13]=de,this[14]=Ae,this[15]=he,this.check()}setRowMajor(e,t,r,o,p,_,l,M,D,B,j,$,se,de,Ae,he){return this[0]=e,this[1]=p,this[2]=D,this[3]=se,this[4]=t,this[5]=_,this[6]=B,this[7]=de,this[8]=r,this[9]=l,this[10]=j,this[11]=Ae,this[12]=o,this[13]=M,this[14]=$,this[15]=he,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(lU)}fromObject(e){return this.check()}fromQuaternion(e){return QL(this,e),this.check()}frustum(e){const{left:t,right:r,bottom:o,top:p,near:_=Lb,far:l=Ub}=e;return l===1/0?hU(this,t,r,o,p,_):KL(this,t,r,o,p,_,l),this.check()}lookAt(e){const{eye:t,center:r=[0,0,0],up:o=[0,1,0]}=e;return rU(this,t,r,o),this.check()}ortho(e){const{left:t,right:r,bottom:o,top:p,near:_=Lb,far:l=Ub}=e;return nU(this,t,r,o,p,_,l),this.check()}orthographic(e){const{fovy:t=aU,aspect:r=oU,focalDistance:o=1,near:p=Lb,far:_=Ub}=e;m4(t);const l=t/2,M=o*Math.tan(l),D=M*r;return this.ortho({left:-D,right:D,bottom:-M,top:M,near:p,far:_})}perspective(e){const{fovy:t=45*Math.PI/180,aspect:r=1,near:o=.1,far:p=500}=e;return m4(t),tU(this,t,r,o,p),this.check()}determinant(){return qL(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const r=this.getScale(t),o=1/r[0],p=1/r[1],_=1/r[2];return e[0]=this[0]*o,e[1]=this[1]*p,e[2]=this[2]*_,e[3]=0,e[4]=this[4]*o,e[5]=this[5]*p,e[6]=this[6]*_,e[7]=0,e[8]=this[8]*o,e[9]=this[9]*p,e[10]=this[10]*_,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const r=this.getScale(t),o=1/r[0],p=1/r[1],_=1/r[2];return e[0]=this[0]*o,e[1]=this[1]*p,e[2]=this[2]*_,e[3]=this[4]*o,e[4]=this[5]*p,e[5]=this[6]*_,e[6]=this[8]*o,e[7]=this[9]*p,e[8]=this[10]*_,e}transpose(){return $L(this,this),this.check()}invert(){return DA(this,this),this.check()}multiplyLeft(e){return y_(this,e,this),this.check()}multiplyRight(e){return y_(this,this,e),this.check()}rotateX(e){return SM(this,this,e),this.check()}rotateY(e){return JL(this,this,e),this.check()}rotateZ(e){return EM(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,t){return YL(this,this,e,t),this.check()}scale(e){return zw(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return ux(this,this,e),this.check()}transform(e,t){return e.length===4?(t=r2(t||[-0,-0,-0,-0],e,this),Nb(t,4),t):this.transformAsPoint(e,t)}transformAsPoint(e,t){const{length:r}=e;let o;switch(r){case 2:o=RL(t||[-0,-0],e,this);break;case 3:o=wM(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Nb(o,e.length),o}transformAsVector(e,t){let r;switch(e.length){case 2:r=CL(t||[-0,-0],e,this);break;case 3:r=AM(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Nb(r,e.length),r}transformPoint(e,t){return this.transformAsPoint(e,t)}transformVector(e,t){return this.transformAsPoint(e,t)}transformDirection(e,t){return this.transformAsVector(e,t)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,t,r){return this.identity().translate([e,t,r])}}let fv,dv;function cU(){return fv||(fv=new ed([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(fv)),fv}function uU(){return dv||(dv=new ed,Object.freeze(dv)),dv}function m4(i){if(i>Math.PI*2)throw Error("expected radians")}function hU(i,e,t,r,o,p){const _=2*p/(t-e),l=2*p/(o-r),M=(t+e)/(t-e),D=(o+r)/(o-r),B=-1,j=-1,$=-2*p;return i[0]=_,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=l,i[6]=0,i[7]=0,i[8]=M,i[9]=D,i[10]=B,i[11]=j,i[12]=0,i[13]=0,i[14]=$,i[15]=0,i}function RM(i,e=[],t=0){const r=Math.fround(i),o=i-r;return e[t]=r,e[t+1]=o,e}function fU(i){return i-Math.fround(i)}function dU(i){const e=new Float32Array(32);for(let t=0;t<4;++t)for(let r=0;r<4;++r){const o=t*4+r;RM(i[r*4+t],e,o*2)}return e}const pU=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND

// All these functions are for substituting tan() function from Intel GPU only
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }

    // 2pi range reduction
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,gU={name:"fp32",vs:pU},mU=`
uniform fp64arithmeticUniforms {
  uniform float ONE;
} fp64;

/*
About LUMA_FP64_CODE_ELIMINATION_WORKAROUND

The purpose of this workaround is to prevent shader compilers from
optimizing away necessary arithmetic operations by swapping their sequences
or transform the equation to some 'equivalent' form.

The method is to multiply an artifical variable, ONE, which will be known to
the compiler to be 1 only at runtime. The whole expression is then represented
as a polynomial with respective to ONE. In the coefficients of all terms, only one a
and one b should appear

err = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE
*/

// Divide float number to high and low floats to extend fraction bits
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * fp64.ONE - (t - a);
  float a_lo = a * fp64.ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}

// Divide float number again when high float uses too many fraction bits
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}

// Special sum operation when a > b
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * fp64.ONE;
  float err = b - (sum - a) * fp64.ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}

// General sum operation
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *
    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  // y component is for the error
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,_U={ONE:1},yU={name:"fp64arithmetic",vs:mU,defaultUniforms:_U,uniformTypes:{ONE:"f32"},fp64ify:RM,fp64LowPart:fU,fp64ifyMatrix4:dU},vU=[0,1,1,1],xU=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

out vec4 picking_vRGBcolor_Avalid;

// Normalize unsigned byte color to 0-1 range
vec3 picking_normalizeColor(vec3 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

// Normalize unsigned byte color to 0-1 range
vec4 picking_normalizeColor(vec4 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

bool picking_isColorZero(vec3 color) {
  return dot(color, vec3(1.0)) < 0.00001;
}

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.00001;
}

// Check if this vertex is highlighted 
bool isVertexHighlighted(vec3 vertexColor) {
  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
  return
    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}

// Set the current picking color
void picking_setPickingColor(vec3 pickingColor) {
  pickingColor = picking_normalizeColor(pickingColor);

  if (bool(picking.isActive)) {
    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!bool(picking.isAttribute)) {
      // Stores the picking color so that the fragment shader can render it during picking
      picking_vRGBcolor_Avalid.rgb = pickingColor;
    }
  } else {
    // Do the comparison with selected item color in vertex shader as it should mean fewer compares
    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.r = value;
  }
}

void picking_setPickingAttribute(vec2 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}

void picking_setPickingAttribute(vec3 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,bU=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

in vec4 picking_vRGBcolor_Avalid;

/*
 * Returns highlight color if this item is selected.
 */
vec4 picking_filterHighlightColor(vec4 color) {
  // If we are still picking, we don't highlight
  if (picking.isActive > 0.5) {
    return color;
  }

  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    // Blend in highlight color based on its alpha value
    float highLightAlpha = picking.highlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 picking_filterPickingColor(vec4 color) {
  if (bool(picking.isActive)) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 picking_filterColor(vec4 color) {
  vec4 highlightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highlightColor);
}
`,_4={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:vU},vs:xU,fs:bU,getUniforms:AU};function AU(i={},e){const t={};if(i.highlightedObjectColor!==void 0)if(i.highlightedObjectColor===null)t.isHighlightActive=!1;else{t.isHighlightActive=!0;const r=i.highlightedObjectColor.slice(0,3);t.highlightedObjectColor=r}if(i.highlightColor){const r=Array.from(i.highlightColor,o=>o/255);Number.isFinite(r[3])||(r[3]=1),t.highlightColor=r}return i.isActive!==void 0&&(t.isActive=!!i.isActive,t.isAttribute=!!i.isAttribute),i.useFloatColors!==void 0&&(t.useFloatColors=!!i.useFloatColors),t}const y4=`precision highp int;

// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  vec3 color;
};

struct PointLight {
  vec3 color;
  vec3 position;
  vec3 attenuation; // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform lightingUniforms {
  int enabled;
  int lightType;

  int directionalLightCount;
  int pointLightCount;

  vec3 ambientColor;

  vec3 lightColor0;
  vec3 lightPosition0;
  vec3 lightDirection0;
  vec3 lightAttenuation0;

  vec3 lightColor1;
  vec3 lightPosition1;
  vec3 lightDirection1;
  vec3 lightAttenuation1;

  vec3 lightColor2;
  vec3 lightPosition2;
  vec3 lightDirection2;
  vec3 lightAttenuation2;
} lighting;

PointLight lighting_getPointLight(int index) {
  switch (index) {
    case 0:
      return PointLight(lighting.lightColor0, lighting.lightPosition0, lighting.lightAttenuation0);
    case 1:
      return PointLight(lighting.lightColor1, lighting.lightPosition1, lighting.lightAttenuation1);
    case 2:
    default:  
      return PointLight(lighting.lightColor2, lighting.lightPosition2, lighting.lightAttenuation2);
  }
}

DirectionalLight lighting_getDirectionalLight(int index) {
  switch (index) {
    case 0:
      return DirectionalLight(lighting.lightColor0, lighting.lightDirection0);
    case 1:
      return DirectionalLight(lighting.lightColor1, lighting.lightDirection1);
    case 2:
    default:   
      return DirectionalLight(lighting.lightColor2, lighting.lightDirection2);
  }
} 

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

// #endif
`,wU=`// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  color: vec3<f32>,
};

struct PointLight {
  color: vec3<f32>,
  position: vec3<f32>,
  attenuation: vec3<f32>, // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  color: vec3<f32>,
  direction: vec3<f32>,
};

struct lightingUniforms {
  enabled: i32,
  pointLightCount: i32,
  directionalLightCount: i32,

  ambientColor: vec3<f32>,

  // TODO - support multiple lights by uncommenting arrays below
  lightType: i32,
  lightColor: vec3<f32>,
  lightDirection: vec3<f32>,
  lightPosition: vec3<f32>,
  lightAttenuation: vec3<f32>,

  // AmbientLight ambientLight;
  // PointLight pointLight[MAX_LIGHTS];
  // DirectionalLight directionalLight[MAX_LIGHTS];
};

// Binding 0:1 is reserved for lighting (Note: could go into separate bind group as it is stable across draw calls)
@binding(1) @group(0) var<uniform> lighting : lightingUniforms;

fn lighting_getPointLight(index: i32) -> PointLight {
  return PointLight(lighting.lightColor, lighting.lightPosition, lighting.lightAttenuation);
}

fn lighting_getDirectionalLight(index: i32) -> DirectionalLight {
  return DirectionalLight(lighting.lightColor, lighting.lightDirection);
} 

fn getPointLightAttenuation(pointLight: PointLight, distance: f32) -> f32 {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}
`,TU=5,SU=255;var m1;(function(i){i[i.POINT=0]="POINT",i[i.DIRECTIONAL=1]="DIRECTIONAL"})(m1||(m1={}));const Pv={props:{},uniforms:{},name:"lighting",defines:{},uniformTypes:{enabled:"i32",lightType:"i32",directionalLightCount:"i32",pointLightCount:"i32",ambientColor:"vec3<f32>",lightColor0:"vec3<f32>",lightPosition0:"vec3<f32>",lightDirection0:"vec3<f32>",lightAttenuation0:"vec3<f32>",lightColor1:"vec3<f32>",lightPosition1:"vec3<f32>",lightDirection1:"vec3<f32>",lightAttenuation1:"vec3<f32>",lightColor2:"vec3<f32>",lightPosition2:"vec3<f32>",lightDirection2:"vec3<f32>",lightAttenuation2:"vec3<f32>"},defaultUniforms:{enabled:1,lightType:m1.POINT,directionalLightCount:0,pointLightCount:0,ambientColor:[.1,.1,.1],lightColor0:[1,1,1],lightPosition0:[1,1,2],lightDirection0:[1,1,1],lightAttenuation0:[1,0,0],lightColor1:[1,1,1],lightPosition1:[1,1,2],lightDirection1:[1,1,1],lightAttenuation1:[1,0,0],lightColor2:[1,1,1],lightPosition2:[1,1,2],lightDirection2:[1,1,1],lightAttenuation2:[1,0,0]},source:wU,vs:y4,fs:y4,getUniforms:EU};function EU(i,e={}){if(i=i&&{...i},!i)return{...Pv.defaultUniforms};i.lights&&(i={...i,...RU(i.lights),lights:void 0});const{ambientLight:t,pointLights:r,directionalLights:o}=i||{};if(!(t||r&&r.length>0||o&&o.length>0))return{...Pv.defaultUniforms,enabled:0};const _={...Pv.defaultUniforms,...e,...MU({ambientLight:t,pointLights:r,directionalLights:o})};return i.enabled!==void 0&&(_.enabled=i.enabled?1:0),_}function MU({ambientLight:i,pointLights:e=[],directionalLights:t=[]}){const r={};r.ambientColor=Vb(i);let o=0;for(const p of e){r.lightType=m1.POINT;const _=o;r[`lightColor${_}`]=Vb(p),r[`lightPosition${_}`]=p.position,r[`lightAttenuation${_}`]=p.attenuation||[1,0,0],o++}for(const p of t){r.lightType=m1.DIRECTIONAL;const _=o;r[`lightColor${_}`]=Vb(p),r[`lightDirection${_}`]=p.direction,o++}return o>TU&&ni.warn("MAX_LIGHTS exceeded")(),r.directionalLightCount=t.length,r.pointLightCount=e.length,r}function RU(i){var t,r;const e={pointLights:[],directionalLights:[]};for(const o of i||[])switch(o.type){case"ambient":e.ambientLight=o;break;case"directional":(t=e.directionalLights)==null||t.push(o);break;case"point":(r=e.pointLights)==null||r.push(o);break}return e}function Vb(i={}){const{color:e=[0,0,0],intensity:t=1}=i;return e.map(r=>r*t/SU)}const CU=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;
`,PU=`#define MAX_LIGHTS 3

uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
  vec3 halfway_direction = normalize(light_direction + view_direction);
  float lambertian = dot(light_direction, normal_worldspace);
  float specular = 0.0;
  if (lambertian > 0.0) {
    float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, material.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  vec3 view_direction = normalize(cameraPosition - position_worldspace);
  lightColor = material.ambient * surfaceColor * lighting.ambientColor;

  for (int i = 0; i < lighting.pointLightCount; i++) {
    PointLight pointLight = lighting_getPointLight(i);
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    float light_attenuation = getPointLightAttenuation(pointLight, distance(light_position_worldspace, position_worldspace));
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color / light_attenuation);
  }

  int totalLights = min(MAX_LIGHTS, lighting.pointLightCount + lighting.directionalLightCount);
  for (int i = lighting.pointLightCount; i < totalLights; i++) {
    DirectionalLight directionalLight = lighting_getDirectionalLight(i);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
}
`,IU=`struct phongMaterialUniforms {
  ambient: f32,
  diffuse: f32,
  shininess: f32,
  specularColor: vec3<f32>,
};

@binding(2) @group(0) var<uniform> phongMaterial : phongMaterialUniforms;

fn lighting_getLightColor(surfaceColor: vec3<f32>, light_direction: vec3<f32>, view_direction: vec3<f32>, normal_worldspace: vec3<f32>, color: vec3<f32>) -> vec3<f32> {
  let halfway_direction: vec3<f32> = normalize(light_direction + view_direction);
  var lambertian: f32 = dot(light_direction, normal_worldspace);
  var specular: f32 = 0.0;
  if (lambertian > 0.0) {
    let specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, phongMaterial.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * phongMaterial.diffuse * surfaceColor + specular * phongMaterial.specularColor) * color;
}

fn lighting_getLightColor2(surfaceColor: vec3<f32>, cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32> {
  var lightColor: vec3<f32> = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  let view_direction: vec3<f32> = normalize(cameraPosition - position_worldspace);
  lightColor = phongMaterial.ambient * surfaceColor * lighting.ambientColor;

  if (lighting.lightType == 0) {
    let pointLight: PointLight  = lighting_getPointLight(0);
    let light_position_worldspace: vec3<f32> = pointLight.position;
    let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  } else if (lighting.lightType == 1) {
    var directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
  /*
  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.pointLightCount) {
      break;
    }
    PointLight pointLight = lighting.pointLight[i];
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  }

  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.directionalLightCount) {
      break;
    }
    DirectionalLight directionalLight = lighting.directionalLight[i];
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  */
}

fn lighting_getSpecularLightColor(cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32>{
  var lightColor = vec3<f32>(0, 0, 0);
  let surfaceColor = vec3<f32>(0, 0, 0);

  if (lighting.enabled == 0) {
    let view_direction = normalize(cameraPosition - position_worldspace);

    switch (lighting.lightType) {
      case 0, default: {
        let pointLight: PointLight = lighting_getPointLight(0);
        let light_position_worldspace: vec3<f32> = pointLight.position;
        let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
        lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
      }
      case 1: {
        let directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
        lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
      }
    }
  }
  return lightColor;
}
`,CM={props:{},name:"gouraudMaterial",vs:PU.replace("phongMaterial","gouraudMaterial"),fs:CU.replace("phongMaterial","gouraudMaterial"),source:IU.replaceAll("phongMaterial","gouraudMaterial"),defines:{LIGHTING_VERTEX:!0},dependencies:[Pv],uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(i){const e={...i};return e.specularColor&&(e.specularColor=e.specularColor.map(t=>t/255)),{...CM.defaultUniforms,...e}}},v4=`uniform layerUniforms {
  uniform float opacity;
} layer;
`,kU={name:"layer",vs:v4,fs:v4,getUniforms:i=>({opacity:Math.pow(i.opacity,1/2.2)}),uniformTypes:{opacity:"f32"}},DU=`

struct ColorUniforms {
  opacity: f32,
};

var<private> color: ColorUniforms = ColorUniforms(1.0);
// TODO (kaapp) avoiding binding index collisions to handle layer opacity 
// requires some thought.
// @group(0) @binding(0) var<uniform> color: ColorUniforms;

@must_use
fn deckgl_premultiplied_alpha(fragColor: vec4<f32>) -> vec4<f32> {
    return vec4(fragColor.rgb * fragColor.a, fragColor.a); 
};
`,Lw={name:"color",dependencies:[],source:DU,getUniforms:i=>({}),uniformTypes:{opacity:"f32"}},OU=`const SMOOTH_EDGE_RADIUS: f32 = 0.5;

struct VertexGeometry {
  position: vec4<f32>,
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

var<private> geometry_: VertexGeometry = VertexGeometry(
  vec4<f32>(0.0, 0.0, 1.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec2<f32>(0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0)
);

struct FragmentGeometry {
  uv: vec2<f32>,
};

var<private> fragmentGeometry: FragmentGeometry;

fn smoothedge(edge: f32, x: f32) -> f32 {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,PM="#define SMOOTH_EDGE_RADIUS 0.5",FU=`${PM}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,NU=`${PM}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,IM={name:"geometry",source:OU,vs:FU,fs:NU},BU=25;var ro;(function(i){i[i.Start=1]="Start",i[i.Move=2]="Move",i[i.End=4]="End",i[i.Cancel=8]="Cancel"})(ro||(ro={}));var Ro;(function(i){i[i.None=0]="None",i[i.Left=1]="Left",i[i.Right=2]="Right",i[i.Up=4]="Up",i[i.Down=8]="Down",i[i.Horizontal=3]="Horizontal",i[i.Vertical=12]="Vertical",i[i.All=15]="All"})(Ro||(Ro={}));var Sn;(function(i){i[i.Possible=1]="Possible",i[i.Began=2]="Began",i[i.Changed=4]="Changed",i[i.Ended=8]="Ended",i[i.Recognized=8]="Recognized",i[i.Cancelled=16]="Cancelled",i[i.Failed=32]="Failed"})(Sn||(Sn={}));const zU="compute",LU="auto",FA="manipulation",Iv="none",NA="pan-x",BA="pan-y";function UU(i){if(i.includes(Iv))return Iv;const e=i.includes(NA),t=i.includes(BA);return e&&t?Iv:e||t?e?NA:BA:i.includes(FA)?FA:LU}class VU{constructor(e,t){this.actions="",this.manager=e,this.set(t)}set(e){e===zU&&(e=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=e,this.actions=e)}update(){this.set(this.manager.options.touchAction)}compute(){let e=[];for(const t of this.manager.recognizers)t.options.enable&&(e=e.concat(t.getTouchAction()));return UU(e.join(" "))}}function hx(i){return i.trim().split(/\s+/g)}function jb(i,e,t){if(i)for(const r of hx(e))i.addEventListener(r,t,!1)}function Gb(i,e,t){if(i)for(const r of hx(e))i.removeEventListener(r,t,!1)}function x4(i){return(i.ownerDocument||i).defaultView}function jU(i,e){let t=i;for(;t;){if(t===e)return!0;t=t.parentNode}return!1}function kM(i){const e=i.length;if(e===1)return{x:Math.round(i[0].clientX),y:Math.round(i[0].clientY)};let t=0,r=0,o=0;for(;o<e;)t+=i[o].clientX,r+=i[o].clientY,o++;return{x:Math.round(t/e),y:Math.round(r/e)}}function b4(i){const e=[];let t=0;for(;t<i.pointers.length;)e[t]={clientX:Math.round(i.pointers[t].clientX),clientY:Math.round(i.pointers[t].clientY)},t++;return{timeStamp:Date.now(),pointers:e,center:kM(e),deltaX:i.deltaX,deltaY:i.deltaY}}function DM(i,e){const t=e.x-i.x,r=e.y-i.y;return Math.sqrt(t*t+r*r)}function A4(i,e){const t=e.clientX-i.clientX,r=e.clientY-i.clientY;return Math.sqrt(t*t+r*r)}function GU(i,e){const t=e.x-i.x,r=e.y-i.y;return Math.atan2(r,t)*180/Math.PI}function w4(i,e){const t=e.clientX-i.clientX,r=e.clientY-i.clientY;return Math.atan2(r,t)*180/Math.PI}function OM(i,e){return i===e?Ro.None:Math.abs(i)>=Math.abs(e)?i<0?Ro.Left:Ro.Right:e<0?Ro.Up:Ro.Down}function WU(i,e){const t=e.center;let r=i.offsetDelta,o=i.prevDelta;const p=i.prevInput;return(e.eventType===ro.Start||(p==null?void 0:p.eventType)===ro.End)&&(o=i.prevDelta={x:(p==null?void 0:p.deltaX)||0,y:(p==null?void 0:p.deltaY)||0},r=i.offsetDelta={x:t.x,y:t.y}),{deltaX:o.x+(t.x-r.x),deltaY:o.y+(t.y-r.y)}}function FM(i,e,t){return{x:e/i||0,y:t/i||0}}function ZU(i,e){return A4(e[0],e[1])/A4(i[0],i[1])}function XU(i,e){return w4(e[1],e[0])-w4(i[1],i[0])}function HU(i,e){const t=i.lastInterval||e,r=e.timeStamp-t.timeStamp;let o,p,_,l;if(e.eventType!==ro.Cancel&&(r>BU||t.velocity===void 0)){const M=e.deltaX-t.deltaX,D=e.deltaY-t.deltaY,B=FM(r,M,D);p=B.x,_=B.y,o=Math.abs(B.x)>Math.abs(B.y)?B.x:B.y,l=OM(M,D),i.lastInterval=e}else o=t.velocity,p=t.velocityX,_=t.velocityY,l=t.direction;e.velocity=o,e.velocityX=p,e.velocityY=_,e.direction=l}function $U(i,e){const{session:t}=i,{pointers:r}=e,{length:o}=r;t.firstInput||(t.firstInput=b4(e)),o>1&&!t.firstMultiple?t.firstMultiple=b4(e):o===1&&(t.firstMultiple=!1);const{firstInput:p,firstMultiple:_}=t,l=_?_.center:p.center,M=e.center=kM(r);e.timeStamp=Date.now(),e.deltaTime=e.timeStamp-p.timeStamp,e.angle=GU(l,M),e.distance=DM(l,M);const{deltaX:D,deltaY:B}=WU(t,e);e.deltaX=D,e.deltaY=B,e.offsetDirection=OM(e.deltaX,e.deltaY);const j=FM(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=j.x,e.overallVelocityY=j.y,e.overallVelocity=Math.abs(j.x)>Math.abs(j.y)?j.x:j.y,e.scale=_?ZU(_.pointers,r):1,e.rotation=_?XU(_.pointers,r):0,e.maxPointers=t.prevInput?e.pointers.length>t.prevInput.maxPointers?e.pointers.length:t.prevInput.maxPointers:e.pointers.length;let $=i.element;return jU(e.srcEvent.target,$)&&($=e.srcEvent.target),e.target=$,HU(t,e),e}function qU(i,e,t){const r=t.pointers.length,o=t.changedPointers.length,p=e&ro.Start&&r-o===0,_=e&(ro.End|ro.Cancel)&&r-o===0;t.isFirst=!!p,t.isFinal=!!_,p&&(i.session={}),t.eventType=e;const l=$U(i,t);i.emit("hammer.input",l),i.recognize(l),i.session.prevInput=l}let YU=class{constructor(e){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=t=>{this.manager.options.enable&&this.handler(t)},this.manager=e,this.element=e.element,this.target=e.options.inputTarget||e.element}callback(e,t){qU(this.manager,e,t)}init(){jb(this.element,this.evEl,this.domHandler),jb(this.target,this.evTarget,this.domHandler),jb(x4(this.element),this.evWin,this.domHandler)}destroy(){Gb(this.element,this.evEl,this.domHandler),Gb(this.target,this.evTarget,this.domHandler),Gb(x4(this.element),this.evWin,this.domHandler)}};const JU={pointerdown:ro.Start,pointermove:ro.Move,pointerup:ro.End,pointercancel:ro.Cancel,pointerout:ro.Cancel},QU="pointerdown",KU="pointermove pointerup pointercancel";class e9 extends YU{constructor(e){super(e),this.evEl=QU,this.evWin=KU,this.store=this.manager.session.pointerEvents=[],this.init()}handler(e){const{store:t}=this;let r=!1;const o=JU[e.type],p=e.pointerType,_=p==="touch";let l=t.findIndex(M=>M.pointerId===e.pointerId);o&ro.Start&&(e.buttons||_)?l<0&&(t.push(e),l=t.length-1):o&(ro.End|ro.Cancel)&&(r=!0),!(l<0)&&(t[l]=e,this.callback(o,{pointers:t,changedPointers:[e],eventType:o,pointerType:p,srcEvent:e}),r&&t.splice(l,1))}}const t9=["","webkit","Moz","MS","ms","o"];function i9(i,e){const t=e[0].toUpperCase()+e.slice(1);for(const r of t9){const o=r?r+t:e;if(o in i)return o}}const n9=1,T4=2,S4={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}};class r9{constructor(e,t){this.options={...S4,...t,cssProps:{...S4.cssProps,...t.cssProps},inputTarget:t.inputTarget||e},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new e9(this),this.touchAction=new VU(this,this.options.touchAction),this.toggleCssProps(!0)}set(e){return Object.assign(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this}stop(e){this.session.stopped=e?T4:n9}recognize(e){const{session:t}=this;if(t.stopped)return;this.session.prevented&&e.srcEvent.preventDefault();let r;const{recognizers:o}=this;let{curRecognizer:p}=t;(!p||p&&p.state&Sn.Recognized)&&(p=t.curRecognizer=null);let _=0;for(;_<o.length;)r=o[_],t.stopped!==T4&&(!p||r===p||r.canRecognizeWith(p))?r.recognize(e):r.reset(),!p&&r.state&(Sn.Began|Sn.Changed|Sn.Ended)&&(p=t.curRecognizer=r),_++}get(e){const{recognizers:t}=this;for(let r=0;r<t.length;r++)if(t[r].options.event===e)return t[r];return null}add(e){if(Array.isArray(e)){for(const r of e)this.add(r);return this}const t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e}remove(e){if(Array.isArray(e)){for(const r of e)this.remove(r);return this}const t=typeof e=="string"?this.get(e):e;if(t){const{recognizers:r}=this,o=r.indexOf(t);o!==-1&&(r.splice(o,1),this.touchAction.update())}return this}on(e,t){if(!e||!t)return;const{handlers:r}=this;for(const o of hx(e))r[o]=r[o]||[],r[o].push(t)}off(e,t){if(!e)return;const{handlers:r}=this;for(const o of hx(e))t?r[o]&&r[o].splice(r[o].indexOf(t),1):delete r[o]}emit(e,t){const r=this.handlers[e]&&this.handlers[e].slice();if(!r||!r.length)return;const o=t;o.type=e,o.preventDefault=function(){t.srcEvent.preventDefault()};let p=0;for(;p<r.length;)r[p](o),p++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(e){const{element:t}=this;if(t){for(const[r,o]of Object.entries(this.options.cssProps)){const p=i9(t.style,r);e?(this.oldCssProps[p]=t.style[p],t.style[p]=o):t.style[p]=this.oldCssProps[p]||""}e||(this.oldCssProps={})}}}let s9=1;function a9(){return s9++}function E4(i){return i&Sn.Cancelled?"cancel":i&Sn.Ended?"end":i&Sn.Changed?"move":i&Sn.Began?"start":""}class NM{constructor(e){this.options=e,this.id=a9(),this.state=Sn.Possible,this.simultaneous={},this.requireFail=[]}set(e){return Object.assign(this.options,e),this.manager.touchAction.update(),this}recognizeWith(e){if(Array.isArray(e)){for(const o of e)this.recognizeWith(o);return this}let t;if(typeof e=="string"){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{simultaneous:r}=this;return r[t.id]||(r[t.id]=t,t.recognizeWith(this)),this}dropRecognizeWith(e){if(Array.isArray(e)){for(const r of e)this.dropRecognizeWith(r);return this}let t;return typeof e=="string"?t=this.manager.get(e):t=e,t&&delete this.simultaneous[t.id],this}requireFailure(e){if(Array.isArray(e)){for(const o of e)this.requireFailure(o);return this}let t;if(typeof e=="string"){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{requireFail:r}=this;return r.indexOf(t)===-1&&(r.push(t),t.requireFailure(this)),this}dropRequireFailure(e){if(Array.isArray(e)){for(const r of e)this.dropRequireFailure(r);return this}let t;if(typeof e=="string"?t=this.manager.get(e):t=e,t){const r=this.requireFail.indexOf(t);r>-1&&this.requireFail.splice(r,1)}return this}hasRequireFailures(){return!!this.requireFail.find(e=>e.options.enable)}canRecognizeWith(e){return!!this.simultaneous[e.id]}emit(e){if(!e)return;const{state:t}=this;t<Sn.Ended&&this.manager.emit(this.options.event+E4(t),e),this.manager.emit(this.options.event,e),e.additionalEvent&&this.manager.emit(e.additionalEvent,e),t>=Sn.Ended&&this.manager.emit(this.options.event+E4(t),e)}tryEmit(e){this.canEmit()?this.emit(e):this.state=Sn.Failed}canEmit(){let e=0;for(;e<this.requireFail.length;){if(!(this.requireFail[e].state&(Sn.Failed|Sn.Possible)))return!1;e++}return!0}recognize(e){const t={...e};if(!this.options.enable){this.reset(),this.state=Sn.Failed;return}this.state&(Sn.Recognized|Sn.Cancelled|Sn.Failed)&&(this.state=Sn.Possible),this.state=this.process(t),this.state&(Sn.Began|Sn.Changed|Sn.Ended|Sn.Cancelled)&&this.tryEmit(t)}getEventNames(){return[this.options.event]}reset(){}}class BM extends NM{attrTest(e){const t=this.options.pointers;return t===0||e.pointers.length===t}process(e){const{state:t}=this,{eventType:r}=e,o=t&(Sn.Began|Sn.Changed),p=this.attrTest(e);return o&&(r&ro.Cancel||!p)?t|Sn.Cancelled:o||p?r&ro.End?t|Sn.Ended:t&Sn.Began?t|Sn.Changed:Sn.Began:Sn.Failed}}class M4 extends NM{constructor(e={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...e}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[FA]}process(e){const{options:t}=this,r=e.pointers.length===t.pointers,o=e.distance<t.threshold,p=e.deltaTime<t.time;if(this.reset(),e.eventType&ro.Start&&this.count===0)return this.failTimeout();if(o&&p&&r){if(e.eventType!==ro.End)return this.failTimeout();const _=this.pTime?e.timeStamp-this.pTime<t.interval:!0,l=!this.pCenter||DM(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,!l||!_?this.count=1:this.count+=1,this._input=e,this.count%t.taps===0)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=Sn.Recognized,this.tryEmit(this._input)},t.interval),Sn.Began):Sn.Recognized}return Sn.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=Sn.Failed},this.options.interval),Sn.Failed}reset(){clearTimeout(this._timer)}emit(e){this.state===Sn.Recognized&&(e.tapCount=this.count,this.manager.emit(this.options.event,e))}}const o9=["","start","move","end","cancel","up","down","left","right"];class R4 extends BM{constructor(e={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:Ro.All,...e}),this.pX=null,this.pY=null}getTouchAction(){const{options:{direction:e}}=this,t=[];return e&Ro.Horizontal&&t.push(BA),e&Ro.Vertical&&t.push(NA),t}getEventNames(){return o9.map(e=>this.options.event+e)}directionTest(e){const{options:t}=this;let r=!0,{distance:o}=e,{direction:p}=e;const _=e.deltaX,l=e.deltaY;return p&t.direction||(t.direction&Ro.Horizontal?(p=_===0?Ro.None:_<0?Ro.Left:Ro.Right,r=_!==this.pX,o=Math.abs(e.deltaX)):(p=l===0?Ro.None:l<0?Ro.Up:Ro.Down,r=l!==this.pY,o=Math.abs(e.deltaY))),e.direction=p,r&&o>t.threshold&&!!(p&t.direction)}attrTest(e){return super.attrTest(e)&&(!!(this.state&Sn.Began)||!(this.state&Sn.Began)&&this.directionTest(e))}emit(e){this.pX=e.deltaX,this.pY=e.deltaY;const t=Ro[e.direction].toLowerCase();t&&(e.additionalEvent=this.options.event+t),super.emit(e)}}const l9=["","start","move","end","cancel","in","out"];class c9 extends BM{constructor(e={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...e})}getTouchAction(){return[Iv]}getEventNames(){return l9.map(e=>this.options.event+e)}attrTest(e){return super.attrTest(e)&&(Math.abs(e.scale-1)>this.options.threshold||!!(this.state&Sn.Began))}emit(e){if(e.scale!==1){const t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}super.emit(e)}}class Nx{constructor(e,t,r){this.element=e,this.callback=t,this.options=r}}const u9=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",h9=u9.indexOf("firefox")!==-1,C4=4.000244140625,f9=40,d9=.25;class p9 extends Nx{constructor(e,t,r){super(e,t,{enable:!0,...r}),this.handleEvent=o=>{if(!this.options.enable)return;let p=o.deltaY;globalThis.WheelEvent&&(h9&&o.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(p/=globalThis.devicePixelRatio),o.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(p*=f9)),p!==0&&p%C4===0&&(p=Math.floor(p/C4)),o.shiftKey&&p&&(p=p*d9),this.callback({type:"wheel",center:{x:o.clientX,y:o.clientY},delta:-p,srcEvent:o,pointerType:"mouse",target:o.target})},e.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(e,t){e==="wheel"&&(this.options.enable=t)}}const P4=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"];class g9 extends Nx{constructor(e,t,r){super(e,t,{enable:!0,...r}),this.handleEvent=p=>{this.handleOverEvent(p),this.handleOutEvent(p),this.handleEnterEvent(p),this.handleLeaveEvent(p),this.handleMoveEvent(p)},this.pressed=!1;const{enable:o}=this.options;this.enableMoveEvent=o,this.enableLeaveEvent=o,this.enableEnterEvent=o,this.enableOutEvent=o,this.enableOverEvent=o,P4.forEach(p=>e.addEventListener(p,this.handleEvent))}destroy(){P4.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){switch(e){case"pointermove":this.enableMoveEvent=t;break;case"pointerover":this.enableOverEvent=t;break;case"pointerout":this.enableOutEvent=t;break;case"pointerenter":this.enableEnterEvent=t;break;case"pointerleave":this.enableLeaveEvent=t;break}}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit("pointerover",e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit("pointerout",e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit("pointerenter",e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit("pointerleave",e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit("pointermove",e);break;case"mouseup":this.pressed=!1;break}}_emit(e,t){this.callback({type:e,center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})}}const I4=["keydown","keyup"];class m9 extends Nx{constructor(e,t,r){super(e,t,{enable:!0,tabIndex:0,...r}),this.handleEvent=o=>{const p=o.target||o.srcElement;p.tagName==="INPUT"&&p.type==="text"||p.tagName==="TEXTAREA"||(this.enableDownEvent&&o.type==="keydown"&&this.callback({type:"keydown",srcEvent:o,key:o.key,target:o.target}),this.enableUpEvent&&o.type==="keyup"&&this.callback({type:"keyup",srcEvent:o,key:o.key,target:o.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,e.tabIndex=this.options.tabIndex,e.style.outline="none",I4.forEach(o=>e.addEventListener(o,this.handleEvent))}destroy(){I4.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e==="keydown"&&(this.enableDownEvent=t),e==="keyup"&&(this.enableUpEvent=t)}}class _9 extends Nx{constructor(e,t,r){super(e,t,r),this.handleEvent=o=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:o.clientX,y:o.clientY},srcEvent:o,pointerType:"mouse",target:o.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,t){e==="contextmenu"&&(this.options.enable=t)}}const k4=1,zA=2,D4=4,y9={pointerdown:k4,pointermove:zA,pointerup:D4,mousedown:k4,mousemove:zA,mouseup:D4},v9=0,x9=1,b9=2,A9=1,w9=2,T9=4;function S9(i){const e=y9[i.srcEvent.type];if(!e)return null;const{buttons:t,button:r}=i.srcEvent;let o=!1,p=!1,_=!1;return e===zA?(o=!!(t&A9),p=!!(t&T9),_=!!(t&w9)):(o=r===v9,p=r===x9,_=r===b9),{leftButton:o,middleButton:p,rightButton:_}}function E9(i,e){const t=i.center;if(!t)return null;const r=e.getBoundingClientRect(),o=r.width/e.offsetWidth||1,p=r.height/e.offsetHeight||1,_={x:(t.x-r.left-e.clientLeft)/o,y:(t.y-r.top-e.clientTop)/p};return{center:t,offsetCenter:_}}const M9={srcElement:"root",priority:0};class R9{constructor(e,t){this.handleEvent=r=>{if(this.isEmpty())return;const o=this._normalizeEvent(r);let p=r.srcEvent.target;for(;p&&p!==o.rootElement;){if(this._emit(o,p),o.handled)return;p=p.parentNode}this._emit(o,"root")},this.eventManager=e,this.recognizerName=t,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,t,r,o=!1,p=!1){const{handlers:_,handlersByElement:l}=this,M={...M9,...r};let D=l.get(M.srcElement);D||(D=[],l.set(M.srcElement,D));const B={type:e,handler:t,srcElement:M.srcElement,priority:M.priority};o&&(B.once=!0),p&&(B.passive=!0),_.push(B),this._active=this._active||!B.passive;let j=D.length-1;for(;j>=0&&!(D[j].priority>=B.priority);)j--;D.splice(j+1,0,B)}remove(e,t){const{handlers:r,handlersByElement:o}=this;for(let p=r.length-1;p>=0;p--){const _=r[p];if(_.type===e&&_.handler===t){r.splice(p,1);const l=o.get(_.srcElement);l.splice(l.indexOf(_),1),l.length===0&&o.delete(_.srcElement)}}this._active=r.some(p=>!p.passive)}_emit(e,t){const r=this.handlersByElement.get(t);if(r){let o=!1;const p=()=>{e.handled=!0},_=()=>{e.handled=!0,o=!0},l=[];for(let M=0;M<r.length;M++){const{type:D,handler:B,once:j}=r[M];if(B({...e,type:D,stopPropagation:p,stopImmediatePropagation:_}),j&&l.push(r[M]),o)break}for(let M=0;M<l.length;M++){const{type:D,handler:B}=l[M];this.remove(D,B)}}}_normalizeEvent(e){const t=this.eventManager.getElement();return{...e,...S9(e),...E9(e,t),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:t}}}function C9(i){if("recognizer"in i)return i;let e;const t=Array.isArray(i)?[...i]:[i];if(typeof t[0]=="function"){const r=t.shift(),o=t.shift()||{};e=new r(o)}else e=t.shift();return{recognizer:e,recognizeWith:typeof t[0]=="string"?[t[0]]:t[0],requireFailure:typeof t[1]=="string"?[t[1]]:t[1]}}class P9{constructor(e=null,t={}){if(this._onBasicInput=r=>{this.manager.emit(r.srcEvent.type,r)},this._onOtherEvent=r=>{this.manager.emit(r.type,r)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...t},this.events=new Map,this.element=e,!!e){this.manager=new r9(e,this.options);for(const r of this.options.recognizers){const{recognizer:o,recognizeWith:p,requireFailure:_}=C9(r);this.manager.add(o),p&&o.recognizeWith(p),_&&o.requireFailure(_)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new p9(e,this._onOtherEvent,{enable:!1}),this.moveInput=new g9(e,this._onOtherEvent,{enable:!1}),this.keyInput=new m9(e,this._onOtherEvent,{enable:!1,tabIndex:t.tabIndex}),this.contextmenuInput=new _9(e,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(e,t,r){this._addEventHandler(e,t,r,!1)}once(e,t,r){this._addEventHandler(e,t,r,!0)}watch(e,t,r){this._addEventHandler(e,t,r,!1,!0)}off(e,t){this._removeEventHandler(e,t)}_toggleRecognizer(e,t){var p,_,l,M;const{manager:r}=this;if(!r)return;const o=r.get(e);o&&(o.set({enable:t}),r.touchAction.update()),(p=this.wheelInput)==null||p.enableEventType(e,t),(_=this.moveInput)==null||_.enableEventType(e,t),(l=this.keyInput)==null||l.enableEventType(e,t),(M=this.contextmenuInput)==null||M.enableEventType(e,t)}_addEventHandler(e,t,r,o,p){if(typeof e!="string"){r=t;for(const[D,B]of Object.entries(e))this._addEventHandler(D,B,r,o,p);return}const{manager:_,events:l}=this;if(!_)return;let M=l.get(e);if(!M){const D=this._getRecognizerName(e)||e;M=new R9(this,D),l.set(e,M),_&&_.on(e,M.handleEvent)}M.add(e,t,r,o,p),M.isEmpty()||this._toggleRecognizer(M.recognizerName,!0)}_removeEventHandler(e,t){if(typeof e!="string"){for(const[p,_]of Object.entries(e))this._removeEventHandler(p,_);return}const{events:r}=this,o=r.get(e);if(o&&(o.remove(e,t),o.isEmpty())){const{recognizerName:p}=o;let _=!1;for(const l of r.values())if(l.recognizerName===p&&!l.isEmpty()){_=!0;break}_||this._toggleRecognizer(p,!1)}}_getRecognizerName(e){var t;return(t=this.manager.recognizers.find(r=>r.getEventNames().includes(e)))==null?void 0:t.options.event}}const xr={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(xr,"IDENTITY",{get:()=>(Wr.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const ch={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Jg={common:0,meters:1,pixels:2},LA={click:"onClick",dblclick:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},O4={multipan:[R4,{threshold:10,direction:Ro.Vertical,pointers:2}],pinch:[c9,{},null,["multipan"]],pan:[R4,{threshold:1},["pinch"],["multipan"]],dblclick:[M4,{event:"dblclick",taps:2}],click:[M4,{event:"click"},null,["dblclick"]]};function I9(i,e){if(i===e)return!0;if(Array.isArray(i)){const t=i.length;if(!e||e.length!==t)return!1;for(let r=0;r<t;r++)if(i[r]!==e[r])return!1;return!0}return!1}function D1(i){let e={},t;return r=>{for(const o in r)if(!I9(r[o],e[o])){t=i(r),e=r;break}return t}}const F4=[0,0,0,0],k9=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],zM=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],D9=[0,0,0],LM=[0,0,0],O9=D1(B9);function UM(i,e,t=LM){t.length<3&&(t=[t[0],t[1],0]);let r=t,o,p=!0;switch(e===xr.LNGLAT_OFFSETS||e===xr.METER_OFFSETS?o=t:o=i.isGeospatial?[Math.fround(i.longitude),Math.fround(i.latitude),0]:null,i.projectionMode){case ch.WEB_MERCATOR:(e===xr.LNGLAT||e===xr.CARTESIAN)&&(o=[0,0,0],p=!1);break;case ch.WEB_MERCATOR_AUTO_OFFSET:e===xr.LNGLAT?r=o:e===xr.CARTESIAN&&(r=[Math.fround(i.center[0]),Math.fround(i.center[1]),0],o=i.unprojectPosition(r),r[0]-=t[0],r[1]-=t[1],r[2]-=t[2]);break;case ch.IDENTITY:r=i.position.map(Math.fround),r[2]=r[2]||0;break;case ch.GLOBE:p=!1,o=null;break;default:p=!1}return{geospatialOrigin:o,shaderCoordinateOrigin:r,offsetMode:p}}function F9(i,e,t){const{viewMatrixUncentered:r,projectionMatrix:o}=i;let{viewMatrix:p,viewProjectionMatrix:_}=i,l=F4,M=F4,D=i.cameraPosition;const{geospatialOrigin:B,shaderCoordinateOrigin:j,offsetMode:$}=UM(i,e,t);return $&&(M=i.projectPosition(B||j),D=[D[0]-M[0],D[1]-M[1],D[2]-M[2]],M[3]=1,l=r2([],M,_),p=r||p,_=y_([],o,p),_=y_([],_,k9)),{viewMatrix:p,viewProjectionMatrix:_,projectionCenter:l,originCommon:M,cameraPosCommon:D,shaderCoordinateOrigin:j,geospatialOrigin:B}}function N9({viewport:i,devicePixelRatio:e=1,modelMatrix:t=null,coordinateSystem:r=xr.DEFAULT,coordinateOrigin:o=LM,autoWrapLongitude:p=!1}){r===xr.DEFAULT&&(r=i.isGeospatial?xr.LNGLAT:xr.CARTESIAN);const _=O9({viewport:i,devicePixelRatio:e,coordinateSystem:r,coordinateOrigin:o});return _.wrapLongitude=p,_.modelMatrix=t||zM,_}function B9({viewport:i,devicePixelRatio:e,coordinateSystem:t,coordinateOrigin:r}){const{projectionCenter:o,viewProjectionMatrix:p,originCommon:_,cameraPosCommon:l,shaderCoordinateOrigin:M,geospatialOrigin:D}=F9(i,t,r),B=i.getDistanceScales(),j=[i.width*e,i.height*e],$=r2([],[0,0,-i.focalDistance,1],i.projectionMatrix)[3]||1,se={coordinateSystem:t,projectionMode:i.projectionMode,coordinateOrigin:M,commonOrigin:_.slice(0,3),center:o,pseudoMeters:!!i._pseudoMeters,viewportSize:j,devicePixelRatio:e,focalDistance:$,commonUnitsPerMeter:B.unitsPerMeter,commonUnitsPerWorldUnit:B.unitsPerMeter,commonUnitsPerWorldUnit2:D9,scale:i.scale,wrapLongitude:!1,viewProjectionMatrix:p,modelMatrix:zM,cameraPosition:l};if(D){const de=i.getDistanceScales(D);switch(t){case xr.METER_OFFSETS:se.commonUnitsPerWorldUnit=de.unitsPerMeter,se.commonUnitsPerWorldUnit2=de.unitsPerMeter2;break;case xr.LNGLAT:case xr.LNGLAT_OFFSETS:i._pseudoMeters||(se.commonUnitsPerMeter=de.unitsPerMeter),se.commonUnitsPerWorldUnit=de.unitsPerDegree,se.commonUnitsPerWorldUnit2=de.unitsPerDegree2;break;case xr.CARTESIAN:se.commonUnitsPerWorldUnit=[1,1,de.unitsPerMeter[2]],se.commonUnitsPerWorldUnit2=[0,0,de.unitsPerMeter2[2]];break}}return se}const z9=Object.keys(xr).map(i=>`const COORDINATE_SYSTEM_${i}: i32 = ${xr[i]};`).join(""),L9=Object.keys(ch).map(i=>`const PROJECTION_MODE_${i}: i32 = ${ch[i]};`).join(""),U9=Object.keys(Jg).map(i=>`const UNIT_${i.toUpperCase()}: i32 = ${Jg[i]};`).join(""),V9=`${z9}
${L9}
${U9}

const TILE_SIZE: f32 = 512.0;
const PI: f32 = 3.1415926536;
const WORLD_SCALE: f32 = TILE_SIZE / (PI * 2.0);
const ZERO_64_LOW: vec3<f32> = vec3<f32>(0.0, 0.0, 0.0);
const EARTH_RADIUS: f32 = 6370972.0; // meters
const GLOBE_RADIUS: f32 = 256.0;

// -----------------------------------------------------------------------------
// Uniform block (converted from GLSL uniform block)
// -----------------------------------------------------------------------------
struct ProjectUniforms {
  wrapLongitude: i32,
  coordinateSystem: i32,
  commonUnitsPerMeter: vec3<f32>,
  projectionMode: i32,
  scale: f32,
  commonUnitsPerWorldUnit: vec3<f32>,
  commonUnitsPerWorldUnit2: vec3<f32>,
  center: vec4<f32>,
  modelMatrix: mat4x4<f32>,
  viewProjectionMatrix: mat4x4<f32>,
  viewportSize: vec2<f32>,
  devicePixelRatio: f32,
  focalDistance: f32,
  cameraPosition: vec3<f32>,
  coordinateOrigin: vec3<f32>,
  commonOrigin: vec3<f32>,
  pseudoMeters: i32,
};

@group(0) @binding(0)
var<uniform> project: ProjectUniforms;

// -----------------------------------------------------------------------------
// Geometry data
// (In your GLSL code, "geometry" was assumed to be available globally. In WGSL,
// you might supply this via vertex attributes or a uniform. Here we define a
// uniform struct for demonstration.)
// -----------------------------------------------------------------------------

// Structure to carry additional geometry data used by deck.gl filters.
struct Geometry {
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  position: vec4<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

// @group(0) @binding(1)
var<private> geometry: Geometry;
`,j9=`${V9}

// -----------------------------------------------------------------------------
// Functions
// -----------------------------------------------------------------------------

// Returns an adjustment factor for commonUnitsPerMeter
fn _project_size_at_latitude(lat: f32) -> f32 {
  let y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

// Overloaded version: scales a value in meters at a given latitude.
fn _project_size_at_latitude_m(meters: f32, lat: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * _project_size_at_latitude(lat);
}

// Computes a non-linear scale factor based on geometry.
// (Note: This function relies on "geometry" being provided.)
fn project_size() -> f32 {
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
      project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
      project.pseudoMeters == 0) {
    if (geometry.position.w == 0.0) {
      return _project_size_at_latitude(geometry.worldPosition.y);
    }
    let y: f32 = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    let y2 = y * y;
    let y4 = y2 * y2;
    let y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

// Overloads to scale offsets (meters to world units)
fn project_size_float(meters: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * project_size();
}

fn project_size_vec2(meters: vec2<f32>) -> vec2<f32> {
  return meters * project.commonUnitsPerMeter.xy * project_size();
}

fn project_size_vec3(meters: vec3<f32>) -> vec3<f32> {
  return meters * project.commonUnitsPerMeter * project_size();
}

fn project_size_vec4(meters: vec4<f32>) -> vec4<f32> {
  return vec4<f32>(meters.xyz * project.commonUnitsPerMeter, meters.w);
}

// Returns a rotation matrix aligning the zaxis with the given up vector.
fn project_get_orientation_matrix(up: vec3<f32>) -> mat3x3<f32> {
  let uz = normalize(up);
  let ux = select(
    vec3<f32>(1.0, 0.0, 0.0),
    normalize(vec3<f32>(uz.y, -uz.x, 0.0)),
    abs(uz.z) == 1.0
  );
  let uy = cross(uz, ux);
  return mat3x3<f32>(ux, uy, uz);
}

// Since WGSL does not support "out" parameters, we return a struct.
struct RotationResult {
  needsRotation: bool,
  transform: mat3x3<f32>,
};

fn project_needs_rotation(commonPosition: vec3<f32>) -> RotationResult {
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    return RotationResult(true, project_get_orientation_matrix(commonPosition));
  } else {
    return RotationResult(false, mat3x3<f32>());  // identity alternative if needed
  };
}

// Projects a normal vector from the current coordinate system to world space.
fn project_normal(vector: vec3<f32>) -> vec3<f32> {
  let normal_modelspace = project.modelMatrix * vec4<f32>(vector, 0.0);
  var n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
  let rotResult = project_needs_rotation(geometry.position.xyz);
  if (rotResult.needsRotation) {
    n = rotResult.transform * n;
  }
  return n;
}

// Applies a scale offset based on y-offset (dy)
fn project_offset_(offset: vec4<f32>) -> vec4<f32> {
  let dy: f32 = offset.y;
  let commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
  return vec4<f32>(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}

// Projects lng/lat coordinates to a unit tile [0,1]
fn project_mercator_(lnglat: vec2<f32>) -> vec2<f32> {
  var x = lnglat.x;
  if (project.wrapLongitude != 0) {
    x = ((x + 180.0) % 360.0) - 180.0;
  }
  let y = clamp(lnglat.y, -89.9, 89.9);
  return vec2<f32>(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// Projects lng/lat/z coordinates for a globe projection.
fn project_globe_(lnglatz: vec3<f32>) -> vec3<f32> {
  let lambda = radians(lnglatz.x);
  let phi = radians(lnglatz.y);
  let cosPhi = cos(phi);
  let D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
  return vec3<f32>(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}

// Projects positions (with an optional 64-bit low part) from the input
// coordinate system to the common space.
fn project_position_vec4_f64(position: vec4<f32>, position64Low: vec3<f32>) -> vec4<f32> {
  var position_world = project.modelMatrix * position;

  // Work around for a Mac+NVIDIA bug:
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_mercator_(position_world.xy),
        _project_size_at_latitude_m(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world = vec4f(position_world.xyz + project.coordinateOrigin, position_world.w);
    }
  }
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
        return vec4<f32>(
          project_mercator_(position_world.xy) - project.commonOrigin.xy,
          project_size_float(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
      (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
       (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
        project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world = vec4f(position_world.xyz - project.coordinateOrigin, position_world.w);
  }

  return project_offset_(position_world) +
         project_offset_(project.modelMatrix * vec4<f32>(position64Low, 0.0));
}

// Overloaded versions for different input types.
fn project_position_vec4_f32(position: vec4<f32>) -> vec4<f32> {
  return project_position_vec4_f64(position, ZERO_64_LOW);
}

fn project_position_vec3_f64(position: vec3<f32>, position64Low: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), position64Low);
  return projected_position.xyz;
}

fn project_position_vec3_f32(position: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

fn project_position_vec2_f32(position: vec2<f32>) -> vec2<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

// Transforms a common space position to clip space.
fn project_common_position_to_clipspace_with_projection(position: vec4<f32>, viewProjectionMatrix: mat4x4<f32>, center: vec4<f32>) -> vec4<f32> {
  return viewProjectionMatrix * position + center;
}

// Uses the project viewProjectionMatrix and center.
fn project_common_position_to_clipspace(position: vec4<f32>) -> vec4<f32> {
  return project_common_position_to_clipspace_with_projection(position, project.viewProjectionMatrix, project.center);
}

// Returns a clip space offset corresponding to a given number of screen pixels.
fn project_pixel_size_to_clipspace(pixels: vec2<f32>) -> vec2<f32> {
  let offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
  return offset * project.focalDistance;
}

fn project_meter_size_to_pixel(meters: f32) -> f32 {
  return project_size_float(meters) * project.scale;
}

fn project_unit_size_to_pixel(size: f32, unit: i32) -> f32 {
  if (unit == UNIT_METERS) {
    return project_meter_size_to_pixel(size);
  } else if (unit == UNIT_COMMON) {
    return size * project.scale;
  }
  // UNIT_PIXELS: no scaling applied.
  return size;
}

fn project_pixel_size_float(pixels: f32) -> f32 {
  return pixels / project.scale;
}

fn project_pixel_size_vec2(pixels: vec2<f32>) -> vec2<f32> {
  return pixels / project.scale;
}
`,G9=Object.keys(xr).map(i=>`const int COORDINATE_SYSTEM_${i} = ${xr[i]};`).join(""),W9=Object.keys(ch).map(i=>`const int PROJECTION_MODE_${i} = ${ch[i]};`).join(""),Z9=Object.keys(Jg).map(i=>`const int UNIT_${i.toUpperCase()} = ${Jg[i]};`).join(""),X9=`${G9}
${W9}
${Z9}
uniform projectUniforms {
bool wrapLongitude;
int coordinateSystem;
vec3 commonUnitsPerMeter;
int projectionMode;
float scale;
vec3 commonUnitsPerWorldUnit;
vec3 commonUnitsPerWorldUnit2;
vec4 center;
mat4 modelMatrix;
mat4 viewProjectionMatrix;
vec2 viewportSize;
float devicePixelRatio;
float focalDistance;
vec3 cameraPosition;
vec3 coordinateOrigin;
vec3 commonOrigin;
bool pseudoMeters;
} project;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project.pseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project.commonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project.commonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project.commonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project.wrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project.modelMatrix * position;
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project.coordinateOrigin;
}
}
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project.commonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project.coordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
return offset * project.focalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project.scale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project.scale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project.scale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project.scale;
}
`,H9={};function $9(i=H9){return"viewport"in i?N9(i):{}}const Uw={name:"project",dependencies:[gU,IM],source:j9,vs:X9,getUniforms:$9,uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}},q9=`// Define a structure to hold both the clip-space position and the common position.
struct ProjectResult {
  clipPosition: vec4<f32>,
  commonPosition: vec4<f32>,
};

// This function mimics the GLSL version with the 'out' parameter by returning both values.
fn project_position_to_clipspace_and_commonspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> ProjectResult {
  // Compute the projected position.
  let projectedPosition: vec3<f32> = project_position_vec3_f64(position, position64Low);

  // Start with the provided offset.
  var finalOffset: vec3<f32> = offset;

  // Get whether a rotation is needed and the rotation matrix.
  let rotationResult = project_needs_rotation(projectedPosition);

  // If rotation is needed, update the offset.
  if (rotationResult.needsRotation) {
    finalOffset = rotationResult.transform * offset;
  }

  // Compute the common position.
  let commonPosition: vec4<f32> = vec4<f32>(projectedPosition + finalOffset, 1.0);

  // Convert to clip-space.
  let clipPosition: vec4<f32> = project_common_position_to_clipspace(commonPosition);

  return ProjectResult(clipPosition, commonPosition);
}

// A convenience overload that returns only the clip-space position.
fn project_position_to_clipspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> vec4<f32> {
  return project_position_to_clipspace_and_commonspace(position, position64Low, offset).clipPosition;
}
`,Y9=`vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,Vw={name:"project32",dependencies:[Uw],source:q9,vs:Y9};function J9(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Hy(i,e){const t=r2([],e,i);return MM(t,t,1/t[3]),t}function N4(i,e){const t=i%e;return t<0?e+t:t}function UA(i,e,t){return i<e?e:i>t?t:i}function Q9(i){return Math.log(i)*Math.LOG2E}const jw=Math.log2||Q9;function Pp(i,e){if(!i)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const Qf=Math.PI,VM=Qf/4,uf=Qf/180,VA=180/Qf,e2=512,fx=4003e4,o0=85.051129,K9=1.5;function eV(i){return jw(i)}function _1(i){const[e,t]=i;Pp(Number.isFinite(e)),Pp(Number.isFinite(t)&&t>=-90&&t<=90,"invalid latitude");const r=e*uf,o=t*uf,p=e2*(r+Qf)/(2*Qf),_=e2*(Qf+Math.log(Math.tan(VM+o*.5)))/(2*Qf);return[p,_]}function t2(i){const[e,t]=i,r=e/e2*(2*Qf)-Qf,o=2*(Math.atan(Math.exp(t/e2*(2*Qf)-Qf))-VM);return[r*VA,o*VA]}function tV(i){const{latitude:e}=i;Pp(Number.isFinite(e));const t=Math.cos(e*uf);return eV(fx*t)-9}function kv(i){const e=Math.cos(i*uf);return e2/fx/e}function jA(i){const{latitude:e,longitude:t,highPrecision:r=!1}=i;Pp(Number.isFinite(e)&&Number.isFinite(t));const o=e2,p=Math.cos(e*uf),_=o/360,l=_/p,M=o/fx/p,D={unitsPerMeter:[M,M,M],metersPerUnit:[1/M,1/M,1/M],unitsPerDegree:[_,l,M],degreesPerUnit:[1/_,1/l,1/M]};if(r){const B=uf*Math.tan(e*uf)/p,j=_*B/2,$=o/fx*B,se=$/l*M;D.unitsPerDegree2=[0,j,$],D.unitsPerMeter2=[se,0,se]}return D}function jM(i,e){const[t,r,o]=i,[p,_,l]=e,{unitsPerMeter:M,unitsPerMeter2:D}=jA({longitude:t,latitude:r,highPrecision:!0}),B=_1(i);B[0]+=p*(M[0]+D[0]*_),B[1]+=_*(M[1]+D[1]*_);const j=t2(B),$=(o||0)+(l||0);return Number.isFinite(o)||Number.isFinite(l)?[j[0],j[1],$]:j}function iV(i){const{height:e,pitch:t,bearing:r,altitude:o,scale:p,center:_}=i,l=J9();ux(l,l,[0,0,-o]),SM(l,l,-t*uf),EM(l,l,r*uf);const M=p/e;return zw(l,l,[M,M,M]),_&&ux(l,l,FL([],_)),l}function nV(i){const{width:e,height:t,altitude:r,pitch:o=0,offset:p,center:_,scale:l,nearZMultiplier:M=1,farZMultiplier:D=1}=i;let{fovy:B=y1(K9)}=i;r!==void 0&&(B=y1(r));const j=B*uf,$=o*uf,se=Gw(B);let de=se;_&&(de+=_[2]*l/Math.cos($)/t);const Ae=j*(.5+(p?p[1]:0)/t),he=Math.sin(Ae)*de/Math.sin(UA(Math.PI/2-$-Ae,.01,Math.PI-.01)),Le=Math.sin($)*he+de,$e=de*10,Be=Math.min(Le*D,$e);return{fov:j,aspect:e/t,focalDistance:se,near:M,far:Be}}function y1(i){return 2*Math.atan(.5/i)*VA}function Gw(i){return .5/Math.tan(.5*i*uf)}function GM(i,e){const[t,r,o=0]=i;return Pp(Number.isFinite(t)&&Number.isFinite(r)&&Number.isFinite(o)),Hy(e,[t,r,o,1])}function Ww(i,e,t=0){const[r,o,p]=i;if(Pp(Number.isFinite(r)&&Number.isFinite(o),"invalid pixel coordinate"),Number.isFinite(p))return Hy(e,[r,o,p,1]);const _=Hy(e,[r,o,0,1]),l=Hy(e,[r,o,1,1]),M=_[2],D=l[2],B=M===D?0:((t||0)-M)/(D-M);return bM([],_,l,B)}function rV(i){const{width:e,height:t,bounds:r,minExtent:o=0,maxZoom:p=24,offset:_=[0,0]}=i,[[l,M],[D,B]]=r,j=sV(i.padding),$=_1([l,UA(B,-o0,o0)]),se=_1([D,UA(M,-o0,o0)]),de=[Math.max(Math.abs(se[0]-$[0]),o),Math.max(Math.abs(se[1]-$[1]),o)],Ae=[e-j.left-j.right-Math.abs(_[0])*2,t-j.top-j.bottom-Math.abs(_[1])*2];Pp(Ae[0]>0&&Ae[1]>0);const he=Ae[0]/de[0],Le=Ae[1]/de[1],$e=(j.right-j.left)/2/he,Be=(j.top-j.bottom)/2/Le,Je=[(se[0]+$[0])/2+$e,(se[1]+$[1])/2+Be],Rt=t2(Je),Et=Math.min(p,jw(Math.abs(Math.min(he,Le))));return Pp(Number.isFinite(Et)),{longitude:Rt[0],latitude:Rt[1],zoom:Et}}function sV(i=0){return typeof i=="number"?{top:i,bottom:i,left:i,right:i}:(Pp(Number.isFinite(i.top)&&Number.isFinite(i.bottom)&&Number.isFinite(i.left)&&Number.isFinite(i.right)),i)}const B4=Math.PI/180;function aV(i,e=0){const{width:t,height:r,unproject:o}=i,p={targetZ:e},_=o([0,r],p),l=o([t,r],p);let M,D;const B=i.fovy?.5*i.fovy*B4:Math.atan(.5/i.altitude),j=(90-i.pitch)*B4;return B>j-.01?(M=z4(i,0,e),D=z4(i,t,e)):(M=o([0,0],p),D=o([t,0],p)),[_,l,D,M]}function z4(i,e,t){const{pixelUnprojectionMatrix:r}=i,o=Hy(r,[e,0,1,1]),p=Hy(r,[e,i.height,1,1]),l=(t*i.distanceScales.unitsPerMeter[2]-o[2])/(p[2]-o[2]),M=bM([],o,p,l),D=t2(M);return D.push(t),D}const L4=512;function oV(i){const{width:e,height:t,pitch:r=0}=i;let{longitude:o,latitude:p,zoom:_,bearing:l=0}=i;(o<-180||o>180)&&(o=N4(o+180,360)-180),(l<-180||l>180)&&(l=N4(l+180,360)-180);const M=jw(t/L4);if(_<=M)_=M,p=0;else{const D=t/2/Math.pow(2,_),B=t2([0,D])[1];if(p<B)p=B;else{const j=t2([0,L4-D])[1];p>j&&(p=j)}}return{width:e,height:t,longitude:o,latitude:p,zoom:_,pitch:r,bearing:l}}const WM=`
uniform shadowUniforms {
  bool drawShadowMap;
  bool useShadowMap;
  vec4 color;
  highp int lightId;
  float lightCount;
  mat4 viewProjectionMatrix0;
  mat4 viewProjectionMatrix1;
  vec4 projectCenter0;
  vec4 projectCenter1;
} shadow;
`,lV=`
const int max_lights = 2;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  mat4 viewProjectionMatrices[max_lights];
  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;
  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;
  vec4 projectCenters[max_lights];
  projectCenters[0] = shadow.projectCenter0;
  projectCenters[1] = shadow.projectCenter1;

  if (shadow.drawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);
  }
  if (shadow.useShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow.lightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,cV=`
${WM}
${lV}
`,uV=`
const int max_lights = 2;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow.drawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow.useShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow.lightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow.color.a / shadow.lightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,hV=`
${WM}
${uV}
`,fV=D1(_V),dV=D1(yV),pV=[0,0,0,1],gV=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function mV(i,e){const[t,r,o]=i,p=Ww([t,r,o],e);return Number.isFinite(o)?p:[p[0],p[1],0]}function _V({viewport:i,center:e}){return new ed(i.viewProjectionMatrix).invert().transform(e)}function yV({viewport:i,shadowMatrices:e}){const t=[],r=i.pixelUnprojectionMatrix,o=i.isGeospatial?void 0:1,p=[[0,0,o],[i.width,0,o],[0,i.height,o],[i.width,i.height,o],[0,0,-1],[i.width,0,-1],[0,i.height,-1],[i.width,i.height,-1]].map(_=>mV(_,r));for(const _ of e){const l=_.clone().translate(new c0(i.center).negate()),M=p.map(B=>l.transform(B)),D=new ed().ortho({left:Math.min(...M.map(B=>B[0])),right:Math.max(...M.map(B=>B[0])),bottom:Math.min(...M.map(B=>B[1])),top:Math.max(...M.map(B=>B[1])),near:Math.min(...M.map(B=>-B[2])),far:Math.max(...M.map(B=>-B[2]))});t.push(D.multiplyRight(_))}return t}function vV(i){const{shadowEnabled:e=!0,project:t}=i;if(!e||!t||!i.shadowMatrices||!i.shadowMatrices.length)return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:i.dummyShadowMap,shadow_uShadowMap1:i.dummyShadowMap};const r=Uw.getUniforms(t),o=fV({viewport:t.viewport,center:r.center}),p=[],_=dV({shadowMatrices:i.shadowMatrices,viewport:t.viewport}).slice();for(let M=0;M<i.shadowMatrices.length;M++){const D=_[M],B=D.clone().translate(new c0(t.viewport.center).negate());r.coordinateSystem===xr.LNGLAT&&r.projectionMode===ch.WEB_MERCATOR?(_[M]=B,p[M]=o):(_[M]=D.clone().multiplyRight(gV),p[M]=B.transform(o))}const l={drawShadowMap:!!i.drawToShadowMap,useShadowMap:i.shadowMaps?i.shadowMaps.length>0:!1,color:i.shadowColor||pV,lightId:i.shadowLightId||0,lightCount:i.shadowMatrices.length,shadow_uShadowMap0:i.dummyShadowMap,shadow_uShadowMap1:i.dummyShadowMap};for(let M=0;M<_.length;M++)l[`viewProjectionMatrix${M}`]=_[M],l[`projectCenter${M}`]=p[M];for(let M=0;M<2;M++)l[`shadow_uShadowMap${M}`]=i.shadowMaps&&i.shadowMaps[M]||i.dummyShadowMap;return l}const U4={name:"shadow",dependencies:[Uw],vs:cV,fs:hV,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:vV,uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}},Zw={..._4,defaultUniforms:{..._4.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},xV=[IM],bV=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"],AV=[];function wV(i){const e=Jv.getDefaultShaderAssembler();for(const r of xV)e.addDefaultModule(r);e._hookFunctions.length=0;const t=i==="glsl"?bV:AV;for(const r of t)e.addShaderHook(r);return e}const TV=[255,255,255],SV=1;let EV=0;class MV{constructor(e={}){this.type="ambient";const{color:t=TV}=e,{intensity:r=SV}=e;this.id=e.id||`ambient-${EV++}`,this.color=t,this.intensity=r}}const RV=[255,255,255],CV=1,PV=[0,0,-1];let IV=0;class V4{constructor(e={}){this.type="directional";const{color:t=RV}=e,{intensity:r=CV}=e,{direction:o=PV}=e,{_shadow:p=!1}=e;this.id=e.id||`directional-${IV++}`,this.color=t,this.intensity=r,this.type="directional",this.direction=new c0(o).normalize().toArray(),this.shadow=p}getProjectedLight(e){return this}}class kV{constructor(e,t={id:"pass"}){const{id:r}=t;this.id=r,this.device=e,this.props={...t}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class Xw extends kV{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[t,r]=this.device.canvasContext.getDrawingBufferSize(),o=e.clearCanvas??!0,p=e.clearColor??(o?[0,0,0,0]:!1),_=o?1:!1,l=o?0:!1,M=e.colorMask??15,D={viewport:[0,0,t,r]};e.colorMask&&(D.colorMask=M),e.scissorRect&&(D.scissorRect=e.scissorRect);const B=this.device.beginRenderPass({framebuffer:e.target,parameters:D,clearColor:p,clearDepth:_,clearStencil:l});try{return this._drawLayers(B,e)}finally{B.end(),this.device.submit()}}_drawLayers(e,t){const{target:r,shaderModuleProps:o,viewports:p,views:_,onViewportActive:l,clearStack:M=!0}=t;t.pass=t.pass||"unknown",M&&(this._lastRenderIndex=-1);const D=[];for(const B of p){const j=_&&_[B.id];l==null||l(B);const $=this._getDrawLayerParams(B,t),se=B.subViewports||[B];for(const de of se){const Ae=this._drawLayersInViewport(e,{target:r,shaderModuleProps:o,viewport:de,view:j,pass:t.pass,layers:t.layers},$);D.push(Ae)}}return D}_getDrawLayerParams(e,{layers:t,pass:r,isPicking:o=!1,layerFilter:p,cullRect:_,effects:l,shaderModuleProps:M},D=!1){var de;const B=[],j=ZM(this._lastRenderIndex+1),$={layer:t[0],viewport:e,isPicking:o,renderPass:r,cullRect:_},se={};for(let Ae=0;Ae<t.length;Ae++){const he=t[Ae],Le=this._shouldDrawLayer(he,$,p,se),$e={shouldDrawLayer:Le};Le&&!D&&($e.shouldDrawLayer=!0,$e.layerRenderIndex=j(he,Le),$e.shaderModuleProps=this._getShaderModuleProps(he,l,r,M),$e.layerParameters={...(de=he.context.deck)==null?void 0:de.props.parameters,...this.getLayerParameters(he,Ae,e)}),B[Ae]=$e}return B}_drawLayersInViewport(e,{layers:t,shaderModuleProps:r,pass:o,target:p,viewport:_,view:l},M){const D=DV(this.device,{shaderModuleProps:r,target:p,viewport:_});if(l){const{clear:j,clearColor:$,clearDepth:se,clearStencil:de}=l.props;if(j){let Ae=[0,0,0,0],he=1,Le=0;Array.isArray($)?Ae=[...$.slice(0,3),$[3]||255].map(Be=>Be/255):$===!1&&(Ae=!1),se!==void 0&&(he=se),de!==void 0&&(Le=de),this.device.beginRenderPass({framebuffer:p,parameters:{viewport:D,scissorRect:D},clearColor:Ae,clearDepth:he,clearStencil:Le}).end()}}const B={totalCount:t.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:D});for(let j=0;j<t.length;j++){const $=t[j],se=M[j],{shouldDrawLayer:de}=se;if(de&&$.props.pickable&&B.pickableCount++,$.isComposite&&B.compositeCount++,$.isDrawable&&se.shouldDrawLayer){const{layerRenderIndex:Ae,shaderModuleProps:he,layerParameters:Le}=se;B.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,Ae),he.project&&(he.project.viewport=_),$.context.renderPass=e;try{$._drawLayer({renderPass:e,shaderModuleProps:he,uniforms:{layerIndex:Ae},parameters:Le})}catch($e){$.raiseError($e,`drawing ${$} to ${o}`)}}}return B}shouldDrawLayer(e){return!0}getShaderModuleProps(e,t,r){return null}getLayerParameters(e,t,r){return e.props.parameters}_shouldDrawLayer(e,t,r,o){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;t.layer=e;let _=e.parent;for(;_;){if(!_.props.visible||!_.filterSubLayer(t))return!1;t.layer=_,_=_.parent}if(r){const l=t.layer.id;if(l in o||(o[l]=r(t)),!o[l])return!1}return e.activateViewport(t.viewport),!0}_getShaderModuleProps(e,t,r,o){var M,D;const p=this.device.canvasContext.cssToDeviceRatio(),_=((M=e.internalState)==null?void 0:M.propsInTransition)||e.props,l={layer:_,picking:{isActive:!1},project:{viewport:e.context.viewport,devicePixelRatio:p,modelMatrix:_.modelMatrix,coordinateSystem:_.coordinateSystem,coordinateOrigin:_.coordinateOrigin,autoWrapLongitude:e.wrapLongitude}};if(t)for(const B of t)j4(l,(D=B.getShaderModuleProps)==null?void 0:D.call(B,e,l));return j4(l,this.getShaderModuleProps(e,t,l),o)}}function ZM(i=0,e={}){const t={},r=(o,p)=>{const _=o.props._offset,l=o.id,M=o.parent&&o.parent.id;let D;if(M&&!(M in e)&&r(o.parent,!1),M in t){const B=t[M]=t[M]||ZM(e[M],e);D=B(o,p),t[l]=B}else Number.isFinite(_)?(D=_+(e[M]||0),t[l]=null):D=i;return p&&D>=i&&(i=D+1),e[l]=D,D};return r}function DV(i,{shaderModuleProps:e,target:t,viewport:r}){var M;const o=((M=e==null?void 0:e.project)==null?void 0:M.devicePixelRatio)??i.canvasContext.cssToDeviceRatio(),[,p]=i.canvasContext.getDrawingBufferSize(),_=t?t.height:p,l=r;return[l.x*o,_-(l.y+l.height)*o,l.width*o,l.height*o]}function j4(i,...e){for(const t of e)if(t)for(const r in t)i[r]?Object.assign(i[r],t[r]):i[r]=t[r];return i}class OV extends Xw{constructor(e,t){super(e,t);const r=e.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}),o=e.createTexture({format:"depth16unorm",width:1,height:1});this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[r],depthStencilAttachment:o})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(e){const t=this.fbo,r=this.device.canvasContext.cssToDeviceRatio(),o=e.viewports[0],p=o.width*r,_=o.height*r,l=[1,1,1,1];(p!==t.width||_!==t.height)&&t.resize({width:p,height:_}),super.render({...e,clearColor:l,target:t,pass:"shadow"})}getLayerParameters(e,t,r){return{...e.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getShaderModuleProps(e,t,r){return{shadow:{project:r.project,drawToShadowMap:!0}}}}const FV={color:[255,255,255],intensity:1},G4=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],NV=[0,0,0,200/255];class XM{constructor(e={}){this.id="lighting-effect",this.shadowColor=NV,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:t,deck:r}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(t),r._addDefaultShaderModule(U4),this.dummyShadowMap=t.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[];for(const t in e){const r=e[t];switch(r.type){case"ambient":this.ambientLight=r;break;case"directional":this.directionalLights.push(r);break;case"point":this.pointLights.push(r);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(t=>t.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:t,viewports:r,onViewportActive:o,views:p}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let _=0;_<this.shadowPasses.length;_++)this.shadowPasses[_].render({layers:e,layerFilter:t,viewports:r,onViewportActive:o,views:p,shaderModuleProps:{shadow:{shadowLightId:_,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}getShaderModuleProps(e,t){const r=this.shadow?{project:t.project,shadowMaps:this.shadowPasses.map(_=>_.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},o={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(_=>_.getProjectedLight({layer:e})),pointLights:this.pointLights.map(_=>_.getProjectedLight({layer:e}))},p=e.props.material;return{shadow:r,lighting:o,phongMaterial:p,gouraudMaterial:p}}cleanup(e){for(const t of this.shadowPasses)t.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(U4))}_calculateMatrices(){const e=[];for(const t of this.directionalLights){const r=new ed().lookAt({eye:new c0(t.direction).negate()});e.push(r)}return e}_createShadowPasses(e){for(let t=0;t<this.directionalLights.length;t++){const r=new OV(e);this.shadowPasses[t]=r}}_applyDefaultLights(){const{ambientLight:e,pointLights:t,directionalLights:r}=this;!e&&t.length===0&&r.length===0&&(this.ambientLight=new MV(FV),this.directionalLights.push(new V4(G4[0]),new V4(G4[1])))}}class BV{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,t,{size:r=1,type:o,padding:p=0,copy:_=!1,initialize:l=!1,maxCount:M}){const D=o||e&&e.constructor||Float32Array,B=t*r+p;if(ArrayBuffer.isView(e)){if(B<=e.length)return e;if(B*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new D(e.buffer,0,B)}let j=1/0;M&&(j=M*r+p);const $=this._allocate(D,B,l,j);return e&&_?$.set(e):l||$.fill(0,0,4),this._release(e),$}release(e){this._release(e)}_allocate(e,t,r,o){let p=Math.max(Math.ceil(t*this.opts.overAlloc),1);p>o&&(p=o);const _=this._pool,l=e.BYTES_PER_ELEMENT*p,M=_.findIndex(D=>D.byteLength>=l);if(M>=0){const D=new e(_.splice(M,1)[0],0,p);return r&&D.fill(0),D}return new e(p)}_release(e){if(!ArrayBuffer.isView(e))return;const t=this._pool,{buffer:r}=e,{byteLength:o}=r,p=t.findIndex(_=>_.byteLength>=o);p<0?t.push(r):(p>0||t.length<this.opts.poolSize)&&t.splice(p,0,r),t.length>this.opts.poolSize&&t.shift()}}const v1=new BV;function W2(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function zV(i,e){const t=i%e;return t<0?e+t:t}function LV(i){return[i[12],i[13],i[14]]}function UV(i){return{left:Cy(i[3]+i[0],i[7]+i[4],i[11]+i[8],i[15]+i[12]),right:Cy(i[3]-i[0],i[7]-i[4],i[11]-i[8],i[15]-i[12]),bottom:Cy(i[3]+i[1],i[7]+i[5],i[11]+i[9],i[15]+i[13]),top:Cy(i[3]-i[1],i[7]-i[5],i[11]-i[9],i[15]-i[13]),near:Cy(i[3]+i[2],i[7]+i[6],i[11]+i[10],i[15]+i[14]),far:Cy(i[3]-i[2],i[7]-i[6],i[11]-i[10],i[15]-i[14])}}const W4=new c0;function Cy(i,e,t,r){W4.set(i,e,t);const o=W4.len();return{distance:r/o,normal:new c0(-i/o,-e/o,-t/o)}}function VV(i){return i-Math.fround(i)}let N2;function Wb(i,e){const{size:t=1,startIndex:r=0}=e,o=e.endIndex!==void 0?e.endIndex:i.length,p=(o-r)/t;N2=v1.allocate(N2,p,{type:Float32Array,size:t*2});let _=r,l=0;for(;_<o;){for(let M=0;M<t;M++){const D=i[_++];N2[l+M]=D,N2[l+M+t]=VV(D)}l+=t*2}return N2.subarray(0,p*t*2)}function jV(i){let e=null,t=!1;for(const r of i)r&&(e?(t||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],t=!0),e[0][0]=Math.min(e[0][0],r[0][0]),e[0][1]=Math.min(e[0][1],r[0][1]),e[1][0]=Math.max(e[1][0],r[1][0]),e[1][1]=Math.max(e[1][1],r[1][1])):e=r);return e}const GV=Math.PI/180,WV=W2(),Z4=[0,0,0],ZV={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function XV({width:i,height:e,orthographic:t,fovyRadians:r,focalDistance:o,padding:p,near:_,far:l}){const M=i/e,D=t?new ed().orthographic({fovy:r,aspect:M,focalDistance:o,near:_,far:l}):new ed().perspective({fovy:r,aspect:M,near:_,far:l});if(p){const{left:B=0,right:j=0,top:$=0,bottom:se=0}=p,de=a0((B+i-j)/2,0,i)-i/2,Ae=a0(($+e-se)/2,0,e)-e/2;D[8]-=de*2/i,D[9]+=Ae*2/e}return D}class s2{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||ZV,this.focalDistance=e.focalDistance||1,this.position=e.position||Z4,this.modelMatrix=e.modelMatrix||null;const{longitude:t,latitude:r}=e;this.isGeospatial=Number.isFinite(r)&&Number.isFinite(t),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?ch.WEB_MERCATOR:ch.WEB_MERCATOR_AUTO_OFFSET:ch.IDENTITY}equals(e){return e instanceof s2?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&g1(e.projectionMatrix,this.projectionMatrix)&&g1(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:t=!0}={}){const r=this.projectPosition(e),o=GM(r,this.pixelProjectionMatrix),[p,_]=o,l=t?_:this.height-_;return e.length===2?[p,l]:[p,l,o[2]]}unproject(e,{topLeft:t=!0,targetZ:r}={}){const[o,p,_]=e,l=t?p:this.height-p,M=r&&r*this.distanceScales.unitsPerMeter[2],D=Ww([o,l,_],this.pixelUnprojectionMatrix,M),[B,j,$]=this.unprojectPosition(D);return Number.isFinite(_)?[B,j,$]:Number.isFinite(r)?[B,j,r]:[B,j]}projectPosition(e){const[t,r]=this.projectFlat(e),o=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[t,r,o]}unprojectPosition(e){const[t,r]=this.unprojectFlat(e),o=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[t,r,o]}projectFlat(e){if(this.isGeospatial){const t=_1(e);return t[1]=a0(t[1],-318,830),t}return e}unprojectFlat(e){return this.isGeospatial?t2(e):e}getBounds(e={}){const t={targetZ:e.z||0},r=this.unproject([0,0],t),o=this.unproject([this.width,0],t),p=this.unproject([0,this.height],t),_=this.unproject([this.width,this.height],t);return[Math.min(r[0],o[0],p[0],_[0]),Math.min(r[1],o[1],p[1],_[1]),Math.max(r[0],o[0],p[0],_[0]),Math.max(r[1],o[1],p[1],_[1])]}getDistanceScales(e){return e&&this.isGeospatial?jA({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:t,width:r=1,height:o=1}){return e<this.x+this.width&&this.x<e+r&&t<this.y+this.height&&this.y<t+o}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,UV(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,t,r){return null}_initProps(e){const t=e.longitude,r=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=tV({latitude:r})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||jA({latitude:r,longitude:t}));const o=Math.pow(2,this.zoom);this.scale=o;const{position:p,modelMatrix:_}=e;let l=Z4;if(p&&(l=_?new ed(_).transformAsVector(p,[]):p),this.isGeospatial){const M=this.projectPosition([t,r,0]);this.center=new c0(l).scale(this.distanceScales.unitsPerMeter).add(M)}else this.center=this.projectPosition(l)}_initMatrices(e){const{viewMatrix:t=WV,projectionMatrix:r=null,orthographic:o=!1,fovyRadians:p,fovy:_=75,near:l=.1,far:M=1e3,padding:D=null,focalDistance:B=1}=e;this.viewMatrixUncentered=t,this.viewMatrix=new ed().multiplyRight(t).translate(new c0(this.center).negate()),this.projectionMatrix=r||XV({width:this.width,height:this.height,orthographic:o,fovyRadians:p||_*GV,focalDistance:B,padding:D,near:l,far:M});const j=W2();y_(j,j,this.projectionMatrix),y_(j,j,this.viewMatrix),this.viewProjectionMatrix=j,this.viewMatrixInverse=DA([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=LV(this.viewMatrixInverse);const $=W2(),se=W2();zw($,$,[this.width/2,-this.height/2,1]),ux($,$,[1,-1,0]),y_(se,$,this.viewProjectionMatrix),this.pixelProjectionMatrix=se,this.pixelUnprojectionMatrix=DA(W2(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||Wr.warn("Pixel project matrix not invertible")()}}s2.displayName="Viewport";class M_ extends s2{constructor(e={}){const{latitude:t=0,longitude:r=0,zoom:o=0,pitch:p=0,bearing:_=0,nearZMultiplier:l=.1,farZMultiplier:M=1.01,nearZ:D,farZ:B,orthographic:j=!1,projectionMatrix:$,repeat:se=!1,worldOffset:de=0,position:Ae,padding:he,legacyMeterSizes:Le=!1}=e;let{width:$e,height:Be,altitude:Je=1.5}=e;const Rt=Math.pow(2,o);$e=$e||1,Be=Be||1;let Et,kt=null;if($)Je=$[5]/2,Et=y1(Je);else{e.fovy?(Et=e.fovy,Je=Gw(Et)):Et=y1(Je);let Xt;if(he){const{top:hi=0,bottom:di=0}=he;Xt=[0,a0((hi+Be-di)/2,0,Be)-Be/2]}kt=nV({width:$e,height:Be,scale:Rt,center:Ae&&[0,0,Ae[2]*kv(t)],offset:Xt,pitch:p,fovy:Et,nearZMultiplier:l,farZMultiplier:M}),Number.isFinite(D)&&(kt.near=D),Number.isFinite(B)&&(kt.far=B)}let Ht=iV({height:Be,pitch:p,bearing:_,scale:Rt,altitude:Je});de&&(Ht=new ed().translate([512*de,0,0]).multiplyLeft(Ht)),super({...e,width:$e,height:Be,viewMatrix:Ht,longitude:r,latitude:t,zoom:o,...kt,fovy:Et,focalDistance:Je}),this.latitude=t,this.longitude=r,this.zoom=o,this.pitch=p,this.bearing=_,this.altitude=Je,this.fovy=Et,this.orthographic=j,this._subViewports=se?[]:null,this._pseudoMeters=Le,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),t=Math.floor((e[0]+180)/360),r=Math.ceil((e[2]-180)/360);for(let o=t;o<=r;o++){const p=o?new M_({...this,worldOffset:o}):this;this._subViewports.push(p)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[t,r]=this.projectFlat(e),o=(e[2]||0)*kv(e[1]);return[t,r,o]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[t,r]=this.unprojectFlat(e),o=(e[2]||0)/kv(r);return[t,r,o]}addMetersToLngLat(e,t){return jM(e,t)}panByPosition(e,t,r){const o=Ww(t,this.pixelUnprojectionMatrix),p=this.projectFlat(e),_=g4([],p,ML([],o)),l=g4([],this.center,_),[M,D]=this.unprojectFlat(l);return{longitude:M,latitude:D}}getBounds(e={}){const t=aV(this,e.z||0);return[Math.min(t[0][0],t[1][0],t[2][0],t[3][0]),Math.min(t[0][1],t[1][1],t[2][1],t[3][1]),Math.max(t[0][0],t[1][0],t[2][0],t[3][0]),Math.max(t[0][1],t[1][1],t[2][1],t[3][1])]}fitBounds(e,t={}){const{width:r,height:o}=this,{longitude:p,latitude:_,zoom:l}=rV({width:r,height:o,bounds:e,...t});return new M_({width:r,height:o,longitude:p,latitude:_,zoom:l})}}M_.displayName="WebMercatorViewport";const X4=[0,0,0];function Zb(i,e,t=!1){const r=e.projectPosition(i);if(t&&e instanceof M_){const[o,p,_=0]=i,l=e.getDistanceScales([o,p]);r[2]=_*l.unitsPerMeter[2]}return r}function HV(i){const{viewport:e,modelMatrix:t,coordinateOrigin:r}=i;let{coordinateSystem:o,fromCoordinateSystem:p,fromCoordinateOrigin:_}=i;return o===xr.DEFAULT&&(o=e.isGeospatial?xr.LNGLAT:xr.CARTESIAN),p===void 0&&(p=o),_===void 0&&(_=r),{viewport:e,coordinateSystem:o,coordinateOrigin:r,modelMatrix:t,fromCoordinateSystem:p,fromCoordinateOrigin:_}}function HM(i,{viewport:e,modelMatrix:t,coordinateSystem:r,coordinateOrigin:o,offsetMode:p}){let[_,l,M=0]=i;switch(t&&([_,l,M]=r2([],[_,l,M,1],t)),r){case xr.LNGLAT:return Zb([_,l,M],e,p);case xr.LNGLAT_OFFSETS:return Zb([_+o[0],l+o[1],M+(o[2]||0)],e,p);case xr.METER_OFFSETS:return Zb(jM(o,[_,l,M]),e,p);case xr.CARTESIAN:default:return e.isGeospatial?[_+o[0],l+o[1],M+o[2]]:e.projectPosition([_,l,M])}}function $V(i,e){const{viewport:t,coordinateSystem:r,coordinateOrigin:o,modelMatrix:p,fromCoordinateSystem:_,fromCoordinateOrigin:l}=HV(e),{autoOffset:M=!0}=e,{geospatialOrigin:D=X4,shaderCoordinateOrigin:B=X4,offsetMode:j=!1}=M?UM(t,r,o):{},$=HM(i,{viewport:t,modelMatrix:p,coordinateSystem:_,coordinateOrigin:l,offsetMode:j});if(j){const se=t.projectPosition(D||B);TM($,$,se)}return $}let qV=1,YV=1;class $M{constructor(){pe(this,"time",0);pe(this,"channels",new Map);pe(this,"animations",new Map);pe(this,"playing",!1);pe(this,"lastEngineTime",-1)}addChannel(e){const{delay:t=0,duration:r=Number.POSITIVE_INFINITY,rate:o=1,repeat:p=1}=e,_=qV++,l={time:0,delay:t,duration:r,rate:o,repeat:p};return this._setChannelTime(l,this.time),this.channels.set(_,l),_}removeChannel(e){this.channels.delete(e);for(const[t,r]of this.animations)r.channel===e&&this.detachAnimation(t)}isFinished(e){const t=this.channels.get(e);return t===void 0?!1:this.time>=t.delay+t.duration*t.repeat}getTime(e){if(e===void 0)return this.time;const t=this.channels.get(e);return t===void 0?-1:t.time}setTime(e){this.time=Math.max(0,e);const t=this.channels.values();for(const o of t)this._setChannelTime(o,this.time);const r=this.animations.values();for(const o of r){const{animation:p,channel:_}=o;p.setTime(this.getTime(_))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,t){const r=YV++;return this.animations.set(r,{animation:e,channel:t}),e.setTime(this.getTime(t)),r}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,t){const r=t-e.delay,o=e.duration*e.repeat;r>=o?e.time=e.duration*e.rate:(e.time=Math.max(0,r)%e.duration,e.time*=e.rate)}}function JV(i){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(i):setTimeout(i,1e3/60)}function QV(i){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(i):clearTimeout(i)}let KV=0;const Mx=class Mx{constructor(e){pe(this,"device",null);pe(this,"canvas",null);pe(this,"props");pe(this,"animationProps",null);pe(this,"timeline",null);pe(this,"stats");pe(this,"cpuTime");pe(this,"gpuTime");pe(this,"frameRate");pe(this,"display");pe(this,"needsRedraw","initialized");pe(this,"_initialized",!1);pe(this,"_running",!1);pe(this,"_animationFrameId",null);pe(this,"_nextFramePromise",null);pe(this,"_resolveNextFrame",null);pe(this,"_cpuStartTime",0);pe(this,"_error",null);if(this.props={...Mx.defaultAnimationLoopProps,...e},e=this.props,!e.device)throw new Error("No device provided");this.stats=e.stats||new kx({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}reportError(e){this.props.onError(e),this._error=e}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const t=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(t),t}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){var e;return(e=this.device)!=null&&e.isLost||this._error?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=JV(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(QV(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){var t;if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),(t=this.device)==null||t.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeViewport()}_initializeAnimationProps(){var o;const e=(o=this.device)==null?void 0:o.getDefaultCanvasContext();if(!this.device||!e)throw new Error("loop");const t=e==null?void 0:e.canvas,r=e.props.useDevicePixels;this.animationProps={animationLoop:this,device:this.device,canvasContext:e,canvas:t,useDevicePixels:r,timeline:this.timeline,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:t,aspect:r}=this._getSizeAndAspect();(e!==this.animationProps.width||t!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),r!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=t,this.animationProps.aspect=r,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=this.device.getDefaultCanvasContext().canvas||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const t=document.createElement("div");t.style.position="absolute",t.style.left="10px",t.style.bottom="10px",t.style.width="300px",t.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(t);const r=this.props.onAddHTML(t);r&&(t.innerHTML=r)}}_getSizeAndAspect(){var p,_;if(!this.device)return{width:1,height:1,aspect:1};const[e,t]=((p=this.device)==null?void 0:p.getDefaultCanvasContext().getDevicePixelSize())||[1,1];let r=1;const o=(_=this.device)==null?void 0:_.getDefaultCanvasContext().canvas;return o&&o.clientHeight?r=o.clientWidth/o.clientHeight:e>0&&t>0&&(r=e/t),{width:e,height:t,aspect:r}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}};pe(Mx,"defaultAnimationLoopProps",{device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:e=>console.error(e),stats:wA.stats.get(`animation-loop-${KV++}`),autoResizeViewport:!1});let GA=Mx;const Xb={};function O1(i="id"){Xb[i]=Xb[i]||1;const e=Xb[i]++;return`${i}-${e}`}class H4{constructor(e){pe(this,"id");pe(this,"userData",{});pe(this,"topology");pe(this,"bufferLayout",[]);pe(this,"vertexCount");pe(this,"indices");pe(this,"attributes");if(this.id=e.id||O1("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&!(this.indices.usage&xa.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){var e;(e=this.indices)==null||e.destroy();for(const t of Object.values(this.attributes))t.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(e){return e.byteLength/12}}function e7(i,e){if(e instanceof H4)return e;const t=t7(i,e),{attributes:r,bufferLayout:o}=i7(i,e);return new H4({topology:e.topology||"triangle-list",bufferLayout:o,vertexCount:e.vertexCount,indices:t,attributes:r})}function t7(i,e){if(!e.indices)return;const t=e.indices.value;return i.createBuffer({usage:xa.INDEX,data:t})}function i7(i,e){const t=[],r={};for(const[p,_]of Object.entries(e.attributes)){let l=p;switch(p){case"POSITION":l="positions";break;case"NORMAL":l="normals";break;case"TEXCOORD_0":l="texCoords";break;case"COLOR_0":l="colors";break}if(_){r[l]=i.createBuffer({data:_.value,id:`${p}-buffer`});const{value:M,size:D,normalized:B}=_;t.push({name:l,format:WB(M,D,B)})}}const o=e._calculateVertexCount(e.attributes,e.indices);return{attributes:r,bufferLayout:t,vertexCount:o}}const Rx=class Rx{constructor(e){pe(this,"device");pe(this,"cachingEnabled");pe(this,"destroyPolicy");pe(this,"debug");pe(this,"_hashCounter",0);pe(this,"_hashes",{});pe(this,"_renderPipelineCache",{});pe(this,"_computePipelineCache",{});this.device=e,this.cachingEnabled=e.props._cachePipelines,this.destroyPolicy=e.props._cacheDestroyPolicy,this.debug=e.props.debugFactories}static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new Rx(e),e._lumaData.defaultPipelineFactory}get[Symbol.toStringTag](){return"PipelineFactory"}toString(){return`PipelineFactory(${this.device.id})`}createRenderPipeline(e){var _;if(!this.cachingEnabled)return this.device.createRenderPipeline(e);const t={...__.defaultProps,...e},r=this._renderPipelineCache,o=this._hashRenderPipeline(t);let p=(_=r[o])==null?void 0:_.pipeline;return p?(r[o].useCount++,this.debug&&ni.log(3,`${this}: ${r[o].pipeline} reused, count=${r[o].useCount}, (id=${e.id})`)()):(p=this.device.createRenderPipeline({...t,id:t.id?`${t.id}-cached`:O1("unnamed-cached")}),p.hash=o,r[o]={pipeline:p,useCount:1},this.debug&&ni.log(3,`${this}: ${p} created, count=${r[o].useCount}`)()),p}createComputePipeline(e){var _;if(!this.cachingEnabled)return this.device.createComputePipeline(e);const t={...ix.defaultProps,...e},r=this._computePipelineCache,o=this._hashComputePipeline(t);let p=(_=r[o])==null?void 0:_.pipeline;return p?(r[o].useCount++,this.debug&&ni.log(3,`${this}: ${r[o].pipeline} reused, count=${r[o].useCount}, (id=${e.id})`)()):(p=this.device.createComputePipeline({...t,id:t.id?`${t.id}-cached`:void 0}),p.hash=o,r[o]={pipeline:p,useCount:1},this.debug&&ni.log(3,`${this}: ${p} created, count=${r[o].useCount}`)()),p}release(e){if(!this.cachingEnabled){e.destroy();return}const t=this._getCache(e),r=e.hash;t[r].useCount--,t[r].useCount===0?(this._destroyPipeline(e),this.debug&&ni.log(3,`${this}: ${e} released and destroyed`)()):t[r].useCount<0?(ni.error(`${this}: ${e} released, useCount < 0, resetting`)(),t[r].useCount=0):this.debug&&ni.log(3,`${this}: ${e} released, count=${t[r].useCount}`)()}_destroyPipeline(e){const t=this._getCache(e);switch(this.destroyPolicy){case"never":return!1;case"unused":return delete t[e.hash],e.destroy(),!0}}_getCache(e){let t;if(e instanceof ix&&(t=this._computePipelineCache),e instanceof __&&(t=this._renderPipelineCache),!t)throw new Error(`${this}`);if(!t[e.hash])throw new Error(`${this}: ${e} matched incorrect entry`);return t}_hashComputePipeline(e){const{type:t}=this.device,r=this._getHash(e.shader.source);return`${t}/C/${r}`}_hashRenderPipeline(e){const t=e.vs?this._getHash(e.vs.source):0,r=e.fs?this._getHash(e.fs.source):0,o="-",p=this._getHash(JSON.stringify(e.bufferLayout)),{type:_}=this.device;switch(_){case"webgl":return`${_}/R/${t}/${r}V${o}BL${p}`;case"webgpu":default:const l=this._getHash(JSON.stringify(e.parameters));return`${_}/R/${t}/${r}V${o}T${e.topology}P${l}BL${p}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}};pe(Rx,"defaultProps",{...__.defaultProps});let WA=Rx;const Cx=class Cx{constructor(e){pe(this,"device");pe(this,"cachingEnabled");pe(this,"destroyPolicy");pe(this,"debug");pe(this,"_cache",{});this.device=e,this.cachingEnabled=e.props._cacheShaders,this.destroyPolicy=e.props._cacheDestroyPolicy,this.debug=!0}static getDefaultShaderFactory(e){var t;return(t=e._lumaData).defaultShaderFactory||(t.defaultShaderFactory=new Cx(e)),e._lumaData.defaultShaderFactory}get[Symbol.toStringTag](){return"ShaderFactory"}toString(){return`${this[Symbol.toStringTag]}(${this.device.id})`}createShader(e){if(!this.cachingEnabled)return this.device.createShader(e);const t=this._hashShader(e);let r=this._cache[t];if(r)r.useCount++,this.debug&&ni.log(3,`${this}: Reusing shader ${r.shader.id} count=${r.useCount}`)();else{const o=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[t]=r={shader:o,useCount:1},this.debug&&ni.log(3,`${this}: Created new shader ${o.id}`)()}return r.shader}release(e){if(!this.cachingEnabled){e.destroy();return}const t=this._hashShader(e),r=this._cache[t];if(r)if(r.useCount--,r.useCount===0)this.destroyPolicy==="unused"&&(delete this._cache[t],r.shader.destroy(),this.debug&&ni.log(3,`${this}: Releasing shader ${e.id}, destroyed`)());else{if(r.useCount<0)throw new Error(`ShaderFactory: Shader ${e.id} released too many times`);this.debug&&ni.log(3,`${this}: Releasing shader ${e.id} count=${r.useCount}`)()}}_hashShader(e){return`${e.stage}:${e.source}`}};pe(Cx,"defaultProps",{...ex.defaultProps});let ZA=Cx;function n7(i,e){var o;const t={},r="Values";if(i.attributes.length===0&&!((o=i.varyings)!=null&&o.length))return{"No attributes or varyings":{[r]:"N/A"}};for(const p of i.attributes)if(p){const _=`${p.location} ${p.name}: ${p.type}`;t[`in ${_}`]={[r]:p.stepMode||"vertex"}}for(const p of i.varyings||[]){const _=`${p.location} ${p.name}`;t[`out ${_}`]={[r]:JSON.stringify(p)}}return t}let Jo=null,c_=null;function r7(i,{id:e,minimap:t,opaque:r,top:o="0",left:p="0",rgbaScale:_=1}){Jo||(Jo=document.createElement("canvas"),Jo.id=e,Jo.title=e,Jo.style.zIndex="100",Jo.style.position="absolute",Jo.style.top=o,Jo.style.left=p,Jo.style.border="blue 5px solid",Jo.style.transform="scaleY(-1)",document.body.appendChild(Jo),c_=Jo.getContext("2d")),(Jo.width!==i.width||Jo.height!==i.height)&&(Jo.width=i.width/2,Jo.height=i.height/2,Jo.style.width="400px",Jo.style.height="400px");const l=i.device.readPixelsToArrayWebGL(i),M=c_==null?void 0:c_.createImageData(i.width,i.height);if(M){for(let B=0;B<l.length;B+=4)M.data[0+B+0]=l[B+0]*_,M.data[0+B+1]=l[B+1]*_,M.data[0+B+2]=l[B+2]*_,M.data[0+B+3]=r?255:l[B+3]*_;c_==null||c_.putImageData(M,0,0)}}function XA(i,e,t){if(i===e)return!0;if(!t||!i||!e)return!1;if(Array.isArray(i)){if(!Array.isArray(e)||i.length!==e.length)return!1;for(let r=0;r<i.length;r++)if(!XA(i[r],e[r],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof i=="object"&&typeof e=="object"){const r=Object.keys(i),o=Object.keys(e);if(r.length!==o.length)return!1;for(const p of r)if(!e.hasOwnProperty(p)||!XA(i[p],e[p],t-1))return!1;return!0}return!1}class Hb{constructor(e){pe(this,"bufferLayouts");this.bufferLayouts=e}getBufferLayout(e){return this.bufferLayouts.find(t=>t.name===e)||null}getAttributeNamesForBuffer(e){var t;return e.attributes?(t=e.attributes)==null?void 0:t.map(r=>r.attribute):[e.name]}mergeBufferLayouts(e,t){const r=[...e];for(const o of t){const p=r.findIndex(_=>_.name===o.name);p<0?r.push(o):r[p]=o}return r}getBufferIndex(e){const t=this.bufferLayouts.findIndex(r=>r.name===e);return t===-1&&ni.warn(`BufferLayout: Missing buffer for "${e}".`)(),t}}function s7(i,e){const t=Object.fromEntries(i.attributes.map(o=>[o.name,o.location])),r=e.slice();return r.sort((o,p)=>{const _=o.attributes?o.attributes.map(B=>B.attribute):[o.name],l=p.attributes?p.attributes.map(B=>B.attribute):[p.name],M=Math.min(..._.map(B=>t[B])),D=Math.min(...l.map(B=>t[B]));return M-D}),r}function a7(i){return ArrayBuffer.isView(i)&&!(i instanceof DataView)}function o7(i){return Array.isArray(i)?i.length===0||typeof i[0]=="number":!1}function l7(i){return a7(i)||o7(i)}function c7(i){return l7(i)||typeof i=="number"||typeof i=="boolean"}function u7(i){const e={bindings:{},uniforms:{}};return Object.keys(i).forEach(t=>{const r=i[t];c7(r)?e.uniforms[t]=r:e.bindings[t]=r}),e}class h7{constructor(e,t){pe(this,"options",{disableWarnings:!1});pe(this,"modules");pe(this,"moduleUniforms");pe(this,"moduleBindings");Object.assign(this.options,t);const r=Tw(Object.values(e).filter(o=>o.dependencies));for(const o of r)e[o.name]=o;ni.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[o,p]of Object.entries(e))this._addModule(p),p.name&&o!==p.name&&!this.options.disableWarnings&&ni.warn(`Module name: ${o} vs ${p.name}`)()}destroy(){}setProps(e){var t;for(const r of Object.keys(e)){const o=r,p=e[o]||{},_=this.modules[o];if(!_){this.options.disableWarnings||ni.warn(`Module ${r} not found`)();continue}const l=this.moduleUniforms[o],M=this.moduleBindings[o],D=((t=_.getUniforms)==null?void 0:t.call(_,p,l))||p,{uniforms:B,bindings:j}=u7(D);this.moduleUniforms[o]={...l,...B},this.moduleBindings[o]={...M,...j}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){const e={};for(const t of Object.values(this.moduleBindings))Object.assign(e,t);return e}getDebugTable(){var t;const e={};for(const[r,o]of Object.entries(this.moduleUniforms))for(const[p,_]of Object.entries(o))e[`${r}.${p}`]={type:(t=this.modules[r].uniformTypes)==null?void 0:t[p],value:String(_)};return e}_addModule(e){const t=e.name;this.moduleUniforms[t]=e.defaultUniforms||{},this.moduleBindings[t]={}}}let f7="";async function d7(i,e){const t=new Image;return t.crossOrigin="anonymous",t.src=i.startsWith("http")?i:f7+i,await t.decode(),e?await createImageBitmap(t,e):await createImageBitmap(t)}const p7=["+X","-X","+Y","-Y","+Z","-Z"],g7=["+X","-X","+Y","-Y","+Z","-Z"],Px=class Px{constructor(e,t){pe(this,"device");pe(this,"id");pe(this,"props");pe(this,"texture");pe(this,"sampler");pe(this,"view");pe(this,"ready");pe(this,"isReady",!1);pe(this,"destroyed",!1);pe(this,"resolveReady",()=>{});pe(this,"rejectReady",()=>{});this.device=e;const r=O1("async-texture");this.props={...Px.defaultProps,id:r,...t},this.id=this.props.id,t={...t},typeof(t==null?void 0:t.data)=="string"&&t.dimension==="2d"&&(t.data=d7(t.data)),t.mipmaps&&(t.mipLevels="auto"),this.ready=new Promise((o,p)=>{this.resolveReady=()=>{this.isReady=!0,o()},this.rejectReady=p}),this.initAsync(t)}get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}async initAsync(e){const t=e.data,r=await qM(t).then(void 0,this.rejectReady);if(this.destroyed)return;const o=this.props.width&&this.props.height?{width:this.props.width,height:this.props.height}:this.getTextureDataSize(r);if(!o)throw new Error("Texture size could not be determined");const p={...o,...e,data:void 0,mipLevels:1},_=this.device.getMipLevelCount(p.width,p.height);if(p.mipLevels=this.props.mipLevels==="auto"?_:Math.min(_,this.props.mipLevels),this.texture=this.device.createTexture(p),this.sampler=this.texture.sampler,this.view=this.texture.view,e.data)switch(this.props.dimension){case"1d":this._setTexture1DData(this.texture,r);break;case"2d":this._setTexture2DData(r);break;case"3d":this._setTexture3DData(this.texture,r);break;case"2d-array":this._setTextureArrayData(this.texture,r);break;case"cube":this._setTextureCubeData(this.texture,r);break;case"cube-array":this._setTextureCubeArrayData(this.texture,r);break}this.props.mipmaps&&this.generateMipmaps(),ni.info(1,`${this} loaded`),this.resolveReady()}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}generateMipmaps(){this.texture.generateMipmapsWebGL()}setSampler(e={}){this.texture.setSampler(e instanceof Yy?e:this.device.createSampler(e))}resize(e){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(e.width===this.texture.width&&e.height===this.texture.height)return!1;if(this.texture){const t=this.texture;this.texture=t.clone(e),t.destroy()}return!0}isTextureLevelData(e){const t=e==null?void 0:e.data;return ArrayBuffer.isView(t)}getTextureDataSize(e){if(!e||ArrayBuffer.isView(e))return null;if(Array.isArray(e))return this.getTextureDataSize(e[0]);if(this.device.isExternalImage(e))return this.device.getExternalImageSize(e);if(e&&typeof e=="object"&&e.constructor===Object){const r=Object.values(e)[0];return{width:r.width,height:r.height}}throw new Error("texture size deduction failed")}getCubeFaceDepth(e){switch(e){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(e)}}setTextureData(e){}_setTexture1DData(e,t){throw new Error("setTexture1DData not supported in WebGL.")}_setTexture2DData(e,t=0){if(!this.texture)throw new Error("Texture not initialized");const r=this._normalizeTextureData(e);r.length>1&&this.props.mipmaps!==!1&&ni.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let o=0;o<r.length;o++){const p=r[o];this.device.isExternalImage(p)?this.texture.copyExternalImage({image:p,depth:t,mipLevel:o,flipY:!0}):this.texture.copyImageData({data:p.data,mipLevel:o})}}_setTexture3DData(e,t){var r;if(((r=this.texture)==null?void 0:r.props.dimension)!=="3d")throw new Error(this.id);for(let o=0;o<t.length;o++)this._setTexture2DData(t[o],o)}_setTextureCubeData(e,t){var r;if(((r=this.texture)==null?void 0:r.props.dimension)!=="cube")throw new Error(this.id);for(const[o,p]of Object.entries(t)){const _=g7.indexOf(o);this._setTexture2DData(p,_)}}_setTextureArrayData(e,t){var r;if(((r=this.texture)==null?void 0:r.props.dimension)!=="2d-array")throw new Error(this.id);for(let o=0;o<t.length;o++)this._setTexture2DData(t[o],o)}_setTextureCubeArrayData(e,t){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}_setTextureCubeFaceData(e,t,r,o=0){Array.isArray(t)&&t.length>1&&this.props.mipmaps!==!1&&ni.warn(`${this.id} has mipmap and multiple LODs.`)();const p=p7.indexOf(r);this._setTexture2DData(t,p)}_normalizeTextureData(e){const t=this.texture;let r;return ArrayBuffer.isView(e)?r=[{data:e,width:t.width,height:t.height}]:Array.isArray(e)?r=e:r=[e],r}};pe(Px,"defaultProps",{...lh.defaultProps,data:null,mipmaps:!1});let i1=Px;async function qM(i){if(i=await i,Array.isArray(i))return await Promise.all(i.map(qM));if(i&&typeof i=="object"&&i.constructor===Object){const e=i,t=await Promise.all(Object.values(e)),r=Object.keys(e),o={};for(let p=0;p<r.length;p++)o[r[p]]=t[p];return o}return i}const u_=2,m7=1e4,Ix=class Ix{constructor(e,t){pe(this,"device");pe(this,"id");pe(this,"source");pe(this,"vs");pe(this,"fs");pe(this,"pipelineFactory");pe(this,"shaderFactory");pe(this,"userData",{});pe(this,"parameters");pe(this,"topology");pe(this,"bufferLayout");pe(this,"isInstanced");pe(this,"instanceCount",0);pe(this,"vertexCount");pe(this,"indexBuffer",null);pe(this,"bufferAttributes",{});pe(this,"constantAttributes",{});pe(this,"bindings",{});pe(this,"vertexArray");pe(this,"transformFeedback",null);pe(this,"pipeline");pe(this,"shaderInputs");pe(this,"_uniformStore");pe(this,"_attributeInfos",{});pe(this,"_gpuGeometry",null);pe(this,"props");pe(this,"_pipelineNeedsUpdate","newly created");pe(this,"_needsRedraw","initializing");pe(this,"_destroyed",!1);pe(this,"_lastDrawTimestamp",-1);pe(this,"_lastLogTime",0);pe(this,"_logOpen",!1);pe(this,"_drawCount",0);var M,D,B,j;this.props={...Ix.defaultProps,...t},t=this.props,this.id=t.id||O1("model"),this.device=e,Object.assign(this.userData,t.userData);const r=Object.fromEntries(((M=this.props.modules)==null?void 0:M.map($=>[$.name,$]))||[]),o=t.shaderInputs||new h7(r,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(o);const p=y7(e),_=(((D=this.props.modules)==null?void 0:D.length)>0?this.props.modules:(B=this.shaderInputs)==null?void 0:B.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){const{source:$,getUniforms:se}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:p,...this.props,modules:_});this.source=$,this._getModuleUniforms=se,(j=this.props).shaderLayout||(j.shaderLayout=_L(this.source))}else{const{vs:$,fs:se,getUniforms:de}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:p,...this.props,modules:_});this.vs=$,this.fs=se,this._getModuleUniforms=de}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,t.geometry&&this.setGeometry(t.geometry),this.pipelineFactory=t.pipelineFactory||WA.getDefaultPipelineFactory(this.device),this.shaderFactory=t.shaderFactory||ZA.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({shaderLayout:this.pipeline.shaderLayout,bufferLayout:this.pipeline.bufferLayout}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in t&&(this.isInstanced=t.isInstanced),t.instanceCount&&this.setInstanceCount(t.instanceCount),t.vertexCount&&this.setVertexCount(t.vertexCount),t.indexBuffer&&this.setIndexBuffer(t.indexBuffer),t.attributes&&this.setAttributes(t.attributes),t.constantAttributes&&this.setConstantAttributes(t.constantAttributes),t.bindings&&this.setBindings(t.bindings),t.transformFeedback&&(this.transformFeedback=t.transformFeedback),Object.seal(this)}get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}destroy(){var e;this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),(e=this._gpuGeometry)==null||e.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||(this._needsRedraw=e)}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){const t=this._areBindingsLoading();if(t)return ni.info(u_,`>>> DRAWING ABORTED ${this.id}: ${t} not loaded`)(),!1;try{e.pushDebugGroup(`${this}.predraw(${e})`),this.predraw()}finally{e.popDebugGroup()}let r;try{e.pushDebugGroup(`${this}.draw(${e})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();const o=this._getBindings();this.pipeline.setBindings(o,{disableWarnings:this.props.disableWarnings});const{indexBuffer:p}=this.vertexArray,_=p?p.byteLength/(p.indexType==="uint32"?4:2):void 0;r=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:_,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{e.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(e),r?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",r}setGeometry(e){var r;(r=this._gpuGeometry)==null||r.destroy();const t=e&&e7(this.device,e);if(t){this.setTopology(t.topology||"triangle-list");const o=new Hb(this.bufferLayout);this.bufferLayout=o.mergeBufferLayouts(t.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(t)}this._gpuGeometry=t}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){const t=new Hb(this.bufferLayout);this.bufferLayout=this._gpuGeometry?t.mergeBufferLayouts(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({shaderLayout:this.pipeline.shaderLayout,bufferLayout:this.pipeline.bufferLayout}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){XA(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new Vz(this.shaderInputs.modules);for(const[t,r]of Object.entries(this.shaderInputs.modules))if(_7(r)){const o=this._uniformStore.getManagedUniformBuffer(this.device,t);this.bindings[`${t}Uniforms`]=o}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,t){const r=(t==null?void 0:t.disableWarnings)??this.props.disableWarnings;e.indices&&ni.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)(),this.bufferLayout=s7(this.pipeline.shaderLayout,this.bufferLayout);const o=new Hb(this.bufferLayout);for(const[p,_]of Object.entries(e)){const l=o.getBufferLayout(p);if(!l){r||ni.warn(`Model(${this.id}): Missing layout for buffer "${p}".`)();continue}const M=o.getAttributeNamesForBuffer(l);let D=!1;for(const B of M){const j=this._attributeInfos[B];if(j){const $=this.device.type==="webgpu"?o.getBufferIndex(j.bufferName):j.location;this.vertexArray.setBuffer($,_),D=!0}}!D&&!r&&ni.warn(`Model(${this.id}): Ignoring buffer "${_.id}" for unknown attribute "${p}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,t){for(const[r,o]of Object.entries(e)){const p=this._attributeInfos[r];p?this.vertexArray.setConstantWebGL(p.location,o):((t==null?void 0:t.disableWarnings)??this.props.disableWarnings)||ni.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${r}"`)()}this.setNeedsRedraw("constants")}_areBindingsLoading(){for(const e of Object.values(this.bindings))if(e instanceof i1&&!e.isReady)return e.id;return!1}_getBindings(){const e={};for(const[t,r]of Object.entries(this.bindings))r instanceof i1?r.isReady&&(e[t]=r.texture):e[t]=r;return e}_getBindingsUpdateTimestamp(){let e=0;for(const t of Object.values(this.bindings))t instanceof Kv?e=Math.max(e,t.texture.updateTimestamp):t instanceof xa||t instanceof lh?e=Math.max(e,t.updateTimestamp):t instanceof i1?e=t.texture?Math.max(e,t.texture.updateTimestamp):1/0:t instanceof Yy||(e=Math.max(e,t.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const t={...e.attributes};for(const[r]of Object.entries(t))!this.pipeline.shaderLayout.attributes.find(o=>o.name===r)&&r!=="positions"&&delete t[r];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(t,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||(this._pipelineNeedsUpdate=e),this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,t=null;this.pipeline&&(ni.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,t=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const r=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders});let o=null;this.source?o=r:this.fs&&(o=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:r,fs:o}),this._attributeInfos=JE(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),t&&this.shaderFactory.release(t)}return this.pipeline}_logDrawCallStart(){const e=ni.level>3?0:m7;ni.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,ni.group(u_,`>>> DRAWING MODEL ${this.id}`,{collapsed:ni.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=n7(this.pipeline.shaderLayout,this.id);ni.table(u_,e)();const t=this.shaderInputs.getDebugTable();ni.table(u_,t)();const r=this._getAttributeDebugTable();ni.table(u_,this._attributeInfos)(),ni.table(u_,r)(),ni.groupEnd(u_)(),this._logOpen=!1}}_logFramebuffer(e){const t=this.device.props.debugFramebuffers;if(this._drawCount++,!t)return;const r=e.props.framebuffer;r&&r7(r,{id:r.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[t,r]of Object.entries(this._attributeInfos)){const o=this.vertexArray.attributes[r.location];e[r.location]={name:t,type:r.shaderType,values:o?this._getBufferOrConstantValues(o,r.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){const{indexBuffer:t}=this.vertexArray,r=t.indexType==="uint32"?new Uint32Array(t.debugData):new Uint16Array(t.debugData);e.indices={name:"indices",type:t.indexType,values:r.toString()}}return e}_getBufferOrConstantValues(e,t){const r=Ew(t);return(e instanceof xa?new r(e.debugData):e).toString()}};pe(Ix,"defaultProps",{...__.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:Jv.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0});let Qg=Ix;function _7(i){return!!(i.uniformTypes&&!v7(i.uniformTypes))}function y7(i){return{type:i.type,shaderLanguage:i.info.shadingLanguage,shaderLanguageVersion:i.info.shadingLanguageVersion,gpu:i.info.gpu,features:i.features}}function v7(i){for(const e in i)return!1;return!0}const c1=class c1{constructor(e,t=c1.defaultProps){pe(this,"device");pe(this,"model");pe(this,"transformFeedback");if(!c1.isSupported(e))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=e,this.model=new Qg(this.device,{id:t.id||"buffer-transform-model",fs:t.fs||NB(),topology:t.topology||"point-list",varyings:t.outputs||t.varyings,...t}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:t.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}static isSupported(e){var t;return((t=e==null?void 0:e.info)==null?void 0:t.type)==="webgl"}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){e!=null&&e.inputBuffers&&this.model.setAttributes(e.inputBuffers),e!=null&&e.outputBuffers&&this.transformFeedback.setBuffers(e.outputBuffers);const t=this.device.beginRenderPass(e);this.model.draw(t),t.end()}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const t=this.getBuffer(e);if(!t)throw new Error("BufferTransform#getBuffer");if(t instanceof xa)return t.readAsync();const{buffer:r,byteOffset:o=0,byteLength:p=r.byteLength}=t;return r.readAsync(o,p)}};pe(c1,"defaultProps",{...Qg.defaultProps,outputs:void 0,feedbackBuffers:void 0});let x1=c1;class Hw{constructor(e){pe(this,"id");pe(this,"topology");pe(this,"vertexCount");pe(this,"indices");pe(this,"attributes");pe(this,"userData",{});const{attributes:t={},indices:r=null,vertexCount:o=null}=e;this.id=e.id||O1("geometry"),this.topology=e.topology,r&&(this.indices=ArrayBuffer.isView(r)?{value:r,size:1}:r),this.attributes={};for(const[p,_]of Object.entries(t)){const l=ArrayBuffer.isView(_)?{value:_}:_;if(!ArrayBuffer.isView(l.value))throw new Error(`${this._print(p)}: must be typed array or object with value as typed array`);if((p==="POSITION"||p==="positions")&&!l.size&&(l.size=3),p==="indices"){if(this.indices)throw new Error("Multiple indices detected");this.indices=l}else this.attributes[p]=l}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=o||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,t){return this}_calculateVertexCount(e,t){if(t)return t.value.length;let r=1/0;for(const o of Object.values(e)){const{value:p,size:_,constant:l}=o;!l&&p&&_!==void 0&&_>=1&&(r=Math.min(r,p.length/_))}return r}}const x7={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant",blendAlphaDstFactor:"zero"};class YM extends Xw{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:t,views:r,viewports:o,onViewportActive:p,pickingFBO:_,deviceRect:{x:l,y:M,width:D,height:B},cullRect:j,effects:$,pass:se="picking",pickZ:de,shaderModuleProps:Ae}){this.pickZ=de;const he=this._resetColorEncoder(de),Le=[l,M,D,B],$e=super.render({target:_,layers:e,layerFilter:t,views:r,viewports:o,onViewportActive:p,cullRect:j,effects:$==null?void 0:$.filter(Je=>Je.useInPicking),pass:se,isPicking:!0,shaderModuleProps:Ae,clearColor:[0,0,0,0],colorMask:15,scissorRect:Le});return this._colorEncoderState=null,{decodePickingColor:he&&A7.bind(null,he),stats:$e}}shouldDrawLayer(e){const{pickable:t,operation:r}=e.props;return t&&r.includes("draw")||r.includes("terrain")||r.includes("mask")}getShaderModuleProps(e,t,r){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(e,t,r){const o={...e.props.parameters},{pickable:p,operation:_}=e.props;return!this._colorEncoderState||_.includes("terrain")?o.blend=!1:p&&_.includes("draw")&&(Object.assign(o,x7),o.blend=!0,o.blendColor=b7(this._colorEncoderState,e,r)),o}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function b7(i,e,t){const{byLayer:r,byAlpha:o}=i;let p,_=r.get(e);return _?(_.viewports.push(t),p=_.a):(p=r.size+1,p<=255?(_={a:p,layer:e,viewports:[t]},r.set(e,_),o[p]=_):(Wr.warn("Too many pickable layers, only picking the first 255")(),p=0)),[0,0,0,p/255]}function A7(i,e){const t=i.byAlpha[e[3]];return t&&{pickedLayer:t.layer,pickedViewports:t.viewports,pickedObjectIndex:t.layer.decodePickingColor(e)}}const ky={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},dx=Symbol.for("component"),v_=Symbol.for("propTypes"),$b=Symbol.for("deprecatedProps"),$y=Symbol.for("asyncPropDefaults"),R_=Symbol.for("asyncPropOriginal"),Zg=Symbol.for("asyncPropResolved");function Kg(i,e=()=>!0){return Array.isArray(i)?JM(i,e,[]):e(i)?[i]:[]}function JM(i,e,t){let r=-1;for(;++r<i.length;){const o=i[r];Array.isArray(o)?JM(o,e,t):e(o)&&t.push(o)}return t}function w7({target:i,source:e,start:t=0,count:r=1}){const o=e.length,p=r*o;let _=0;for(let l=t;_<o;_++)i[l++]=e[_];for(;_<p;)_<p-_?(i.copyWithin(t+_,t,t+_),_*=2):(i.copyWithin(t+_,t,t+p-_),_=p);return i}class T7{constructor(e,t,r){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=r,this.setData(t)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,t){if(e===this._data&&!t)return;this._data=e;const r=++this._loadCount;let o=e;typeof e=="string"&&(o=Uv(e)),o instanceof Promise?(this.isLoaded=!1,this._loader=o.then(p=>{this._loadCount===r&&(this.isLoaded=!0,this._error=void 0,this._content=p)}).catch(p=>{this._loadCount===r&&(this.isLoaded=!0,this._error=p||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const p of this._subscribers)p.onChange(this.getData())}}class S7{constructor(e){var t;this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:(t=e.device)==null?void 0:t.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:t,forceUpdate:r=!1,persistent:o=!0}){let p=this._resources[e];p?p.setData(t,r):(p=new T7(e,t,this._context),this._resources[e]=p),p.persistent=o}remove(e){const t=this._resources[e];t&&(t.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const t=this._consumers[e];if(t){for(const r in t){const o=t[r],p=this._resources[o.resourceId];p&&p.unsubscribe(o)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:t,consumerId:r,requestId:o="default"}){const{_resources:p,protocol:_}=this;e.startsWith(_)&&(e=e.replace(_,""),p[e]||this.add({resourceId:e,data:null,persistent:!1}));const l=p[e];if(this._track(r,o,l,t),l)return l.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,t,r,o){const p=this._consumers,_=p[e]=p[e]||{};let l=_[t];const M=l&&l.resourceId&&this._resources[l.resourceId];M&&(M.unsubscribe(l),this.prune()),r&&(l?(l.onChange=o,l.resourceId=r.id):l={onChange:o,resourceId:r.id},_[t]=l,r.subscribe(l))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const t=this._resources[e];!t.persistent&&!t.inUse()&&(t.delete(),delete this._resources[e])}}}const E7="layerManager.setLayers",M7="layerManager.activateViewport";class R7{constructor(e,t){var l;this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=M=>{Dc(M7,this,M),M&&(this.context.viewport=M)};const{deck:r,stats:o,viewport:p,timeline:_}=t||{};this.layers=[],this.resourceManager=new S7({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e==null?void 0:e.gl,deck:r,shaderAssembler:wV(((l=e==null?void 0:e.info)==null?void 0:l.shadingLanguage)||"glsl"),defaultShaderModules:[kU],renderPass:void 0,stats:o||new kx({id:"deck.gl"}),viewport:p||new s2({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:_||new $M,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const r of this.layers){const o=r.getNeedsRedraw(e);t=t||o}return t}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(t=>e.find(r=>t.id.indexOf(r)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,t){Dc(E7,this,t,e),this._lastRenderedLayers=e;const r=Kg(e,Boolean);for(const o of r)o.context=this.context;this._updateLayers(this.layers,r)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:t}=this.context;t.find(r=>r.name===e.name)||(t.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:t}=this.context,r=t.findIndex(o=>o.name===e.name);r>=0&&(t.splice(r,1),this._defaultShaderModulesChanged=!0)}_handleError(e,t,r){r.raiseError(t,`${e} of ${r}`)}_updateLayers(e,t){const r={};for(const _ of e)r[_.id]?Wr.warn(`Multiple old layers with same id ${_.id}`)():r[_.id]=_;if(this._defaultShaderModulesChanged){for(const _ of e)_.setNeedsUpdate(),_.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const o=[];this._updateSublayersRecursively(t,r,o),this._finalizeOldLayers(r);let p=!1;for(const _ of o)if(_.hasUniformTransition()){p=`Uniform transition in ${_}`;break}this._needsUpdate=p,this.layers=o}_updateSublayersRecursively(e,t,r){for(const o of e){o.context=this.context;const p=t[o.id];p===null&&Wr.warn(`Multiple new layers with same id ${o.id}`)(),t[o.id]=null;let _=null;try{this._debug&&p!==o&&o.validateProps(),p?(this._transferLayerState(p,o),this._updateLayer(o)):this._initializeLayer(o),r.push(o),_=o.isComposite?o.getSubLayers():null}catch(l){this._handleError("matching",l,o)}_&&this._updateSublayersRecursively(_,t,r)}}_finalizeOldLayers(e){for(const t in e){const r=e[t];r&&this._finalizeLayer(r)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=ky.INITIALIZED}catch(t){this._handleError("initialization",t,e)}}_transferLayerState(e,t){t._transferState(e),t.lifecycle=ky.MATCHED,t!==e&&(e.lifecycle=ky.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(t){this._handleError("update",t,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=ky.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=ky.FINALIZED}catch(t){this._handleError("finalization",t,e)}}}function cu(i,e,t){if(i===e)return!0;if(!t||!i||!e)return!1;if(Array.isArray(i)){if(!Array.isArray(e)||i.length!==e.length)return!1;for(let r=0;r<i.length;r++)if(!cu(i[r],e[r],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof i=="object"&&typeof e=="object"){const r=Object.keys(i),o=Object.keys(e);if(r.length!==o.length)return!1;for(const p of r)if(!e.hasOwnProperty(p)||!cu(i[p],e[p],t-1))return!1;return!0}return!1}class C7{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const t=this.controllers[e];t&&t.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const t=this.controllers[e];t&&t.updateTransition()}}getViewports(e){return e?this._viewports.filter(t=>t.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(t=>{e[t.id]=t}),e}getView(e){return this.views.find(t=>t.id===e)}getViewState(e){const t=typeof e=="string"?this.getView(e):e,r=t&&this.viewState[t.getViewStateId()]||this.viewState;return t?t.filterViewState(r):r}getViewport(e){return this._viewportMap[e]}unproject(e,t){const r=this.getViewports(),o={x:e[0],y:e[1]};for(let p=r.length-1;p>=0;--p){const _=r[p];if(_.containsPixel(o)){const l=e.slice();return l[0]-=_.x,l[1]-=_.y,_.unproject(l,t)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,t){(e!==this.width||t!==this.height)&&(this.width=e,this.height=t,this.setNeedsUpdate("Size changed"))}_setViews(e){e=Kg(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!cu(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):Wr.warn("missing `viewState` or `initialViewState`")()}_createController(e,t){const r=t.type;return new r({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:p=>{var _;return(_=this.getView(e.id))==null?void 0:_.makeViewport({viewState:p,width:this.width,height:this.height})}})}_updateController(e,t,r,o){const p=e.controller;if(p&&r){const _={...t,...p,id:e.id,x:r.x,y:r.y,width:r.width,height:r.height};return(!o||o.constructor!==p.type)&&(o=this._createController(e,_)),o&&o.setProps(_),o}return null}_rebuildViewports(){const{views:e}=this,t=this.controllers;this._viewports=[],this.controllers={};let r=!1;for(let o=e.length;o--;){const p=e[o],_=this.getViewState(p),l=p.makeViewport({viewState:_,width:this.width,height:this.height});let M=t[p.id];const D=!!p.controller;D&&!M&&(r=!0),(r||!D)&&M&&(M.finalize(),M=null),this.controllers[p.id]=this._updateController(p,_,l,M),l&&this._viewports.unshift(l)}for(const o in t){const p=t[o];p&&!this.controllers[o]&&p.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,t){return e.length!==t.length?!0:e.some((r,o)=>!e[o].equals(t[o]))}}const P7=/([0-9]+\.?[0-9]*)(%|px)/;function Bg(i){switch(typeof i){case"number":return{position:i,relative:!1};case"string":const e=P7.exec(i);if(e&&e.length>=3){const t=e[2]==="%",r=parseFloat(e[1]);return{position:t?r/100:r,relative:t}}default:throw new Error(`Could not parse position string ${i}`)}}function zg(i,e){return i.relative?Math.round(i.position*e):i.position}class QM{constructor(e){const{id:t,x:r=0,y:o=0,width:p="100%",height:_="100%",padding:l=null}=e;this.id=t||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=Bg(r),this._y=Bg(o),this._width=Bg(p),this._height=Bg(_),this._padding=l&&{left:Bg(l.left||0),right:Bg(l.right||0),top:Bg(l.top||0),bottom:Bg(l.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.constructor===e.constructor&&cu(this.props,e.props,2)}clone(e){const t=this.constructor;return new t({...this.props,...e})}makeViewport({width:e,height:t,viewState:r}){r=this.filterViewState(r);const o=this.getDimensions({width:e,height:t});if(!o.height||!o.width)return null;const p=this.getViewportType(r);return new p({...r,...this.props,...o})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const t={...e};for(const r in this.props.viewState)r!=="id"&&(t[r]=this.props.viewState[r]);return t}return e}getDimensions({width:e,height:t}){const r={x:zg(this._x,e),y:zg(this._y,t),width:zg(this._width,e),height:zg(this._height,t)};return this._padding&&(r.padding={left:zg(this._padding.left,e),top:zg(this._padding.top,t),right:zg(this._padding.right,e),bottom:zg(this._padding.bottom,t)}),r}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class Bx{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){var t,r;this.cancel(),this.settings=e,this._inProgress=!0,(r=(t=this.settings).onStart)==null||r.call(t,this)}end(){var e,t;this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(t=(e=this.settings).onEnd)==null||t.call(e,this))}cancel(){var e,t;this._inProgress&&((t=(e=this.settings).onInterrupt)==null||t.call(e,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){var e,t;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:r,settings:o}=this;this._handle=r.addChannel({delay:r.getTime(),duration:o.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(t=(e=this.settings).onUpdate)==null||t.call(e,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const $4=()=>{},HA={BREAK:1,SNAP_TO_END:2,IGNORE:3},I7=i=>i,k7=HA.BREAK;class D7{constructor(e){this._onTransitionUpdate=t=>{const{time:r,settings:{interpolator:o,startProps:p,endProps:_,duration:l,easing:M}}=t,D=M(r/l),B=o.interpolateProps(p,_,D);this.propsInTransition=this.getControllerState({...this.props,...B}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new Bx(e.timeline),this.onViewStateChange=e.onViewStateChange||$4,this.onStateChange=e.onStateChange||$4}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let t=!1;const r=this.props;if(this.props=e,!r||this._shouldIgnoreViewportChange(r,e))return!1;if(this._isTransitionEnabled(e)){let o=r;if(this.transition.inProgress){const{interruption:p,endProps:_}=this.transition.settings;o={...r,...p===HA.SNAP_TO_END?_:this.propsInTransition||r}}this._triggerTransition(o,e),t=!0}else this.transition.cancel();return t}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:t,transitionInterpolator:r}=e;return(t>0||t==="auto")&&!!r}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,t){return this.transition.inProgress?this.transition.settings.interruption===HA.IGNORE||this._isUpdateDueToCurrentTransition(t):this._isTransitionEnabled(t)?t.transitionInterpolator.arePropsEqual(e,t):!0}_triggerTransition(e,t){const r=this.getControllerState(e),o=this.getControllerState(t).shortestPathFrom(r),p=t.transitionInterpolator,_=p.getDuration?p.getDuration(e,t):t.transitionDuration;if(_===0)return;const l=p.initializeProps(e,o);this.propsInTransition={};const M={duration:_,easing:t.transitionEasing||I7,interpolator:p,interruption:t.transitionInterruption||k7,startProps:l.start,endProps:l.end,onStart:t.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(t.onTransitionInterrupt),onEnd:this._onTransitionEnd(t.onTransitionEnd)};this.transition.start(M),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return t=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(t)}}}function no(i,e){if(!i)throw new Error(e||"deck.gl: assertion failed.")}class O7{constructor(e){const{compare:t,extract:r,required:o}=e;this._propsToCompare=t,this._propsToExtract=r||t,this._requiredProps=o}arePropsEqual(e,t){for(const r of this._propsToCompare)if(!(r in e)||!(r in t)||!g1(e[r],t[r]))return!1;return!0}initializeProps(e,t){const r={},o={};for(const p of this._propsToExtract)(p in e||p in t)&&(r[p]=e[p],o[p]=t[p]);return this._checkRequiredProps(r),this._checkRequiredProps(o),{start:r,end:o}}getDuration(e,t){return t.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(t=>{const r=e[t];no(Number.isFinite(r)||Array.isArray(r),`${t} is required for transition`)})}}const pv=Math.PI/180,q4=180/Math.PI,Dv=6370972,zy=256;function F7(){const i=zy/Dv,e=Math.PI/180*zy;return{unitsPerMeter:[i,i,i],unitsPerMeter2:[0,0,0],metersPerUnit:[1/i,1/i,1/i],unitsPerDegree:[e,e,i],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/e,1/e,1/i]}}class $w extends s2{constructor(e={}){const{longitude:t=0,zoom:r=0,nearZMultiplier:o=.5,farZMultiplier:p=1,resolution:_=10}=e;let{latitude:l=0,height:M,altitude:D=1.5,fovy:B}=e;l=Math.max(Math.min(l,o0),-o0),M=M||1,B?D=Gw(B):B=y1(D);const j=Math.pow(2,r-Ly(l)),$=e.nearZ??o,se=e.farZ??(D+zy*2*j/M)*p,de=new ed().lookAt({eye:[0,-D,0],up:[0,0,1]});de.rotateX(l*pv),de.rotateZ(-t*pv),de.scale(j/M),super({...e,height:M,viewMatrix:de,longitude:t,latitude:l,zoom:r,distanceScales:F7(),fovy:B,focalDistance:D,near:$,far:se}),this.scale=j,this.latitude=l,this.longitude=t,this.fovy=B,this.resolution=_}get projectionMode(){return ch.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(e={}){const t={targetZ:e.z||0},r=this.unproject([0,this.height/2],t),o=this.unproject([this.width/2,0],t),p=this.unproject([this.width,this.height/2],t),_=this.unproject([this.width/2,this.height],t);return p[0]<this.longitude&&(p[0]+=360),r[0]>this.longitude&&(r[0]-=360),[Math.min(r[0],p[0],o[0],_[0]),Math.min(r[1],p[1],o[1],_[1]),Math.max(r[0],p[0],o[0],_[0]),Math.max(r[1],p[1],o[1],_[1])]}unproject(e,{topLeft:t=!0,targetZ:r}={}){const[o,p,_]=e,l=t?p:this.height-p,{pixelUnprojectionMatrix:M}=this;let D;if(Number.isFinite(_))D=qb(M,[o,l,_,1]);else{const se=qb(M,[o,l,-1,1]),de=qb(M,[o,l,1,1]),Ae=((r||0)/Dv+1)*zy,he=Bb(TM([],se,de)),Le=Bb(se),$e=Bb(de),Je=4*((4*Le*$e-(he-Le-$e)**2)/16)/he,Rt=Math.sqrt(Le-Je),Et=Math.sqrt(Math.max(0,Ae*Ae-Je)),kt=(Rt-Et)/Math.sqrt(he);D=zL([],se,de,kt)}const[B,j,$]=this.unprojectPosition(D);return Number.isFinite(_)?[B,j,$]:Number.isFinite(r)?[B,j,r]:[B,j]}projectPosition(e){const[t,r,o=0]=e,p=t*pv,_=r*pv,l=Math.cos(_),M=(o/Dv+1)*zy;return[Math.sin(p)*l*M,-Math.cos(p)*l*M,Math.sin(_)*M]}unprojectPosition(e){const[t,r,o]=e,p=ZL(e),_=Math.asin(o/p),M=Math.atan2(t,-r)*q4,D=_*q4,B=(p/zy-1)*Dv;return[M,D,B]}projectFlat(e){return e}unprojectFlat(e){return e}panByPosition([e,t,r],o,p){const l=.25/Math.pow(2,this.zoom-Ly(this.latitude)),M=e+l*(p[0]-o[0]);let D=t-l*(p[1]-o[1]);D=Math.max(Math.min(D,o0),-o0);const B={longitude:M,latitude:D,zoom:r-Ly(t)};return B.zoom+=Ly(B.latitude),B}}$w.displayName="GlobeViewport";function Ly(i){const e=Math.PI*Math.cos(i*Math.PI/180);return Math.log2(e)}function qb(i,e){const t=r2([],e,i);return MM(t,t,1/t[3]),t}const N7=["longitude","latitude","zoom","bearing","pitch"],B7=["longitude","latitude","zoom"];class qw extends O7{constructor(e={}){const t=Array.isArray(e)?e:e.transitionProps,r=Array.isArray(e)?{}:e;r.transitionProps=Array.isArray(t)?{compare:t,required:t}:t||{compare:N7,required:B7},super(r.transitionProps),this.opts=r}initializeProps(e,t){const r=super.initializeProps(e,t),{makeViewport:o,around:p}=this.opts;if(o&&p)if(o(e)instanceof $w)Wr.warn("around not supported in GlobeView")();else{const l=o(e),M=o(t),D=l.unproject(p);r.start.around=p,Object.assign(r.end,{around:M.project(D),aroundPosition:D,width:t.width,height:t.height})}return r}interpolateProps(e,t,r){const o={};for(const p of this._propsToExtract)o[p]=cx(e[p]||0,t[p]||0,r);if(t.aroundPosition&&this.opts.makeViewport){const p=this.opts.makeViewport({...t,...o});Object.assign(o,p.panByPosition(t.aroundPosition,cx(e.around,t.around,r)))}return o}}const Ep={transitionDuration:0},z7=300,gv=i=>1-(1-i)*(1-i),Py={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],MULTI_PAN:["multipanstart","multipanmove","multipanend"],DOUBLE_CLICK:["dblclick"],KEYBOARD:["keydown"]},h_={};class KM{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new D7({...e,getControllerState:t=>new this.ControllerState(t),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){var e;for(const t in this._events)this._events[t]&&((e=this.eventManager)==null||e.off(t,this.handleEvent));this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const t=this._eventStartBlocked;switch(e.type){case"panstart":return t?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return t?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"multipanstart":return t?!1:this._onMultiPanStart(e);case"multipanmove":return this._onMultiPan(e);case"multipanend":return this._onMultiPanEnd(e);case"dblclick":return this._onDoubleClick(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:t,y:r}=this.props,{offsetCenter:o}=e;return[o.x-t,o.y-r]}isPointInBounds(e,t){const{width:r,height:o}=this.props;if(t&&t.handled)return!1;const p=e[0]>=0&&e[0]<=r&&e[1]>=0&&e[1]<=o;return p&&t&&t.stopPropagation(),p}isFunctionKeyPressed(e){const{srcEvent:t}=e;return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const t=setTimeout(()=>{this._eventStartBlocked===t&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=t}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:t}=e;this.inertia=Number.isFinite(t)?t:t===!0?z7:0;const{scrollZoom:r=!0,dragPan:o=!0,dragRotate:p=!0,doubleClickZoom:_=!0,touchZoom:l=!0,touchRotate:M=!1,keyboard:D=!0}=e,B=!!this.onViewStateChange;this.toggleEvents(Py.WHEEL,B&&r),this.toggleEvents(Py.PAN,B),this.toggleEvents(Py.PINCH,B&&(l||M)),this.toggleEvents(Py.MULTI_PAN,B&&M),this.toggleEvents(Py.DOUBLE_CLICK,B&&_),this.toggleEvents(Py.KEYBOARD,B&&D),this.scrollZoom=r,this.dragPan=o,this.dragRotate=p,this.doubleClickZoom=_,this.touchZoom=l,this.touchRotate=M,this.keyboard=D}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,t){this.eventManager&&e.forEach(r=>{this._events[r]!==t&&(this._events[r]=t,t?this.eventManager.on(r,this.handleEvent):this.eventManager.off(r,this.handleEvent))})}updateViewport(e,t=null,r={}){const o={...e.getViewportProps(),...t},p=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(r),p){const _=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:o,interactionState:this._interactionState,oldViewState:_,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let r=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(r=!r);const o=this.controllerState[r?"panStart":"rotateStart"]({pos:t});return this._panMove=r,this.updateViewport(o,Ep,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const t=this.getCenter(e),r=this.controllerState.pan({pos:t});return this.updateViewport(r,Ep,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:t}=this;if(this.dragPan&&t&&e.velocity){const r=this.getCenter(e),o=[r[0]+e.velocityX*t/2,r[1]+e.velocityY*t/2],p=this.controllerState.pan({pos:o}).panEnd();this.updateViewport(p,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:gv},{isDragging:!1,isPanning:!0})}else{const r=this.controllerState.panEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const t=this.getCenter(e),r=this.controllerState.rotate({pos:t});return this.updateViewport(r,Ep,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:t}=this;if(this.dragRotate&&t&&e.velocity){const r=this.getCenter(e),o=[r[0]+e.velocityX*t/2,r[1]+e.velocityY*t/2],p=this.controllerState.rotate({pos:o}).rotateEnd();this.updateViewport(p,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:gv},{isDragging:!1,isRotating:!0})}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;e.srcEvent.preventDefault();const{speed:r=.01,smooth:o=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:p}=e;let _=2/(1+Math.exp(-Math.abs(p*r)));p<0&&_!==0&&(_=1/_);const l=o?{...this._getTransitionProps({around:t}),transitionDuration:250}:Ep,M=this.controllerState.zoom({pos:t,scale:_});return this.updateViewport(M,l,{isZooming:!0,isPanning:!0}),o||this._setInteractionState({isZooming:!1,isPanning:!1}),!0}_onMultiPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const r=this.controllerState.rotateStart({pos:t});return this.updateViewport(r,Ep,{isDragging:!0}),!0}_onMultiPan(e){if(!this.touchRotate||!this.isDragging())return!1;const t=this.getCenter(e);t[0]-=e.deltaX;const r=this.controllerState.rotate({pos:t});return this.updateViewport(r,Ep,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this;if(this.touchRotate&&t&&e.velocityY){const r=this.getCenter(e),o=[r[0],r[1]+=e.velocityY*t/2],p=this.controllerState.rotate({pos:o});this.updateViewport(p,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:gv},{isDragging:!1,isRotating:!0}),this.blockEvents(t)}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const r=this.controllerState.zoomStart({pos:t}).rotateStart({pos:t});return h_._startPinchRotation=e.rotation,h_._lastPinchEvent=e,this.updateViewport(r,Ep,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let t=this.controllerState;if(this.touchZoom){const{scale:r}=e,o=this.getCenter(e);t=t.zoom({pos:o,scale:r})}if(this.touchRotate){const{rotation:r}=e;t=t.rotate({deltaAngleX:h_._startPinchRotation-r})}return this.updateViewport(t,Ep,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),h_._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this,{_lastPinchEvent:r}=h_;if(this.touchZoom&&t&&r&&e.scale!==r.scale){const o=this.getCenter(e);let p=this.controllerState.rotateEnd();const _=Math.log2(e.scale),l=(_-Math.log2(r.scale))/(e.deltaTime-r.deltaTime),M=Math.pow(2,_+l*t/2);p=p.zoom({pos:o,scale:M}).zoomEnd(),this.updateViewport(p,{...this._getTransitionProps({around:o}),transitionDuration:t,transitionEasing:gv},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(t)}else{const o=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(o,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return h_._startPinchRotation=null,h_._lastPinchEvent=null,!0}_onDoubleClick(e){if(!this.doubleClickZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const r=this.isFunctionKeyPressed(e),o=this.controllerState.zoom({pos:t,scale:r?.5:2});return this.updateViewport(o,this._getTransitionProps({around:t}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const t=this.isFunctionKeyPressed(e),{zoomSpeed:r,moveSpeed:o,rotateSpeedX:p,rotateSpeedY:_}=this.keyboard===!0?{}:this.keyboard,{controllerState:l}=this;let M;const D={};switch(e.srcEvent.code){case"Minus":M=t?l.zoomOut(r).zoomOut(r):l.zoomOut(r),D.isZooming=!0;break;case"Equal":M=t?l.zoomIn(r).zoomIn(r):l.zoomIn(r),D.isZooming=!0;break;case"ArrowLeft":t?(M=l.rotateLeft(p),D.isRotating=!0):(M=l.moveLeft(o),D.isPanning=!0);break;case"ArrowRight":t?(M=l.rotateRight(p),D.isRotating=!0):(M=l.moveRight(o),D.isPanning=!0);break;case"ArrowUp":t?(M=l.rotateUp(_),D.isRotating=!0):(M=l.moveUp(o),D.isPanning=!0);break;case"ArrowDown":t?(M=l.rotateDown(_),D.isRotating=!0):(M=l.moveDown(o),D.isPanning=!0);break;default:return!1}return this.updateViewport(M,this._getTransitionProps(),D),!0}_getTransitionProps(e){const{transition:t}=this;return!t||!t.transitionInterpolator?Ep:e?{...t,transitionInterpolator:new qw({...e,...t.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:t}}class L7{constructor(e,t){this._viewportProps=this.applyConstraints(e),this._state=t}getViewportProps(){return this._viewportProps}getState(){return this._state}}const Y4=5,U7=1.2;class eR extends L7{constructor(e){const{width:t,height:r,latitude:o,longitude:p,zoom:_,bearing:l=0,pitch:M=0,altitude:D=1.5,position:B=[0,0,0],maxZoom:j=20,minZoom:$=0,maxPitch:se=60,minPitch:de=0,startPanLngLat:Ae,startZoomLngLat:he,startRotatePos:Le,startBearing:$e,startPitch:Be,startZoom:Je,normalize:Rt=!0}=e;no(Number.isFinite(p)),no(Number.isFinite(o)),no(Number.isFinite(_)),super({width:t,height:r,latitude:o,longitude:p,zoom:_,bearing:l,pitch:M,altitude:D,maxZoom:j,minZoom:$,maxPitch:se,minPitch:de,normalize:Rt,position:B},{startPanLngLat:Ae,startZoomLngLat:he,startRotatePos:Le,startBearing:$e,startPitch:Be,startZoom:Je}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:t}){const r=this.getState().startPanLngLat||this._unproject(t);if(!r)return this;const p=this.makeViewport(this.getViewportProps()).panByPosition(r,e);return this._getUpdatedState(p)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:t=0,deltaAngleY:r=0}){const{startRotatePos:o,startBearing:p,startPitch:_}=this.getState();if(!o||p===void 0||_===void 0)return this;let l;return e?l=this._getNewRotation(e,o,_,p):l={bearing:p+t,pitch:_+r},this._getUpdatedState(l)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:t,scale:r}){let{startZoom:o,startZoomLngLat:p}=this.getState();if(p||(o=this.getViewportProps().zoom,p=this._unproject(t)||this._unproject(e)),!p)return this;const{maxZoom:_,minZoom:l}=this.getViewportProps();let M=o+Math.log2(r);M=a0(M,l,_);const D=this.makeViewport({...this.getViewportProps(),zoom:M});return this._getUpdatedState({zoom:M,...D.panByPosition(p,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const t=e.getViewportProps(),r={...this.getViewportProps()},{bearing:o,longitude:p}=r;return Math.abs(o-t.bearing)>180&&(r.bearing=o<0?o+360:o-360),Math.abs(p-t.longitude)>180&&(r.longitude=p<0?p+360:p-360),r}applyConstraints(e){const{maxZoom:t,minZoom:r,zoom:o}=e;e.zoom=a0(o,r,t);const{maxPitch:p,minPitch:_,pitch:l}=e;e.pitch=a0(l,_,p);const{normalize:M=!0}=e;return M&&Object.assign(e,oV(e)),e}_zoomFromCenter(e){const{width:t,height:r}=this.getViewportProps();return this.zoom({pos:[t/2,r/2],scale:e})}_panFromCenter(e){const{width:t,height:r}=this.getViewportProps();return this.pan({startPos:[t/2,r/2],pos:[t/2+e[0],r/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const t=this.makeViewport(this.getViewportProps());return e&&t.unproject(e)}_getNewRotation(e,t,r,o){const p=e[0]-t[0],_=e[1]-t[1],l=e[1],M=t[1],{width:D,height:B}=this.getViewportProps(),j=p/D;let $=0;_>0?Math.abs(B-M)>Y4&&($=_/(M-B)*U7):_<0&&M>Y4&&($=1-l/M),$=a0($,-1,1);const{minPitch:se,maxPitch:de}=this.getViewportProps(),Ae=o+180*j;let he=r;return $>0?he=r+$*(de-r):$<0&&(he=r-$*(se-r)),{pitch:he,bearing:Ae}}}class V7 extends KM{constructor(){super(...arguments),this.ControllerState=eR,this.transition={transitionDuration:300,transitionInterpolator:new qw({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const t=this.props;super.setProps(e),(!t||t.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}let Yw=class extends QM{constructor(e={}){super(e)}getViewportType(){return M_}get ControllerType(){return V7}};Yw.displayName="MapView";const j7=new XM;function G7(i,e){const t=i.order??1/0,r=e.order??1/0;return t-r}class W7{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const t=this._defaultEffects;if(!t.find(r=>r.id===e.id)){const r=t.findIndex(o=>G7(o,e)>0);r<0?t.push(e):t.splice(r,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(cu(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}getEffects(){return this._resolvedEffects}_setEffects(e){const t={};for(const o of this.effects)t[o.id]=o;const r=[];for(const o of e){const p=t[o.id];let _=o;p&&p!==o?p.setProps?(p.setProps(o.props),_=p):p.cleanup(this._context):p||o.setup(this._context),r.push(_),delete t[o.id]}for(const o in t)t[o].cleanup(this._context);this.effects=r,this._resolvedEffects=r.concat(this._defaultEffects),e.some(o=>o instanceof XM)||this._resolvedEffects.push(j7),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class Z7 extends Xw{shouldDrawLayer(e){const{operation:t}=e.props;return t.includes("draw")||t.includes("terrain")}}const X7="deckRenderer.renderLayers";class H7{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new Z7(e),this.pickLayersPass=new YM(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const t=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,r={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};r.effects&&this._preRender(r.effects,r);const o=this.lastPostProcessEffect?this.renderBuffers[0]:r.target;this.lastPostProcessEffect&&(r.clearColor=[0,0,0,0],r.clearCanvas=!0);const p=t.render({...r,target:o});r.effects&&(this.lastPostProcessEffect&&(r.clearCanvas=e.clearCanvas===void 0?!0:e.clearCanvas),this._postRender(r.effects,r)),this.renderCount++,Dc(X7,this,p,e)}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}finalize(){const{renderBuffers:e}=this;for(const t of e)t.delete();e.length=0}_preRender(e,t){this.lastPostProcessEffect=null,t.preRenderStats=t.preRenderStats||{};for(const r of e)t.preRenderStats[r.id]=r.preRender(t),r.postRender&&(this.lastPostProcessEffect=r.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,t=this.device.canvasContext.getDrawingBufferSize(),[r,o]=t;e.length===0&&[0,1].map(p=>{const _=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"},width:r,height:o});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${p}`,colorAttachments:[_]}))});for(const p of e)p.resize(t)}_postRender(e,t){const{renderBuffers:r}=this,o={...t,inputBuffer:r[0],swapBuffer:r[1]};for(const p of e)if(p.postRender){o.target=p.id===this.lastPostProcessEffect?t.target:void 0;const _=p.postRender(o);o.inputBuffer=_,o.swapBuffer=_===r[0]?r[1]:r[0]}}}const $7={pickedColor:null,pickedObjectIndex:-1};function J4({pickedColors:i,decodePickingColor:e,deviceX:t,deviceY:r,deviceRadius:o,deviceRect:p}){const{x:_,y:l,width:M,height:D}=p;let B=o*o,j=-1,$=0;for(let se=0;se<D;se++){const de=se+l-r,Ae=de*de;if(Ae>B)$+=4*M;else for(let he=0;he<M;he++){if(i[$+3]-1>=0){const $e=he+_-t,Be=$e*$e+Ae;Be<=B&&(B=Be,j=$)}$+=4}}if(j>=0){const se=i.slice(j,j+4),de=e(se);if(de){const Ae=Math.floor(j/4/M),he=j/4-Ae*M;return{...de,pickedColor:se,pickedX:_+he,pickedY:l+Ae}}Wr.error("Picked non-existent layer. Is picking buffer corrupt?")()}return $7}function Q4({pickedColors:i,decodePickingColor:e}){const t=new Map;if(i){for(let r=0;r<i.length;r+=4)if(i[r+3]-1>=0){const p=i.slice(r,r+4),_=p.join(",");if(!t.has(_)){const l=e(p);l?t.set(_,{...l,color:p}):Wr.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(t.values())}function $A({pickInfo:i,viewports:e,pixelRatio:t,x:r,y:o,z:p}){let _=e[0];e.length>1&&(_=q7((i==null?void 0:i.pickedViewports)||e,{x:r,y:o}));let l;if(_){const M=[r-_.x,o-_.y];p!==void 0&&(M[2]=p),l=_.unproject(M)}return{color:null,layer:null,viewport:_,index:-1,picked:!1,x:r,y:o,pixel:[r,o],coordinate:l,devicePixel:i&&"pickedX"in i?[i.pickedX,i.pickedY]:void 0,pixelRatio:t}}function K4(i){const{pickInfo:e,lastPickedInfo:t,mode:r,layers:o}=i,{pickedColor:p,pickedLayer:_,pickedObjectIndex:l}=e,M=_?[_]:[];if(r==="hover"){const j=t.index,$=t.layerId,se=_?_.props.id:null;if(se!==$||l!==j){if(se!==$){const de=o.find(Ae=>Ae.props.id===$);de&&M.unshift(de)}t.layerId=se,t.index=l,t.info=null}}const D=$A(i),B=new Map;return B.set(null,D),M.forEach(j=>{let $={...D};j===_&&($.color=p,$.index=l,$.picked=!0),$=qA({layer:j,info:$,mode:r});const se=$.layer;j===_&&r==="hover"&&(t.info=$),B.set(se.id,$),r==="hover"&&se.updateAutoHighlight($)}),B}function qA({layer:i,info:e,mode:t}){for(;i&&e;){const r=e.layer||null;e.sourceLayer=r,e.layer=i,e=i.getPickingInfo({info:e,mode:t,sourceLayer:r}),i=i.parent}return e}function q7(i,e){for(let t=i.length-1;t>=0;t--){const r=i[t];if(r.containsPixel(e))return r}return i[0]}class Y7{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new YM(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObjectAsync(e){return this._pickClosestObjectAsync(e)}pickObjectsAsync(e){return this._pickVisibleObjectsAsync(e)}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:t,layers:r,viewports:o},p=this.lastPickedInfo.info){const _=p&&p.layer&&p.layer.id,l=p&&p.viewport&&p.viewport.id,M=_?r.find($=>$.id===_):null,D=l&&o.find($=>$.id===l)||o[0],B=D&&D.unproject([e-D.x,t-D.y]);return{...p,...{x:e,y:t,viewport:D,coordinate:B,layer:M}}}_resizeBuffer(){var t,r;if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const o=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=o}const{canvas:e}=this.device.getDefaultCanvasContext();(t=this.pickingFBO)==null||t.resize({width:e.width,height:e.height}),(r=this.depthFBO)==null||r.resize({width:e.width,height:e.height})}_getPickable(e){if(this._pickable===!1)return null;const t=e.filter(r=>this.pickLayersPass.shouldDrawLayer(r)&&!r.isComposite);return t.length?t:null}async _pickClosestObjectAsync({layers:e,views:t,viewports:r,x:o,y:p,radius:_=0,depth:l=1,mode:M="query",unproject3D:D,onViewportActive:B,effects:j}){const $=this.device.canvasContext.cssToDeviceRatio(),se=this._getPickable(e);if(!se||r.length===0)return{result:[],emptyInfo:$A({viewports:r,x:o,y:p,pixelRatio:$})};this._resizeBuffer();const de=this.device.canvasContext.cssToDevicePixels([o,p],!0),Ae=[de.x+Math.floor(de.width/2),de.y+Math.floor(de.height/2)],he=Math.round(_*$),{width:Le,height:$e}=this.pickingFBO,Be=this._getPickingRect({deviceX:Ae[0],deviceY:Ae[1],deviceRadius:he,deviceWidth:Le,deviceHeight:$e}),Je={x:o-_,y:p-_,width:_*2+1,height:_*2+1};let Rt;const Et=[],kt=new Set;for(let Ht=0;Ht<l;Ht++){let Xt;if(Be){const di=this._drawAndSample({layers:se,views:t,viewports:r,onViewportActive:B,deviceRect:Be,cullRect:Je,effects:j,pass:`picking:${M}`});Xt=J4({...di,deviceX:Ae[0],deviceY:Ae[1],deviceRadius:he,deviceRect:Be})}else Xt={pickedColor:null,pickedObjectIndex:-1};let hi;if(Xt.pickedLayer&&D&&this.depthFBO){const{pickedColors:di}=this._drawAndSample({layers:[Xt.pickedLayer],views:t,viewports:r,onViewportActive:B,deviceRect:{x:Xt.pickedX,y:Xt.pickedY,width:1,height:1},cullRect:Je,effects:j,pass:`picking:${M}:z`},!0);di[3]&&(hi=di[0])}Xt.pickedLayer&&Ht+1<l&&(kt.add(Xt.pickedLayer),Xt.pickedLayer.disablePickingIndex(Xt.pickedObjectIndex)),Rt=K4({pickInfo:Xt,lastPickedInfo:this.lastPickedInfo,mode:M,layers:se,viewports:r,x:o,y:p,z:hi,pixelRatio:$});for(const di of Rt.values())di.layer&&Et.push(di);if(!Xt.pickedColor)break}for(const Ht of kt)Ht.restorePickingColors();return{result:Et,emptyInfo:Rt.get(null)}}_pickClosestObject({layers:e,views:t,viewports:r,x:o,y:p,radius:_=0,depth:l=1,mode:M="query",unproject3D:D,onViewportActive:B,effects:j}){const $=this.device.canvasContext.cssToDeviceRatio(),se=this._getPickable(e);if(!se||r.length===0)return{result:[],emptyInfo:$A({viewports:r,x:o,y:p,pixelRatio:$})};this._resizeBuffer();const de=this.device.canvasContext.cssToDevicePixels([o,p],!0),Ae=[de.x+Math.floor(de.width/2),de.y+Math.floor(de.height/2)],he=Math.round(_*$),{width:Le,height:$e}=this.pickingFBO,Be=this._getPickingRect({deviceX:Ae[0],deviceY:Ae[1],deviceRadius:he,deviceWidth:Le,deviceHeight:$e}),Je={x:o-_,y:p-_,width:_*2+1,height:_*2+1};let Rt;const Et=[],kt=new Set;for(let Ht=0;Ht<l;Ht++){let Xt;if(Be){const di=this._drawAndSample({layers:se,views:t,viewports:r,onViewportActive:B,deviceRect:Be,cullRect:Je,effects:j,pass:`picking:${M}`});Xt=J4({...di,deviceX:Ae[0],deviceY:Ae[1],deviceRadius:he,deviceRect:Be})}else Xt={pickedColor:null,pickedObjectIndex:-1};let hi;if(Xt.pickedLayer&&D&&this.depthFBO){const{pickedColors:di}=this._drawAndSample({layers:[Xt.pickedLayer],views:t,viewports:r,onViewportActive:B,deviceRect:{x:Xt.pickedX,y:Xt.pickedY,width:1,height:1},cullRect:Je,effects:j,pass:`picking:${M}:z`},!0);di[3]&&(hi=di[0])}Xt.pickedLayer&&Ht+1<l&&(kt.add(Xt.pickedLayer),Xt.pickedLayer.disablePickingIndex(Xt.pickedObjectIndex)),Rt=K4({pickInfo:Xt,lastPickedInfo:this.lastPickedInfo,mode:M,layers:se,viewports:r,x:o,y:p,z:hi,pixelRatio:$});for(const di of Rt.values())di.layer&&Et.push(di);if(!Xt.pickedColor)break}for(const Ht of kt)Ht.restorePickingColors();return{result:Et,emptyInfo:Rt.get(null)}}async _pickVisibleObjectsAsync({layers:e,views:t,viewports:r,x:o,y:p,width:_=1,height:l=1,mode:M="query",maxObjects:D=null,onViewportActive:B,effects:j}){const $=this._getPickable(e);if(!$||r.length===0)return[];this._resizeBuffer();const se=this.device.canvasContext.cssToDeviceRatio(),de=this.device.canvasContext.cssToDevicePixels([o,p],!0),Ae=de.x,he=de.y+de.height,Le=this.device.canvasContext.cssToDevicePixels([o+_,p+l],!0),$e=Le.x+Le.width,Be=Le.y,Je={x:Ae,y:Be,width:$e-Ae,height:he-Be},Rt=this._drawAndSample({layers:$,views:t,viewports:r,onViewportActive:B,deviceRect:Je,cullRect:{x:o,y:p,width:_,height:l},effects:j,pass:`picking:${M}`}),Et=Q4(Rt),kt=new Map,Ht=[],Xt=Number.isFinite(D);for(let hi=0;hi<Et.length&&!(Xt&&Ht.length>=D);hi++){const di=Et[hi];let Ei={color:di.pickedColor,layer:null,index:di.pickedObjectIndex,picked:!0,x:o,y:p,pixelRatio:se};Ei=qA({layer:di.pickedLayer,info:Ei,mode:M});const Ii=Ei.layer.id;kt.has(Ii)||kt.set(Ii,new Set);const fi=kt.get(Ii),Ui=Ei.object??Ei.index;fi.has(Ui)||(fi.add(Ui),Ht.push(Ei))}return Ht}_pickVisibleObjects({layers:e,views:t,viewports:r,x:o,y:p,width:_=1,height:l=1,mode:M="query",maxObjects:D=null,onViewportActive:B,effects:j}){const $=this._getPickable(e);if(!$||r.length===0)return[];this._resizeBuffer();const se=this.device.canvasContext.cssToDeviceRatio(),de=this.device.canvasContext.cssToDevicePixels([o,p],!0),Ae=de.x,he=de.y+de.height,Le=this.device.canvasContext.cssToDevicePixels([o+_,p+l],!0),$e=Le.x+Le.width,Be=Le.y,Je={x:Ae,y:Be,width:$e-Ae,height:he-Be},Rt=this._drawAndSample({layers:$,views:t,viewports:r,onViewportActive:B,deviceRect:Je,cullRect:{x:o,y:p,width:_,height:l},effects:j,pass:`picking:${M}`}),Et=Q4(Rt),kt=new Map,Ht=[],Xt=Number.isFinite(D);for(let hi=0;hi<Et.length&&!(Xt&&Ht.length>=D);hi++){const di=Et[hi];let Ei={color:di.pickedColor,layer:null,index:di.pickedObjectIndex,picked:!0,x:o,y:p,pixelRatio:se};Ei=qA({layer:di.pickedLayer,info:Ei,mode:M});const Ii=Ei.layer.id;kt.has(Ii)||kt.set(Ii,new Set);const fi=kt.get(Ii),Ui=Ei.object??Ei.index;fi.has(Ui)||(fi.add(Ui),Ht.push(Ei))}return Ht}async _drawAndSampleAsync({layers:e,views:t,viewports:r,onViewportActive:o,deviceRect:p,cullRect:_,effects:l,pass:M},D=!1){const B=D?this.depthFBO:this.pickingFBO,j={layers:e,layerFilter:this.layerFilter,views:t,viewports:r,onViewportActive:o,pickingFBO:B,deviceRect:p,cullRect:_,effects:l,pass:M,pickZ:D,preRenderStats:{},isPicking:!0};for(const $e of l)$e.useInPicking&&(j.preRenderStats[$e.id]=$e.preRender(j));const{decodePickingColor:$}=this.pickLayersPass.render(j),{x:se,y:de,width:Ae,height:he}=p,Le=new(D?Float32Array:Uint8Array)(Ae*he*4);return this.device.readPixelsToArrayWebGL(B,{sourceX:se,sourceY:de,sourceWidth:Ae,sourceHeight:he,target:Le}),{pickedColors:Le,decodePickingColor:$}}_drawAndSample({layers:e,views:t,viewports:r,onViewportActive:o,deviceRect:p,cullRect:_,effects:l,pass:M},D=!1){const B=D?this.depthFBO:this.pickingFBO,j={layers:e,layerFilter:this.layerFilter,views:t,viewports:r,onViewportActive:o,pickingFBO:B,deviceRect:p,cullRect:_,effects:l,pass:M,pickZ:D,preRenderStats:{},isPicking:!0};for(const $e of l)$e.useInPicking&&(j.preRenderStats[$e.id]=$e.preRender(j));const{decodePickingColor:$}=this.pickLayersPass.render(j),{x:se,y:de,width:Ae,height:he}=p,Le=new(D?Float32Array:Uint8Array)(Ae*he*4);return this.device.readPixelsToArrayWebGL(B,{sourceX:se,sourceY:de,sourceWidth:Ae,sourceHeight:he,target:Le}),{pickedColors:Le,decodePickingColor:$}}_getPickingRect({deviceX:e,deviceY:t,deviceRadius:r,deviceWidth:o,deviceHeight:p}){const _=Math.max(0,e-r),l=Math.max(0,t-r),M=Math.min(o,e+r+1)-_,D=Math.min(p,t+r+1)-l;return M<=0||D<=0?null:{x:_,y:l,width:M,height:D}}}const J7={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},Q7="top-left",eS="root";class K7{constructor({deck:e,parentElement:t}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,t==null||t.classList.add("deck-widget-container"),this.parentElement=t}getWidgets(){return this.resolvedWidgets}setProps(e){if(e.widgets&&!cu(e.widgets,this.widgets,1)){const t=e.widgets.filter(Boolean);this._setWidgets(t)}}finalize(){for(const e of this.getWidgets())this._removeWidget(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(t=>t.id===e.id)||(this._addWidget(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}onRedraw({viewports:e,layers:t}){var o,p;const r=e.reduce((_,l)=>(_[l.id]=l,_),{});for(const _ of this.getWidgets()){const{viewId:l}=_;if(l){const M=r[l];M&&(_.onViewportChange&&_.onViewportChange(M),(o=_.onRedraw)==null||o.call(_,{viewports:[M],layers:t}))}else{if(_.onViewportChange)for(const M of e)_.onViewportChange(M);(p=_.onRedraw)==null||p.call(_,{viewports:e,layers:t})}}this.lastViewports=r,this._updateContainers()}onHover(e,t){var r,o;for(const p of this.getWidgets()){const{viewId:_}=p;(!_||_===((r=e.viewport)==null?void 0:r.id))&&((o=p.onHover)==null||o.call(p,e,t))}}onEvent(e,t){var o,p;const r=LA[t.type];if(r)for(const _ of this.getWidgets()){const{viewId:l}=_;(!l||l===((o=e.viewport)==null?void 0:o.id))&&((p=_[r])==null||p.call(_,e,t))}}_setWidgets(e){const t={};for(const r of this.resolvedWidgets)t[r.id]=r;this.resolvedWidgets.length=0;for(const r of this.defaultWidgets)t[r.id]=null,this.resolvedWidgets.push(r);for(let r of e){const o=t[r.id];o?o.viewId!==r.viewId||o.placement!==r.placement?(this._removeWidget(o),this._addWidget(r)):r!==o&&(o.setProps(r.props),r=o):this._addWidget(r),t[r.id]=null,this.resolvedWidgets.push(r)}for(const r in t){const o=t[r];o&&this._removeWidget(o)}this.widgets=e}_addWidget(e){const{viewId:t=null,placement:r=Q7}=e,o=e.props._container??t;e.widgetManager=this,e.deck=this.deck,e.rootElement=e._onAdd({deck:this.deck,viewId:t}),e.rootElement&&this._getContainer(o,r).append(e.rootElement),e.updateHTML()}_removeWidget(e){var t;(t=e.onRemove)==null||t.call(e),e.rootElement&&e.rootElement.remove(),e.rootElement=void 0,e.deck=void 0,e.widgetManager=void 0}_getContainer(e,t){var _;if(e&&typeof e!="string")return e;const r=e||eS;let o=this.containers[r];o||(o=document.createElement("div"),o.style.pointerEvents="none",o.style.position="absolute",o.style.overflow="hidden",(_=this.parentElement)==null||_.append(o),this.containers[r]=o);let p=o.querySelector(`.${t}`);return p||(p=globalThis.document.createElement("div"),p.className=t,p.style.position="absolute",p.style.zIndex="2",Object.assign(p.style,J7[t]),o.append(p)),p}_updateContainers(){const e=this.deck.width,t=this.deck.height;for(const r in this.containers){const o=this.lastViewports[r]||null,p=r===eS||o,_=this.containers[r];p?(_.style.display="block",_.style.left=`${o?o.x:0}px`,_.style.top=`${o?o.y:0}px`,_.style.width=`${o?o.width:e}px`,_.style.height=`${o?o.height:t}px`):_.style.display="none"}}}function tS(i,e){e&&Object.entries(e).map(([t,r])=>{t.startsWith("--")?i.style.setProperty(t,r):i.style[t]=r})}function ej(i,e){e&&Object.keys(e).map(t=>{t.startsWith("--")?i.style.removeProperty(t):i.style[t]=""})}class Jw{constructor(e){this.viewId=null,this.props={...this.constructor.defaultProps,...e},this.id=this.props.id}setProps(e){const t=this.props,r=this.rootElement;r&&t.className!==e.className&&(t.className&&r.classList.remove(t.className),e.className&&r.classList.add(e.className)),r&&!cu(t.style,e.style,1)&&(ej(r,t.style),tS(r,e.style)),Object.assign(this.props,e),this.updateHTML()}updateHTML(){this.rootElement&&this.onRenderHTML(this.rootElement)}onCreateRootElement(){const e=["deck-widget",this.className,this.props.className],t=document.createElement("div");return e.filter(r=>typeof r=="string"&&r.length>0).forEach(r=>t.classList.add(r)),tS(t,this.props.style),t}_onAdd(e){return this.onAdd(e)??this.onCreateRootElement()}onAdd(e){}onRemove(){}onViewportChange(e){}onRedraw(e){}onHover(e,t){}onClick(e,t){}onDrag(e,t){}onDragStart(e,t){}onDragEnd(e,t){}}Jw.defaultProps={id:"widget",style:{},_container:null,className:""};const tj={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class tR extends Jw{constructor(e={}){super(e),this.id="default-tooltip",this.placement="fill",this.className="deck-tooltip",this.isVisible=!1,this.setProps(e)}onCreateRootElement(){const e=document.createElement("div");return e.className=this.className,Object.assign(e.style,tj),e}onRenderHTML(e){}onViewportChange(e){var t;this.isVisible&&e.id===((t=this.lastViewport)==null?void 0:t.id)&&!e.equals(this.lastViewport)&&this.setTooltip(null),this.lastViewport=e}onHover(e){const{deck:t}=this,r=t&&t.props.getTooltip;if(!r)return;const o=r(e);this.setTooltip(o,e.x,e.y)}setTooltip(e,t,r){const o=this.rootElement;if(o){if(typeof e=="string")o.innerText=e;else if(e)e.text&&(o.innerText=e.text),e.html&&(o.innerHTML=e.html),e.className&&(o.className=e.className);else{this.isVisible=!1,o.style.display="none";return}this.isVisible=!0,o.style.display="block",o.style.transform=`translate(${t}px, ${r}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(o.style,e.style)}}}tR.defaultProps={...Jw.defaultProps};const ij="modulepreload",nj=function(i){return"/lidar_data/"+i},iS={},nS=function(e,t,r){let o=Promise.resolve();if(t&&t.length>0){let _=function(D){return Promise.all(D.map(B=>Promise.resolve(B).then(j=>({status:"fulfilled",value:j}),j=>({status:"rejected",reason:j}))))};document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),M=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));o=_(t.map(D=>{if(D=nj(D),D in iS)return;iS[D]=!0;const B=D.endsWith(".css"),j=B?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${D}"]${j}`))return;const $=document.createElement("link");if($.rel=B?"stylesheet":ij,B||($.as="script"),$.crossOrigin="",$.href=D,M&&$.setAttribute("nonce",M),document.head.appendChild($),B)return new Promise((se,de)=>{$.addEventListener("load",se),$.addEventListener("error",()=>de(new Error(`Unable to preload CSS for ${D}`)))})}))}function p(_){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=_,window.dispatchEvent(l),!l.defaultPrevented)throw _}return o.then(_=>{for(const l of _||[])l.status==="rejected"&&p(l.reason);return e().catch(p)})};var Uy;(function(i){i[i.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",i[i.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",i[i.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",i[i.POINTS=0]="POINTS",i[i.LINES=1]="LINES",i[i.LINE_LOOP=2]="LINE_LOOP",i[i.LINE_STRIP=3]="LINE_STRIP",i[i.TRIANGLES=4]="TRIANGLES",i[i.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",i[i.TRIANGLE_FAN=6]="TRIANGLE_FAN",i[i.ZERO=0]="ZERO",i[i.ONE=1]="ONE",i[i.SRC_COLOR=768]="SRC_COLOR",i[i.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",i[i.SRC_ALPHA=770]="SRC_ALPHA",i[i.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",i[i.DST_ALPHA=772]="DST_ALPHA",i[i.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",i[i.DST_COLOR=774]="DST_COLOR",i[i.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",i[i.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",i[i.CONSTANT_COLOR=32769]="CONSTANT_COLOR",i[i.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",i[i.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",i[i.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",i[i.FUNC_ADD=32774]="FUNC_ADD",i[i.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",i[i.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",i[i.BLEND_EQUATION=32777]="BLEND_EQUATION",i[i.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",i[i.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",i[i.BLEND_DST_RGB=32968]="BLEND_DST_RGB",i[i.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",i[i.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",i[i.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",i[i.BLEND_COLOR=32773]="BLEND_COLOR",i[i.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",i[i.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",i[i.LINE_WIDTH=2849]="LINE_WIDTH",i[i.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",i[i.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",i[i.CULL_FACE_MODE=2885]="CULL_FACE_MODE",i[i.FRONT_FACE=2886]="FRONT_FACE",i[i.DEPTH_RANGE=2928]="DEPTH_RANGE",i[i.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",i[i.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",i[i.DEPTH_FUNC=2932]="DEPTH_FUNC",i[i.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",i[i.STENCIL_FUNC=2962]="STENCIL_FUNC",i[i.STENCIL_FAIL=2964]="STENCIL_FAIL",i[i.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",i[i.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",i[i.STENCIL_REF=2967]="STENCIL_REF",i[i.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",i[i.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",i[i.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",i[i.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",i[i.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",i[i.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",i[i.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",i[i.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",i[i.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",i[i.VIEWPORT=2978]="VIEWPORT",i[i.SCISSOR_BOX=3088]="SCISSOR_BOX",i[i.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",i[i.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",i[i.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",i[i.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",i[i.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",i[i.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",i[i.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",i[i.RED_BITS=3410]="RED_BITS",i[i.GREEN_BITS=3411]="GREEN_BITS",i[i.BLUE_BITS=3412]="BLUE_BITS",i[i.ALPHA_BITS=3413]="ALPHA_BITS",i[i.DEPTH_BITS=3414]="DEPTH_BITS",i[i.STENCIL_BITS=3415]="STENCIL_BITS",i[i.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",i[i.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",i[i.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",i[i.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",i[i.SAMPLES=32937]="SAMPLES",i[i.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",i[i.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",i[i.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",i[i.VENDOR=7936]="VENDOR",i[i.RENDERER=7937]="RENDERER",i[i.VERSION=7938]="VERSION",i[i.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",i[i.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",i[i.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",i[i.STATIC_DRAW=35044]="STATIC_DRAW",i[i.STREAM_DRAW=35040]="STREAM_DRAW",i[i.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",i[i.ARRAY_BUFFER=34962]="ARRAY_BUFFER",i[i.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",i[i.BUFFER_SIZE=34660]="BUFFER_SIZE",i[i.BUFFER_USAGE=34661]="BUFFER_USAGE",i[i.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",i[i.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",i[i.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",i[i.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",i[i.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",i[i.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",i[i.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",i[i.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",i[i.CULL_FACE=2884]="CULL_FACE",i[i.FRONT=1028]="FRONT",i[i.BACK=1029]="BACK",i[i.FRONT_AND_BACK=1032]="FRONT_AND_BACK",i[i.BLEND=3042]="BLEND",i[i.DEPTH_TEST=2929]="DEPTH_TEST",i[i.DITHER=3024]="DITHER",i[i.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",i[i.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",i[i.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",i[i.SCISSOR_TEST=3089]="SCISSOR_TEST",i[i.STENCIL_TEST=2960]="STENCIL_TEST",i[i.NO_ERROR=0]="NO_ERROR",i[i.INVALID_ENUM=1280]="INVALID_ENUM",i[i.INVALID_VALUE=1281]="INVALID_VALUE",i[i.INVALID_OPERATION=1282]="INVALID_OPERATION",i[i.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",i[i.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",i[i.CW=2304]="CW",i[i.CCW=2305]="CCW",i[i.DONT_CARE=4352]="DONT_CARE",i[i.FASTEST=4353]="FASTEST",i[i.NICEST=4354]="NICEST",i[i.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",i[i.BYTE=5120]="BYTE",i[i.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",i[i.SHORT=5122]="SHORT",i[i.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",i[i.INT=5124]="INT",i[i.UNSIGNED_INT=5125]="UNSIGNED_INT",i[i.FLOAT=5126]="FLOAT",i[i.DOUBLE=5130]="DOUBLE",i[i.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",i[i.ALPHA=6406]="ALPHA",i[i.RGB=6407]="RGB",i[i.RGBA=6408]="RGBA",i[i.LUMINANCE=6409]="LUMINANCE",i[i.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",i[i.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",i[i.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",i[i.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",i[i.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",i[i.VERTEX_SHADER=35633]="VERTEX_SHADER",i[i.COMPILE_STATUS=35713]="COMPILE_STATUS",i[i.DELETE_STATUS=35712]="DELETE_STATUS",i[i.LINK_STATUS=35714]="LINK_STATUS",i[i.VALIDATE_STATUS=35715]="VALIDATE_STATUS",i[i.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",i[i.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",i[i.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",i[i.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",i[i.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",i[i.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",i[i.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",i[i.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",i[i.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",i[i.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",i[i.SHADER_TYPE=35663]="SHADER_TYPE",i[i.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",i[i.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",i[i.NEVER=512]="NEVER",i[i.LESS=513]="LESS",i[i.EQUAL=514]="EQUAL",i[i.LEQUAL=515]="LEQUAL",i[i.GREATER=516]="GREATER",i[i.NOTEQUAL=517]="NOTEQUAL",i[i.GEQUAL=518]="GEQUAL",i[i.ALWAYS=519]="ALWAYS",i[i.KEEP=7680]="KEEP",i[i.REPLACE=7681]="REPLACE",i[i.INCR=7682]="INCR",i[i.DECR=7683]="DECR",i[i.INVERT=5386]="INVERT",i[i.INCR_WRAP=34055]="INCR_WRAP",i[i.DECR_WRAP=34056]="DECR_WRAP",i[i.NEAREST=9728]="NEAREST",i[i.LINEAR=9729]="LINEAR",i[i.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",i[i.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",i[i.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",i[i.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",i[i.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",i[i.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",i[i.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",i[i.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",i[i.TEXTURE_2D=3553]="TEXTURE_2D",i[i.TEXTURE=5890]="TEXTURE",i[i.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",i[i.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",i[i.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",i[i.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",i[i.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",i[i.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",i[i.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",i[i.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",i[i.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",i[i.TEXTURE0=33984]="TEXTURE0",i[i.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",i[i.REPEAT=10497]="REPEAT",i[i.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",i[i.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",i[i.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",i[i.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",i[i.FLOAT_VEC2=35664]="FLOAT_VEC2",i[i.FLOAT_VEC3=35665]="FLOAT_VEC3",i[i.FLOAT_VEC4=35666]="FLOAT_VEC4",i[i.INT_VEC2=35667]="INT_VEC2",i[i.INT_VEC3=35668]="INT_VEC3",i[i.INT_VEC4=35669]="INT_VEC4",i[i.BOOL=35670]="BOOL",i[i.BOOL_VEC2=35671]="BOOL_VEC2",i[i.BOOL_VEC3=35672]="BOOL_VEC3",i[i.BOOL_VEC4=35673]="BOOL_VEC4",i[i.FLOAT_MAT2=35674]="FLOAT_MAT2",i[i.FLOAT_MAT3=35675]="FLOAT_MAT3",i[i.FLOAT_MAT4=35676]="FLOAT_MAT4",i[i.SAMPLER_2D=35678]="SAMPLER_2D",i[i.SAMPLER_CUBE=35680]="SAMPLER_CUBE",i[i.LOW_FLOAT=36336]="LOW_FLOAT",i[i.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",i[i.HIGH_FLOAT=36338]="HIGH_FLOAT",i[i.LOW_INT=36339]="LOW_INT",i[i.MEDIUM_INT=36340]="MEDIUM_INT",i[i.HIGH_INT=36341]="HIGH_INT",i[i.FRAMEBUFFER=36160]="FRAMEBUFFER",i[i.RENDERBUFFER=36161]="RENDERBUFFER",i[i.RGBA4=32854]="RGBA4",i[i.RGB5_A1=32855]="RGB5_A1",i[i.RGB565=36194]="RGB565",i[i.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",i[i.STENCIL_INDEX=6401]="STENCIL_INDEX",i[i.STENCIL_INDEX8=36168]="STENCIL_INDEX8",i[i.DEPTH_STENCIL=34041]="DEPTH_STENCIL",i[i.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",i[i.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",i[i.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",i[i.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",i[i.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",i[i.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",i[i.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",i[i.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",i[i.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",i[i.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",i[i.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",i[i.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",i[i.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",i[i.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",i[i.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",i[i.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",i[i.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",i[i.NONE=0]="NONE",i[i.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",i[i.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",i[i.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",i[i.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",i[i.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",i[i.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",i[i.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",i[i.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",i[i.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",i[i.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",i[i.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",i[i.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",i[i.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",i[i.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",i[i.READ_BUFFER=3074]="READ_BUFFER",i[i.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",i[i.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",i[i.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",i[i.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",i[i.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",i[i.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",i[i.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",i[i.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",i[i.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",i[i.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",i[i.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",i[i.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",i[i.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",i[i.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",i[i.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",i[i.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",i[i.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",i[i.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",i[i.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",i[i.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",i[i.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",i[i.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",i[i.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",i[i.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",i[i.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",i[i.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",i[i.RED=6403]="RED",i[i.RGB8=32849]="RGB8",i[i.RGBA8=32856]="RGBA8",i[i.RGB10_A2=32857]="RGB10_A2",i[i.TEXTURE_3D=32879]="TEXTURE_3D",i[i.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",i[i.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",i[i.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",i[i.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",i[i.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",i[i.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",i[i.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",i[i.SRGB=35904]="SRGB",i[i.SRGB8=35905]="SRGB8",i[i.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",i[i.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",i[i.RGBA32F=34836]="RGBA32F",i[i.RGB32F=34837]="RGB32F",i[i.RGBA16F=34842]="RGBA16F",i[i.RGB16F=34843]="RGB16F",i[i.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",i[i.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",i[i.R11F_G11F_B10F=35898]="R11F_G11F_B10F",i[i.RGB9_E5=35901]="RGB9_E5",i[i.RGBA32UI=36208]="RGBA32UI",i[i.RGB32UI=36209]="RGB32UI",i[i.RGBA16UI=36214]="RGBA16UI",i[i.RGB16UI=36215]="RGB16UI",i[i.RGBA8UI=36220]="RGBA8UI",i[i.RGB8UI=36221]="RGB8UI",i[i.RGBA32I=36226]="RGBA32I",i[i.RGB32I=36227]="RGB32I",i[i.RGBA16I=36232]="RGBA16I",i[i.RGB16I=36233]="RGB16I",i[i.RGBA8I=36238]="RGBA8I",i[i.RGB8I=36239]="RGB8I",i[i.RED_INTEGER=36244]="RED_INTEGER",i[i.RGB_INTEGER=36248]="RGB_INTEGER",i[i.RGBA_INTEGER=36249]="RGBA_INTEGER",i[i.R8=33321]="R8",i[i.RG8=33323]="RG8",i[i.R16F=33325]="R16F",i[i.R32F=33326]="R32F",i[i.RG16F=33327]="RG16F",i[i.RG32F=33328]="RG32F",i[i.R8I=33329]="R8I",i[i.R8UI=33330]="R8UI",i[i.R16I=33331]="R16I",i[i.R16UI=33332]="R16UI",i[i.R32I=33333]="R32I",i[i.R32UI=33334]="R32UI",i[i.RG8I=33335]="RG8I",i[i.RG8UI=33336]="RG8UI",i[i.RG16I=33337]="RG16I",i[i.RG16UI=33338]="RG16UI",i[i.RG32I=33339]="RG32I",i[i.RG32UI=33340]="RG32UI",i[i.R8_SNORM=36756]="R8_SNORM",i[i.RG8_SNORM=36757]="RG8_SNORM",i[i.RGB8_SNORM=36758]="RGB8_SNORM",i[i.RGBA8_SNORM=36759]="RGBA8_SNORM",i[i.RGB10_A2UI=36975]="RGB10_A2UI",i[i.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",i[i.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",i[i.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",i[i.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",i[i.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",i[i.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",i[i.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",i[i.HALF_FLOAT=5131]="HALF_FLOAT",i[i.RG=33319]="RG",i[i.RG_INTEGER=33320]="RG_INTEGER",i[i.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",i[i.CURRENT_QUERY=34917]="CURRENT_QUERY",i[i.QUERY_RESULT=34918]="QUERY_RESULT",i[i.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",i[i.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",i[i.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",i[i.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",i[i.DRAW_BUFFER0=34853]="DRAW_BUFFER0",i[i.DRAW_BUFFER1=34854]="DRAW_BUFFER1",i[i.DRAW_BUFFER2=34855]="DRAW_BUFFER2",i[i.DRAW_BUFFER3=34856]="DRAW_BUFFER3",i[i.DRAW_BUFFER4=34857]="DRAW_BUFFER4",i[i.DRAW_BUFFER5=34858]="DRAW_BUFFER5",i[i.DRAW_BUFFER6=34859]="DRAW_BUFFER6",i[i.DRAW_BUFFER7=34860]="DRAW_BUFFER7",i[i.DRAW_BUFFER8=34861]="DRAW_BUFFER8",i[i.DRAW_BUFFER9=34862]="DRAW_BUFFER9",i[i.DRAW_BUFFER10=34863]="DRAW_BUFFER10",i[i.DRAW_BUFFER11=34864]="DRAW_BUFFER11",i[i.DRAW_BUFFER12=34865]="DRAW_BUFFER12",i[i.DRAW_BUFFER13=34866]="DRAW_BUFFER13",i[i.DRAW_BUFFER14=34867]="DRAW_BUFFER14",i[i.DRAW_BUFFER15=34868]="DRAW_BUFFER15",i[i.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",i[i.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",i[i.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",i[i.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",i[i.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",i[i.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",i[i.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",i[i.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",i[i.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",i[i.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",i[i.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",i[i.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",i[i.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",i[i.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",i[i.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",i[i.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",i[i.SAMPLER_3D=35679]="SAMPLER_3D",i[i.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",i[i.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",i[i.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",i[i.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",i[i.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",i[i.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",i[i.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",i[i.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",i[i.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",i[i.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",i[i.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",i[i.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",i[i.MAX_SAMPLES=36183]="MAX_SAMPLES",i[i.SAMPLER_BINDING=35097]="SAMPLER_BINDING",i[i.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",i[i.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",i[i.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",i[i.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",i[i.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",i[i.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",i[i.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",i[i.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",i[i.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",i[i.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",i[i.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",i[i.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",i[i.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",i[i.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",i[i.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",i[i.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",i[i.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",i[i.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",i[i.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",i[i.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",i[i.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",i[i.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",i[i.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",i[i.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",i[i.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",i[i.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",i[i.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",i[i.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",i[i.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",i[i.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",i[i.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",i[i.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",i[i.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",i[i.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",i[i.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",i[i.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",i[i.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",i[i.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",i[i.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",i[i.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",i[i.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",i[i.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",i[i.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",i[i.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",i[i.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",i[i.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",i[i.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",i[i.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",i[i.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",i[i.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",i[i.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",i[i.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",i[i.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",i[i.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",i[i.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",i[i.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",i[i.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",i[i.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",i[i.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",i[i.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",i[i.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",i[i.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",i[i.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",i[i.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",i[i.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",i[i.UNIFORM_TYPE=35383]="UNIFORM_TYPE",i[i.UNIFORM_SIZE=35384]="UNIFORM_SIZE",i[i.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",i[i.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",i[i.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",i[i.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",i[i.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",i[i.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",i[i.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",i[i.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",i[i.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",i[i.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",i[i.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",i[i.OBJECT_TYPE=37138]="OBJECT_TYPE",i[i.SYNC_CONDITION=37139]="SYNC_CONDITION",i[i.SYNC_STATUS=37140]="SYNC_STATUS",i[i.SYNC_FLAGS=37141]="SYNC_FLAGS",i[i.SYNC_FENCE=37142]="SYNC_FENCE",i[i.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",i[i.UNSIGNALED=37144]="UNSIGNALED",i[i.SIGNALED=37145]="SIGNALED",i[i.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",i[i.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",i[i.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",i[i.WAIT_FAILED=37149]="WAIT_FAILED",i[i.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",i[i.COLOR=6144]="COLOR",i[i.DEPTH=6145]="DEPTH",i[i.STENCIL=6146]="STENCIL",i[i.MIN=32775]="MIN",i[i.MAX=32776]="MAX",i[i.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",i[i.STREAM_READ=35041]="STREAM_READ",i[i.STREAM_COPY=35042]="STREAM_COPY",i[i.STATIC_READ=35045]="STATIC_READ",i[i.STATIC_COPY=35046]="STATIC_COPY",i[i.DYNAMIC_READ=35049]="DYNAMIC_READ",i[i.DYNAMIC_COPY=35050]="DYNAMIC_COPY",i[i.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",i[i.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",i[i.INVALID_INDEX=4294967295]="INVALID_INDEX",i[i.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",i[i.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",i[i.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",i[i.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",i[i.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",i[i.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",i[i.R16_EXT=33322]="R16_EXT",i[i.RG16_EXT=33324]="RG16_EXT",i[i.RGB16_EXT=32852]="RGB16_EXT",i[i.RGBA16_EXT=32859]="RGBA16_EXT",i[i.R16_SNORM_EXT=36760]="R16_SNORM_EXT",i[i.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",i[i.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",i[i.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",i[i.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",i[i.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",i[i.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",i[i.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",i[i.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",i[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",i[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",i[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",i[i.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",i[i.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",i[i.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",i[i.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",i[i.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",i[i.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",i[i.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",i[i.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",i[i.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",i[i.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",i[i.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",i[i.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",i[i.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",i[i.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",i[i.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",i[i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",i[i.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",i[i.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",i[i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",i[i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",i[i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",i[i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",i[i.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",i[i.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",i[i.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",i[i.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",i[i.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",i[i.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",i[i.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",i[i.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",i[i.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",i[i.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",i[i.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",i[i.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",i[i.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",i[i.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",i[i.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",i[i.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",i[i.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",i[i.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",i[i.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",i[i.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",i[i.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",i[i.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",i[i.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",i[i.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",i[i.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",i[i.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",i[i.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",i[i.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",i[i.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",i[i.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",i[i.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",i[i.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",i[i.LINE_WEBGL=6913]="LINE_WEBGL",i[i.FILL_WEBGL=6914]="FILL_WEBGL",i[i.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",i[i.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",i[i.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",i[i.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",i[i.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",i[i.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",i[i.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",i[i.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",i[i.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",i[i.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",i[i.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",i[i.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",i[i.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",i[i.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",i[i.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",i[i.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",i[i.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",i[i.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",i[i.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",i[i.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",i[i.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",i[i.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",i[i.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",i[i.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(Uy||(Uy={}));const rj={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},sj=i=>({drawBuffersWEBGL(e){return i.drawBuffers(e)},COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),aj=i=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES(){return i.createVertexArray()},deleteVertexArrayOES(e){return i.deleteVertexArray(e)},isVertexArrayOES(e){return i.isVertexArray(e)},bindVertexArrayOES(e){return i.bindVertexArray(e)}}),oj=i=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE(...e){return i.drawArraysInstanced(...e)},drawElementsInstancedANGLE(...e){return i.drawElementsInstanced(...e)},vertexAttribDivisorANGLE(...e){return i.vertexAttribDivisor(...e)}});function lj(i=!0){const e=HTMLCanvasElement.prototype;if(!i&&e.originalGetContext){e.getContext=e.originalGetContext,e.originalGetContext=void 0;return}e.originalGetContext=e.getContext,e.getContext=function(t,r){if(t==="webgl"||t==="experimental-webgl"){const o=this.originalGetContext("webgl2",r);return o instanceof HTMLElement&&cj(o),o}return this.originalGetContext(t,r)}}function cj(i){i.getExtension("EXT_color_buffer_float");const e={...rj,WEBGL_disjoint_timer_query:i.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:sj(i),OES_vertex_array_object:aj(i),ANGLE_instanced_arrays:oj(i)},t=i.getExtension;i.getExtension=function(o){const p=t.call(i,o);return p||(o in e?e[o]:null)};const r=i.getSupportedExtensions;i.getSupportedExtensions=function(){const o=r.apply(i)||[];return o==null?void 0:o.concat(Object.keys(e))}}async function iR(i,e){const t=document.getElementsByTagName("head")[0];if(!t)throw new Error("loadScript");const r=document.createElement("script");return r.setAttribute("type","text/javascript"),r.setAttribute("src",i),new Promise((o,p)=>{r.onload=o,r.onerror=_=>p(new Error(`Unable to load script '${i}': ${_}`)),t.appendChild(r)})}const uj=1;let xs=null,rS=!1;const Qw={debugSpectorJS:ni.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};async function hj(i){if(!globalThis.SPECTOR)try{await iR(i.debugSpectorJSUrl||Qw.debugSpectorJSUrl)}catch(e){ni.warn(String(e))}}function fj(i){var e;if(i={...Qw,...i},!i.debugSpectorJS)return null;if(!xs&&globalThis.SPECTOR&&!((e=globalThis.luma)!=null&&e.spector)){ni.probe(uj,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();const{Spector:t}=globalThis.SPECTOR;xs=new t,globalThis.luma&&(globalThis.luma.spector=xs)}if(!xs)return null;if(rS||(rS=!0,xs.spyCanvases(),xs==null||xs.onCaptureStarted.add(t=>ni.info("Spector capture started:",t)()),xs==null||xs.onCapture.add(t=>{ni.info("Spector capture complete:",t)(),xs==null||xs.getResultUI(),xs==null||xs.resultView.display(),xs==null||xs.resultView.addCapture(t)})),i.gl){const t=i.gl,r=t.device;xs==null||xs.startCapture(i.gl,500),t.device=r,new Promise(o=>setTimeout(o,2e3)).then(o=>{ni.info("Spector capture stopped after 2 seconds")(),xs==null||xs.stopCapture()})}return xs}const dj="https://unpkg.com/webgl-debug@2.0.1/index.js";function nR(i){return i.luma=i.luma||{},i.luma}async function pj(){C_()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await iR(dj))}function gj(i,e={}){return e.debugWebGL||e.traceWebGL?_j(i,e):mj(i)}function mj(i){const e=nR(i);return e.realContext?e.realContext:i}function _j(i,e){if(!globalThis.WebGLDebugUtils)return ni.warn("webgl-debug not loaded")(),i;const t=nR(i);if(t.debugContext)return t.debugContext;globalThis.WebGLDebugUtils.init({...Uy,...i});const r=globalThis.WebGLDebugUtils.makeDebugContext(i,yj.bind(null,e),vj.bind(null,e));for(const _ in Uy)!(_ in r)&&typeof Uy[_]=="number"&&(r[_]=Uy[_]);class o{}Object.setPrototypeOf(r,Object.getPrototypeOf(i)),Object.setPrototypeOf(o,r);const p=Object.create(o);return t.realContext=i,t.debugContext=p,p.debug=!0,p}function sS(i,e){e=Array.from(e).map(r=>r===void 0?"undefined":r);let t=globalThis.WebGLDebugUtils.glFunctionArgsToString(i,e);return t=`${t.slice(0,100)}${t.length>100?"...":""}`,`gl.${i}(${t})`}function yj(i,e,t,r){r=Array.from(r).map(l=>l===void 0?"undefined":l);const o=globalThis.WebGLDebugUtils.glEnumToString(e),p=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,r),_=`${o} in gl.${t}(${p})`;ni.error(_)();debugger}function vj(i,e,t){let r="";ni.level>=1&&(r=sS(e,t),i.traceWebGL&&ni.log(1,r)());for(const o of t)if(o===void 0){r=r||sS(e,t);debugger}}const mv=1;class xj extends oz{constructor(){super();pe(this,"type","webgl");T_.defaultProps={...T_.defaultProps,...Qw}}enforceWebGL2(t){lj(t)}isSupported(){return typeof WebGL2RenderingContext<"u"}isDeviceHandle(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:(typeof WebGLRenderingContext<"u"&&t instanceof WebGLRenderingContext&&ni.warn("WebGL1 is not supported",t)(),!1)}async attach(t,r={}){const{WebGLDevice:o}=await nS(async()=>{const{WebGLDevice:_}=await Promise.resolve().then(()=>bS);return{WebGLDevice:_}},void 0);if(t instanceof o)return t;if((t==null?void 0:t.device)instanceof o)return t.device;if(!bj(t))throw new Error("Invalid WebGL2RenderingContext");const p=r.createCanvasContext===!0?{}:r.createCanvasContext;return new o({...r,_handle:t,createCanvasContext:{canvas:t.canvas,autoResize:!1,...p}})}async create(t={}){const{WebGLDevice:r}=await nS(async()=>{const{WebGLDevice:o}=await Promise.resolve().then(()=>bS);return{WebGLDevice:o}},void 0);ni.groupCollapsed(mv,"WebGLDevice created")();try{const o=[];(t.debugWebGL||t.debug)&&o.push(pj()),t.debugSpectorJS&&o.push(hj(t));const p=await Promise.allSettled(o);for(const M of p)M.status==="rejected"&&ni.error(`Failed to initialize debug libraries ${M.reason}`)();const _=new r(t),l=`${_._reused?"Reusing":"Created"} device with WebGL2 ${_.props.debug?"debug ":""}context: ${_.info.vendor}, ${_.info.renderer} for canvas: ${_.canvasContext.id}`;return ni.probe(mv,l)(),ni.table(mv,_.info)(),_}finally{ni.groupEnd(mv)()}}}function bj(i){return typeof WebGL2RenderingContext<"u"&&i instanceof WebGL2RenderingContext?!0:!!(i&&Number.isFinite(i._version))}const Yb=new xj,Kw={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},eo=(i,e,t)=>e?i.enable(t):i.disable(t),aS=(i,e,t)=>i.hint(t,e),sh=(i,e,t)=>i.pixelStorei(t,e),oS=(i,e,t)=>{const r=t===36006?36009:36008;return i.bindFramebuffer(r,e)},B2=(i,e,t)=>{const o={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[t];i.bindBuffer(o,e)};function Jb(i){return Array.isArray(i)||ArrayBuffer.isView(i)&&!(i instanceof DataView)}const Aj={3042:eo,32773:(i,e)=>i.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(i,e)=>i.clearColor(...e),3107:(i,e)=>i.colorMask(...e),2884:eo,2885:(i,e)=>i.cullFace(e),2929:eo,2931:(i,e)=>i.clearDepth(e),2932:(i,e)=>i.depthFunc(e),2928:(i,e)=>i.depthRange(...e),2930:(i,e)=>i.depthMask(e),3024:eo,35723:aS,35725:(i,e)=>i.useProgram(e),36007:(i,e)=>i.bindRenderbuffer(36161,e),36389:(i,e)=>{var t;return(t=i.bindTransformFeedback)==null?void 0:t.call(i,36386,e)},34229:(i,e)=>i.bindVertexArray(e),36006:oS,36010:oS,34964:B2,36662:B2,36663:B2,35053:B2,35055:B2,2886:(i,e)=>i.frontFace(e),33170:aS,2849:(i,e)=>i.lineWidth(e),32823:eo,32824:"polygonOffset",10752:"polygonOffset",35977:eo,32926:eo,32928:eo,32938:"sampleCoverage",32939:"sampleCoverage",3089:eo,3088:(i,e)=>i.scissor(...e),2960:eo,2961:(i,e)=>i.clearStencil(e),2968:(i,e)=>i.stencilMaskSeparate(1028,e),36005:(i,e)=>i.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(i,e)=>i.viewport(...e),34383:eo,10754:eo,12288:eo,12289:eo,12290:eo,12291:eo,12292:eo,12293:eo,12294:eo,12295:eo,3333:sh,3317:sh,37440:sh,37441:sh,37443:sh,3330:sh,3332:sh,3331:sh,3314:sh,32878:sh,3316:sh,3315:sh,32877:sh,framebuffer:(i,e)=>{const t=e&&"handle"in e?e.handle:e;return i.bindFramebuffer(36160,t)},blend:(i,e)=>e?i.enable(3042):i.disable(3042),blendColor:(i,e)=>i.blendColor(...e),blendEquation:(i,e)=>{const t=typeof e=="number"?[e,e]:e;i.blendEquationSeparate(...t)},blendFunc:(i,e)=>{const t=(e==null?void 0:e.length)===2?[...e,...e]:e;i.blendFuncSeparate(...t)},clearColor:(i,e)=>i.clearColor(...e),clearDepth:(i,e)=>i.clearDepth(e),clearStencil:(i,e)=>i.clearStencil(e),colorMask:(i,e)=>i.colorMask(...e),cull:(i,e)=>e?i.enable(2884):i.disable(2884),cullFace:(i,e)=>i.cullFace(e),depthTest:(i,e)=>e?i.enable(2929):i.disable(2929),depthFunc:(i,e)=>i.depthFunc(e),depthMask:(i,e)=>i.depthMask(e),depthRange:(i,e)=>i.depthRange(...e),dither:(i,e)=>e?i.enable(3024):i.disable(3024),derivativeHint:(i,e)=>{i.hint(35723,e)},frontFace:(i,e)=>i.frontFace(e),mipmapHint:(i,e)=>i.hint(33170,e),lineWidth:(i,e)=>i.lineWidth(e),polygonOffsetFill:(i,e)=>e?i.enable(32823):i.disable(32823),polygonOffset:(i,e)=>i.polygonOffset(...e),sampleCoverage:(i,e)=>i.sampleCoverage(e[0],e[1]||!1),scissorTest:(i,e)=>e?i.enable(3089):i.disable(3089),scissor:(i,e)=>i.scissor(...e),stencilTest:(i,e)=>e?i.enable(2960):i.disable(2960),stencilMask:(i,e)=>{e=Jb(e)?e:[e,e];const[t,r]=e;i.stencilMaskSeparate(1028,t),i.stencilMaskSeparate(1029,r)},stencilFunc:(i,e)=>{e=Jb(e)&&e.length===3?[...e,...e]:e;const[t,r,o,p,_,l]=e;i.stencilFuncSeparate(1028,t,r,o),i.stencilFuncSeparate(1029,p,_,l)},stencilOp:(i,e)=>{e=Jb(e)&&e.length===3?[...e,...e]:e;const[t,r,o,p,_,l]=e;i.stencilOpSeparate(1028,t,r,o),i.stencilOpSeparate(1029,p,_,l)},viewport:(i,e)=>i.viewport(...e)};function _a(i,e,t){return e[i]!==void 0?e[i]:t[i]}const wj={blendEquation:(i,e,t)=>i.blendEquationSeparate(_a(32777,e,t),_a(34877,e,t)),blendFunc:(i,e,t)=>i.blendFuncSeparate(_a(32969,e,t),_a(32968,e,t),_a(32971,e,t),_a(32970,e,t)),polygonOffset:(i,e,t)=>i.polygonOffset(_a(32824,e,t),_a(10752,e,t)),sampleCoverage:(i,e,t)=>i.sampleCoverage(_a(32938,e,t),_a(32939,e,t)),stencilFuncFront:(i,e,t)=>i.stencilFuncSeparate(1028,_a(2962,e,t),_a(2967,e,t),_a(2963,e,t)),stencilFuncBack:(i,e,t)=>i.stencilFuncSeparate(1029,_a(34816,e,t),_a(36003,e,t),_a(36004,e,t)),stencilOpFront:(i,e,t)=>i.stencilOpSeparate(1028,_a(2964,e,t),_a(2965,e,t),_a(2966,e,t)),stencilOpBack:(i,e,t)=>i.stencilOpSeparate(1029,_a(34817,e,t),_a(34818,e,t),_a(34819,e,t))},lS={enable:(i,e)=>i({[e]:!0}),disable:(i,e)=>i({[e]:!1}),pixelStorei:(i,e,t)=>i({[e]:t}),hint:(i,e,t)=>i({[e]:t}),useProgram:(i,e)=>i({35725:e}),bindRenderbuffer:(i,e,t)=>i({36007:t}),bindTransformFeedback:(i,e,t)=>i({36389:t}),bindVertexArray:(i,e)=>i({34229:e}),bindFramebuffer:(i,e,t)=>{switch(e){case 36160:return i({36006:t,36010:t});case 36009:return i({36006:t});case 36008:return i({36010:t});default:return null}},bindBuffer:(i,e,t)=>{const r={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return r?i({[r]:t}):{valueChanged:!0}},blendColor:(i,e,t,r,o)=>i({32773:new Float32Array([e,t,r,o])}),blendEquation:(i,e)=>i({32777:e,34877:e}),blendEquationSeparate:(i,e,t)=>i({32777:e,34877:t}),blendFunc:(i,e,t)=>i({32969:e,32968:t,32971:e,32970:t}),blendFuncSeparate:(i,e,t,r,o)=>i({32969:e,32968:t,32971:r,32970:o}),clearColor:(i,e,t,r,o)=>i({3106:new Float32Array([e,t,r,o])}),clearDepth:(i,e)=>i({2931:e}),clearStencil:(i,e)=>i({2961:e}),colorMask:(i,e,t,r,o)=>i({3107:[e,t,r,o]}),cullFace:(i,e)=>i({2885:e}),depthFunc:(i,e)=>i({2932:e}),depthRange:(i,e,t)=>i({2928:new Float32Array([e,t])}),depthMask:(i,e)=>i({2930:e}),frontFace:(i,e)=>i({2886:e}),lineWidth:(i,e)=>i({2849:e}),polygonOffset:(i,e,t)=>i({32824:e,10752:t}),sampleCoverage:(i,e,t)=>i({32938:e,32939:t}),scissor:(i,e,t,r,o)=>i({3088:new Int32Array([e,t,r,o])}),stencilMask:(i,e)=>i({2968:e,36005:e}),stencilMaskSeparate:(i,e,t)=>i({[e===1028?2968:36005]:t}),stencilFunc:(i,e,t,r)=>i({2962:e,2967:t,2963:r,34816:e,36003:t,36004:r}),stencilFuncSeparate:(i,e,t,r,o)=>i({[e===1028?2962:34816]:t,[e===1028?2967:36003]:r,[e===1028?2963:36004]:o}),stencilOp:(i,e,t,r)=>i({2964:e,2965:t,2966:r,34817:e,34818:t,34819:r}),stencilOpSeparate:(i,e,t,r,o)=>i({[e===1028?2964:34817]:t,[e===1028?2965:34818]:r,[e===1028?2966:34819]:o}),viewport:(i,e,t,r,o)=>i({2978:[e,t,r,o]})},i0=(i,e)=>i.isEnabled(e),cS={3042:i0,2884:i0,2929:i0,3024:i0,32823:i0,32926:i0,32928:i0,3089:i0,2960:i0,35977:i0},Tj=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function a2(i,e){if(Ej(e))return;const t={};for(const o in e){const p=Number(o),_=Aj[o];_&&(typeof _=="string"?t[_]=!0:_(i,e[o],p))}const r=i.state&&i.state.cache;if(r)for(const o in t){const p=wj[o];p(i,e,r)}}function rR(i,e=Kw){if(typeof e=="number"){const o=e,p=cS[o];return p?p(i,o):i.getParameter(o)}const t=Array.isArray(e)?e:Object.keys(e),r={};for(const o of t){const p=cS[o];r[o]=p?p(i,Number(o)):i.getParameter(Number(o))}return r}function Sj(i){a2(i,Kw)}function Ej(i){for(const e in i)return!1;return!0}function Mj(i,e){if(i===e)return!0;if(uS(i)&&uS(e)&&i.length===e.length){for(let t=0;t<i.length;++t)if(i[t]!==e[t])return!1;return!0}return!1}function uS(i){return Array.isArray(i)||ArrayBuffer.isView(i)}class x_{constructor(e,t){pe(this,"gl");pe(this,"program",null);pe(this,"stateStack",[]);pe(this,"enable",!0);pe(this,"cache",null);pe(this,"log");pe(this,"initialized",!1);this.gl=e,this.log=(t==null?void 0:t.log)||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}static get(e){return e.state}push(e={}){this.stateStack.push({})}pop(){const e=this.stateStack[this.stateStack.length-1];a2(this.gl,e),this.stateStack.pop()}trackState(e,t){if(this.cache=t!=null&&t.copyState?rR(e):Object.assign({},Kw),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,Cj(e);for(const r in lS){const o=lS[r];Rj(e,r,o)}hS(e,"getParameter"),hS(e,"isEnabled")}_updateCache(e){let t=!1,r;const o=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const p in e){const _=e[p],l=this.cache[p];Mj(_,l)||(t=!0,r=l,o&&!(p in o)&&(o[p]=l),this.cache[p]=_)}return{valueChanged:t,oldValue:r}}}function hS(i,e){const t=i[e].bind(i);i[e]=function(o){if(o===void 0||Tj.has(o))return t(o);const p=x_.get(i);return o in p.cache||(p.cache[o]=t(o)),p.enable?p.cache[o]:t(o)},Object.defineProperty(i[e],"name",{value:`${e}-from-cache`,configurable:!1})}function Rj(i,e,t){if(!i[e])return;const r=i[e].bind(i);i[e]=function(...p){const _=x_.get(i),{valueChanged:l,oldValue:M}=t(_._updateCache,...p);return l&&r(...p),M},Object.defineProperty(i[e],"name",{value:`${e}-to-cache`,configurable:!1})}function Cj(i){const e=i.useProgram.bind(i);i.useProgram=function(r){const o=x_.get(i);o.program!==r&&(e(r),o.program=r)}}function Pj(i,e,t){let r="";const o={preserveDrawingBuffer:!0,...t};let p=null;if(p||(p=i.getContext("webgl2",o)),o.failIfMajorPerformanceCaveat&&(r||(r="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow.")),!p&&!t.failIfMajorPerformanceCaveat&&(o.failIfMajorPerformanceCaveat=!1,p=i.getContext("webgl2",o),p.luma||(p.luma={}),p.luma.softwareRenderer=!0),p||(p=i.getContext("webgl",{}),p&&(p=null,r||(r="Your browser only supports WebGL1"))),!p)throw r||(r="Your browser does not support WebGL"),new Error(`Failed to create WebGL context: ${r}`);const{onContextLost:_,onContextRestored:l}=e;return i.addEventListener("webglcontextlost",M=>_(M),!1),i.addEventListener("webglcontextrestored",M=>l(M),!1),p.luma||(p.luma={}),p}function i2(i,e,t){return t[e]===void 0&&(t[e]=i.getExtension(e)||null),t[e]}function Ij(i,e){const t=i.getParameter(7936),r=i.getParameter(7937);i2(i,"WEBGL_debug_renderer_info",e);const o=e.WEBGL_debug_renderer_info,p=i.getParameter(o?o.UNMASKED_VENDOR_WEBGL:7936),_=i.getParameter(o?o.UNMASKED_RENDERER_WEBGL:7937),l=p||t,M=_||r,D=i.getParameter(7938),B=sR(l,M),j=kj(l,M),$=Dj(l,M);return{type:"webgl",gpu:B,gpuType:$,gpuBackend:j,vendor:l,renderer:M,version:D,shadingLanguage:"glsl",shadingLanguageVersion:300}}function sR(i,e){return/NVIDIA/i.exec(i)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(i)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(i)||/Apple/i.exec(e)?"apple":/AMD/i.exec(i)||/AMD/i.exec(e)||/ATI/i.exec(i)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(i)||/SwiftShader/i.exec(e)?"software":"unknown"}function kj(i,e){return/Metal/i.exec(i)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(i)||/ANGLE/i.exec(e)?"opengl":"unknown"}function Dj(i,e){if(/SwiftShader/i.exec(i)||/SwiftShader/i.exec(e))return"cpu";switch(sR(i,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function aR(i){switch(i){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(i))}const Z2="WEBGL_compressed_texture_s3tc",X2="WEBGL_compressed_texture_s3tc_srgb",Vy="EXT_texture_compression_rgtc",jy="EXT_texture_compression_bptc",Oj="WEBGL_compressed_texture_etc",Fj="WEBGL_compressed_texture_astc",Nj="WEBGL_compressed_texture_etc1",Bj="WEBGL_compressed_texture_pvrtc",zj="WEBGL_compressed_texture_atc",fS="EXT_texture_norm16",dS="EXT_render_snorm",Lj="EXT_color_buffer_float",e3={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[dS],"norm16-renderable-webgl":[fS],"snorm16-renderable-webgl":[fS,dS],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[Z2,X2,Vy,jy],"texture-compression-bc5-webgl":[Vy],"texture-compression-bc7-webgl":[jy],"texture-compression-etc2":[Oj],"texture-compression-astc":[Fj],"texture-compression-etc1-webgl":[Nj],"texture-compression-pvrtc-webgl":[Bj],"texture-compression-atc-webgl":[zj]};function Uj(i){return i in e3}function Vj(i,e,t){return(e3[e]||[]).every(o=>i2(i,o,t))}const t3={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},r16unorm:{gl:33322,rb:!0},r16snorm:{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},rg16unorm:{gl:33324},rg16snorm:{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},rgb10a2uint:{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},rgba16unorm:{gl:32859,rb:!0},rgba16snorm:{gl:36763},"rgb32float-webgl":{gl:34837,x:Lj,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:Z2},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:X2},"bc1-rgba-unorm":{gl:33777,x:Z2},"bc1-rgba-unorm-srgb":{gl:35916,x:X2},"bc2-rgba-unorm":{gl:33778,x:Z2},"bc2-rgba-unorm-srgb":{gl:35918,x:X2},"bc3-rgba-unorm":{gl:33779,x:Z2},"bc3-rgba-unorm-srgb":{gl:35919,x:X2},"bc4-r-unorm":{gl:36283,x:Vy},"bc4-r-snorm":{gl:36284,x:Vy},"bc5-rg-unorm":{gl:36285,x:Vy},"bc5-rg-snorm":{gl:36286,x:Vy},"bc6h-rgb-ufloat":{gl:36495,x:jy},"bc6h-rgb-float":{gl:36494,x:jy},"bc7-rgba-unorm":{gl:36492,x:jy},"bc7-rgba-unorm-srgb":{gl:36493,x:jy},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function jj(i,e,t){let r=e.create;const o=t3[e.format];return(o==null?void 0:o.gl)===void 0&&(r=!1),o!=null&&o.x&&(r=r&&!!i2(i,o.x,t)),{format:e.format,create:r&&e.create,render:r&&e.render,filter:r&&e.filter,blend:r&&e.blend,store:r&&e.store}}function oR(i){var o;const e=t3[i],t=Zj(i),r=Xy.getInfo(i);return r.compressed&&(e.dataFormat=t),{internalFormat:t,format:(e==null?void 0:e.dataFormat)||Wj(r.channels,r.integer,r.normalized,t),type:r.dataType?aR(r.dataType):((o=e==null?void 0:e.types)==null?void 0:o[0])||5121,compressed:r.compressed||!1}}function Gj(i){switch(Xy.getInfo(i).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error(`Not a depth stencil format: ${i}`)}}function Wj(i,e,t,r){if(r===6408||r===6407)return r;switch(i){case"r":return e&&!t?36244:6403;case"rg":return e&&!t?33320:33319;case"rgb":return e&&!t?36248:6407;case"rgba":return e&&!t?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}function Zj(i){const e=t3[i],t=e==null?void 0:e.gl;if(t===void 0)throw new Error(`Unsupported texture format ${i}`);return t}const pS={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class Xj extends sz{constructor(t,r,o){super([],o);pe(this,"gl");pe(this,"extensions");pe(this,"testedFeatures",new Set);this.gl=t,this.extensions=r,i2(t,"EXT_color_buffer_float",r)}*[Symbol.iterator](){const t=this.getFeatures();for(const r of t)this.has(r)&&(yield r);return[]}has(t){var r;return(r=this.disabledFeatures)!=null&&r[t]?!1:(this.testedFeatures.has(t)||(this.testedFeatures.add(t),Uj(t)&&Vj(this.gl,t,this.extensions)&&this.features.add(t),this.getWebGLFeature(t)&&this.features.add(t)),this.features.has(t))}initializeFeatures(){const t=this.getFeatures().filter(r=>r!=="polygon-mode-webgl");for(const r of t)this.has(r)}getFeatures(){return[...Object.keys(pS),...Object.keys(e3)]}getWebGLFeature(t){const r=pS[t];return typeof r=="string"?!!i2(this.gl,r,this.extensions):!!r}}class Hj extends rz{constructor(t){super();pe(this,"gl");pe(this,"limits",{});this.gl=t}get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderVariables(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}getParameter(t){return this.limits[t]===void 0&&(this.limits[t]=this.gl.getParameter(t)),this.limits[t]||0}}class n1 extends tx{constructor(t,r){super(t,r);pe(this,"device");pe(this,"gl");pe(this,"handle");pe(this,"colorAttachments",[]);pe(this,"depthStencilAttachment",null);const o=r.handle===null;this.device=t,this.gl=t.gl,this.handle=this.props.handle||o?this.props.handle:this.gl.createFramebuffer(),o||(t._setWebGLDebugMetadata(this.handle,this,{spector:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}updateAttachments(){const t=this.gl.bindFramebuffer(36160,this.handle);for(let r=0;r<this.colorAttachments.length;++r){const o=this.colorAttachments[r];if(o){const p=36064+r;this._attachTextureView(p,o)}}if(this.depthStencilAttachment){const r=Gj(this.depthStencilAttachment.props.format);this._attachTextureView(r,this.depthStencilAttachment)}if(this.device.props.debug){const r=this.gl.checkFramebufferStatus(36160);if(r!==36053)throw new Error(`Framebuffer ${qj(r)}`)}this.gl.bindFramebuffer(36160,t)}_attachTextureView(t,r){const{gl:o}=this.device,{texture:p}=r,_=r.props.baseMipLevel,l=r.props.baseArrayLayer;switch(o.bindTexture(p.glTarget,p.handle),p.glTarget){case 35866:case 32879:o.framebufferTextureLayer(36160,t,p.handle,_,l);break;case 34067:const M=$j(l);o.framebufferTexture2D(36160,t,M,p.handle,_);break;case 3553:o.framebufferTexture2D(36160,t,3553,p.handle,_);break;default:throw new Error("Illegal texture type")}o.bindTexture(p.glTarget,null)}}function $j(i){return i<34069?i+34069:i}function qj(i){switch(i){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${i}`}}class Yj extends Qv{constructor(t,r){super(r);pe(this,"device");pe(this,"handle",null);pe(this,"_framebuffer",null);this.device=t,this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this._updateDevice()}get[Symbol.toStringTag](){return"WebGLCanvasContext"}getCurrentFramebuffer(){return this._framebuffer=this._framebuffer||new n1(this.device,{handle:null}),this._framebuffer}_updateDevice(){}}const Qb={};function Jj(i="id"){Qb[i]=Qb[i]||1;const e=Qb[i]++;return`${i}-${e}`}class r1 extends xa{constructor(t,r={}){super(t,r);pe(this,"device");pe(this,"gl");pe(this,"handle");pe(this,"glTarget");pe(this,"glUsage");pe(this,"glIndexType",5123);pe(this,"byteLength",0);pe(this,"bytesUsed",0);this.device=t,this.gl=this.device.gl;const o=typeof r=="object"?r.handle:void 0;this.handle=o||this.gl.createBuffer(),t._setWebGLDebugMetadata(this.handle,this,{spector:{...this.props,data:typeof this.props.data}}),this.glTarget=Qj(this.props.usage),this.glUsage=Kj(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,r.data?this._initWithData(r.data,r.byteOffset,r.byteLength):this._initWithByteLength(r.byteLength||0)}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}_initWithData(t,r=0,o=t.byteLength+r){const p=this.glTarget;this.gl.bindBuffer(p,this.handle),this.gl.bufferData(p,o,this.glUsage),this.gl.bufferSubData(p,r,t),this.gl.bindBuffer(p,null),this.bytesUsed=o,this.byteLength=o,this._setDebugData(t,r,o),this.trackAllocatedMemory(o)}_initWithByteLength(t){let r=t;t===0&&(r=new Float32Array(0));const o=this.glTarget;return this.gl.bindBuffer(o,this.handle),this.gl.bufferData(o,r,this.glUsage),this.gl.bindBuffer(o,null),this.bytesUsed=t,this.byteLength=t,this._setDebugData(null,0,t),this.trackAllocatedMemory(t),this}write(t,r=0){const o=ArrayBuffer.isView(t)?t:new Uint8Array(t),p=36663;this.gl.bindBuffer(p,this.handle),this.gl.bufferSubData(p,r,o),this.gl.bindBuffer(p,null),this._setDebugData(t,r,t.byteLength)}async mapAndWriteAsync(t,r=0,o=this.byteLength-r){const p=new ArrayBuffer(o);await t(p,"copied"),this.write(p,r)}async readAsync(t=0,r){return this.readSyncWebGL(t,r)}async mapAndReadAsync(t,r=0,o){const p=await this.readAsync(r,o);return await t(p.buffer,"copied")}readSyncWebGL(t=0,r){r=r??this.byteLength-t;const o=new Uint8Array(r),p=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,t,o,p,r),this.gl.bindBuffer(36662,null),this._setDebugData(o,t,r),o}}function Qj(i){return i&xa.INDEX?34963:i&xa.VERTEX?34962:i&xa.UNIFORM?35345:34962}function Kj(i){return i&xa.INDEX||i&xa.VERTEX?35044:i&xa.UNIFORM?35048:35044}function eG(i){const e=i.split(/\r?\n/),t=[];for(const r of e){if(r.length<=1)continue;const o=r.split(":");if(o.length===2){const[j,$]=o;t.push({message:$.trim(),type:gS(j),lineNum:0,linePos:0});continue}const[p,_,l,...M]=o;let D=parseInt(l,10);isNaN(D)&&(D=0);let B=parseInt(_,10);isNaN(B)&&(B=0),t.push({message:M.join(":").trim(),type:gS(p),lineNum:D,linePos:B})}return t}function gS(i){const e=["warning","error","info"],t=i.toLowerCase();return e.includes(t)?t:"info"}class tG extends ex{constructor(t,r){super(t,r);pe(this,"device");pe(this,"handle");switch(this.device=t,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}t._setWebGLDebugMetadata(this.handle,this,{spector:this.props}),this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0,this.handle.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>(this._getCompilationStatus(),this.compilationStatus))}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const t=this.device.gl.getShaderInfoLog(this.handle);return t?eG(t):[]}getTranslatedSource(){const r=this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders;return(r==null?void 0:r.getTranslatedShaderSource(this.handle))||null}async _compile(t){t=t.startsWith("#version ")?t:`#version 300 es
${t}`;const{gl:r}=this.device;if(r.shaderSource(this.handle,t),r.compileShader(this.handle),!this.device.props.debug){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}ni.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),ni.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const t=async p=>await new Promise(_=>setTimeout(_,p));if(!this.device.features.has("compilation-status-async-webgl")){await t(10);return}const{gl:o}=this.device;for(;;){if(o.getShaderParameter(this.handle,37297))return;await t(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}function iG(i,e,t,r){if(aG(e))return r(i);const o=i;o.pushState();try{return nG(i,e),a2(o.gl,t),r(i)}finally{o.popState()}}function nG(i,e){const t=i,{gl:r}=t;if(e.cullMode)switch(e.cullMode){case"none":r.disable(2884);break;case"front":r.enable(2884),r.cullFace(1028);break;case"back":r.enable(2884),r.cullFace(1029);break}if(e.frontFace&&r.frontFace(b_("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&i.features.has("depth-clip-control")&&r.enable(34383),e.depthBias!==void 0&&(r.enable(32823),r.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&i.features.has("provoking-vertex-webgl")){const p=t.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,_=b_("provokingVertex",e.provokingVertex,{first:36429,last:36430});p==null||p.provokingVertexWEBGL(_)}if((e.polygonMode||e.polygonOffsetLine)&&i.features.has("polygon-mode-webgl")){if(e.polygonMode){const p=t.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,_=b_("polygonMode",e.polygonMode,{fill:6914,line:6913});p==null||p.polygonModeWEBGL(1028,_),p==null||p.polygonModeWEBGL(1029,_)}e.polygonOffsetLine&&r.enable(10754)}if(i.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&r.enable(12288),e.clipDistance1&&r.enable(12289),e.clipDistance2&&r.enable(12290),e.clipDistance3&&r.enable(12291),e.clipDistance4&&r.enable(12292),e.clipDistance5&&r.enable(12293),e.clipDistance6&&r.enable(12294),e.clipDistance7&&r.enable(12295)),e.depthWriteEnabled!==void 0&&r.depthMask(sG("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?r.enable(2929):r.disable(2929),r.depthFunc(YA("depthCompare",e.depthCompare))),e.stencilWriteMask){const o=e.stencilWriteMask;r.stencilMaskSeparate(1028,o),r.stencilMaskSeparate(1029,o)}if(e.stencilReadMask&&ni.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const o=e.stencilReadMask||4294967295,p=YA("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?r.enable(2960):r.disable(2960),r.stencilFuncSeparate(1028,p,0,o),r.stencilFuncSeparate(1029,p,0,o)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const o=Kb("stencilPassOperation",e.stencilPassOperation),p=Kb("stencilFailOperation",e.stencilFailOperation),_=Kb("stencilDepthFailOperation",e.stencilDepthFailOperation);r.stencilOpSeparate(1028,p,_,o),r.stencilOpSeparate(1029,p,_,o)}switch(e.blend){case!0:r.enable(3042);break;case!1:r.disable(3042);break}if(e.blendColorOperation||e.blendAlphaOperation){const o=mS("blendColorOperation",e.blendColorOperation||"add"),p=mS("blendAlphaOperation",e.blendAlphaOperation||"add");r.blendEquationSeparate(o,p);const _=_v("blendColorSrcFactor",e.blendColorSrcFactor||"one"),l=_v("blendColorDstFactor",e.blendColorDstFactor||"zero"),M=_v("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),D=_v("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");r.blendFuncSeparate(_,l,M,D)}}function YA(i,e){return b_(i,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function Kb(i,e){return b_(i,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function mS(i,e){return b_(i,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function _v(i,e,t="color"){return b_(i,e,{one:1,zero:0,src:768,"one-minus-src":769,dst:774,"one-minus-dst":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,constant:t==="color"?32769:32771,"one-minus-constant":t==="color"?32770:32772,src1:768,"one-minus-src1":769,"src1-alpha":770,"one-minus-src1-alpha":771})}function rG(i,e){return`Illegal parameter ${e} for ${i}`}function b_(i,e,t){if(!(e in t))throw new Error(rG(i,e));return t[e]}function sG(i,e){return e}function aG(i){let e=!0;for(const t in i){e=!1;break}return e}function lR(i){const e={};return i.addressModeU&&(e[10242]=eA(i.addressModeU)),i.addressModeV&&(e[10243]=eA(i.addressModeV)),i.addressModeW&&(e[32882]=eA(i.addressModeW)),i.magFilter&&(e[10240]=JA(i.magFilter)),(i.minFilter||i.mipmapFilter)&&(e[10241]=oG(i.minFilter||"linear",i.mipmapFilter)),i.lodMinClamp!==void 0&&(e[33082]=i.lodMinClamp),i.lodMaxClamp!==void 0&&(e[33083]=i.lodMaxClamp),i.type==="comparison-sampler"&&(e[34892]=34894),i.compare&&(e[34893]=YA("compare",i.compare)),i.maxAnisotropy&&(e[34046]=i.maxAnisotropy),e}function eA(i){switch(i){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function JA(i){switch(i){case"nearest":return 9728;case"linear":return 9729}}function oG(i,e="none"){if(!e)return JA(i);switch(e){case"none":return JA(i);case"nearest":switch(i){case"nearest":return 9984;case"linear":return 9985}break;case"linear":switch(i){case"nearest":return 9986;case"linear":return 9987}}}class lG extends Yy{constructor(t,r){super(t,r);pe(this,"device");pe(this,"handle");pe(this,"parameters");this.device=t,this.parameters=lR(r),this.handle=r.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(t){for(const[r,o]of Object.entries(t)){const p=Number(r);switch(p){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,p,o);break;default:this.device.gl.samplerParameteri(this.handle,p,o);break}}}}function b1(i,e,t){if(cG(e))return t(i);const{nocatch:r=!0}=e,o=x_.get(i);o.push(),a2(i,e);let p;if(r)p=t(i),o.pop();else try{p=t(i)}finally{o.pop()}return p}function cG(i){for(const e in i)return!1;return!0}class Gy extends Kv{constructor(t,r){super(t,{...lh.defaultProps,...r});pe(this,"device");pe(this,"gl");pe(this,"handle");pe(this,"texture");this.device=t,this.gl=this.device.gl,this.handle=null,this.texture=r.texture}}class s1 extends lh{constructor(t,r){super(t,r);pe(this,"device");pe(this,"gl");pe(this,"handle");pe(this,"sampler");pe(this,"view");pe(this,"glTarget");pe(this,"glFormat");pe(this,"glType");pe(this,"glInternalFormat");pe(this,"compressed");pe(this,"_textureUnit",0);this.device=t,this.gl=this.device.gl;const o=oR(this.props.format);this.glTarget=uG(this.props.dimension),this.glInternalFormat=o.internalFormat,this.glFormat=o.format,this.glType=o.type,this.compressed=o.compressed,this.handle=this.props.handle||this.gl.createTexture(),this.device._setWebGLDebugMetadata(this.handle,this,{spector:this.props}),this.gl.bindTexture(this.glTarget,this.handle);const{dimension:p,width:_,height:l,depth:M,mipLevels:D,glTarget:B,glInternalFormat:j}=this;switch(p){case"2d":case"cube":this.gl.texStorage2D(B,D,j,_,l);break;case"2d-array":case"3d":this.gl.texStorage3D(B,D,j,_,l,M);break;default:throw new Error(p)}this.gl.bindTexture(this.glTarget,null),this._initializeData(r.data),this.setSampler(this.props.sampler),this.view=new Gy(this.device,{...this.props,texture:this}),Object.seal(this)}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(t){return new Gy(this.device,{...t,texture:this})}setSampler(t={}){super.setSampler(t);const r=lR(this.sampler.props);this._setSamplerParameters(r)}copyImageData(t){const r=this._normalizeCopyImageDataOptions(t),o=r.data,{width:p,height:_,depth:l}=this,{mipLevel:M=0,byteOffset:D=0,x:B=0,y:j=0,z:$=0}=r,{glFormat:se,glType:de,compressed:Ae}=this,he=_S(this.glTarget,this.dimension,$);let Le;if(!this.compressed){const{bytesPerPixel:Be}=this.device.getTextureFormatInfo(this.format);if(Be){if(r.bytesPerRow%Be!==0)throw new Error(`bytesPerRow (${r.bytesPerRow}) must be a multiple of bytesPerPixel (${Be}) for ${this.format}`);Le=r.bytesPerRow/Be}}const $e=this.compressed?{}:{...Le!==void 0?{3314:Le}:{},32878:r.rowsPerImage};this.gl.bindTexture(he,this.handle),b1(this.gl,$e,()=>{switch(this.dimension){case"2d":case"cube":Ae?this.gl.compressedTexSubImage2D(he,M,B,j,p,_,se,o,D):this.gl.texSubImage2D(he,M,B,j,p,_,se,de,o,D);break;case"2d-array":case"3d":Ae?this.gl.compressedTexSubImage3D(he,M,B,j,$,p,_,l,se,o,D):this.gl.texSubImage3D(he,M,B,j,$,p,_,l,se,de,o,D);break;default:}}),this.gl.bindTexture(he,null)}copyExternalImage(t){const r=this._normalizeCopyExternalImageOptions(t);if(r.sourceX||r.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");const{glFormat:o,glType:p}=this,{image:_,depth:l,mipLevel:M,x:D,y:B,z:j,width:$,height:se}=r,de=_S(this.glTarget,this.dimension,l),Ae=r.flipY?{37440:!0}:{};return this.gl.bindTexture(this.glTarget,this.handle),b1(this.gl,Ae,()=>{switch(this.dimension){case"2d":case"cube":this.gl.texSubImage2D(de,M,D,B,$,se,o,p,_);break;case"2d-array":case"3d":this.gl.texSubImage3D(de,M,D,B,j,$,se,l,o,p,_);break;default:}}),this.gl.bindTexture(this.glTarget,null),{width:r.width,height:r.height}}generateMipmapsWebGL(t){if(!(!(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format))&&(ni.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),!(t!=null&&t.force))))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(o){ni.warn(`Error generating mipmap for ${this}: ${o.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}_setSamplerParameters(t){ni.log(2,`${this.id} sampler parameters`,this.device.getGLKeys(t))(),this.gl.bindTexture(this.glTarget,this.handle);for(const[r,o]of Object.entries(t)){const p=Number(r),_=o;switch(p){case 33082:case 33083:this.gl.texParameterf(this.glTarget,p,_);break;case 10240:case 10241:this.gl.texParameteri(this.glTarget,p,_);break;case 10242:case 10243:case 32882:this.gl.texParameteri(this.glTarget,p,_);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,p,_);break;case 34892:case 34893:this.gl.texParameteri(this.glTarget,p,_);break}}this.gl.bindTexture(this.glTarget,null)}_getActiveUnit(){return this.gl.getParameter(34016)-33984}_bind(t){const{gl:r}=this;return t!==void 0&&(this._textureUnit=t,r.activeTexture(33984+t)),r.bindTexture(this.glTarget,this.handle),t}_unbind(t){const{gl:r}=this;return t!==void 0&&(this._textureUnit=t,r.activeTexture(33984+t)),r.bindTexture(this.glTarget,null),t}}function uG(i){switch(i){case"1d":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866}throw new Error(i)}function _S(i,e,t){return e==="cube"?34069+t:i}function hG(i){return gG[i]}function i3(i){return pG[i]}function fG(i){return!!cR[i]}function dG(i){return cR[i]}const pG={5126:"f32",35664:"vec2<f32>",35665:"vec3<f32>",35666:"vec4<f32>",5124:"i32",35667:"vec2<i32>",35668:"vec3<i32>",35669:"vec4<i32>",5125:"u32",36294:"vec2<u32>",36295:"vec3<u32>",36296:"vec4<u32>",35670:"f32",35671:"vec2<f32>",35672:"vec3<f32>",35673:"vec4<f32>",35674:"mat2x2<f32>",35685:"mat2x3<f32>",35686:"mat2x4<f32>",35687:"mat3x2<f32>",35675:"mat3x3<f32>",35688:"mat3x4<f32>",35689:"mat4x2<f32>",35690:"mat4x3<f32>",35676:"mat4x4<f32>"},cR={35678:{viewDimension:"2d",sampleType:"float"},35680:{viewDimension:"cube",sampleType:"float"},35679:{viewDimension:"3d",sampleType:"float"},35682:{viewDimension:"3d",sampleType:"depth"},36289:{viewDimension:"2d-array",sampleType:"float"},36292:{viewDimension:"2d-array",sampleType:"depth"},36293:{viewDimension:"cube",sampleType:"float"},36298:{viewDimension:"2d",sampleType:"sint"},36299:{viewDimension:"3d",sampleType:"sint"},36300:{viewDimension:"cube",sampleType:"sint"},36303:{viewDimension:"2d-array",sampleType:"uint"},36306:{viewDimension:"2d",sampleType:"uint"},36307:{viewDimension:"3d",sampleType:"uint"},36308:{viewDimension:"cube",sampleType:"uint"},36311:{viewDimension:"2d-array",sampleType:"uint"}},gG={uint8:5121,sint8:5120,unorm8:5121,snorm8:5120,uint16:5123,sint16:5122,unorm16:5123,snorm16:5122,uint32:5125,sint32:5124,float16:5131,float32:5126};function mG(i,e){const t={attributes:[],bindings:[]};t.attributes=_G(i,e);const r=xG(i,e);for(const l of r){const M=l.uniforms.map(D=>({name:D.name,format:D.format,byteOffset:D.byteOffset,byteStride:D.byteStride,arrayLength:D.arrayLength}));t.bindings.push({type:"uniform",name:l.name,group:0,location:l.location,visibility:(l.vertex?1:0)&(l.fragment?2:0),minBindingSize:l.byteLength,uniforms:M})}const o=vG(i,e);let p=0;for(const l of o)if(fG(l.type)){const{viewDimension:M,sampleType:D}=dG(l.type);t.bindings.push({type:"texture",name:l.name,group:0,location:p,viewDimension:M,sampleType:D}),l.textureUnit=p,p+=1}o.length&&(t.uniforms=o);const _=yG(i,e);return _!=null&&_.length&&(t.varyings=_),t}function _G(i,e){const t=[],r=i.getProgramParameter(e,35721);for(let o=0;o<r;o++){const p=i.getActiveAttrib(e,o);if(!p)throw new Error("activeInfo");const{name:_,type:l}=p,M=i.getAttribLocation(e,_);if(M>=0){const D=i3(l),B=/instance/i.test(_)?"instance":"vertex";t.push({name:_,location:M,stepMode:B,type:D})}}return t.sort((o,p)=>o.location-p.location),t}function yG(i,e){const t=[],r=i.getProgramParameter(e,35971);for(let o=0;o<r;o++){const p=i.getTransformFeedbackVarying(e,o);if(!p)throw new Error("activeInfo");const{name:_,type:l,size:M}=p,D=i3(l),{type:B,components:j}=YE(D);t.push({location:o,name:_,type:B,size:M*j})}return t.sort((o,p)=>o.location-p.location),t}function vG(i,e){const t=[],r=i.getProgramParameter(e,35718);for(let o=0;o<r;o++){const p=i.getActiveUniform(e,o);if(!p)throw new Error("activeInfo");const{name:_,size:l,type:M}=p,{name:D,isArray:B}=bG(_);let j=i.getUniformLocation(e,D);const $={location:j,name:D,size:l,type:M,isArray:B};if(t.push($),$.size>1)for(let se=0;se<$.size;se++){const de=`${D}[${se}]`;j=i.getUniformLocation(e,de);const Ae={...$,name:de,location:j};t.push(Ae)}}return t}function xG(i,e){const t=(p,_)=>i.getActiveUniformBlockParameter(e,p,_),r=[],o=i.getProgramParameter(e,35382);for(let p=0;p<o;p++){const _={name:i.getActiveUniformBlockName(e,p)||"",location:t(p,35391),byteLength:t(p,35392),vertex:t(p,35396),fragment:t(p,35398),uniformCount:t(p,35394),uniforms:[]},l=t(p,35395)||[],M=i.getActiveUniforms(e,l,35383),D=i.getActiveUniforms(e,l,35384),B=i.getActiveUniforms(e,l,35387),j=i.getActiveUniforms(e,l,35388);for(let $=0;$<_.uniformCount;++$){const se=i.getActiveUniform(e,l[$]);if(!se)throw new Error("activeInfo");const de=i3(M[$]);_.uniforms.push({name:se.name,format:de,type:M[$],arrayLength:D[$],byteOffset:B[$],byteStride:j[$]})}r.push(_)}return r.sort((p,_)=>p.location-_.location),r}function bG(i){if(i[i.length-1]!=="]")return{name:i,length:1,isArray:!1};const t=/([^[]*)(\[[0-9]+\])?/.exec(i);if(!t||t.length<2)throw new Error(`Failed to parse GLSL uniform name ${i}`);return{name:t[1],length:t[2]?1:0,isArray:!!t[2]}}function AG(i,e,t,r){const o=i;let p=r;p===!0&&(p=1),p===!1&&(p=0);const _=typeof p=="number"?[p]:p;switch(t){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof r!="number")throw new Error("samplers must be set to integers");return i.uniform1i(e,r);case 5126:return i.uniform1fv(e,_);case 35664:return i.uniform2fv(e,_);case 35665:return i.uniform3fv(e,_);case 35666:return i.uniform4fv(e,_);case 5124:return i.uniform1iv(e,_);case 35667:return i.uniform2iv(e,_);case 35668:return i.uniform3iv(e,_);case 35669:return i.uniform4iv(e,_);case 35670:return i.uniform1iv(e,_);case 35671:return i.uniform2iv(e,_);case 35672:return i.uniform3iv(e,_);case 35673:return i.uniform4iv(e,_);case 5125:return o.uniform1uiv(e,_,1);case 36294:return o.uniform2uiv(e,_,2);case 36295:return o.uniform3uiv(e,_,3);case 36296:return o.uniform4uiv(e,_,4);case 35674:return i.uniformMatrix2fv(e,!1,_);case 35675:return i.uniformMatrix3fv(e,!1,_);case 35676:return i.uniformMatrix4fv(e,!1,_);case 35685:return o.uniformMatrix2x3fv(e,!1,_);case 35686:return o.uniformMatrix2x4fv(e,!1,_);case 35687:return o.uniformMatrix3x2fv(e,!1,_);case 35688:return o.uniformMatrix3x4fv(e,!1,_);case 35689:return o.uniformMatrix4x2fv(e,!1,_);case 35690:return o.uniformMatrix4x3fv(e,!1,_)}throw new Error("Illegal uniform")}function wG(i){switch(i){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(i)}}function TG(i){switch(i){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;default:throw new Error(i)}}const yS=4;class SG extends __{constructor(t,r){super(t,r);pe(this,"device");pe(this,"handle");pe(this,"vs");pe(this,"fs");pe(this,"introspectedLayout");pe(this,"uniforms",{});pe(this,"bindings",{});pe(this,"varyings",null);pe(this,"_uniformCount",0);pe(this,"_uniformSetters",{});this.device=t,this.handle=this.props.handle||this.device.gl.createProgram(),this.device._setWebGLDebugMetadata(this.handle,this,{spector:{id:this.props.id}}),this.vs=r.vs,this.fs=r.fs;const{varyings:o,bufferMode:p=35981}=r;o&&o.length>0&&(this.varyings=o,this.device.gl.transformFeedbackVaryings(this.handle,o,p)),this._linkShaders(),ni.time(3,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=mG(this.device.gl,this.handle),ni.timeEnd(3,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=r.shaderLayout?EG(this.introspectedLayout,r.shaderLayout):this.introspectedLayout}get[Symbol.toStringTag](){return"WEBGLRenderPipeline"}destroy(){this.handle&&(this.device.gl.useProgram(null),this.device.gl.deleteProgram(this.handle),this.destroyed=!0,this.handle.destroyed=!0,this.handle=null)}setBindings(t,r){for(const[o,p]of Object.entries(t)){const _=this.shaderLayout.bindings.find(l=>l.name===o)||this.shaderLayout.bindings.find(l=>l.name===`${o}Uniforms`);if(!_){const l=this.shaderLayout.bindings.map(M=>`"${M.name}"`).join(", ");r!=null&&r.disableWarnings||ni.warn(`No binding "${o}" in render pipeline "${this.id}", expected one of ${l}`,p)();continue}switch(p||ni.warn(`Unsetting binding "${o}" in render pipeline "${this.id}"`)(),_.type){case"uniform":if(!(p instanceof r1)&&!(p.buffer instanceof r1))throw new Error("buffer value");break;case"texture":if(!(p instanceof Gy||p instanceof s1||p instanceof n1))throw new Error(`${this} Bad texture binding for ${o}`);break;case"sampler":ni.warn(`Ignoring sampler ${o}`)();break;default:throw new Error(_.type)}this.bindings[o]=p}}draw(t){var he;const{renderPass:r,parameters:o=this.props.parameters,topology:p=this.props.topology,vertexArray:_,vertexCount:l,instanceCount:M,isInstanced:D=!1,firstVertex:B=0,transformFeedback:j}=t,$=wG(p),se=!!_.indexBuffer,de=(he=_.indexBuffer)==null?void 0:he.glIndexType;if(this.linkStatus!=="success")return ni.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return ni.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),_.bindBeforeRender(r),j&&j.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const Ae=r;return iG(this.device,o,Ae.glParameters,()=>{se&&D?this.device.gl.drawElementsInstanced($,l||0,de,B,M||0):se?this.device.gl.drawElements($,l||0,de,B):D?this.device.gl.drawArraysInstanced($,B,l||0,M||0):this.device.gl.drawArrays($,B,l||0),j&&j.end()}),_.unbindAfterRender(r),!0}async _linkShaders(){const{gl:t}=this.device;if(t.attachShader(this.handle,this.vs.handle),t.attachShader(this.handle,this.fs.handle),ni.time(yS,`linkProgram for ${this.id}`)(),t.linkProgram(this.handle),ni.timeEnd(yS,`linkProgram for ${this.id}`)(),ni.level,!this.device.features.has("compilation-status-async-webgl")){const o=this._getLinkStatus();this._reportLinkStatus(o);return}ni.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),ni.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const r=this._getLinkStatus();this._reportLinkStatus(r)}async _reportLinkStatus(t){var r;switch(t){case"success":return;default:const o=t==="link-error"?"Link error":"Validation error";switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`${this} ${o} during compilation of ${this.vs}`);case"pending":await this.vs.asyncCompilationStatus,this.vs.debugShader();break}switch((r=this.fs)==null?void 0:r.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`${this} ${o} during compilation of ${this.fs}`);case"pending":await this.fs.asyncCompilationStatus,this.fs.debugShader();break}const p=this.device.gl.getProgramInfoLog(this.handle);this.device.reportError(new Error(`${o} during ${t}: ${p}`),this)(),this.device.debug()}}_getLinkStatus(){const{gl:t}=this.device;return t.getProgramParameter(this.handle,35714)?(t.validateProgram(this.handle),t.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation-error")):(this.linkStatus="error","link-error")}async _waitForLinkComplete(){const t=async p=>await new Promise(_=>setTimeout(_,p));if(!this.device.features.has("compilation-status-async-webgl")){await t(10);return}const{gl:o}=this.device;for(;;){if(o.getProgramParameter(this.handle,37297))return;await t(10)}}_areTexturesRenderable(){let t=!0;for(const r of this.shaderLayout.bindings)!this.bindings[r.name]&&!this.bindings[r.name.replace(/Uniforms$/,"")]&&(ni.warn(`Binding ${r.name} not found in ${this.id}`)(),t=!1);return t}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:t}=this.device;t.useProgram(this.handle);let r=0,o=0;for(const p of this.shaderLayout.bindings){const _=this.bindings[p.name]||this.bindings[p.name.replace(/Uniforms$/,"")];if(!_)throw new Error(`No value for binding ${p.name} in ${this.id}`);switch(p.type){case"uniform":const{name:l}=p,M=t.getUniformBlockIndex(this.handle,l);if(M===4294967295)throw new Error(`Invalid uniform block name ${l}`);t.uniformBlockBinding(this.handle,o,M),_ instanceof r1?t.bindBufferBase(35345,o,_.handle):t.bindBufferRange(35345,o,_.buffer.handle,_.offset||0,_.size||_.buffer.byteLength-_.offset),o+=1;break;case"texture":if(!(_ instanceof Gy||_ instanceof s1||_ instanceof n1))throw new Error("texture");let D;if(_ instanceof Gy)D=_.texture;else if(_ instanceof s1)D=_;else if(_ instanceof n1&&_.colorAttachments[0]instanceof Gy)ni.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),D=_.colorAttachments[0].texture;else throw new Error("No texture");t.activeTexture(33984+r),t.bindTexture(D.glTarget,D.handle),r+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${p.type}' not supported in WebGL`)}}}_applyUniforms(){for(const t of this.shaderLayout.uniforms||[]){const{name:r,location:o,type:p,textureUnit:_}=t,l=this.uniforms[r]??_;l!==void 0&&AG(this.device.gl,o,p,l)}}}function EG(i,e){const t={...i,attributes:i.attributes.map(r=>({...r}))};for(const r of(e==null?void 0:e.attributes)||[]){const o=t.attributes.find(p=>p.name===r.name);o?(o.type=r.type||o.type,o.stepMode=r.stepMode||o.stepMode):ni.warn(`shader layout attribute ${r.name} not present in shader`)}return t}class MG extends EA{constructor(t){super(t,{});pe(this,"device");pe(this,"handle",null);pe(this,"commands",[]);this.device=t}_executeCommands(t=this.commands){for(const r of t)switch(r.name){case"copy-buffer-to-buffer":RG(this.device,r.options);break;case"copy-buffer-to-texture":CG(this.device,r.options);break;case"copy-texture-to-buffer":PG(this.device,r.options);break;case"copy-texture-to-texture":IG(this.device,r.options);break;default:throw new Error(r.name)}}}function RG(i,e){const t=e.sourceBuffer,r=e.destinationBuffer;i.gl.bindBuffer(36662,t.handle),i.gl.bindBuffer(36663,r.handle),i.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),i.gl.bindBuffer(36662,null),i.gl.bindBuffer(36663,null)}function CG(i,e){throw new Error("Not implemented")}function PG(i,e){const{sourceTexture:t,mipLevel:r=0,aspect:o="all",width:p=e.sourceTexture.width,height:_=e.sourceTexture.height,depthOrArrayLayers:l=0,origin:M=[0,0],destinationBuffer:D,byteOffset:B=0,bytesPerRow:j,rowsPerImage:$}=e;if(o!=="all")throw new Error("aspect not supported in WebGL");if(r!==0||l!==0||j||$)throw new Error("not implemented");const{framebuffer:se,destroyFramebuffer:de}=uR(t);let Ae;try{const he=D,Le=p||se.width,$e=_||se.height,Be=oR(se.colorAttachments[0].texture.props.format),Je=Be.format,Rt=Be.type;i.gl.bindBuffer(35051,he.handle),Ae=i.gl.bindFramebuffer(36160,se.handle),i.gl.readPixels(M[0],M[1],Le,$e,Je,Rt,B)}finally{i.gl.bindBuffer(35051,null),Ae!==void 0&&i.gl.bindFramebuffer(36160,Ae),de&&se.destroy()}}function IG(i,e){const{sourceTexture:t,destinationMipLevel:r=0,origin:o=[0,0],destinationOrigin:p=[0,0],destinationTexture:_}=e;let{width:l=e.destinationTexture.width,height:M=e.destinationTexture.height}=e;const{framebuffer:D,destroyFramebuffer:B}=uR(t),[j,$]=o,[se,de,Ae]=p,he=i.gl.bindFramebuffer(36160,D.handle);let Le,$e;if(_ instanceof s1)Le=_,l=Number.isFinite(l)?l:Le.width,M=Number.isFinite(M)?M:Le.height,Le._bind(0),$e=Le.glTarget;else throw new Error("invalid destination");switch($e){case 3553:case 34067:i.gl.copyTexSubImage2D($e,r,se,de,j,$,l,M);break;case 35866:case 32879:i.gl.copyTexSubImage3D($e,r,se,de,Ae,j,$,l,M);break}Le&&Le._unbind(),i.gl.bindFramebuffer(36160,he),B&&D.destroy()}function uR(i){if(i instanceof lh){const{width:e,height:t,id:r}=i;return{framebuffer:i.device.createFramebuffer({id:`framebuffer-for-${r}`,width:e,height:t,colorAttachments:[i]}),destroyFramebuffer:!0}}return{framebuffer:i,destroyFramebuffer:!1}}const kG=[1,2,4,8];class DG extends TA{constructor(t,r){var _;super(t,r);pe(this,"device");pe(this,"handle",null);pe(this,"glParameters",{});this.device=t;let o;if(!((_=r==null?void 0:r.parameters)!=null&&_.viewport))if(r!=null&&r.framebuffer){const{width:l,height:M}=r.framebuffer;o=[0,0,l,M]}else{const[l,M]=t.getDefaultCanvasContext().getDrawingBufferSize();o=[0,0,l,M]}this.device.pushState(),this.setParameters({viewport:o,...this.props.parameters});const p=this.props.framebuffer;if(this.props.framebuffer&&(p!=null&&p.handle)){const l=this.props.framebuffer.colorAttachments.map((M,D)=>36064+D);this.device.gl.drawBuffers(l)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(t){}popDebugGroup(){}insertDebugMarker(t){}setParameters(t={}){const r={...this.glParameters};r.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(r.depthMask=!this.props.depthReadOnly),r.stencilMask=this.props.stencilReadOnly?0:1,r[35977]=this.props.discard,t.viewport&&(t.viewport.length>=6?(r.viewport=t.viewport.slice(0,4),r.depthRange=[t.viewport[4],t.viewport[5]]):r.viewport=t.viewport),t.scissorRect&&(r.scissorTest=!0,r.scissor=t.scissorRect),t.blendConstant&&(r.blendColor=t.blendConstant),t.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),r[2967]=t.stencilReference),"colorMask"in t&&(r.colorMask=kG.map(o=>!!(o&t.colorMask))),this.glParameters=r,a2(this.device.gl,r)}beginOcclusionQuery(t){const r=this.props.occlusionQuerySet;r==null||r.beginOcclusionQuery()}endOcclusionQuery(){const t=this.props.occlusionQuerySet;t==null||t.endOcclusionQuery()}clear(){const t={...this.glParameters};let r=0;this.props.clearColors&&this.props.clearColors.forEach((o,p)=>{o&&this.clearColorBuffer(p,o)}),this.props.clearColor!==!1&&this.props.clearColors===void 0&&(r|=16384,t.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(r|=256,t.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(r|=1024,t.clearStencil=this.props.clearStencil),r!==0&&b1(this.device.gl,t,()=>{this.device.gl.clear(r)})}clearColorBuffer(t=0,r=[0,0,0,0]){b1(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(r.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,t,r);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,t,r);break;case Float32Array:this.device.gl.clearBufferfv(6144,t,r);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}}class vS extends SA{constructor(t,r){super(t,r);pe(this,"device");pe(this,"handle",null);pe(this,"commandBuffer");this.device=t,this.commandBuffer=new MG(t)}destroy(){}finish(){return this.commandBuffer}beginRenderPass(t){return new DG(this.device,t)}beginComputePass(t){throw new Error("ComputePass not supported in WebGL")}copyBufferToBuffer(t){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:t})}copyBufferToTexture(t){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:t})}copyTextureToBuffer(t){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:t})}copyTextureToTexture(t){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:t})}pushDebugGroup(t){}popDebugGroup(){}insertDebugMarker(t){}resolveQuerySet(t,r,o){}}function OG(i){const{target:e,source:t,start:r=0,count:o=1}=i,p=t.length,_=o*p;let l=0;for(let M=r;l<p;l++)e[M++]=t[l];for(;l<_;)l<_-l?(e.copyWithin(r+l,r,r+l),l*=2):(e.copyWithin(r+l,r,r+_-l),l=_);return i.target}class n3 extends MA{constructor(t,r){super(t,r);pe(this,"device");pe(this,"handle");pe(this,"buffer",null);pe(this,"bufferValue",null);this.device=t,this.handle=this.device.gl.createVertexArray()}get[Symbol.toStringTag](){return"VertexArray"}static isConstantAttributeZeroSupported(t){return h6()==="Chrome"}destroy(){var t;super.destroy(),this.buffer&&((t=this.buffer)==null||t.destroy()),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(t){const r=t;if(r&&r.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,r?r.handle:null),this.indexBuffer=r,this.device.gl.bindVertexArray(null)}setBuffer(t,r){const o=r;if(o.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:p,type:_,stride:l,offset:M,normalized:D,integer:B,divisor:j}=this._getAccessor(t);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,o.handle),B?this.device.gl.vertexAttribIPointer(t,p,_,l,M):this.device.gl.vertexAttribPointer(t,p,_,D,l,M),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(t),this.device.gl.vertexAttribDivisor(t,j||0),this.attributes[t]=o,this.device.gl.bindVertexArray(null)}setConstantWebGL(t,r){this._enable(t,!1),this.attributes[t]=r}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let t=0;t<this.maxVertexAttributes;++t){const r=this.attributes[t];ArrayBuffer.isView(r)&&this.device.setConstantAttributeWebGL(t,r)}}_getAccessor(t){const r=this.attributeInfos[t];if(!r)throw new Error(`Unknown attribute location ${t}`);const o=aR(r.bufferDataType);return{size:r.bufferComponents,type:o,stride:r.byteStride,offset:r.byteOffset,normalized:r.normalized,integer:r.integer,divisor:r.stepMode==="instance"?1:0}}_enable(t,r=!0){const p=n3.isConstantAttributeZeroSupported(this.device)||t!==0;(r||p)&&(t=Number(t),this.device.gl.bindVertexArray(this.handle),r?this.device.gl.enableVertexAttribArray(t):this.device.gl.disableVertexAttribArray(t),this.device.gl.bindVertexArray(null))}getConstantBuffer(t,r){const o=FG(r),p=o.byteLength*t,_=o.length*t;if(this.buffer&&p!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${p} !== ${this.buffer.byteLength}.`);let l=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:p}),l||(l=!NG(o,this.bufferValue)),l){const M=Oz(r.constructor,_);OG({target:M,source:o,start:0,count:_}),this.buffer.write(M),this.bufferValue=r}return this.buffer}}function FG(i){return Array.isArray(i)?new Float32Array(i):i}function NG(i,e){if(!i||!e||i.length!==e.length||i.constructor!==e.constructor)return!1;for(let t=0;t<i.length;++t)if(i[t]!==e[t])return!1;return!0}class BG extends RA{constructor(t,r){super(t,r);pe(this,"device");pe(this,"gl");pe(this,"handle");pe(this,"layout");pe(this,"buffers",{});pe(this,"unusedBuffers",{});pe(this,"bindOnUse",!0);pe(this,"_bound",!1);this.device=t,this.gl=t.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,r.buffers&&this.setBuffers(r.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(t="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(TG(t))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(t){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const r in t)this.setBuffer(r,t[r])})}setBuffer(t,r){const o=this._getVaryingIndex(t),{buffer:p,byteLength:_,byteOffset:l}=this._getBufferRange(r);if(o<0){this.unusedBuffers[t]=p,ni.warn(`${this.id} unusedBuffers varying buffer ${t}`)();return}this.buffers[o]={buffer:p,byteLength:_,byteOffset:l},this.bindOnUse||this._bindBuffer(o,p,l,_)}getBuffer(t){if(xS(t))return this.buffers[t]||null;const r=this._getVaryingIndex(t);return r>=0?this.buffers[r]:null}bind(t=this.handle){if(typeof t!="function")return this.gl.bindTransformFeedback(36386,t),this;let r;return this._bound?r=t():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,r=t(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),r}unbind(){this.bind(null)}_getBufferRange(t){if(t instanceof r1)return{buffer:t,byteOffset:0,byteLength:t.byteLength};const{buffer:r,byteOffset:o=0,byteLength:p=t.buffer.byteLength}=t;return{buffer:r,byteOffset:o,byteLength:p}}_getVaryingIndex(t){if(xS(t))return Number(t);for(const r of this.layout.varyings||[])if(t===r.name)return r.location;return-1}_bindBuffers(){for(const t in this.buffers){const{buffer:r,byteLength:o,byteOffset:p}=this._getBufferRange(this.buffers[t]);this._bindBuffer(Number(t),r,p,o)}}_unbindBuffers(){for(const t in this.buffers)this.gl.bindBufferBase(35982,Number(t),null)}_bindBuffer(t,r,o=0,p){const _=r&&r.handle;!_||p===void 0?this.gl.bindBufferBase(35982,t,_):this.gl.bindBufferRange(35982,t,_,o,p)}}function xS(i){return typeof i=="number"?Number.isInteger(i):/^\d+$/.test(i)}class zG extends CA{constructor(t,r){super(t,r);pe(this,"device");pe(this,"handle");pe(this,"target",null);pe(this,"_queryPending",!1);pe(this,"_pollingPromise",null);if(this.device=t,r.count>1)throw new Error("WebGL QuerySet can only have one value");const o=this.device.gl.createQuery();if(!o)throw new Error("WebGL query not supported");this.handle=o,Object.seal(this)}get[Symbol.toStringTag](){return"Query"}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(t){return this._begin(t!=null&&t.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(t){this._queryPending||(this.target=t,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const t=this.device.gl.getQueryParameter(this.handle,34919);return t&&(this._queryPending=!1),t}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(t=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let r=0;return this._pollingPromise=new Promise((o,p)=>{const _=()=>{this.isResultAvailable()?(o(this.getResult()),this._pollingPromise=null):r++>t?(p("Timed out"),this._pollingPromise=null):requestAnimationFrame(_)};requestAnimationFrame(_)}),this._pollingPromise}}function hR(i){switch(i){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}function LG(i){switch(i){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}function UG(i){return VG[i]}const VG={5124:"sint32",5125:"uint32",5122:"sint16",5123:"uint16",5120:"sint8",5121:"uint8",5126:"float32",5131:"float16",33635:"uint16",32819:"uint16",32820:"uint16",33640:"uint32",35899:"uint32",35902:"uint32",34042:"uint32",36269:"uint32"};function jG(i,e){var $e;const{sourceX:t=0,sourceY:r=0,sourceAttachment:o=0}=e||{};let{target:p=null,sourceWidth:_,sourceHeight:l,sourceDepth:M,sourceFormat:D,sourceType:B}=e||{};const{framebuffer:j,deleteFramebuffer:$}=fR(i),{gl:se,handle:de}=j;_||(_=j.width),l||(l=j.height);const Ae=($e=j.colorAttachments[o])==null?void 0:$e.texture;if(!Ae)throw new Error(`Invalid framebuffer attachment ${o}`);M=(Ae==null?void 0:Ae.depth)||1,D||(D=(Ae==null?void 0:Ae.glFormat)||6408),B||(B=(Ae==null?void 0:Ae.glType)||5121),p=ZG(p,B,D,_,l);const he=Sw(p);B=B||hG(he);const Le=se.bindFramebuffer(36160,de);return se.readBuffer(36064+o),se.readPixels(t,r,_,l,D,B,p),se.readBuffer(36064),se.bindFramebuffer(36160,Le||null),$&&j.destroy(),p}function GG(i,e){const{target:t,sourceX:r=0,sourceY:o=0,sourceFormat:p=6408,targetByteOffset:_=0}=e||{};let{sourceWidth:l,sourceHeight:M,sourceType:D}=e||{};const{framebuffer:B,deleteFramebuffer:j}=fR(i);l=l||B.width,M=M||B.height;const $=B;D=D||5121;let se=t;if(!se){const Ae=hR(p),he=LG(D),Le=_+l*M*Ae*he;se=$.device.createBuffer({byteLength:Le})}const de=i.device.createCommandEncoder();return de.copyTextureToBuffer({sourceTexture:i,width:l,height:M,origin:[r,o],destinationBuffer:se,byteOffset:_}),de.destroy(),j&&B.destroy(),se}function fR(i){return i instanceof tx?{framebuffer:i,deleteFramebuffer:!1}:{framebuffer:WG(i),deleteFramebuffer:!0}}function WG(i,e){const{device:t,width:r,height:o,id:p}=i;return t.createFramebuffer({...e,id:`framebuffer-for-${p}`,width:r,height:o,colorAttachments:[i]})}function ZG(i,e,t,r,o,p){if(i)return i;e||(e=5121);const _=UG(e),l=Ew(_),M=hR(t);return new l(r*o*M)}class QA extends T_{constructor(t){var j,$;super({...t,id:t.id||Jj("webgl-device")});pe(this,"type","webgl");pe(this,"handle");pe(this,"features");pe(this,"limits");pe(this,"info");pe(this,"canvasContext");pe(this,"preferredColorFormat","rgba8unorm");pe(this,"preferredDepthFormat","depth24plus");pe(this,"commandEncoder");pe(this,"lost");pe(this,"_resolveContextLost");pe(this,"gl");pe(this,"_constants");pe(this,"_extensions",{});pe(this,"_polyfilled",!1);pe(this,"spectorJS");const r=T_._getCanvasContextProps(t);if(!r)throw new Error("WebGLDevice requires props.createCanvasContext to be set");let o=($=(j=r.canvas)==null?void 0:j.gl)==null?void 0:$.device;if(o)throw new Error(`WebGL context already attached to device ${o.id}`);this.canvasContext=new Yj(this,r),this.lost=new Promise(se=>{this._resolveContextLost=se});const p={...t.webgl};r.alphaMode==="premultiplied"&&(p.premultipliedAlpha=!0),t.powerPreference!==void 0&&(p.powerPreference=t.powerPreference);const l=this.props._handle||Pj(this.canvasContext.canvas,{onContextLost:se=>{var de;return(de=this._resolveContextLost)==null?void 0:de.call(this,{reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."})},onContextRestored:se=>console.log("WebGL context restored")},p);if(!l)throw new Error("WebGL context creation failed");if(o=l.device,o){if(t._reuseDevices)return ni.log(1,`Not creating a new Device, instead returning a reference to Device ${o.id} already attached to WebGL context`,o)(),o._reused=!0,o;throw new Error(`WebGL context already attached to device ${o.id}`)}this.handle=l,this.gl=l,this.spectorJS=fj({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=Ij(this.gl,this._extensions),this.limits=new Hj(this.gl),this.features=new Xj(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),new x_(this.gl,{log:(...se)=>ni.log(1,...se)()}).trackState(this.gl,{copyState:!1});const D=t.debugWebGL||t.debug,B=t.debugWebGL;D&&(this.gl=gj(this.gl,{debugWebGL:D,traceWebGL:B}),ni.warn("WebGL debug mode activated. Performance reduced.")(),t.debugWebGL&&(ni.level=Math.max(ni.level,1))),this.commandEncoder=new vS(this,{id:`${this}-command-encoder`})}get[Symbol.toStringTag](){return"WebGLDevice"}toString(){return`${this[Symbol.toStringTag]}(${this.id})`}isVertexFormatSupported(t){switch(t){case"unorm8x4-bgra":return!1;default:return!0}}destroy(){!this.props._reuseDevices&&!this._reused&&delete this.gl.device}get isLost(){return this.gl.isContextLost()}getTextureByteAlignment(){return 4}createCanvasContext(t){throw new Error("WebGL only supports a single canvas")}createBuffer(t){const r=this._normalizeBufferProps(t);return new r1(this,r)}createTexture(t){return new s1(this,t)}createExternalTexture(t){throw new Error("createExternalTexture() not implemented")}createSampler(t){return new lG(this,t)}createShader(t){return new tG(this,t)}createFramebuffer(t){return new n1(this,t)}createVertexArray(t){return new n3(this,t)}createTransformFeedback(t){return new BG(this,t)}createQuerySet(t){return new zG(this,t)}createRenderPipeline(t){return new SG(this,t)}createComputePipeline(t){throw new Error("ComputePipeline not supported in WebGL")}createCommandEncoder(t={}){return new vS(this,t)}submit(t){t||(t=this.commandEncoder.finish(),this.commandEncoder.destroy(),this.commandEncoder=this.createCommandEncoder({id:`${this.id}-default-encoder`})),t._executeCommands()}readPixelsToArrayWebGL(t,r){return jG(t,r)}readPixelsToBufferWebGL(t,r){return GG(t,r)}setParametersWebGL(t){a2(this.gl,t)}getParametersWebGL(t){return rR(this.gl,t)}withParametersWebGL(t,r){return b1(this.gl,t,r)}resetWebGL(){ni.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),Sj(this.gl)}_getDeviceSpecificTextureFormatCapabilities(t){return jj(this.gl,t,this._extensions)}loseDevice(){var p;let t=!1;const o=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return o&&(t=!0,o.loseContext()),(p=this._resolveContextLost)==null||p.call(this,{reason:"destroyed",message:"Application triggered context loss"}),t}pushState(){x_.get(this.gl).push()}popState(){x_.get(this.gl).pop()}getGLKey(t,r){const o=Number(t);for(const p in this.gl)if(this.gl[p]===o)return`GL.${p}`;return r!=null&&r.emptyIfUnknown?"":String(t)}getGLKeys(t){const r={emptyIfUnknown:!0};return Object.entries(t).reduce((o,[p,_])=>(o[`${p}:${this.getGLKey(p,r)}`]=`${_}:${this.getGLKey(_,r)}`,o),{})}setConstantAttributeWebGL(t,r){const o=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(o).fill(null);const p=this._constants[t];switch(p&&qG(p,r)&&ni.info(1,`setConstantAttributeWebGL(${t}) could have been skipped, value unchanged`)(),this._constants[t]=r,r.constructor){case Float32Array:XG(this,t,r);break;case Int32Array:HG(this,t,r);break;case Uint32Array:$G(this,t,r);break;default:throw new Error("constant")}}getExtension(t){return i2(this.gl,t,this._extensions),this._extensions}_setWebGLDebugMetadata(t,r,o){t.luma=r;const p={props:o.spector,id:o.spector.id};t.__SPECTOR_Metadata=p}}function XG(i,e,t){switch(t.length){case 1:i.gl.vertexAttrib1fv(e,t);break;case 2:i.gl.vertexAttrib2fv(e,t);break;case 3:i.gl.vertexAttrib3fv(e,t);break;case 4:i.gl.vertexAttrib4fv(e,t);break}}function HG(i,e,t){i.gl.vertexAttribI4iv(e,t)}function $G(i,e,t){i.gl.vertexAttribI4uiv(e,t)}function qG(i,e){if(!i||!e||i.length!==e.length||i.constructor!==e.constructor)return!1;for(let t=0;t<i.length;++t)if(i[t]!==e[t])return!1;return!0}const bS=Object.freeze(Object.defineProperty({__proto__:null,WebGLDevice:QA},Symbol.toStringTag,{value:"Module"}));function Lg(){}const YG=({isDragging:i})=>i?"grabbing":"grab",dR={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:Lg,onWebGLInitialized:Lg,onResize:Lg,onViewStateChange:Lg,onInteractionStateChange:Lg,onBeforeRender:Lg,onAfterRender:Lg,onLoad:Lg,onError:i=>Wr.error(i.message,i.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:YG,getTooltip:null,debug:!1,drawPickingColors:!1};class A1{constructor(e){var r;this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new kx({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=o=>{const{_pickRequest:p}=this;if(o.type==="pointerleave")p.x=-1,p.y=-1,p.radius=0;else{if(o.leftButton||o.rightButton)return;{const _=o.offsetCenter;if(!_)return;p.x=_.x,p.y=_.y,p.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:p.x,y:p.y}),p.event=o},this._onEvent=o=>{const p=LA[o.type],_=o.offsetCenter;if(!p||!_||!this.layerManager)return;const l=this.layerManager.getLayers(),M=this.deckPicker.getLastPickedObject({x:_.x,y:_.y,layers:l,viewports:this.getViewports(_)},this._lastPointerDownInfo),{layer:D}=M,B=D&&(D[p]||D.props[p]),j=this.props[p];let $=!1;B&&($=B.call(D,M,o)),$||(j==null||j(M,o),this.widgetManager.onEvent(M,o))},this._onPointerDown=o=>{var l;if(((l=this.device)==null?void 0:l.type)==="webgpu")return;const p=o.offsetCenter,_=this._pick("pickObject","pickObject Time",{x:p.x,y:p.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=_.result[0]||_.emptyInfo},this.props={...dR,...e},e=this.props,e.viewState&&e.initialViewState&&Wr.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device&&(this.device=e.device);let t=this.device;if(!t&&e.gl){e.gl instanceof WebGLRenderingContext&&Wr.error("WebGL1 context not supported.")();const o=(r=this.props.deviceProps)==null?void 0:r.onResize;t=Yb.attach(e.gl,{...this.props.deviceProps,onResize:(p,_)=>{const{width:l,height:M}=p.canvas;p.drawingBufferWidth=l,p.drawingBufferHeight=M,this._needsRedraw="Canvas resized",o==null||o(p,_)}})}t||(t=this._createDevice(e)),this.animationLoop=this._createAnimationLoop(t,e),this.setProps(e),e._typedArrayManagerProps&&v1.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,t,r,o,p,_,l,M,D,B;(e=this.animationLoop)==null||e.stop(),(t=this.animationLoop)==null||t.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,(r=this.layerManager)==null||r.finalize(),this.layerManager=null,(o=this.viewManager)==null||o.finalize(),this.viewManager=null,(p=this.effectManager)==null||p.finalize(),this.effectManager=null,(_=this.deckRenderer)==null||_.finalize(),this.deckRenderer=null,(l=this.deckPicker)==null||l.finalize(),this.deckPicker=null,(M=this.eventManager)==null||M.destroy(),this.eventManager=null,(D=this.widgetManager)==null||D.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&((B=this.canvas.parentElement)==null||B.removeChild(this.canvas),this.canvas=null)}setProps(e){var r,o,p,_,l,M,D;this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&Wr.removed("onLayerHover","onHover")(),"onLayerClick"in e&&Wr.removed("onLayerClick","onClick")(),e.initialViewState&&!cu(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const t=Object.create(this.props);Object.assign(t,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),e.device&&e.device.id!==((r=this.device)==null?void 0:r.id)&&((o=this.animationLoop)==null||o.stop(),this.canvas!==((p=e.device.canvasContext)==null?void 0:p.canvas)&&((_=this.canvas)==null||_.remove(),(l=this.eventManager)==null||l.destroy(),this.canvas=null),Wr.log(`recreating animation loop for new device! id=${e.device.id}`)(),this.animationLoop=this._createAnimationLoop(e.device,e),this.animationLoop.start()),(M=this.animationLoop)==null||M.setProps(t),e.useDevicePixels!==void 0&&((D=this.device)!=null&&D.canvasContext)&&this.device.canvasContext.setProps({useDevicePixels:e.useDevicePixels}),this.layerManager&&(this.viewManager.setProps(t),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(t),this.effectManager.setProps(t),this.deckRenderer.setProps(t),this.deckPicker.setProps(t),this.widgetManager.setProps(t)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const r=this.viewManager.needsRedraw(e),o=this.layerManager.needsRedraw(e),p=this.effectManager.needsRedraw(e),_=this.deckRenderer.needsRedraw(e);return t=t||r||o||p||_,t}redraw(e){if(!this.layerManager)return;let t=this.needsRedraw({clearRedrawFlags:!0});t=e||t,t&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(t):this._drawLayers(t))}get isInitialized(){return this.viewManager!==null}getViews(){return no(this.viewManager),this.viewManager.views}getViewports(e){return no(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const t=this._pick("pickObject","pickObject Time",e).result;return t.length?t[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,t=!1){for(const r in e)this.layerManager.resourceManager.add({resourceId:r,data:e[r],forceUpdate:t})}_removeResources(e){for(const t of e)this.layerManager.resourceManager.remove(t)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){var t;(t=this.layerManager)==null||t.removeDefaultShaderModule(e)}_pick(e,t,r){no(this.deckPicker);const{stats:o}=this;o.get("Pick Count").incrementCount(),o.get(t).timeStart();const p=this.deckPicker[e]({layers:this.layerManager.getLayers(r),views:this.viewManager.getViews(),viewports:this.getViewports(r),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...r});return o.get(t).timeEnd(),p}_createCanvas(e){let t=e.canvas;return typeof t=="string"&&(t=document.getElementById(t),no(t)),t||(t=document.createElement("canvas"),t.id=e.id||"deckgl-overlay",e.width&&typeof e.width=="number"&&(t.width=e.width),e.height&&typeof e.height=="number"&&(t.height=e.height),(e.parent||document.body).appendChild(t)),Object.assign(t.style,e.style),t}_setCanvasSize(e){var o;if(!this.canvas)return;const{width:t,height:r}=e;if(t||t===0){const p=Number.isFinite(t)?`${t}px`:t;this.canvas.style.width=p}if(r||r===0){const p=Number.isFinite(r)?`${r}px`:r;this.canvas.style.position=((o=e.style)==null?void 0:o.position)||"absolute",this.canvas.style.height=p}}_updateCanvasSize(){var o,p;const{canvas:e}=this;if(!e)return;const t=e.clientWidth??e.width,r=e.clientHeight??e.height;(t!==this.width||r!==this.height)&&(this.width=t,this.height=r,(o=this.viewManager)==null||o.setProps({width:t,height:r}),(p=this.layerManager)==null||p.activateViewport(this.getViewports()[0]),this.props.onResize({width:t,height:r}))}_createAnimationLoop(e,t){const{gl:r,onError:o}=t;return new GA({device:e,autoResizeDrawingBuffer:!r,autoResizeViewport:!1,onInitialize:p=>this._setDevice(p.device),onRender:this._onRenderFrame.bind(this),onError:o})}_createDevice(e){var l,M,D;const t=(l=this.props.deviceProps)==null?void 0:l.createCanvasContext,r=typeof t=="object"?t:void 0,o={adapters:[],_cacheShaders:!0,_cachePipelines:!0,...e.deviceProps};o.adapters.includes(Yb)||o.adapters.push(Yb);const p={alphaMode:((M=this.props.deviceProps)==null?void 0:M.type)==="webgpu"?"premultiplied":void 0},_=(D=this.props.deviceProps)==null?void 0:D.onResize;return wA.createDevice({_reuseDevices:!0,type:"webgl",...o,createCanvasContext:{...p,...r,canvas:this._createCanvas(e),useDevicePixels:this.props.useDevicePixels,autoResize:!0},onResize:(B,j)=>{this._needsRedraw="Canvas resized",_==null||_(B,j)}})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,t=Array.isArray(e)?e:e?[e]:[new Yw({id:"default-view"})];return t.length&&this.props.controller&&(t[0].props.controller=this.props.controller),t}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){var t,r,o,p;if(((t=this.device)==null?void 0:t.type)==="webgpu")return;const{_pickRequest:e}=this;if(e.event){const{result:_,emptyInfo:l}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=_.length>0;let M=l,D=!1;for(const B of _)M=B,D=((r=B.layer)==null?void 0:r.onHover(B,e.event))||D;D||((p=(o=this.props).onHover)==null||p.call(o,M,e.event),this.widgetManager.onHover(M,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){var o,p;if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=(o=this.device.canvasContext)==null?void 0:o.canvas,!this.canvas.isConnected&&this.props.parent&&this.props.parent.insertBefore(this.canvas,this.props.parent.firstChild)),this.device.type==="webgl"&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device.type==="webgl"&&this.props.onWebGLInitialized(this.device.gl);const t=new $M;t.play(),this.animationLoop.attachTimeline(t),this.eventManager=new P9(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(O4).map(_=>{var se;const[l,M,D,B]=O4[_],j=(se=this.props.eventRecognizerOptions)==null?void 0:se[_],$={...M,...j,event:_};return{recognizer:new l($),recognizeWith:D,requestFailure:B}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const _ in LA)this.eventManager.on(_,this._onEvent);this.viewManager=new C7({timeline:t,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const r=this.viewManager.getViewports()[0];this.layerManager=new R7(this.device,{deck:this,stats:this.stats,viewport:r,timeline:t}),this.effectManager=new W7({deck:this,device:this.device}),this.deckRenderer=new H7(this.device),this.deckPicker=new Y7(this.device),this.widgetManager=new K7({deck:this,parentElement:(p=this.canvas)==null?void 0:p.parentElement}),this.widgetManager.addDefault(new tR),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,t){var _;const{device:r,gl:o}=this.layerManager.context;this.props.onBeforeRender({device:r,gl:o});const p={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...t};(_=this.deckRenderer)==null||_.renderLayers(p),p.pass==="screen"&&this.widgetManager.onRedraw({viewports:p.viewports,layers:p.layers}),this.props.onAfterRender({device:r,gl:o})}_onRenderFrame(){var e;this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),Wr.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),((e=this.device)==null?void 0:e.type)!=="webgpu"&&this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const t=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:t},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const t=this.animationLoop.stats;e.get("GPU Time").addTime(t.get("GPU Time").lastTiming),e.get("CPU Time").addTime(t.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:t}=this;e.fps=t.get("frameRate").getHz(),e.setPropsTime=t.get("setProps Time").time,e.updateAttributesTime=t.get("Update Attributes").time,e.framesRedrawn=t.get("Redraw Count").count,e.pickTime=t.get("pickObject Time").time+t.get("pickMultipleObjects Time").time+t.get("pickObjects Time").time,e.pickCount=t.get("Pick Count").count,e.gpuTime=t.get("GPU Time").time,e.cpuTime=t.get("CPU Time").time,e.gpuTimePerFrame=t.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=t.get("CPU Time").getAverageTime();const r=wA.stats.get("Memory Usage");e.bufferMemory=r.get("Buffer Memory").count,e.textureMemory=r.get("Texture Memory").count,e.renderbufferMemory=r.get("Renderbuffer Memory").count,e.gpuMemory=r.get("GPU Memory").count}}A1.defaultProps=dR;A1.VERSION=cB;function JG(i){switch(i){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return Ew(i)}}const QG=Sw;function yv(i,e,t){const r=t==="webgpu"&&e.type==="uint8"?"unorm8":e.type;return{attribute:i,format:e.size>1?`${r}x${e.size}`:e.type,byteOffset:e.offset||0}}function g_(i){return i.stride||i.size*i.bytesPerElement}function KG(i,e){return i.type===e.type&&i.size===e.size&&g_(i)===g_(e)&&(i.offset||0)===(e.offset||0)}function KA(i,e){e.offset&&Wr.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const t=g_(i),r=e.vertexOffset!==void 0?e.vertexOffset:i.vertexOffset||0,o=e.elementOffset||0,p=r*t+o*i.bytesPerElement+(i.offset||0);return{...e,offset:p,stride:t}}function eW(i,e){const t=KA(i,e);return{high:t,low:{...t,offset:t.offset+i.size*4}}}class tW{constructor(e,t,r){this._buffer=null,this.device=e,this.id=t.id||"",this.size=t.size||1;const o=t.logicalType||t.type,p=o==="float64";let{defaultValue:_}=t;_=Number.isFinite(_)?[_]:_||new Array(this.size).fill(0);let l;p?l="float32":!o&&t.isIndexed?l="uint32":l=o||"float32";let M=JG(o||l);this.doublePrecision=p,p&&t.fp64===!1&&(M=Float32Array),this.value=null,this.settings={...t,defaultType:M,defaultValue:_,logicalType:o,type:l,normalized:l.includes("norm"),size:this.size,bytesPerElement:M.BYTES_PER_ELEMENT},this.state={...r,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*g_(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),v1.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,t=null){const r={};if(this.state.constant){const o=this.value;if(t){const p=KA(this.getAccessor(),t),_=p.offset/o.BYTES_PER_ELEMENT,l=p.size||this.size;r[e]=o.subarray(_,_+l)}else r[e]=o}else r[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?r[`${e}64Low`]=r[e]:r[`${e}64Low`]=new Float32Array(this.size)),r}_getBufferLayout(e=this.id,t=null){const r=this.getAccessor(),o=[],p={name:this.id,byteStride:g_(r),attributes:o};if(this.doublePrecision){const _=eW(r,t||{});o.push(yv(e,{...r,..._.high},this.device.type),yv(`${e}64Low`,{...r,..._.low},this.device.type))}else if(t){const _=KA(r,t);o.push(yv(e,{...r,..._},this.device.type))}else o.push(yv(e,r,this.device.type));return p}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const t=Array.from(this.value);e=[t,t]}else{const{value:t,numInstances:r,size:o}=this,p=r*o;if(t&&p&&t.length>=p){const _=new Array(o).fill(1/0),l=new Array(o).fill(-1/0);for(let M=0;M<p;)for(let D=0;D<o;D++){const B=t[M++];B<_[D]&&(_[D]=B),B>l[D]&&(l[D]=B)}e=[_,l]}}return this.state.bounds=e,e}setData(e){const{state:t}=this;let r;ArrayBuffer.isView(e)?r={value:e}:e instanceof xa?r={buffer:e}:r=e;const o={...this.settings,...r};if(ArrayBuffer.isView(r.value)){if(!r.type)if(this.doublePrecision&&r.value instanceof Float64Array)o.type="float32";else{const _=QG(r.value);o.type=o.normalized?_.replace("int","norm"):_}o.bytesPerElement=r.value.BYTES_PER_ELEMENT,o.stride=g_(o)}if(t.bounds=null,r.constant){let p=r.value;if(p=this._normalizeValue(p,[],0),this.settings.normalized&&(p=this.normalizeConstant(p)),!(!t.constant||!this._areValuesEqual(p,this.value)))return!1;t.externalBuffer=null,t.constant=!0,this.value=ArrayBuffer.isView(p)?p:new Float32Array(p)}else if(r.buffer){const p=r.buffer;t.externalBuffer=p,t.constant=!1,this.value=r.value||null}else if(r.value){this._checkExternalBuffer(r);let p=r.value;t.externalBuffer=null,t.constant=!1,this.value=p;let{buffer:_}=this;const l=g_(o),M=(o.vertexOffset||0)*l;if(this.doublePrecision&&p instanceof Float64Array&&(p=Wb(p,o)),this.settings.isIndexed){const B=this.settings.defaultType;p.constructor!==B&&(p=new B(p))}const D=p.byteLength+M+l*2;(!_||_.byteLength<D)&&(_=this._createBuffer(D)),_.write(p,M)}return this.setAccessor(o),!0}updateSubBuffer(e={}){this.state.bounds=null;const t=this.value,{startOffset:r=0,endOffset:o}=e;this.buffer.write(this.doublePrecision&&t instanceof Float64Array?Wb(t,{size:this.size,startIndex:r,endIndex:o}):t.subarray(r,o),r*t.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,t=!1){const{state:r}=this,o=r.allocatedValue,p=v1.allocate(o,e+1,{size:this.size,type:this.settings.defaultType,copy:t});this.value=p;const{byteOffset:_}=this;let{buffer:l}=this;return(!l||l.byteLength<p.byteLength+_)&&(l=this._createBuffer(p.byteLength+_),t&&o&&l.write(o instanceof Float64Array?Wb(o,this):o,_)),r.allocatedValue=p,r.constant=!1,r.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:t}=e;if(!ArrayBuffer.isView(t))throw new Error(`Attribute ${this.id} value is not TypedArray`);const r=this.settings.defaultType;let o=!1;if(this.doublePrecision&&(o=t.BYTES_PER_ELEMENT<4),o)throw new Error(`Attribute ${this.id} does not support ${t.constructor.name}`);!(t instanceof r)&&this.settings.normalized&&!("normalized"in e)&&Wr.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(t=>(t+128)/255*2-1);case"snorm16":return new Float32Array(e).map(t=>(t+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(t=>t/255);case"unorm16":return new Float32Array(e).map(t=>t/65535);default:return e}}_normalizeValue(e,t,r){const{defaultValue:o,size:p}=this.settings;if(Number.isFinite(e))return t[r]=e,t;if(!e){let _=p;for(;--_>=0;)t[r+_]=o[_];return t}switch(p){case 4:t[r+3]=Number.isFinite(e[3])?e[3]:o[3];case 3:t[r+2]=Number.isFinite(e[2])?e[2]:o[2];case 2:t[r+1]=Number.isFinite(e[1])?e[1]:o[1];case 1:t[r+0]=Number.isFinite(e[0])?e[0]:o[0];break;default:let _=p;for(;--_>=0;)t[r+_]=Number.isFinite(e[_])?e[_]:o[_]}return t}_areValuesEqual(e,t){if(!e||!t)return!1;const{size:r}=this;for(let o=0;o<r;o++)if(e[o]!==t[o])return!1;return!0}_createBuffer(e){var o;this._buffer&&this._buffer.destroy();const{isIndexed:t,type:r}=this.settings;return this._buffer=this.device.createBuffer({...(o=this._buffer)==null?void 0:o.props,id:this.id,usage:(t?xa.INDEX:xa.VERTEX)|xa.COPY_DST,indexType:t?r:void 0,byteLength:e}),this._buffer}}const AS=[],wS=[];function iW(i,e=0,t=1/0){let r=AS;const o={index:-1,data:i,target:[]};return i?typeof i[Symbol.iterator]=="function"?r=i:i.length>0&&(wS.length=i.length,r=wS):r=AS,(e>0||Number.isFinite(t))&&(r=(Array.isArray(r)?r:Array.from(r)).slice(e,t),o.index=e-1),{iterable:r,objectInfo:o}}function pR(i){return i&&i[Symbol.asyncIterator]}function nW(i,e){const{size:t,stride:r,offset:o,startIndices:p,nested:_}=e,l=i.BYTES_PER_ELEMENT,M=r?r/l:t,D=o?o/l:0,B=Math.floor((i.length-D)/M);return(j,{index:$,target:se})=>{if(!p){const Le=$*M+D;for(let $e=0;$e<t;$e++)se[$e]=i[Le+$e];return se}const de=p[$],Ae=p[$+1]||B;let he;if(_){he=new Array(Ae-de);for(let Le=de;Le<Ae;Le++){const $e=Le*M+D;se=new Array(t);for(let Be=0;Be<t;Be++)se[Be]=i[$e+Be];he[Le-de]=se}}else if(M===t)he=i.subarray(de*t+D,Ae*t+D);else{he=new i.constructor((Ae-de)*t);let Le=0;for(let $e=de;$e<Ae;$e++){const Be=$e*M+D;for(let Je=0;Je<t;Je++)he[Le++]=i[Be+Je]}}return he}}const rW=[],Ov=[[0,1/0]];function sW(i,e){if(i===Ov||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return i;const t=[],r=i.length;let o=0;for(let p=0;p<r;p++){const _=i[p];_[1]<e[0]?(t.push(_),o=p+1):_[0]>e[1]?t.push(_):e=[Math.min(_[0],e[0]),Math.max(_[1],e[1])]}return t.splice(o,0,e),t}const aW={interpolation:{duration:0,easing:i=>i},spring:{stiffness:.05,damping:.5}};function gR(i,e){if(!i)return null;Number.isFinite(i)&&(i={type:"interpolation",duration:i});const t=i.type||"interpolation";return{...aW[t],...e,...i,type:t}}class mR extends tW{constructor(e,t){super(e,t,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:Ov}),this.constant=!1,this.settings.update=t.update||(t.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const t=this.state.needsRedraw;return this.state.needsRedraw=t&&!e,t}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var t;(t=this.state).layoutChanged||(t.layoutChanged=!KG(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:t}=this.settings,r=this.settings.transition,o=Array.isArray(t)?e[t.find(p=>e[p])]:e[t];return gR(o,r)}setNeedsUpdate(e=this.id,t){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),t){const{startRow:r=0,endRow:o=1/0}=t;this.state.updateRanges=sW(this.state.updateRanges,[r,o])}else this.state.updateRanges=Ov}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=rW}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:t,settings:r}=this;return r.noAlloc?!1:r.update?(super.allocate(e,t.updateRanges!==Ov),!0):!1}updateBuffer({numInstances:e,data:t,props:r,context:o}){if(!this.needsUpdate())return!1;const{state:{updateRanges:p},settings:{update:_,noAlloc:l}}=this;let M=!0;if(_){for(const[D,B]of p)_.call(o,this,{data:t,startRow:D,endRow:B,props:r,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[D,B]of p){const j=Number.isFinite(D)?this.getVertexOffset(D):0,$=Number.isFinite(B)?this.getVertexOffset(B):l||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:j,endOffset:$})}this._checkAttributeArray()}else M=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),M}setConstantValue(e,t){const r=this.device.type==="webgpu";if(r||t===void 0||typeof t=="function"){if(r&&typeof t!="function"){const _=this._normalizeValue(t,[],0);this._areValuesEqual(_,this.value)||this.setNeedsUpdate("WebGPU constant updated")}return!1}const o=this.settings.transform&&e?this.settings.transform.call(e,t):t;return this.setData({constant:!0,value:o})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0}setExternalBuffer(e){const{state:t}=this;return e?(this.clearNeedsUpdate(),t.lastExternalBuffer===e||(t.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(t.lastExternalBuffer=null,!1)}setBinaryValue(e,t=null){const{state:r,settings:o}=this;if(!e)return r.binaryValue=null,r.binaryAccessor=null,!1;if(o.noAlloc)return!1;if(r.binaryValue===e)return this.clearNeedsUpdate(),!0;if(r.binaryValue=e,this.setNeedsRedraw(),o.transform||t!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const _=e;no(ArrayBuffer.isView(_.value),`invalid ${o.accessor}`);const l=!!_.size&&_.size!==this.size;return r.binaryAccessor=nW(_.value,{size:_.size||this.size,stride:_.stride,offset:_.offset,startIndices:t,nested:l}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:t}=this;return(t?e<t.length?t[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,t=super.getValue();if(!e)return t;for(const r in e)Object.assign(t,super.getValue(r,e[r]));return t}getBufferLayout(e){this.state.layoutChanged=!1;const t=this.settings.shaderAttributes,r=super._getBufferLayout(),{stepMode:o}=this.settings;if(o==="dynamic"?r.stepMode=e?e.isInstanced?"instance":"vertex":"instance":r.stepMode=o??"vertex",!t)return r;for(const p in t){const _=super._getBufferLayout(p,t[p]);r.attributes.push(..._.attributes)}return r}_autoUpdater(e,{data:t,startRow:r,endRow:o,props:p,numInstances:_}){if(e.constant&&this.context.device.type!=="webgpu")return;const{settings:l,state:M,value:D,size:B,startIndices:j}=e,{accessor:$,transform:se}=l;let de=M.binaryAccessor||(typeof $=="function"?$:p[$]);typeof de!="function"&&typeof $=="string"&&(de=()=>p[$]),no(typeof de=="function",`accessor "${$}" is not a function`);let Ae=e.getVertexOffset(r);const{iterable:he,objectInfo:Le}=iW(t,r,o);for(const $e of he){Le.index++;let Be=de($e,Le);if(se&&(Be=se.call(this,Be)),j){const Je=(Le.index<j.length-1?j[Le.index+1]:_)-j[Le.index];if(Be&&Array.isArray(Be[0])){let Rt=Ae;for(const Et of Be)e._normalizeValue(Et,D,Rt),Rt+=B}else Be&&Be.length>B?D.set(Be,Ae):(e._normalizeValue(Be,Le.target,0),w7({target:D,source:Le.target,start:Ae,count:Je}));Ae+=Je*B}else e._normalizeValue(Be,D,Ae),Ae+=B}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,t=Math.min(4,this.size);if(e&&e.length>=t){let r=!0;switch(t){case 4:r=r&&Number.isFinite(e[3]);case 3:r=r&&Number.isFinite(e[2]);case 2:r=r&&Number.isFinite(e[1]);case 1:r=r&&Number.isFinite(e[0]);break;default:r=!1}if(!r)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function tA(i){const{source:e,target:t,start:r=0,size:o,getData:p}=i,_=i.end||t.length,l=e.length,M=_-r;if(l>M){t.set(e.subarray(0,M),r);return}if(t.set(e,r),!p)return;let D=l;for(;D<M;){const B=p(D,e);for(let j=0;j<o;j++)t[r+D]=B[j]||0,D++}}function oW({source:i,target:e,size:t,getData:r,sourceStartIndices:o,targetStartIndices:p}){if(!o||!p)return tA({source:i,target:e,size:t,getData:r}),e;let _=0,l=0;const M=r&&((B,j)=>r(B+l,j)),D=Math.min(o.length,p.length);for(let B=1;B<D;B++){const j=o[B]*t,$=p[B]*t;tA({source:i.subarray(_,j),target:e,start:l,end:$,size:t,getData:M}),_=j,l=$}return l<e.length&&tA({source:[],target:e,start:l,size:t,getData:M}),e}function lW(i){const{device:e,settings:t,value:r}=i,o=new mR(e,t);return o.setData({value:r instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:t.normalized}),o}function _R(i){switch(i){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${i}"`)}}function yR(i){switch(i){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function vR(i){i.push(i.shift())}function cW(i,e){const{doublePrecision:t,settings:r,value:o,size:p}=i,_=t&&o instanceof Float64Array?2:1;let l=0;const{shaderAttributes:M}=i.settings;if(M)for(const D of Object.values(M))l=Math.max(l,D.vertexOffset??0);return(r.noAlloc?o.length:(e+l)*p)*_}function xR({device:i,source:e,target:t}){return(!t||t.byteLength<e.byteLength)&&(t==null||t.destroy(),t=i.createBuffer({byteLength:e.byteLength,usage:e.usage})),t}function bR({device:i,buffer:e,attribute:t,fromLength:r,toLength:o,fromStartIndices:p,getData:_=l=>l}){const l=t.doublePrecision&&t.value instanceof Float64Array?2:1,M=t.size*l,D=t.byteOffset,B=t.settings.bytesPerElement<4?D/t.settings.bytesPerElement*4:D,j=t.startIndices,$=p&&j,se=t.isConstant;if(!$&&e&&r>=o)return e;const de=t.value instanceof Float64Array?Float32Array:t.value.constructor,Ae=se?t.value:new de(t.getBuffer().readSyncWebGL(D,o*de.BYTES_PER_ELEMENT).buffer);if(t.settings.normalized&&!se){const Be=_;_=(Je,Rt)=>t.normalizeConstant(Be(Je,Rt))}const he=se?(Be,Je)=>_(Ae,Je):(Be,Je)=>_(Ae.subarray(Be+D,Be+D+M),Je),Le=e?new Float32Array(e.readSyncWebGL(B,r*4).buffer):new Float32Array(0),$e=new Float32Array(o);return oW({source:Le,target:$e,sourceStartIndices:p,targetStartIndices:j,size:M,getData:he}),(!e||e.byteLength<$e.byteLength+B)&&(e==null||e.destroy(),e=i.createBuffer({byteLength:$e.byteLength+B,usage:35050})),e.write($e,B),e}class AR{constructor({device:e,attribute:t,timeline:r}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new Bx(r),this.attribute=t,this.attributeInTransition=lW(t),this.currentStartIndices=t.startIndices}get inProgress(){return this.transition.inProgress}start(e,t,r=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=cW(this.attribute,t),this.transition.start({...e,duration:r})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}class uW extends AR{constructor({device:e,attribute:t,timeline:r}){super({device:e,attribute:t,timeline:r}),this.type="interpolation",this.transform=pW(e,t)}start(e,t){const r=this.currentLength,o=this.currentStartIndices;if(super.start(e,t,e.duration),e.duration<=0){this.transition.cancel();return}const{buffers:p,attribute:_}=this;vR(p),p[0]=bR({device:this.device,buffer:p[0],attribute:_,fromLength:r,toLength:this.currentLength,fromStartIndices:o,getData:e.enter}),p[1]=xR({device:this.device,source:p[0],target:p[1]}),this.setBuffer(p[1]);const{transform:l}=this,M=l.model;let D=Math.floor(this.currentLength/_.size);wR(_)&&(D/=2),M.setVertexCount(D),_.isConstant?(M.setAttributes({aFrom:p[0]}),M.setConstantAttributes({aTo:_.value})):M.setAttributes({aFrom:p[0],aTo:_.getBuffer()}),l.transformFeedback.setBuffers({vCurrent:p[1]})}onUpdate(){const{duration:e,easing:t}=this.settings,{time:r}=this.transition;let o=r/e;t&&(o=t(o));const{model:p}=this.transform,_={time:o};p.shaderInputs.setProps({interpolation:_}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const hW=`uniform interpolationUniforms {
  float time;
} interpolation;
`,TS={name:"interpolation",vs:hW,uniformTypes:{time:"f32"}},fW=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, interpolation.time);
  gl_Position = vec4(0.0);
}
`,dW=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function wR(i){return i.doublePrecision&&i.value instanceof Float64Array}function pW(i,e){const t=e.size,r=_R(t),o=yR(t),p=e.getBufferLayout();return wR(e)?new x1(i,{vs:dW,bufferLayout:[{name:"aFrom",byteStride:8*t,attributes:[{attribute:"aFrom",format:o,byteOffset:0},{attribute:"aFrom64Low",format:o,byteOffset:4*t}]},{name:"aTo",byteStride:8*t,attributes:[{attribute:"aTo",format:o,byteOffset:0},{attribute:"aTo64Low",format:o,byteOffset:4*t}]}],modules:[yU,TS],defines:{ATTRIBUTE_TYPE:r,ATTRIBUTE_SIZE:t},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new x1(i,{vs:fW,bufferLayout:[{name:"aFrom",format:o},{name:"aTo",format:p.attributes[0].format}],modules:[TS],defines:{ATTRIBUTE_TYPE:r},varyings:["vCurrent"],disableWarnings:!0})}class gW extends AR{constructor({device:e,attribute:t,timeline:r}){super({device:e,attribute:t,timeline:r}),this.type="spring",this.texture=bW(e),this.framebuffer=AW(e,this.texture),this.transform=xW(e,t)}start(e,t){const r=this.currentLength,o=this.currentStartIndices;super.start(e,t);const{buffers:p,attribute:_}=this;for(let M=0;M<2;M++)p[M]=bR({device:this.device,buffer:p[M],attribute:_,fromLength:r,toLength:this.currentLength,fromStartIndices:o,getData:e.enter});p[2]=xR({device:this.device,source:p[0],target:p[2]}),this.setBuffer(p[1]);const{model:l}=this.transform;l.setVertexCount(Math.floor(this.currentLength/_.size)),_.isConstant?l.setConstantAttributes({aTo:_.value}):l.setAttributes({aTo:_.getBuffer()})}onUpdate(){const{buffers:e,transform:t,framebuffer:r,transition:o}=this,p=this.settings;t.model.setAttributes({aPrev:e[0],aCur:e[1]}),t.transformFeedback.setBuffers({vNext:e[2]});const _={stiffness:p.stiffness,damping:p.damping};t.model.shaderInputs.setProps({spring:_}),t.run({framebuffer:r,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),vR(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(r)[0]>0||o.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const mW=`uniform springUniforms {
  float damping;
  float stiffness;
} spring;
`,_W={name:"spring",vs:mW,uniformTypes:{damping:"f32",stiffness:"f32"}},yW=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE force = delta * spring.stiffness;
  ATTRIBUTE_TYPE resistance = velocity * spring.damping;
  return force - resistance + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,vW=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function xW(i,e){const t=_R(e.size),r=yR(e.size);return new x1(i,{vs:yW,fs:vW,bufferLayout:[{name:"aPrev",format:r},{name:"aCur",format:r},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[_W],defines:{ATTRIBUTE_TYPE:t},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function bW(i){return i.createTexture({data:new Uint8Array(4),format:"rgba8unorm",width:1,height:1})}function AW(i,e){return i.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}const wW={interpolation:uW,spring:gW};class TW{constructor(e,{id:t,timeline:r}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=t,this.device=e,this.timeline=r,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:t,numInstances:r}){this.numInstances=r||1;for(const o in e){const p=e[o],_=p.getTransitionSetting(t);_&&this._updateAttribute(o,p,_)}for(const o in this.transitions){const p=e[o];(!p||!p.getTransitionSetting(t))&&this._removeTransition(o)}}hasAttribute(e){const t=this.transitions[e];return t&&t.inProgress}getAttributes(){const e={};for(const t in this.transitions){const r=this.transitions[t];r.inProgress&&(e[t]=r.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(const t in this.transitions)this.transitions[t].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,t,r){const o=this.transitions[e];let p=!o||o.type!==r.type;if(p){o&&this._removeTransition(e);const _=wW[r.type];_?this.transitions[e]=new _({attribute:t,timeline:this.timeline,device:this.device}):(Wr.error(`unsupported transition type '${r.type}'`)(),p=!1)}(p||t.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(r,this.numInstances))}}const SS="attributeManager.invalidate",SW="attributeManager.updateStart",EW="attributeManager.updateEnd",MW="attribute.updateStart",RW="attribute.allocate",CW="attribute.updateEnd";class PW{constructor(e,{id:t="attribute-manager",stats:r,timeline:o}={}){this.mergeBoundsMemoized=D1(jV),this.id=t,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=r,this.attributeTransitionManager=new TW(e,{id:`${t}-transitions`,timeline:o}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const t=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,t&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const t of e)this.attributes[t]!==void 0&&(this.attributes[t].delete(),delete this.attributes[t])}invalidate(e,t){const r=this._invalidateTrigger(e,t);Dc(SS,this,e,r)}invalidateAll(e){for(const t in this.attributes)this.attributes[t].setNeedsUpdate(t,e);Dc(SS,this,"all")}update({data:e,numInstances:t,startIndices:r=null,transitions:o,props:p={},buffers:_={},context:l={}}){let M=!1;Dc(SW,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const D in this.attributes){const B=this.attributes[D],j=B.settings.accessor;B.startIndices=r,B.numInstances=t,p[D]&&Wr.removed(`props.${D}`,`data.attributes.${D}`)(),B.setExternalBuffer(_[D])||B.setBinaryValue(typeof j=="string"?_[j]:void 0,e.startIndices)||typeof j=="string"&&!_[j]&&B.setConstantValue(l,p[j])||B.needsUpdate()&&(M=!0,this._updateAttribute({attribute:B,numInstances:t,data:e,props:p,context:l})),this.needsRedraw=this.needsRedraw||B.needsRedraw()}M&&Dc(EW,this,t),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:t,transitions:o})}updateTransition(){const{attributeTransitionManager:e}=this,t=e.run();return this.needsRedraw=this.needsRedraw||t,t}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const t=e.map(r=>{var o;return(o=this.attributes[r])==null?void 0:o.getBounds()});return this.mergeBoundsMemoized(t)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:t,attributeTransitionManager:r}=this,o={...r.getAttributes()};for(const p in t){const _=t[p];_.needsRedraw(e)&&!r.hasAttribute(p)&&(o[p]=_)}return o}getBufferLayouts(e){return Object.values(this.getAttributes()).map(t=>t.getBufferLayout(e))}_add(e,t){for(const r in e){const o=e[r],p={...o,id:r,size:o.isIndexed&&1||o.size||1,...t};this.attributes[r]=new mR(this.device,p)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const t in this.attributes)this.attributes[t].getUpdateTriggers().forEach(o=>{e[o]||(e[o]=[]),e[o].push(t)});this.updateTriggers=e}_invalidateTrigger(e,t){const{attributes:r,updateTriggers:o}=this,p=o[e];return p&&p.forEach(_=>{const l=r[_];l&&l.setNeedsUpdate(l.id,t)}),p}_updateAttribute(e){const{attribute:t,numInstances:r}=e;if(Dc(MW,t),t.constant){t.setConstantValue(e.context,t.value);return}t.allocate(r)&&Dc(RW,t,r),t.updateBuffer(e)&&(this.needsRedraw=!0,Dc(CW,t,r))}}class IW extends Bx{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:t,toValue:r,duration:o,easing:p}}=this,_=p(e/o);this._value=cx(t,r,_)}}const ES=1e-5;function MS(i,e,t,r,o){const p=e-i,l=(t-e)*o,M=-p*r;return l+M+p+e}function kW(i,e,t,r,o){if(Array.isArray(t)){const p=[];for(let _=0;_<t.length;_++)p[_]=MS(i[_],e[_],t[_],r,o);return p}return MS(i,e,t,r,o)}function RS(i,e){if(Array.isArray(i)){let t=0;for(let r=0;r<i.length;r++){const o=i[r]-e[r];t+=o*o}return Math.sqrt(t)}return Math.abs(i-e)}class DW extends Bx{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:t,damping:r,stiffness:o}=this.settings,{_prevValue:p=e,_currValue:_=e}=this;let l=kW(p,_,t,r,o);const M=RS(l,t),D=RS(l,_);M<ES&&D<ES&&(l=t,this.end()),this._prevValue=_,this._currValue=l}}const OW={interpolation:IW,spring:DW};class FW{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,t,r,o){const{transitions:p}=this;if(p.has(e)){const M=p.get(e),{value:D=M.settings.fromValue}=M;t=D,this.remove(e)}if(o=gR(o),!o)return;const _=OW[o.type];if(!_){Wr.error(`unsupported transition type '${o.type}'`)();return}const l=new _(this.timeline);l.start({...o,fromValue:t,toValue:r}),p.set(e,l)}remove(e){const{transitions:t}=this;t.has(e)&&(t.get(e).cancel(),t.delete(e))}update(){const e={};for(const[t,r]of this.transitions)r.update(),e[t]=r.value,r.inProgress||this.remove(t);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function NW(i){const e=i[v_];for(const t in e){const r=e[t],{validate:o}=r;if(o&&!o(i[t],r))throw new Error(`Invalid prop ${t}: ${i[t]}`)}}function BW(i,e){const t=TR({newProps:i,oldProps:e,propTypes:i[v_],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),r=LW(i,e);let o=!1;return r||(o=UW(i,e)),{dataChanged:r,propsChanged:t,updateTriggersChanged:o,extensionsChanged:VW(i,e),transitionsChanged:zW(i,e)}}function zW(i,e){if(!i.transitions)return!1;const t={},r=i[v_];let o=!1;for(const p in i.transitions){const _=r[p],l=_&&_.type;(l==="number"||l==="color"||l==="array")&&ew(i[p],e[p],_)&&(t[p]=!0,o=!0)}return o?t:!1}function TR({newProps:i,oldProps:e,ignoreProps:t={},propTypes:r={},triggerName:o="props"}){if(e===i)return!1;if(typeof i!="object"||i===null)return`${o} changed shallowly`;if(typeof e!="object"||e===null)return`${o} changed shallowly`;for(const p of Object.keys(i))if(!(p in t)){if(!(p in e))return`${o}.${p} added`;const _=ew(i[p],e[p],r[p]);if(_)return`${o}.${p} ${_}`}for(const p of Object.keys(e))if(!(p in t)){if(!(p in i))return`${o}.${p} dropped`;if(!Object.hasOwnProperty.call(i,p)){const _=ew(i[p],e[p],r[p]);if(_)return`${o}.${p} ${_}`}}return!1}function ew(i,e,t){let r=t&&t.equal;return r&&!r(i,e,t)||!r&&(r=i&&e&&i.equals,r&&!r.call(i,e))?"changed deeply":!r&&e!==i?"changed shallowly":null}function LW(i,e){if(e===null)return"oldProps is null, initial diff";let t=!1;const{dataComparator:r,_dataDiff:o}=i;return r?r(i.data,e.data)||(t="Data comparator detected a change"):i.data!==e.data&&(t="A new data container was supplied"),t&&o&&(t=o(i.data,e.data)||t),t}function UW(i,e){if(e===null)return{all:!0};if("all"in i.updateTriggers&&CS(i,e,"all"))return{all:!0};const t={};let r=!1;for(const o in i.updateTriggers)o!=="all"&&CS(i,e,o)&&(t[o]=!0,r=!0);return r?t:!1}function VW(i,e){if(e===null)return!0;const t=e.extensions,{extensions:r}=i;if(r===t)return!1;if(!t||!r||r.length!==t.length)return!0;for(let o=0;o<r.length;o++)if(!r[o].equals(t[o]))return!0;return!1}function CS(i,e,t){let r=i.updateTriggers[t];r=r??{};let o=e.updateTriggers[t];return o=o??{},TR({oldProps:o,newProps:r,triggerName:t})}const jW="count(): argument not an object",GW="count(): argument not a container";function WW(i){if(!XW(i))throw new Error(jW);if(typeof i.count=="function")return i.count();if(Number.isFinite(i.size))return i.size;if(Number.isFinite(i.length))return i.length;if(ZW(i))return Object.keys(i).length;throw new Error(GW)}function ZW(i){return i!==null&&typeof i=="object"&&i.constructor===Object}function XW(i){return i!==null&&typeof i=="object"}function PS(i,e){if(!e)return i;const t={...i,...e};if("defines"in e&&(t.defines={...i.defines,...e.defines}),"modules"in e&&(t.modules=(i.modules||[]).concat(e.modules),e.modules.some(r=>r.name==="project64"))){const r=t.modules.findIndex(o=>o.name==="project32");r>=0&&t.modules.splice(r,1)}if("inject"in e)if(!i.inject)t.inject=e.inject;else{const r={...i.inject};for(const o in e.inject)r[o]=(r[o]||"")+e.inject[o];t.inject=r}return t}const HW={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},tw={};function $W(i,e,t,r){if(t instanceof lh)return t;t.constructor&&t.constructor.name!=="Object"&&(t={data:t});let o=null;t.compressed&&(o={minFilter:"linear",mipmapFilter:t.data.length>1?"nearest":"linear"});const{width:p,height:_}=t.data,l=e.createTexture({...t,sampler:{...HW,...o,...r},mipLevels:e.getMipLevelCount(p,_)});return l.generateMipmapsWebGL(),tw[l.id]=i,l}function qW(i,e){!e||!(e instanceof lh)||tw[e.id]===i&&(e.delete(),delete tw[e.id])}const YW={boolean:{validate(i,e){return!0},equal(i,e,t){return!!i==!!e}},number:{validate(i,e){return Number.isFinite(i)&&(!("max"in e)||i<=e.max)&&(!("min"in e)||i>=e.min)}},color:{validate(i,e){return e.optional&&!i||iw(i)&&(i.length===3||i.length===4)},equal(i,e,t){return cu(i,e,1)}},accessor:{validate(i,e){const t=px(i);return t==="function"||t===px(e.value)},equal(i,e,t){return typeof e=="function"?!0:cu(i,e,1)}},array:{validate(i,e){return e.optional&&!i||iw(i)},equal(i,e,t){const{compare:r}=t,o=Number.isInteger(r)?r:r?1:0;return r?cu(i,e,o):i===e}},object:{equal(i,e,t){if(t.ignore)return!0;const{compare:r}=t,o=Number.isInteger(r)?r:r?1:0;return r?cu(i,e,o):i===e}},function:{validate(i,e){return e.optional&&!i||typeof i=="function"},equal(i,e,t){return!t.compare&&t.ignore!==!1||i===e}},data:{transform:(i,e,t)=>{if(!i)return i;const{dataTransform:r}=t.props;return r?r(i):typeof i.shape=="string"&&i.shape.endsWith("-table")&&Array.isArray(i.data)?i.data:i}},image:{transform:(i,e,t)=>{const r=t.context;return!r||!r.device?null:$W(t.id,r.device,i,{...e.parameters,...t.props.textureParameters})},release:(i,e,t)=>{qW(t.id,i)}}};function JW(i){const e={},t={},r={};for(const[o,p]of Object.entries(i)){const _=p==null?void 0:p.deprecatedFor;if(_)r[o]=Array.isArray(_)?_:[_];else{const l=QW(o,p);e[o]=l,t[o]=l.value}}return{propTypes:e,defaultProps:t,deprecatedProps:r}}function QW(i,e){switch(px(e)){case"object":return z2(i,e);case"array":return z2(i,{type:"array",value:e,compare:!1});case"boolean":return z2(i,{type:"boolean",value:e});case"number":return z2(i,{type:"number",value:e});case"function":return z2(i,{type:"function",value:e,compare:!0});default:return{name:i,type:"unknown",value:e}}}function z2(i,e){return"type"in e?{name:i,...YW[e.type],...e}:"value"in e?{name:i,type:px(e.value),...e}:{name:i,type:"object",value:e}}function iw(i){return Array.isArray(i)||ArrayBuffer.isView(i)}function px(i){return iw(i)?"array":i===null?"null":typeof i}function KW(i,e){let t;for(let p=e.length-1;p>=0;p--){const _=e[p];"extensions"in _&&(t=_.extensions)}const r=nw(i.constructor,t),o=Object.create(r);o[dx]=i,o[R_]={},o[Zg]={};for(let p=0;p<e.length;++p){const _=e[p];for(const l in _)o[l]=_[l]}return Object.freeze(o),o}const eZ="_mergedDefaultProps";function nw(i,e){if(!(i instanceof zx.constructor))return{};let t=eZ;if(e)for(const o of e){const p=o.constructor;p&&(t+=`:${p.extensionName||p.name}`)}const r=SR(i,t);return r||(i[t]=tZ(i,e||[]))}function tZ(i,e){if(!i.prototype)return null;const r=Object.getPrototypeOf(i),o=nw(r),p=SR(i,"defaultProps")||{},_=JW(p),l=Object.assign(Object.create(null),o,_.defaultProps),M=Object.assign(Object.create(null),o==null?void 0:o[v_],_.propTypes),D=Object.assign(Object.create(null),o==null?void 0:o[$b],_.deprecatedProps);for(const B of e){const j=nw(B.constructor);j&&(Object.assign(l,j),Object.assign(M,j[v_]),Object.assign(D,j[$b]))}return iZ(l,i),rZ(l,M),nZ(l,D),l[v_]=M,l[$b]=D,e.length===0&&!r3(i,"_propTypes")&&(i._propTypes=M),l}function iZ(i,e){const t=aZ(e);Object.defineProperties(i,{id:{writable:!0,value:t}})}function nZ(i,e){for(const t in e)Object.defineProperty(i,t,{enumerable:!1,set(r){const o=`${this.id}: ${t}`;for(const p of e[t])r3(this,p)||(this[p]=r);Wr.deprecated(o,e[t].join("/"))()}})}function rZ(i,e){const t={},r={};for(const o in e){const p=e[o],{name:_,value:l}=p;p.async&&(t[_]=l,r[_]=sZ(_))}i[$y]=t,i[R_]={},Object.defineProperties(i,r)}function sZ(i){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||pR(e)?this[R_][i]=e:this[Zg][i]=e},get(){if(this[Zg]){if(i in this[Zg])return this[Zg][i]||this[$y][i];if(i in this[R_]){const e=this[dx]&&this[dx].internalState;if(e&&e.hasAsyncProp(i))return e.getAsyncProp(i)||this[$y][i]}}return this[$y][i]}}}function r3(i,e){return Object.prototype.hasOwnProperty.call(i,e)}function SR(i,e){return r3(i,e)&&i[e]}function aZ(i){const e=i.componentName;return e||Wr.warn(`${i.name}.componentName not specified`)(),e||i.name}let oZ=0;class zx{constructor(...e){this.props=KW(this,e),this.id=this.props.id,this.count=oZ++}clone(e){const{props:t}=this,r={};for(const o in t[$y])o in t[Zg]?r[o]=t[Zg][o]:o in t[R_]&&(r[o]=t[R_][o]);return new this.constructor({...t,...r,...e})}}zx.componentName="Component";zx.defaultProps={};const lZ=Object.freeze({});class cZ{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const t=this.asyncProps[e];t&&t.type&&t.type.release&&t.type.release(t.resolvedValue,t.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||lZ}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const t=this.asyncProps[e];return t&&t.resolvedValue}isAsyncPropLoading(e){if(e){const t=this.asyncProps[e];return!!(t&&t.pendingLoadCount>0&&t.pendingLoadCount!==t.resolvedLoadCount)}for(const t in this.asyncProps)if(this.isAsyncPropLoading(t))return!0;return!1}reloadAsyncProp(e,t){this._watchPromise(e,Promise.resolve(t))}setAsyncProps(e){this.component=e[dx]||this.component;const t=e[Zg]||{},r=e[R_]||e,o=e[$y]||{};for(const p in t){const _=t[p];this._createAsyncPropData(p,o[p]),this._updateAsyncProp(p,_),t[p]=this.getAsyncProp(p)}for(const p in r){const _=r[p];this._createAsyncPropData(p,o[p]),this._updateAsyncProp(p,_)}}_fetch(e,t){return null}_onResolve(e,t){}_onError(e,t){}_updateAsyncProp(e,t){if(this._didAsyncInputValueChange(e,t)){if(typeof t=="string"&&(t=this._fetch(e,t)),t instanceof Promise){this._watchPromise(e,t);return}if(pR(t)){this._resolveAsyncIterable(e,t);return}this._setPropValue(e,t)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,t){const r=this.asyncProps[e];return t===r.resolvedValue||t===r.lastValue?!1:(r.lastValue=t,!0)}_setPropValue(e,t){this._freezeAsyncOldProps();const r=this.asyncProps[e];r&&(t=this._postProcessValue(r,t),r.resolvedValue=t,r.pendingLoadCount++,r.resolvedLoadCount=r.pendingLoadCount)}_setAsyncPropValue(e,t,r){const o=this.asyncProps[e];o&&r>=o.resolvedLoadCount&&t!==void 0&&(this._freezeAsyncOldProps(),o.resolvedValue=t,o.resolvedLoadCount=r,this.onAsyncPropUpdated(e,t))}_watchPromise(e,t){const r=this.asyncProps[e];if(r){r.pendingLoadCount++;const o=r.pendingLoadCount;t.then(p=>{this.component&&(p=this._postProcessValue(r,p),this._setAsyncPropValue(e,p,o),this._onResolve(e,p))}).catch(p=>{this._onError(e,p)})}}async _resolveAsyncIterable(e,t){if(e!=="data"){this._setPropValue(e,t);return}const r=this.asyncProps[e];if(!r)return;r.pendingLoadCount++;const o=r.pendingLoadCount;let p=[],_=0;for await(const l of t){if(!this.component)return;const{dataTransform:M}=this.component.props;M?p=M(l,p):p=p.concat(l),Object.defineProperty(p,"__diff",{enumerable:!1,value:[{startRow:_,endRow:p.length}]}),_=p.length,this._setAsyncPropValue(e,p,o)}this._onResolve(e,p)}_postProcessValue(e,t){const r=e.type;return r&&this.component&&(r.release&&r.release(e.resolvedValue,r,this.component),r.transform)?r.transform(t,r,this.component):t}_createAsyncPropData(e,t){if(!this.asyncProps[e]){const o=this.component&&this.component.props[v_];this.asyncProps[e]={type:o&&o[e],lastValue:null,resolvedValue:t,pendingLoadCount:0,resolvedLoadCount:0}}}}class uZ extends cZ{constructor({attributeManager:e,layer:t}){super(t),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,t){const r=this.layer,o=r==null?void 0:r.props.fetch;return o?o(t,{propName:e,layer:r}):super._fetch(e,t)}_onResolve(e,t){const r=this.layer;if(r){const o=r.props.onDataLoad;e==="data"&&o&&o(t,{propName:e,layer:r})}}_onError(e,t){const r=this.layer;r&&r.raiseError(t,`loading ${e} of ${this.layer}`)}}const hZ="layer.changeFlag",fZ="layer.initialize",dZ="layer.update",pZ="layer.finalize",gZ="layer.matched",IS=2**24-1,mZ=Object.freeze([]),_Z=D1(({oldViewport:i,viewport:e})=>i.equals(e));let $f=new Uint8ClampedArray(0);const yZ={data:{type:"data",value:mZ,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:i=>i&&i.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(i,{propName:e,layer:t,loaders:r,loadOptions:o,signal:p})=>{const{resourceManager:_}=t.context;o=o||t.getLoadOptions(),r=r||t.props.loaders,p&&(o={...o,fetch:{...o==null?void 0:o.fetch,signal:p}});let l=_.contains(i);return!l&&!o&&(_.add({resourceId:i,data:Uv(i,r),persistent:!1}),l=!0),l?_.subscribe({resourceId:i,onChange:M=>{var D;return(D=t.internalState)==null?void 0:D.reloadAsyncProp(e,M)},consumerId:t.id,requestId:e}):Uv(i,r,o)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:xr.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:i})=>[0,-i*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class F1 extends zx{constructor(){super(...arguments),this.internalState=null,this.lifecycle=ky.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){no(this.internalState);const t=this.internalState.viewport||this.context.viewport,r=HM(e,{viewport:t,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[o,p,_]=GM(r,t.pixelProjectionMatrix);return e.length===2?[o,p]:[o,p,_]}unproject(e){return no(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,t){no(this.internalState);const r=this.internalState.viewport||this.context.viewport;return $V(e,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...t})}get isComposite(){return!1}get isDrawable(){return!0}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setShaderModuleProps(...e){for(const t of this.getModels())t.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===xr.DEFAULT||e===xr.LNGLAT||e===xr.CARTESIAN}onHover(e,t){return this.props.onHover&&this.props.onHover(e,t)||!1}onClick(e,t){return this.props.onClick&&this.props.onClick(e,t)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,t=[]){return t[0]=e+1&255,t[1]=e+1>>8&255,t[2]=e+1>>8>>8&255,t}decodePickingColor(e){no(e instanceof Uint8Array);const[t,r,o]=e;return t+r*256+o*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:WW(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){e=PS(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const t of this.props.extensions)e=PS(e,t.getShaders.call(this,t));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const t=this.getAttributeManager(),{dataChanged:r}=e.changeFlags;if(r&&t)if(Array.isArray(r))for(const o of r)t.invalidateAll(o);else t.invalidateAll();if(t){const{props:o}=e,p=this.internalState.hasPickingBuffer,_=Number.isInteger(o.highlightedObjectIndex)||o.pickable||o.extensions.some(l=>l.getNeedsPickingBuffer.call(this,l));if(p!==_){this.internalState.hasPickingBuffer=_;const{pickingColors:l,instancePickingColors:M}=t.attributes,D=l||M;D&&(_&&D.constant&&(D.constant=!1,t.invalidate(D.id)),!D.value&&!_&&(D.constant=!0,D.value=[0,0,0]))}}}finalizeState(e){for(const r of this.getModels())r.destroy();const t=this.getAttributeManager();t&&t.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const t of this.getModels())t.draw(e.renderPass)}getPickingInfo({info:e,mode:t,sourceLayer:r}){const{index:o}=e;return o>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[o]),e}raiseError(e,t){var r,o,p,_;t&&(e=new Error(`${t}: ${e.message}`,{cause:e})),(o=(r=this.props).onError)!=null&&o.call(r,e)||(_=(p=this.context)==null?void 0:p.onError)==null||_.call(p,e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)==null?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const t=this.internalState.viewport;this.internalState.viewport=e,(!t||!_Z({oldViewport:t,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const t=this.getAttributeManager();t&&(e==="all"?t.invalidateAll():t.invalidate(e))}updateAttributes(e){let t=!1;for(const r in e)e[r].layoutChanged()&&(t=!0);for(const r of this.getModels())this._setModelAttributes(r,e,t)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const t=this.props,r=this.getNumInstances(),o=this.getStartIndices();e.update({data:t.data,numInstances:r,startIndices:o,props:t,transitions:t.transitions,buffers:t.data.attributes,context:this});const p=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(p)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const t=e.update(),r=Object.create(this.props);for(const o in t)Object.defineProperty(r,o,{value:t[o]});return r}return this.props}calculateInstancePickingColors(e,{numInstances:t}){if(e.constant)return;const r=Math.floor($f.length/4);if(this.internalState.usesPickingColorCache=!0,r<t){t>IS&&Wr.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),$f=v1.allocate($f,t,{size:4,copy:!0,maxCount:Math.max(t,IS)});const o=Math.floor($f.length/4),p=[0,0,0];for(let _=r;_<o;_++)this.encodePickingColor(_,p),$f[_*4+0]=p[0],$f[_*4+1]=p[1],$f[_*4+2]=p[2],$f[_*4+3]=0}e.value=$f.subarray(0,t*4)}_setModelAttributes(e,t,r=!1){var l;if(!Object.keys(t).length)return;if(r){const M=this.getAttributeManager();e.setBufferLayout(M.getBufferLayouts(e)),t=M.getAttributes()}const o=((l=e.userData)==null?void 0:l.excludeAttributes)||{},p={},_={};for(const M in t){if(o[M])continue;const D=t[M].getValue();for(const B in D){const j=D[B];j instanceof xa?t[M].settings.isIndexed?e.setIndexBuffer(j):p[B]=j:j&&(_[B]=j)}}e.setAttributes(p),e.setConstantAttributes(_)}disablePickingIndex(e){const t=this.props.data;if(!("attributes"in t)){this._disablePickingIndex(e);return}const{pickingColors:r,instancePickingColors:o}=this.getAttributeManager().attributes,p=r||o,_=p&&t.attributes&&t.attributes[p.id];if(_&&_.value){const l=_.value,M=this.encodePickingColor(e);for(let D=0;D<t.length;D++){const B=p.getVertexOffset(D);l[B]===M[0]&&l[B+1]===M[1]&&l[B+2]===M[2]&&this._disablePickingIndex(D)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:t,instancePickingColors:r}=this.getAttributeManager().attributes,o=t||r;if(!o)return;const p=o.getVertexOffset(e),_=o.getVertexOffset(e+1);o.buffer.write(new Uint8Array(_-p),p)}restorePickingColors(){const{pickingColors:e,instancePickingColors:t}=this.getAttributeManager().attributes,r=e||t;r&&(this.internalState.usesPickingColorCache&&r.value.buffer!==$f.buffer&&(r.value=$f.subarray(0,r.value.length)),r.updateSubBuffer({startOffset:0}))}_initialize(){no(!this.internalState),no(Number.isFinite(this.props.coordinateSystem)),Dc(fZ,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new uZ({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(Wr.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new FW(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const t of this.props.extensions)t.initializeState.call(this,this.context,t);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){Dc(gZ,this,this===e);const{state:t,internalState:r}=e;this!==e&&(this.internalState=r,this.state=t,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(Dc(dZ,this,e),!e)return;const t=this.props,r=this.context,o=this.internalState,p=r.viewport,_=this._updateUniformTransition();o.propsInTransition=_,r.viewport=o.viewport||p,this.props=_;try{const l=this._getUpdateParams(),M=this.getModels();if(r.device)this.updateState(l);else try{this.updateState(l)}catch{}for(const B of this.props.extensions)B.updateState.call(this,l,B);this.setNeedsRedraw(),this._updateAttributes();const D=this.getModels()[0]!==M[0];this._postUpdate(l,D)}finally{r.viewport=p,this.props=t,this._clearChangeFlags(),o.needsUpdate=!1,o.resetOldProps()}}_finalize(){Dc(pZ,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,shaderModuleProps:t=null,uniforms:r={},parameters:o={}}){this._updateAttributeTransition();const p=this.props,_=this.context;this.props=this.internalState.propsInTransition||p;try{t&&this.setShaderModuleProps(t);const{getPolygonOffset:l}=this.props,M=l&&l(r)||[0,0];_.device instanceof QA&&_.device.setParametersWebGL({polygonOffset:M});for(const D of this.getModels())D.device.type==="webgpu"?D.setParameters({...D.parameters,...o}):D.setParameters(o);if(_.device instanceof QA)_.device.withParametersWebGL(o,()=>{const D={renderPass:e,shaderModuleProps:t,uniforms:r,parameters:o,context:_};for(const B of this.props.extensions)B.draw.call(this,D,B);this.draw(D)});else{const D={renderPass:e,shaderModuleProps:t,uniforms:r,parameters:o,context:_};for(const B of this.props.extensions)B.draw.call(this,D,B);this.draw(D)}}finally{this.props=p}}getChangeFlags(){var e;return(e=this.internalState)==null?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:t}=this.internalState;for(const o in e)if(e[o]){let p=!1;switch(o){case"dataChanged":const _=e[o],l=t[o];_&&Array.isArray(l)&&(t.dataChanged=Array.isArray(_)?l.concat(_):_,p=!0);default:t[o]||(t[o]=e[o],p=!0)}p&&Dc(hZ,this,o,e)}const r=!!(t.dataChanged||t.updateTriggersChanged||t.propsChanged||t.extensionsChanged);t.propsOrDataChanged=r,t.somethingChanged=r||t.viewportChanged||t.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,t){var o;const r=BW(e,t);if(r.updateTriggersChanged)for(const p in r.updateTriggersChanged)r.updateTriggersChanged[p]&&this.invalidateAttribute(p);if(r.transitionsChanged)for(const p in r.transitionsChanged)this.internalState.uniformTransitions.add(p,t[p],e[p],(o=e.transitions)==null?void 0:o[p]);return this.setChangeFlags(r)}validateProps(){NW(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const t={highlightedObjectColor:e.picked?e.color:null},{highlightColor:r}=this.props;e.picked&&typeof r=="function"&&(t.highlightColor=r(e)),this.setShaderModuleProps({picking:t}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new PW(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,t){const{props:r,oldProps:o}=e,p=this.state.model;p!=null&&p.isInstanced&&p.setInstanceCount(this.getNumInstances());const{autoHighlight:_,highlightedObjectIndex:l,highlightColor:M}=r;if(t||o.autoHighlight!==_||o.highlightedObjectIndex!==l||o.highlightColor!==M){const D={};Array.isArray(M)&&(D.highlightColor=M),(t||o.autoHighlight!==_||l!==o.highlightedObjectIndex)&&(D.highlightedObjectColor=Number.isFinite(l)&&l>=0?this.encodePickingColor(l):null),this.setShaderModuleProps({picking:D})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let t=!1;t=t||this.internalState.needsRedraw&&this.id;const r=this.getAttributeManager(),o=r?r.getNeedsRedraw(e):!1;if(t=t||o,t)for(const p of this.props.extensions)p.onNeedsRedraw.call(this,p);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,t}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}F1.defaultProps=yZ;F1.layerName="Layer";class vZ extends eR{constructor(e){const{startPanPos:t,...r}=e;super(r),t!==void 0&&(this._state.startPanPos=t)}panStart({pos:e}){const{latitude:t,longitude:r,zoom:o}=this.getViewportProps();return this._getUpdatedState({startPanLngLat:[r,t],startPanPos:e,startZoom:o})}pan({pos:e,startPos:t}){const r=this.getState(),o=r.startPanLngLat||this._unproject(t);if(!o)return this;const p=r.startZoom??this.getViewportProps().zoom,_=r.startPanPos||t,l=[o[0],o[1],p],D=this.makeViewport(this.getViewportProps()).panByPosition(l,e,_);return this._getUpdatedState(D)}panEnd(){return this._getUpdatedState({startPanLngLat:null,startPanPos:null,startZoom:null})}zoom({scale:e}){const r=(this.getState().startZoom||this.getViewportProps().zoom)+Math.log2(e);return this._getUpdatedState({zoom:r})}applyConstraints(e){const{longitude:t,latitude:r,maxZoom:o,minZoom:p,zoom:_}=e,l=Ly(0),M=Ly(r)-l;return e.zoom=a0(_,p+M,o+M),(t<-180||t>180)&&(e.longitude=zV(t+180,360)-180),e.latitude=a0(r,-o0,o0),e}}class xZ extends KM{constructor(){super(...arguments),this.ControllerState=vZ,this.transition={transitionDuration:300,transitionInterpolator:new qw(["longitude","latitude","zoom"])},this.dragMode="pan"}setProps(e){super.setProps(e),this.dragRotate=!1,this.touchRotate=!1}}class ER extends QM{constructor(e={}){super(e)}getViewportType(e){return e.zoom>12?M_:$w}get ControllerType(){return xZ}}ER.displayName="GlobeView";class s3{static get componentName(){return Object.prototype.hasOwnProperty.call(this,"extensionName")?this.extensionName:""}constructor(e){e&&(this.opts=e)}equals(e){return this===e?!0:this.constructor===e.constructor&&cu(this.opts,e.opts,1)}getShaders(e){return null}getSubLayerProps(e){const{defaultProps:t}=e.constructor,r={updateTriggers:{}};for(const o in t)if(o in this.props){const p=t[o],_=this.props[o];r[o]=_,p&&p.type==="accessor"&&(r.updateTriggers[o]=this.props.updateTriggers[o],typeof _=="function"&&(r[o]=this.getSubLayerAccessor(_)))}return r}initializeState(e,t){}updateState(e,t){}onNeedsRedraw(e){}getNeedsPickingBuffer(e){return!1}draw(e,t){}finalizeState(e,t){}}s3.defaultProps={};s3.extensionName="LayerExtension";const w1="mapbox",iA=512,bZ=Math.PI/180;function a3({map:i,gl:e,deck:t}){if(i.__deck)return i.__deck;const r=t==null?void 0:t.props._customRender,o=t==null?void 0:t.props.onLoad,p={...t==null?void 0:t.props,_customRender:()=>{i.triggerRepaint(),r==null||r("")}};p.parameters={...Fv(i,!0),...p.parameters},p.views||(p.views=a1(i));let _;return(!t||t.props.gl===e)&&(Object.assign(p,{gl:e,width:null,height:null,touchAction:"unset",viewState:T1(i)}),t!=null&&t.isInitialized?kS(t,i):p.onLoad=()=>{o==null||o(),kS(_,i)}),t?(_=t,t.setProps(p),t.userData.isExternal=!0):(_=new A1(p),i.on("remove",()=>{MR(i)})),_.userData.mapboxLayers=new Set,i.__deck=_,i.on("render",()=>{_.isInitialized&&RZ(_,i)}),_}function kS(i,e){const t=()=>{i.isInitialized?CZ(i,e):e.off("move",t)};e.on("move",t)}function MR(i){var e;(e=i.__deck)==null||e.finalize(),i.__deck=null}function Fv(i,e){const t=e?{depthWriteEnabled:!0,depthCompare:"less-equal",depthBias:0,blend:!0,blendColorSrcFactor:"src-alpha",blendColorDstFactor:"one-minus-src-alpha",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one-minus-src-alpha",blendColorOperation:"add",blendAlphaOperation:"add"}:{};return o3(i)==="globe"&&(t.cullMode="back"),t}function AZ(i,e){i.userData.mapboxLayers.add(e),c3(i)}function wZ(i,e){i.userData.mapboxLayers.delete(e),c3(i)}function TZ(i,e){c3(i)}function SZ(i,e,t,r){let{currentViewport:o}=i.userData,p=!1;o||(o=l3(i,e,r),i.userData.currentViewport=o,p=!0),i.isInitialized&&i._drawLayers("mapbox-repaint",{viewports:[o],layerFilter:_=>(!i.props.layerFilter||i.props.layerFilter(_))&&(t.id===_.layer.id||_.layer.props.operation.includes("terrain")),clearStack:p,clearCanvas:!1})}function EZ(i,e,t,r){let{currentViewport:o}=i.userData,p=!1;o||(o=l3(i,e,r),i.userData.currentViewport=o,p=!0),i.isInitialized&&i._drawLayers("mapbox-repaint",{viewports:[o],layerFilter:_=>{if(i.props.layerFilter&&!i.props.layerFilter(_))return!1;const l=_.layer;return l.props.beforeId===t.beforeId&&l.props.slot===t.slot},clearStack:p,clearCanvas:!1})}function o3(i){var r;const e=(r=i.getProjection)==null?void 0:r.call(i),t=(e==null?void 0:e.type)||(e==null?void 0:e.name);if(t==="globe")return"globe";if(t&&t!=="mercator")throw new Error("Unsupported projection");return"mercator"}function a1(i){return o3(i)==="globe"?new ER({id:w1}):new Yw({id:w1})}function T1(i){var o;const{lng:e,lat:t}=i.getCenter(),r={longitude:(e+540)%360-180,latitude:t,zoom:i.getZoom(),bearing:i.getBearing(),pitch:i.getPitch(),padding:i.getPadding(),repeat:i.getRenderWorldCopies()};return(o=i.getTerrain)!=null&&o.call(i)&&MZ(i,r),r}function MZ(i,e){if(i.getFreeCameraOptions){const{position:t}=i.getFreeCameraOptions();if(!t||t.z===void 0)return;const r=i.transform.height,{longitude:o,latitude:p,pitch:_}=e,l=t.x*iA,M=(1-t.y)*iA,D=t.z*iA,B=_1([o,p]),j=l-B[0],$=M-B[1],se=Math.sqrt(j*j+$*$),de=_*bZ,Ae=1.5*r,he=de<.001?Ae*Math.cos(de)/D:Ae*Math.sin(de)/se;e.zoom=Math.log2(he);const Le=Ae*Math.cos(de)/he,$e=D-Le;e.position=[0,0,$e/kv(p)]}else typeof i.transform.elevation=="number"&&(e.position=[0,0,i.transform.elevation])}function l3(i,e,t){const r=T1(e),{views:o}=i.props,p=o&&Kg(o).find(M=>M.id===w1)||a1(e);t&&(p.props.nearZMultiplier=.2);const _=(t==null?void 0:t.nearZ)??e.transform._nearZ,l=(t==null?void 0:t.farZ)??e.transform._farZ;return Number.isFinite(_)&&(r.nearZ=_/e.transform.height,r.farZ=l/e.transform.height),p.makeViewport({width:i.width,height:i.height,viewState:r})}function RZ(i,e){const{mapboxLayers:t,isExternal:r}=i.userData;if(r){const o=Array.from(t,B=>B.id),_=Kg(i.props.layers,Boolean).some(B=>B&&!o.includes(B.id));let l=i.getViewports();const M=l.findIndex(B=>B.id===w1),D=l.length>1||M<0;(_||D)&&(M>=0&&(l=l.slice(),l[M]=l3(i,e)),i._drawLayers("mapbox-repaint",{viewports:l,layerFilter:B=>(!i.props.layerFilter||i.props.layerFilter(B))&&(B.viewport.id!==w1||!o.includes(B.layer.id)),clearCanvas:!1}))}i.userData.currentViewport=null}function CZ(i,e){i.setProps({viewState:T1(e)}),i.needsRedraw({clearRedrawFlags:!0})}function c3(i){if(i.userData.isExternal)return;const e=[];i.userData.mapboxLayers.forEach(t=>{const r=t.props.type,o=new r(t.props);e.push(o)}),i.setProps({layers:e})}class PZ{constructor(e){if(!e.id)throw new Error("Layer must have an unique id");this.id=e.id,this.type="custom",this.renderingMode=e.renderingMode||"3d",this.slot=e.slot,this.map=null,this.deck=null,this.props=e}onAdd(e,t){this.map=e,this.deck=a3({map:e,gl:t,deck:this.props.deck}),AZ(this.deck,this)}onRemove(){this.deck&&wZ(this.deck,this)}setProps(e){Object.assign(this.props,e,{id:this.id}),this.deck&&TZ(this.deck)}render(e,t){SZ(this.deck,this.map,this,t)}}const nA="__UNDEFINED__";function IZ(i,e,t,r){if(!i||!e||!i.style||!i.style._loaded)return;const o=Kg(r,Boolean);if(t!==r){const l=Kg(t,Boolean),M=new Set(l.map(D=>D.id));for(const D of o)M.delete(D.id);for(const D of M)i.getLayer(D)&&i.removeLayer(D)}for(const l of o){const M=i.getLayer(l.id);M?(M.implementation||M).setProps(l.props):i.addLayer(new PZ({id:l.id,deck:e,slot:l.props.slot}),l.props.beforeId)}const p=i.style._order,_={};for(const l of o){let{beforeId:M}=l.props;(!M||!p.includes(M))&&(M=nA),_[M]=_[M]||[],_[M].push(l.id)}for(const l in _){const M=_[l];let D=l===nA?p.length:p.indexOf(l),B=l===nA?void 0:l;for(let j=M.length-1;j>=0;j--){const $=M[j],se=p.indexOf($);se!==D-1&&(i.moveLayer($,B),se>D&&D++),D--,B=$}}}class kZ{constructor(e){no(e.id,"id is required"),this.id=e.id,this.type="custom",this.renderingMode=e.renderingMode||"3d",this.slot=e.slot,this.beforeId=e.beforeId,this.map=null,this.deck=null}onAdd(e,t){this.map=e,this.deck=a3({map:e,gl:t})}render(e,t){!this.deck||!this.map||EZ(this.deck,this.map,this,t)}}const rA="__UNDEFINED__";function sA(i){return i.props.beforeId?`deck-layer-group-before:${i.props.beforeId}`:i.props.slot?`deck-layer-group-slot:${i.props.slot}`:"deck-layer-group-last"}function DZ(i,e,t){if(!i||!i.style||!i.style._loaded)return;const r=Kg(t,Boolean);if(e!==t){const _=Kg(e,Boolean),l=new Set(_.map(D=>sA(D))),M=new Set(r.map(D=>sA(D)));for(const D of l)M.has(D)||i.getLayer(D)&&i.removeLayer(D)}const o={};for(const _ of r){const l=sA(_),M=i.getLayer(l);if(M){const D=M.implementation||M;o[l]=D}else{const D=new kZ({id:l,slot:_.props.slot,beforeId:_.props.beforeId});o[l]=D,i.addLayer(D,_.props.beforeId)}}const p=i.style._order;for(const[_,l]of Object.entries(o)){const M=l.beforeId||rA,D=M===rA?p.length:p.indexOf(M);if(p.indexOf(_)!==D-1){const j=M===rA?void 0:M;i.moveLayer(_,j)}}}class OZ{constructor(e){this._handleStyleChange=()=>{var o;if(this._resolveLayers(this._map,this._deck,this._props.layers,this._props.layers),!this._map)return;o3(this._map)&&!this._props.views&&((o=this._deck)==null||o.setProps({views:a1(this._map)}))},this._updateContainerSize=()=>{if(this._map&&this._container){const{clientWidth:r,clientHeight:o}=this._map.getContainer();Object.assign(this._container.style,{width:`${r}px`,height:`${o}px`})}},this._updateViewState=()=>{const r=this._deck,o=this._map;r&&o&&(r.setProps({views:this._props.views||a1(o),viewState:T1(o)}),r.isInitialized&&r.redraw())},this._handleMouseEvent=r=>{const o=this._deck;if(!o||!o.isInitialized)return;const p={type:r.type,offsetCenter:r.point,srcEvent:r},_=this._lastMouseDownPoint;switch(!r.point&&_&&(p.deltaX=r.originalEvent.clientX-_.clientX,p.deltaY=r.originalEvent.clientY-_.clientY,p.offsetCenter={x:_.x+p.deltaX,y:_.y+p.deltaY}),p.type){case"mousedown":o._onPointerDown(p),this._lastMouseDownPoint={...r.point,clientX:r.originalEvent.clientX,clientY:r.originalEvent.clientY};break;case"dragstart":p.type="panstart",o._onEvent(p);break;case"drag":p.type="panmove",o._onEvent(p);break;case"dragend":p.type="panend",o._onEvent(p);break;case"click":p.tapCount=1,o._onEvent(p);break;case"dblclick":p.type="click",p.tapCount=2,o._onEvent(p);break;case"mousemove":p.type="pointermove",o._onPointerMove(p);break;case"mouseout":p.type="pointerleave",o._onPointerMove(p);break;default:return}};const{interleaved:t=!1}=e;this._interleaved=t,this._renderLayersInGroups=e._renderLayersInGroups||!1,this._props=this.filterProps(e)}filterProps(e){const{interleaved:t=!1,useDevicePixels:r,...o}=e;return!t&&r!==void 0&&(o.useDevicePixels=r),o}setProps(e){this._interleaved&&e.layers&&this._resolveLayers(this._map,this._deck,this._props.layers,e.layers),Object.assign(this._props,this.filterProps(e)),this._deck&&this._map&&this._deck.setProps({...this._props,parameters:{...Fv(this._map,this._interleaved),...this._props.parameters}})}onAdd(e){return this._map=e,this._interleaved?this._onAddInterleaved(e):this._onAddOverlaid(e)}_onAddOverlaid(e){const t=document.createElement("div");return Object.assign(t.style,{position:"absolute",left:0,top:0,textAlign:"initial",pointerEvents:"none"}),this._container=t,this._deck=new A1({...this._props,parent:t,parameters:{...Fv(e,!1),...this._props.parameters},views:this._props.views||a1(e),viewState:T1(e)}),e.on("resize",this._updateContainerSize),e.on("render",this._updateViewState),e.on("mousedown",this._handleMouseEvent),e.on("dragstart",this._handleMouseEvent),e.on("drag",this._handleMouseEvent),e.on("dragend",this._handleMouseEvent),e.on("mousemove",this._handleMouseEvent),e.on("mouseout",this._handleMouseEvent),e.on("click",this._handleMouseEvent),e.on("dblclick",this._handleMouseEvent),this._updateContainerSize(),t}_onAddInterleaved(e){const t=e.painter.context.gl;return t instanceof WebGLRenderingContext&&Wr.warn("Incompatible basemap library. See: https://deck.gl/docs/api-reference/mapbox/overview#compatibility")(),this._deck=a3({map:e,gl:t,deck:new A1({...this._props,gl:t,parameters:{...Fv(e,!0),...this._props.parameters}})}),e.on("styledata",this._handleStyleChange),this._resolveLayers(e,this._deck,[],this._props.layers),document.createElement("div")}_resolveLayers(e,t,r,o){this._renderLayersInGroups?DZ(e,r,o):IZ(e,t,r,o)}onRemove(){const e=this._map;e&&(this._interleaved?this._onRemoveInterleaved(e):this._onRemoveOverlaid(e)),this._deck=void 0,this._map=void 0,this._container=void 0}_onRemoveOverlaid(e){var t;e.off("resize",this._updateContainerSize),e.off("render",this._updateViewState),e.off("mousedown",this._handleMouseEvent),e.off("dragstart",this._handleMouseEvent),e.off("drag",this._handleMouseEvent),e.off("dragend",this._handleMouseEvent),e.off("mousemove",this._handleMouseEvent),e.off("mouseout",this._handleMouseEvent),e.off("click",this._handleMouseEvent),e.off("dblclick",this._handleMouseEvent),(t=this._deck)==null||t.finalize()}_onRemoveInterleaved(e){e.off("styledata",this._handleStyleChange),this._resolveLayers(e,this._deck,this._props.layers,[]),MR(e)}getDefaultPosition(){return"top-left"}pickObject(e){return no(this._deck),this._deck.pickObject(e)}pickMultipleObjects(e){return no(this._deck),this._deck.pickMultipleObjects(e)}pickObjects(e){return no(this._deck),this._deck.pickObjects(e)}finalize(){this._map&&this._map.removeControl(this)}getCanvas(){return this._map?this._interleaved?this._map.getCanvas():this._deck.getCanvas():null}}const FZ=`struct LineUniforms {
  widthScale: f32,
  widthMinPixels: f32,
  widthMaxPixels: f32,
  useShortestPath: f32,
  widthUnits: i32,
};

@group(0) @binding(1)
var<uniform> line: LineUniforms;
`,DS=`uniform lineUniforms {
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  float useShortestPath;
  highp int widthUnits;
} line;
`,NZ={name:"line",source:FZ,vs:DS,fs:DS,uniformTypes:{widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",useShortestPath:"f32",widthUnits:"i32"}},BZ=`// ---------- Helper Structures & Functions ----------

// Placeholder filter functions.
fn deckgl_filter_size(offset: vec3<f32>, geometry: Geometry) -> vec3<f32> {
  return offset;
}
fn deckgl_filter_gl_position(p: vec4<f32>, geometry: Geometry) -> vec4<f32> {
  return p;
}
fn deckgl_filter_color(color: vec4<f32>, geometry: Geometry) -> vec4<f32> {
  return color;
}

// Compute an extrusion offset given a line direction (in clipspace),
// an offset direction (-1 or 1), and a width in pixels.
// Assumes a uniform "project" with a viewportSize field is available.
fn getExtrusionOffset(line_clipspace: vec2<f32>, offset_direction: f32, width: f32) -> vec2<f32> {
  // project.viewportSize should be provided as a uniform (not shown here)
  let dir_screenspace = normalize(line_clipspace * project.viewportSize);
  // Rotate by 90: (x,y) becomes (-y,x)
  let rotated = vec2<f32>(-dir_screenspace.y, dir_screenspace.x);
  return rotated * offset_direction * width / 2.0;
}

// Splits the line between two points at a given x coordinate.
// Interpolates the y and z components.
fn splitLine(a: vec3<f32>, b: vec3<f32>, x: f32) -> vec3<f32> {
  let t: f32 = (x - a.x) / (b.x - a.x);
  return vec3<f32>(x, a.yz + t * (b.yz - a.yz));
}

// ---------- Uniforms & Global Structures ----------

// Uniforms for line, color, and project are assumed to be defined elsewhere.
// For example:
//
// @group(0) @binding(0)
// var<uniform> line: LineUniform;
//
// struct ColorUniform {
//   opacity: f32,
// };
// @group(0) @binding(1)
// var<uniform> color: ColorUniform;
//
// struct ProjectUniform {
//   viewportSize: vec2<f32>,
// };
// @group(0) @binding(2)
// var<uniform> project: ProjectUniform;



// ---------- Vertex Output Structure ----------

struct Varyings {
  @builtin(position) gl_Position: vec4<f32>,
  @location(0) vColor: vec4<f32>,
  @location(1) uv: vec2<f32>,
};

// ---------- Vertex Shader Entry Point ----------

@vertex
fn vertexMain(
  @location(0) positions: vec3<f32>,
  @location(1) instanceSourcePositions: vec3<f32>,
  @location(2) instanceTargetPositions: vec3<f32>,
  @location(3) instanceSourcePositions64Low: vec3<f32>,
  @location(4) instanceTargetPositions64Low: vec3<f32>,
  @location(5) instanceColors: vec4<f32>,
  @location(6) instancePickingColors: vec3<f32>,
  @location(7) instanceWidths: f32
) -> Varyings {
  var geometry: Geometry;
  geometry.worldPosition = instanceSourcePositions;
  geometry.worldPositionAlt = instanceTargetPositions;

  var source_world: vec3<f32> = instanceSourcePositions;
  var target_world: vec3<f32> = instanceTargetPositions;
  var source_world_64low: vec3<f32> = instanceSourcePositions64Low;
  var target_world_64low: vec3<f32> = instanceTargetPositions64Low;

  // Apply shortest-path adjustments if needed.
  if (line.useShortestPath > 0.5 || line.useShortestPath < -0.5) {
    source_world.x = (source_world.x + 180.0 % 360.0) - 180.0;
    target_world.x = (target_world.x + 180.0 % 360.0) - 180.0;
    let deltaLng: f32 = target_world.x - source_world.x;

    if (deltaLng * line.useShortestPath > 180.0) {
      source_world.x = source_world.x + 360.0 * line.useShortestPath;
      source_world = splitLine(source_world, target_world, 180.0 * line.useShortestPath);
      source_world_64low = vec3<f32>(0.0, 0.0, 0.0);
    } else if (deltaLng * line.useShortestPath < -180.0) {
      target_world.x = target_world.x + 360.0 * line.useShortestPath;
      target_world = splitLine(source_world, target_world, 180.0 * line.useShortestPath);
      target_world_64low = vec3<f32>(0.0, 0.0, 0.0);
    } else if (line.useShortestPath < 0.0) {
      var abortOut: Varyings;
      abortOut.gl_Position = vec4<f32>(0.0);
      abortOut.vColor = vec4<f32>(0.0);
      abortOut.uv = vec2<f32>(0.0);
      return abortOut;
    }
  }

  // Project Pos and target positions to clip space.
  let sourceResult = project_position_to_clipspace_and_commonspace(source_world, source_world_64low, vec3<f32>(0.0));
  let targetResult = project_position_to_clipspace_and_commonspace(target_world, target_world_64low, vec3<f32>(0.0));
  let sourcePos: vec4<f32> = sourceResult.clipPosition;
  let targetPos: vec4<f32> = targetResult.clipPosition;
  let source_commonspace: vec4<f32> = sourceResult.commonPosition;
  let target_commonspace: vec4<f32> = targetResult.commonPosition;

  // Interpolate along the line segment.
  let segmentIndex: f32 = positions.x;
  let p: vec4<f32> = sourcePos + segmentIndex * (targetPos - sourcePos);
  geometry.position = source_commonspace + segmentIndex * (target_commonspace - source_commonspace);
  let uv: vec2<f32> = positions.xy;
  geometry.uv = uv;
  geometry.pickingColor = instancePickingColors;

  // Determine width in pixels.
  let widthPixels: f32 = clamp(
    project_unit_size_to_pixel(instanceWidths * line.widthScale, line.widthUnits),
    line.widthMinPixels, line.widthMaxPixels
  );

  // Compute extrusion offset.
  let extrusion: vec2<f32> = getExtrusionOffset(targetPos.xy - sourcePos.xy, positions.y, widthPixels);
  let offset: vec3<f32> = vec3<f32>(extrusion, 0.0);

  // Apply deck.gl filter functions.
  let filteredOffset = deckgl_filter_size(offset, geometry);
  let filteredP = deckgl_filter_gl_position(p, geometry);

  let clipOffset: vec2<f32> = project_pixel_size_to_clipspace(filteredOffset.xy);
  let finalPosition: vec4<f32> = filteredP + vec4<f32>(clipOffset, 0.0, 0.0);

  // Compute color.
  var vColor: vec4<f32> = vec4<f32>(instanceColors.rgb, instanceColors.a * color.opacity);
  // vColor = deckgl_filter_color(vColor, geometry);

  var output: Varyings;
  output.gl_Position = finalPosition;
  output.vColor = vColor;
  output.uv = uv;
  return output;
}

@fragment
fn fragmentMain(
  @location(0) vColor: vec4<f32>,
  @location(1) uv: vec2<f32>
) -> @location(0) vec4<f32> {
  // Create and initialize geometry with the provided uv.
  var geometry: Geometry;
  geometry.uv = uv;

  // Start with the input color.
  var fragColor: vec4<f32> = vColor;

  // Apply the deck.gl filter to the color.
  fragColor = deckgl_filter_color(fragColor, geometry);

  // Apply premultiplied alpha as required by transparent canvas
  fragColor = deckgl_premultiplied_alpha(fragColor);

  return fragColor;
}
`,zZ=`#version 300 es
#define SHADER_NAME line-layer-vertex-shader
in vec3 positions;
in vec3 instanceSourcePositions;
in vec3 instanceTargetPositions;
in vec3 instanceSourcePositions64Low;
in vec3 instanceTargetPositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in float instanceWidths;
out vec4 vColor;
out vec2 uv;
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
vec2 dir_screenspace = normalize(line_clipspace * project.viewportSize);
dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
return dir_screenspace * offset_direction * width / 2.0;
}
vec3 splitLine(vec3 a, vec3 b, float x) {
float t = (x - a.x) / (b.x - a.x);
return vec3(x, mix(a.yz, b.yz, t));
}
void main(void) {
geometry.worldPosition = instanceSourcePositions;
geometry.worldPositionAlt = instanceTargetPositions;
vec3 source_world = instanceSourcePositions;
vec3 target_world = instanceTargetPositions;
vec3 source_world_64low = instanceSourcePositions64Low;
vec3 target_world_64low = instanceTargetPositions64Low;
if (line.useShortestPath > 0.5 || line.useShortestPath < -0.5) {
source_world.x = mod(source_world.x + 180., 360.0) - 180.;
target_world.x = mod(target_world.x + 180., 360.0) - 180.;
float deltaLng = target_world.x - source_world.x;
if (deltaLng * line.useShortestPath > 180.) {
source_world.x += 360. * line.useShortestPath;
source_world = splitLine(source_world, target_world, 180. * line.useShortestPath);
source_world_64low = vec3(0.0);
} else if (deltaLng * line.useShortestPath < -180.) {
target_world.x += 360. * line.useShortestPath;
target_world = splitLine(source_world, target_world, 180. * line.useShortestPath);
target_world_64low = vec3(0.0);
} else if (line.useShortestPath < 0.) {
gl_Position = vec4(0.);
return;
}
}
vec4 source_commonspace;
vec4 target_commonspace;
vec4 source = project_position_to_clipspace(source_world, source_world_64low, vec3(0.), source_commonspace);
vec4 target = project_position_to_clipspace(target_world, target_world_64low, vec3(0.), target_commonspace);
float segmentIndex = positions.x;
vec4 p = mix(source, target, segmentIndex);
geometry.position = mix(source_commonspace, target_commonspace, segmentIndex);
uv = positions.xy;
geometry.uv = uv;
geometry.pickingColor = instancePickingColors;
float widthPixels = clamp(
project_size_to_pixel(instanceWidths * line.widthScale, line.widthUnits),
line.widthMinPixels, line.widthMaxPixels
);
vec3 offset = vec3(
getExtrusionOffset(target.xy - source.xy, positions.y, widthPixels),
0.0);
DECKGL_FILTER_SIZE(offset, geometry);
DECKGL_FILTER_GL_POSITION(p, geometry);
gl_Position = p + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
vColor = vec4(instanceColors.rgb, instanceColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,LZ=`#version 300 es
#define SHADER_NAME line-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,UZ=[0,0,0,255],VZ={getSourcePosition:{type:"accessor",value:i=>i.sourcePosition},getTargetPosition:{type:"accessor",value:i=>i.targetPosition},getColor:{type:"accessor",value:UZ},getWidth:{type:"accessor",value:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}};class u3 extends F1{getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["instanceSourcePositions","instanceTargetPositions"])}getShaders(){return super.getShaders({vs:zZ,fs:LZ,source:BZ,modules:[Vw,Lw,Zw,NZ]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1}})}updateState(e){var t;super.updateState(e),e.changeFlags.extensionsChanged&&((t=this.state.model)==null||t.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{widthUnits:t,widthScale:r,widthMinPixels:o,widthMaxPixels:p,wrapLongitude:_}=this.props,l=this.state.model,M={widthUnits:Jg[t],widthScale:r,widthMinPixels:o,widthMaxPixels:p,useShortestPath:_?1:0};l.shaderInputs.setProps({line:M}),l.draw(this.context.renderPass),_&&(l.shaderInputs.setProps({line:{...M,useShortestPath:-1}}),l.draw(this.context.renderPass))}_getModel(){const e=this.context.device.type==="webgpu"?{depthWriteEnabled:!0,depthCompare:"less-equal"}:void 0,t=[0,-1,0,0,1,0,1,-1,0,1,1,0];return new Qg(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Hw({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(t)}}}),parameters:e,isInstanced:!0})}}u3.layerName="LineLayer";u3.defaultProps=VZ;const jZ=`struct PointCloudUniforms {
  radiusPixels: f32,
  sizeUnits: i32,
};

@group(0) @binding(3)
var<uniform> pointCloud: PointCloudUniforms;
`,OS=`uniform pointCloudUniforms {
  float radiusPixels;
  highp int sizeUnits;
} pointCloud;
`,GZ={name:"pointCloud",source:jZ,vs:OS,fs:OS,uniformTypes:{radiusPixels:"f32",sizeUnits:"i32"}},WZ=`#version 300 es
#define SHADER_NAME point-cloud-layer-vertex-shader
in vec3 positions;
in vec3 instanceNormals;
in vec4 instanceColors;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec3 instancePickingColors;
out vec4 vColor;
out vec2 unitPosition;
void main(void) {
geometry.worldPosition = instancePositions;
geometry.normal = project_normal(instanceNormals);
unitPosition = positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
vec3 offset = vec3(positions.xy * project_size_to_pixel(pointCloud.radiusPixels, pointCloud.sizeUnits), 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, instanceColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,ZZ=`#version 300 es
#define SHADER_NAME point-cloud-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 unitPosition;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition.xy;
float distToCenter = length(unitPosition);
if (distToCenter > 1.0) {
discard;
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,XZ=`struct ConstantAttributes {
  instanceNormals: vec3<f32>,
  instanceColors: vec4<f32>,
  instancePositions: vec3<f32>,
  instancePositions64Low: vec3<f32>,
  instancePickingColors: vec3<f32>
};

const constants = ConstantAttributes(
  vec3<f32>(1.0, 0.0, 0.0),
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec3<f32>(0.0),
  vec3<f32>(0.0),
  vec3<f32>(0.0)
);

struct Attributes {
  @builtin(instance_index) instanceIndex : u32,
  @builtin(vertex_index) vertexIndex : u32,
  @location(0) positions: vec3<f32>,
  @location(1) instancePositions: vec3<f32>,
  @location(2) instancePositions64Low: vec3<f32>,
  @location(3) instanceNormals: vec3<f32>,
  @location(4) instanceColors: vec4<f32>,
  @location(5) instancePickingColors: vec3<f32>
};

struct Varyings {
  @builtin(position) position: vec4<f32>,
  @location(0) vColor: vec4<f32>,
  @location(1) unitPosition: vec2<f32>,
};

@vertex
fn vertexMain(attributes: Attributes) -> Varyings {
  var varyings: Varyings;
  
  // var geometry: Geometry;
  // geometry.worldPosition = instancePositions;
  // geometry.normal = project_normal(instanceNormals);

  // position on the containing square in [-1, 1] space
  varyings.unitPosition = attributes.positions.xy;
  geometry.uv = varyings.unitPosition;
  geometry.pickingColor = attributes.instancePickingColors;

  // Find the center of the point and add the current vertex
  let offset = vec3<f32>(attributes.positions.xy * project_unit_size_to_pixel(pointCloud.radiusPixels, pointCloud.sizeUnits), 0.0);
  // DECKGL_FILTER_SIZE(offset, geometry);

  varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, vec3<f32>(0.0)); // TODO , geometry.position);
  // DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  let clipPixels = project_pixel_size_to_clipspace(offset.xy);
  varyings.position.x += clipPixels.x;
  varyings.position.y += clipPixels.y;

  // Apply lighting
  let lightColor = lighting_getLightColor2(attributes.instanceColors.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);

  // Apply opacity to instance color, or return instance picking color
  varyings.vColor = vec4(lightColor, attributes.instanceColors.a * color.opacity);
  // DECKGL_FILTER_COLOR(vColor, geometry);

  return varyings;
}

@fragment
fn fragmentMain(varyings: Varyings) -> @location(0) vec4<f32> {
  // var geometry: Geometry;
  // geometry.uv = unitPosition.xy;

  let distToCenter = length(varyings.unitPosition);
  if (distToCenter > 1.0) {
    discard;
  }

  var fragColor: vec4<f32>;

  fragColor = varyings.vColor;
  // DECKGL_FILTER_COLOR(fragColor, geometry);

  // Apply premultiplied alpha as required by transparent canvas
  fragColor = deckgl_premultiplied_alpha(fragColor);

  return fragColor;
}
`,RR=[0,0,0,255],CR=[0,0,1],HZ={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:i=>i.position},getNormal:{type:"accessor",value:CR},getColor:{type:"accessor",value:RR},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};function $Z(i){const{header:e,attributes:t}=i;if(!(!e||!t)&&(i.length=e.vertexCount,t.POSITION&&(t.instancePositions=t.POSITION),t.NORMAL&&(t.instanceNormals=t.NORMAL),t.COLOR_0)){const{size:r,value:o}=t.COLOR_0;t.instanceColors={size:r,type:"unorm8",value:o}}}class h3 extends F1{getShaders(){return super.getShaders({vs:WZ,fs:ZZ,source:XZ,modules:[Vw,Lw,CM,Zw,GZ]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:CR},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:RR}})}updateState(e){var o;const{changeFlags:t,props:r}=e;super.updateState(e),t.extensionsChanged&&((o=this.state.model)==null||o.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll()),t.dataChanged&&$Z(r.data)}draw({uniforms:e}){const{pointSize:t,sizeUnits:r}=this.props,o=this.state.model,p={sizeUnits:Jg[r],radiusPixels:t};o.shaderInputs.setProps({pointCloud:p}),this.context.device.type==="webgpu"&&(o.instanceCount=this.props.data.length),o.draw(this.context.renderPass)}_getModel(){const e=this.context.device.type==="webgpu"?{depthWriteEnabled:!0,depthCompare:"less-equal"}:void 0,t=[];for(let r=0;r<3;r++){const o=r/3*Math.PI*2;t.push(Math.cos(o)*2,Math.sin(o)*2,0)}return new Qg(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Hw({topology:"triangle-list",attributes:{positions:new Float32Array(t)}}),parameters:e,isInstanced:!0})}}h3.layerName="PointCloudLayer";h3.defaultProps=HZ;const FS=`uniform scatterplotUniforms {
  float radiusScale;
  float radiusMinPixels;
  float radiusMaxPixels;
  float lineWidthScale;
  float lineWidthMinPixels;
  float lineWidthMaxPixels;
  float stroked;
  float filled;
  bool antialiasing;
  bool billboard;
  highp int radiusUnits;
  highp int lineWidthUnits;
} scatterplot;
`,qZ={name:"scatterplot",vs:FS,fs:FS,source:"",uniformTypes:{radiusScale:"f32",radiusMinPixels:"f32",radiusMaxPixels:"f32",lineWidthScale:"f32",lineWidthMinPixels:"f32",lineWidthMaxPixels:"f32",stroked:"f32",filled:"f32",antialiasing:"f32",billboard:"f32",radiusUnits:"i32",lineWidthUnits:"i32"}},YZ=`#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(scatterplot.radiusScale * instanceRadius, scatterplot.radiusUnits),
scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(scatterplot.lineWidthScale * instanceLineWidths, scatterplot.lineWidthUnits),
scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
);
outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
float edgePadding = scatterplot.antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / outerRadiusPixels;
if (scatterplot.billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,JZ=`#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = scatterplot.antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (scatterplot.stroked > 0.5) {
float isLine = scatterplot.antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (scatterplot.filled > 0.5) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (scatterplot.filled < 0.5) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,QZ=`// Main shaders

struct ScatterplotUniforms {
  radiusScale: f32,
  radiusMinPixels: f32,
  radiusMaxPixels: f32,
  lineWidthScale: f32,
  lineWidthMinPixels: f32,
  lineWidthMaxPixels: f32,
  stroked: f32,
  filled: i32,
  antialiasing: i32,
  billboard: i32,
  radiusUnits: i32,
  lineWidthUnits: i32,
};

struct ConstantAttributeUniforms {
 instancePositions: vec3<f32>,
 instancePositions64Low: vec3<f32>,
 instanceRadius: f32,
 instanceLineWidths: f32,
 instanceFillColors: vec4<f32>,
 instanceLineColors: vec4<f32>,
 instancePickingColors: vec3<f32>,

 instancePositionsConstant: i32,
 instancePositions64LowConstant: i32,
 instanceRadiusConstant: i32,
 instanceLineWidthsConstant: i32,
 instanceFillColorsConstant: i32,
 instanceLineColorsConstant: i32,
 instancePickingColorsConstant: i32
};

@group(0) @binding(2) var<uniform> scatterplot: ScatterplotUniforms;

struct ConstantAttributes {
  instancePositions: vec3<f32>,
  instancePositions64Low: vec3<f32>,
  instanceRadius: f32,
  instanceLineWidths: f32,
  instanceFillColors: vec4<f32>,
  instanceLineColors: vec4<f32>,
  instancePickingColors: vec3<f32>
};

const constants = ConstantAttributes(
  vec3<f32>(0.0),
  vec3<f32>(0.0),
  0.0,
  0.0,
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec3<f32>(0.0)
);

struct Attributes {
  @builtin(instance_index) instanceIndex : u32,
  @builtin(vertex_index) vertexIndex : u32,
  @location(0) positions: vec3<f32>,
  @location(1) instancePositions: vec3<f32>,
  @location(2) instancePositions64Low: vec3<f32>,
  @location(3) instanceRadius: f32,
  @location(4) instanceLineWidths: f32,
  @location(5) instanceFillColors: vec4<f32>,
  @location(6) instanceLineColors: vec4<f32>,
  @location(7) instancePickingColors: vec3<f32>
};

struct Varyings {
  @builtin(position) position: vec4<f32>,
  @location(0) vFillColor: vec4<f32>,
  @location(1) vLineColor: vec4<f32>,
  @location(2) unitPosition: vec2<f32>,
  @location(3) innerUnitRadius: f32,
  @location(4) outerRadiusPixels: f32,
};

@vertex
fn vertexMain(attributes: Attributes) -> Varyings {
  var varyings: Varyings;

  // Draw an inline geometry constant array clip space triangle to verify that rendering works.
  // var positions = array<vec2<f32>, 3>(vec2(0.0, 0.5), vec2(-0.5, -0.5), vec2(0.5, -0.5));
  // if (attributes.instanceIndex == 0) {
  //   varyings.position = vec4<f32>(positions[attributes.vertexIndex], 0.0, 1.0);
  //   return varyings;
  // }

  // var geometry: Geometry;
  // geometry.worldPosition = instancePositions;

  // Multiply out radius and clamp to limits
  varyings.outerRadiusPixels = clamp(
    project_unit_size_to_pixel(scatterplot.radiusScale * attributes.instanceRadius, scatterplot.radiusUnits),
    scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
  );

  // Multiply out line width and clamp to limits
  let lineWidthPixels = clamp(
    project_unit_size_to_pixel(scatterplot.lineWidthScale * attributes.instanceLineWidths, scatterplot.lineWidthUnits),
    scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
  );

  // outer radius needs to offset by half stroke width
  varyings.outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
  // Expand geometry to accommodate edge smoothing
  let edgePadding = select(
    (varyings.outerRadiusPixels + SMOOTH_EDGE_RADIUS) / varyings.outerRadiusPixels,
    1.0,
    scatterplot.antialiasing != 0
  );

  // position on the containing square in [-1, 1] space
  varyings.unitPosition = edgePadding * attributes.positions.xy;
  geometry.uv = varyings.unitPosition;
  geometry.pickingColor = attributes.instancePickingColors;

  varyings.innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / varyings.outerRadiusPixels;

  if (scatterplot.billboard != 0) {
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, vec3<f32>(0.0)); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
    let offset = attributes.positions; // * edgePadding * varyings.outerRadiusPixels;
    // DECKGL_FILTER_SIZE(offset, geometry);
    let clipPixels = project_pixel_size_to_clipspace(offset.xy);
    varyings.position.x = clipPixels.x;
    varyings.position.y = clipPixels.y;
  } else {
    let offset = edgePadding * attributes.positions * project_pixel_size_float(varyings.outerRadiusPixels);
    // DECKGL_FILTER_SIZE(offset, geometry);
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, offset); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
  }

  // Apply opacity to instance color, or return instance picking color
  varyings.vFillColor = vec4<f32>(attributes.instanceFillColors.rgb, attributes.instanceFillColors.a * color.opacity);
  // DECKGL_FILTER_COLOR(varyings.vFillColor, geometry);
  varyings.vLineColor = vec4<f32>(attributes.instanceLineColors.rgb, attributes.instanceLineColors.a * color.opacity);
  // DECKGL_FILTER_COLOR(varyings.vLineColor, geometry);

  return varyings;
}

@fragment
fn fragmentMain(varyings: Varyings) -> @location(0) vec4<f32> {
  // var geometry: Geometry;
  // geometry.uv = unitPosition;

  let distToCenter = length(varyings.unitPosition) * varyings.outerRadiusPixels;
  let inCircle = select(
    smoothedge(distToCenter, varyings.outerRadiusPixels),
    step(distToCenter, varyings.outerRadiusPixels),
    scatterplot.antialiasing != 0
  );

  if (inCircle == 0.0) {
    discard;
  }

  var fragColor: vec4<f32>;

  if (scatterplot.stroked != 0) {
    let isLine = select(
      smoothedge(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      step(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      scatterplot.antialiasing != 0
    );

    if (scatterplot.filled != 0) {
      fragColor = mix(varyings.vFillColor, varyings.vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        discard;
      }
      fragColor = vec4<f32>(varyings.vLineColor.rgb, varyings.vLineColor.a * isLine);
    }
  } else if (scatterplot.filled == 0) {
    discard;
  } else {
    fragColor = varyings.vFillColor;
  }

  fragColor.a *= inCircle;
  // DECKGL_FILTER_COLOR(fragColor, geometry);

  // Apply premultiplied alpha as required by transparent canvas
  fragColor = deckgl_premultiplied_alpha(fragColor);

  return fragColor;
  // return vec4<f32>(0, 0, 1, 1);
}
`,NS=[0,0,0,255],KZ={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:i=>i.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:NS},getLineColor:{type:"accessor",value:NS},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class gx extends F1{getShaders(){return super.getShaders({vs:YZ,fs:JZ,source:QZ,modules:[Vw,Lw,Zw,qZ]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){var t;super.updateState(e),e.changeFlags.extensionsChanged&&((t=this.state.model)==null||t.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{radiusUnits:t,radiusScale:r,radiusMinPixels:o,radiusMaxPixels:p,stroked:_,filled:l,billboard:M,antialiasing:D,lineWidthUnits:B,lineWidthScale:j,lineWidthMinPixels:$,lineWidthMaxPixels:se}=this.props,de={stroked:_,filled:l,billboard:M,antialiasing:D,radiusUnits:Jg[t],radiusScale:r,radiusMinPixels:o,radiusMaxPixels:p,lineWidthUnits:Jg[B],lineWidthScale:j,lineWidthMinPixels:$,lineWidthMaxPixels:se},Ae=this.state.model;Ae.shaderInputs.setProps({scatterplot:de}),this.context.device.type==="webgpu"&&(Ae.instanceCount=this.props.data.length),Ae.draw(this.context.renderPass)}_getModel(){const e=this.context.device.type==="webgpu"?{depthWriteEnabled:!0,depthCompare:"less-equal"}:void 0,t=[-1,-1,0,1,-1,0,-1,1,0,1,1,0];return new Qg(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Hw({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(t)}}}),isInstanced:!0,parameters:e})}}gx.defaultProps=KZ;gx.layerName="ScatterplotLayer";const PR=`uniform dataFilterUniforms {
  bool useSoftMargin;
  bool enabled;
  bool transformSize;
  bool transformColor;
#ifdef DATAFILTER_TYPE
  DATAFILTER_TYPE min;
  DATAFILTER_TYPE softMin;
  DATAFILTER_TYPE softMax;
  DATAFILTER_TYPE max;
#ifdef DATAFILTER_DOUBLE
  DATAFILTER_TYPE min64High;
  DATAFILTER_TYPE max64High;
#endif
#endif
#ifdef DATACATEGORY_TYPE
  highp uvec4 categoryBitMask;
#endif
} dataFilter;
`,eX=`
#ifdef DATAFILTER_TYPE
  in DATAFILTER_TYPE filterValues;
#ifdef DATAFILTER_DOUBLE
  in DATAFILTER_TYPE filterValues64Low;
#endif
#endif

#ifdef DATACATEGORY_TYPE
  in DATACATEGORY_TYPE filterCategoryValues;
#endif

out float dataFilter_value;

float dataFilter_reduceValue(float value) {
  return value;
}
float dataFilter_reduceValue(vec2 value) {
  return min(value.x, value.y);
}
float dataFilter_reduceValue(vec3 value) {
  return min(min(value.x, value.y), value.z);
}
float dataFilter_reduceValue(vec4 value) {
  return min(min(value.x, value.y), min(value.z, value.w));
}

#ifdef DATAFILTER_TYPE
  void dataFilter_setValue(DATAFILTER_TYPE valueFromMin, DATAFILTER_TYPE valueFromMax) {
    if (dataFilter.useSoftMargin) {
      // smoothstep results are undefined if edge0  edge1
      // Fallback to ignore filterSoftRange if it is truncated by filterRange
      DATAFILTER_TYPE leftInRange = mix(
        smoothstep(dataFilter.min, dataFilter.softMin, valueFromMin),
        step(dataFilter.min, valueFromMin),
        step(dataFilter.softMin, dataFilter.min)
      );
      DATAFILTER_TYPE rightInRange = mix(
        1.0 - smoothstep(dataFilter.softMax, dataFilter.max, valueFromMax),
        step(valueFromMax, dataFilter.max),
        step(dataFilter.max, dataFilter.softMax)
      );
      dataFilter_value = dataFilter_reduceValue(leftInRange * rightInRange);
    } else {
      dataFilter_value = dataFilter_reduceValue(
        step(dataFilter.min, valueFromMin) * step(valueFromMax, dataFilter.max)
      );
    }
  }
#endif

#ifdef DATACATEGORY_TYPE
  void dataFilter_setCategoryValue(DATACATEGORY_TYPE category) {
    #if DATACATEGORY_CHANNELS == 1 // One 128-bit mask
    uint dataFilter_masks = dataFilter.categoryBitMask[category / 32u];
    #elif DATACATEGORY_CHANNELS == 2 // Two 64-bit masks
    uvec2 dataFilter_masks = uvec2(
      dataFilter.categoryBitMask[category.x / 32u],
      dataFilter.categoryBitMask[category.y / 32u + 2u]
    );
    #elif DATACATEGORY_CHANNELS == 3 // Three 32-bit masks
    uvec3 dataFilter_masks = dataFilter.categoryBitMask.xyz;
    #else // Four 32-bit masks
    uvec4 dataFilter_masks = dataFilter.categoryBitMask;
    #endif

    // Shift mask and extract relevant bits
    DATACATEGORY_TYPE dataFilter_bits = DATACATEGORY_TYPE(dataFilter_masks) >> (category & 31u);
    dataFilter_bits &= 1u;

    #if DATACATEGORY_CHANNELS == 1
    if(dataFilter_bits == 0u) dataFilter_value = 0.0;
    #else
    if(any(equal(dataFilter_bits, DATACATEGORY_TYPE(0u)))) dataFilter_value = 0.0;
    #endif
  }
#endif
`,IR=`
${PR}
${eX}
`,tX=`
in float dataFilter_value;
`,kR=`
${PR}
${tX}
`;function DR(i){if(!i||!("extensions"in i))return{};const{filterRange:e=[-1,1],filterEnabled:t=!0,filterTransformSize:r=!0,filterTransformColor:o=!0,categoryBitMask:p}=i,_=i.filterSoftRange||e;return{...Number.isFinite(e[0])?{min:e[0],softMin:_[0],softMax:_[1],max:e[1]}:{min:e.map(l=>l[0]),softMin:_.map(l=>l[0]),softMax:_.map(l=>l[1]),max:e.map(l=>l[1])},enabled:t,useSoftMargin:!!i.filterSoftRange,transformSize:t&&r,transformColor:t&&o,...p&&{categoryBitMask:p}}}function iX(i){if(!i||!("extensions"in i))return{};const e=DR(i);if(Number.isFinite(e.min)){const t=Math.fround(e.min);e.min-=t,e.softMin-=t,e.min64High=t;const r=Math.fround(e.max);e.max-=r,e.softMax-=r,e.max64High=r}else{const t=e.min.map(Math.fround);e.min=e.min.map((o,p)=>o-t[p]),e.softMin=e.softMin.map((o,p)=>o-t[p]),e.min64High=t;const r=e.max.map(Math.fround);e.max=e.max.map((o,p)=>o-r[p]),e.softMax=e.softMax.map((o,p)=>o-r[p]),e.max64High=r}return e}const OR={"vs:#main-start":`
    dataFilter_value = 1.0;
    if (dataFilter.enabled) {
      #ifdef DATAFILTER_TYPE
        #ifdef DATAFILTER_DOUBLE
          dataFilter_setValue(
            filterValues - dataFilter.min64High + filterValues64Low,
            filterValues - dataFilter.max64High + filterValues64Low
          );
        #else
          dataFilter_setValue(filterValues, filterValues);
        #endif
      #endif

      #ifdef DATACATEGORY_TYPE
        dataFilter_setCategoryValue(filterCategoryValues);
      #endif
    }
  `,"vs:#main-end":`
    if (dataFilter_value == 0.0) {
      gl_Position = vec4(0.);
    }
  `,"vs:DECKGL_FILTER_SIZE":`
    if (dataFilter.transformSize) {
      size = size * dataFilter_value;
    }
  `,"fs:DECKGL_FILTER_COLOR":`
    if (dataFilter_value == 0.0) discard;
    if (dataFilter.transformColor) {
      color.a *= dataFilter_value;
    }
  `};function FR(i){const{categorySize:e,filterSize:t,fp64:r}=i,o={useSoftMargin:"i32",enabled:"i32",transformSize:"i32",transformColor:"i32"};if(t){const p=t===1?"f32":`vec${t}<f32>`;o.min=p,o.softMin=p,o.softMax=p,o.max=p,r&&(o.min64High=p,o.max64High=p)}return e&&(o.categoryBitMask="vec4<i32>"),o}const nX={name:"dataFilter",vs:IR,fs:kR,inject:OR,getUniforms:DR,uniformTypesFromOptions:FR},rX={name:"dataFilter",vs:IR,fs:kR,inject:OR,getUniforms:iX,uniformTypesFromOptions:FR},sX=`#version 300 es
#define SHADER_NAME data-filter-vertex-shader

#ifdef FLOAT_TARGET
  in float filterIndices;
  in float filterPrevIndices;
#else
  in vec2 filterIndices;
  in vec2 filterPrevIndices;
#endif

out vec4 vColor;
const float component = 1.0 / 255.0;

void main() {
  #ifdef FLOAT_TARGET
    dataFilter_value *= float(filterIndices != filterPrevIndices);
    gl_Position = vec4(0.0, 0.0, 0.0, 1.0);
    vColor = vec4(0.0, 0.0, 0.0, 1.0);
  #else
    // Float texture is not supported: pack result into 4 channels x 256 px x 64px
    dataFilter_value *= float(filterIndices.x != filterPrevIndices.x);
    float col = filterIndices.x;
    float row = filterIndices.y * 4.0;
    float channel = floor(row);
    row = fract(row);
    vColor = component * vec4(bvec4(channel == 0.0, channel == 1.0, channel == 2.0, channel == 3.0));
    gl_Position = vec4(col * 2.0 - 1.0, row * 2.0 - 1.0, 0.0, 1.0);
  #endif
  gl_PointSize = 1.0;
}
`,aX=`#version 300 es
#define SHADER_NAME data-filter-fragment-shader
precision highp float;

in vec4 vColor;

out vec4 fragColor;

void main() {
  if (dataFilter_value < 0.5) {
    discard;
  }
  fragColor = vColor;
}
`,oX=["float32-renderable-webgl","texture-blend-float-webgl"];function lX(i){return oX.every(e=>i.features.has(e))}function cX(i,e){return e?i.createFramebuffer({width:1,height:1,colorAttachments:[i.createTexture({format:"rgba32float",dimension:"2d",width:1,height:1})]}):i.createFramebuffer({width:256,height:64,colorAttachments:[i.createTexture({format:"rgba8unorm",dimension:"2d",width:256,height:64})]})}function uX(i,e,t,r){return t.defines.NON_INSTANCED_MODEL=1,r&&(t.defines.FLOAT_TARGET=1),new Qg(i,{id:"data-filter-aggregation-model",vertexCount:1,isInstanced:!1,topology:"point-list",disableWarnings:!0,vs:sX,fs:aX,bufferLayout:e,...t})}const hX={blend:!0,blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one",blendColorOperation:"add",blendAlphaOperation:"add",depthCompare:"never"},fX={getFilterValue:{type:"accessor",value:0},getFilterCategory:{type:"accessor",value:0},onFilteredItemsChange:{type:"function",value:null,optional:!0},filterEnabled:!0,filterRange:[-1,1],filterSoftRange:null,filterCategories:[0],filterTransformSize:!0,filterTransformColor:!0},dX={categorySize:0,filterSize:1,fp64:!1,countItems:!1},pX={1:"uint",2:"uvec2",3:"uvec3",4:"uvec4"},gX={1:"float",2:"vec2",3:"vec3",4:"vec4"};class f3 extends s3{constructor(e={}){super({...dX,...e})}getShaders(e){const{categorySize:t,filterSize:r,fp64:o}=e.opts,p={};t&&(p.DATACATEGORY_TYPE=pX[t],p.DATACATEGORY_CHANNELS=t),r&&(p.DATAFILTER_TYPE=gX[r],p.DATAFILTER_DOUBLE=!!o);const _=o?rX:nX;return _.uniformTypes=_.uniformTypesFromOptions(e.opts),{modules:[_],defines:p}}initializeState(e,t){const r=this.getAttributeManager(),{categorySize:o,filterSize:p,fp64:_}=t.opts;r&&(p&&r.add({filterValues:{size:p,type:_?"float64":"float32",stepMode:"dynamic",accessor:"getFilterValue"}}),o&&r.add({filterCategoryValues:{size:o,stepMode:"dynamic",accessor:"getFilterCategory",type:"uint32",transform:o===1?M=>t._getCategoryKey.call(this,M,0):M=>M.map((D,B)=>t._getCategoryKey.call(this,D,B))}}));const{device:l}=this.context;if(r&&t.opts.countItems){const M=lX(l);r.add({filterVertexIndices:{size:M?1:2,vertexOffset:1,type:"unorm8",accessor:(j,{index:$})=>{const se=j&&j.__source?j.__source.index:$;return M?(se+1)%255:[(se+1)%255,Math.floor(se/255)%255]},shaderAttributes:{filterPrevIndices:{vertexOffset:0},filterIndices:{vertexOffset:1}}}});const D=cX(l,M),B=uX(l,r.getBufferLayouts({isInstanced:!1}),t.getShaders.call(this,t),M);this.setState({filterFBO:D,filterModel:B})}}updateState({props:e,oldProps:t,changeFlags:r},o){var l,M;const p=this.getAttributeManager(),{categorySize:_}=o.opts;if(this.state.filterModel){const D=((l=p.attributes.filterValues)==null?void 0:l.needsUpdate())||((M=p.attributes.filterCategoryValues)==null?void 0:M.needsUpdate())||e.filterEnabled!==t.filterEnabled||e.filterRange!==t.filterRange||e.filterSoftRange!==t.filterSoftRange||e.filterCategories!==t.filterCategories;D&&this.setState({filterNeedsUpdate:D})}p!=null&&p.attributes.filterCategoryValues&&((p.attributes.filterCategoryValues.needsUpdate()||!cu(e.filterCategories,t.filterCategories,2))&&this.setState({categoryBitMask:null}),r.dataChanged&&(this.setState({categoryMap:Array(_).fill(0).map(()=>({}))}),p.attributes.filterCategoryValues.setNeedsUpdate("categoryMap")))}draw(e,t){const r=this.state.filterFBO,o=this.state.filterModel,p=this.state.filterNeedsUpdate;this.state.categoryBitMask||t._updateCategoryBitMask.call(this,e,t);const{onFilteredItemsChange:_,extensions:l,filterEnabled:M,filterRange:D,filterSoftRange:B,filterTransformSize:j,filterTransformColor:$,filterCategories:se}=this.props,de={extensions:l,filterEnabled:M,filterRange:D,filterSoftRange:B,filterTransformSize:j,filterTransformColor:$,filterCategories:se};if(this.state.categoryBitMask&&(de.categoryBitMask=this.state.categoryBitMask),this.setShaderModuleProps({dataFilter:de}),p&&_&&o){const Ae=this.getAttributeManager(),{attributes:{filterValues:he,filterCategoryValues:Le,filterVertexIndices:$e}}=Ae;o.setVertexCount(this.getNumInstances());const Be={...he==null?void 0:he.getValue(),...Le==null?void 0:Le.getValue(),...$e==null?void 0:$e.getValue()};o.setAttributes(Be),o.shaderInputs.setProps({dataFilter:de});const Je=[0,0,r.width,r.height],Rt=o.device.beginRenderPass({id:"data-filter-aggregation",framebuffer:r,parameters:{viewport:Je},clearColor:[0,0,0,0]});o.setParameters(hX),o.draw(Rt),Rt.end();const Et=o.device.readPixelsToArrayWebGL(r);let kt=0;for(let Ht=0;Ht<Et.length;Ht++)kt+=Et[Ht];_({id:this.id,count:kt}),this.state.filterNeedsUpdate=!1}}finalizeState(){const e=this.state.filterFBO,t=this.state.filterModel;e==null||e.destroy(),t==null||t.destroy()}_updateCategoryBitMask(e,t){const{categorySize:r}=t.opts;if(!r)return;const{filterCategories:o}=this.props,p=new Uint32Array([0,0,0,0]),_=r===1?[o]:o,l=r===1?128:r===2?64:32;for(let M=0;M<_.length;M++){const D=_[M];for(const B of D){const j=t._getCategoryKey.call(this,B,M);if(j<l){const $=M*(l/32)+Math.floor(j/32);p[$]+=Math.pow(2,j%32)}else Wr.warn(`Exceeded maximum number of categories (${l})`)()}}this.state.categoryBitMask=p}_getCategoryKey(e,t){const r=this.state.categoryMap[t];return e in r||(r[e]=Object.keys(r).length),r[e]}}f3.defaultProps=fX;f3.extensionName="DataFilterExtension";const NR={viridis:[[0,68,1,84],[.1,72,35,116],[.2,64,67,135],[.3,52,94,141],[.4,41,120,142],[.5,32,144,140],[.6,34,167,132],[.7,68,190,112],[.8,121,209,81],[.9,189,222,38],[1,253,231,37]],plasma:[[0,13,8,135],[.1,75,3,161],[.2,125,3,168],[.3,168,34,150],[.4,203,70,121],[.5,229,107,93],[.6,248,148,65],[.7,253,195,40],[.8,240,228,66],[.9,222,244,113],[1,240,249,33]],inferno:[[0,0,0,4],[.1,22,11,57],[.2,66,10,104],[.3,106,23,110],[.4,147,38,103],[.5,188,55,84],[.6,221,81,58],[.7,243,118,27],[.8,252,165,10],[.9,246,215,70],[1,252,255,164]],turbo:[[0,48,18,59],[.1,67,85,189],[.2,45,150,228],[.3,24,196,193],[.4,68,227,135],[.5,147,244,73],[.6,209,234,43],[.7,249,195,35],[.8,253,141,33],[.9,228,74,25],[1,163,16,16]],magma:[[0,0,0,4],[.1,23,11,58],[.2,66,15,117],[.3,114,31,129],[.4,163,50,120],[.5,211,67,94],[.6,248,107,78],[.7,254,155,87],[.8,252,205,127],[.9,252,253,191],[1,252,253,255]],cividis:[[0,0,32,77],[.2,0,53,107],[.4,65,77,107],[.6,124,123,120],[.8,190,186,118],[1,255,234,70]],jet:[[0,0,0,128],[.125,0,0,255],[.375,0,255,255],[.625,255,255,0],[.875,255,0,0],[1,128,0,0]],rainbow:[[0,0,0,255],[.2,0,255,255],[.4,0,255,0],[.6,255,255,0],[.8,255,0,0],[1,255,0,255]],coolwarm:[[0,59,76,192],[.25,119,154,229],[.5,221,221,221],[.75,241,142,105],[1,180,4,38]],terrain:[[0,51,128,51],[.2,102,179,102],[.3,179,204,102],[.4,204,179,102],[.6,179,128,77],[.8,204,179,153],[1,255,255,255]],gray:[[0,0,0,0],[1,255,255,255]]};function BS(i,e){const t=NR[i];e=Math.max(0,Math.min(1,e));for(let o=0;o<t.length-1;o++){const[p,_,l,M]=t[o],[D,B,j,$]=t[o+1];if(e>=p&&e<=D){const se=(e-p)/(D-p);return[Math.round(_+(B-_)*se),Math.round(l+(j-l)*se),Math.round(M+($-M)*se)]}}const r=t[t.length-1];return[r[1],r[2],r[3]]}const mX={0:[180,180,180],1:[180,180,180],2:[139,90,43],3:[0,200,0],4:[0,150,0],5:[0,100,0],6:[255,165,0],7:[255,0,0],9:[0,100,255],17:[200,200,0]};function BR(i,e){const{colorScheme:t,colormap:r,classificationVisibility:o}=e,p=i.pointCount,_=new Uint8Array(p*4);switch(t){case"elevation":{const{minZ:l,maxZ:M}=i.bounds,D=M-l||1;for(let B=0;B<p;B++){const $=(i.positions[B*3+2]-l)/D,[se,de,Ae]=BS(r,$);_[B*4]=se,_[B*4+1]=de,_[B*4+2]=Ae,_[B*4+3]=255}break}case"intensity":{if(!i.intensities){zS(_,p,180,180,180);break}let l=1/0,M=-1/0;for(let B=0;B<p;B++){const j=i.intensities[B];j<l&&(l=j),j>M&&(M=j)}const D=M-l||1;for(let B=0;B<p;B++){const j=(i.intensities[B]-l)/D,[$,se,de]=BS(r,j);_[B*4]=$,_[B*4+1]=se,_[B*4+2]=de,_[B*4+3]=255}break}case"classification":{if(!i.classifications){zS(_,p,180,180,180);break}for(let l=0;l<p;l++){const M=i.classifications[l];if(o[M]!==!1){const[B,j,$]=mX[M]??[180,180,180];_[l*4]=B,_[l*4+1]=j,_[l*4+2]=$,_[l*4+3]=255}else _[l*4+3]=0}break}case"rgb":{if(i.colors){_.set((i.colors.length===p*4,i.colors));for(let l=0;l<p;l++)_[l*4+3]=255}else return BR(i,e);break}}return _}function zS(i,e,t,r,o){for(let p=0;p<e;p++)i[p*4]=t,i[p*4+1]=r,i[p*4+2]=o,i[p*4+3]=255}function _X(i){return{elevation:!0,intensity:!!(i!=null&&i.intensities),classification:!!(i!=null&&i.classifications),rgb:!!(i!=null&&i.colors)}}const vv={light:"https://basemaps.cartocdn.com/gl/positron-gl-style/style.json",dark:"https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json"};function yX({layers:i,settings:e,darkBasemap:t,crossSection:r,onMapClick:o,focusedLayerId:p}){const _=gn.useRef(null),l=gn.useRef(null),M=gn.useRef(null);gn.useEffect(()=>{if(!_.current)return;const $=new HT.Map({container:_.current,style:t?vv.dark:vv.light,center:[7.6261,51.9607],zoom:14,pitch:50,maxPitch:85});$.addControl(new HT.NavigationControl,"top-left");const se=new OZ({interleaved:!1,layers:[]});return $.addControl(se),l.current=$,M.current=se,()=>{$.remove(),l.current=null,M.current=null}},[]),gn.useEffect(()=>{const $=l.current;$&&$.setStyle(t?vv.dark:vv.light)},[t]),gn.useEffect(()=>{const $=l.current;if(!$)return;const se=$.transform;if(se)try{se.fov=e.fov,$.triggerRepaint()}catch(de){console.warn("Could not set map FOV:",de)}},[e.fov]),gn.useEffect(()=>{const $=l.current;if(!$)return;const se=()=>{e.showTerrain?($.getSource("mapbox-dem")||$.addSource("mapbox-dem",{type:"raster-dem",url:"https://demotiles.maplibre.org/terrain-tiles/tiles.json",tileSize:256}),$.setTerrain({source:"mapbox-dem",exaggeration:1.5})):$.getTerrain()&&$.setTerrain(null)};$.style&&$.isStyleLoaded()?se():$.once("style.load",se)},[e.showTerrain,t]);const D=gn.useMemo(()=>{const $=(i||[]).filter(de=>de.visible&&de.pointCloud).map(de=>{const Ae=de.pointCloud,he={...e,opacity:de.opacity},Le=BR(Ae,he),$e=[];return e.showElevationFilter&&$e.push(new f3({filterSize:1})),new h3({id:`lidar-${de.id}-${e.colorScheme}-${e.colormap}`,data:{length:Math.min(Ae.pointCount,e.pointBudget),attributes:{getPosition:{value:Ae.positions,size:3},getColor:{value:Le,size:4},getFilterValue:{value:Ae.positions,size:1,offset:8,stride:12}}},coordinateSystem:xr.LNGLAT_OFFSETS,coordinateOrigin:Ae.coordinateOrigin,pointSize:e.pointSize,opacity:de.opacity,pickable:e.enablePointPicking,modelMatrix:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,de.zOffset+e.zOffset,1],sizeUnits:"pixels",getNormal:[0,0,1],updateTriggers:{getColor:[e.colorScheme,e.colormap,e.classificationVisibility],getFilterValue:[e.showElevationFilter]},extensions:$e,filterRange:e.showElevationFilter?e.elevationRange:void 0})}),se=[];return r&&(r.mode!=="idle"&&"start"in r&&se.push(new gx({id:"cross-section-start",data:[r.start],getPosition:de=>de,getRadius:10,getFillColor:[0,255,0],pickable:!1,radiusMinPixels:5})),r.mode==="complete"&&r.end&&(se.push(new gx({id:"cross-section-end",data:[r.end],getPosition:de=>de,getRadius:10,getFillColor:[255,0,0],pickable:!1,radiusMinPixels:5})),se.push(new u3({id:"cross-section-line",data:[{source:r.start,target:r.end}],getSourcePosition:de=>de.source,getTargetPosition:de=>de.target,getColor:[255,255,0],getWidth:3,widthMinPixels:2})))),[...$,...se]},[i,e,r]),B=[];gn.useEffect(()=>{const $=M.current;$&&$.setProps({layers:D,effects:B,getTooltip:({object:se,index:de,layer:Ae})=>{if(!e.enablePointPicking||!se)return null;const he=Ae.props;if(!he.data||!he.data.attributes)return null;const Le=he.data.attributes.getPosition.value,$e=Le[de*3],Be=Le[de*3+1],Je=Le[de*3+2],Rt=he.coordinateOrigin||[0,0,0],Et=Rt[0]+$e,kt=Rt[1]+Be;return{html:`
              <div style="font-family: 'Outfit', sans-serif; font-size: 12px; padding: 4px;">
                <div><b>Elevation:</b> ${Je.toFixed(2)}m</div>
                <div><b>Lng:</b> ${Et.toFixed(5)}</div>
                <div><b>Lat:</b> ${kt.toFixed(5)}</div>
              </div>
            `,style:{backgroundColor:"#1e293b",color:"white",fontSize:"0.8em",borderRadius:"4px",padding:"8px",boxShadow:"0 4px 6px rgba(0,0,0,0.3)"}}},onClick:se=>{o&&se.coordinate&&o([se.coordinate[0],se.coordinate[1]])}})},[D,B,o,e.enablePointPicking]);const j=gn.useRef(null);return gn.useEffect(()=>{const $=l.current;if(!$||!p)return;const se=i==null?void 0:i.find(de=>de.id===p);se&&se.pointCloud&&$.flyTo({center:[se.pointCloud.coordinateOrigin[0],se.pointCloud.coordinateOrigin[1]],zoom:15,pitch:50,duration:2e3})},[p,i]),gn.useEffect(()=>{const $=l.current;if(!$||!i||i.length===0)return;const se=i[i.length-1];se.id!==j.current&&se.pointCloud&&($.flyTo({center:[se.pointCloud.coordinateOrigin[0],se.pointCloud.coordinateOrigin[1]],zoom:15,pitch:50,duration:1500}),j.current=se.id)},[i]),rt.jsx("div",{ref:_,className:"map-container"})}function vX({layers:i,onLayerUpdate:e,onLayerRemove:t,onZoomToLayer:r}){return i.length===0?rt.jsx("div",{className:"layer-list-empty",children:"No layers loaded."}):rt.jsx("div",{className:"layer-list",children:i==null?void 0:i.map(o=>rt.jsxs("div",{className:"layer-item",children:[rt.jsx("div",{className:"layer-header",children:rt.jsxs("div",{className:"layer-title-row",children:[rt.jsx("input",{type:"checkbox",className:"layer-checkbox",checked:o.visible,onChange:p=>e(o.id,{visible:p.target.checked})}),rt.jsx("span",{className:"layer-name",title:o.name,children:o.name}),rt.jsx("button",{className:"icon-button",onClick:()=>r(o.id),title:"Zoom to layer",children:""}),rt.jsx("button",{className:"remove-button",onClick:()=>t(o.id),title:"Remove layer",children:""})]})}),o.visible&&rt.jsxs("div",{className:"layer-controls",children:[rt.jsxs("div",{className:"control-row",children:[rt.jsx("label",{children:"Opacity"}),rt.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:o.opacity,onChange:p=>e(o.id,{opacity:parseFloat(p.target.value)})})]}),rt.jsxs("div",{className:"control-row",children:[rt.jsx("label",{children:"Z-Offset"}),rt.jsx("input",{type:"range",min:"-50",max:"50",step:"0.5",value:o.zOffset,onChange:p=>e(o.id,{zOffset:parseFloat(p.target.value)})}),rt.jsxs("span",{className:"value-display",children:[o.zOffset,"m"]})]})]})]},o.id))})}function xX({onFileSelect:i,loading:e}){const[t,r]=gn.useState(!1),o=gn.useCallback(M=>{M.preventDefault(),e||r(!0)},[e]),p=gn.useCallback(M=>{M.preventDefault(),r(!1)},[]),_=gn.useCallback(M=>{if(M.preventDefault(),r(!1),!e&&M.dataTransfer.files&&M.dataTransfer.files.length>0){const D=M.dataTransfer.files[0];i(D)}},[e,i]),l=gn.useCallback(M=>{M.target.files&&M.target.files.length>0&&i(M.target.files[0])},[i]);return rt.jsxs("div",{className:`drop-zone ${t?"active":""} ${e?"disabled":""}`,onDragOver:o,onDragLeave:p,onDrop:_,children:[rt.jsx("input",{type:"file",id:"file-upload",className:"file-input",accept:".las,.laz",onChange:l,disabled:e}),rt.jsx("label",{htmlFor:"file-upload",className:"drop-label",children:e?rt.jsx("span",{children:"Loading..."}):rt.jsxs(rt.Fragment,{children:[rt.jsx("span",{className:"drop-icon",children:""}),rt.jsx("span",{children:"Drag & drop .laz file or click to browse"})]})})]})}function bX({onUrlSubmit:i,loading:e}){const[t,r]=gn.useState(""),o=gn.useCallback(p=>{p.preventDefault(),t.trim()&&(i(t.trim()),r(""))},[t,i]);return rt.jsxs("form",{onSubmit:o,className:"url-input-form",children:[rt.jsx("input",{type:"text",className:"url-input",placeholder:"Enter .laz URL...",value:t,onChange:p=>r(p.target.value),disabled:e}),rt.jsx("button",{type:"submit",className:"url-submit-button",disabled:e||!t.trim(),children:"Load"})]})}function AX({data:i,width:e=600,height:t=200}){const r=gn.useRef(null);return gn.useEffect(()=>{const o=r.current;if(!o||i.length===0)return;const p=o.getContext("2d");if(!p)return;const _=window.devicePixelRatio||1;o.width=e*_,o.height=t*_,p.scale(_,_),o.style.width=`${e}px`,o.style.height=`${t}px`,p.fillStyle="#111",p.fillRect(0,0,e,t);let l=1/0,M=-1/0,D=1/0,B=-1/0;for(const de of i)de.distance<l&&(l=de.distance),de.distance>M&&(M=de.distance),de.elevation<D&&(D=de.elevation),de.elevation>B&&(B=de.elevation);const j=B-D;D-=j*.1,B+=j*.1;const $=M-l||1,se=B-D||1;i.forEach(de=>{const Ae=(de.distance-l)/$*e,he=t-(de.elevation-D)/se*t;p.fillStyle=`rgb(${de.color[0]}, ${de.color[1]}, ${de.color[2]})`,p.fillRect(Ae,he,2,2)}),p.strokeStyle="#333",p.lineWidth=1,p.beginPath(),p.moveTo(0,t),p.lineTo(e,t),p.stroke(),p.fillStyle="#888",p.font="10px sans-serif",p.fillText(`${D.toFixed(1)}m`,5,t-5),p.fillText(`${B.toFixed(1)}m`,5,10),p.fillText(`${l.toFixed(1)}m`,0,t-5),p.fillText(`${M.toFixed(1)}m`,e-30,t-5)},[i,e,t]),rt.jsx("div",{className:"elevation-profile",children:rt.jsx("canvas",{ref:r})})}function wX({datasets:i,activeDatasetId:e,onDatasetChange:t,onLoadDataset:r,onFileSelect:o,onUrlLoad:p,loading:_,layers:l,onLayerUpdate:M,onLayerRemove:D,onZoomToLayer:B,settings:j,onSettingsChange:$,darkBasemap:se,onBasemapToggle:de,pointCount:Ae,pointCloud:he,crossSection:Le,profileData:$e,onStartProfile:Be,onStopProfile:Je}){const[Rt,Et]=gn.useState(!0),[kt,Ht]=gn.useState(null),Xt=_X(he),hi=nt=>{const Ut=NR[nt];return Ut?`linear-gradient(to right, ${Ut.map(([li,Wi,Ye,Gt])=>`rgb(${Wi},${Ye},${Gt}) ${li*100}%`).join(", ")})`:"none"},di=()=>rt.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[rt.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),rt.jsx("polyline",{points:"7 10 12 15 17 10"}),rt.jsx("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]}),Ei=()=>rt.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[rt.jsx("path",{d:"M12 2l9 16H3z"})," ",rt.jsx("rect",{x:"2",y:"2",width:"8",height:"8",rx:"1"})," ",rt.jsx("circle",{cx:"18",cy:"6",r:"4"})," "]}),Ii=()=>rt.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:rt.jsx("path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"})}),fi=()=>rt.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[rt.jsx("rect",{x:"3",y:"3",width:"7",height:"7"}),rt.jsx("rect",{x:"14",y:"3",width:"7",height:"7"}),rt.jsx("rect",{x:"14",y:"14",width:"7",height:"7"}),rt.jsx("rect",{x:"3",y:"14",width:"7",height:"7"})]}),Ui=()=>rt.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[rt.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),rt.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]});return rt.jsxs(rt.Fragment,{children:[rt.jsx("div",{className:"panel-container panel-data",children:Rt?rt.jsxs("div",{className:"panel-content",children:[rt.jsxs("div",{className:"panel-header",children:[rt.jsx("h3",{className:"panel-title",children:"Data Sources"}),rt.jsx("button",{className:"panel-close-btn",onClick:()=>Et(!1),children:rt.jsx(Ui,{})})]}),rt.jsxs("div",{className:"control-group",children:[rt.jsx("label",{className:"control-label",children:"Example Datasets"}),rt.jsxs("div",{className:"control-row-flex",children:[rt.jsx("select",{className:"control-select",value:e,onChange:nt=>t(nt.target.value),children:i==null?void 0:i.map(nt=>rt.jsx("option",{value:nt.id,children:nt.label},nt.id))}),rt.jsx("button",{className:"control-button load-button-small",onClick:r,disabled:_,children:"Load"})]})]}),rt.jsxs("div",{className:"control-group",children:[rt.jsx("label",{className:"control-label",children:"Upload File"}),rt.jsx(xX,{onFileSelect:o,loading:_})]}),rt.jsxs("div",{className:"control-group",children:[rt.jsx("label",{className:"control-label",children:"Load from URL"}),rt.jsx(bX,{onUrlSubmit:p,loading:_})]}),rt.jsxs("div",{className:"control-group",children:[rt.jsx("label",{className:"control-label",children:"Layers"}),rt.jsx(vX,{layers:l,onLayerUpdate:M,onLayerRemove:D,onZoomToLayer:B})]}),Ae!==null&&rt.jsxs("div",{className:"control-group stats",children:[rt.jsx("span",{className:"stat-label",children:"Total Points"}),rt.jsx("span",{className:"stat-value",children:Ae.toLocaleString()})]})]}):rt.jsxs("div",{className:"widget-wrapper",style:{alignItems:"flex-end"},children:[rt.jsx("button",{className:"icon-btn",onClick:()=>Et(!0),title:"Data Sources",children:rt.jsx(di,{})}),rt.jsx("span",{className:"widget-label",children:"Data"})]})}),rt.jsxs("div",{className:"left-dock",children:[rt.jsxs("div",{className:"widget-wrapper",children:[kt==="viz"?rt.jsxs("div",{className:"panel-content",children:[rt.jsxs("div",{className:"panel-header",children:[rt.jsx("h3",{className:"panel-title",children:"Visuals"}),rt.jsx("button",{className:"panel-close-btn",onClick:()=>Ht(null),children:rt.jsx(Ui,{})})]}),rt.jsxs("div",{className:"control-group",children:[rt.jsx("label",{className:"control-label",children:"Color Scheme"}),rt.jsxs("select",{className:"control-select",value:j.colorScheme,onChange:nt=>$({...j,colorScheme:nt.target.value}),children:[rt.jsx("option",{value:"elevation",children:"Elevation"}),rt.jsx("option",{value:"intensity",disabled:!Xt.intensity,children:"Intensity"}),rt.jsx("option",{value:"classification",disabled:!Xt.classification,children:"Classification"}),rt.jsx("option",{value:"rgb",disabled:!Xt.rgb,children:"RGB"})]})]}),(j.colorScheme==="elevation"||j.colorScheme==="intensity")&&rt.jsxs("div",{className:"control-group",children:[rt.jsx("label",{className:"control-label",children:"Colormap"}),rt.jsxs("select",{className:"control-select",value:j.colormap,onChange:nt=>$({...j,colormap:nt.target.value}),children:[rt.jsx("option",{value:"viridis",children:"Viridis"}),rt.jsx("option",{value:"plasma",children:"Plasma"}),rt.jsx("option",{value:"magma",children:"Magma"}),rt.jsx("option",{value:"inferno",children:"Inferno"}),rt.jsx("option",{value:"cividis",children:"Cividis"}),rt.jsx("option",{value:"turbo",children:"Turbo"}),rt.jsx("option",{value:"jet",children:"Jet"}),rt.jsx("option",{value:"rainbow",children:"Rainbow"}),rt.jsx("option",{value:"coolwarm",children:"Coolwarm"}),rt.jsx("option",{value:"terrain",children:"Terrain"}),rt.jsx("option",{value:"gray",children:"Grayscale"})]}),rt.jsx("div",{style:{marginTop:"12px",height:"12px",borderRadius:"4px",background:hi(j.colormap),border:"1px solid rgba(255,255,255,0.2)"}}),rt.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"10px",marginTop:"4px",color:"#ccc",fontFamily:"monospace"},children:[rt.jsx("span",{children:"Low"}),rt.jsx("span",{children:"High"})]})]}),rt.jsxs("div",{className:"control-group",children:[rt.jsxs("label",{className:"control-label",children:["Point Size ",rt.jsxs("span",{children:[j.pointSize,"px"]})]}),rt.jsx("input",{type:"range",min:1,max:10,step:.5,value:j.pointSize,onChange:nt=>$({...j,pointSize:Number(nt.target.value)})})]}),rt.jsxs("div",{className:"control-group",children:[rt.jsxs("label",{className:"control-label",children:["Opacity ",rt.jsxs("span",{children:[Math.round(j.opacity*100),"%"]})]}),rt.jsx("input",{type:"range",min:.1,max:1,step:.05,value:j.opacity,onChange:nt=>$({...j,opacity:Number(nt.target.value)})})]}),rt.jsxs("div",{className:"control-group",children:[rt.jsxs("label",{className:"control-label",children:["Budget ",rt.jsxs("span",{children:[(j.pointBudget/1e6).toFixed(1),"M"]})]}),rt.jsx("input",{type:"range",min:1e5,max:5e6,step:1e5,value:j.pointBudget,onChange:nt=>$({...j,pointBudget:Number(nt.target.value)})})]}),rt.jsxs("div",{className:"control-group",style:{display:"flex",flexDirection:"column",gap:"8px",marginTop:"16px"},children:[rt.jsxs("label",{className:"checkbox-label",style:{display:"flex",justifyContent:"space-between",alignItems:"center",fontSize:"0.9rem"},children:[rt.jsx("span",{children:"3D Terrain"}),rt.jsx("input",{type:"checkbox",checked:j.showTerrain,onChange:nt=>$({...j,showTerrain:nt.target.checked})})]}),rt.jsxs("label",{className:"checkbox-label",style:{display:"flex",justifyContent:"space-between",alignItems:"center",fontSize:"0.9rem"},children:[rt.jsx("span",{children:"Enable point picking"}),rt.jsx("input",{type:"checkbox",checked:j.enablePointPicking,onChange:nt=>$({...j,enablePointPicking:nt.target.checked})})]}),rt.jsxs("label",{className:"checkbox-label",style:{display:"flex",justifyContent:"space-between",alignItems:"center",fontSize:"0.9rem"},children:[rt.jsx("span",{children:"Elevation Filter"}),rt.jsx("input",{type:"checkbox",checked:j.showElevationFilter,onChange:nt=>$({...j,showElevationFilter:nt.target.checked})})]})]}),j.showElevationFilter&&rt.jsxs("div",{className:"control-group",children:[rt.jsxs("label",{className:"control-label",children:["Elevation Range ",rt.jsxs("span",{children:[j.elevationRange[0],"m - ",j.elevationRange[1],"m"]})]}),rt.jsxs("div",{style:{display:"flex",gap:"8px"},children:[rt.jsx("input",{type:"number",className:"control-input-number",value:j.elevationRange[0],onChange:nt=>$({...j,elevationRange:[Number(nt.target.value),j.elevationRange[1]]}),style:{width:"45%"}}),rt.jsx("input",{type:"number",className:"control-input-number",value:j.elevationRange[1],onChange:nt=>$({...j,elevationRange:[j.elevationRange[0],Number(nt.target.value)]}),style:{width:"45%"}})]})]})]}):rt.jsx("button",{className:"icon-btn",onClick:()=>Ht("viz"),title:"Visualization",children:rt.jsx(Ei,{})}),rt.jsx("span",{className:"widget-label",children:"Visuals"})]}),rt.jsxs("div",{className:"widget-wrapper",children:[kt==="tools"?rt.jsxs("div",{className:"panel-content",children:[rt.jsxs("div",{className:"panel-header",children:[rt.jsx("h3",{className:"panel-title",children:"Tools"}),rt.jsx("button",{className:"panel-close-btn",onClick:()=>Ht(null),children:rt.jsx(Ui,{})})]}),rt.jsxs("div",{className:"control-group",children:[rt.jsxs("p",{style:{fontSize:"0.8rem",color:"#ccc",marginBottom:"12px"},children:[Le.mode==="idle"&&"Click to start drawing a cross-section profile.",Le.mode==="check_start"&&"Click map to set START point.",Le.mode==="check_end"&&"Click map to set END point.",Le.mode==="complete"&&"Profile generated."]}),Le.mode==="idle"?rt.jsx("button",{className:"control-button",onClick:Be,children:"Draw Profile"}):rt.jsx("button",{className:"control-button",onClick:Je,style:{background:"#d32f2f"},children:"Cancel / Clear"})]}),$e.length>0&&rt.jsxs("div",{className:"control-group",children:[rt.jsx("label",{className:"control-label",children:"Elevation Profile"}),rt.jsx(AX,{data:$e,width:260,height:120})]})]}):rt.jsx("button",{className:"icon-btn",onClick:()=>Ht("tools"),title:"Tools",children:rt.jsx(Ii,{})}),rt.jsx("span",{className:"widget-label",children:"Tools"})]}),rt.jsxs("div",{className:"widget-wrapper",children:[kt==="basemap"?rt.jsxs("div",{className:"panel-content",children:[rt.jsxs("div",{className:"panel-header",children:[rt.jsx("h3",{className:"panel-title",children:"Basemap"}),rt.jsx("button",{className:"panel-close-btn",onClick:()=>Ht(null),children:rt.jsx(Ui,{})})]}),rt.jsx("div",{className:"control-group",children:rt.jsxs("div",{className:"toggle-group",children:[rt.jsx("button",{className:`toggle-button ${se?"":"active"}`,onClick:()=>se&&de(),children:"Light"}),rt.jsx("button",{className:`toggle-button ${se?"active":""}`,onClick:()=>!se&&de(),children:"Dark"})]})}),rt.jsxs("div",{className:"control-group",children:[rt.jsxs("label",{className:"control-label",children:["FOV ",rt.jsxs("span",{children:[j.fov,""]})]}),rt.jsx("input",{type:"range",min:10,max:120,step:1,value:j.fov,onChange:nt=>$({...j,fov:Number(nt.target.value)})})]})]}):rt.jsx("button",{className:"icon-btn",onClick:()=>Ht("basemap"),title:"Basemaps",children:rt.jsx(fi,{})}),rt.jsx("span",{className:"widget-label",children:"Map"})]})]})]})}function TX({progress:i}){return rt.jsx("div",{className:"loading-overlay",children:rt.jsxs("div",{className:"loading-content",children:[rt.jsx("div",{className:"loading-spinner"}),rt.jsx("h2",{className:"loading-title",children:"Loading LIDAR Data"}),rt.jsx("div",{className:"loading-progress-bar",children:rt.jsx("div",{className:"loading-progress-fill",style:{width:`${Math.round(i*100)}%`}})}),rt.jsxs("p",{className:"loading-percent",children:[Math.round(i*100),"%"]})]})})}const aA=[{id:"muenster-center",label:"Mnster Center",url:"/lidar_data/data/3dm_32_404_5758_1_nw.laz"},{id:"muenster-east",label:"Mnster East",url:"/lidar_data/data/3dm_32_405_5758_1_nw.laz"},{id:"test-indoor",label:"Test: Small Indoor Scan",url:"https://raw.githubusercontent.com/visgl/deck.gl-data/master/examples/point-cloud-laz/indoor.0.1.laz"}],SX={colorScheme:"elevation",colormap:"viridis",pointSize:2,opacity:1,zOffset:0,classificationVisibility:{},fov:50,pointBudget:1e6,brightness:0,contrast:0,saturation:0,showTerrain:!1,enablePointPicking:!1,showElevationFilter:!1,elevationRange:[0,500]};function EX(){const[i,e]=gn.useState(aA[0].id),[t,r]=gn.useState([]),[o,p]=gn.useState(SX),[_,l]=gn.useState(!0),[M,D]=gn.useState(!1),[B,j]=gn.useState(0),[$,se]=gn.useState({mode:"idle"}),[de,Ae]=gn.useState([]),[he,Le]=gn.useState(null),$e=gn.useCallback(async(nt,Ut)=>{if(!M){D(!0),j(0);try{const mi=await xN(nt,Wi=>j(Wi)),li={id:crypto.randomUUID(),name:Ut,source:typeof nt=="string"?"remote":"local",url:typeof nt=="string"?nt:void 0,pointCloud:mi,visible:!0,opacity:1,zOffset:0};r(Wi=>[...Wi,li])}catch(mi){console.error("Failed to load point cloud:",mi),alert(`Failed to load point cloud: ${mi.message||mi}`)}finally{D(!1)}}},[M]),Be=gn.useCallback(()=>{const nt=aA.find(Ut=>Ut.id===i);nt&&$e(nt.url,nt.label)},[i,$e]),Je=gn.useCallback(nt=>{$e(nt,nt.name)},[$e]),Rt=gn.useCallback(nt=>{const Ut=nt.split("/").pop()||"Remote Layer";$e(nt,Ut)},[$e]),Et=gn.useCallback((nt,Ut)=>{r(mi=>mi.map(li=>li.id===nt?{...li,...Ut}:li))},[]),kt=gn.useCallback(nt=>{r(Ut=>Ut.filter(mi=>mi.id!==nt))},[]),Ht=gn.useCallback(nt=>{p(nt)},[]),Xt=gn.useCallback(()=>{l(nt=>!nt)},[]),hi=gn.useCallback(()=>{se({mode:"check_start"}),Ae([])},[]),di=gn.useCallback(()=>{se({mode:"idle"}),Ae([])},[]),Ei=gn.useCallback(nt=>{se(Ut=>{if(Ut.mode==="check_start")return{mode:"check_end",start:nt};if(Ut.mode==="check_end"){const mi=Ut.start,li=nt,Wi=t.find(Ye=>Ye.visible&&Ye.pointCloud);if(Wi&&Wi.pointCloud){const Ye=bN(Wi.pointCloud,mi,li,5);Ae(Ye)}return{mode:"complete",start:mi,end:li,width:5}}return Ut})},[t]),Ii=t.reduce((nt,Ut)=>{var mi;return nt+(((mi=Ut.pointCloud)==null?void 0:mi.pointCount)??0)},0),fi=t.length>0?t[0].pointCloud:null,Ui=gn.useCallback(nt=>{Le(null),setTimeout(()=>Le(nt),10)},[]);return rt.jsxs("div",{className:"app-layout",children:[rt.jsx(wX,{datasets:aA,activeDatasetId:i,onDatasetChange:e,onLoadDataset:Be,onFileSelect:Je,onUrlLoad:Rt,loading:M,layers:t,onLayerUpdate:Et,onLayerRemove:kt,onZoomToLayer:Ui,settings:o,onSettingsChange:Ht,darkBasemap:_,onBasemapToggle:Xt,pointCount:Ii,pointCloud:fi,crossSection:$,profileData:de,onStartProfile:hi,onStopProfile:di}),rt.jsx("header",{className:"app-title",children:rt.jsx("h1",{children:"Lidar Data Map Explore"})}),rt.jsx("main",{className:"app-map",children:rt.jsx(yX,{layers:t,settings:o,darkBasemap:_,crossSection:$,onMapClick:Ei,focusedLayerId:he})}),rt.jsx("footer",{className:"app-credits",children:rt.jsx("p",{children:rt.jsx("span",{children:"Created by Eric Musonera"})})}),M&&rt.jsx(TX,{progress:B})]})}class MX extends gn.Component{constructor(){super(...arguments);pe(this,"state",{hasError:!1,error:null})}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,r){console.error("Uncaught error:",t,r)}render(){var t;return this.state.hasError?rt.jsxs("div",{style:{padding:"20px",color:"red",background:"#fff"},children:[rt.jsx("h1",{children:"Something went wrong."}),rt.jsx("pre",{children:(t=this.state.error)==null?void 0:t.toString()})]}):this.props.children}}c6.createRoot(document.getElementById("root")).render(rt.jsx(gn.StrictMode,{children:rt.jsx(MX,{children:rt.jsx(EX,{})})}))});export default RX();
